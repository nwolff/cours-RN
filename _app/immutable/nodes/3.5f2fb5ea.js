import{b as x2e}from"../chunks/paths.515ff18f.js";import{S as jQ,i as UQ,s as WQ,k as gd,a as m$,q as VQ,l as md,m as yd,h as go,c as y$,r as GQ,n as Jo,p as w2e,b as gb,D as Nc,J as C2e,H as jO,K as S2e,o as _2e,y as $2e,z as k2e,A as E2e,u as A2e,g as T2e,d as D2e,B as I2e}from"../chunks/index.509146bb.js";function F2e(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in e)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O2e=1e-7,N2e=1e-4;class R4{constructor(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,n){this.dataIdsCount++,this.data.set(t,n)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class vA{refCount(t){return ss("refCount")}incRef(t){return ss("incRef")}timerAvailable(){return!0}time(t){return ss("time")}read(t){return ss("read")}readSync(t){return ss("readSync")}readToGPU(t,n){return ss("readToGPU")}numDataIds(){return ss("numDataIds")}disposeData(t,n){return ss("disposeData")}write(t,n,r){return ss("write")}move(t,n,r,i,s){return ss("move")}createTensorFromGPUData(t,n,r){return ss("createTensorFromGPUData")}memory(){return ss("memory")}floatPrecision(){return ss("floatPrecision")}epsilon(){return this.floatPrecision()===32?O2e:N2e}dispose(){return ss("dispose")}}function ss(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,Tl(e,t,n)}function M2e(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let n=e.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,Tl(e,n,r),Tl(t,n,r)}function _f(e,t,n){return Math.max(e,Math.min(t,n))}function xA(e){return e%2===0?e:e+1}function Tl(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function HQ(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function R2e(e,t){const n=Math.random();return t*n+(1-n)*e}function P2e(e,t){let n=0;for(let r=0;r<e.length;r++){const i=Number(e[r])-Number(t[r]);n+=i*i}return n}function z(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Nr(e,t,n=""){z(_t(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function Hp(e){z(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function ce(e){if(e.length===0)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function L2e(e){return e.length===0}function qQ(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==null&&t[n]!==null&&e[n]!==t[n])return!1;return!0}function _t(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ap(e){return e%1===0}function B2e(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{const t=Math.exp(2*e);return(t-1)/(t+1)}}function b$(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function z2e(e){const t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return P4(t),t}function Wd(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function SM(e,t=i=>0,n,r){return new Promise((i,s)=>{let o=0;const a=()=>{if(e()){i();return}o++;const u=t(o);if(n!=null&&o>=n){s();return}r!=null?r(a,u):setTimeout(a,u)};a()})}function L4(e,t){let n=1,r=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)n*=e[s];else if(e[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(e[s]<0)throw Error(`Shapes can not be < 0. Found ${e[s]} at dim ${s}`);if(r===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(n===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const i=e.slice();return i[r]=t/n,i}function dt(e,t){const n=t.length;return e=e==null?t.map((r,i)=>i):[].concat(e),z(e.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),z(e.every(r=>ap(r)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(r=>r<0?n+r:r)}function cc(e,t){const n=[],r=[],i=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||i?null:dt(t,e).sort();let o=0;for(let a=0;a<e.length;++a){if(s!=null){if(s[o]===a&&e[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${e[a]}' is not 1`);(s[o]==null||s[o]>a)&&e[a]===1&&(n.push(e[a]),r.push(a)),s[o]<=a&&o++}e[a]!==1&&(n.push(e[a]),r.push(a))}return{newShape:n,keptDims:r}}function gr(e,t){return Fn(e,t)}function Fn(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else if(e==="string")n=new Array(t);else throw new Error(`Unknown data type ${e}`);return n}function XQ(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function YQ(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function B4(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function _v(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function KQ(e){if(e==null)return 0;let t=0;return e.forEach(n=>t+=n.length),t}function cu(e){return typeof e=="string"||e instanceof String}function ZQ(e){return typeof e=="boolean"}function v$(e){return typeof e=="number"}function qp(e){return Array.isArray(e)?qp(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":v$(e)?"float32":cu(e)?"string":ZQ(e)?"bool":"float32"}function $f(e){return!!(e&&e.constructor&&e.call&&e.apply)}function x$(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function Ue(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function JQ(e,t,n,r=!1){const i=new Array;if(t.length===1){const s=t[0]*(r?2:1);for(let o=0;o<s;o++)i[o]=n[e+o]}else{const s=t[0],o=t.slice(1),a=o.reduce((u,l)=>u*l)*(r?2:1);for(let u=0;u<s;u++)i[u]=JQ(e+u*a,o,n,r)}return i}function Ao(e,t,n=!1){if(e.length===0)return t[0];const r=e.reduce((i,s)=>i*s)*(n?2:1);if(r===0)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return JQ(0,e,t,n)}function QQ(e,t){if(Array.isArray(e))return e;if(t==="float32")return e instanceof Float32Array?e:new Float32Array(e);if(t==="int32")return e instanceof Int32Array?e:new Int32Array(e);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function wA(e,t){const n=Ir(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function Ir(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function z4(e,t){const n=e.reduce((r,i)=>r*i,1);if(t==null||t==="float32")return Ao(e,new Float32Array(n));if(t==="int32")return Ao(e,new Int32Array(n));if(t==="bool")return Ao(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function Ns(e){e.forEach(t=>{z(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function ba(e,t,n){if(t===0)return 0;if(t===1)return e[0];let r=e[e.length-1];for(let i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function Xp(e,t,n){if(t===0)return[];if(t===1)return[e];const r=new Array(t);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}function CA(e){return e&&e.then&&typeof e.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KW="tfjsflags";class eee{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=j2e,this.populateURLFlags()}setPlatform(t,n){this.platform!=null&&(ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=n}registerFlag(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){const i=this.urlFlags[t];ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${i}.`),this.set(t,i)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const n=this.evaluateFlag(t);if(CA(n))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=n,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,n){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);KW in t&&t[KW].split(",").forEach(r=>{const[i,s]=r.split(":");this.urlFlags[i]=W2e(i,s)})}}function j2e(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(U2e(t,r[0],r[1]),r.join("="))),t}function U2e(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function W2e(e,t){const n=t.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:t}function ae(){return j4}let j4=null;function V2e(e){j4=e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let UO;function tee(){if(UO==null){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else if(typeof self<"u")e=self;else throw new Error("Could not find a global object");UO=e}return UO}function G2e(){const e=tee();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function U4(e,t){const n=G2e();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const d2="Abs",M0="Acos",R0="Acosh",Yp="Add",p2="AddN",SA="All",_A="Any",g2="ArgMax",m2="ArgMin",P0="Asin",L0="Asinh",B0="Atan",z0="Atanh",j0="Atan2",y2="AvgPool",$A="AvgPoolGrad",b2="AvgPool3D",kA="AvgPool3DGrad",v2="BatchMatMul",x2="BatchToSpaceND",EA="Bincount",w2="BitwiseAnd",nee="BroadcastTo",AA="BroadcastArgs",U0="Cast",W0="Ceil",V0="ClipByValue",TA="Complex",C2="ComplexAbs",S2="Concat",_2="Conv2D",DA="Conv2DBackpropFilter",$2="Conv2DBackpropInput",k2="Conv3D",IA="Conv3DBackpropFilterV2",FA="Conv3DBackpropInputV2",G0="Cos",H0="Cosh",OA="Cumprod",E2="Cumsum",NA="CropAndResize",MA="DenseBincount",RA="DepthToSpace",A2="DepthwiseConv2dNative",PA="DepthwiseConv2dNativeBackpropFilter",LA="DepthwiseConv2dNativeBackpropInput",BA="Diag",T2="Dilation2D",w$="Dilation2DBackpropInput",C$="Dilation2DBackpropFilter",W4="Draw",q0="RealDiv",zA="Einsum",X0="Elu",jA="EluGrad",Y0="Erf",D2="Equal",K0="Exp",I2="ExpandDims",Z0="Expm1",UA="FFT",WA="Fill",VA="FlipLeftRight",J0="Floor",Q0="FloorDiv",F2="FusedBatchNorm",O2="GatherV2",GA="GatherNd",N2="Greater",e1="GreaterEqual",t1="Identity",HA="IFFT",qA="Imag",n1="IsFinite",r1="IsInf",i1="IsNan",M2="LeakyRelu",R2="Less",P2="LessEqual",XA="LinSpace",s1="Log",o1="Log1p",L2="LogicalAnd",B2="LogicalNot",z2="LogicalOr",H2e="LogicalXor",ree="LogSoftmax",q2e="LowerBound",j2="LRN",YA="LRNGrad",X2e="MatrixBandPart",U2="Max",a1="Maximum",W2="MaxPool",KA="MaxPoolGrad",V2="MaxPool3D",ZA="MaxPool3DGrad",JA="MaxPoolWithArgmax",G2="Mean",H2="Min",u1="Minimum",q2="MirrorPad",l1="Mod",QA="Multinomial",c1="Multiply",X2="Neg",Y2="NotEqual",eT="NonMaxSuppressionV3",tT="NonMaxSuppressionV4",nT="NonMaxSuppressionV5",K2="OnesLike",Z2="OneHot",J2="Pack",Q2="PadV2",Y2e="Pool",f1="Pow",ew="Prelu",tw="Prod",rT="RaggedGather",iT="RaggedRange",sT="RaggedTensorToTensor",oT="Range",aT="Real",h1="Reciprocal",d1="Relu",nw="Reshape",rw="ResizeNearestNeighbor",uT="ResizeNearestNeighborGrad",iw="ResizeBilinear",lT="ResizeBilinearGrad",p1="Relu6",sw="Reverse",g1="Round",m1="Rsqrt",cT="ScatterNd",fT="TensorScatterUpdate",hT="SearchSorted",ow="Select",y1="Selu",aw="Slice",b1="Sin",v1="Sinh",x1="Sign",w1="Sigmoid",C1="Softplus",S1="Sqrt",uw="Sum",lw="SpaceToBatchND",cw="SplitV",fw="Softmax",dT="SparseFillEmptyRows",pT="SparseReshape",gT="SparseSegmentMean",mT="SparseSegmentSum",yT="SparseToDense",_1="SquaredDifference",bT="Square",hw="StaticRegexReplace",vT="StridedSlice",xT="StringNGrams",wT="StringSplit",CT="StringToHashBucketFast",$1="Sub",k1="Tan",E1="Tanh",A1="Tile",ST="TopK",_T="Transform",Vd="Transpose",$T="Unique",dw="Unpack",pw="UnsortedSegmentSum",K2e="UpperBound",gw="ZerosLike",T1="Step",S$="FromPixels",kT="RotateWithOffset",$v="_FusedMatMul",kv="FusedConv2D",Ev="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(...e){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(...e)}function Z2e(...e){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.log(...e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fm=U4("kernelRegistry",()=>new Map),Av=U4("gradRegistry",()=>new Map);function _$(e,t){const n=V4(e,t);return Fm.get(n)}function _M(e){return Av.get(e)}function $$(e){const t=Fm.entries(),n=[];for(;;){const{done:r,value:i}=t.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===e&&n.push(o)}return n}function ET(e){const{kernelName:t,backendName:n}=e,r=V4(t,n);Fm.has(r)&&js(`The kernel '${t}' for backend '${n}' is already registered`),Fm.set(r,e)}function iee(e){const{kernelName:t}=e;Av.has(t)&&ae().getBool("DEBUG")&&js(`Overriding the gradient for '${t}'`),Av.set(t,e)}function J2e(e,t){const n=V4(e,t);if(!Fm.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);Fm.delete(n)}function Q2e(e){if(!Av.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);Av.delete(e)}function ewe(e,t){$$(e).forEach(r=>{const i=Object.assign({},r,{backendName:t});ET(i)})}function V4(e,t){return`${t}_${e}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function see(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var st=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Kp(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){if(this instanceof r){var i=[null];i.push.apply(i,arguments);var s=Function.bind.apply(t,i);return new s}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var oee=fn,mo=null;try{mo=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function fn(e,t,n){this.low=e|0,this.high=t|0,this.unsigned=!!n}fn.prototype.__isLong__;Object.defineProperty(fn.prototype,"__isLong__",{value:!0});function Ms(e){return(e&&e.__isLong__)===!0}fn.isLong=Ms;var ZW={},JW={};function Zp(e,t){var n,r,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(r=JW[e],r)?r:(n=hn(e,(e|0)<0?-1:0,!0),i&&(JW[e]=n),n)):(e|=0,(i=-128<=e&&e<128)&&(r=ZW[e],r)?r:(n=hn(e,e<0?-1:0,!1),i&&(ZW[e]=n),n))}fn.fromInt=Zp;function yo(e,t){if(isNaN(e))return t?Id:bo;if(t){if(e<0)return Id;if(e>=aee)return cee}else{if(e<=-eV)return ys;if(e+1>=eV)return lee}return e<0?yo(-e,t).neg():hn(e%Om|0,e/Om|0,t)}fn.fromNumber=yo;function hn(e,t,n){return new fn(e,t,n)}fn.fromBits=hn;var k$=Math.pow;function G4(e,t,n){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return bo;if(typeof t=="number"?(n=t,t=!1):t=!!t,n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return G4(e.substring(1),t,n).neg();for(var i=yo(k$(n,8)),s=bo,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+a),n);if(a<8){var l=yo(k$(n,a));s=s.mul(l).add(yo(u))}else s=s.mul(i),s=s.add(yo(u))}return s.unsigned=t,s}fn.fromString=G4;function Oa(e,t){return typeof e=="number"?yo(e,t):typeof e=="string"?G4(e,t):hn(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}fn.fromValue=Oa;var QW=65536,twe=1<<24,Om=QW*QW,aee=Om*Om,eV=aee/2,tV=Zp(twe),bo=Zp(0);fn.ZERO=bo;var Id=Zp(0,!0);fn.UZERO=Id;var um=Zp(1);fn.ONE=um;var uee=Zp(1,!0);fn.UONE=uee;var $M=Zp(-1);fn.NEG_ONE=$M;var lee=hn(-1,2147483647,!1);fn.MAX_VALUE=lee;var cee=hn(-1,-1,!0);fn.MAX_UNSIGNED_VALUE=cee;var ys=hn(0,-2147483648,!1);fn.MIN_VALUE=ys;var Ae=fn.prototype;Ae.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ae.toNumber=function(){return this.unsigned?(this.high>>>0)*Om+(this.low>>>0):this.high*Om+(this.low>>>0)};Ae.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ys)){var n=yo(t),r=this.div(n),i=r.mul(n).sub(this);return r.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=yo(k$(t,6),this.unsigned),o=this,a="";;){var u=o.div(s),l=o.sub(u.mul(s)).toInt()>>>0,c=l.toString(t);if(o=u,o.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};Ae.getHighBits=function(){return this.high};Ae.getHighBitsUnsigned=function(){return this.high>>>0};Ae.getLowBits=function(){return this.low};Ae.getLowBitsUnsigned=function(){return this.low>>>0};Ae.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ys)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&!(t&1<<n);n--);return this.high!=0?n+33:n+1};Ae.isZero=function(){return this.high===0&&this.low===0};Ae.eqz=Ae.isZero;Ae.isNegative=function(){return!this.unsigned&&this.high<0};Ae.isPositive=function(){return this.unsigned||this.high>=0};Ae.isOdd=function(){return(this.low&1)===1};Ae.isEven=function(){return(this.low&1)===0};Ae.equals=function(t){return Ms(t)||(t=Oa(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};Ae.eq=Ae.equals;Ae.notEquals=function(t){return!this.eq(t)};Ae.neq=Ae.notEquals;Ae.ne=Ae.notEquals;Ae.lessThan=function(t){return this.comp(t)<0};Ae.lt=Ae.lessThan;Ae.lessThanOrEqual=function(t){return this.comp(t)<=0};Ae.lte=Ae.lessThanOrEqual;Ae.le=Ae.lessThanOrEqual;Ae.greaterThan=function(t){return this.comp(t)>0};Ae.gt=Ae.greaterThan;Ae.greaterThanOrEqual=function(t){return this.comp(t)>=0};Ae.gte=Ae.greaterThanOrEqual;Ae.ge=Ae.greaterThanOrEqual;Ae.compare=function(t){if(Ms(t)||(t=Oa(t)),this.eq(t))return 0;var n=this.isNegative(),r=t.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};Ae.comp=Ae.compare;Ae.negate=function(){return!this.unsigned&&this.eq(ys)?ys:this.not().add(um)};Ae.neg=Ae.negate;Ae.add=function(t){Ms(t)||(t=Oa(t));var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,s=this.low&65535,o=t.high>>>16,a=t.high&65535,u=t.low>>>16,l=t.low&65535,c=0,f=0,h=0,d=0;return d+=s+l,h+=d>>>16,d&=65535,h+=i+u,f+=h>>>16,h&=65535,f+=r+a,c+=f>>>16,f&=65535,c+=n+o,c&=65535,hn(h<<16|d,c<<16|f,this.unsigned)};Ae.subtract=function(t){return Ms(t)||(t=Oa(t)),this.add(t.neg())};Ae.sub=Ae.subtract;Ae.multiply=function(t){if(this.isZero())return bo;if(Ms(t)||(t=Oa(t)),mo){var n=mo.mul(this.low,this.high,t.low,t.high);return hn(n,mo.get_high(),this.unsigned)}if(t.isZero())return bo;if(this.eq(ys))return t.isOdd()?ys:bo;if(t.eq(ys))return this.isOdd()?ys:bo;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(tV)&&t.lt(tV))return yo(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,s=this.low>>>16,o=this.low&65535,a=t.high>>>16,u=t.high&65535,l=t.low>>>16,c=t.low&65535,f=0,h=0,d=0,p=0;return p+=o*c,d+=p>>>16,p&=65535,d+=s*c,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=s*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*c+i*l+s*u+o*a,f&=65535,hn(d<<16|p,f<<16|h,this.unsigned)};Ae.mul=Ae.multiply;Ae.divide=function(t){if(Ms(t)||(t=Oa(t)),t.isZero())throw Error("division by zero");if(mo){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?mo.div_u:mo.div_s)(this.low,this.high,t.low,t.high);return hn(n,mo.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Id:bo;var r,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Id;if(t.gt(this.shru(1)))return uee;s=Id}else{if(this.eq(ys)){if(t.eq(um)||t.eq($M))return ys;if(t.eq(ys))return um;var o=this.shr(1);return r=o.div(t).shl(1),r.eq(bo)?t.isNegative()?um:$M:(i=this.sub(t.mul(r)),s=r.add(i.div(t)),s)}else if(t.eq(ys))return this.unsigned?Id:bo;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=bo}for(i=this;i.gte(t);){r=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),u=a<=48?1:k$(2,a-48),l=yo(r),c=l.mul(t);c.isNegative()||c.gt(i);)r-=u,l=yo(r,this.unsigned),c=l.mul(t);l.isZero()&&(l=um),s=s.add(l),i=i.sub(c)}return s};Ae.div=Ae.divide;Ae.modulo=function(t){if(Ms(t)||(t=Oa(t)),mo){var n=(this.unsigned?mo.rem_u:mo.rem_s)(this.low,this.high,t.low,t.high);return hn(n,mo.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};Ae.mod=Ae.modulo;Ae.rem=Ae.modulo;Ae.not=function(){return hn(~this.low,~this.high,this.unsigned)};Ae.and=function(t){return Ms(t)||(t=Oa(t)),hn(this.low&t.low,this.high&t.high,this.unsigned)};Ae.or=function(t){return Ms(t)||(t=Oa(t)),hn(this.low|t.low,this.high|t.high,this.unsigned)};Ae.xor=function(t){return Ms(t)||(t=Oa(t)),hn(this.low^t.low,this.high^t.high,this.unsigned)};Ae.shiftLeft=function(t){return Ms(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?hn(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):hn(0,this.low<<t-32,this.unsigned)};Ae.shl=Ae.shiftLeft;Ae.shiftRight=function(t){return Ms(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?hn(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):hn(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};Ae.shr=Ae.shiftRight;Ae.shiftRightUnsigned=function(t){if(Ms(t)&&(t=t.toInt()),t&=63,t===0)return this;var n=this.high;if(t<32){var r=this.low;return hn(r>>>t|n<<32-t,n>>>t,this.unsigned)}else return t===32?hn(n,0,this.unsigned):hn(n>>>t-32,0,this.unsigned)};Ae.shru=Ae.shiftRightUnsigned;Ae.shr_u=Ae.shiftRightUnsigned;Ae.toSigned=function(){return this.unsigned?hn(this.low,this.high,!1):this};Ae.toUnsigned=function(){return this.unsigned?this:hn(this.low,this.high,!0)};Ae.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};Ae.toBytesLE=function(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};Ae.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};fn.fromBytes=function(t,n,r){return r?fn.fromBytesLE(t,n):fn.fromBytesBE(t,n)};fn.fromBytesLE=function(t,n){return new fn(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)};fn.fromBytesBE=function(t,n){return new fn(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};const fee=mw(oee),nwe=F2e({__proto__:null,default:fee},[oee]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bd=fee||nwe;function yw(e){return bd.fromString(e,!0,16)}const hee=yw("c3a5c85c97cb3127"),ud=yw("b492b66fbe98f273"),fi=yw("9ae16a3b2f90404f");function kM(e){return e.xor(e.shru(47))}function dee(e,t,n){const r=e.slice(t,t+n);return bd.fromBytes(Array.from(r),!0,!0)}function rn(e,t){return dee(e,t,8)}function nV(e,t){return dee(e,t,4)}function sr(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function hf(e,t,n=yw("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let i=t.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function rwe(e,t,n,r,i,s){i=i.add(e),s=sr(s.add(i).add(r),21);const o=i;return i=i.add(t),i=i.add(n),s=s.add(sr(i,44)),[i.add(r),s.add(o)]}function hS(e,t,n,r){return rwe(rn(e,t),rn(e,t+8),rn(e,t+16),rn(e,t+24),n,r)}function iwe(e,t=e.length){if(t>=8){const n=fi.add(t*2),r=rn(e,0).add(fi),i=rn(e,t-8),s=sr(i,37).mul(n).add(r),o=sr(r,25).add(i).mul(n);return hf(s,o,n)}if(t>=4){const n=fi.add(t*2),r=nV(e,0);return hf(r.shl(3).add(t),nV(e,t-4),n)}if(t>0){const n=e[0],r=e[t>>1],i=e[t-1],s=n+(r<<8),o=t+(i<<2);return kM(fi.mul(s).xor(hee.mul(o))).mul(fi)}return fi}function swe(e,t=e.length){const n=fi.add(t*2),r=rn(e,0).mul(ud),i=rn(e,8),s=rn(e,t-8).mul(n),o=rn(e,t-16).mul(fi);return hf(sr(r.add(i),43).add(sr(s,30)).add(o),r.add(sr(i.add(fi),18)).add(s),n)}function owe(e,t=e.length){const n=fi.add(t*2),r=rn(e,0).mul(fi),i=rn(e,8),s=rn(e,t-8).mul(n),o=rn(e,t-16).mul(fi),a=sr(r.add(i),43).add(sr(s,30)).add(o),u=hf(a,r.add(sr(i.add(fi),18)).add(s),n),l=rn(e,16).mul(n),c=rn(e,24),f=a.add(rn(e,t-32)).mul(n),h=u.add(rn(e,t-24)).mul(n);return hf(sr(l.add(c),43).add(sr(f,30)).add(h),l.add(sr(c.add(r),18)).add(f),n)}function pee(e,t=e.length){const n=bd.fromNumber(81,!0);if(t<=32)return t<=16?iwe(e,t):swe(e,t);if(t<=64)return owe(e,t);let r=n,i=n.mul(ud).add(113),s=kM(i.mul(fi).add(113)).mul(fi),o=[bd.UZERO,bd.UZERO],a=[bd.UZERO,bd.UZERO];r=r.mul(fi).add(rn(e,0));let u=0;const l=(t-1>>6)*64,c=l+(t-1&63)-63;do r=sr(r.add(i).add(o[0]).add(rn(e,u+8)),37).mul(ud),i=sr(i.add(o[1]).add(rn(e,u+48)),42).mul(ud),r=r.xor(a[1]),i=i.add(o[0]).add(rn(e,u+40)),s=sr(s.add(a[0]),33).mul(ud),o=hS(e,u,o[1].mul(ud),r.add(a[0])),a=hS(e,u+32,s.add(a[1]),i.add(rn(e,u+16))),[s,r]=[r,s],u+=64;while(u!==l);const f=ud.add(s.and(255).shl(1));return u=c,a[0]=a[0].add(t-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=sr(r.add(i).add(o[0]).add(rn(e,u+8)),37).mul(f),i=sr(i.add(o[1]).add(rn(e,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(rn(e,u+40))),s=sr(s.add(a[0]),33).mul(f),o=hS(e,u,o[1].mul(f),r.add(a[0])),a=hS(e,u+32,s.add(a[1]),i.add(rn(e,u+16))),[s,r]=[r,s],hf(hf(o[0],a[0],f).add(kM(i).mul(hee)).add(s),hf(o[1],a[1],f).add(r),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fc(e,t){return t==="string"?gu(e):ph([e],t)}function awe(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function ph(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Tu(e)),ae().getBool("DEBUG")&&XQ(e,t),awe(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){const n=new Uint8Array(e.length);for(let r=0;r<n.length;++r)Math.round(e[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${t}`)}function ui(){return ae().platform.now()}function uwe(e,t){return ae().platform.fetch(e,t)}function gu(e,t="utf-8"){return t=t||"utf-8",ae().platform.encode(e,t)}function Jl(e,t="utf-8"){return t=t||"utf-8",ae().platform.decode(e,t)}function or(e){return ae().platform.isTypedArray!=null?ae().platform.isTypedArray(e):see(e)}function Tu(e,t=[],n=!1){if(t==null&&(t=[]),typeof e=="boolean"||typeof e=="number"||typeof e=="string"||CA(e)||e==null||or(e)&&n)t.push(e);else if(Array.isArray(e)||or(e))for(let r=0;r<e.length;++r)Tu(e[r],t,n);else{let r=-1;for(const i of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(i)&&(r=Math.max(r,Number(i)));for(let i=0;i<=r;i++)Tu(e[i],t,n)}return t}const lwe=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:_t,arraysEqualWithNull:qQ,assert:z,assertNonNegativeIntegerDimensions:Ns,assertNonNull:Hp,assertShapesMatch:Nr,bytesFromStringArray:KQ,bytesPerElement:_v,checkConversionForErrors:XQ,clamp:_f,computeStrides:Ue,convertBackendValuesAndArrayBuffer:QQ,createScalarValue:fc,createShuffledIndices:z2e,decodeString:Jl,distSquared:P2e,encodeString:gu,fetch:uwe,fingerPrint64:pee,flatten:Tu,getArrayFromDType:Fn,getTypedArrayFromDType:gr,hasEncodingLoss:B4,hexToLong:yw,indexToLoc:Xp,inferDtype:qp,inferFromImplicitShape:L4,isBoolean:ZQ,isFunction:$f,isInt:ap,isNumber:v$,isPromise:CA,isScalarShape:L2e,isString:cu,isTypedArray:or,isValidDtype:YQ,locToIndex:ba,makeOnesTypedArray:wA,makeZerosNestedTypedArray:z4,makeZerosTypedArray:Ir,nearestDivisor:x$,nearestLargerEven:xA,now:ui,parseAxisParam:dt,randUniform:R2e,repeatedTry:SM,rightPad:Wd,shuffle:P4,shuffleCombo:M2e,sizeFromShape:ce,sizeToSquarishShape:b$,squeezeShape:cc,sum:HQ,swap:Tl,tanh:B2e,toNestedArray:Ao,toTypedArray:ph},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cwe{constructor(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new hwe)}profileKernel(t,n,r){let i;const s=()=>{i=r()};let o;const a=ui();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const l of i)l.dataSync();o=Promise.resolve({kernelMs:ui()-a})}if(ae().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<i.length;l++){const c=i[l];c.data().then(f=>{fwe(f,c.dtype,t)})}return{kernelName:t,outputs:i,inputs:n,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:n,outputs:r,timeMs:i,inputs:s,extraInfo:o}=t;r.forEach(a=>{Promise.all([a.data(),i,o]).then(u=>{this.logger.logKernelProfile(n,a,u[0],u[1],s,u[2])})})}}function fwe(e,t,n){if(t!=="float32")return!1;for(let r=0;r<e.length;r++){const i=e[r];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class hwe{logKernelProfile(t,n,r,i,s,o){const a=typeof i=="number"?Wd(`${i}ms`,9):i.error,u=Wd(t,25),l=n.rank,c=n.size,f=Wd(n.shape.toString(),14);let h="";for(const d in s){const p=s[d];if(p!=null){const m=p.shape||n.shape,g=m.length;h+=`${d}: ${g}D ${g>0?m:""} `}}console.log(`%c${u}	%c${a}	%c${l}D ${f}	%c${c}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dwe(e,t,n){const r={},i={};for(let u=0;u<t.length;u++)r[t[u].id]=!0;for(let u=0;u<e.length;u++){const l=e[u],c=l.inputs;for(const f in c){const h=c[f];let d=!1;for(let p=0;p<t.length;p++)if(r[h.id]){l.outputs.forEach(m=>r[m.id]=!0),d=!0,i[l.id]=!0;break}if(d)break}}const s={};s[n.id]=!0;const o={};for(let u=e.length-1;u>=0;u--){const l=e[u],c=l.inputs;for(let f=0;f<l.outputs.length;f++)if(s[l.outputs[f].id]){for(const h in c)s[c[h].id]=!0,o[l.id]=!0;break}}const a=[];for(let u=0;u<e.length;u++){const l=e[u];if(i[l.id]&&o[l.id]){const c={};for(const h in l.inputs){const d=l.inputs[h];r[d.id]&&(c[h]=d)}const f=Object.assign({},l);f.inputs=c,f.outputs=l.outputs,a.push(f)}}return a}function pwe(e,t,n,r){for(let i=t.length-1;i>=0;i--){const s=t[i],o=[];if(s.outputs.forEach(u=>{const l=e[u.id];l!=null?o.push(l):o.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const u in s.inputs){if(!(u in a))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(a)}.`);const l=n(()=>a[u]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${l.dtype}'`);const c=s.inputs[u];if(!_t(l.shape,c.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${u}' has shape '${l.shape}', which does not match the shape of the input '${c.shape}'`);if(e[c.id]==null)e[c.id]=l;else{const f=e[c.id];e[c.id]=r(f,l),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rV=20,Dy=3,WO=7;function gwe(e,t,n,r){const i=Ue(t),s=mwe(e,t,n,i),o=t.length,a=D_(e,t,n,i,s),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${o}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(a.map(l=>"    "+l).join(`
`)),u.join(`
`)}function mwe(e,t,n,r){const i=ce(t),s=r[r.length-1],o=new Array(s).fill(0),a=t.length,u=n==="complex64"?yb(e):e;if(a>1)for(let l=0;l<i/s;l++){const c=l*s;for(let f=0;f<s;f++)o[f]=Math.max(o[f],mb(u[c+f],0,n).length)}return o}function mb(e,t,n){let r;return Array.isArray(e)?r=`${parseFloat(e[0].toFixed(WO))} + ${parseFloat(e[1].toFixed(WO))}j`:cu(e)?r=`'${e}'`:n==="bool"?r=gee(e):r=parseFloat(e.toFixed(WO)).toString(),Wd(r,t)}function gee(e){return e===0?"false":"true"}function D_(e,t,n,r,i,s=!0){const o=n==="complex64"?2:1,a=t[0],u=t.length;if(u===0){if(n==="complex64"){const m=yb(e);return[mb(m[0],0,n)]}return n==="bool"?[gee(e[0])]:[e[0].toString()]}if(u===1){if(a>rV){const g=Dy*o;let y=Array.from(e.slice(0,g)),b=Array.from(e.slice((a-Dy)*o,a*o));return n==="complex64"&&(y=yb(y),b=yb(b)),["["+y.map((x,v)=>mb(x,i[v],n)).join(", ")+", ..., "+b.map((x,v)=>mb(x,i[a-Dy+v],n)).join(", ")+"]"]}return["["+(n==="complex64"?yb(e):Array.from(e)).map((g,y)=>mb(g,i[y],n)).join(", ")+"]"]}const l=t.slice(1),c=r.slice(1),f=r[0]*o,h=[];if(a>rV){for(let m=0;m<Dy;m++){const g=m*f,y=g+f;h.push(...D_(e.slice(g,y),l,n,c,i,!1))}h.push("...");for(let m=a-Dy;m<a;m++){const g=m*f,y=g+f;h.push(...D_(e.slice(g,y),l,n,c,i,m===a-1))}}else for(let m=0;m<a;m++){const g=m*f,y=g+f;h.push(...D_(e.slice(g,y),l,n,c,i,m===a-1))}const d=u===2?",":"";h[0]="["+(a>0?h[0]+d:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+d;let p=`,
`;for(let m=2;m<u;m++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(s?"":p),h}function yb(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gn{constructor(t,n,r){if(this.dtype=n,this.shape=t.slice(),this.size=ce(t),r!=null){const i=r.length;z(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Fn(n,this.size),this.strides=Ue(t)}set(t,...n){n.length===0&&(n=[0]),z(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const r=this.locToIndex(n);this.values[r]=t}get(...t){t.length===0&&(t=[0]);let n=0;for(const i of t){if(i<0||i>=this.shape[n]){const s=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(s)}n++}let r=t[t.length-1];for(let i=0;i<t.length-1;++i)r+=this.strides[i]*t[i];return this.values[r]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let n=t[t.length-1];for(let r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const n=new Array(this.shape.length);for(let r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n}get rank(){return this.shape.length}toTensor(){return oa().makeTensor(this.values,this.shape,this.dtype)}}let oa=null,im=null;function ywe(e){oa=e}function bwe(e){im=e}class Vt{constructor(t,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=ce(t),this.strides=Ue(t),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return im.buffer(this.shape,this.dtype,t)}bufferSync(){return im.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return Ao(this.shape,t,this.dtype==="complex64")}arraySync(){return Ao(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=oa().read(this.dataId);if(this.dtype==="string"){const n=await t;try{return n.map(r=>Jl(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),oa().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=oa().readSync(this.dataId);if(this.dtype==="string")try{return t.map(n=>Jl(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await oa().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(oa().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return im.print(this,t)}clone(){return this.throwIfDisposed(),im.clone(this)}toString(t=!1){const n=this.dataSync();return gwe(n,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),im.cast(this,t)}variable(t=!0,n,r){return this.throwIfDisposed(),oa().makeVariable(this,t,n,r)}}Object.defineProperty(Vt,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function fe(){return U4("Tensor",()=>Vt)}fe();class Tv extends Vt{constructor(t,n,r,i){super(t.shape,t.dtype,t.dataId,i),this.trainable=n,this.name=r}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!_t(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);oa().disposeTensor(this),this.dataId=t.dataId,oa().incRef(this,null)}dispose(){oa().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Tv,Symbol.hasInstance,{value:e=>e instanceof Vt&&e.assign!=null&&e.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var EM;(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(EM||(EM={}));var AM;(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(AM||(AM={}));var TM;(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(TM||(TM={}));var DM;(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(DM||(DM={}));var IM;(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(IM||(IM={}));const vwe={float32:DM,int32:AM,bool:TM,complex64:IM};function Hi(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return vwe[e][t]}function AT(e){return Hi(e,"int32")}function mee(e){return e!=null&&typeof e=="object"&&"texture"in e&&e.texture instanceof WebGLTexture}function yee(e){return typeof GPUBuffer<"u"&&e!=null&&typeof e=="object"&&"buffer"in e&&e.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function An(e,t){if(e.dtype===t.dtype)return[e,t];const n=Hi(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function bee(e,t){z(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function xwe(e,t){return t.some(n=>n.id===e.id)}function H4(e){const t=[];return vee(e,t,new Set),t}function vee(e,t,n){if(e==null)return;if(e instanceof Vt){t.push(e);return}if(!wwe(e))return;const r=e;for(const i in r){const s=r[i];n.has(s)||(n.add(s),vee(s,t,n))}}function wwe(e){return Array.isArray(e)||typeof e=="object"}const Cwe=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:bee,getTensorsInContainer:H4,isTensorInList:xwe,makeTypesMatch:An},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VO(e){return e.kernelName!=null}class iV{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Nm{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new iV}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const r=t[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,r=1){return t in this.registryFactory?(js(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:r},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:n,asyncInit:r}=this.initializeBackend(t);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new cwe(this.backendInstance),!0}setupRegisteredKernels(){$$(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){$$(t).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[t])})}initializeBackend(t){const n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const r=n.factory();if(r&&!(r instanceof vA)&&typeof r.then=="function"){const i=++this.pendingBackendInitId,s=r.then(o=>i<this.pendingBackendInitId?!1:(this.registry[t]=o,this.pendingBackendInit=null,!0)).catch(o=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,js(`Initialization of backend ${t} failed`),js(o.stack||o.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(r){return js(`Initialization of backend ${t} failed`),js(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const r=t[n],{success:i,asyncInit:s}=this.initializeBackend(r);if(s||i)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){const r=this.state.tensorInfo.get(n),i=r.backend,s=this.readSync(n),o=i.refCount(n);i.disposeData(n,!0),r.backend=t,t.move(n,s,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let r=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}let i;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(t,n,r){t();try{const i=r();return n(),i}catch(i){throw n(),i}}nextTensorId(){return Nm.nextTensorId++}nextVariableId(){return Nm.nextVariableId++}clone(t){const n=K.runKernel(t1,{x:t}),r={x:t},i=o=>({x:()=>{const a="float32",u={x:o},l={dtype:a};return K.runKernel(U0,u,l)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[n],i,s,{}),n}runKernel(t,n,r){if(this.backendName==null&&this.backend,!(_$(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,r){const i=this.backend.numDataIds();let s=0;r.forEach(u=>{s+=u.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-s-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let n,r=[];const i=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let u;const l=VO(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(VO(t)){const{kernelName:p,inputs:m,attrs:g}=t;this.backendName==null&&this.backend;const y=_$(p,this.backendName);z(y!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();u=y.kernelFunc({inputs:m,attrs:g,backend:this.backend});const x=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,b,x);const v=x.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(i){const w=this.getTensorsForGradient(p,m,v);r=this.saveTensorsForBackwardMode(w)}return v}}else{const{forwardFunc:p}=t,m=g=>{i&&(r=g.map(y=>this.keep(this.clone(y))))};a=()=>{const g=this.backend.numDataIds();u=this.tidy(()=>p(this.backend,m));const y=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,g,y),y}}const{inputs:c,attrs:f}=t,h=VO(t)?null:t.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(d=this.profiler.profileKernel(l,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),n=d.outputs)}),i&&this.addTapeNode(l,c,n,h,r,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(u)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(t,n,r){const i=_M(t);if(i!=null){const s=i.inputsToSave||[],o=i.outputsToSave||[];let a;i.saveAllInputs?(z(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(l=>n[l])):a=s.map(l=>n[l]);const u=r.filter((l,c)=>o[c]);return a.concat(u)}return[]}makeTensor(t,n,r,i){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;let s=t;r==="string"&&cu(t[0])&&(s=t.map(u=>gu(u)));const o=i.write(s,n,r),a=new Vt(n,r,o,this.nextTensorId());if(this.trackTensor(a,i),r==="string"){const u=this.state.tensorInfo.get(o),l=KQ(s);this.state.numBytes+=l-u.bytes,u.bytes=l}return a}makeTensorFromDataId(t,n,r,i){r=r||"float32";const s={dataId:t,shape:n,dtype:r};return this.makeTensorFromTensorInfo(s,i)}makeTensorFromTensorInfo(t,n){const{dataId:r,shape:i,dtype:s}=t,o=new Vt(i,s,r,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(t,n=!0,r,i){r=r||this.nextVariableId().toString(),i!=null&&i!==t.dtype&&(t=t.cast(i));const s=new Tv(t,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=t.size*_v(t.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:r})),t instanceof Tv||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const r=t.size*_v(t.dtype);this.state.numBytes-=r}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,r,i,s,o){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:s},u=_M(t);u!=null&&(i=u.gradFunc),i!=null&&(a.gradient=l=>(l=l.map((c,f)=>{if(c==null){const h=r[f],d=Ir(h.size,h.dtype);return this.makeTensor(d,h.shape,h.dtype)}return c}),i(l.length>1?l:l[0],s,o))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){const n=H4(t),r=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){const o=this.state.activeScope.track[s];!o.kept&&!r.has(o.id)&&o.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(t,n,r,i=!1){if(z(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));z(s instanceof Vt,()=>"The result y returned by f() must be a tensor.");const o=dwe(this.state.activeTape,n,s);if(!i&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[s.id]=r??Swe(s.shape),pwe(a,o,l=>this.tidy(l),_we);const u=n.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const c of l.saved)c.dispose()}),this.state.activeTape=null),{value:s,grads:u}})}customGrad(t){return z($f(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{z(n.every(a=>a instanceof Vt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const i={};n.forEach((a,u)=>{i[u]=a});const s=(a,u)=>(r=t(...n,u),z(r.value instanceof Vt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),z($f(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,u)=>{const l=r.gradFunc(a,u),c=Array.isArray(l)?l:[l];z(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),z(c.every(h=>h instanceof Vt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return c.forEach((h,d)=>{f[d]=()=>h}),f};return this.runKernelFunc({forwardFunc:s,backwardsFunc:o,inputs:i})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){const n=ui(),r=await this.backend.time(t);return r.wallMs=ui()-n,r}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new iV;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Nm.nextTensorId=0;Nm.nextVariableId=0;function Swe(e){const t=wA(ce(e),"float32");return K.makeTensor(t,e,"float32")}function xee(){const e=tee();if(e._tfengine==null){const t=new eee(e);e._tfengine=new Nm(t)}return V2e(e._tfengine.ENV),ywe(()=>e._tfengine),e._tfengine}const K=xee();function _we(e,t){const n={a:e,b:t};return K.runKernel(Yp,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $we(){return typeof navigator<"u"&&navigator!=null}let FM;function kwe(e){FM=e}function q4(e){if(FM!==void 0)return FM;if(e||$we()){if(e||(e=navigator),e.product==="ReactNative")return!0;const t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){const n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function X4(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const Ewe=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:X4,isMobile:q4,mockIsMobile:kwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qi=ae();qi.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});qi.registerFlag("IS_BROWSER",()=>X4());qi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");qi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));qi.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));qi.registerFlag("PROD",()=>!1);qi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>qi.getBool("DEBUG"));qi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);qi.registerFlag("IS_TEST",()=>!1);qi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>qi.getBool("DEBUG"));qi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);qi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);qi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Du(e,t){let n=e;if(or(e))return t==="string"?[]:[e.length];if(mee(e)){const i=e.channels||"RGBA";return[e.height,e.width*i.length]}else if(yee(e))return[e.buffer.size/(t==null?4:_v(t))];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||or(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&ae().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&wee(e,r,[]),r}function wee(e,t,n){if(n=n||[],!Array.isArray(e)&&!or(e)){z(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}z(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),z(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);const r=t.slice(1);for(let i=0;i<e.length;++i)wee(e[i],r,n.concat(i))}function sV(e,t,n,r){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function W(e,t,n,r="numeric"){if(e instanceof Vt)return sV(r,e.dtype,t,n),e;let i=qp(e);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),sV(r,i,t,n),e==null||!or(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){const u=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${u}'`)}const s=Du(e,i);!or(e)&&!Array.isArray(e)&&(e=[e]);const a=i!=="string"?ph(e,i):Tu(e,[],!0);return K.makeTensor(a,s,i)}function Dv(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((s,o)=>W(s,`${t}[${o}]`,n,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cee="__op";function J(e){const t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+Cee;const i=(...s)=>{K.startScope(n);try{const o=r(...s);return CA(o)&&console.error("Cannot return a Promise inside of tidy."),K.endScope(o),o}catch(o){throw K.endScope(null),o}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Awe(e,t){const n=W(e,"real","complex"),r=W(t,"imag","complex");Nr(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return K.runKernel(TA,i)}const kf=J({complex_:Awe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gh(e,t,n,r){if(r==null)r=qp(e);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(yee(e)||mee(e)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return K.backend.createTensorFromGPUData(e,t||n,r)}if(!or(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Ns(t);const i=ce(t),s=ce(n);z(i===s,()=>`Based on the provided shape, [${t}], the tensor should have ${i} values but has ${s}`);for(let o=0;o<n.length;++o){const a=n[o],u=o===n.length-1?a!==ce(t.slice(o)):!0;z(n[o]===t[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!or(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e=r!=="string"?ph(e,r):Tu(e,[],!0),K.makeTensor(e,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gd(e,t,n){const r=Du(e,n);return gh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OM={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Hu{static join(t){return new Hu(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(r=>or(r)?r.buffer:r),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let n=0;for(let r=0;r<t.length;r++){const i=t[r];r!==t.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const s=n+i.byteLength;this.shards.push({buffer:i,start:n,end:s}),n=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,n=isNaN(Number(n))?0:n,t=Math.max(0,t),n=Math.min(this.byteLength,n),n<=t)return new ArrayBuffer(0);const r=this.findShardForByte(t);if(r===-1)throw new Error(`Could not find start shard for byte ${t}`);const i=n-t,s=new ArrayBuffer(i),o=new Uint8Array(s);let a=0;for(let u=r;u<this.shards.length;u++){const l=this.shards[u],f=t+a-l.start,h=a,p=Math.min(n,l.end)-l.start,m=new Uint8Array(l.buffer,f,p-f);if(o.set(m,h),a+=m.length,n<l.end)break}return s}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function n(i){return t<i.start?-1:t>=i.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=Twe(this.shards,n);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function Twe(e,t){let n=0,r=e.length;for(;n<=r;){const i=Math.floor((r-n)/2)+n,s=t(e[i]);if(s===0)return i;s<0?r=i:n=i+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E$=4;async function NM(e,t){const n=[],r=[],i=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);for(let o=0;o<i.length;++o){const a=i[o],u=Array.isArray(e)?e[o].tensor:e[a];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${u.dtype}`);const l={name:a,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const c=new Promise(async f=>{const h=await u.bytes(),d=h.reduce((g,y)=>g+y.length,0)+E$*h.length,p=new Uint8Array(d);let m=0;for(let g=0;g<h.length;g++){const y=h[g],b=new Uint8Array(new Uint32Array([y.length]).buffer);p.set(b,m),m+=E$,p.set(y,m),m+=y.length}f(p)});r.push(c)}else r.push(u.data());t!=null&&(l.group=t),n.push(l)}const s=await Promise.all(r);return{data:Dwe(s),specs:n}}function Y4(e,t){const n=new Hu(e),r={};let i,s=0;for(const o of t){const a=o.name,u=o.dtype,l=o.shape,c=ce(l);let f;if("quantization"in o){const h=o.quantization;if(h.dtype==="uint8"||h.dtype==="uint16"){if(!("min"in h&&"scale"in h))throw new Error(`Weight ${o.name} with quantization ${h.dtype} doesn't have corresponding metadata min and scale.`)}else if(h.dtype==="float16"){if(u!=="float32")throw new Error(`Weight ${o.name} is quantized with ${h.dtype} which only supports weights of type float32 not ${u}.`)}else throw new Error(`Weight ${o.name} has unknown quantization dtype ${h.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const d=OM[h.dtype],p=n.slice(s,s+c*d),m=h.dtype==="uint8"?new Uint8Array(p):new Uint16Array(p);if(u==="float32")if(h.dtype==="uint8"||h.dtype==="uint16"){f=new Float32Array(m.length);for(let g=0;g<m.length;g++){const y=m[g];f[g]=y*h.scale+h.min}}else if(h.dtype==="float16")i===void 0&&(i=Rwe()),f=i(m);else throw new Error(`Unsupported quantization type ${h.dtype} for weight type float32.`);else if(u==="int32"){if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error(`Unsupported quantization type ${h.dtype} for weight type int32.`);f=new Int32Array(m.length);for(let g=0;g<m.length;g++){const y=m[g];f[g]=Math.round(y*h.scale+h.min)}}else throw new Error(`Unsupported dtype in weight '${a}': ${u}`);s+=c*d}else if(u==="string"){const h=ce(o.shape);f=[];for(let d=0;d<h;d++){const p=new Uint32Array(n.slice(s,s+E$))[0];s+=E$;const m=new Uint8Array(n.slice(s,s+p));f.push(m),s+=p}}else{const h=OM[u],d=n.slice(s,s+c*h);if(u==="float32")f=new Float32Array(d);else if(u==="int32")f=new Int32Array(d);else if(u==="bool")f=new Uint8Array(d);else if(u==="complex64"){f=new Float32Array(d);const p=new Float32Array(f.length/2),m=new Float32Array(f.length/2);for(let b=0;b<p.length;b++)p[b]=f[b*2],m[b]=f[b*2+1];const g=Gd(p,l,"float32"),y=Gd(m,l,"float32");r[a]=kf(g,y),g.dispose(),y.dispose()}else throw new Error(`Unsupported dtype in weight '${a}': ${u}`);s+=c*h}u!=="complex64"&&(r[a]=Gd(f,l,u))}return r}function Dwe(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach(s=>{if(t+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});const r=new Uint8Array(t);let i=0;return n.forEach(s=>{r.set(new Uint8Array(s.buffer),i),i+=s.byteLength}),r.buffer}const K4=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function oV(e){return K4?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function Iwe(e){if(K4)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Fwe(e){if(K4){const r=Buffer.from(e,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function See(e){return Hu.join(e)}function aV(e){const t="/";for(e=e.trim();e.endsWith(t);)e=e.slice(0,e.length-1);const n=e.split(t);return n[n.length-1]}function _ee(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(n.initializerSignature=e.initializerSignature),e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),n}function $ee(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(e.trainingConfig!=null&&(r.trainingConfig=e.trainingConfig),e.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return e.signature!=null&&(r.signature=e.signature),e.userDefinedMetadata!=null&&(r.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(r.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(r.initializerSignature=e.initializerSignature),r}async function Z4(e,t){let n,r;return e.weightsManifest!=null&&([n,r]=await t(e.weightsManifest)),$ee(e,n,r)}function bw(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:oV(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:oV(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:new Hu(e.weightData).byteLength}}function kee(e){const t=[];for(const n of e)t.push(...n.weights);return t}function Owe(){const e=n=>{let r=n<<13,i=0;for(;!(r&8388608);)i-=8388608,r<<=1;return r&=-8388609,i+=947912704,r|i},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}function Nwe(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function Mwe(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function Rwe(){const e=Owe(),t=Nwe(),n=Mwe();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let o=0;o<r.length;o++){const a=r[o],u=e[n[a>>10]+(a&1023)]+t[a>>10];s[o]=u}return new Float32Array(i)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _n{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return _n.instance==null&&(_n.instance=new _n),_n.instance}static registerSaveRouter(t){_n.getInstance().saveRouters.push(t)}static registerLoadRouter(t){_n.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return _n.getHandlers(t,"save")}static getLoadHandlers(t,n){return _n.getHandlers(t,"load",n)}static getHandlers(t,n,r){const i=[];return(n==="load"?_n.getInstance().loadRouters:_n.getInstance().saveRouters).forEach(o=>{const a=o(t,r);a!==null&&i.push(a)}),i}}const Pwe=e=>_n.registerSaveRouter(e),Lwe=e=>_n.registerLoadRouter(e),Eee=e=>_n.getSaveHandlers(e),Aee=(e,t)=>_n.getLoadHandlers(e,t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MM="tensorflowjs",RM=1,Fd="models_store",qc="model_info_store";function Tee(){if(!ae().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function PM(e){const t=e.result;t.createObjectStore(Fd,{keyPath:"modelPath"}),t.createObjectStore(qc,{keyPath:"modelPath"})}class up{constructor(t){if(this.indexedDB=Tee(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,n){return new Promise((r,i)=>{const s=this.indexedDB.open(MM,RM);s.onupgradeneeded=()=>PM(s),s.onsuccess=()=>{const o=s.result;if(n==null){const a=o.transaction(Fd,"readonly"),l=a.objectStore(Fd).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(l.result.modelArtifacts)},l.onerror=c=>(o.close(),i(l.error)),a.oncomplete=()=>o.close()}else{const a=bw(n),u=o.transaction(qc,"readwrite");let l=u.objectStore(qc),c;try{c=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return i(h)}let f;c.onsuccess=()=>{f=o.transaction(Fd,"readwrite");const h=f.objectStore(Fd);let d;try{d=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return i(p)}d.onsuccess=()=>r({modelArtifactsInfo:a}),d.onerror=p=>{l=u.objectStore(qc);const m=l.delete(this.modelPath);m.onsuccess=()=>(o.close(),i(d.error)),m.onerror=g=>(o.close(),i(d.error))}},c.onerror=h=>(o.close(),i(c.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},s.onerror=o=>i(s.error)})}}up.URL_SCHEME="indexeddb://";const Dee=e=>ae().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(up.URL_SCHEME)?Bwe(e.slice(up.URL_SCHEME.length)):null;_n.registerSaveRouter(Dee);_n.registerLoadRouter(Dee);function Bwe(e){return new up(e)}function zwe(e){return e.startsWith(up.URL_SCHEME)?e.slice(up.URL_SCHEME.length):e}class jwe{constructor(){this.indexedDB=Tee()}async listModels(){return new Promise((t,n)=>{const r=this.indexedDB.open(MM,RM);r.onupgradeneeded=()=>PM(r),r.onsuccess=()=>{const i=r.result,s=i.transaction(qc,"readonly"),a=s.objectStore(qc).getAll();a.onsuccess=()=>{const u={};for(const l of a.result)u[l.modelPath]=l.modelArtifactsInfo;t(u)},a.onerror=u=>(i.close(),n(a.error)),s.oncomplete=()=>i.close()},r.onerror=i=>n(r.error)})}async removeModel(t){return t=zwe(t),new Promise((n,r)=>{const i=this.indexedDB.open(MM,RM);i.onupgradeneeded=()=>PM(i),i.onsuccess=()=>{const s=i.result,o=s.transaction(qc,"readwrite"),a=o.objectStore(qc),u=a.get(t);let l;u.onsuccess=()=>{if(u.result==null)return s.close(),r(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const c=a.delete(t),f=()=>{l=s.transaction(Fd,"readwrite");const d=l.objectStore(Fd).delete(t);d.onsuccess=()=>n(u.result.modelArtifactsInfo),d.onerror=p=>r(u.error)};c.onsuccess=f,c.onerror=h=>(f(),s.close(),r(u.error))}},u.onerror=c=>(s.close(),r(u.error)),o.oncomplete=()=>{l==null?s.close():l.oncomplete=()=>s.close()}},i.onerror=s=>r(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dl="/",sm="tensorflowjs_models",Iee="info",Uwe="model_topology",Wwe="weight_specs",Vwe="weight_data",Gwe="model_metadata";function Fee(e){return{info:[sm,e,Iee].join(Dl),topology:[sm,e,Uwe].join(Dl),weightSpecs:[sm,e,Wwe].join(Dl),weightData:[sm,e,Vwe].join(Dl),modelMetadata:[sm,e,Gwe].join(Dl)}}function Oee(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function Hwe(e){const t=e.split(Dl);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Dl)}function qwe(e){return e.startsWith(lp.URL_SCHEME)?e.slice(lp.URL_SCHEME.length):e}class lp{constructor(t){if(!ae().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Fee(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),i=bw(t),s=Hu.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Iwe(s));const o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:i}}catch{throw Oee(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=r;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){const a=JSON.parse(s);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=Fwe(o),n}}lp.URL_SCHEME="localstorage://";const Nee=e=>ae().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(lp.URL_SCHEME)?Xwe(e.slice(lp.URL_SCHEME.length)):null;_n.registerSaveRouter(Nee);_n.registerLoadRouter(Nee);function Xwe(e){return new lp(e)}class Ywe{constructor(){z(ae().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),z(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},n=sm+Dl,r=Dl+Iee;for(let i=0;i<this.LS.length;++i){const s=this.LS.key(i);if(s.startsWith(n)&&s.endsWith(r)){const o=Hwe(s);t[o]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){t=qwe(t);const n=Fee(t);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return Oee(n),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mm="://";class li{constructor(){this.managers={}}static getInstance(){return li.instance==null&&(li.instance=new li),li.instance}static registerManager(t,n){z(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(mm)&&(t=t.slice(0,t.indexOf(mm))),z(t.length>0,()=>"scheme must not be an empty string.");const r=li.getInstance();z(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=n}static getManager(t){const n=li.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(li.getInstance().managers)}}function I_(e){if(e.indexOf(mm)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${li.getSchemes().join(",")}`);return{scheme:e.split(mm)[0],path:e.split(mm)[1]}}async function Mee(e,t,n=!1){z(e!==t,()=>`Old path and new path are the same: '${e}'`);const r=_n.getLoadHandlers(e);z(r.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),z(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`);const i=r[0],s=_n.getSaveHandlers(t);z(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),z(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);const o=s[0],a=I_(e).scheme,u=I_(e).path,l=a===I_(e).scheme,c=await i.load();n&&l&&await li.getManager(a).removeModel(u);const f=await o.save(c);return n&&!l&&await li.getManager(a).removeModel(u),f.modelArtifactsInfo}async function Kwe(){const e=li.getSchemes(),t={};for(const n of e){const r=await li.getManager(n).listModels();for(const i in r){const s=n+mm+i;t[s]=r[i]}}return t}async function Zwe(e){const t=I_(e);return li.getManager(t.scheme).removeModel(t.path)}async function Jwe(e,t){return Mee(e,t,!1)}async function Qwe(e,t){return Mee(e,t,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eCe{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,n){return fetch(t,n)}now(){return performance.now()}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,n){return new TextDecoder(n).decode(t)}setTimeoutCustom(t,n){if(typeof window>"u"||!ae().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,n);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const i=this.functionRefs[r.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return see(t)}}if(ae().get("IS_BROWSER")){ae().setPlatform("browser",new eCe);try{li.registerManager(lp.URL_SCHEME,new Ywe)}catch{}try{li.registerManager(up.URL_SCHEME,new jwe)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tCe={importFetch:()=>require("node-fetch")};let GO;class nCe{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,n){return ae().global.fetch!=null?ae().global.fetch(t,n):(GO==null&&(GO=tCe.importFetch()),GO(t,n))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(t)}decode(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}ae().get("IS_NODE")&&!ae().get("IS_BROWSER")&&ae().setPlatform("node",new nCe);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ft(e,t="float32",n){return t=t||"float32",Ns(e),new Gn(e,t,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rCe(e,t){const n=W(e,"x","cast");if(!YQ(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:t};return K.runKernel(U0,r,i)}const Ee=J({cast_:rCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iCe(e){const n={x:W(e,"x","clone","string_or_numeric")};return K.runKernel(t1,n)}const df=J({clone_:iCe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ree(e,t=!1){console.log(e.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xee();const sCe={buffer:ft,cast:Ee,clone:df,print:Ree};bwe(sCe);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oCe(){ae().set("PROD",!0)}function aCe(){ae().set("DEBUG",!0)}function uCe(){ae().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function lCe(e){ae().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function cCe(){K.disposeVariables()}function ra(){return K}function A$(){return K.memory()}function fCe(e){return K.profile(e)}function ue(e,t){return K.tidy(e,t)}function ct(e){H4(e).forEach(n=>n.dispose())}function va(e){return K.keep(e)}function hCe(e){return K.time(e)}function dCe(e){return K.setBackend(e)}function pCe(){return K.ready()}function gCe(){return K.backendName}function mCe(e){K.removeBackend(e)}function yCe(e){return K.findBackend(e)}function bCe(e){return K.findBackendFactory(e)}function J4(e,t,n=1){return K.registerBackend(e,t,n)}function Pee(){return K.backend}function vCe(e,t){ae().setPlatform(e,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xCe(e,t){let n=W(e,"a","add"),r=W(t,"b","add");[n,r]=An(n,r);const i={a:n,b:r};return K.runKernel(Yp,i)}const be=J({add_:xCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wCe(e,t){let n=W(e,"a","floorDiv"),r=W(t,"b","floorDiv");[n,r]=An(n,r);const i={a:n,b:r};return K.runKernel(Q0,i)}const Q4=J({floorDiv_:wCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CCe(e,t){let n=W(e,"a","div"),r=W(t,"b","div");if([n,r]=An(n,r),n.dtype==="int32"&&r.dtype==="int32")return Q4(n,r);const i={a:n,b:r},s={};return K.runKernel(q0,i,s)}const je=J({div_:CCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SCe(e,t){let n=W(e,"a","mul"),r=W(t,"b","mul");[n,r]=An(n,r);const i={a:n,b:r};return K.runKernel(c1,i)}const Q=J({mul_:SCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ce(e){const t=W(e,"x","abs");if(t.dtype==="complex64"){const n={x:t};return K.runKernel(C2,n)}else{const n={x:t};return K.runKernel(d2,n)}}const Yn=J({abs_:_Ce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ce(e){const n={x:W(e,"x","acos")};return K.runKernel(M0,n)}const Lee=J({acos_:$Ce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kCe(e){const n={x:W(e,"x","acosh")};return K.runKernel(R0,n)}const Bee=J({acosh_:kCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ECe(e){z(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),z(e.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`);const t=e.map((i,s)=>W(i,`tensors${s}`,"addN")),n=t[0];t.forEach(i=>{if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(i=>{if(!_t(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=t;return K.runKernel(p2,r)}const ACe=J({addN_:ECe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TCe(e,t=null,n=!1){const i={x:W(e,"x","all","bool")},s={axis:t,keepDims:n};return K.runKernel(SA,i,s)}const eB=J({all_:TCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DCe(e,t=null,n=!1){const i={x:W(e,"x","any","bool")},s={axis:t,keepDims:n};return K.runKernel(_A,i,s)}const T$=J({any_:DCe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ICe(e,t=0){const r={x:W(e,"x","argMax")},i={axis:t};return K.runKernel(g2,r,i)}const Mm=J({argMax_:ICe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FCe(e,t=0){const r={x:W(e,"x","argMin")},i={axis:t};return K.runKernel(m2,r,i)}const zee=J({argMin_:FCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OCe(e){const n={x:W(e,"x","asin")};return K.runKernel(P0,n)}const jee=J({asin_:OCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NCe(e){const n={x:W(e,"x","asinh")};return K.runKernel(L0,n)}const Uee=J({asinh_:NCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MCe(e){const n={x:W(e,"x","atan")};return K.runKernel(B0,n)}const Wee=J({atan_:MCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RCe(e,t){let n=W(e,"a","atan2"),r=W(t,"b","atan2");[n,r]=An(n,r);const i={a:n,b:r};return K.runKernel(j0,i)}const Vee=J({atan2_:RCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PCe(e){const n={x:W(e,"x","atanh")};return K.runKernel(z0,n)}const Gee=J({atanh_:PCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vw(e,t,n,r,i="NHWC",s){const o=e[3],a=[...t,o],u=dc(i);return mr(e,a,n,s,r,null,null,u)}function jo(e,t,n,r,i,s,o="channelsLast"){const[a,u]=Iv(t);let l;if(o==="channelsLast")l=[a,u,e[3],e[3]];else if(o==="channelsFirst")l=[a,u,e[1],e[1]];else throw new Error(`Unknown dataFormat ${o}`);return mr(e,l,n,r,i,s,!1,o)}function hc(e,t,n,r,i,s,o="NDHWC"){const[a,u,l]=LM(t);let c,f;if(o==="NDHWC")f="channelsLast",c=[a,u,l,e[4],e[4]];else if(o==="NCDHW")f="channelsFirst",c=[a,u,l,e[1],e[1]];else throw new Error(`Unknown dataFormat ${o}`);return mh(e,c,n,r,i,!1,f,s)}function mr(e,t,n,r,i,s,o=!1,a="channelsLast"){let[u,l,c,f]=[-1,-1,-1,-1];if(a==="channelsLast")[u,l,c,f]=e;else if(a==="channelsFirst")[u,f,l,c]=e;else throw new Error(`Unknown dataFormat ${a}`);const[h,d,,p]=t,[m,g]=Iv(n),[y,b]=Iv(r),x=ym(h,y),v=ym(d,b),{padInfo:w,outHeight:C,outWidth:S}=zCe(i,l,c,m,g,x,v,s,a),_=o?p*f:p;let $;return a==="channelsFirst"?$=[u,_,C,S]:a==="channelsLast"&&($=[u,C,S,_]),{batchSize:u,dataFormat:a,inHeight:l,inWidth:c,inChannels:f,outHeight:C,outWidth:S,outChannels:_,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:h,filterWidth:d,effectiveFilterHeight:x,effectiveFilterWidth:v,dilationHeight:y,dilationWidth:b,inShape:e,outShape:$,filterShape:t}}function mh(e,t,n,r,i,s=!1,o="channelsLast",a){let[u,l,c,f,h]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[u,l,c,f,h]=e;else if(o==="channelsFirst")[u,h,l,c,f]=e;else throw new Error(`Unknown dataFormat ${o}`);const[d,p,m,,g]=t,[y,b,x]=LM(n),[v,w,C]=LM(r),S=ym(d,v),_=ym(p,w),$=ym(m,C),{padInfo:k,outDepth:E,outHeight:F,outWidth:T}=jCe(i,l,c,f,y,b,x,S,_,$,a),I=s?g*h:g;let D;return o==="channelsFirst"?D=[u,I,E,F,T]:o==="channelsLast"&&(D=[u,E,F,T,I]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:c,inWidth:f,inChannels:h,outDepth:E,outHeight:F,outWidth:T,outChannels:I,padInfo:k,strideDepth:y,strideHeight:b,strideWidth:x,filterDepth:d,filterHeight:p,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:_,effectiveFilterWidth:$,dilationDepth:v,dilationHeight:w,dilationWidth:C,inShape:e,outShape:D,filterShape:t}}function LCe(e,t,n,r,i){r==null&&(r=tB(e,t,n));const s=e[0],o=e[1],a=Fv((s-t+2*r)/n+1,i),u=Fv((o-t+2*r)/n+1,i);return[a,u]}function BCe(e,t,n,r,i,s){i==null&&(i=tB(e,t[0],r[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)e[a]+2*i>=t[a]&&(o[a]=Fv((e[a]-t[a]+2*i)/r[a]+1,s));return o}function tB(e,t,n,r=1){const i=ym(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function Iv(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function LM(e){return typeof e=="number"?[e,e,e]:e}function ym(e,t){return t<=1?e:e+(e-1)*(t-1)}function zCe(e,t,n,r,i,s,o,a,u){let l,c,f;if(typeof e=="number"){l={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};const d=LCe([t,n],s,r,e,a);c=d[0],f=d[1]}else if(e==="same"){c=Math.ceil(t/r),f=Math.ceil(n/i);const h=Math.max(0,(c-1)*r+s-t),d=Math.max(0,(f-1)*i+o-n),p=Math.floor(h/2),m=h-p,g=Math.floor(d/2),y=d-g;l={top:p,bottom:m,left:g,right:y,type:"SAME"}}else if(e==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-s+1)/r),f=Math.ceil((n-o+1)/i);else if(typeof e=="object"){const h=u==="channelsLast"?e[1][0]:e[2][0],d=u==="channelsLast"?e[1][1]:e[2][1],p=u==="channelsLast"?e[2][0]:e[3][0],m=u==="channelsLast"?e[2][1]:e[3][1];l={top:h,bottom:d,left:p,right:m,type:h===0&&d===0&&p===0&&m===0?"VALID":"EXPLICIT"},c=Fv((t-s+h+d)/r+1,a),f=Fv((n-o+p+m)/i+1,a)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:l,outHeight:c,outWidth:f}}function jCe(e,t,n,r,i,s,o,a,u,l,c){let f,h,d,p;if(e==="valid"&&(e=0),typeof e=="number"){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};const g=BCe([t,n,r,1],[a,u,l],1,[i,s,o],e,c);h=g[0],d=g[1],p=g[2]}else if(e==="same"){h=Math.ceil(t/i),d=Math.ceil(n/s),p=Math.ceil(r/o);const m=(h-1)*i+a-t,g=(d-1)*s+u-n,y=(p-1)*o+l-r,b=Math.floor(m/2),x=m-b,v=Math.floor(g/2),w=g-v,C=Math.floor(y/2),S=y-C;f={top:v,bottom:w,left:C,right:S,front:b,back:x,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:f,outDepth:h,outHeight:d,outWidth:p}}function Fv(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function Ef(e){const[t,n,r]=Iv(e);return t===1&&n===1&&r===1}function Mr(e,t){return Ef(e)||Ef(t)}function cp(e){return Iv(e).every(t=>t>0)}function dc(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function Ti(e,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")z(ap(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(r=>{r.forEach(i=>{z(ap(i),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UCe(e,t){const r={x:W(e,"x","reshape","string_or_numeric")},i={shape:t};return K.runKernel(nw,r,i)}const ne=J({reshape_:UCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WCe(e,t,n,r,i){const s=W(e,"x","avgPool","float32"),o=1;z(Mr(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=s,u=!1;s.rank===3&&(u=!0,a=ne(s,[1,s.shape[0],s.shape[1],s.shape[2]])),z(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ti("avgPool",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i};let f=K.runKernel(y2,l,c);return f=Ee(f,s.dtype),u?ne(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const TT=J({avgPool_:WCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VCe(e,t,n,r,i,s="NDHWC"){const o=W(e,"x","avgPool3d","float32");let a=o,u=!1;o.rank===4&&(u=!0,a=ne(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),z(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),z(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Ti("avgPool3d",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:s};let f=K.runKernel(b2,l,c);return f=Ee(f,a.dtype),u?ne(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Hee=J({avgPool3d_:VCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GCe(e,t=0){z(e.length>=1,()=>"Pass at least one tensor to concat");const n=Dv(e,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),n.length===1)return df(n[0]);const r=n,i={axis:t};return K.runKernel(S2,r,i)}const hr=J({concat_:GCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HCe(e,t,n=!1,r=!1){let i=W(e,"a","matMul"),s=W(t,"b","matMul");[i,s]=An(i,s);const o={a:i,b:s},a={transposeA:n,transposeB:r};return K.runKernel(v2,o,a)}const pt=J({matMul_:HCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qCe(e){const n={x:W(e,"x","sigmoid","float32")};return K.runKernel(w1,n)}const mu=J({sigmoid_:qCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XCe(e,t,n){const r=W(e,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const i={x:r},s={begin:t,size:n};return K.runKernel(aw,i,s)}const Et=J({slice_:XCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YCe(e){const n={x:W(e,"x","tanh","float32")};return K.runKernel(E1,n)}const Rm=J({tanh_:YCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KCe(e,t,n,r,i,s){const o=W(e,"forgetBias","basicLSTMCell"),a=W(t,"lstmKernel","basicLSTMCell"),u=W(n,"lstmBias","basicLSTMCell"),l=W(r,"data","basicLSTMCell"),c=W(i,"c","basicLSTMCell"),f=W(s,"h","basicLSTMCell"),h=hr([l,f],1),d=pt(h,a),p=be(d,u),m=p.shape[0],g=p.shape[1]/4,y=[m,g],b=Et(p,[0,0],y),x=Et(p,[0,g],y),v=Et(p,[0,g*2],y),w=Et(p,[0,g*3],y),C=be(Q(mu(b),Rm(x)),Q(c,mu(be(o,v)))),S=Q(Rm(C),mu(w));return[C,S]}const ZCe=J({basicLSTMCell_:KCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JCe(e,t,n){const r=W(e,"x","batchToSpaceND"),i=t.reduce((a,u)=>a*u);z(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),z(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),z(r.shape[0]%i===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${i}`);const s={x:r},o={blockShape:t,crops:n};return K.runKernel(x2,s,o)}const DT=J({batchToSpaceND_:JCe});function QCe(e){let t;return e.rank===0||e.rank===1?t=ne(e,[1,1,1,e.size]):e.rank===2?t=ne(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eSe(e,t,n,r,i,s){s==null&&(s=.001);const o=W(e,"x","batchNorm"),a=W(t,"mean","batchNorm"),u=W(n,"variance","batchNorm");let l;i!=null&&(l=W(i,"scale","batchNorm"));let c;r!=null&&(c=W(r,"offset","batchNorm")),z(a.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:QCe(o),scale:l,offset:c,mean:a,variance:u},d={varianceEpsilon:s},p=K.runKernel(F2,h,d);return ne(p,o.shape)}const xw=J({batchNorm_:eSe});function tSe(e,t,n,r,i,s){const o=W(e,"x","batchNorm"),a=W(t,"mean","batchNorm"),u=W(n,"variance","batchNorm");let l;i!=null&&(l=W(i,"scale","batchNorm"));let c;return r!=null&&(c=W(r,"offset","batchNorm")),z(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),z(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),z(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),l!=null&&z(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),xw(o,a,u,c,l,s)}const qee=J({batchNorm2d_:tSe});function nSe(e,t,n,r,i,s){const o=W(e,"x","batchNorm"),a=W(t,"mean","batchNorm"),u=W(n,"variance","batchNorm");let l;i!=null&&(l=W(i,"scale","batchNorm"));let c;return r!=null&&(c=W(r,"offset","batchNorm")),z(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),z(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),z(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),l!=null&&z(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),xw(o,a,u,c,l,s)}const Xee=J({batchNorm3d_:nSe});function rSe(e,t,n,r,i,s){const o=W(e,"x","batchNorm"),a=W(t,"mean","batchNorm"),u=W(n,"variance","batchNorm");let l;i!=null&&(l=W(i,"scale","batchNorm"));let c;return r!=null&&(c=W(r,"offset","batchNorm")),z(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),z(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),z(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),l!=null&&z(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&z(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),xw(o,a,u,c,l,s)}const Yee=J({batchNorm4d_:rSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iSe(e,t,n){const r=W(e,"x","bincount"),i=W(t,"weights","bincount");z(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),z(n>=0,()=>`size must be non-negative, but got ${n}.`),z(i.size===r.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`);const s={x:r,weights:i},o={size:n};return K.runKernel(EA,s,o)}const Kee=J({bincount_:iSe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSe(e,t){const n=W(e,"x","bitwiseAnd"),r=W(t,"y","bitwiseAnd");if(!_t(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if(n.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);const i={a:n,b:r};return K.runKernel(w2,i)}const oSe=J({bitwiseAnd_:sSe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aSe(e,t){const n=W(e,"s0","broadcastArgs","int32"),r=W(t,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return K.runKernel(AA,i)}const uSe=J({broadcastArgs_:aSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lSe(e,t){let n=W(e,"broadcastTo","x");const r=n.shape;if(Ns(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const l=n.shape.slice();for(;l.length<t.length;)l.unshift(1);n=ne(n,l)}const i=n.shape,s=Array.from(t);for(let l=t.length-1;l>=0;l--)if(i[l]===t[l])s[l]=1;else if(n.shape[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(s.map((l,c)=>l>1?c:-1).filter(l=>l>=0).length===0)return df(n);const a={x:n},u={reps:s};return K.runKernel(A1,a,u)}const bm=J({broadcastTo_:lSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cSe(e){const n={x:W(e,"x","ceil","float32")};return K.runKernel(W0,n)}const Zee=J({ceil_:cSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1(e,t,n){Ns(e),n=n||qp(t);const r={shape:e,value:t,dtype:n};return K.runKernel(WA,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fSe(e,t,n){const r=W(e,"x","clipByValue");if(z(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return D1(r.shape,t,r.dtype);const i={x:r},s={clipValueMin:t,clipValueMax:n};return K.runKernel(V0,i,s)}const Ss=J({clipByValue_:fSe});function hSe(e){return hr(e,0)}const Jee=J({concat1d_:hSe});function dSe(e,t){return hr(e,t)}const Qee=J({concat2d_:dSe});function pSe(e,t){return hr(e,t)}const ete=J({concat3d_:pSe});function gSe(e,t){return hr(e,t)}const tte=J({concat4d_:gSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mSe(e,t,n,r,i="NHWC",s=[1,1],o){const a=W(e,"x","conv2d","float32"),u=W(t,"filter","conv2d","float32");let l=a,c=!1;a.rank===3&&(c=!0,l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),z(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Ti("conv2d",r,o);const f=i==="NHWC"?l.shape[3]:l.shape[1];z(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),z(Mr(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),z(cp(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),z(cp(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:l,filter:u},d={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},p=K.runKernel(_2,h,d);return c?ne(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Af=J({conv2d_:mSe});function ySe(e,t,n,r,i="NWC",s=1,o){const a=W(e,"x","conv1d"),u=W(t,"filter","conv1d");let l=a,c=!1;a.rank===2&&(c=!0,l=ne(a,[1,a.shape[0],a.shape[1]])),z(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),z(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Ti("conv1d",r,o),z(l.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`),z(Mr(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),z(cp(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),z(cp(n),()=>"Error in conv1D: Stride should be larger than 0."),z(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const f=ne(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ne(l,[l.shape[0],1,l.shape[1],l.shape[2]]),g=Af(h,f,[1,n],r,"NHWC",[1,s],o);return c?ne(g,[g.shape[2],g.shape[3]]):ne(g,[g.shape[0],g.shape[2],g.shape[3]])}const nB=J({conv1d_:ySe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bSe(e,t,n,r,i,s="NHWC",o){z(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let a=e,u=t,l=!1;t.rank===3&&(l=!0,u=ne(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,e[0],e[1],e[2]]),z(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),z(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),z(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=s==="NHWC"?a[3]:a[1],f=s==="NHWC"?u.shape[3]:u.shape[1];z(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),z(f===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`),Ti("conv2dDerInput",i,o);const h={dy:u,filter:n},d={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,inputShape:a},p=K.runKernel($2,h,d);return l?ne(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const rB=J({conv2DBackpropInput_:bSe});function vSe(e,t,n,r,i,s){const o=W(e,"x","conv2dTranspose"),a=W(t,"filter","conv2dTranspose");return rB(n,o,a,r,i,"NHWC",s)}const iB=J({conv2dTranspose_:vSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xSe(e,t,n,r,i="NDHWC",s=[1,1,1]){const o=W(e,"x","conv3d"),a=W(t,"filter","conv3d");let u=o,l=!1;o.rank===4&&(l=!0,u=ne(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),z(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),z(u.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`),z(Mr(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),z(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),z(cp(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),z(cp(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:u,filter:a},f={strides:n,pad:r,dataFormat:i,dilations:s},h=K.runKernel(k2,c,f);return l?ne(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const nte=J({conv3d_:xSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wSe(e,t,n,r,i){z(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,o=t,a=!1;t.rank===4&&(a=!0,o=ne(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);const u=s[4],l=o.shape[4];z(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),z(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),z(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),z(u===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`),z(l===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${n.shape[4]}.`);const c={dy:o,filter:n},f={pad:i,strides:r,inputShape:s},h=K.runKernel(FA,c,f);return a?ne(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const rte=J({conv3DBackpropInput_:wSe});function CSe(e,t,n,r,i){const s=W(e,"x","conv3dTranspose"),o=W(t,"filter","conv3dTranspose");return rte(n,s,o,r,i)}const ite=J({conv3dTranspose_:CSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SSe(e){const n={x:W(e,"x","cos","float32")};return K.runKernel(G0,n)}const IT=J({cos_:SSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Se(e){const n={x:W(e,"x","cosh","float32")};return K.runKernel(H0,n)}const sB=J({cosh_:_Se});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Se(e,t=0,n=!1,r=!1){const s={x:W(e,"x","cumprod")},o={axis:t,exclusive:n,reverse:r};return K.runKernel(OA,s,o)}const D$=J({cumprod_:$Se});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kSe(e,t=0,n=!1,r=!1){const s={x:W(e,"x","cumsum")},o={axis:t,exclusive:n,reverse:r};return K.runKernel(E2,s,o)}const oB=J({cumsum_:kSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(e,t,n,r=!1){const i=W(e,"x","denseBincount"),s=W(t,"weights","denseBincount");z(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),z(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),z(n>=0,()=>`size must be non-negative, but got ${n}.`),z(s.size===i.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`);const o={x:i,weights:s},a={size:n,binaryOutput:r};return K.runKernel(MA,o,a)}const BM=J({denseBincount_:ESe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ASe(e,t,n="NHWC"){const r=W(e,"x","depthToSpace","float32"),i=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],o=n==="NHWC"?r.shape[3]:r.shape[1];z(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),z(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t}  for depthToSpace with input shape
    ${r.shape}`),z(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${r.shape}`),z(o%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${r.shape}`);const a={x:r},u={blockSize:t,dataFormat:n};return K.runKernel(RA,a,u)}const ste=J({depthToSpace_:ASe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TSe(e,t,n,r,i="NHWC",s=[1,1],o){const a=W(e,"x","depthwiseConv2d","float32"),u=W(t,"filter","depthwiseConv2d","float32");let l=a,c=!1;a.rank===3&&(c=!0,l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),z(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const f=i==="NHWC"?l.shape[3]:l.shape[1];z(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Ti("depthwiseConv2d",r,o);const h={x:l,filter:u},d={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},p=K.runKernel(A2,h,d);return c?ne(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const ww=J({depthwiseConv2d_:TSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DSe(e){const n={x:W(e,"x","diag")};return K.runKernel(BA,n)}const ISe=J({diag_:DSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FSe(e,t,n,r,i=[1,1],s="NHWC"){const o=W(e,"x","dilation2d"),a=W(t,"filter","dilation2d");z(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),z(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),z(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let u=o,l=!1;o.rank===3&&(u=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),z(u.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${a.shape[2]}`);const c={x:u,filter:a},f={strides:n,pad:r,dilations:i},h=K.runKernel(T2,c,f);return l?ne(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const ote=J({dilation2d_:FSe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fp(e,t){const n=e.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,o=e[s]||1;(t[t.length-1-i]||1)>1&&o===1&&r.unshift(s)}return r}function Hn(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[e.length-r-1],s=t.length-r-1,o=t[s];(i==null||i===1&&o>1)&&n.unshift(s)}return n}function rt(e,t){const n=Math.max(e.length,t.length),r=new Array(n);for(let i=0;i<n;i++){let s=e[e.length-i-1];s==null&&(s=1);let o=t[t.length-i-1];if(o==null&&(o=1),s===1)r[n-i-1]=o;else if(o===1)r[n-i-1]=s;else if(s!==o){const a=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(a)}else r[n-i-1]=s}return r}const OSe=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:rt,getBroadcastDims:fp,getReductionAxes:Hn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSe(e,t){let n=W(e,"a","equal","string_or_numeric"),r=W(t,"b","equal","string_or_numeric");[n,r]=An(n,r),rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(D2,i)}const ka=J({equal_:NSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MSe(e,t,n){const r=W(t,"a","where"),i=W(n,"b","where"),s=W(e,"condition","where","bool"),o=rt(rt(s.shape,r.shape),i.shape),a=bm(s,o),u=bm(r,o),l=bm(i,o),c={condition:a,t:u,e:l};return K.runKernel(ow,c)}const Yr=J({where_:MSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RSe(e){const n={x:W(e,"x","zerosLike")};return K.runKernel(gw,n)}const $t=J({zerosLike_:RSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PSe(e,t){let n=W(e,"a","div"),r=W(t,"b","div");[n,r]=An(n,r);const i=je(n,r),s=$t(i),o=ka(r,s);return Yr(o,s,i)}const ate=J({divNoNan_:PSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LSe(e,t){const n=W(e,"t1","dot"),r=W(t,"t2","dot");z((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const i=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];if(z(i===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`),n.rank===1&&r.rank===1){const o=ne(n,[1,-1]),a=ne(r,[-1,1]),u=pt(o,a);return ne(u,[])}else if(n.rank===1&&r.rank===2){const o=ne(n,[1,-1]),a=ne(r,[r.shape[0],r.shape[1]]),u=pt(o,a);return ne(u,[u.size])}else if(n.rank===2&&r.rank===1){const o=ne(r,[-1,1]),a=pt(n,o);return ne(a,[a.size])}else{const o=ne(r,[r.shape[0],r.shape[1]]);return pt(n,o)}}const ute=J({dot_:LSe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BSe(e,...t){const n=t.map((i,s)=>W(i,`tensors${s}`,"einsum")),r={equation:e};return K.runKernel(zA,n,r)}const zSe=J({einsum_:BSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jSe(e){const n={x:W(e,"x","elu","float32")};return K.runKernel(X0,n)}const Cw=J({elu_:jSe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function USe(e,t){const n=W(e,"x","ensureShape","string_or_numeric");if(!qQ(n.shape,t))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${t}`);return e}const WSe=J({ensureShape_:USe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VSe(e){let t=W(e,"x","erf");z(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=Ee(t,"float32"));const n={x:t};return K.runKernel(Y0,n)}const lte=J({erf_:VSe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function cte(e,t,n){const r=e.length+t.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)n.indexOf(a)===-1?i.push(e[s++]):i.push(t[o++]);return i}function yr(e,t){const n=[],r=e.length;for(let s=0;s<r;s++)t.indexOf(s)===-1&&n.push(e[s]);const i=t.map(s=>e[s]);return[n,i]}function Bn(e,t){const n=t.map(r=>1);return cte(e,n,t)}function Rr(e,t,n){z(aB(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function Tn(e,t){if(aB(e,t))return null;const n=[];for(let r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(r=>n.push(r)),n}function yh(e){return e.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function zn(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GSe(e,t=null,n=!1){const i={x:W(e,"x","max")},s={reductionIndices:t,keepDims:n};return K.runKernel(U2,i,s)}const To=J({max_:GSe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HSe(e,t=null,n=!1){const i={x:W(e,"x","min")},s={axis:t,keepDims:n};return K.runKernel(H2,i,s)}const Ov=J({min_:HSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qSe(e,t){let n=W(e,"base","pow"),r=W(t,"exp","pow");[n,r]=An(n,r);const i={a:n,b:r};return K.runKernel(f1,i)}const Tf=J({pow_:qSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function et(e,t){if((or(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&or(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return gh(e,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XSe(e){const n={x:W(e,"x","sqrt","float32")};return K.runKernel(S1,n)}const Zr=J({sqrt_:XSe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YSe(e){const t=W(e,"x","square"),n={};return K.runKernel("Square",{x:t},n)}const Jt=J({square_:YSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KSe(e,t=null,n=!1){let r=W(e,"x","sum");r.dtype==="bool"&&(r=Ee(r,"int32"));const i={x:r},s={axis:t,keepDims:n};return K.runKernel(uw,i,s)}const Oe=J({sum_:KSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZSe(e,t="euclidean",n=null,r=!1){e=W(e,"x","norm");const i=fte(e,t,n);let s=i.shape;if(r){const o=dt(n,e.shape);s=Bn(i.shape,o)}return ne(i,s)}function fte(e,t,n=null){if(e.rank===0)return Yn(e);if(e.rank!==1&&n===null)return fte(ne(e,[-1]),t,n);if(e.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return Oe(Yn(e),n);if(t===1/0)return To(Yn(e),n);if(t===-1/0)return Ov(Yn(e),n);if(t==="euclidean"||t===2)return Zr(Oe(Tf(Yn(e),et(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return To(Oe(Yn(e),n[0]),n[1]-1);if(t===1/0)return To(Oe(Yn(e),n[1]),n[0]);if(t===-1/0)return Ov(Oe(Yn(e),n[1]),n[0]);if(t==="fro"||t==="euclidean")return Zr(Oe(Jt(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Sw=J({norm_:ZSe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JSe(e,t=null,n=!1){return Sw(e,"euclidean",t,n)}const hte=J({euclideanNorm_:JSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QSe(e){const n={x:W(e,"x","exp")};return K.runKernel(K0,n)}const Zs=J({exp_:QSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e_e(e,t=0){const n=W(e,"x","expandDims","string_or_numeric");z(t<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},i={dim:t};return K.runKernel(I2,r,i)}const Mi=J({expandDims_:e_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_e(e){const n={x:W(e,"x","expm1")};return K.runKernel(Z0,n)}const dte=J({expm1_:t_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_e(e,t){const n=W(e,"x","tile","string_or_numeric");z(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);const r={x:n},i={reps:t};return K.runKernel(A1,r,i)}const vo=J({tile_:n_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r_e(e,t,n,r="float32"){t==null&&(t=e);const i=ft([e,t],r),s=e<=t?e:t;for(let a=0;a<s;++a)i.set(1,a,a);const o=ne(i.toTensor(),[e,t]);if(n==null)return o;if(n.length===1)return vo(Mi(o,0),[n[0],1,1]);if(n.length===2)return vo(Mi(Mi(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return vo(Mi(Mi(Mi(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const uB=J({eye_:r_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i_e(e){const n={x:W(e,"x","floor","float32")};return K.runKernel(J0,n)}const _w=J({floor_:i_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s_e(e,t,n=0,r=0){const i=W(e,"x","gather"),s=W(t,"indices","gather","int32"),o={x:i,indices:s},a={axis:n,batchDims:r};return K.runKernel(O2,o,a)}const $w=J({gather_:s_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_e(e,t){let n=W(e,"a","greater","string_or_numeric"),r=W(t,"b","greater","string_or_numeric");[n,r]=An(n,r),rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(N2,i)}const Rs=J({greater_:o_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a_e(e,t){let n=W(e,"a","greaterEqual","string_or_numeric"),r=W(t,"b","greaterEqual","string_or_numeric");[n,r]=An(n,r),rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(e1,i)}const bh=J({greaterEqual_:a_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u_e(e){const n={input:W(e,"input","imag")};return K.runKernel(qA,n)}const FT=J({imag_:u_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_e(e){const n={x:W(e,"x","isFinite")};return K.runKernel(n1,n)}const pte=J({isFinite_:l_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_e(e){const n={x:W(e,"x","isInf")};return K.runKernel(r1,n)}const gte=J({isInf_:c_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_e(e){const n={x:W(e,"x","isNaN")};return K.runKernel(i1,n)}const mte=J({isNaN_:f_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h_e(e,t=.2){const r={x:W(e,"x","leakyRelu")},i={alpha:t};return K.runKernel(M2,r,i)}const OT=J({leakyRelu_:h_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_e(e,t){let n=W(e,"a","less","string_or_numeric"),r=W(t,"b","less","string_or_numeric");[n,r]=An(n,r),rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(R2,i)}const Nv=J({less_:d_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_e(e,t){let n=W(e,"a","lessEqual","string_or_numeric"),r=W(t,"b","lessEqual","string_or_numeric");[n,r]=An(n,r),rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(P2,i)}const Jp=J({lessEqual_:p_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_e(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return K.runKernel(XA,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m_e(e,t=5,n=1,r=1,i=.5){const s=W(e,"x","localResponseNormalization");z(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),z(ap(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=s,a=!1;s.rank===3&&(a=!0,o=ne(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const u={x:o},l={depthRadius:t,bias:n,alpha:r,beta:i},c=K.runKernel(j2,u,l);return a?ne(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const yte=J({localResponseNormalization_:m_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y_e(e){const n={x:W(e,"x","log","float32")};return K.runKernel(s1,n)}const Js=J({log_:y_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_e(e){const n={x:W(e,"x","log1p")};return K.runKernel(o1,n)}const NT=J({log1p_:b_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_e(e){return z($f(e),()=>"The f passed in grad(f) must be a function"),(t,n)=>{const r=W(t,"x","tf.grad","string_or_numeric"),i=n!=null?W(n,"dy","tf.grad"):null;return K.tidy(()=>{const{value:s,grads:o}=K.gradients(()=>e(r),[r],i);return i!=null&&Nr(s.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),MT(o),o[0]})}}function x_e(e){return z($f(e),()=>"The f passed in grads(f) must be a function"),(t,n)=>{z(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=Dv(t,"args","tf.grads","string_or_numeric"),i=n!=null?W(n,"dy","tf.grads"):null;return K.tidy(()=>{const{value:s,grads:o}=K.gradients(()=>e(...r),r,i);return i!=null&&Nr(s.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),MT(o),o})}}function w_e(e){return z($f(e),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{z(t instanceof Vt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),z(n==null||n instanceof Vt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:i}=K.gradients(()=>e(t),[t],n);return MT(r),{grad:r[0],value:i}}}function C_e(e){return z($f(e),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{z(Array.isArray(t)&&t.every(i=>i instanceof Vt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),z(n==null||n instanceof Vt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=K.gradients(()=>e(...t),t,n);return n!=null&&Nr(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),MT(r.grads),r}}function bte(e,t){z($f(e),()=>"The f passed in variableGrads(f) must be a function"),z(t==null||Array.isArray(t)&&t.every(l=>l instanceof Tv),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=t!=null;if(!n){t=[];for(const l in K.registeredVariables)t.push(K.registeredVariables[l])}const r=n?t.filter(l=>!l.trainable):null,i=t.length;t=t.filter(l=>l.trainable),z(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const s=!0,{value:o,grads:a}=K.gradients(e,t,null,s);z(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),z(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const u={};return t.forEach((l,c)=>{a[c]!=null&&(u[l.name]=a[c])}),r!=null&&r.forEach(l=>u[l.name]=null),{value:o,grads:u}}function Iu(e){return K.customGrad(e)}function MT(e){if(e.filter(n=>n==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_e(e){const n={x:W(e,"x","neg")};return K.runKernel(X2,n)}const dn=J({neg_:S_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __e(e){const n={x:W(e,"x","softplus")};return K.runKernel(C1,n)}const I1=J({softplus_:__e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_e(e){const t=W(e,"x","logSigmoid");return Iu(r=>({value:dn(I1(dn(r))),gradFunc:o=>Q(o,mu(dn(r)))}))(t)}const vte=J({logSigmoid_:$_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k_e(e,t){let n=W(e,"a","sub"),r=W(t,"b","sub");[n,r]=An(n,r);const i={a:n,b:r};return K.runKernel($1,i)}const Ie=J({sub_:k_e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E_e(e,t=-1){const n=W(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Iu((i,s)=>{const a=To(i,t,!0),u=Ie(i,a),l=Ie(Ee(u,"float32"),Js(Oe(Zs(u),t,!0)));return s([l]),{value:l,gradFunc:(f,h)=>{const[d]=h,p=!0,m=Zs(d);return Ie(f,Q(Oe(f,t,p),m))}}})(n)}const lB=J({logSoftmax_:E_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_e(e,t=null,n=!1){const r=W(e,"x","logSumExp"),i=dt(t,r.shape),s=To(r,i,!0),o=Ie(r,s),a=Zs(o),u=Oe(a,i),l=Js(u),c=be(ne(s,l.shape),l);if(n){const f=Bn(c.shape,i);return ne(c,f)}return c}const cB=J({logSumExp_:A_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_e(e,t){const n=W(e,"a","logicalAnd","bool"),r=W(t,"b","logicalAnd","bool");rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(L2,i)}const Fu=J({logicalAnd_:T_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_e(e){const n={x:W(e,"x","logicalNot","bool")};return K.runKernel(B2,n)}const RT=J({logicalNot_:D_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_e(e,t){const n=W(e,"a","logicalOr","bool"),r=W(t,"b","logicalOr","bool");rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(z2,i)}const fB=J({logicalOr_:I_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F_e(e,t){const n=W(e,"a","logicalXor","bool"),r=W(t,"b","logicalXor","bool");return rt(n.shape,r.shape),Fu(fB(e,t),RT(Fu(e,t)))}const xte=J({logicalXor_:F_e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dS=2147483648;function O_e(e,t,n="left"){const r=W(e,"sortedSequence","searchSorted"),i=W(t,"values","searchSorted"),s=r.shape[r.shape.length-1],o=i.shape[i.shape.length-1],a=ne(r,[-1,s]),u=ne(i,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(ce(u.shape)>=dS)throw new Error(`values tensor size must less than ${dS}`);if(a.shape[1]>=dS)throw new Error(`trailing dim_size must less than ${dS} for int32 output type, was ${a.shape[1]}`);const l={sortedSequence:a,values:u},c={side:n};return K.runKernel(hT,l,c)}const hB=J({searchSorted_:O_e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N_e(e,t){return hB(e,t,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_e(e,t,n,r,i){const s=W(e,"x","maxPool"),o=1;let a=s,u=!1;s.rank===3&&(u=!0,a=ne(s,[1,s.shape[0],s.shape[1],s.shape[2]])),z(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),z(Mr(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),Ti("maxPool",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i},f=K.runKernel(W2,l,c);return u?ne(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const PT=J({maxPool_:M_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_e(e,t=[1,1,1],n,r,i,s="NDHWC"){const o=W(e,"x","maxPool3d");let a=o,u=!1;o.rank===4&&(u=!0,a=ne(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),z(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),z(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),Ti("maxPool3d",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},f=K.runKernel(V2,l,c);return u?ne(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const wte=J({maxPool3d_:R_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_e(e,t,n,r,i=!1){const o={x:W(e,"x","maxPoolWithArgmax")},a={filterSize:t,strides:n,pad:r,includeBatchInIndex:i},u=K.runKernel(JA,o,a);return{result:u[0],indexes:u[1]}}const L_e=J({maxPoolWithArgmax_:P_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B_e(e,t){let n=W(e,"a","maximum"),r=W(t,"b","maximum");[n,r]=An(n,r),n.dtype==="bool"&&(n=Ee(n,"int32"),r=Ee(r,"int32")),rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(a1,i)}const pc=J({maximum_:B_e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_e(e,t=null,n=!1){const i={x:W(e,"x","mean")},s={axis:t,keepDims:n};return K.runKernel(G2,i,s)}const In=J({mean_:z_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kn(e,t="float32"){if(Ns(e),t==="complex64"){const r=Kn(e,"float32"),i=Kn(e,"float32");return kf(r,i)}const n=Ir(ce(e),t);return K.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vs(e,t="float32"){if(Ns(e),t==="complex64"){const r=Vs(e,"float32"),i=Kn(e,"float32");return kf(r,i)}const n=wA(ce(e),t);return K.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_e(e,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(e===void 0)return[];let r=W(e,"x","meshgrid",e instanceof Vt?e.dtype:"float32");if(t===void 0)return[r];let i=W(t,"y","meshgrid",t instanceof Vt?t.dtype:"float32");const s=ce(r.shape),o=ce(i.shape);return n==="xy"?(r=ne(r,[1,-1]),i=ne(i,[-1,1]),[pt(Vs([o,1],r.dtype),r),pt(i,Vs([1,s],i.dtype))]):(r=ne(r,[-1,1]),i=ne(i,[1,-1]),[pt(r,Vs([1,o],r.dtype)),pt(Vs([s,1],i.dtype),i)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_e(e,t){let n=W(e,"a","minimum"),r=W(t,"b","minimum");[n,r]=An(n,r),n.dtype==="bool"&&(n=Ee(n,"int32"),r=Ee(r,"int32")),rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(u1,i)}const hp=J({minimum_:U_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_e(e,t,n){z(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const r=W(e,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");z(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);const i=n==="reflect"?1:0;for(let a=0;a<r.rank;a++)z(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),z(t[a][0]>=0&&t[a][0]<=r.shape[a]-i&&t[a][1]>=0&&t[a][1]<=r.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-i} or less than 0 for input of shape ${r.shape}`);const s={paddings:t,mode:n},o={x:r};return K.runKernel(q2,o,s)}const Cte=J({mirrorPad_:W_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_e(e,t){let n=W(e,"a","mod"),r=W(t,"b","mod");[n,r]=An(n,r);const i={a:n,b:r};return K.runKernel(l1,i)}const Ste=J({mod_:V_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_e(e,t=null,n=!1){e=W(e,"x","moments");const r=dt(t,e.shape),i=In(e,r,n);let s=i.shape;n||(s=Bn(i.shape,r));const o=Jt(Ie(Ee(e,"float32"),ne(i,s))),a=In(o,r,n);return{mean:i,variance:a}}const LT=J({moments_:G_e});function H_e(e,t,n,r){const i=W(t,"data","multiRNNCell"),s=Dv(n,"c","multiRNNCell"),o=Dv(r,"h","multiRNNCell");let a=i;const u=[];for(let f=0;f<e.length;f++){const h=e[f](a,s[f],o[f]);u.push(h[0]),u.push(h[1]),a=h[1]}const l=[],c=[];for(let f=0;f<u.length;f+=2)l.push(u[f]),c.push(u[f+1]);return[l,c]}const q_e=J({multiRNNCell_:H_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X_e(e,t,n,r=!1){const i=W(e,"logits","multinomial"),s=i.size,o=i.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const u={logits:o===1?ne(i,[1,-1]):i},l={numSamples:t,seed:n,normalized:r},c=K.runKernel(QA,u,l);return o===1?ne(c,[c.size]):c}const Y_e=J({multinomial_:X_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_e(e,t){let n=W(e,"a","notEqual","string_or_numeric"),r=W(t,"b","notEqual","string_or_numeric");[n,r]=An(n,r),rt(n.shape,r.shape);const i={a:n,b:r};return K.runKernel(Y2,i)}const Pm=J({notEqual_:K_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_e(e,t,n=1,r=0,i="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const o={indices:W(e,"indices","oneHot","int32")},a={dtype:i,depth:t,onValue:n,offValue:r};return K.runKernel(Z2,o,a)}const Mv=J({oneHot_:Z_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J_e(e){const n={x:W(e,"x","onesLike")};return K.runKernel(K2,n)}const Qs=J({onesLike_:J_e});function Q_e(e,t){const n=W(e,"v1","outerProduct"),r=W(t,"v2","outerProduct");z(n.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);const i=ne(n,[-1,1]),s=ne(r,[1,-1]);return pt(i,s)}const e$e=J({outerProduct_:Q_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t$e(e,t,n=0){const r=W(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:t,constantValue:n},s={x:r};return K.runKernel(Q2,s,i)}const vh=J({pad_:t$e});function n$e(e,t,n=0){return z(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),vh(e,[t],n)}const r$e=J({pad1d_:n$e});function i$e(e,t,n=0){return z(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),vh(e,t,n)}const s$e=J({pad2d_:i$e});function o$e(e,t,n=0){return z(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),vh(e,t,n)}const a$e=J({pad3d_:o$e});function u$e(e,t,n=0){return z(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),vh(e,t,n)}const l$e=J({pad4d_:u$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c$e(e,t,n){const r=W(e,"x","spaceToBatchND");z(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),z(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),z(r.shape.reduce((o,a,u)=>u>0&&u<=t.length?o&&(a+n[u-1][0]+n[u-1][1])%t[u-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);const i={x:r},s={blockShape:t,paddings:n};return K.runKernel(lw,i,s)}const BT=J({spaceToBatchND_:c$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f$e(e,t,n,r,i,s,o){i==null&&(i=[1,1]),s==null&&(s=1),r===0&&(r="valid");const a=W(e,"x","maxPool");let u=a,l=!1;a.rank===3&&(l=!0,u=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),z(Mr(s,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`);const c=jo(u.shape,t,s,i,r),f=[c.dilationHeight,c.dilationWidth];let h;r==="same"?h=d$e([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];const d=f[0]===1&&f[1]===1,[p,m]=h$e([c.inHeight,c.inWidth],f,h),g=d?r:"valid",y=d?u:BT(u,f,p),x=(n==="avg"?()=>TT(y,t,s,g,o):()=>PT(y,t,s,g,o))(),v=d?x:DT(x,f,m);return l?ne(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function h$e(e,t,n){const r=n.map(c=>c[0]),i=n.map(c=>c[1]),s=e.concat(r,i),o=t.map((c,f)=>(c-s[f]%c)%c),a=i.map((c,f)=>c+o[f]),u=t.map((c,f)=>[r[f],a[f]]),l=t.map((c,f)=>[0,o[f]]);return[u,l]}function d$e(e,t){const r=e.map((o,a)=>o+(o-1)*(t[a]-1)).map(o=>o-1),i=r.map(o=>Math.floor(o/2)),s=r.map((o,a)=>o-i[a]);return r.map((o,a)=>[i[a],s[a]])}const _te=J({pool_:f$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p$e(e,t){const n=W(e,"x","prelu"),r=W(t,"alpha","prelu"),i={x:n,alpha:r};return K.runKernel(ew,i)}const zT=J({prelu_:p$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g$e(e,t=null,n=!1){let r=W(e,"x","prod");r.dtype==="bool"&&(r=Ee(r,"int32"));const i={x:r},s={axis:t,keepDims:n};return K.runKernel(tw,i,s)}const $te=J({prod_:g$e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m$e(e,t,n,r){const i=e.map((c,f)=>W(c,`tensors${f}`,"raggedGather","int32")),s=W(t,"paramsDenseValues","raggedGather"),o=W(n,"indices","raggedGather","int32"),a={paramsNestedSplits:i,paramsDenseValues:s,indices:o},u={outputRaggedRank:r},l=K.runKernel(rT,a,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}const y$e=J({raggedGather_:m$e});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b$e(e,t,n){const r=W(e,"starts","raggedRange"),i=W(t,"limits","raggedRange",r.dtype),s=W(n,"deltas","raggedRange",r.dtype),o={starts:r,limits:i,deltas:s},a=K.runKernel(iT,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const v$e=J({raggedRange_:b$e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x$e(e,t,n,r,i){const s=W(e,"shape","raggedTensorToTensor","int32"),o=W(t,"values","raggedTensorToTensor"),a=W(n,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map((f,h)=>W(f,`tensors${h}`,"raggedTensorToTensor","int32")),l={shape:s,values:o,defaultValue:a,rowPartitionTensors:u},c={rowPartitionTypes:i};return K.runKernel(sT,l,c)}const w$e=J({raggedTensorToTensor_:x$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C$e(e,t,n){Ns(e);const r=ce(e);let i=null;if(n==null||n==="float32")i=new Float32Array(r);else if(n==="int32")i=new Int32Array(r);else if(n==="bool")i=new Uint8Array(r);else throw new Error(`Unknown data type ${n}`);for(let s=0;s<r;s++)i[s]=t();return K.makeTensor(i,e,n)}const S$e=J({rand_:C$e});var dB={exports:{}};dB.exports;(function(e){(function(t,n,r){function i(u){var l=this,c=a();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function s(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new i(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&s(f,c),h.state=function(){return s(c,{})}),h}function a(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(st,e,!1)})(dB);var _$e=dB.exports,pB={exports:{}};pB.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},a===(a|0)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function s(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(st,e,!1)})(pB);var $$e=pB.exports,gB={exports:{}};gB.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(a|0)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function s(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(st,e,!1)})(gB);var k$e=gB.exports,mB={exports:{}};mB.exports;(function(e){(function(t,n,r){function i(a){var u=this;u.next=function(){var c=u.x,f=u.i,h,d;return h=c[f],h^=h>>>7,d=h^h<<24,h=c[f+1&7],d^=h^h>>>10,h=c[f+3&7],d^=h^h>>>3,h=c[f+4&7],d^=h^h<<7,h=c[f+7&7],h=h^h<<13,d^=h^h<<9,c[f]=d,u.i=f+1&7,d};function l(c,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],c.x=d,c.i=0,h=256;h>0;--h)c.next()}l(u,a)}function s(a,u){return u.x=a.x.slice(),u.i=a.i,u}function o(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(c.x&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(st,e,!1)})(mB);var E$e=mB.exports,yB={exports:{}};yB.exports;(function(e){(function(t,n,r){function i(a){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,d,p;return u.w=c=c+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(c^c>>>16)|0};function l(c,f){var h,d,p,m,g,y=[],b=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,b=Math.max(b,f.length)),p=0,m=-32;m<b;++m)f&&(d^=f.charCodeAt((m+32)%f.length)),m===0&&(g=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,m>=0&&(g=g+1640531527|0,h=y[m&127]^=d+g,p=h==0?p+1:0);for(p>=128&&(y[(f&&f.length||0)&127]=-1),p=127,m=4*128;m>0;--m)d=y[p+34&127],h=y[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,y[p]=d^h;c.w=g,c.X=y,c.i=p}l(u,a)}function s(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function o(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(c.X&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(st,e,!1)})(yB);var A$e=yB.exports,bB={exports:{}};bB.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=a|0):l+=a;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function s(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(st,e,!1)})(bB);var T$e=bB.exports,kte={exports:{}};const D$e={},I$e=Object.freeze(Object.defineProperty({__proto__:null,default:D$e},Symbol.toStringTag,{value:"Module"})),F_=Kp(I$e);(function(e){(function(t,n,r){var i=256,s=6,o=52,a="random",u=r.pow(i,s),l=r.pow(2,o),c=l*2,f=i-1,h;function d(v,w,C){var S=[];w=w==!0?{entropy:!0}:w||{};var _=y(g(w.entropy?[v,x(n)]:v??b(),3),S),$=new p(S),k=function(){for(var E=$.g(s),F=u,T=0;E<l;)E=(E+T)*i,F*=i,T=$.g(1);for(;E>=c;)E/=2,F/=2,T>>>=1;return(E+T)/F};return k.int32=function(){return $.g(4)|0},k.quick=function(){return $.g(4)/4294967296},k.double=k,y(x($.S),n),(w.pass||C||function(E,F,T,I){return I&&(I.S&&m(I,$),E.state=function(){return m($,{})}),T?(r[a]=E,F):E})(k,_,"global"in w?w.global:this==r,w.state)}function p(v){var w,C=v.length,S=this,_=0,$=S.i=S.j=0,k=S.S=[];for(C||(v=[C++]);_<i;)k[_]=_++;for(_=0;_<i;_++)k[_]=k[$=f&$+v[_%C]+(w=k[_])],k[$]=w;(S.g=function(E){for(var F,T=0,I=S.i,D=S.j,N=S.S;E--;)F=N[I=f&I+1],T=T*i+N[f&(N[I]=N[D=f&D+F])+(N[D]=F)];return S.i=I,S.j=D,T})(i)}function m(v,w){return w.i=v.i,w.j=v.j,w.S=v.S.slice(),w}function g(v,w){var C=[],S=typeof v,_;if(w&&S=="object")for(_ in v)try{C.push(g(v[_],w-1))}catch{}return C.length?C:S=="string"?v:v+"\0"}function y(v,w){for(var C=v+"",S,_=0;_<C.length;)w[f&_]=f&(S^=w[f&_]*19)+C.charCodeAt(_++);return x(w)}function b(){try{var v;return h&&(v=h.randomBytes)?v=v(i):(v=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(v)),x(v)}catch{var w=t.navigator,C=w&&w.plugins;return[+new Date,t,C,t.screen,x(n)]}}function x(v){return String.fromCharCode.apply(0,v)}if(y(r.random(),n),e.exports){e.exports=d;try{h=F_}catch{}}else r["seed"+a]=d})(typeof self<"u"?self:st,[],Math)})(kte);var F$e=kte.exports,O$e=_$e,N$e=$$e,M$e=k$e,R$e=E$e,P$e=A$e,L$e=T$e,Qp=F$e;Qp.alea=O$e;Qp.xor128=N$e;Qp.xorwow=M$e;Qp.xorshift7=R$e;Qp.xor4096=P$e;Qp.tychei=L$e;var jT=Qp;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B$e=.001,Ete=.1;function z$e(e,t,n){return n==null&&(n=vB()),zM(e,t,(r,i)=>xB(r,i,n))}function vB(){return K.backend.floatPrecision()===32?B$e:Ete}function zM(e,t,n){let r=!0;if((or(e)||or(t))&&(r=!1),or(e)&&or(t)&&(r=!0),r){const o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(e)&&Array.isArray(t)){const o=Du(e),a=Du(t);if(!_t(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const i=or(e)?e:Tu(e),s=or(t)?t:Tu(t);if(i.length!==s.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${s.length}.
Actual:   ${i}.
Expected: ${s}.`);for(let o=0;o<s.length;++o){const a=i[o],u=s[o];if(!n(a,u))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${u}.
Actual:   ${i}.
Expected: ${s}.`)}typeof expect<"u"&&expect().nothing()}function j$e(e,t){e().then(()=>t.fail(),()=>t()),typeof expect<"u"&&expect().nothing()}function U$e(e,t){const n=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return cu(e)||cu(e[0])||cu(t)||cu(t[0])?zM(e,n,(r,i)=>r==i):zM(e,t,(r,i)=>xB(r,i,0))}function W$e(e,t,n){if(n==null&&(n=vB()),!xB(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`);typeof expect<"u"&&expect().nothing()}function xB(e,t,n){return!isFinite(e)&&!isFinite(t)?!0:!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function V$e(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function G$e(e,t){const n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let i=0;i<r.length;i++)if(n[i]!==r[i])throw new Error(`Expected ArrayBuffer value at ${i} to be ${r[i]} but got ${n[i]} instead`)}function Ate(e){for(let t=0;t<e.length;t++){const n=e[t];Array.isArray(n)?Ate(n):e[t]=gu(n)}return e}function H$e(e){const t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise(n=>{t.addEventListener("loadeddata",r=>n(t)),t.load()})}async function q$e(e){await e.play(),"requestVideoFrameCallback"in e&&await new Promise(t=>{e.requestVideoFrameCallback(t)})}const X$e=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:Ete,createVideoElement:H$e,encodeStrings:Ate,expectArrayBuffersEqual:G$e,expectArraysClose:z$e,expectArraysEqual:U$e,expectNumbersClose:W$e,expectPromiseToFail:j$e,expectValuesInRange:V$e,play:q$e,testEpsilon:vB},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wB{constructor(t,n,r,i,s){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=s||Math.random();this.random=jT.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let t,n,r=!1;for(;!r;){let i,s,o;do i=2*this.random()-1,s=2*this.random()-1,o=i*i+s*s;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*a,n=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Y$e{constructor(t,n,r,i){this.alpha=t,this.beta=1/n,this.dtype=r;const s=i||Math.random();this.randu=jT.alea(s.toString()),this.randn=new wB(0,1,r,!1,this.randu()),t<1?this.d=t+2/3:this.d=t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,n,r,i,s,o;for(;;){do i=this.randn.nextValue(),o=1+this.c*i;while(o<=0);if(o*=o*o,t=i*i,n=1-.331*t*t,r=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<n||Math.log(s)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}}class K$e{constructor(t=0,n=1,r,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=n-t,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${n} <= 1 and dtype is not float`);this.random=jT.alea(i)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$e(e,t,n=1,r="float32",i){if(Ns(e),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);const s=new Y$e(t,n,r,i),o=ft(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const J$e=J({randomGamma_:Z$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$e(e,t=0,n=1,r,i){if(Ns(e),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const s=new wB(t,n,r,!1,i),o=ft(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const CB=J({randomNormal_:Q$e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eke(e,t,n){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return CB(e,0,1,t,n)}const tke=J({randomStandardNormal_:eke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nke(e,t=0,n=1,r="float32",i){Ns(e);const s=ft(e,r),o=new K$e(t,n,null,i);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const eg=J({randomUniform_:nke});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rke(e,t,n,r){return eg(e,t,n,"int32",r)}const ike=J({randomUniformInt_:rke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lm(e,t,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:e,stop:t,step:n,dtype:r};return K.runKernel(oT,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ske(e){const n={input:W(e,"input","real")};return K.runKernel(aT,n)}const Rv=J({real_:ske});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oke(e){const n={x:W(e,"x","reciprocal")};return K.runKernel(h1,n)}const Tte=J({reciprocal_:oke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ake(e){const n={x:W(e,"x","relu")};return K.runKernel(d1,n)}const qu=J({relu_:ake});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uke(e){const n={x:W(e,"x","relu6")};return K.runKernel(p1,n)}const SB=J({relu6_:uke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lke(e,t){const r={x:W(e,"x","reverse")},i={dims:t};return K.runKernel(sw,r,i)}const Fo=J({reverse_:lke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cke(e){const t=W(e,"x","reverse");return z(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),Fo(t,0)}const fke=J({reverse1d_:cke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hke(e,t){const n=W(e,"x","reverse");return z(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),Fo(n,t)}const dke=J({reverse2d_:hke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pke(e,t){const n=W(e,"x","reverse");return z(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),Fo(n,t)}const gke=J({reverse3d_:pke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mke(e,t){const n=W(e,"x","reverse");return z(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),Fo(n,t)}const yke=J({reverse4d_:mke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bke(e){const n={x:W(e,"x","round")};return K.runKernel(g1,n)}const _B=J({round_:bke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vke(e){const n={x:W(e,"x","rsqrt","float32")};return K.runKernel(m1,n)}const $B=J({rsqrt_:vke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xke(e){const n={x:W(e,"x","selu")};return K.runKernel(y1,n)}const kB=J({selu_:xke});function wke(e,t,n,r,i,s=[1,1],o="NHWC"){const a=W(e,"x","separableConv2d"),u=W(t,"depthwiseFilter","separableConv2d"),l=W(n,"pointwiseFilter","separableConv2d");let c=a,f=!1;if(a.rank===3&&(f=!0,c=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");z(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),z(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),z(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),z(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),z(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const h=u.shape[2],d=u.shape[3];z(l.shape[2]===h*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*d}, but got ${l.shape[2]}.`);const p=ww(c,u,r,i,o,s),g=Af(p,l,1,"valid",o);return f?ne(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const EB=J({separableConv2d_:wke});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Cke(e,t){const n=W(e,"x","setdiff1d"),r=W(t,"y","setdiff1d");z(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),z(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),z(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);const i=await n.data(),s=await r.data(),o=new Set(s);let a=0;for(let c=0;c<i.length;c++)o.has(i[c])||a++;const u=new Gn([a],n.dtype),l=new Gn([a],"int32");for(let c=0,f=0;c<i.length;c++)o.has(i[c])||(u.values[f]=i[c],l.values[f]=c,f++);return[u.toTensor(),l.toTensor()]}const Ske=Cke;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ke(e){const n={x:W(e,"x","sign")};return K.runKernel(x1,n)}const Dte=J({sign_:_ke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ke(e){const n={x:W(e,"x","sin","float32")};return K.runKernel(b1,n)}const AB=J({sin_:$ke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kke(e){const n={x:W(e,"x","sinh")};return K.runKernel(v1,n)}const TB=J({sinh_:kke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eke(e,t,n){const r=W(e,"x","slice1d");return z(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Et(r,[t],[n])}const UT=J({slice1d_:Eke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ake(e,t,n){const r=W(e,"x","slice2d");return z(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Et(r,t,n)}const DB=J({slice2d_:Ake});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tke(e,t,n){const r=W(e,"x","slice3d");return z(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Et(r,t,n)}const WT=J({slice3d_:Tke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dke(e,t,n){const r=W(e,"x","slice4d");return z(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Et(r,t,n)}const Pv=J({slice4d_:Dke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ike(e,t=-1){const n=W(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const r={logits:n},i={dim:t};return K.runKernel(fw,r,i)}const VT=J({softmax_:Ike});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fke(e){z(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);const t={input:e};return K.runKernel(UA,t)}const GT=J({fft_:Fke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oke(e){z(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);const t={input:e};return K.runKernel(HA,t)}const Lv=J({ifft_:Oke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nke(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const i=ne(e,[n,t]);r=Lv(i)}else{const i=[n,2*(t-1)],s=ne(Rv(e),[n,t]),o=ne(FT(e),[n,t]),a=Fo(Et(s,[0,1],[n,t-2]),1),u=Q(Fo(Et(o,[0,1],[n,t-2]),1),et(-1)),l=hr([s,a],1),c=hr([o,u],1),f=ne(kf(l,c),[i[0],i[1]]);r=Lv(f)}if(r=Rv(r),e.rank===3&&e.shape[0]!==0){const i=r,s=e.shape[0];r=ne(r,[s,r.shape[0]/s,r.shape[1]]),i.dispose()}return r}const IB=J({irfft_:Nke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mke(e,t,n=0){const i={x:W(e,"x","split")},s={numOrSizeSplits:t,axis:n};return K.runKernel(cw,i,s)}const ws=J({split_:Mke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rke(e,t){z(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1];const r=e.size/n;let i;if(t!=null&&t<n){const p=e.shape.map(g=>0),m=e.shape.map(g=>g);m[e.shape.length-1]=t,i=Et(e,p,m),n=t}else if(t!=null&&t>n){const p=e.shape.map(m=>m);p[e.shape.length-1]=t-n,i=hr([e,Kn(p)],e.shape.length-1),n=t}else i=e;const s=$t(i),o=ne(kf(i,s),[r,n]),a=GT(o),u=Math.floor(n/2)+1,l=Rv(a),c=FT(a),f=ws(l,[u,n-u],l.shape.length-1),h=ws(c,[u,n-u],c.shape.length-1),d=i.shape.slice();return d[i.shape.length-1]=u,ne(kf(f[0],h[0]),d)}const HT=J({rfft_:Rke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pke(e,t){let n=W(e,"a","squaredDifference"),r=W(t,"b","squaredDifference");[n,r]=An(n,r),rt(n.shape,r.shape);const i={a:n,b:r},s={};return K.runKernel(_1,i,s)}const FB=J({squaredDifference_:Pke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lke(e,t){const n=W(e,"x","squeeze","string_or_numeric");return ne(n,cc(n.shape,t).newShape)}const xh=J({squeeze_:Lke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bke(e,t=0){const n=Dv(e,"tensors","stack","string_or_numeric");z(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&z(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,i={axis:t};return K.runKernel(J2,r,i)}const Ql=J({stack_:Bke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zke(e,t=0){const r={x:W(e,"x","step")},i={alpha:t};return K.runKernel(T1,r,i)}const F1=J({step_:zke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jke(e,t,n,r,i=0,s=0,o=0,a=0,u=0){const c={x:W(e,"x","stridedSlice","string_or_numeric")},f={begin:t,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};return K.runKernel(vT,c,f)}const Ite=J({stridedSlice_:jke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uke(e){const n={x:W(e,"x","tan","float32")};return K.runKernel(k1,n)}const Fte=J({tan_:Uke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ui(e,t){Hp(e);const n=Du(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return gh(e,null,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yb(e,t,n){if(Hp(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Du(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return gh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ote(e,t,n){if(Hp(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=Du(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return gh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wke(e,t,n){if(Hp(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const r=Du(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return gh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vke(e,t,n){if(Hp(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const r=Du(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return gh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gke(e,t,n){if(Hp(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const r=Du(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,gh(e,t,r,n)}function OB(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(e.length<r+(n.rank-i))throw new Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+e.length-r)throw new Error(s+` update.rank != ${i+e.length-r}`);for(let o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(s+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${e[o+i]})`)}function qT(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}OB(n,t,e)}function wh(e,t,n){const r=t.shape.length,i=r>1?t.shape[r-1]:1,s=n.length;let o=1;for(let f=i;f<s;++f)o*=n[f];const a=i<1?1:i,u=ce(t.shape)/a,l=[...Ue(n.slice(0,i)),1],c=ce(n);return{sliceRank:i,numUpdates:u,sliceSize:o,strides:l,outputSize:c}}const Hke=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:wh,validateInput:qT,validateUpdateShape:OB},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qke(e,t,n){const r=W(e,"tensor","tensorScatterupdate"),i=W(t,"indices","tensorScatterupdate","int32"),s=W(n,"updates","tensorScatterupdate");if(qT(s,i,r.shape),r.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${s.dtype}.`);const o={tensor:r,indices:i,updates:s},a={};return K.runKernel(fT,o,a)}const Xke=J({tensorScatterUpdate_:qke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yke(e,t=1,n=!0){const r=W(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${t}`);const s={x:r},o={k:t,sorted:n},[a,u]=K.runKernel(ST,s,o);return{values:a,indices:u}}const Nte=J({topk_:Yke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kke(e,t=0,n=1,r,i){if(Ns(e),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const s=new wB(t,n,r,!0,i),o=ft(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const NB=J({truncatedNormal_:Kke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zke(e,t=0){const n=W(e,"x","unique","string_or_numeric");z(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},i={axis:t},[s,o]=K.runKernel($T,r,i);return{values:s,indices:o}}const Mte=J({unique_:Zke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jke(e,t,n){const r=W(e,"x","unsortedSegmentSum"),i=W(t,"segmentIds","unsortedSegmentSum","int32");z(ap(n),()=>"numSegments must be of dtype int");const s={x:r,segmentIds:i},o={numSegments:n};return K.runKernel(pw,s,o)}const MB=J({unsortedSegmentSum_:Jke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qke(e,t=0){const n=W(e,"x","unstack","string_or_numeric");z(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);const r={value:n},i={axis:t};return K.runKernel(dw,r,i)}const Df=J({unstack_:Qke});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eEe(e,t){return hB(e,t,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rte(e,t=!0,n,r){return K.makeVariable(e,t,n,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XT(e,t){const n=[];for(let s=0;s<t.length;s++)t[s]&&n.push(s);const r=ft(e,"int32"),i=ft([n.length,e.length],"int32");for(let s=0;s<n.length;s++){const o=r.indexToLoc(n[s]),a=s*e.length;i.values.set(o,a)}return i.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function tEe(e){const t=W(e,"condition","whereAsync","bool"),n=await t.data(),r=XT(t.shape,n);return e!==t&&t.dispose(),r}const Pte=tEe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nEe(e,t,n){const r=W(e,"tensor","boolMask"),i=W(t,"mask","boolMask","bool"),s=n??0,o=i.rank,a=r.shape;z(o>0,()=>"mask cannot be scalar"),Nr(a.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let m=s;m<s+o;m++)u*=a[m];const l=a.slice(0,s).concat([u],a.slice(s+o)),c=ne(r,l),f=ne(i,[-1]),h=await Pte(f),d=xh(h,[1]),p=$w(c,d,s);return e!==r&&r.dispose(),t!==i&&i.dispose(),d.dispose(),c.dispose(),f.dispose(),h.dispose(),p}const rEe=nEe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iEe(e,t,n){const r=W(e,"x","transpose");if(t==null&&(t=r.shape.map((o,a)=>a).reverse()),z(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(o=>{z(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();const i={x:r},s={perm:t};return r.dtype==="complex64"?ue(()=>{let o=Rv(r),a=FT(r);return o=K.runKernel(Vd,{x:o},s),a=K.runKernel(Vd,{x:a},s),n&&(a=dn(a)),kf(o,a)}):K.runKernel(Vd,i,s)}const Ct=J({transpose_:iEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sEe(e,t,n,r,i=!0){const s=W(e,"v","movingAverage"),o=W(t,"x","movingAverage"),a=W(n,"decay","movingAverage");bee(s,o),z(_t(s.shape,o.shape),()=>"Shape mismatch in v and x");const u=et(1),l=Ie(u,a);let c=Q(Ie(o,s),l);if(i){z(r!=null,()=>"When using zeroDebias: true, step is required.");const f=W(r,"step","movingAverage");c=je(c,Ie(u,Tf(a,f)))}return be(s,c)}const oEe=J({movingAverage_:sEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aEe(e,t,n){Ns(n);const r=W(e,"indices","scatterND","int32"),i=W(t,"updates","scatterND");qT(i,r,n);const s={indices:r,updates:i},o={shape:n};return K.runKernel(cT,s,o)}const uEe=J({scatterND_:aEe});function lEe(e,t,n,r){if(e.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const i=e.rank>0?e.shape[0]:1,s=e.rank>1?e.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);const o=t.size;if(!(t.rank===0||t.rank===1&&o===i))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${i}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cEe(e,t,n,r=0){Ns(n);const i=W(e,"sparseIndices","sparseToDense","int32"),s=W(t,"sparseValues","sparseToDense","string_or_numeric"),o=W(r,"defaultValue","sparseToDense",s.dtype);lEe(i,s,n,o);const a={sparseIndices:i,sparseValues:s,defaultValue:o},u={outputShape:n};return K.runKernel(yT,a,u)}const fEe=J({sparseToDense_:cEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hEe(e,t){const n=W(t,"indices","gatherND","int32"),i={params:W(e,"x","gatherND","string_or_numeric"),indices:n};return K.runKernel(GA,i)}const dEe=J({gatherND_:hEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pEe(e,t){if(t==null)return e.shape.slice();if(_t(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)t[r]==null&&e.shape[r]!=null?n.push(e.shape[r]):n.push(t[r]);return n}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gEe(e,t,n,r){const i=W(e,"x","dropout");if(z(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),z(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof Vt?i.clone():i;const s=pEe(i,n),o=1-t,a=je(_w(be(eg(s,0,1,"float32",r),o)),o);return Q(i,a)}const Lte=J({dropout_:gEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bte(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function RB(e,t,n){const r=1-e%2,i=new Float32Array(e);for(let s=0;s<e;++s){const o=2*Math.PI*s/(e+r-1);i[s]=t-n*Math.cos(o)}return Ui(i,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function mEe(e,t,n=1){const r=W(e,"predictions","inTopK"),i=W(t,"targets","inTopK");z(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),z(r.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`),Nr(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const s=r.shape[r.shape.length-1];z(n>0&&n<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`);const o=await r.data(),a=await i.data(),[u,l]=[o.length/s,s],c=gr("bool",u);for(let f=0;f<u;f++){const h=f*l,d=o.subarray(h,h+l),p=[];for(let m=0;m<d.length;m++)p.push({value:d[m],index:m});p.sort((m,g)=>g.value-m.value),c[f]=0;for(let m=0;m<n;m++)if(p[m].index===a[f]){c[f]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),Gd(c,i.shape,"bool")}const yEe=mEe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bEe(e,t,n,r,i,s="NHWC",o){let a=e;e.rank===3&&(a=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=ne(t,[1,t.shape[0],t.shape[1],t.shape[2]])),z(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),z(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),z(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const l=s==="NHWC"?a.shape[3]:a.shape[1],c=s==="NHWC"?u.shape[3]:u.shape[1];z(l===n[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`),z(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),Ti("conv2dDerFilter",i,o);const f={x:a,dy:u},h={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,filterShape:n};return K.runKernel(DA,f,h)}const PB=J({conv2DBackpropFilter_:bEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YT(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return Q(e,F1(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function KT(e,t){let n=t;const r=Hn(e.shape,t.shape);return r.length>0&&(n=Oe(n,r)),ne(n,e.shape)}function ZT(e,t,n,r){if(t==="linear")return e;if(t==="relu")return qu(e);if(t==="elu")return Cw(e);if(t==="relu6")return SB(e);if(t==="prelu")return zT(e,n);if(t==="leakyrelu")return OT(e,r);if(t==="sigmoid")return mu(e);throw new Error(`Unknown fused activation ${t}.`)}const JT=(e,t)=>!(e>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vEe({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",JT(K.state.gradientDepth,u)===!1){z(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=Af(e,t,n,r,i,s,o);return a!=null&&(C=be(C,a)),ZT(C,u,l,c)}const f=W(e,"x","conv2d","float32"),h=W(t,"filter","conv2d","float32");let d=f,p=!1;f.rank===3&&(p=!0,d=ne(f,[1,f.shape[0],f.shape[1],f.shape[2]])),z(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),z(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),Ti("fused conv2d",r,o);const m=i==="NHWC"?d.shape[3]:d.shape[1];z(h.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`),z(Mr(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);const g=mr(d.shape,h.shape,n,s,r,o);let y;a!=null&&(y=W(a,"bias","fused conv2d"),[y]=An(y,f),i==="NHWC"?rt(g.outShape,y.shape):(z(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),z(y.shape.length===0||y.shape[0]===g.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let b;if(l!=null){const C=l.shape;if(z(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)z(C[0]===1||C[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${g.outChannels}).`);else if(C.length===3)try{rt(C,g.outShape)}catch{const _=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(_)}b=W(l,"prelu weights","fused conv2d")}const x=(C,S)=>{z(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[_,$,k,E]=S,F=YT(C,k,u);z(Ef(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const T=rB($.shape,F,_,n,r),I=PB($,F,_.shape,n,r),D=[T,I];if(E!=null){const N=KT(E,F);D.push(N)}return D},v={x:d,filter:h,bias:y,preluActivationWeights:b},w={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return a==null?Iu((S,_,$)=>{let k=K.runKernel(kv,v,w);return $([_,S,k]),p&&(k=ne(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:x}})(d,h):Iu((S,_,$,k)=>{let E=K.runKernel(kv,v,w);return k([_,S,E,$]),p&&(E=ne(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:x}})(d,h,y)}const zte=J({fusedConv2d_:vEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xEe(e,t,n,r,i,s=[1,1],o){let a=e;e.rank===3&&(a=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=ne(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:a,dy:u},c={strides:r,pad:i,dimRoundingMode:o,dilations:s,filterShape:n};return K.runKernel(PA,l,c)}const jte=J({depthwiseConv2dNativeBackpropFilter_:xEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wEe(e,t,n,r,i,s=[1,1],o){let a=t,u=!1;t.rank===3&&(u=!0,a=ne(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:a,filter:n},c={strides:r,pad:i,dimRoundingMode:o,dilations:s,inputShape:e},f=K.runKernel(LA,l,c);return u?ne(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Ute=J({depthwiseConv2dNativeBackpropInput_:wEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CEe({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(JT(K.state.gradientDepth,u)===!1){let w=ww(e,t,n,r,i,s,o);return a!=null&&(w=be(w,a)),ZT(w,u,l,c)}const f=W(e,"x","depthwiseConv2d","float32"),h=W(t,"filter","depthwiseConv2d","float32");let d=f,p=!1;f.rank===3&&(p=!0,d=ne(f,[1,f.shape[0],f.shape[1],f.shape[2]])),z(d.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),z(h.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),z(d.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),s==null&&(s=[1,1]),z(Mr(n,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Ti("fused depthwiseConv2d",r,o);const m=mr(d.shape,h.shape,n,s,r,o,!0);let g;a!=null&&(g=W(a,"bias","fused conv2d"),[g]=An(g,f),rt(m.outShape,g.shape));let y;l!=null&&(y=W(l,"prelu weights","fused depthwiseConv2d"));const b=(w,C)=>{z(Ef(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);const[S,_,$,k]=C,E=YT(w,$,u),F=Ute(_.shape,E,S,n,r,s,o),T=jte(_,E,S.shape,n,r,s,o);if(k!=null){const I=KT(g,E);return[F,T,I]}return[F,T]},x={x:d,filter:h,bias:g,preluActivationWeights:y},v={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return a==null?Iu((C,S,_)=>{let $=K.runKernel(Ev,x,v);return _([S,C,$]),p&&($=ne($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:b}})(d,h):Iu((C,S,_,$)=>{let k=K.runKernel(Ev,x,v);return $([S,C,k,_]),p&&(k=ne(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:b}})(d,h,g)}const SEe=J({fusedDepthwiseConv2d_:CEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ee({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(JT(K.state.gradientDepth,s)===!1){let E=pt(e,t,n,r);return i!=null&&(E=be(E,i)),ZT(E,s,o,a)}let u=W(e,"a","fused matMul"),l=W(t,"b","fused matMul");[u,l]=An(u,l);const c=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?l.shape[l.rank-1]:l.shape[l.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],d=r?l.shape[l.rank-2]:l.shape[l.rank-1],p=u.shape.slice(0,-2),m=l.shape.slice(0,-2),g=ce(p),y=ce(m);z(c===f,()=>`Error in fused matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`);const x=rt(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([h,d]),v=n?ne(u,[g,c,h]):ne(u,[g,h,c]),w=r?ne(l,[y,d,f]):ne(l,[y,f,d]);let C;i!=null&&(C=W(i,"bias","fused matMul"),[C]=An(C,u),rt(x,C.shape));let S;o!=null&&(S=W(o,"prelu weights","fused matMul"));const _=(E,F)=>{const[T,I,D,N]=F,V=YT(ne(E,D.shape),D,s);let U,A;if(!n&&!r?(U=pt(V,I,!1,!0),A=pt(T,V,!0,!1)):!n&&r?(U=pt(V,I,!1,!1),A=pt(V,T,!0,!1)):n&&!r?(U=pt(I,V,!1,!0),A=pt(T,V,!1,!1)):(U=pt(I,V,!0,!0),A=pt(V,T,!0,!0)),i!=null){const M=KT(N,V);return[U,A,M]}else return[U,A]},$={a:v,b:w,bias:C,preluActivationWeights:S},k={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:a};return i==null?Iu((F,T,I)=>{const D=K.runKernel($v,$,k);return I([F,T,D]),{value:ne(D,x),gradFunc:_}})(v,w):Iu((F,T,I,D)=>{const N=K.runKernel($v,$,k);return D([F,T,N,I]),{value:ne(N,x),gradFunc:_}})(v,w,C)}const jM=J({fusedMatMul_:_Ee});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ee=Object.freeze(Object.defineProperty({__proto__:null,conv2d:zte,depthwiseConv2d:SEe,matMul:jM},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kEe(e){return RB(e,.54,.46)}const EEe=J({hammingWindow_:kEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AEe(e){return RB(e,.5,.5)}const Wte=J({hannWindow_:AEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TEe(e,t,n,r=!1,i=0){let s=0;const o=[];for(;s+t<=e.size;)o.push(Et(e,s,t)),s+=n;if(r)for(;s<e.size;){const a=s+t-e.size,u=hr([Et(e,s,t-a),D1([a],i)]);o.push(u),s+=n}return o.length===0?Yb([],[0,t]):ne(hr(o),[o.length,t])}const Vte=J({frame_:TEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DEe(e,t,n,r,i=Wte){r==null&&(r=Bte(t));const s=Vte(e,t,n),o=Q(s,i(t));return HT(o,r)}const IEe=J({stft_:DEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FEe(e,t,n,r,i="bilinear",s=0){const o=W(e,"image","cropAndResize"),a=W(t,"boxes","cropAndResize","float32"),u=W(n,"boxInd","cropAndResize","int32"),l=a.shape[0];z(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),z(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),z(u.rank===1&&u.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),z(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),z(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),z(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const c={image:o,boxes:a,boxInd:u},f={method:i,extrapolationValue:s,cropSize:r};return K.runKernel(NA,c,f)}const OEe=J({cropAndResize_:FEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NEe(e){const t=W(e,"image","flipLeftRight","float32");z(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const n={image:t};return K.runKernel(VA,n,{})}const MEe=J({flipLeftRight_:NEe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function REe(e){const t=W(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];z(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),z(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const i=new Array(t.rank);return i.fill(1,0,n),i[n]=3,vo(t,i)}const PEe=J({grayscaleToRGB_:REe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LEe(e,t,n=0,r=.5){const i=W(e,"image","rotateWithOffset","float32");z(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const s={image:i},o={radians:t,fillValue:n,center:r};return K.runKernel(kT,s,o)}const BEe=J({rotateWithOffset_:LEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O1(e,t,n,r,i,s){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),s==null&&(s=0);const o=e.shape[0];return n=Math.min(n,o),z(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),z(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),z(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),z(t.rank===1,()=>"scores must be a 1D tensor"),z(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${t.shape[0]}`),z(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zEe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=W(e,"boxes","nonMaxSuppression","float32"),o=W(t,"scores","nonMaxSuppression","float32"),a=O1(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return K.runKernel(eT,{boxes:s,scores:o},u)}const jEe=J({nonMaxSuppression_:zEe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UEe(e,t,n){const r=WEe(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function WEe(e,t,n){return GEe(e,t,n||VEe)}function VEe(e,t){return e>t?1:e<t?-1:0}function GEe(e,t,n){let r=0,i=e.length,s=0,o=!1;for(;r<i;){s=r+(i-r>>>1);const a=n(t,e[s]);a>0?r=s+1:(i=s,o=!a)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QT(e,t,n,r,i){return LB(e,t,n,r,i,0)}function eD(e,t,n,r,i,s){return LB(e,t,n,r,i,0,!1,s,!0)}function tD(e,t,n,r,i,s){return LB(e,t,n,r,i,s,!0)}function LB(e,t,n,r,i,s,o=!1,a=!1,u=!1){const l=[];for(let g=0;g<t.length;g++)t[g]>i&&l.push({score:t[g],boxIndex:g,suppressBeginIndex:0});l.sort(uV);const c=s>0?-.5/s:0,f=[],h=[];for(;f.length<n&&l.length>0;){const g=l.pop(),{score:y,boxIndex:b,suppressBeginIndex:x}=g;if(y<i)break;let v=!1;for(let w=f.length-1;w>=x;--w){const C=HEe(e,b,f[w]);if(C>=r){v=!0;break}if(g.score=g.score*qEe(r,c,C),g.score<=i)break}g.suppressBeginIndex=f.length,v||(g.score===y?(f.push(b),h.push(g.score)):g.score>i&&UEe(l,g,uV))}const d=f.length,p=n-d;a&&p>0&&(f.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const m={selectedIndices:f};return o&&(m.selectedScores=h),u&&(m.validOutputs=d),m}function HEe(e,t,n){const r=e.subarray(t*4,t*4+4),i=e.subarray(n*4,n*4+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),d=(a-s)*(u-o),p=(f-l)*(h-c);if(d<=0||p<=0)return 0;const m=Math.max(s,l),g=Math.max(o,c),y=Math.min(a,f),b=Math.min(u,h),x=Math.max(y-m,0)*Math.max(b-g,0);return x/(d+p-x)}function qEe(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function uV(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function XEe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=W(e,"boxes","nonMaxSuppressionAsync"),o=W(t,"scores","nonMaxSuppressionAsync"),a=O1(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u=await Promise.all([s.data(),o.data()]),l=u[0],c=u[1],{selectedIndices:f}=QT(l,c,n,r,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),Ui(f,"int32")}const YEe=XEe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KEe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=W(e,"boxes","nonMaxSuppression"),a=W(t,"scores","nonMaxSuppression"),u=O1(o,a,n,r,i,s);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,s=u.softNmsSigma;const l={boxes:o,scores:a},c={maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s},f=K.runKernel(nT,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}const ZEe=J({nonMaxSuppressionWithScore_:KEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function JEe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=W(e,"boxes","nonMaxSuppressionAsync"),a=W(t,"scores","nonMaxSuppressionAsync"),u=O1(o,a,n,r,i,s);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,s=u.softNmsSigma;const l=await Promise.all([o.data(),a.data()]),c=l[0],f=l[1],{selectedIndices:h,selectedScores:d}=tD(c,f,n,r,i,s);return o!==e&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:Ui(h,"int32"),selectedScores:Ui(d)}}const QEe=JEe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eAe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=W(e,"boxes","nonMaxSuppression"),a=W(t,"scores","nonMaxSuppression"),u=O1(o,a,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:a},d={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:s},p=K.runKernel(tT,h,d);return{selectedIndices:p[0],validOutputs:p[1]}}const tAe=J({nonMaxSuppressionPadded_:eAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nAe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=W(e,"boxes","nonMaxSuppressionAsync"),a=W(t,"scores","nonMaxSuppressionAsync"),u=O1(o,a,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,[h,d]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:m}=eD(h,d,l,c,f,s);return o!==e&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:Ui(p,"int32"),validOutputs:et(m,"int32")}}const rAe=nAe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iAe(e,t,n=!1,r=!1){const i=W(e,"images","resizeBilinear");z(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),z(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),z(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=i,o=!1;i.rank===3&&(o=!0,s=ne(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},l=K.runKernel(iw,a,u);return o?ne(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const Gte=J({resizeBilinear_:iAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sAe(e,t,n=!1,r=!1){const i=W(e,"images","resizeNearestNeighbor");z(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),z(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),z(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),z(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=i,o=!1;i.rank===3&&(o=!0,s=ne(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},l=K.runKernel(rw,a,u);return o?ne(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const Hte=J({resizeNearestNeighbor_:sAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oAe(e,t="binary",n=!1,r=.5){const i=W(e,"image","threshold"),s=.2989,o=.587,a=.114,u=i.shape[0]*i.shape[1];let l=Q(Ui([r]),255),c,f,h,d;if(z(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),z(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),z(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),z(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),i.shape[2]===3){[c,f,h]=ws(i,[1,1,1],-1);const g=Q(c,s),y=Q(f,o),b=Q(h,a);d=be(be(g,y),b)}else d=e;if(t==="otsu"){const g=Kee(Ee(_B(d),"int32"),Gd([]),256);l=aAe(g,u)}const p=n?Jp(d,l):Rs(d,l);return Ee(Q(p,255),"int32")}function aAe(e,t){let n=Ui([-1]),r=Ui([0]),i=Ui([0]),s,o,a,u,l,c;for(let f=0;f<e.size-1;f++){s=Et(e,0,f+1),o=Et(e,f+1),l=je(Oe(s),t),c=je(Oe(o),t);const h=Oe(Q(s,Lm(0,s.size)));a=je(h,Oe(s));const d=D1(o.shape,s.size),p=be(Lm(0,o.size),d),m=Q(o,p);u=je(Oe(m),Oe(o));const g=Ie(a,u),y=Ie(a,u),b=Q(l,c);i=Q(Q(b,g),y);const x=Rs(i,r);r=Yr(x,i,r),n=Yr(x,Ui([f]),n)}return n}const uAe=J({threshold_:oAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lAe(e,t,n="nearest",r="constant",i=0,s){const o=W(e,"image","transform","float32"),a=W(t,"transforms","transform","float32");z(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),z(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),z(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);const u={image:o,transforms:a},l={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return K.runKernel(_T,u,l)}const cAe=J({transform_:lAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fAe(e,t,n){const r=W(e,"a","bandPart");z(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const i=r.shape,[s,o]=r.shape.slice(-2);let a,u;typeof t=="number"?(z(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),z(t<=s,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`),a=W(t<0?s:t,"numLower","bandPart")):(z(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Yr(Nv(t,0),s,hp(t,s))),typeof n=="number"?(z(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),z(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),u=W(n<0?o:n,"numUpper","bandPart")):(z(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=Yr(Nv(n,0),o,hp(n,o)));const l=ne(Lm(0,s,1,"int32"),[-1,1]),c=Lm(0,o,1,"int32"),f=Ie(l,c),h=Fu(Jp(f,a),bh(f,dn(u))),d=Kn([s,o],r.dtype);return ne(Ql(Df(ne(r,[-1,s,o])).map(p=>Yr(h,p,d))),i)}const hAe=J({bandPart_:fAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dAe(e){let t;if(Array.isArray(e)){t=!1,z(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=e[0].shape[0];for(let s=1;s<e.length;++s)z(e[s].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[s].shape[0]} vs. ${i})`)}else t=!0,e=ws(e,e.shape[0],0).map(i=>xh(i,[0]));z(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);const n=[],r=e;for(let i=0;i<e.length;++i)n.push(K.tidy(()=>{let s=r[i];if(i>0)for(let o=0;o<i;++o){const a=Q(Oe(Q(n[o],s)),n[o]);s=Ie(s,a)}return je(s,Sw(s,"euclidean"))}));return t?Ql(n,0):n}const pAe=J({gramSchmidt_:dAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gAe(e,t=!1){if(z(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return lV(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((u,l)=>u*l),r=Df(ne(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],s=[];r.forEach(u=>{const[l,c]=lV(u,t);i.push(l),s.push(c)});const o=ne(Ql(i,0),e.shape),a=ne(Ql(s,0),e.shape);return[o,a]}}function lV(e,t=!1){return K.tidy(()=>{z(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);const n=e.shape[0],r=e.shape[1];let i=uB(n),s=df(e);const o=Yb([[1]],[1,1]);let a=df(o);const u=n>=r?r:n;for(let l=0;l<u;++l){const c=s,f=a,h=i;[a,s,i]=K.tidy(()=>{const d=Et(s,[l,l],[n-l,1]),p=Sw(d),m=Et(s,[l,l],[1,1]),g=Yr(Rs(m,0),Yb([[-1]]),Yb([[1]])),y=Ie(m,Q(g,p)),b=je(d,y);b.shape[0]===1?a=df(o):a=hr([o,Et(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const x=dn(je(pt(g,y),p)),v=Et(s,[l,0],[n-l,r]),w=Q(x,a),C=Ct(a);if(l===0)s=Ie(v,pt(w,pt(C,v)));else{const $=Ie(v,pt(w,pt(C,v)));s=hr([Et(s,[0,0],[l,r]),$],0)}const S=Ct(w),_=Et(i,[0,l],[n,i.shape[1]-l]);if(l===0)i=Ie(_,pt(pt(_,a),S));else{const $=Ie(_,pt(pt(_,a),S));i=hr([Et(i,[0,0],[n,l]),$],1)}return[a,s,i]}),ct([c,f,h])}return!t&&n>r&&(i=Et(i,[0,0],[n,r]),s=Et(s,[0,0],[r,r])),[i,s]})}const mAe=J({qr_:gAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hi;(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(hi||(hi={}));function yAe(e,t,n=hi.SUM_BY_NONZERO_WEIGHTS){const r=W(e,"losses","computeWeightedLoss");let i=null;t!=null&&(i=W(t,"weights","computeWeightedLoss"));const s=i==null?r:Q(r,i);if(n===hi.NONE)return s;if(n===hi.SUM)return Oe(s);if(n===hi.MEAN){if(i==null)return In(s);{const o=r.size/i.size,a=je(Oe(s),Oe(i));return o>1?je(a,et(o)):a}}if(n===hi.SUM_BY_NONZERO_WEIGHTS){if(i==null)return je(Oe(s),et(r.size));{const o=Q(i,Vs(r.shape)),a=Ee(Oe(Pm(o,et(0))),"float32");return je(Oe(s),a)}}throw Error(`Unknown reduction: ${n}`)}const gc=J({computeWeightedLoss_:yAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bAe(e,t,n,r=hi.SUM_BY_NONZERO_WEIGHTS){const i=W(e,"labels","absoluteDifference"),s=W(t,"predictions","absoluteDifference");let o=null;n!=null&&(o=W(n,"weights","absoluteDifference")),Nr(i.shape,s.shape,"Error in absoluteDifference: ");const a=Yn(Ie(i,s));return gc(a,o,r)}const vAe=J({absoluteDifference_:bAe});function xAe(e,t,n,r,i=hi.SUM_BY_NONZERO_WEIGHTS){const s=W(e,"labels","cosineDistance"),o=W(t,"predictions","cosineDistance");let a=null;r!=null&&(a=W(r,"weights","cosineDistance")),Nr(s.shape,o.shape,"Error in cosineDistance: ");const u=et(1),l=Ie(u,Oe(Q(s,o),n,!0));return gc(l,a,i)}const wAe=J({cosineDistance_:xAe});function CAe(e,t,n,r=hi.SUM_BY_NONZERO_WEIGHTS){let i=W(e,"labels","hingeLoss");const s=W(t,"predictions","hingeLoss");let o=null;n!=null&&(o=W(n,"weights","hingeLoss")),Nr(i.shape,s.shape,"Error in hingeLoss: ");const a=et(1);i=Ie(Q(et(2),i),a);const u=qu(Ie(a,Q(i,s)));return gc(u,o,r)}const SAe=J({hingeLoss_:CAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ae(e,t,n,r=1,i=hi.SUM_BY_NONZERO_WEIGHTS){const s=W(e,"labels","huberLoss"),o=W(t,"predictions","huberLoss");let a=null;n!=null&&(a=W(n,"weights","huberLoss")),Nr(s.shape,o.shape,"Error in huberLoss: ");const u=et(r),l=Yn(Ie(o,s)),c=hp(l,u),f=Ie(l,c),h=be(Q(et(.5),Jt(c)),Q(u,f));return gc(h,a,i)}const $Ae=J({huberLoss_:_Ae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kAe(e,t,n,r=1e-7,i=hi.SUM_BY_NONZERO_WEIGHTS){const s=W(e,"labels","logLoss"),o=W(t,"predictions","logLoss");let a=null;n!=null&&(a=W(n,"weights","logLoss")),Nr(s.shape,o.shape,"Error in logLoss: ");const u=et(1),l=et(r),c=dn(Q(s,Js(be(o,l)))),f=Q(Ie(u,s),Js(be(Ie(u,o),l))),h=Ie(c,f);return gc(h,a,i)}const EAe=J({logLoss_:kAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AAe(e,t,n,r=hi.SUM_BY_NONZERO_WEIGHTS){const i=W(e,"labels","meanSquaredError"),s=W(t,"predictions","meanSquaredError");let o=null;n!=null&&(o=W(n,"weights","meanSquaredError")),Nr(i.shape,s.shape,"Error in meanSquaredError: ");const a=FB(i,s);return gc(a,o,r)}const TAe=J({meanSquaredError_:AAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DAe(e,t){const n=W(e,"labels","sigmoidCrossEntropyWithLogits"),r=W(t,"logits","sigmoidCrossEntropyWithLogits");Nr(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=qu(r),s=Q(r,n),o=NT(Zs(dn(Yn(r))));return be(Ie(i,s),o)}function IAe(e,t,n,r=0,i=hi.SUM_BY_NONZERO_WEIGHTS){let s=W(e,"multiClassLabels","sigmoidCrossEntropy");const o=W(t,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=W(n,"weights","sigmoidCrossEntropy")),Nr(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const l=et(r),c=et(1),f=et(.5);s=be(Q(s,Ie(c,l)),Q(f,l))}const u=DAe(s,o);return gc(u,a,i)}const FAe=J({sigmoidCrossEntropy_:IAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OAe(e,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return Iu((i,s,o)=>{const u=cB(s,[n],!0),l=Ie(Ee(s,"float32"),u);o([i,l]);const c=dn(Q(l,i));return{value:Oe(c,[n]),gradFunc:(d,p)=>{const[m,g]=p,y=Bn(d.shape,[n]);return[Q(ne(d,y),Ie(Ee(m,"float32"),Zs(g))),Q(ne(d,y),Ie(Zs(g),Ee(m,"float32")))]}}})(e,t)}function NAe(e,t,n,r=0,i=hi.SUM_BY_NONZERO_WEIGHTS){let s=W(e,"onehotLabels","softmaxCrossEntropy");const o=W(t,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=W(n,"weights","softmaxCrossEntropy")),Nr(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const l=et(r),c=et(1),f=et(s.shape[1]);s=be(Q(s,Ie(c,l)),je(l,f))}const u=OAe(s,o);return gc(u,a,i)}const MAe=J({softmaxCrossEntropy_:NAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RAe(e,t,n,r){const i=W(e,"indices","sparseFillEmptyRows","int32"),s=W(t,"values","sparseFillEmptyRows"),o=W(n,"denseShape","sparseFillEmptyRows","int32"),a=W(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(i.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${i.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:i,values:s,denseShape:o,defaultValue:a},l=K.runKernel(dT,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}const PAe=J({sparseFillEmptyRows_:RAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LAe(e,t,n){const r=W(e,"inputIndices","sparseReshape","int32"),i=W(t,"inputShape","sparseReshape","int32"),s=W(n,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const o={inputIndices:r,inputShape:i,newShape:s},a=K.runKernel(pT,o);return{outputIndices:a[0],outputShape:a[1]}}const BAe=J({sparseReshape_:LAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zAe(e,t,n){const r=W(e,"data","sparseSegmentMean"),i=W(t,"indices","sparseSegmentMean","int32"),s=W(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${i.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return K.runKernel(gT,o)}const jAe=J({sparseSegmentMean_:zAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UAe(e,t,n){const r=W(e,"data","sparseSegmentSum"),i=W(t,"indices","sparseSegmentSum","int32"),s=W(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${i.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return K.runKernel(mT,o)}const WAe=J({sparseSegmentSum_:UAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VAe(e,t,n,r,i,s,o,a){const u=W(e,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);const l=W(t,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:r,leftPad:i,rightPad:s,padWidth:o,preserveShortSequences:a},f={data:u,dataSplits:l},h=K.runKernel(xT,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}const GAe=J({stringNGrams_:VAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HAe(e,t,n=!0){const r=W(e,"input","stringSplit","string"),i=W(t,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(i.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const s={skipEmpty:n},o={input:r,delimiter:i},a=K.runKernel(wT,o,s);return{indices:a[0],values:a[1],shape:a[2]}}const qAe=J({stringSplit_:HAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XAe(e,t){const n=W(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return K.runKernel(CT,i,r)}const YAe=J({stringToHashBucketFast_:XAe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KAe(e,t,n,r=!0){const i=W(e,"input","staticRegexReplace","string"),s={pattern:t,rewrite:n,replaceGlobal:r};return K.runKernel(hw,{x:i},s)}const ZAe=J({staticRegexReplace_:KAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JAe={fft:GT,ifft:Lv,rfft:HT,irfft:IB},QAe={hammingWindow:EEe,hannWindow:Wte,frame:Vte,stft:IEe},fu={flipLeftRight:MEe,grayscaleToRGB:PEe,resizeNearestNeighbor:Hte,resizeBilinear:Gte,rotateWithOffset:BEe,cropAndResize:OEe,nonMaxSuppression:jEe,nonMaxSuppressionAsync:YEe,nonMaxSuppressionWithScore:ZEe,nonMaxSuppressionWithScoreAsync:QEe,nonMaxSuppressionPadded:tAe,nonMaxSuppressionPaddedAsync:rAe,threshold:uAe,transform:cAe},qte={bandPart:hAe,gramSchmidt:pAe,qr:mAe},eTe={absoluteDifference:vAe,computeWeightedLoss:gc,cosineDistance:wAe,hingeLoss:SAe,huberLoss:$Ae,logLoss:EAe,meanSquaredError:TAe,sigmoidCrossEntropy:FAe,softmaxCrossEntropy:MAe},tTe={sparseFillEmptyRows:PAe,sparseReshape:BAe,sparseSegmentMean:jAe,sparseSegmentSum:WAe},nTe={stringNGrams:GAe,stringSplit:qAe,stringToHashBucketFast:YAe,staticRegexReplace:ZAe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tg{getClassName(){return this.constructor.className}static fromConfig(t,n){return new t(n)}}class Us{constructor(){this.classNameMap={}}static getMap(){return Us.instance==null&&(Us.instance=new Us),Us.instance}static register(t){Us.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function ve(e){z(e.className!=null,()=>"Class being registered does not have the static className property defined."),z(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),z(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Us.register(e)}const rTe=Object.freeze(Object.defineProperty({__proto__:null,Serializable:tg,SerializationMap:Us,registerClass:ve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mc extends tg{minimize(t,n=!1,r){const{value:i,grads:s}=this.computeGradients(t,r);if(r!=null){const o=r.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(o)}else this.applyGradients(s);return ct(s),n?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,n){return bte(t,n)}dispose(){this.iterations_!=null&&ct(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:et(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(mc,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BB extends mc{static get className(){return"Adadelta"}constructor(t,n,r=null){super(),this.learningRate=t,this.rho=n,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=K.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=K.registeredVariables[r],o=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accum_grad`,variable:ue(()=>$t(s).variable(o))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${r}/accum_var`,variable:ue(()=>$t(s).variable(o))});const a=Array.isArray(t)?t[i].tensor:t[r];if(a==null)return;const u=this.accumulatedGrads[i].variable,l=this.accumulatedUpdates[i].variable;ue(()=>{const c=be(Q(u,this.rho),Q(Jt(a),1-this.rho)),f=Q(je(Zr(be(l,this.epsilon)),Zr(be(u,this.epsilon))),a),h=be(Q(l,this.rho),Q(Jt(f),1-this.rho));u.assign(c),l.assign(h);const d=be(Q(f,-this.learningRate),s);s.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ct(this.accumulatedGrads.map(t=>t.variable)),ct(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=t.length/2,r=!1;this.accumulatedGrads=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedUpdates=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zB extends mc{static get className(){return"Adagrad"}constructor(t,n=.1){super(),this.learningRate=t,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=K.registeredVariables[r];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accumulator`,variable:ue(()=>D1(s.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(t)?t[i].tensor:t[r];if(o==null)return;const a=this.accumulatedGrads[i].variable;ue(()=>{const u=be(a,Jt(o));a.assign(u);const l=be(Q(je(o,Zr(be(u,K.backend.epsilon()))),-this.learningRate),s);s.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ct(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulatedGrads=t.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,n){return new t(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jB extends mc{static get className(){return"Adam"}constructor(t,n,r,i=null){super(),this.learningRate=t,this.beta1=n,this.beta2=r,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ue(()=>{this.accBeta1=et(n).variable(),this.accBeta2=et(r).variable()}),i==null&&(this.epsilon=K.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);ue(()=>{const r=Ie(1,this.accBeta1),i=Ie(1,this.accBeta2);n.forEach((s,o)=>{const a=K.registeredVariables[s],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:ue(()=>$t(a).variable(u))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${s}/v`,variable:ue(()=>$t(a).variable(u))});const l=Array.isArray(t)?t[o].tensor:t[s];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,h=be(Q(c,this.beta1),Q(l,1-this.beta1)),d=be(Q(f,this.beta2),Q(Jt(l),1-this.beta2)),p=je(h,r),m=je(d,i);c.assign(h),f.assign(d);const g=be(Q(je(p,be(Zr(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(Q(this.accBeta1,this.beta1)),this.accBeta2.assign(Q(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ct(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&ct(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t),ue(()=>{this.accBeta1.assign(Tf(this.beta1,this.iterations_+1)),this.accBeta2.assign(Tf(this.beta2,this.iterations_+1))});const n=t.length/2,r=!1;this.accumulatedFirstMoment=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedSecondMoment=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UB extends mc{static get className(){return"Adamax"}constructor(t,n,r,i=null,s=0){super(),this.learningRate=t,this.beta1=n,this.beta2=r,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ue(()=>{this.iteration=et(0).variable(),this.accBeta1=et(n).variable()}),i==null&&(this.epsilon=K.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);ue(()=>{const r=Ie(1,this.accBeta1),i=je(-this.learningRate,be(Q(this.iteration,this.decay),1));n.forEach((s,o)=>{const a=K.registeredVariables[s],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:$t(a).variable(u)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${s}/v`,variable:$t(a).variable(u)});const l=Array.isArray(t)?t[o].tensor:t[s];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,h=be(Q(c,this.beta1),Q(l,1-this.beta1)),d=Q(f,this.beta2),p=Yn(l),m=pc(d,p);c.assign(h),f.assign(m);const g=be(Q(je(i,r),je(h,be(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(be(this.iteration,1)),this.accBeta1.assign(Q(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ct(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&ct(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nD extends mc{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=Array.isArray(t)?t[i].tensor:t[r];if(s==null)return;const o=K.registeredVariables[r];ue(()=>{const a=be(Q(this.c,s),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=va(et(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,n){return new t(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WB extends nD{static get className(){return"Momentum"}constructor(t,n,r=!1){super(t),this.learningRate=t,this.momentum=n,this.useNesterov=r,this.accumulations=[],this.m=et(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=K.registeredVariables[r];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${r}/momentum`,variable:ue(()=>$t(s).variable(!1))});const o=this.accumulations[i].variable,a=Array.isArray(t)?t[i].tensor:t[r];a!=null&&ue(()=>{let u;const l=be(Q(this.m,o),a);this.useNesterov?u=be(Q(this.c,be(a,Q(l,this.m))),s):u=be(Q(this.c,l),s),o.assign(l),s.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ct(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulations=t.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VB extends mc{static get className(){return"RMSProp"}constructor(t,n=.9,r=0,i=null,s=!1){if(super(),this.learningRate=t,this.decay=n,this.momentum=r,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=K.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=K.registeredVariables[r],o=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${r}/rms`,variable:ue(()=>$t(s).variable(o))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${r}/momentum`,variable:ue(()=>$t(s).variable(o))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${r}/mg`,variable:ue(()=>$t(s).variable(o))});const a=Array.isArray(t)?t[i].tensor:t[r];if(a==null)return;const u=this.accumulatedMeanSquares[i].variable,l=this.accumulatedMoments[i].variable;ue(()=>{const c=be(Q(u,this.decay),Q(Jt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[i].variable,h=be(Q(f,this.decay),Q(a,1-this.decay)),d=je(Q(a,this.learningRate),Zr(Ie(c,be(Jt(h),this.epsilon)))),p=be(Q(l,this.momentum),d);u.assign(c),f.assign(h),l.assign(p);const m=Ie(s,p);s.assign(m)}else{const f=be(Q(u,this.decay),Q(Jt(a),1-this.decay)),h=be(Q(l,this.momentum),je(Q(a,this.learningRate),Zr(be(f,this.epsilon))));u.assign(f),l.assign(h);const d=Ie(s,h);s.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ct(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ct(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&ct(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=this.centered?t.length/3:t.length/2,r=!1;this.accumulatedMeanSquares=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedMoments=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iTe=[BB,zB,jB,UB,WB,VB,nD];function sTe(){for(const e of iTe)ve(e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oTe="model",aTe=".json",uTe=".weights.bin";function cV(e){return new Promise(t=>setTimeout(t)).then(e)}class dp{constructor(t){if(!ae().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(dp.URL_SCHEME)&&(t=t.slice(dp.URL_SCHEME.length)),(t==null||t.length===0)&&(t=oTe),this.modelJsonFileName=t+aTe,this.weightDataFileName=t+uTe}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=Hu.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const i=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],s=_ee(t,i),o=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await cV(()=>a.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){const u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=r,await cV(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:bw(t)}}}}dp.URL_SCHEME="downloads://";class lTe{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise((t,n)=>{const r=new FileReader;r.onload=i=>{const s=JSON.parse(i.target.result),o=s.modelTopology;if(o==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(s.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){t({modelTopology:o});return}const u=Z4(s,l=>this.loadWeights(l));t(u)},r.onerror=i=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})}loadWeights(t){const n=[],r=[];for(const o of t)n.push(...o.weights),r.push(...o.paths);const i=this.checkManifestAndWeightFiles(t),s=r.map(o=>this.loadWeightsFile(o,i[o]));return Promise.all(s).then(o=>[n,o])}loadWeightsFile(t,n){return new Promise((r,i)=>{const s=new FileReader;s.onload=o=>{const a=o.target.result;r(a)},s.onerror=o=>i(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(t){const n=[],r=this.weightsFiles.map(s=>aV(s.name)),i={};for(const s of t)s.paths.forEach(o=>{const a=aV(o);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),r.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);i[o]=this.weightsFiles[r.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return i}}const cTe=e=>ae().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(dp.URL_SCHEME)?fTe(e.slice(dp.URL_SCHEME.length)):null;_n.registerSaveRouter(cTe);function fTe(e="model"){return new dp(e)}function hTe(e){return new lTe(e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(e,t,n,r){o(e),n=n??0,r=r??1,a(n,r);let i=0;const s=u=>(u.then(l=>{const c=n+ ++i/e.length*(r-n);return t(c),l}),u);function o(u){z(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function a(u,l){z(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),z(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),z(l>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${l}`)}return Promise.all(e.map(s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Xte(e,t){t==null&&(t={});const n=t.fetchFunc==null?ae().platform.fetch:t.fetchFunc,r=e.map(f=>n(f,t.requestInit,{isBinary:!0})),i=0,s=.5,a=(t.onProgress==null?await Promise.all(r):await fV(r,t.onProgress,i,s)).map(f=>f.arrayBuffer()),u=.5,l=1;return t.onProgress==null?await Promise.all(a):await fV(a,t.onProgress,u,l)}async function dTe(e,t="",n,r){return Yte(o=>Xte(o,{requestInit:r}))(e,t,n)}function Yte(e){return async(t,n="",r)=>{const i=t.map(()=>!1),s={},o=r!=null?r.map(()=>!1):[],a=[];if(t.forEach((d,p)=>{let m=0;d.weights.forEach(g=>{const y="quantization"in g?g.quantization.dtype:g.dtype,b=OM[y]*ce(g.shape),x=()=>{i[p]=!0,s[p]==null&&(s[p]=[]),s[p].push({manifestEntry:g,groupOffset:m,sizeBytes:b})};r!=null?r.forEach((v,w)=>{v===g.name&&(x(),o[w]=!0)}):x(),a.push(g.name),m+=b})}),!o.every(d=>d)){const d=r.filter((p,m)=>!o[m]);throw new Error(`Could not find weights in manifest with names: ${d.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const u=i.reduce((d,p,m)=>(p&&d.push(m),d),[]),l=[];u.forEach(d=>{t[d].paths.forEach(p=>{const m=n+(n.endsWith("/")?"":"/")+p;l.push(m)})});const c=await e(l),f={};let h=0;return u.forEach(d=>{const p=t[d].paths.length,m=new Hu(c.slice(h,h+p));s[d].forEach(y=>{const b=m.slice(y.groupOffset,y.groupOffset+y.sizeBytes),x=Y4(b,[y.manifestEntry]);for(const v in x)f[v]=x[v]}),h+=p}),f}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pTe="application/octet-stream",gTe="application/json";class GB{constructor(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(z(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=ae().platform.fetch,z(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&z(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],i=_ee(t,r);if(n.body.append("model.json",new Blob([JSON.stringify(i)],{type:gTe}),"model.json"),t.weightData!=null){const o=Hu.join(t.weightData);n.body.append("model.weights.bin",new Blob([o],{type:pTe}),"model.weights.bin")}const s=await this.fetch(this.path,n);if(s.ok)return{modelArtifactsInfo:bw(t),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await t.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const r=n.modelTopology,i=n.weightsManifest;if(r==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return Z4(n,s=>this.loadWeights(s))}async loadWeights(t){const n=Array.isArray(this.path)?this.path[1]:this.path,[r,i]=mTe(n),s=this.weightPathPrefix||r,o=kee(t),a=[],u=[];for(const c of t)for(const f of c.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):a.push(s+f+i);this.weightUrlConverter&&a.push(...await Promise.all(u));const l=await Xte(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,l]}}GB.URL_SCHEME_REGEX=/^https?:\/\//;function mTe(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),i=n>t?e.substring(n):"";return[r+"/",i]}function UM(e){return e.match(GB.URL_SCHEME_REGEX)!=null}const Kte=(e,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(e)?n=e.every(r=>UM(r)):n=UM(e),n)return HB(e,t)}return null};_n.registerSaveRouter(Kte);_n.registerLoadRouter(Kte);function HB(e,t){return new GB(e,t)}function Zte(e,t){return HB(e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HO{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class Jte{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class yTe{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=n=>Promise.resolve(t.save(n)))}}function bTe(e,t,n,r){const i=arguments;return new yTe(Qte(...i))}function Qte(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new HO(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new HO({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new HO({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function vTe(e){return new Jte(e)}function xTe(e){return new Jte(e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wTe=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Hu,browserFiles:hTe,browserHTTPRequest:Zte,concatenateArrayBuffers:See,copyModel:Jwe,decodeWeights:Y4,encodeWeights:NM,fromMemory:bTe,fromMemorySync:Qte,getLoadHandlers:Aee,getModelArtifactsForJSON:Z4,getModelArtifactsForJSONSync:$ee,getModelArtifactsInfoForJSON:bw,getSaveHandlers:Eee,getWeightSpecs:kee,http:HB,isHTTPScheme:UM,listModels:Kwe,loadWeights:dTe,moveModel:Qwe,registerLoadRouter:Lwe,registerSaveRouter:Pwe,removeModel:Zwe,weightsLoaderFactory:Yte,withSaveHandler:vTe,withSaveHandlerSync:xTe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CTe(e,t,n){const r=W(e,"labels","confusionMatrix"),i=W(t,"predictions","confusionMatrix");z(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),z(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),z(i.rank===1,()=>`Expected the rank of predictions to be 1, but got ${i.rank}`),z(r.shape[0]===i.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`),z(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);const s=Mv(Ee(r,"int32"),n),o=Mv(Ee(i,"int32"),n),a=Ct(s),u=pt(a,o);return Ee(u,"int32")}const STe=J({confusionMatrix_:CTe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Te=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:STe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Hh,hV=!1;function ene(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,o=!1,a=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else if(e.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);if(_$(S$,K.backendName)!=null){const p={pixels:e},m={numChannels:t};return K.runKernel(S$,p,m)}const[l,c]=i?[e.videoWidth,e.videoHeight]:[e.width,e.height];let f;if(o)f=e.getContext("2d").getImageData(0,0,l,c).data;else if(r||n)f=e.data;else if(s||i||a){if(Hh==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Hh=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Hh=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Hh.canvas.width=l,Hh.canvas.height=c,Hh.drawImage(e,0,0,l,c),f=Hh.getImageData(0,0,l,c).data}let h;if(t===4)h=new Int32Array(f);else{const p=l*c;h=new Int32Array(p*t);for(let m=0;m<p;m++)for(let g=0;g<t;++g)h[m*t+g]=f[m*4+g]}return Ote(h,[c,l,t],"int32")}function $Te(e){return e!=null&&e.data instanceof Uint8Array}function kTe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function ETe(e){return e!=null&&e.width!==0&&e.height!==0}function ATe(e){return kTe()&&!(e instanceof ImageBitmap)&&ETe(e)&&!$Te(e)}async function TTe(e,t=3){let n=null;if(ae().getBool("WRAP_TO_IMAGEBITMAP")&&ATe(e)){let r;try{r=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===e.width&&r.height===e.height?n=r:n=e}else n=e;return ene(n,t)}function tne(e){if(e.rank!==2&&e.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);const t=e.rank===2?1:e.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(e.dtype!=="float32"&&e.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`)}function DTe(e){const t=(e==null?void 0:e.alpha)||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}async function ITe(e,t){let n=W(e,"img","toPixels");if(!(e instanceof Vt)){const l=n;n=Ee(l,"int32"),l.dispose()}tne(n);const[r,i]=n.shape.slice(0,2),s=n.rank===2?1:n.shape[2],o=await n.data(),a=n.dtype==="float32"?255:1,u=new Uint8ClampedArray(i*r*4);for(let l=0;l<r*i;++l){const c=[0,0,0,255];for(let h=0;h<s;h++){const d=o[l*s+h];if(n.dtype==="float32"){if(d<0||d>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${d}.`)}else if(n.dtype==="int32"&&(d<0||d>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${d}.`);s===1?(c[0]=d*a,c[1]=d*a,c[2]=d*a):c[h]=d*a}const f=l*4;u[f+0]=Math.round(c[0]),u[f+1]=Math.round(c[1]),u[f+2]=Math.round(c[2]),u[f+3]=Math.round(c[3])}if(t!=null){hV||(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),hV=!0),t.width=i,t.height=r;const l=t.getContext("2d"),c=new ImageData(u,i,r);l.putImageData(c,0,0)}return n!==e&&n.dispose(),u}function FTe(e,t,n){let r=W(e,"img","draw");if(!(e instanceof Vt)){const o=r;r=Ee(o,"int32"),o.dispose()}tne(r),DTe(n==null?void 0:n.imageOptions);const i={image:r},s={canvas:t,options:n};K.runKernel(W4,i,s)}const nne=J({fromPixels_:ene}),OTe=Object.freeze(Object.defineProperty({__proto__:null,draw:FTe,fromPixels:nne,fromPixelsAsync:TTe,toPixels:ITe},Symbol.toStringTag,{value:"Module"}));function rD(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(ce(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const i=t.shape,s=i[i.length-1];let o=1;for(let f=0;f<i.length-1;++f)o*=i[f];const a=e.shape,u=i.slice();u.pop();let l=1;for(let f=s;f<n;++f)l*=a[f],u.push(a[f]);const c=[...Ue(e.shape).map(f=>f/l),1].slice(0,s);return[u,o,l,c]}const NTe=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:rD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WM=-2,MTe=-1;function qB(e,t,n){const r=e.shape.length;z(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),z(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let i=0;i<r;++i)z(t[i]+n[i]<=e.shape[i],()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${t[i]+n[i]}) would overflow input.shape[${i}] (${e.shape[i]})`)}function RTe(e){const t=[];let n=0;for(;e>0;)e&1&&t.push(n),e/=2,n++;return t}function XB(e,t,n){const r=[];for(let i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function rne(e,t,n,r){const i=[...e];for(let s=i.length;s<r.length;s++)i.push(1);for(let s=0;s<n;s++)s===0?i[t]=1:(i.splice(t,0,1),i.pop());return i}function ine(e,t,n){return n<=e?n:n-(t-1)}function sne(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function PTe(e,t,n,r,i,s,o,a,u){const l=e.length;let c=new Array(l),f=new Array(l),h=new Array(l);if(t.length&&n>0){const d=t[0],p=n+1;c=one(o,d,p,r,e),f=ane(a,d,p,i,e),h=rne(s,d,p,e)}else for(let d=0;d<l;d++)c[d]=lne(o,r,s,e,d,u),f[d]=cne(a,i,s,e,d,u),h[d]=une(s,d,u);return{begin:c,end:f,strides:h}}function one(e,t,n,r,i){const s=[...i],o=sne(n,t);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const u=ine(t,n,a);let l=r[u];e&1<<u&&(l=0),s[a]=l}return s}function ane(e,t,n,r,i){const s=[...i],o=sne(n,t);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const u=ine(t,n,a);let l=r[u];e&1<<u&&(l=Number.MAX_SAFE_INTEGER),s[a]=l}for(let a=0;a<s.length;a++){const u=i[a];s[a]<0&&(s[a]+=u),s[a]=_f(0,s[a],i[a])}return s}function une(e,t,n){let r=e[t];return(n&1<<t||r==null)&&(r=1),r}function lne(e,t,n,r,i,s){let o=t[i];const a=n[i]||1;(e&1<<i||s&1<<i||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const u=r[i];return o<0&&(o+=u),o=_f(0,o,u-1),o}function cne(e,t,n,r,i,s){let o=t[i];const a=n[i]||1;(e&1<<i||s&1<<i||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const u=r[i];return o<0&&(o+=u),a>0?o=_f(0,o,u):o=_f(-1,o,u-1),o}function YB(e,t,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function KB(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function iD(e,t,n){let r;const i=e.shape.length;typeof t=="number"?r=[t,...new Array(i-1).fill(0)]:t.length<i?r=t.concat(new Array(i-t.length).fill(0)):r=t.slice(),r.forEach(o=>{z(o!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(i).fill(-1):typeof n=="number"?s=[n,...new Array(i-1).fill(-1)]:n.length<i?s=n.concat(new Array(i-n.length).fill(-1)):s=n,s=s.map((o,a)=>o>=0?o:(z(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),e.shape[a]-r[a])),[r,s]}function ZB(e,t,n,r,i,s,o,a,u){let l;if(r==null?(l=new Array(t.length),l.fill(1)):l=r,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const f={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};for(let x=0;x<f.dims;x++)c&&1<<x&a&&f.numAddAxisAfterEllipsis++,1<<x&o&&(c=!0);c||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};LTe(f,h);let d=!0,p=!0,m=!0;const g=[],y=[];for(let x=0;x<e.length;++x){if(h.strides[x]===0)throw Error(`strides[${x}] must be non-zero`);const v=!!(h.shrinkAxisMask&1<<x),w=e[x];if(w===-1){g.push(v?1:-1);continue}const C=[h.beginMask&1<<x,h.endMask&1<<x],S=[h.strides[x]>0?0:-1,h.strides[x]>0?w:w-1];if(v&&h.strides[x]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&h.strides[x]===1;const _=!!(h.beginMask&1<<x&&h.endMask&1<<x);if(h.beginValid&&h.endValid){if(v){const F=h.begin[x]<0?w+h.begin[x]:h.begin[x];if(h.begin[x]=F,h.end[x]=h.begin[x]+1,F<0||F>=w)throw Error(`slice index ${h.begin[x]} of dimension ${x} out of bounds.`)}else h.begin[x]=dV(h.begin[x],0,h.strides[x],w,C,S),h.end[x]=dV(h.end[x],1,h.strides[x],w,C,S);const E=h.strides[x]===1&&h.begin[x]===0&&h.end[x]===w;d=d&&E,p=p&&(x===0&&h.strides[x]===1||E)}else d=d&&h.strides[x]===1&&_,p=p&&(x===0&&h.strides[x]===1||_);let $,k=!1;if(h.beginValid&&h.endValid?($=h.end[x]-h.begin[x],k=!0):v?($=1,k=!0):_&&w>=0&&(h.strides[x]<0?$=-w:$=w,k=!0),k){let E;$===0||$<0!=h.strides[x]<0?E=0:E=Math.trunc($/h.strides[x])+($%h.strides[x]!==0?1:0),g.push(E)}else g.push(-1)}for(let x=0;x<h.finalShapeGatherIndices.length;++x){const v=h.finalShapeGatherIndices[x];v>=0?y.push(g[v]):v===WM&&y.push(1)}return{finalShapeSparse:y.filter((x,v)=>h.finalShapeGatherIndices[v]!==WM),finalShape:y,isIdentity:d,sliceDim0:p,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}function LTe(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const i=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<i;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(WM),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[n]=e.begin[r]),e.end!=null&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(MTe),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}function dV(e,t,n,r,i,s){if(i[t])return n>0?s[t]:s[t+1&1];{const o=e<0?r+e:e;return o<s[0]?s[0]:o>s[1]?s[1]:o}}const fne=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:qB,computeFlatOffset:KB,computeOutShape:XB,getNormalizedAxes:PTe,isSliceContinous:YB,maskToAxes:RTe,parseSliceParams:iD,sliceInfo:ZB,startForAxis:lne,startIndicesWithElidedDims:one,stopForAxis:cne,stopIndicesWithElidedDims:ane,stridesForAxis:une,stridesWithElidedDims:rne},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const BTe="4.6.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hne{static sgd(t){return new nD(t)}static momentum(t,n,r=!1){return new WB(t,n,r)}static rmsprop(t,n=.9,r=0,i=null,s=!1){return new VB(t,n,r,i,s)}static adam(t=.001,n=.9,r=.999,i=null){return new jB(t,n,r,i)}static adadelta(t=.001,n=.95,r=null){return new BB(t,n,r)}static adamax(t=.002,n=.9,r=.999,i=null,s=0){return new UB(t,n,r,i,s)}static adagrad(t,n=.1){return new zB(t,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ld=hne;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zTe=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e())();function JB(){return new Promise(e=>zTe(()=>e()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QB(e,t){const n=e[0].length;e.forEach((i,s)=>{z(i.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),z(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=e[0];e.forEach((i,s)=>{for(let o=0;o<n;o++)z(o===t||i[o]===r[o],()=>`Error in concat${n}D: Shape of tensors[${s}] (${i}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function yu(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var aa;(function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"})(aa||(aa={}));function dne(e,t,n){let r=new Array;if(n==null&&t==null)return r;if(t==null)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(n==null)return r;if(e+n.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){const s=n[i],o=r[r.length-n.length+i],a=r[o];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${i+e}] = ${s} but shape[${i+e}] = ${a}`)}else r[o]=s}return r}function pne(e){const t={FIRST_DIM_SIZE:aa.FIRST_DIM_SIZE,VALUE_ROWIDS:aa.VALUE_ROWIDS,ROW_LENGTHS:aa.ROW_LENGTHS,ROW_SPLITS:aa.ROW_SPLITS,ROW_LIMITS:aa.ROW_LIMITS,ROW_STARTS:aa.ROW_STARTS},n=[];for(const r of e)if(r in t)n.push(t[r]);else break;return n}function gne(e){return e.length===0?0:e[0]===aa.FIRST_DIM_SIZE?e.length-1:e.length}function mne(e,t){if(e==null||t==null)return;const n=e.length,r=t.length;if(n>=r)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){const s=e[i],o=t[i+1];if(s>=0&&o>=0&&s!==1&&s!==o)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${i-e.length}] = ${s} but ragged tensor input.flatValues.shape[${i-e.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e5=30;function sD(e){return e<=e5?e:x$(e,Math.floor(Math.sqrt(e)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(e,t,n){const r=n*(typeof e=="number"?e:e[0]),i=t*(typeof e=="number"?e:e[1]);return[r,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kw(e,t,n,r=!0){let i=[];if(r)i=i.concat(t.slice(0)),i.push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);const s=t.length;for(let o=0;o<s;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(s+1))}return i}function Ew(e,t,n=!0){const r=[];if(n){r.push(t);for(let i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{const i=[],s=[];for(let o=1;o<e;++o)o>=t*2+1||o%2===1?s.push(o):i.push(o);r.push(...i),r.push(0),r.push(...s)}return r}function Aw(e,t,n,r=!0){const i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(let s=1;s<e.length;++s)s<=t.length?r?i.push(t[s-1]*e[s]):i.push(e[s]/t[s-1]):i.push(e[s]);return i}function n5(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function r5(e,t,n){const r=e.slice(0,1);for(let i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oD=1.7580993408473768,aD=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i5=.3275911,s5=.254829592,o5=-.284496736,a5=1.421413741,u5=-1.453152027,l5=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ec(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(e.length*2);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function yne(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function bne(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function vne(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function c5(e,t){const n=e[t*2],r=e[t*2+1];return{real:n,imag:r}}function xne(e,t,n,r){e[r*2]=t,e[r*2+1]=n}function wne(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){const s=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function Cne(e,t,n){const r=(n?2:-2)*Math.PI*(e/t),i=Math.cos(r),s=Math.sin(r);return{real:i,imag:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qO="->",jTe=/->/g,pV=",",gV="...";function f5(e,t){e=e.replace(/\s/g,"");const n=(e.length-e.replace(jTe,"").length)/qO.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${qO}").`);const[r,i]=e.split(qO);z(r.indexOf(gV)===-1,()=>`The ellipsis notation ("${gV}") is not supported yet.`);const s=r.split(pV),o=s.length;if(t!==o)throw new Error(`Expected ${o} input tensors, received ${t}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<i.length;++h){const d=i[h];if(!s.some(p=>p.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let h=0;h<r.length;++h){const d=r[h];a.indexOf(d)===-1&&d!==pV&&a.push(d)}const u=new Array(s.length);for(let h=0;h<o;++h){if(new Set(s[h].split("")).size!==s[h].length)throw new Error(`Found duplicate axes in input component ${s[h]}. Support for duplicate axes in input is not implemented yet.`);u[h]=[];for(let d=0;d<s[h].length;++d)u[h].push(a.indexOf(s[h][d]))}const l=a.length,c=i.length,f=[];for(let h=c;h<l;++h)f.push(h);return{allDims:a,summedDims:f,idDims:u}}function h5(e,t){let n=new Array(e);n.fill(-1);for(let i=0;i<t.length;++i)n[t[i]]=i;const r=[];for(let i=0;i<e;++i)n[i]===-1&&r.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:r}}function d5(e,t,n){const r=new Array(e);for(let i=0;i<n.length;++i){const s=n[i].shape;for(let o=0;o<t[i].length;++o)r[t[i][o]]===void 0?r[t[i][o]]=s[o]:z(r[t[i][o]]===s[o],()=>`Expected dimension ${r[t[i][o]]} at axis ${o} of input shaped ${JSON.stringify(s)}, but got dimension ${s[o]}`)}}function p5(e,t){const n=e,r=[];let i=0;e.length===0&&n.push(-1),i=e.length+1;for(let o=0;o<i;++o)r.push([]);const s=[];for(let o=0;o<n.length;++o){const a=n[o],u=UTe(t,a);for(const l of u)s.indexOf(l)===-1&&(r[o].push(l),s.push(l))}return{path:n,steps:r}}function g5(e){return e.every((t,n)=>t===n)}function UTe(e,t){const n=[];for(let r=0;r<e.length;++r)(e[r].length===0||e[r].indexOf(t)!==-1||t===-1)&&n.push(r);return n}function m5(e,t,n=0){let r=[];if(typeof t=="number")z(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{const i=t.reduce((o,a)=>(a===-1&&(o+=1),o),0);z(i<=1,()=>"There should be only one negative value in split array.");const s=t.indexOf(-1);if(s!==-1){const o=t.reduce((a,u)=>u>0?a+u:a);t[s]=e.shape[n]-o}z(e.shape[n]===t.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sne(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function _ne(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function $ne(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kne(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function Ene(e,t){return`size ${e} must be non-negative, not ${t}`}function Ane(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Tne(e,t){const n=ce(e),r=ce(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${e} outputShape= ${t}`}function Dne(e,t){const n=ce(e),r=ce(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${e} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VM(){return"segment ids must be >= 0"}function Ine(){return"segment ids are not increasing"}function Fne(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function One(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nne(e,t){let n=!1,r;for(e<=e5?(r=e,n=!0):r=x$(e,Math.floor(Math.sqrt(e)));!n;)r>t||r===e?n=!0:r=x$(e,r+1);return r}function Mne(e,t,n){const r=[],i=e.length;for(let s=0;s<i;s++)s!==t?r.push(e[s]):r.push(n);return r}function y5(e,t,n,r){const i=t.shape.length,s=e.shape.length;if(r!==0&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let f=0;f<r;++f)if(e.shape[f]!==t.shape[f])throw new Error(`x.shape[${f}]: ${e.shape[f]} should be equal to indices.shape[${f}]: ${t.shape[f]}.`);const o=e.shape[n],a=[];let u=1,l=1,c=1;for(let f=0;f<r;++f)a.push(e.shape[f]),u*=e.shape[f];for(let f=r;f<n;f++)a.push(e.shape[f]),l*=e.shape[f];for(let f=r;f<i;f++)a.push(t.shape[f]);for(let f=n+1;f<s;f++)a.push(e.shape[f]),c*=e.shape[f];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:o,outputShape:a}}const WTe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:y5,computeOutShape:Mne,segOpComputeOptimalWindowSize:Nne},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(e){try{return e.map(t=>Jl(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function Rne(e){return e.map(t=>gu(t))}const Pne=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:s5,ERF_A2:o5,ERF_A3:a5,ERF_A4:u5,ERF_A5:l5,ERF_P:i5,PARALLELIZE_THRESHOLD:e5,get RowPartitionType(){return aa},SELU_SCALE:aD,SELU_SCALEALPHA:oD,applyActivation:ZT,assertAndGetBroadcastShape:rt,assertAxesAreInnerMostDims:Rr,assertParamsConsistent:QB,assignToTypedArray:xne,axesAreInnerMostDims:aB,calculateShapes:wh,checkEinsumDimSizes:d5,checkPadOnDimRoundingMode:Ti,combineLocations:cte,combineRaggedTensorToTensorShapes:dne,complexWithEvenIndex:bne,complexWithOddIndex:vne,computeConv2DInfo:mr,computeConv3DInfo:mh,computeDefaultPad:tB,computeDilation2DInfo:vw,computeOptimalWindowSize:sD,computeOutAndReduceShapes:yr,computeOutShape:yu,computePool2DInfo:jo,computePool3DInfo:hc,convertConv2DDataFormat:dc,decodeEinsumEquation:f5,eitherStridesOrDilationsAreOne:Mr,expandShapeToKeepDim:Bn,exponent:Cne,exponents:wne,fromStringArrayToUint8:Rne,fromUint8ToStringArray:tc,getAxesPermutation:Tn,getBroadcastDims:fp,getComplexWithIndex:c5,getEinsumComputePath:p5,getEinsumPermutation:h5,getFusedBiasGradient:KT,getFusedDyActivation:YT,getImageCenter:t5,getInnerMostAxes:zn,getPermuted:Ew,getRaggedRank:gne,getReductionAxes:Hn,getReshaped:kw,getReshapedPermuted:Aw,getRowPartitionTypesHelper:pne,getSliceBeginCoords:n5,getSliceSize:r5,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Sne,getSparseFillEmptyRowsNegativeIndexErrorMessage:_ne,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:$ne,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Ane,getSparseReshapeInputOutputMismatchErrorMessage:Dne,getSparseReshapeInputOutputMultipleErrorMessage:Tne,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:kne,getSparseReshapeNegativeOutputDimErrorMessage:Ene,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:One,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:VM,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Ine,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Fne,getUndoAxesPermutation:yh,isIdentityPermutation:g5,log:Z2e,mergeRealAndImagArrays:ec,prepareAndValidate:rD,prepareSplitSize:m5,segment_util:WTe,shouldFuse:JT,slice_util:fne,splitRealAndImagArrays:yne,stridesOrDilationsArePositive:cp,tupleValuesAreOne:Ef,upcastType:Hi,validateDefaultValueShape:mne,validateInput:qT,validateUpdateShape:OB,warn:js},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VTe=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:QT,nonMaxSuppressionV4Impl:eD,nonMaxSuppressionV5Impl:tD,whereImpl:XT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */sTe();const GTe=Object.freeze(Object.defineProperty({__proto__:null,Abs:d2,Acos:M0,Acosh:R0,AdadeltaOptimizer:BB,AdagradOptimizer:zB,AdamOptimizer:jB,AdamaxOptimizer:UB,Add:Yp,AddN:p2,All:SA,Any:_A,ArgMax:g2,ArgMin:m2,Asin:P0,Asinh:L0,Atan:B0,Atan2:j0,Atanh:z0,AvgPool:y2,AvgPool3D:b2,AvgPool3DGrad:kA,AvgPoolGrad:$A,BatchMatMul:v2,BatchToSpaceND:x2,Bincount:EA,BitwiseAnd:w2,BroadcastArgs:AA,BroadcastTo:nee,Cast:U0,Ceil:W0,ClipByValue:V0,Complex:TA,ComplexAbs:C2,Concat:S2,Conv2D:_2,Conv2DBackpropFilter:DA,Conv2DBackpropInput:$2,Conv3D:k2,Conv3DBackpropFilterV2:IA,Conv3DBackpropInputV2:FA,Cos:G0,Cosh:H0,CropAndResize:NA,Cumprod:OA,Cumsum:E2,DataStorage:R4,DenseBincount:MA,DepthToSpace:RA,DepthwiseConv2dNative:A2,DepthwiseConv2dNativeBackpropFilter:PA,DepthwiseConv2dNativeBackpropInput:LA,Diag:BA,Dilation2D:T2,Dilation2DBackpropFilter:C$,Dilation2DBackpropInput:w$,Draw:W4,get ENV(){return j4},Einsum:zA,Elu:X0,EluGrad:jA,Environment:eee,Equal:D2,Erf:Y0,Exp:K0,ExpandDims:I2,Expm1:Z0,FFT:UA,Fill:WA,FlipLeftRight:VA,Floor:J0,FloorDiv:Q0,FromPixels:S$,FusedBatchNorm:F2,FusedConv2D:kv,FusedDepthwiseConv2D:Ev,GatherNd:GA,GatherV2:O2,Greater:N2,GreaterEqual:e1,IFFT:HA,Identity:t1,Imag:qA,IsFinite:n1,IsInf:r1,IsNan:i1,KernelBackend:vA,LRN:j2,LRNGrad:YA,LeakyRelu:M2,Less:R2,LessEqual:P2,LinSpace:XA,Log:s1,Log1p:o1,LogSoftmax:ree,LogicalAnd:L2,LogicalNot:B2,LogicalOr:z2,LogicalXor:H2e,LowerBound:q2e,MatrixBandPart:X2e,Max:U2,MaxPool:W2,MaxPool3D:V2,MaxPool3DGrad:ZA,MaxPoolGrad:KA,MaxPoolWithArgmax:JA,Maximum:a1,Mean:G2,Min:H2,Minimum:u1,MirrorPad:q2,Mod:l1,MomentumOptimizer:WB,Multinomial:QA,Multiply:c1,Neg:X2,NonMaxSuppressionV3:eT,NonMaxSuppressionV4:tT,NonMaxSuppressionV5:nT,NotEqual:Y2,OP_SCOPE_SUFFIX:Cee,OneHot:Z2,OnesLike:K2,Optimizer:mc,OptimizerConstructors:hne,Pack:J2,PadV2:Q2,Pool:Y2e,Pow:f1,Prelu:ew,Prod:tw,RMSPropOptimizer:VB,RaggedGather:rT,RaggedRange:iT,RaggedTensorToTensor:sT,Range:oT,get Rank(){return EM},Real:aT,RealDiv:q0,Reciprocal:h1,get Reduction(){return hi},Relu:d1,Relu6:p1,Reshape:nw,ResizeBilinear:iw,ResizeBilinearGrad:lT,ResizeNearestNeighbor:rw,ResizeNearestNeighborGrad:uT,Reverse:sw,RotateWithOffset:kT,Round:g1,Rsqrt:m1,SGDOptimizer:nD,ScatterNd:cT,SearchSorted:hT,Select:ow,Selu:y1,Sigmoid:w1,Sign:x1,Sin:b1,Sinh:v1,Slice:aw,Softmax:fw,Softplus:C1,SpaceToBatchND:lw,SparseFillEmptyRows:dT,SparseReshape:pT,SparseSegmentMean:gT,SparseSegmentSum:mT,SparseToDense:yT,SplitV:cw,Sqrt:S1,Square:bT,SquaredDifference:_1,StaticRegexReplace:hw,Step:T1,StridedSlice:vT,StringNGrams:xT,StringSplit:wT,StringToHashBucketFast:CT,Sub:$1,Sum:uw,Tan:k1,Tanh:E1,Tensor:Vt,TensorBuffer:Gn,TensorScatterUpdate:fT,Tile:A1,TopK:ST,Transform:_T,Transpose:Vd,Unique:$T,Unpack:dw,UnsortedSegmentSum:pw,UpperBound:K2e,Variable:Tv,ZerosLike:gw,_FusedMatMul:$v,abs:Yn,acos:Lee,acosh:Bee,add:be,addN:ACe,all:eB,any:T$,argMax:Mm,argMin:zee,asin:jee,asinh:Uee,atan:Wee,atan2:Vee,atanh:Gee,avgPool:TT,avgPool3d:Hee,backend:Pee,backend_util:Pne,basicLSTMCell:ZCe,batchNorm:xw,batchNorm2d:qee,batchNorm3d:Xee,batchNorm4d:Yee,batchToSpaceND:DT,bincount:Kee,bitwiseAnd:oSe,booleanMaskAsync:rEe,broadcastArgs:uSe,broadcastTo:bm,broadcast_util:OSe,browser:OTe,buffer:ft,cast:Ee,ceil:Zee,clipByValue:Ss,clone:df,complex:kf,concat:hr,concat1d:Jee,concat2d:Qee,concat3d:ete,concat4d:tte,conv1d:nB,conv2d:Af,conv2dTranspose:iB,conv3d:nte,conv3dTranspose:ite,copyRegisteredKernels:ewe,cos:IT,cosh:sB,cosineWindow:RB,cumprod:D$,cumsum:oB,customGrad:Iu,denseBincount:BM,deprecationWarn:lCe,depthToSpace:ste,depthwiseConv2d:ww,device_util:Ewe,diag:ISe,dilation2d:ote,disableDeprecationWarnings:uCe,dispose:ct,disposeVariables:cCe,div:je,divNoNan:ate,dot:ute,dropout:Lte,einsum:zSe,elu:Cw,enableDebugMode:aCe,enableProdMode:oCe,enclosingPowerOfTwo:Bte,engine:ra,ensureShape:WSe,env:ae,equal:ka,erf:lte,euclideanNorm:hte,exp:Zs,expandDims:Mi,expm1:dte,eye:uB,fft:GT,fill:D1,findBackend:yCe,findBackendFactory:bCe,floor:_w,floorDiv:Q4,fused:$Ee,gather:$w,gatherND:dEe,gather_util:NTe,getBackend:gCe,getGradient:_M,getKernel:_$,getKernelsForBackend:$$,grad:v_e,grads:x_e,greater:Rs,greaterEqual:bh,ifft:Lv,imag:FT,image:fu,inTopKAsync:yEe,io:wTe,irfft:IB,isFinite:pte,isInf:gte,isNaN:mte,keep:va,kernel_impls:VTe,leakyRelu:OT,less:Nv,lessEqual:Jp,linalg:qte,linspace:g_e,localResponseNormalization:yte,log:Js,log1p:NT,logSigmoid:vte,logSoftmax:lB,logSumExp:cB,logicalAnd:Fu,logicalNot:RT,logicalOr:fB,logicalXor:xte,losses:eTe,lowerBound:N_e,matMul:pt,math:_Te,max:To,maxPool:PT,maxPool3d:wte,maxPoolWithArgmax:L_e,maximum:pc,mean:In,memory:A$,meshgrid:j_e,min:Ov,minimum:hp,mirrorPad:Cte,mod:Ste,moments:LT,movingAverage:oEe,mul:Q,multiRNNCell:q_e,multinomial:Y_e,neg:dn,nextFrame:JB,norm:Sw,notEqual:Pm,oneHot:Mv,ones:Vs,onesLike:Qs,op:J,outerProduct:e$e,pad:vh,pad1d:r$e,pad2d:s$e,pad3d:a$e,pad4d:l$e,pool:_te,pow:Tf,prelu:zT,print:Ree,prod:$te,profile:fCe,raggedGather:y$e,raggedRange:v$e,raggedTensorToTensor:w$e,rand:S$e,randomGamma:J$e,randomNormal:CB,randomStandardNormal:tke,randomUniform:eg,randomUniformInt:ike,range:Lm,ready:pCe,real:Rv,reciprocal:Tte,registerBackend:J4,registerGradient:iee,registerKernel:ET,relu:qu,relu6:SB,removeBackend:mCe,reshape:ne,reverse:Fo,reverse1d:fke,reverse2d:dke,reverse3d:gke,reverse4d:yke,rfft:HT,round:_B,rsqrt:$B,scalar:et,scatterND:uEe,scatter_util:Hke,searchSorted:hB,selu:kB,separableConv2d:EB,serialization:rTe,setBackend:dCe,setPlatform:vCe,setdiff1dAsync:Ske,sigmoid:mu,sign:Dte,signal:QAe,sin:AB,sinh:TB,slice:Et,slice1d:UT,slice2d:DB,slice3d:WT,slice4d:Pv,slice_util:fne,softmax:VT,softplus:I1,spaceToBatchND:BT,sparse:tTe,sparseToDense:fEe,spectral:JAe,split:ws,sqrt:Zr,square:Jt,squaredDifference:FB,squeeze:xh,stack:Ql,step:F1,stridedSlice:Ite,string:nTe,sub:Ie,sum:Oe,sumOutType:AT,tan:Fte,tanh:Rm,tensor:Gd,tensor1d:Ui,tensor2d:Yb,tensor3d:Ote,tensor4d:Wke,tensor5d:Vke,tensor6d:Gke,tensorScatterUpdate:Xke,tensor_util:Cwe,test_util:X$e,tidy:ue,tile:vo,time:hCe,topk:Nte,train:ld,transpose:Ct,truncatedNormal:NB,unique:Mte,unregisterGradient:Q2e,unregisterKernel:J2e,unsortedSegmentSum:MB,unstack:Df,upcastType:Hi,upperBound:eEe,util:lwe,valueAndGrad:w_e,valueAndGrads:C_e,variable:Rte,variableGrads:bte,version_core:BTe,where:Yr,whereAsync:Pte,zeros:Kn,zerosLike:$t},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lne={kernelName:d2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(e,F1(Ee(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HTe={kernelName:M0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Jt(Ee(n,"float32")),i=Zr(Ie(et(1),r));return dn(je(e,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qTe={kernelName:R0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Zr(Ie(Jt(Ee(n,"float32")),1));return je(e,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XTe={kernelName:Yp,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=rt(n.shape,r.shape);return{a:()=>{let a=e;const u=Hn(n.shape,i);return u.length>0&&(a=Oe(a,u)),ne(a,n.shape)},b:()=>{let a=e;const u=Hn(r.shape,i);return u.length>0&&(a=Oe(a,u)),ne(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YTe={kernelName:p2,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((r,i)=>{n[i]=()=>e.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KTe={kernelName:g2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>$t(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZTe={kernelName:m2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>$t(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JTe={kernelName:P0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>je(e,Zr(Ie(et(1),Jt(Ee(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QTe={kernelName:L0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Zr(be(et(1),Jt(Ee(n,"float32"))));return je(e,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eDe={kernelName:j0,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=rt(n.shape,r.shape);return{a:()=>{const a=be(Jt(n),Jt(r));let u=Q(e,je(r,a));const l=Hn(n.shape,i);return l.length>0&&(u=Oe(u,l)),ne(u,n.shape)},b:()=>{const a=be(Jt(n),Jt(r));let u=dn(Q(e,je(n,a)));const l=Hn(r.shape,i);return l.length>0&&(u=Oe(u,l)),ne(u,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tDe={kernelName:B0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>je(e,be(Jt(Ee(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nDe={kernelName:z0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>je(e,Ie(et(1),Jt(Ee(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rDe(e,t,n,r,i,s){const o=W(e,"dy","avgPool3dGrad"),a=W(t,"input","avgPool3dGrad");let u=o,l=a,c=!1;a.rank===4&&(c=!0,u=ne(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),z(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),z(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Ti("avgPool3dGrad",i,s);const f={dy:u,input:l},h={filterSize:n,strides:r,pad:i,dimRoundingMode:s},d=K.runKernel(kA,f,h);return c?ne(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const iDe=J({avgPool3dGrad_:rDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sDe={kernelName:b2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:a}=n;return{x:()=>iDe(e,r,i,s,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oDe(e,t,n,r,i){const s=W(e,"dy","avgPoolGrad"),o=W(t,"input","avgPoolGrad");z(o.rank===s.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`);let a=o,u=s,l=!1;o.rank===3&&(l=!0,a=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=ne(s,[1,s.shape[0],s.shape[1],s.shape[2]])),z(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),z(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:u,input:a},f={filterSize:n,strides:r,pad:i},h=K.runKernel($A,c,f);return l?ne(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const aDe=J({avgPoolGrad_:oDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uDe={kernelName:y2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:s,pad:o}=n;return{x:()=>aDe(e,r,i,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lDe={kernelName:v2,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,i]=t,{transposeA:s,transposeB:o}=n;return!s&&!o?{a:()=>pt(e,i,!1,!0),b:()=>pt(r,e,!0,!1)}:!s&&o?{a:()=>pt(e,i,!1,!1),b:()=>pt(e,r,!0,!1)}:s&&!o?{a:()=>pt(i,e,!1,!0),b:()=>pt(r,e,!1,!1)}:{a:()=>pt(i,e,!0,!0),b:()=>pt(e,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cDe={kernelName:x2,gradFunc:(e,t,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>BT(e,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fDe={kernelName:nee,gradFunc:(e,t,n)=>{const r=n,i=r.inputShape,s=r.shape,o=Array.from(s);for(let u=i.length-1;u>=0;u--)if(i[u]===s[u])o[u]=1;else if(i[u]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);const a=[];for(let u=0;u<o.length;u++)o[u]>1&&a.push(u);return{x:()=>Oe(e,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hDe={kernelName:U0,gradFunc:e=>({x:()=>e.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dDe={kernelName:W0,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pDe={kernelName:V0,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>Yr(Fu(bh(r,i),Jp(r,s)),e,$t(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gDe={kernelName:C2,inputsToSave:["x"],gradFunc:Lne.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mDe={kernelName:S2,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map(u=>u.shape),{axis:i}=n,s=dt(i,t[0].shape)[0],o=r.map(u=>u[s]);return ws(e,o,s).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yDe={kernelName:_2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{dilations:s,strides:o,pad:a,dataFormat:u}=n;return z(Ef(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>rB(r.shape,e,i,o,a,u),filter:()=>PB(r,e,i.shape,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bDe={kernelName:$2,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{strides:s,pad:o,dataFormat:a,dimRoundingMode:u}=n;return{dy:()=>Af(e,i,s,o,a,1,u),filter:()=>PB(e,r,i.shape,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vDe(e,t,n,r,i){let s=e;e.rank===4&&(s=ne(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;o.rank===4&&(o=ne(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),z(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),z(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),z(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),z(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),z(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:s,dy:o},u={strides:r,pad:i,filterShape:n};return K.runKernel(IA,a,u)}const xDe=J({conv3DBackpropFilter_:vDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wDe={kernelName:k2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:s}=n;z(Ef(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=t;return{x:()=>rte(o.shape,e,a,i,s),filter:()=>xDe(o,e,a.shape,i,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CDe={kernelName:G0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(dn(AB(Ee(n,"float32"))),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SDe={kernelName:H0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(TB(Ee(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _De={kernelName:E2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i,exclusive:s,reverse:o}=n;return{x:()=>{const a=Tn([i],r.rank);let u=oB(e,i,s,!o);return a!=null&&(u=Ct(u,a)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $De={kernelName:A2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:o}=n,a=r??[1,1];z(Ef(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[u,l]=t;return z(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),z(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),z(u.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),z(Mr(i,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`),Ti("depthwiseConv2d",s,o),{x:()=>Ute(u.shape,e,l,i,s,a,o),filter:()=>jte(u,e,l.shape,i,s,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kDe={kernelName:T2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,s={x:r,filter:i,dy:e},o={x:r,filter:i,dy:e};return{x:()=>K.runKernel(w$,s,n),filter:()=>K.runKernel(C$,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EDe={kernelName:X0,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>K.runKernel(jA,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ADe={kernelName:Y0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=Q(Zs(dn(Jt(n))),2/Math.sqrt(Math.PI));return{x:()=>Q(e,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TDe={kernelName:K0,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(e,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DDe={kernelName:I2,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>ne(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IDe={kernelName:Z0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(e,Zs(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FDe={kernelName:J0,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ODe={kernelName:Q0,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=rt(n.shape,r.shape);return{a:()=>{const a=je(e,Ee(r,"float32")),u=Hn(n.shape,i);return u.length>0?ne(Oe(a,u),n.shape):a},b:()=>{let a=Q(e,Ee(n,"float32"));const u=Hn(r.shape,i);u.length>0&&(a=ne(Oe(a,u),r.shape));const l=Jt(r);return dn(je(a,Ee(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NDe={kernelName:F2,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[i,s,o,a]=t,u=a??et(1),l=Hn(s.shape,i.shape),c=[];if(s.rank===1){for(let v=0;v<i.shape.length-1;++v)c.push(i.shape[v]);c.push(1)}const f=Ie(i,s),h=Q(e,u),d=$B(be(o,et(r))),p=Q(Q(Q(d,d),d),et(-.5));return{x:()=>s.rank===1?ne(Q(Q(e,vo(ne(d,[1,1,1,s.shape[0]]),c)),u),i.shape):ne(Q(Q(e,d),u),i.shape),mean:()=>{let v=Q(Q(d,et(-1)),h);return s.rank===1&&(v=Oe(v,l)),ne(v,s.shape)},variance:()=>{let v=Q(Q(p,f),h);return s.rank===1&&(v=Oe(v,l)),ne(v,s.shape)},scale:()=>{const v=Q(f,d);let w=Q(e,v);return s.rank===1&&(w=Oe(w,l)),ne(w,s.shape)},offset:()=>{let v=e;return s.rank===1&&(v=Oe(v,l)),ne(v,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MDe={kernelName:O2,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,i]=t,{axis:s}=n,o=dt(s,r.shape)[0];return{x:()=>{const u=r.shape,l=i.size,c=u.slice(0,o),f=c.length,h=u.slice(s,u.length).slice(1),d=h.length,p=mV(0,f),m=mV(f+1,f+1+d),g=yV([c,[l],h]),y=ne(e,g),b=ne(i,[l]),x=yV([[f],p,m]),v=Ct(y,x);let w=MB(v,b,r.shape[o]);const C=yh(x);return w=Ct(w,C),w},indices:()=>i}}};function mV(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function yV(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RDe={kernelName:e1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>$t(n),b:()=>$t(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PDe={kernelName:t1,gradFunc:e=>({x:()=>Ee(e,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LDe={kernelName:n1,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BDe={kernelName:r1,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zDe={kernelName:i1,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jDe={kernelName:M2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:i}=n,s=Rs(r,0);return{x:()=>Yr(s,e,Q(e,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UDe={kernelName:o1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>je(e,be(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WDe={kernelName:s1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>je(e,Ee(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VDe={kernelName:ree,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;return{logits:()=>{const o=Zs(r);return Ie(e,Q(Oe(e,i,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GDe(e,t,n,r=5,i=1,s=1,o=.5){const a={x:e,y:t,dy:n},u={depthRadius:r,bias:i,alpha:s,beta:o};return K.runKernel(YA,a,u)}const HDe=J({localResponseNormalizationBackprop_:GDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qDe={kernelName:j2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{depthRadius:s,bias:o,alpha:a,beta:u}=n;return{x:()=>HDe(r,i,e,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bne(e,t,n,r){return t.rank<n.rank&&(t=ne(t,Bn(t.shape,r))),e.rank<n.rank&&(e=ne(e,Bn(e.shape,r))),{x:()=>Q(e,Ee(ka(n,t),e.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV={kernelName:U2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:i}=r,s=t[0],o=t[1],a=dt(i,s.shape),u=Bne(e,o,s,a);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XDe={kernelName:a1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Q(e,Ee(bh(n,r),"float32")),b:()=>Q(e,Ee(Nv(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YDe(e,t,n,r,i,s,o){const a=W(e,"dy","maxPool3dGrad"),u=W(t,"input","maxPool3dGrad"),l=W(n,"output","maxPool3dGrad");let c=a,f=u,h=l,d=!1;u.rank===4&&(d=!0,c=ne(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=ne(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=ne(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),z(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),z(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),z(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Ti("maxPool3dGrad",s,o);const p={dy:c,input:f,output:h},m={filterSize:r,strides:i,pad:s,dimRoundingMode:o},g=K.runKernel(ZA,p,m);return d?ne(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const KDe=J({maxPool3dGrad_:YDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZDe={kernelName:V2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=n;return{x:()=>KDe(e,r,i,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JDe(e,t,n,r,i,s,o){const a=W(e,"dy","maxPoolGrad"),u=W(t,"input","maxPoolGrad"),l=W(n,"output","maxPoolGrad");z(u.rank===a.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${a.rank})`),z(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),z(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Ti("maxPoolGrad",s,o);const c={dy:a,input:u,output:l},f={filterSize:r,strides:i,pad:s,dimRoundingMode:o};return K.runKernel(KA,c,f)}const QDe=J({maxPoolGrad_:JDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eIe={kernelName:W2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:s,strides:o,pad:a}=n;return{x:()=>QDe(e,r,i,s,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tIe={kernelName:G2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n,s=dt(i,r.shape),a=yr(r.shape,s)[1],u=ce(a);return{x:()=>{const c=r.shape.slice();s.forEach(d=>{c[d]=1});const f=ne(e,c);return je(Q(f,Vs(r.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nIe={kernelName:H2,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:i}=r,[s,o]=t,a=dt(i,s.shape),u=Bne(e,o,s,a);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rIe={kernelName:u1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Q(e,Ee(Jp(n,r),"float32")),b:()=>Q(e,Ee(Rs(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iIe={kernelName:q2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,s=i.map(o=>o[0]);return{x:()=>Et(e,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sIe={kernelName:l1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=rt(n.shape,r.shape);return{a:()=>{const a=Hn(n.shape,i);return a.length>0?ne(Oe(e,a),n.shape):e},b:()=>{const a=Q(e,dn(_w(je(n,r)))),u=Hn(r.shape,i);return u.length>0?ne(Oe(a,u),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oIe={kernelName:c1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=rt(n.shape,r.shape);return{a:()=>{const a=Q(e,Ee(r,"float32")),u=Hn(n.shape,i);return u.length>0?ne(Oe(a,u),n.shape):a},b:()=>{const a=Q(e,Ee(n,"float32")),u=Hn(r.shape,i);return u.length>0?ne(Oe(a,u),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aIe={kernelName:X2,gradFunc:e=>({x:()=>dn(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uIe={kernelName:Z2,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>Kn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lIe={kernelName:K2,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cIe={kernelName:J2,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return Df(e,r).map(s=>()=>s)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vV={kernelName:Q2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,s=i.map(o=>o[0]);return{x:()=>Et(e,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fIe={kernelName:f1,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,i]=t,s=n,o=r,a=rt(s.shape,o.shape);return{a:()=>{const c=Ee(o,"float32");let f=Q(e,Q(c,Tf(s,Ie(c,et(1)))));const h=Hn(s.shape,a);return h.length>0&&(f=Oe(f,h)),ne(f,s.shape)},b:()=>{const c=Rs(s,0),f=Yr(c,Js(s),$t(s));let h=Q(e,Q(i,f));const d=Hn(o.shape,a);return d.length>0&&(h=Oe(h,d)),ne(h,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hIe={kernelName:ew,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,i=Rs(n,0);return{x:()=>Yr(i,e,Q(e,r)),alpha:()=>{let s=Yr(i,$t(e),Q(e,n));const o=Hn(r.shape,e.shape);return o.length>0&&(s=Oe(s,o)),ne(s,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dIe(e,t,n){const r=e.shape.slice();r[n]=1;const i=ne(t,r),s=D$(e,n,!0,!1),o=D$(e,n,!0,!0),a=Q(s,o);return Q(i,a)}function pIe(e,t,n){const r=e.shape.length,i=r-n.length,s=Tn(n,r);let o=e;s!=null&&(o=Ct(e,s));const a=o.shape.slice(),l=a.splice(r-n.length,n.length).reduce((h,d)=>h*d,1);a.push(l);const c=o.reshape(a);let f=dIe(c,t,i);if(f=f.reshape(o.shape),s!=null){const h=yh(s);f=Ct(f,h)}return f}const gIe={kernelName:tw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;let s=[];return i==null?s=r.shape.map((o,a)=>a):typeof i=="number"?s=[i]:s=i,{x:()=>pIe(r,e,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mIe={kernelName:q0,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=rt(n.shape,r.shape);return{a:()=>{const a=je(e,Ee(r,"float32")),u=Hn(n.shape,i);return u.length>0?ne(Oe(a,u),n.shape):a},b:()=>{let a=Q(e,Ee(n,"float32"));const u=Hn(r.shape,i);u.length>0&&(a=ne(Oe(a,u),r.shape));const l=Jt(r);return dn(je(a,Ee(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yIe={kernelName:h1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>je(e,dn(Jt(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bIe={kernelName:p1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=Q(Jp(n,6),F1(n));return{x:()=>Q(e,Ee(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vIe={kernelName:d1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(e,Ee(F1(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xIe={kernelName:nw,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ne(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wIe={kernelName:iw,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>K.runKernel(lT,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CIe={kernelName:rw,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>K.runKernel(uT,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SIe={kernelName:sw,gradFunc:(e,t,n)=>{const{dims:r}=n,i=dt(r,e.shape);return{x:()=>Fo(e,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ie={kernelName:g1,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ie={kernelName:m1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>dn(je(e,Q(Tf(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kIe={kernelName:ow,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>Ee($t(n),"float32"),t:()=>Q(e,Ee(n,e.dtype)),e:()=>Q(e,Ee(RT(n),e.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EIe={kernelName:y1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Rs(n,et(0)),i=et(oD),s=et(aD),o=Q(e,s),a=Q(Q(e,i),Zs(Ee(n,"float32")));return Yr(r,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AIe={kernelName:w1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(e,Q(n,Ie(et(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TIe={kernelName:x1,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DIe={kernelName:b1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(IT(Ee(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IIe={kernelName:v1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(sB(Ee(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FIe={kernelName:aw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:i,size:s}=n,o=r.shape,[a,u]=iD(r,i,s),l=[];for(let c=0;c<e.rank;c++)l.push([a[c],o[c]-a[c]-u[c]]);return{x:()=>vh(e,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OIe={kernelName:fw,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:i}=n,s=!0,o=Q(e,r);return{logits:()=>Ie(o,Q(Oe(o,[i],s),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NIe={kernelName:C1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(e,mu(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xV={kernelName:lw,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>DT(e,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wV={kernelName:cw,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>hr(e,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MIe={kernelName:S1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>je(e,Q(Zr(Ee(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RIe={kernelName:bT,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(e,Q(Ee(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PIe={kernelName:_1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=et(2);return{a:()=>Q(e,Q(i,Ie(n,r))),b:()=>Q(e,Q(i,Ie(r,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LIe={kernelName:T1,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BIe={kernelName:$1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=rt(n.shape,r.shape);return{a:()=>{let a=e;const u=Hn(n.shape,i);return u.length>0&&(a=Oe(a,u)),ne(a,n.shape)},b:()=>{let a=e;const u=Hn(r.shape,i);return u.length>0&&(a=Oe(a,u)),ne(dn(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zIe={kernelName:uw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,i=r.shape.slice(),{axis:s}=n;dt(s,r.shape).forEach(l=>{i[l]=1});const a=ne(e,i),u=Q(a,Vs(r.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jIe={kernelName:k1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>je(e,Jt(IT(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UIe={kernelName:E1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Q(Ie(et(1),Jt(n)),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WIe={kernelName:A1,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:i}=n;return{x:()=>{let o=$t(r);if(r.rank===1)for(let a=0;a<i[0];++a)o=be(o,Et(e,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)o=be(o,Et(e,[a*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)for(let l=0;l<i[2];++l)o=be(o,Et(e,[a*r.shape[0],u*r.shape[1],l*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)for(let l=0;l<i[2];++l)for(let c=0;c<i[3];++c)o=be(o,Et(e,[a*r.shape[0],u*r.shape[1],l*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VIe={kernelName:Vd,gradFunc:(e,t,n)=>{const r=n,{perm:i}=r,s=yh(i);return{x:()=>Ct(e,s)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GIe={kernelName:dw,gradFunc:(e,t,n)=>{const r=n,{axis:i}=r;return{value:()=>Ql(e,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HIe={kernelName:pw,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>qIe(e,n)}}};function qIe(e,t){const n=pc(t,$t(t)),r=$w(e,n);let i=bh(t,et(0,"int32"));const s=r.rank-i.rank;for(let a=0;a<s;++a)i=Mi(i,a+1);i=Fu(i,Vs(r.shape,"bool"));const o=$t(r);return Yr(i,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XIe={kernelName:gw,gradFunc:e=>({x:()=>$t(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YIe=[Lne,HTe,qTe,XTe,YTe,KTe,ZTe,JTe,QTe,eDe,tDe,nDe,sDe,uDe,lDe,cDe,fDe,hDe,dDe,pDe,gDe,mDe,bDe,yDe,wDe,CDe,SDe,_De,$De,kDe,mIe,EDe,ADe,TDe,DDe,IDe,ODe,FDe,NDe,MDe,RDe,PDe,LDe,BDe,zDe,jDe,UDe,WDe,VDe,qDe,bV,bV,XDe,ZDe,eIe,tIe,nIe,rIe,iIe,sIe,oIe,aIe,uIe,lIe,cIe,vV,vV,fIe,hIe,gIe,yIe,bIe,vIe,xIe,wIe,CIe,SIe,_Ie,$Ie,kIe,EIe,AIe,TIe,DIe,IIe,FIe,OIe,NIe,xV,xV,wV,wV,MIe,PIe,RIe,LIe,BIe,zIe,jIe,UIe,WIe,VIe,GIe,HIe,XIe];for(const e of YIe)iee(e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.abs=function(){return this.throwIfDisposed(),Yn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.acos=function(){return this.throwIfDisposed(),Lee(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.acosh=function(){return this.throwIfDisposed(),Bee(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.add=function(e){return this.throwIfDisposed(),be(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.all=function(e,t){return this.throwIfDisposed(),eB(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.any=function(e,t){return this.throwIfDisposed(),T$(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.argMax=function(e){return this.throwIfDisposed(),Mm(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.argMin=function(e){return this.throwIfDisposed(),zee(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asScalar=function(){return this.throwIfDisposed(),z(this.size===1,()=>"The array must have only 1 element."),ne(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asType=function(e){return this.throwIfDisposed(),Ee(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as1D=function(){return this.throwIfDisposed(),ne(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as2D=function(e,t){return this.throwIfDisposed(),ne(this,[e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),ne(this,[e,t,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),ne(this,[e,t,n,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),ne(this,[e,t,n,r,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asin=function(){return this.throwIfDisposed(),jee(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.asinh=function(){return this.throwIfDisposed(),Uee(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atan=function(){return this.throwIfDisposed(),Wee(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atan2=function(e){return this.throwIfDisposed(),Vee(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.atanh=function(){return this.throwIfDisposed(),Gee(this)};fe().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),TT(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),DT(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.batchNorm=function(e,t,n,r,i){return this.throwIfDisposed(),xw(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.broadcastTo=function(e){return this.throwIfDisposed(),bm(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cast=function(e){return this.throwIfDisposed(),Ee(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.ceil=function(){return this.throwIfDisposed(),Zee(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ss(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Vt&&(e=[e]),hr([this,...e],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv1d=function(e,t,n,r,i,s){return this.throwIfDisposed(),nB(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),iB(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.conv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),Af(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cos=function(){return this.throwIfDisposed(),IT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cosh=function(){return this.throwIfDisposed(),sB(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),D$(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),oB(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ste(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.depthwiseConv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),ww(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.dilation2d=function(e,t,n,r,i){return this.throwIfDisposed(),ote(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.divNoNan=function(e){return this.throwIfDisposed(),ate(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.div=function(e){return this.throwIfDisposed(),je(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.dot=function(e){return this.throwIfDisposed(),ute(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.elu=function(){return this.throwIfDisposed(),Cw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.equal=function(e){return this.throwIfDisposed(),ka(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.erf=function(){return this.throwIfDisposed(),lte(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),hte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.exp=function(){return this.throwIfDisposed(),Zs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.expandDims=function(e){return this.throwIfDisposed(),Mi(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.expm1=function(){return this.throwIfDisposed(),dte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.fft=function(){return this.throwIfDisposed(),GT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.flatten=function(){return this.throwIfDisposed(),ne(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.floor=function(){return this.throwIfDisposed(),_w(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.floorDiv=function(e){return this.throwIfDisposed(),Q4(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.gather=function(e,t,n){return this.throwIfDisposed(),$w(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.greaterEqual=function(e){return this.throwIfDisposed(),bh(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.greater=function(e){return this.throwIfDisposed(),Rs(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.ifft=function(){return this.throwIfDisposed(),Lv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.irfft=function(){return this.throwIfDisposed(),IB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isFinite=function(){return this.throwIfDisposed(),pte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isInf=function(){return this.throwIfDisposed(),gte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.isNaN=function(){return this.throwIfDisposed(),mte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.leakyRelu=function(e){return this.throwIfDisposed(),OT(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.lessEqual=function(e){return this.throwIfDisposed(),Jp(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.less=function(e){return this.throwIfDisposed(),Nv(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),yte(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSigmoid=function(){return this.throwIfDisposed(),vte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSoftmax=function(e){return this.throwIfDisposed(),lB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),cB(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.log=function(){return this.throwIfDisposed(),Js(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.log1p=function(){return this.throwIfDisposed(),NT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Fu(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalNot=function(){return this.throwIfDisposed(),RT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalOr=function(e){return this.throwIfDisposed(),fB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.logicalXor=function(e){return this.throwIfDisposed(),xte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),pt(this,e,t,n)};fe().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),PT(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.max=function(e,t){return this.throwIfDisposed(),To(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.maximum=function(e){return this.throwIfDisposed(),pc(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mean=function(e,t){return this.throwIfDisposed(),In(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.min=function(e,t){return this.throwIfDisposed(),Ov(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.minimum=function(e){return this.throwIfDisposed(),hp(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Cte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mod=function(e){return this.throwIfDisposed(),Ste(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.mul=function(e){return this.throwIfDisposed(),Q(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.neg=function(){return this.throwIfDisposed(),dn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Sw(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.notEqual=function(e){return this.throwIfDisposed(),Pm(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),Mv(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.onesLike=function(){return this.throwIfDisposed(),Qs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.pad=function(e,t){return this.throwIfDisposed(),vh(this,e,t)};fe().prototype.pool=function(e,t,n,r,i,s){return this.throwIfDisposed(),_te(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.pow=function(e){return this.throwIfDisposed(),Tf(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.prelu=function(e){return this.throwIfDisposed(),zT(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.prod=function(e,t){return this.throwIfDisposed(),$te(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reciprocal=function(){return this.throwIfDisposed(),Tte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.relu=function(){return this.throwIfDisposed(),qu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.relu6=function(){return this.throwIfDisposed(),SB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reshapeAs=function(e){return this.throwIfDisposed(),ne(this,e.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reshape=function(e){return this.throwIfDisposed(),ne(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Gte(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Hte(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.reverse=function(e){return this.throwIfDisposed(),Fo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.rfft=function(){return this.throwIfDisposed(),HT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.round=function(){return this.throwIfDisposed(),_B(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.rsqrt=function(){return this.throwIfDisposed(),$B(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.selu=function(){return this.throwIfDisposed(),kB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.separableConv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),EB(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sigmoid=function(){return this.throwIfDisposed(),mu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sign=function(){return this.throwIfDisposed(),Dte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sin=function(){return this.throwIfDisposed(),AB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sinh=function(){return this.throwIfDisposed(),TB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.slice=function(e,t){return this.throwIfDisposed(),Et(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.softmax=function(e){return this.throwIfDisposed(),VT(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.softplus=function(){return this.throwIfDisposed(),I1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),BT(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.split=function(e,t){return this.throwIfDisposed(),ws(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sqrt=function(){return this.throwIfDisposed(),Zr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.square=function(){return this.throwIfDisposed(),Jt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.squaredDifference=function(e){return this.throwIfDisposed(),FB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.squeeze=function(e){return this.throwIfDisposed(),xh(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof Vt?[this,e]:[this,...e];return Ql(n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.step=function(e){return this.throwIfDisposed(),F1(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.stridedSlice=function(e,t,n,r,i,s,o,a){return this.throwIfDisposed(),Ite(this,e,t,n,r,i,s,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sub=function(e){return this.throwIfDisposed(),Ie(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.sum=function(e,t){return this.throwIfDisposed(),Oe(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tan=function(){return this.throwIfDisposed(),Fte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tanh=function(){return this.throwIfDisposed(),Rm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.tile=function(e){return this.throwIfDisposed(),vo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toBool=function(){return this.throwIfDisposed(),Ee(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toFloat=function(){return this.throwIfDisposed(),Ee(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.toInt=function(){return this.throwIfDisposed(),Ee(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.topk=function(e,t){return this.throwIfDisposed(),Nte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.transpose=function(e){return this.throwIfDisposed(),Ct(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unique=function(e){return this.throwIfDisposed(),Mte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),MB(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.unstack=function(e){return this.throwIfDisposed(),Df(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.where=function(e,t){return this.throwIfDisposed(),Yr(e,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fe().prototype.zerosLike=function(){return this.throwIfDisposed(),$t(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class eu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,eu.prototype)}}class xo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,xo.prototype)}}class ee extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ee.prototype)}}class ut extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ut.prototype)}}class b5 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,b5.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zne{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let n;return this.cache.has(t)&&(n=this.cache.get(t),this.cache.delete(t),this.cache.set(t,n)),n}put(t,n){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(t,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let n=0;n<this.maxEntries-t;n++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pp(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}else{const n=new Array(t);return n.fill(e),n}}function tu(e,t){if(!e)throw new b5(t)}function CV(e,t){let n=0;for(const r of e)r===t&&n++;return n}function Ri(e){return e.length===1?e[0]:e}function cn(e){return Array.isArray(e)?e:[e]}function Sl(e){const n=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function vd(e){return e.length<=1||e.indexOf("_")===-1?e:e.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}let uo={};function v5(e){if(e==null)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function GM(e){if(!(e==null||typeof e!="object"))if(Array.isArray(e))e.forEach(t=>GM(t));else{const t=Object.keys(e);for(const n of t){const r=e[n];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?e[n]=r.value:GM(r))}}}function Tw(e,t={},n={},r="object",i=!1){if(typeof e=="string"){const s=e;let o;if(s in n)o=n[s];else if(s in uo)o=uo[s];else if(o=t[s],o==null)throw new ee(`Unknown ${r}: ${e}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const s=e;if(s.className==null||s.config==null)throw new ee(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);const o=s.className;let a,u;if(o in n?[a,u]=n[o]:o in uo?[a,u]=uo.className:o in t&&([a,u]=t[o]),a==null)throw new ee(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const l={};for(const d of Object.keys(uo))l[d]=uo[d];for(const d of Object.keys(n))l[d]=n[d];const c=s.config;c.customObjects=l;const f=Object.assign({},uo);for(const d of Object.keys(n))uo[d]=n[d];GM(s.config);const h=u(a,s.config,n,i);return uo=Object.assign({},f),h}else{const l=Object.assign({},uo);for(const f of Object.keys(n))uo[f]=n[f];const c=new a(s.config);return uo=Object.assign({},l),c}}}function KIe(e,t){return e<t?-1:e>t?1:0}function pS(e,t){return-1*KIe(e,t)}function pf(e){if(e==null)return e;const t=[];for(const n of e)t.indexOf(n)===-1&&t.push(n);return t}function ZIe(e){if(e==null)throw new ee(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function ng(e,t,n){if(n!=null&&e.indexOf(n)<0)throw new ee(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function x5(e,t,n=0,r=1/0){return tu(n>=0),tu(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(i=>typeof i===t)}function lr(e,t){Array.isArray(e)?(z(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((n,r)=>lr(n,`element ${r+1} of ${t}`))):z(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${jne(e)}.`)}function jne(e){return e===null?"null":Array.isArray(e)?"["+e.map(t=>jne(t)).join(",")+"]":typeof e=="string"?`"${e}"`:`${e}`}function JIe(e,t,n){let r=n!=null?n():ui(),i;return(...o)=>{const a=n!=null?n():ui();return a-r<t||(r=a,i=e(...o)),i}}function Une(e){return e==="relu"?"relu":e==="linear"?"linear":e==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let QIe=0;function Wne(){return QIe++}const gS={};function uD(e=""){return e in gS||(gS[e]=0),gS[e]+=1,e+gS[e].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const eFe=["channelsFirst","channelsLast"],tFe=["nearest","bilinear"],nFe=["valid","same","causal"],rFe=["max","avg"],iFe=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ug=new Map;function jn(e){ng(eFe,"DataFormat",e)}function sFe(e){ng(tFe,"InterpolationFormat",e)}function so(e){ng(nFe,"PaddingMode",e)}function Vne(e){ng(rFe,"PoolMode",e)}const Kb=[],SV="/";function Hd(e,t){Kb.push(e);try{const n=t();return Kb.pop(),n}catch(n){throw Kb.pop(),n}}function oFe(){return Kb.length===0?"":Kb.join(SV)+SV}function Gne(e){if(!qne(e))throw new Error("Not a valid tensor name: '"+e+"'");return oFe()+e}function Hne(e){if(!qne(e))throw new Error("Not a valid tensor name: '"+e+"'");Ug.has(e)||Ug.set(e,0);const t=Ug.get(e);if(Ug.set(e,Ug.get(e)+1),t>0){const n=`${e}_${t}`;return Ug.set(n,1),n}else return e}const aFe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function qne(e){return!!e.match(aFe)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uFe(e){return e===parseInt(e.toString(),10)}function gf(e,t,n){t==null&&(t=0),n==null&&(n=e.length);let r=1;for(let i=t;i<n;++i)r*=e[i];return r}function Bm(e){if(e.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function If(e){if(e.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function Ea(e,t){if(t<e)throw new ee(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let r=e;r<t;++r)n.push(r);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let XO;function Zn(){return XO==null&&(XO=Pee().epsilon()),XO}function Aa(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bu(e,t){return Ee(e,t)}function Dw(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),ne(e,n)}function lFe(e,t){return ue(()=>{if(e.shape.length!==2)throw new ee(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);const n=Dw(e,1);return HM(n,[1,t,1])})}function cFe(e){const t=[gf(e.shape)];return ne(e,t)}function fFe(e){if(e.rank<=1)throw new ee(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],gf(e.shape,1)];return ne(e,t)}function qd(e,t,n){return ue(()=>{switch(e.rank){case 1:return UT(e,t,n);case 2:return DB(e,[t,0],[n,e.shape[1]]);case 3:return WT(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Pv(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Et(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Et(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new ee(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function YO(e,t,n){return ue(()=>{switch(e.rank){case 1:return UT(e,t,n);case 2:return DB(e,[0,t],[e.shape[0],n]);case 3:return WT(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Pv(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new ee(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function mS(e,t,n,r){return ue(()=>{switch(e.rank){case 1:return UT(e,t,n);case 2:switch(r){case 1:return qd(e,t,n);case 2:return YO(e,t,n);default:throw new ee(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return qd(e,t,n);case 2:return WT(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return YO(e,t,n);default:throw new ee(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return qd(e,t,n);case 2:return Pv(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Pv(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return YO(e,t,n);default:throw new ee(`The axis is not within the rank of the tensor ${r}`)}default:throw new ee(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function w5(e,t=-1){let n;return t<0&&(n=e[0].rank,n!==0?t=n:t=0),t===e[0].rank&&(t=-1),hr(e,t)}function _V(e,t){switch(e.rank){case 1:return Jee([e,t]);case 2:return Qee([e,t],0);case 3:return ete([e,t],0);case 4:return tte([e,t],0);default:throw new ee(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function HM(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new ee(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return vo(e,t)}function lD(e,t=0,n=1,r,i){return CB(e,t,n,r,i)}function vu(e,t,n,r){if(e.rank<2||t.rank<2)throw new ut(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){const i=e.shape.slice(-1)[0],s=t.shape.slice(-2)[0];if(i!==s)throw new ut(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(e.rank===2&&t.rank===2)return jM({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?qM(e.rank,r,Aa()):null,activation:n});{const i=e.shape.slice(),s=i.pop();e=ne(e,[-1,s]);const o=t.shape.slice(),a=o.pop(),u=o.pop(),l=[...o,a],c=Array.from({length:t.rank},(p,m)=>m===0?t.rank-2:m<=t.rank-2?m-1:m);t=ne(Ct(t,c),[u,-1]);const f=[...i,...l];return ne(jM({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?qM(e.rank,r,Aa()):null,activation:n}),f)}}function Xne(e,t,n){return ue(()=>(Array.isArray(t)?t=Ui(t,"int32"):t=Ee(t,"int32"),$w(e,t,n)))}function Iw(e){return Q(e,e)}function qM(e,t,n){const r=t.shape;if(t.rank!==1&&t.rank!==e)throw new ee(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(e===5){if(n==="channelsFirst")return r.length===1?ne(t,[1,r[0],1,1,1]):ne(t,[1,r[3],r[0],r[1],r[2]]);if(n==="channelsLast")return r.length===1?ne(t,[1,1,1,1,r[0]]):ne(t,[1].concat(r))}else if(e===4){if(n==="channelsFirst")return r.length===1?ne(t,[1,r[0],1,1]):ne(t,[1,r[2],r[0],r[1]]);if(n==="channelsLast")return r.length===1?ne(t,[1,1,1,r[0]]):ne(t,[1].concat(r))}else if(e===3){if(n==="channelsFirst")return r.length===1?ne(t,[1,r[0],1]):ne(t,[1,r[1],r[0]]);if(n==="channelsLast")return r.length===1?ne(t,[1,1,r[0]]):ne(t,[1].concat(r))}else if(e<3)return t;throw new ee(`Unsupported input rank by biasAdd: ${t.rank}`)}function Na(e,t,n){return ue(()=>(n==null&&(n=Aa()),jn(n),be(e,qM(e.rank,t,n))))}function hFe(e,t=1){if(t!==1)throw new ut(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Cw(e)}function dFe(e){return ue(()=>je(e,be(Yn(e),1)))}function Yne(e,t,n,r){return ue(()=>Lte(e,t,n,r))}function pFe(e){return ue(()=>{const t=be(.5,Q(.2,e));return Ss(t,0,1)})}function Fw(e,t,n=!1){return n?e():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gFe=["fanIn","fanOut","fanAvg"],mFe=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yFe(e){ng(gFe,"FanMode",e)}function bFe(e){ng(mFe,"Distribution",e)}class Uo extends tg{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Kne extends Uo{apply(t,n){return Kn(t,n)}}Kne.className="Zeros";ve(Kne);class C5 extends Uo{apply(t,n){return Vs(t,n)}}C5.className="Ones";ve(C5);class Zne extends Uo{constructor(t){if(super(),typeof t!="object")throw new ee(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new ee(`config must have value set but got ${t}`);this.value=t.value}apply(t,n){return ue(()=>Q(et(this.value),Vs(t,n)))}getConfig(){return{value:this.value}}}Zne.className="Constant";ve(Zne);class Jne extends Uo{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,n){return eg(t,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Jne.className="RandomUniform";ve(Jne);class Qne extends Uo{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ut(`randomNormal does not support dType ${n}.`);return lD(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Qne.className="RandomNormal";ve(Qne);class ere extends Uo{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ut(`truncatedNormal does not support dType ${n}.`);return NB(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}ere.className="TruncatedNormal";ve(ere);let tre=class extends Uo{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,n){return ue(()=>{if(t.length!==2||t[0]!==t[1])throw new ee("Identity matrix initializer can only be used for 2D square matrices.");return Q(this.gain,uB(t[0]))})}getConfig(){return{gain:this.gain}}};tre.className="Identity";ve(tre);function vFe(e,t="channelsLast"){let n,r;if(jn(t),e.length===2)n=e[0],r=e[1];else if([3,4,5].indexOf(e.length)!==-1){if(t==="channelsFirst"){const i=gf(e,2);n=e[1]*i,r=e[0]*i}else if(t==="channelsLast"){const i=gf(e,0,e.length-2);n=e[e.length-2]*i,r=e[e.length-1]*i}}else{const i=gf(e);n=Math.sqrt(i),r=Math.sqrt(i)}return[n,r]}class _s extends Uo{constructor(t){if(super(),t.scale<0)throw new ee(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,yFe(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,bFe(this.distribution),this.seed=t.seed}apply(t,n){const r=vFe(t),i=r[0],s=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,i):this.mode==="fanOut"?o/=Math.max(1,s):o/=Math.max(1,(i+s)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ut(`${this.getClassName()} does not support dType ${n}.`);return NB(t,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return eg(t,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}_s.className="VarianceScaling";ve(_s);class S5 extends _s{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return _s.className}}S5.className="GlorotUniform";ve(S5);class _5 extends _s{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return _s.className}}_5.className="GlorotNormal";ve(_5);class $5 extends _s{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return _s.className}}$5.className="HeNormal";ve($5);class k5 extends _s{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return _s.className}}k5.className="HeUniform";ve(k5);class E5 extends _s{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return _s.className}}E5.className="LeCunNormal";ve(E5);class A5 extends _s{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return _s.className}}A5.className="LeCunUniform";ve(A5);class nre extends Uo{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,n){return ue(()=>{if(t.length<2)throw new ut("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const r=ce(t.slice(0,-1)),i=t[t.length-1],s=r*i;s>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${s}) elements: Slowness may result.`);const o=[Math.max(i,r),Math.min(i,r)],a=lD(o,0,1,n,this.seed),u=qte.qr(a,!1);let l=u[0];const f=u[1].flatten().stridedSlice([0],[Math.min(i,r)*Math.min(i,r)],[Math.min(i,r)+1]);return l=Q(l,f.sign()),r<i&&(l=l.transpose()),Q(et(this.gain),l.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}nre.className="Orthogonal";ve(nre);const $V={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function kV(e,t={}){return Tw(e,Us.getMap().classNameMap,t,"initializer")}function kn(e){return v5(e)}function vn(e){if(typeof e=="string"){const t=e in $V?$V[e]:e;if(t==="GlorotNormal")return new _5;if(t==="GlorotUniform")return new S5;if(t==="HeNormal")return new $5;if(t==="HeUniform")return new k5;if(t==="LeCunNormal")return new E5;if(t==="LeCunUniform")return new A5;{const n={};return n.className=t,n.config={},kV(n)}}else return e instanceof Uo?e:kV(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XM(e){return Array.isArray(e)&&Array.isArray(e[0])}function I$(e){return e.length===0?[]:Array.isArray(e[0])?e:[e]}function Je(e){let t;if(Array.isArray(e)){if(e.length!==1)throw new ee(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function It(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(e.length===1)return e=e,e[0];throw new ee(`Expected exactly 1 Shape; got ${e.length}`)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function F$(e){let t=0;for(const n of e)n.shape.length===0?t+=1:t+=n.shape.reduce((r,i)=>r*i);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const EV="Variable";class xFe{constructor(t,n="float32",r=EV,i=!0,s=null){this.dtype=n??"float32",this.shape=t.shape,this.id=Wne(),r=r??EV,this.originalName=Gne(r),this.name=Hne(this.originalName),this.trainable_=i,this.constraint=s,this.val=Rte(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),wFe(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function wFe(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function YM(e){return e.map(t=>t.read())}function T5(e){e.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Jn{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class hu{constructor(t,n,r,i,s,o,a){this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=i,this.callArgs=s,this.outputTensorIndex=a,this.id=Wne(),o!=null&&(this.originalName=Gne(o),this.name=Hne(this.originalName)),this.rank=n.length}}let CFe=0,cD=class{constructor(t,n){this.callArgs=n,this.id=CFe++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const r of t.inboundLayers)r!=null&&r.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const n of this.inboundLayers)n!=null?t.push(n.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},SFe=0;class gt extends tg{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=SFe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=t.name;if(!n){const r=this.getClassName();n=Sl(r)+"_"+uD(r)}if(this.name=n,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let r;if(t.batchInputShape!=null)r=t.batchInputShape;else if(t.inputShape!=null){let s=null;t.batchSize!=null&&(s=t.batchSize),r=[s].concat(t.inputShape)}this.batchInputShape=r;let i=t.dtype;i==null&&(i=t.inputDType),i==null&&(i="float32"),this.dtype=i}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,n){return t.name+"_ib-"+n.toString()}getNodeAtIndex(t,n){if(this.inboundNodes.length===0)throw new xo(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=t)throw new ee(`Asked to get ${n} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Ri(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Ri(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new eu(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new eu(`Layer ${this.name} is not connected, no input to return.`);return Ri(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new eu(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new eu(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Ri(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(n=>n.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=cn(t),this.inputSpec==null||this.inputSpec.length===0)return;const n=cn(this.inputSpec);if(t.length!==n.length)throw new ee(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let r=0;r<t.length;r++){const i=t[r],s=n[r];if(s==null)continue;const o=i.rank;if(s.ndim!=null&&o!==s.ndim)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${o}`);if(s.maxNDim!=null&&o>s.maxNDim)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${o}`);if(s.minNDim!=null&&o<s.minNDim)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${o}.`);if(s.dtype!=null&&i.dtype!==s.dtype)throw new ee(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${i.dtype}.`);if(s.axes){const a=i.shape;for(const u in s.axes){const l=Number(u),c=s.axes[u],f=l>=0?a[l]:a[a.length+l];if(c!=null&&[c,null].indexOf(f)===-1)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected axis ${l} of input shape to have value ${c} but got shape ${a}.`)}}if(s.shape!=null)for(let a=0;a<s.shape.length;++a){const u=s.shape[a],l=i.shape[a];if(u!=null&&l!=null&&u!==l)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${i.shape}.`)}}}call(t,n){return t}invokeCallHook(t,n){this._callHook!=null&&this._callHook(t,n)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,n){n=n||{},this.assertNotDisposed();const r=cn(t);let i=!0;for(const o of r)if(!(o instanceof hu)){i=!1;break}let s=!0;for(const o of r)if(o instanceof hu){s=!1;break}if(i===s)throw new ee("Arguments to apply() must be all SymbolicTensors or all Tensors");return Hd(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const o=[];for(const a of cn(t))o.push(a.shape);this.build(Ri(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(t),s){let o=this.call(t,n);const a=cn(o),u=[];for(let l of a)r.indexOf(l)!==-1&&(l=l.clone()),u.push(l);if(o=Ri(u),this.activityRegularizer!=null)throw new ut("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=_Fe(t),a=this.computeOutputShape(o);let u;const l=$Fe(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?u=a.map((c,f)=>new hu(l,c,this,cn(t),n,this.name,f)):u=new hu(l,a,this,cn(t),n,this.name),this.addInboundNode(t,u,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new ut("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((r,i)=>{r!=null&&t[i]!=null&&t[i]!==r&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new eu(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const n of this.inboundNodes){const r=JSON.stringify(n.outputShapes);t.indexOf(r)===-1&&t.push(r)}if(t.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new eu(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new xo(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return F$(this.weights)}build(t){this.built=!0}getWeights(t=!1){return YM(t?this.trainableWeights:this.weights)}setWeights(t){ue(()=>{const n=this.weights;if(n.length!==t.length)throw new ee(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${n.length} weights. Provided weights: ${t}...`);if(n.length===0)return;const r=[],i=YM(n);for(let s=0;s<i.length;++s){const o=i[s],a=n[s],u=t[s];if(!_t(o.shape,u.shape))throw new ee(`Layer weight shape ${o.shape} not compatible with provided weight shape ${u.shape}`);r.push([a,u])}T5(r)})}addWeight(t,n,r,i,s,o,a,u){if(this._addedWeightNames.indexOf(t)!==-1)throw new ee(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(i=u!=null?u():vn("zeros"));const l=i.apply(n,r),c=new xFe(l,r,t,o,a);return l.dispose(),s!=null&&this.addLoss(()=>s.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=cn(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}addInboundNode(t,n,r,i,s,o,a=null){const u=cn(t);n=cn(n),r=cn(r),i=cn(i),s=I$(s),o=I$(o);const l=[],c=[],f=[];for(const h of u)l.push(h.sourceLayer),c.push(h.nodeIndex),f.push(h.tensorIndex);new cD({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:f,inputTensors:u,outputTensors:n,inputMasks:r,outputMasks:i,inputShapes:s,outputShapes:o},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function _Fe(e){e=cn(e);const t=[];for(const n of e)t.push(n.shape);return Ri(t)}function $Fe(e){return"float32"}function rre(e,t,n){if((t==null||n!=null&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),t.inboundNodes.length===0)return[e];{const r=t.inboundNodes[n];if(r.inboundLayers.length===0)return r.inputTensors;{const i=[];for(let s=0;s<r.inboundLayers.length;s++){const o=r.inputTensors[s],a=r.inboundLayers[s],u=r.nodeIndices[s],l=rre(o,a,u);for(const c of l)i.indexOf(c)===-1&&i.push(c)}return i}}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ow extends gt{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:uD("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new ee("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=t.batchInputShape;if(n==null){if(t.inputShape==null)throw new ee("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new ee("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=t.dtype||"float32";this.batchInputShape=n,this.dtype=r,this.inputSpec=[{shape:n}];const i=new hu(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new cD({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(t,n){throw new ee(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Ow.className="InputLayer";ve(Ow);function kFe(e){if(e.batchShape==null&&e.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(e.batchShape!=null&&e.shape!=null)throw new ee("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;e.shape!=null&&t==null&&(t=[null].concat(e.shape));let n=e.dtype;return n==null&&(n="float32"),new Ow({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EFe(e,t){if(e.dtype==null||e.dtype===t.dtype)return t;try{return Ee(t,e.dtype)}catch{throw new ee(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}class Xc{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof Xc)for(const n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(const n of t)this.add(n.key,n.value)}}add(t,n,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=EFe(t,n),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new ee(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof hu){if(this.id2Value[t.id]==null)throw new ee(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const n=this.name2Id[t];if(n==null)throw new ee(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof hu){if(this.id2Value[t.id]==null)throw new ee(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const n=this.name2Id[t];if(n==null)throw new ee(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&ct(this.id2Mask)}}const O$=new zne,N$=new zne;function AFe(e){O$!=null&&O$.setMaxEntries(e),N$!=null&&N$.setMaxEntries(e)}function bb(e,t,n,r){const i=n==null?!1:n.training,s=Array.isArray(e),o=s?e:[e],a=o.map(p=>p.name),u=[],l=t.names();for(const p of a)l.indexOf(p)!==-1?u.push(t.getValue(p)):u.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const c=a.join(",")+"|"+t.names().sort().join(",");let f=O$.get(c),h;if(f==null){const p=TFe(o,t);f=p.sorted,h=p.recipientCounts,O$.put(c,f),N$.put(c,h)}h={},i||Object.assign(h,N$.get(c));const d=new Xc(t);for(let p=0;p<f.length;++p){if(r!=null){const $=A$().numTensors;$>r.maxNumTensors&&(r.maxNumTensors=$),$<r.minNumTensors&&(r.minNumTensors=$)}const m=f[p],g=m.sourceLayer;if(g instanceof Ow)continue;const y=[],b=[],x=[];let v=!1;for(const $ of m.inputs){const k=d.getValue($),E=d.getMask($);y.push(k),b.push(E),E!=null&&(v=!0),i||(h[$.name]--,h[$.name]===0&&!t.hasKey($)&&a.indexOf($.name)===-1&&!k.isDisposed&&$.sourceLayer.stateful!==!0&&x.push(k))}v&&(n=n||{},n.mask=b[0]);const w=cn(g.apply(y,n));let C=null;g.supportsMasking&&(C=g.computeMask(y,b));const S=IFe(m),_=Array.isArray(S)?S:[S];for(let $=0;$<_.length;++$){d.hasKey(_[$])||d.add(_[$],w[$],Array.isArray(C)?C[0]:C);const k=a.indexOf(_[$].name);k!==-1&&(u[k]=w[$])}i||ct(x)}return d.disposeMasks(),s?u:u[0]}function TFe(e,t){z(e!=null&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(e.length===1){const i=AV(e[0],t);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of e){const{sorted:o,recipientMap:a}=AV(s,t);for(const u of o)i.has(u.name)||(n.push(u),i.add(u.name));for(const u in a)r[u]==null&&(r[u]=new Set),a[u].forEach(l=>r[u].add(l))}}return{sorted:n,recipientCounts:DFe(r)}}function DFe(e){const t={};for(const n in e)t[n]=e[n].size;return t}function AV(e,t){const n=new Set,r=[],i={};for(const a of t.names())n.add(a);const s=[],o=[];for(s.push(e);s.length>0;){const a=s[s.length-1];if(n.has(a.name)){s.pop();continue}const u=o[o.length-1]===s.length-1;if(a.inputs.length===0||u)s.pop(),r.push(a),n.add(a.name),u&&o.pop();else{o.push(s.length-1);for(const l of a.inputs)i[l.name]==null&&(i[l.name]=new Set),i[l.name].add(a.name),!n.has(l.name)&&s.push(l)}}return{sorted:r,recipientMap:i}}function IFe(e){let t;if(e.sourceLayer.inboundNodes.length===1)t=e.sourceLayer.output;else{let n=null;for(let r=0;r<e.sourceLayer.inboundNodes.length;++r)for(const i of e.sourceLayer.inboundNodes[r].outputTensors)if(i.id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FFe=ae();FFe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,AFe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function D5(e,t){return ue(()=>Zr(Oe(Q(e,e),t,!0)))}class Nw extends tg{getConfig(){return{}}}class ire extends Nw{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ue(()=>{const n=D5(t,this.axis),r=Ss(n,0,this.maxValue);return Q(t,je(r,be(Zn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}ire.className="MaxNorm";ve(ire);class sre extends Nw{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ue(()=>je(t,be(Zn(),D5(t,this.axis))))}getConfig(){return{axis:this.axis}}}sre.className="UnitNorm";ve(sre);class ore extends Nw{apply(t){return qu(t)}}ore.className="NonNeg";ve(ore);class are extends Nw{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ue(()=>{const n=D5(t,this.axis),r=be(Q(this.rate,Ss(n,this.minValue,this.maxValue)),Q(1-this.rate,n));return Q(t,je(r,be(Zn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}are.className="MinMaxNorm";ve(are);const TV={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Qn(e){return v5(e)}function DV(e,t={}){return Tw(e,Us.getMap().classNameMap,t,"constraint")}function er(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in TV?TV[e]:e,config:{}};return DV(n)}else return e instanceof Nw?e:DV(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function qh(e){if(e==null)return;const t=[],n=[],r=[];for(const i in e){const s=e[i];if(typeof s!="number"){const o=s;t.push(o.data()),n.push(i),r.push(o)}}if(t.length>0){const i=await Promise.all(t);for(let s=0;s<i.length;++s)e[n[s]]=i[s][0];ct(r)}}function ure(e){if(e!=null)for(const t in e){const n=e[t];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var IV;(function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"})(IV||(IV={}));const OFe=125;class Bv{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,n){}async onEpochEnd(t,n){}async onBatchBegin(t,n){}async onBatchEnd(t,n){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class NFe{constructor(t,n=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=n}append(t){this.callbacks.push(t)}setParams(t){for(const n of this.callbacks)n.setParams(t)}setModel(t){for(const n of this.callbacks)n.setModel(t)}async onEpochBegin(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochBegin(t,n)}async onEpochEnd(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochEnd(t,n)}async onBatchBegin(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchBegin(t,n)}async onBatchEnd(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchEnd(t,n)}async onTrainBegin(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainEnd(t)}}class MFe extends Bv{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,n){n==null&&(n={});const r=n.size==null?0:n.size;this.seen+=r;for(const i in n){const s=n[i];if(typeof s=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+s*r;else{let o;i in this.totals?o=this.totals[i]:this.totals[i]=0;const a=ue(()=>be(this.totals[i],Q(s,r)));this.totals[i]=a,o!=null&&o.dispose()}}}async onEpochEnd(t,n){if(n!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?n[r]=this.totals[r]/this.seen:ue(()=>{const i=Q(je(1,this.seen),this.totals[r]);n[r]=i,this.totals[r].dispose(),va(n[r])}))}}class RFe extends Bv{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,n){n==null&&(n={}),this.epoch.push(t);for(const r in n)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(n[r])}async syncData(){const t=[],n=[],r=[];for(const s in this.history){const o=this.history[s];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const u=o[a];t.push(u.data()),n.push(s),r.push(a)}}const i=await Promise.all(t);for(let s=0;s<i.length;++s)this.history[n[s]][r[s]].dispose(),this.history[n[s]][r[s]]=i[s][0]}}class PFe extends Bv{constructor(t,n){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||JB,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=OFe),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");v$(this.yieldEvery)&&(this.maybeWait=JIe(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,n,r){const i=[];this.yield!=null&&(await qh(r),i.push(this.yield(t,n,r))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(t,n){this.currentEpoch=t,this.epochBegin!=null&&(await qh(n),await this.epochBegin(t,n))}async onEpochEnd(t,n){const r=[];this.epochEnd!=null&&(await qh(n),r.push(this.epochEnd(t,n))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(t,n){this.batchBegin!=null&&(await qh(n),await this.batchBegin(t,n))}async onBatchEnd(t,n){const r=[];this.batchEnd!=null&&(await qh(n),r.push(this.batchEnd(t,n))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):v$(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),await Promise.all(r)}async onTrainBegin(t){this.trainBegin!=null&&(await qh(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await qh(t),await this.trainEnd(t))}}function lre(e,t){return e==null&&(e={}),e instanceof Bv?[e]:Array.isArray(e)&&e[0]instanceof Bv?e:cn(e).map(r=>new PFe(r,t))}class po{constructor(){}static registerCallbackConstructor(t,n){z(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),po.checkForDuplicate(n),po.constructors[t]==null&&(po.constructors[t]=[]),po.constructors[t].push(n)}static checkForDuplicate(t){for(const n in po.constructors)po.constructors[+n].forEach(i=>{if(i===t)throw new ee("Duplicate callback constructor.")})}static clear(){po.constructors={}}static createCallbacks(t){const n=[];for(const r in po.constructors){const i=+r;t>=i&&n.push(...po.constructors[i])}return n.map(r=>new r)}}po.constructors={};function cre(e,t,n,r,i,s,o,a,u){const l=new RFe,c=[new MFe,...po.createCallbacks(t)];e!=null&&c.push(...e),c.push(l);const f=new NFe(c);return f.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:o,verbose:t,doValidation:a,metrics:u}),{callbackList:f,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xu(e,t={},n=!1){return Tw(e,Us.getMap().classNameMap,t,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function M$(e,t){return ue(()=>{e.dtype!=="float32"&&(e=Ee(e,"float32"));const n=Oe(Iw(e),t,!0),r=D1(n.shape,Zn()),i=Zr(pc(n,r));return je(e,i)})}function fD(e,t){return ue(()=>In(Iw(Ie(t,e)),-1))}function I5(e,t){return ue(()=>In(Yn(Ie(t,e)),-1))}function F5(e,t){return ue(()=>{const n=Ie(e,t),r=Ss(Yn(e),Zn(),Number.MAX_VALUE),i=Yn(je(n,r));return Q(100,In(i,-1))})}function LFe(e,t){return ue(()=>{const n=Ss(t,Zn(),Number.MAX_VALUE),r=Js(be(1,n)),i=Ss(e,Zn(),Number.MAX_VALUE),s=Js(be(1,i));return In(Iw(Ie(r,s)),-1)})}function BFe(e,t){return ue(()=>{const n=pc(0,Ie(1,Q(e,t)));return In(Iw(n),-1)})}function zFe(e,t){return ue(()=>{const n=pc(0,Ie(1,Q(e,t)));return In(n,-1)})}function jFe(e,t){return ue(()=>{const n=Oe(Q(e,t),-1),r=To(Q(Ie(1,e),t),-1);return pc(0,be(1,Ie(r,n)))})}function UFe(e,t){return ue(()=>{const n=Math.log(2),r=Ie(t,e),i=Ie(be(r,I1(Q(-2,r))),n);return In(i,-1)})}function zv(e,t,n=!1){return ue(()=>{if(n)t=VT(t);else{const r=Oe(t,t.shape.length-1,!0);t=je(t,r)}return t=Ss(t,Zn(),1-Zn()),dn(Oe(Q(Ee(e,"float32"),Js(t)),t.shape.length-1))})}function R$(e,t,n=!1){return ue(()=>{const r=Ee(_w(cFe(e)),"int32");t=Ss(t,Zn(),1-Zn());const i=t.shape,s=ne(Mv(r,i[i.length-1]),i);return zv(s,t,n)})}function WFe(e,t){if(!_t(e.shape,t.shape))throw new ee(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return ue(()=>{const n=qu(t),r=dn(Yn(t));return be(Ie(n,Q(t,e)),NT(Zs(r)))})}function hD(e,t){return ue(()=>{let n;return n=Ss(t,Zn(),1-Zn()),n=Js(je(n,Ie(1,n))),In(WFe(e,n),-1)})}function VFe(e,t){return ue(()=>{const n=Ss(e,Zn(),1),r=Ss(t,Zn(),1);return Oe(Q(e,Js(je(n,r))),-1)})}function GFe(e,t){return ue(()=>{const n=Js(be(Zn(),t));return In(Ie(t,Q(e,n)),-1)})}function fre(e,t){return ue(()=>{const n=M$(e,-1),r=M$(t,-1),i=Q(n,r);return dn(Oe(i,-1))})}const P$={meanSquaredError:fD,meanAbsoluteError:I5,meanAbsolutePercentageError:F5,meanSquaredLogarithmicError:LFe,squaredHinge:BFe,hinge:zFe,categoricalHinge:jFe,logcosh:UFe,categoricalCrossentropy:zv,sparseCategoricalCrossentropy:R$,binaryCrossentropy:hD,kullbackLeiblerDivergence:VFe,poisson:GFe,cosineProximity:fre};function KO(e){if(typeof e=="string"){if(e in P$)return P$[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ee(t)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hre(e,t){return ue(()=>{const n=Q(.5,Qs(t)),r=bu(Rs(t,n),e.dtype);return In(ka(e,r),-1)})}function dre(e,t){return ue(()=>bu(ka(Mm(e,-1),Mm(t,-1)),"float32"))}function HFe(e,t){return ue(()=>Ee(Oe(Fu(ka(e,1),ka(t,1))),"float32"))}function qFe(e,t){return ue(()=>Ee(Oe(Fu(ka(e,0),ka(t,1))),"float32"))}function XFe(e,t){return ue(()=>{const n=HFe(e,t),r=qFe(e,t),i=be(n,r);return Ee(Yr(Rs(i,0),je(n,i),0),"float32")})}function YFe(e,t){return hD(e,t)}function KFe(e,t){return e.rank===t.rank&&(e=xh(e,[e.rank-1])),t=Mm(t,-1),t.dtype!==e.dtype&&(t=Ee(t,e.dtype)),Ee(ka(e,t),"float32")}const ZFe=fD,JFe=fD,QFe=I5,eOe=I5,tOe=F5,nOe=F5,pre=zv,rOe=fre,gre=R$,L$={binaryAccuracy:hre,categoricalAccuracy:dre,precision:XFe,categoricalCrossentropy:pre,sparseCategoricalCrossentropy:gre,mse:ZFe,MSE:JFe,mae:QFe,MAE:eOe,mape:tOe,MAPE:nOe,cosine:rOe};function iOe(e){if(typeof e=="string"&&e in L$)return L$[e];if(typeof e!="string"&&e!=null)return e;throw new ee(`Unknown metric ${e}`)}function yS(e){if(tu(e!==null,`Unknown LossOrMetricFn ${e}`),typeof e=="string")return e;{let t;for(const n of Object.keys(P$))if(P$[n]===e){t=n;break}if(t!==void 0)return t;for(const n of Object.keys(L$))if(L$[n]===e){t=n;break}return t!==void 0?t:e.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sOe(e){const t={Adagrad:()=>ld.adagrad(.01),Adadelta:()=>ld.adadelta(1,.95,Zn()),Adam:()=>ld.adam(.001,.9,.999,Zn()),Adamax:()=>ld.adamax(.002,.9,.999,Zn(),0),RMSProp:()=>ld.rmsprop(.001,.9,0,Zn()),SGD:()=>ld.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new ee(`Unknown Optimizer ${e}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const FV=1*1024*1024;function OV(e,t,n=!1){if(e==null||typeof e!="object"||Object.getPrototypeOf(e)!==Object.prototype||!KM(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const r=JSON.stringify(e);r.length>FV&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${FV}.`)}}function KM(e){if(e===null)return!0;if(typeof e=="object")if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t)if(typeof n!="string"||!KM(e[n]))return!1;return!0}else if(Array.isArray(e)){for(const t of e)if(!KM(t))return!1;return!0}else return!1;else{const t=typeof e;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oOe(e,t,n,r=console.log){const i=uOe(e),s=["Layer (type)","Input Shape","Output shape","Param #"];i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(t*c)));let o;if(!i){s.push("Receives inputs"),o=[];for(const c in e.nodesByDepth)o.push(...e.nodesByDepth[c])}r("_".repeat(t)),B$(s,n,r),r("=".repeat(t));const a=e.layers;for(let c=0;c<a.length;++c)i?lOe(a[c],n,r):cOe(a[c],n,o,r),r((c===a.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const u=aOe(e),l=F$(e.nonTrainableWeights);r(`Total params: ${u+l}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${l}`),r("_".repeat(t))}function aOe(e){let t;return e.collectedTrainableWeights!=null?t=F$(e.collectedTrainableWeights):t=F$(e.trainableWeights),t}function uOe(e){let t=!0;const n=[],r=[];for(const i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(const i of n){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){t=!1;break}r.push(...i)}if(t)for(const i of e.layers){let s=!1;for(const o of i.inboundNodes)if(r.indexOf(o)!==-1)if(s){t=!1;break}else s=!0;if(!t)break}return t}function B$(e,t,n=console.log){let r="";for(let i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=e[i],r=r.slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function lOe(e,t,n){let r,i;try{i=e.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(e.outputShape)}catch{r="multiple"}const s=e.name,o=e.getClassName(),a=[`${s} (${o})`,i,r,e.countParams().toString()];B$(a,t,n)}function cOe(e,t,n,r){let i,s;try{s=e.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{s="multiple"}try{i=JSON.stringify(e.outputShape)}catch{i="multiple"}const o=[];for(const f of e.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(f)===-1))for(let h=0;h<f.inboundLayers.length;++h){const d=f.inboundLayers[h].name,p=f.nodeIndices[h],m=f.tensorIndices[h];o.push(`${d}[${p}][${m}]`)}const a=e.name,u=e.getClassName(),l=o.length===0?"":o[0],c=[`${a} (${u})`,s,i,e.countParams().toString(),l];B$(c,t,r);for(let f=1;f<o.length;++f)B$(["","","","",o[f]],t,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mre(e,t,n){return(e==="inboundNodes"||e==="outputLayers"||e==="inputLayers")&&t===0&&typeof n=="string"}function z$(e,t){if(e===null)return null;if(typeof e=="string")return vd(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const s=e[i];mre(t,i,s)?n.push(s):n.push(z$(s,t))}return n}else{const n={};for(const r of Object.keys(e)){const i=e[r];if(r==="name"&&typeof i=="string")n[r]=i;else{const s=vd(r);n[s]=z$(i,s)}}return n}}function ZM(e,t){if(e==null)return null;if(typeof e=="string")return Sl(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const s=e[i];mre(t,i,s)?n.push(s):n.push(ZM(s,t))}return n}else{const n={};for(const r of Object.keys(e)){const i=e[r],s=Sl(r);(r==="name"||r==="className")&&typeof i=="string"?n[s]=i:n[s]=ZM(i,r)}return n}}/** @license See the LICENSE file. */const yre="4.6.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class na extends gt{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=uD(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],pf(this.inputs).length!==this.inputs.length)throw new ee(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);pf(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const x=b.sourceLayer,v=b.nodeIndex,w=b.tensorIndex;this.outputLayers.push(x),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(w)}for(const b of this.inputs){const x=b.sourceLayer,v=b.nodeIndex,w=b.tensorIndex;tu(v===0,"input layer has >1 nodes"),tu(w===0,"input layer has >1 tensors"),this.inputLayers.push(x),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(w)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const x=this.inputLayers[b];if(!(x instanceof Ow))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${x.getClassName()}.`);this.inputNames.push(x.name),this.feedInputShapes.push(x.batchInputShape),this.feedInputNames.push(x.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const n={},r={},i={},s={},o={},a=[],u=(b,x,v,w,C,S)=>{(w==null||C==null||S==null)&&(w=b.sourceLayer,C=b.nodeIndex,S=b.tensorIndex);const _=w.inboundNodes[C];if(v.indexOf(_)!==-1)throw new xo(`The tensor ${b.name} at layer "${w.name}" is part of a cycle.`);if(x.indexOf(_)!==-1)return;this.containerNodes.add(na.nodeKey(w,C)),w.id in o||(o[w.id]=Object.keys(o).length),v.indexOf(_)===-1&&v.push(_);const $=_.inboundLayers.length;for(let k=0;k<$;k++){const E=_.inputTensors[k],F=_.inboundLayers[k],T=_.nodeIndices[k],I=_.tensorIndices[k];u(E,x,v,F,T,I)}for(x.push(_);v.indexOf(_)>=0;)v.splice(v.indexOf(_),1);a.push(_)},l=[],c=[];for(const b of this.outputs)u(b,l,c);const f=a.slice().reverse();for(const b of f){r[b.id]=b,b.id in n||(n[b.id]=0);let x=n[b.id];const v=i[b.outboundLayer.id]==null?0:i[b.outboundLayer.id];x=Math.max(x,v),i[b.outboundLayer.id]=x,s[b.outboundLayer.id]=b.outboundLayer,n[b.id]=x;for(let w=0;w<b.inboundLayers.length;w++){const C=b.inboundLayers[w],S=b.nodeIndices[w],_=C.inboundNodes[S],$=n[_.id]==null?0:n[_.id];n[_.id]=Math.max(x+1,$),r[_.id]=_}}const h={};for(const b in n){const x=n[b];x in h||(h[x]=[]),h[x].push(r[b])}const d={};for(const b in i){const x=i[b];x in d||(d[x]=[]),d[x].push(s[b])}let p=Object.keys(d).map(b=>parseInt(b,10)).sort(pS);this.layers=[];for(const b of p){const x=d[b];x.sort((v,w)=>{const C=o[v.id],S=o[w.id];return C<S?-1:C>S?1:0});for(const v of x)v instanceof na&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=d,p=Object.keys(h).map(b=>parseInt(b,10)).sort(pS);const m=this.inputs.slice(),g=[];for(const b of p)for(const x of h[b]){const v=x.outboundLayer;if(v!=null){for(const w of x.inputTensors)if(m.indexOf(w)===-1)throw new xo(`Graph disconnected: cannot obtain value for tensor ${w} at layer "${v.name}". The following previous layers were accessed without issue: ${g}`);for(const w of x.outputTensors)m.push(w);g.push(v.name)}}this.nodesByDepth=h;const y=this.layers.map(b=>b.name);for(const b of y){const x=y.filter(v=>v===b).length;if(x!==1)throw new xo(`The name "${b}" is used ${x} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new cD({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new ee("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.layers)n.push(...r.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){const r={};let i=0;for(const o of this.layers)for(const a of o.weights){if(r[a.originalName]!=null)throw new ee(`Duplicate weight name: ${a.originalName}`);r[a.originalName]=a,i++}const s=[];for(const o in t){let a=o;if(r[o]==null){const u=o.split("/");a=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(r[a]!=null)s.push([r[a],t[o]]);else if(n)throw new ee(`Provided weight data has no target variable: ${o}`);delete r[a]}if(n){const o=[];for(const a in r)o.push(a);if(o.length>0)throw new ee(`${o.length} of ${i} weights are not set: ${o}`)}T5(s)}updatedConfig(){const t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${yre}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){const r=ZM(this.updatedConfig());return n?JSON.stringify(r):r}call(t,n){return ue(()=>{t=cn(t);const r=new Xc;for(let i=0;i<this.inputs.length;++i)r.add(this.inputs[i],t[i]);return bb(this.outputs,r,n)})}computeMask(t,n){return ue(()=>{t=cn(t);let r;return n==null?r=pp(null,t.length):r=cn(n),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){const n=I$(t);if(n.length!==this.inputLayers.length)throw new ee(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<n.length;a++){const u=this.inputLayers[a],l=n[a],c=u.name+"_0_0";r[c]=l}const i=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(pS);if(i.length>1)for(const a of i){const u=this.nodesByDepth[a];for(const l of u){const c=l.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;const f=[];for(let m=0;m<l.inboundLayers.length;m++){const g=l.inboundLayers[m],y=l.nodeIndices[m],b=l.tensorIndices[m],x=`${g.name}_${y}_${b}`,v=r[x];f.push(v)}const h=c.computeOutputShape(Ri(f)),d=I$(h),p=c.inboundNodes.indexOf(l);for(let m=0;m<d.length;m++){const g=`${c.name}_${p}_${m}`;r[g]=d[m]}}}const s=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const u=this.outputLayers[a],l=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],f=`${u.name}_${l}_${c}`;o.push(f)}for(let a=0;a<o.length;a++){const u=o[a];tu(u in r),s.push(r[u])}return Ri(s)}runInternalGraph(t,n){n==null&&(n=pp(null,t.length));const r={};for(let u=0;u<this.inputs.length;++u){const l=this.inputs[u],c=t[u],f=n[u];r[l.id]=[c,f]}const i=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(pS);for(const u of i){const l=this.nodesByDepth[u];for(const c of l){const f=c.outboundLayer,h=c.inputTensors,d=c.outputTensors,p=new Array;for(const m of h)m.id in r&&p.push(r[m.id]);if(p.length===h.length){let m={},g,y,b,x;if(c.callArgs!=null&&(m=c.callArgs),p.length===1){const[v,w]=p[0];m.mask==null&&(m.mask=w),b=cn(f.call(v,m)),x=cn(f.computeMask(v,w)),g=[v],y=[w]}else g=p.map(v=>v[0]),y=p.map(v=>v[1]),m.mask==null&&(m.mask=y),b=cn(f.call(g,m)),x=cn(f.computeMask(g,y));if(f.activityRegularizer)throw new ut("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<d.length;++v){const w=d[v],C=b[v],S=x[v];r[w.id]=[C,S]}}}}const s=[],o=[],a=[];for(const u of this.outputs){tu(u.id in r,`Could not compute output ${u.name} : ${u.id}`);const[l,c]=r[u.id];a.push(l.shape),s.push(l),o.push(c)}return[s,o,a]}buildNodeConversionMap(t){const n={};let r;for(const i of this.layers){r=i instanceof na?1:0;for(let s=0;s<i.inboundNodes.length;s++){const o=na.nodeKey(i,s);this.containerNodes.has(o)&&(n[o]=r,r+=1)}}return n}getLayer(t,n){if(n!=null){if(this.layers.length<=n)throw new ee(`Was asked to retrieve layer at index ${n}, but model only has ${this.layers.length} layer(s).`);return this.layers[n]}else if(t==null)throw new ee("Provide either a layer name or layer index");for(const r of this.layers)if(r.name===t)return r;throw new ee(`No such layer: ${t}`)}calculateLosses(){return ue(()=>{const t=[];for(const n of this.layers)for(let r=0;r<n.inboundNodes.length;++r){const i=na.nodeKey(n,r);this.containerNodes.has(i)&&t.push(...n.calculateLosses())}return t})}getConfig(){const t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const a=o.getClassName(),u=o.getConfig(),l=[];for(let f=0;f<o.inboundNodes.length;f++){const h=o.inboundNodes[f],d=na.nodeKey(o,f);let p={};if(this.containerNodes.has(d)){if(h.callArgs)try{JSON.stringify(h.callArgs),p=h.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(h.inboundLayers.length>0){const m=[];for(let g=0;g<h.inboundLayers.length;g++){const y=h.inboundLayers[g],b=h.nodeIndices[g],x=h.tensorIndices[g],v=na.nodeKey(y,b);let w=n[v];w==null&&(w=0),m.push([y.name,w,x,p])}l.push(m)}}}const c={};c.name=o.name,c.className=a,c.config=u,c.inboundNodes=l,r.push(c)}t.layers=r;const i=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],u=this.inputLayersNodeIndices[o],l=na.nodeKey(a,u);if(!this.containerNodes.has(l))continue;let c=n[l];c==null&&(c=0);const f=this.inputLayersTensorIndices[o];i.push([a.name,c,f])}t.inputLayers=i;const s=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],u=this.outputLayersNodeIndices[o],l=na.nodeKey(a,u);if(!this.containerNodes.has(l))continue;let c=n[l];c==null&&(c=0);const f=this.outputLayersTensorIndices[o];s.push([a.name,c,f])}return t.outputLayers=s,t}static fromConfig(t,n,r={},i=!1){const s={},o={};function a(g,y){g.name in o?o[g.name].push(y):o[g.name]=[y]}function u(g,y){const b=[];let x;for(const v of y){const w=v[0],C=v[1],S=v[2];if(x=v[3]==null?{}:v[3],!(w in s)){a(g,y);return}const _=s[w];if(_.inboundNodes.length<=C){a(g,y);return}const $=_.inboundNodes[C];b.push($.outputTensors[S])}b.length>0&&g.apply(Ri(b),x)}function l(g){const y=g.name,b=xu(g,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(i),s[y]=b,g.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new ee(`Corrupted configuration, expected array for nodeData: ${v}`);a(b,v)})}const c=n.name,f=n.layers;for(const g of f)l(g);for(;!ZIe(o);)for(const g of f){const y=s[g.name];if(y.name in o){const b=o[y.name];delete o[y.name];for(const x of b)u(y,x)}}const h=[],d=[],p=n.inputLayers;for(const g of p){const y=g[0],b=g[1],x=g[2];tu(y in s);const w=s[y].inboundNodes[b].outputTensors;h.push(w[x])}const m=n.outputLayers;for(const g of m){const y=g[0],b=g[1],x=g[2];tu(y in s);const w=s[y].inboundNodes[b].outputTensors;d.push(w[x])}return new t({inputs:h,outputs:d,name:c})}get stateful(){if(this._stateful)throw new ee("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){ue(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fOe(e,t,n){const r=t.length;if(e==null||Array.isArray(e)&&e.length===0)return t.map(i=>null);if(r===1)return Array.isArray(e)&&e.length===1?e:typeof e=="object"&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}else if(typeof e=="object"&&Object.keys(e).length>0&&typeof e[Object.keys(e)[0]]=="object"){const i=[];return t.forEach(s=>{s in e?i.push(e[s]):i.push(null)}),i}else throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function bre(e,t){return fOe(e,t,"classWeight")}async function vre(e,t,n,r){if(t!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const i=ue(()=>{if(e.shape.length===1)return df(e);if(e.shape.length===2){if(e.shape[1]>1)return Mm(e,1);if(e.shape[1]===1)return ne(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await i.data());ct(i);const o=[];return s.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),Ui(o,"float32")}else return null}function hOe(e,t){return Q(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const dOe=32;function xre(e,t){let n,r;const i=t;n=i.xs,r=i.ys,z(n!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const s=NV("input",e.inputNames,n),o=NV("output",e.outputNames,r),a=s[0].shape[0];z(s.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),z(o.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let u=0;u<s.length;u++)z(s[u].shape[0]===a,()=>`Batch size mismatch: input ${e.inputNames[u]} has ${s[u].shape[0]}; expected  ${a} based on input ${e.inputNames[0]}.`);for(let u=0;u<o.length;u++)z(o[u].shape[0]===a,()=>`Batch size mismatch: output ${e.outputNames[u]} has ${o[u].shape[0]}; expected  ${a} based on input ${e.inputNames[0]}.`);return{xs:s,ys:o}}function NV(e,t,n){if(n instanceof Vt)return[n];if(Array.isArray(n))return z(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{const r=[];for(const i of t){if(n[i]==null)throw new ee(`The feature data generated by the dataset lacks the required ${e} key '${i}'.`);r.push(n[i])}return r}}function pOe(e){if(e.length===3)throw new ut("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function gOe(e,t,n){const r=n.batchesPerEpoch!=null;if(z(e.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),z(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),z(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),z(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),z(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const i=n.validationData!=null;let s,o;if(i)if(MV(n.validationData))z(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const g=pOe(n.validationData);s=g.xs,o=g.ys}const a=e.makeTrainFunction(),u=e.getDedupedMetricsNames();let l;i?l=u.slice().concat(u.map(g=>"val_"+g)):l=u.slice();const c=lre(n.callbacks,n.yieldEvery),f=n.verbose==null?1:n.verbose,{callbackList:h,history:d}=cre(c,f,n.epochs,null,null,mOe(t,n),null,i,l);h.setModel(e),e.history=d,await h.onTrainBegin(),e.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await t.iterator();for(;p<n.epochs;){const g={};await h.onEpochBegin(p);let y=0,b=0;for(r||(m=await t.iterator());!r||y<n.batchesPerEpoch;){const x=await m.next();if(r&&x.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(x.value!=null){const{xs:v,ys:w}=xre(e,x.value),C={};C.batch=b,C.size=v[0].shape[0],await h.onBatchBegin(b,C);const S=[];if(n.classWeight!=null){const k=bre(n.classWeight,e.outputNames);for(let E=0;E<k.length;++E)S.push(await vre(w[E],null,k[E]))}const _=v.concat(w).concat(S),$=a(_);ct(_);for(let k=0;k<u.length;++k){const E=u[k],F=$[k];C[E]=F,va(F)}await h.onBatchEnd(b,C),ure(C),b++,y++}if(r?y>=n.batchesPerEpoch:x.done){if(i){let v;MV(n.validationData)?v=cn(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):v=cn(e.evaluate(s,o,{batchSize:n.validationBatchSize==null?dOe:n.validationBatchSize,verbose:0}));for(let w=0;w<e.metricsNames.length;++w)g[`val_${e.metricsNames[w]}`]=v[w]}break}if(e.stopTraining_)break}if(await h.onEpochEnd(p,g),p++,e.stopTraining_)break}return await h.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function mOe(e,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function MV(e){return typeof e.iterator=="function"}function yOe(e){return typeof e.next=="function"}async function bOe(e,t,n){n=n||{};const r=n.batches!=null,i=e.testFunction;let s=[];if(n.verbose>0)throw new ut("Verbose mode is not implemented yet.");z(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=yOe(t)?t:await t.iterator();let a=0,u=0;for(;!r||u<n.batches;){const l=await o.next();if(s=ue(()=>{if(l.value){const{xs:c,ys:f}=xre(e,l.value),h=c.concat(f),d=ue(()=>i(h));if(ct(h),u===0)for(let m=0;m<d.length;++m)s.push(et(0));const p=h[0].shape[0];for(let m=0;m<d.length;++m){const g=d[m],y=s[m];s[m]=ue(()=>be(s[m],Q(p,g))),u>0&&ct(y)}ct(d),a+=p,++u}return s}),l.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<s.length;++l){const c=s[l];s[l]=je(s[l],a),ct(c)}return Ri(s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ZO(e){z(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function Iy(e,t,n){return e==null?[null]:Array.isArray(e)?e.map(r=>qd(r,t,n-t)):qd(e,t,n-t)}function JM(e,t){return ue(()=>e==null?null:Array.isArray(e)?e.map(n=>JM(n,t)):Xne(e,t.dtype==="int32"?t:Ee(t,"int32")))}function JO(e,t){const n=[];let r=0,i=null;for(;r<e;)i=r+t,i>=e&&(i=e),n.push([r,i]),r=i;return n}function wre(e){const t=[];e instanceof Vt&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(r.rank===1)t.push(Dw(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Ko(e,t){if(e==null)return;const n=[];if(t instanceof Vt)n.push(t.id);else if(Array.isArray(t))t.forEach(i=>n.push(i.id));else if(t!=null)for(const i in t){const s=t[i];n.push(s.id)}const r=[];if(e instanceof Vt)n.indexOf(e.id)===-1&&r.push(e);else if(Array.isArray(e))e.forEach(i=>{n.indexOf(i.id)===-1&&r.push(i)});else if(e!=null)for(const i in e){const s=e[i];n.indexOf(s.id)===-1&&r.push(s)}r.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vOe(e){return e instanceof Vt}function QM(e){return Array.isArray(e)}function RV(e){return!vOe(e)&&!QM(e)}function PV(e,t,n,r=!0,i=""){if(t==null||t.length===0){if(e!=null){let o=!1;if(QM(e)&&e.length>0)o=!0;else if(RV(e)){for(const a in e)if(e.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new ee(`Error when checking model ${i} expected no data, but got ${e}`)}return[]}if(e==null)return t.map(o=>null);let s;if(RV(e)){e=e,s=[];for(const o of t){if(e[o]==null)throw new ee(`No data provided for "${o}". Need data for each key in: ${t}`);s.push(e[o])}}else if(QM(e)){if(e=e,e.length!==t.length)throw new ee(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(e=e,t.length>1)throw new ee(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=wre(s),n!=null)for(let o=0;o<t.length;++o){if(n[o]==null)continue;const a=s[o];if(a.shape.length!==n[o].length)throw new ee(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let u=0;u<n[o].length;++u){if(u===0&&!r)continue;const l=a.shape[u],c=n[o][u];if(c!=null&&c>=0&&l!==c)throw new ee(`${i} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function xOe(e,t,n){const r=pf(e.map(s=>s.shape[0]));r.sort();const i=pf(t.map(s=>s.shape[0]));if(i.sort(),r.length>1)throw new ee(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(i.length>1)throw new ee(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(r.length>0&&i.length>0&&!_t(r,i))throw new ee(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}function wOe(e,t,n){const r=[fD,hD,zv];for(let i=0;i<e.length;++i){const s=e[i],o=t[i],a=n[i];if(o!=null){if(o===zv&&s.shape[s.shape.length-1]===1)throw new ee(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const u=s.shape.slice(1),l=a.slice(1);for(let c=0;c<u.length;++c){const f=u[c],h=l[c];if(h!=null&&f!==h)throw new ee(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function LV(e,t,n,r=!0,i=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new ee(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new ee(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(n!=null)for(let o=0;o<t.length;++o){if(n[o]==null)continue;const a=s[o];if(a.shape.length!==n[o].length)throw new ee(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let u=0;u<n[o].length;++u){if(u===0&&!r)continue;const l=a.shape[u],c=n[o][u];if(c!=null&&c!==l)throw new ee(`Error when checking ${i}: expected ${t[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function COe(e,t){if(e==null||Array.isArray(e)&&e.length===0)return t.map(r=>[]);let n;if(typeof e=="string"||typeof e=="function")n=[e];else if(Array.isArray(e)||typeof e=="object")n=e;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(r=>n);{const r=[];for(const i of t){let s=n.hasOwnProperty(i)?n[i]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}const SOe="layers-model";class vm extends na{constructor(t){super(t),this.isTraining=!1}summary(t,n,r=console.log){if(!this.built)throw new ee("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");oOe(this,t,n,r)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=sOe(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof mc))throw new ee("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const o in t.loss)if(this.outputNames.indexOf(o)===-1)throw new ee(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)t.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(KO(t.loss[o]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new ee(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);n=t.loss.map(a=>KO(a))}else{const o=KO(t.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],u=this.outputNames[o];this.feedOutputNames.push(u),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Hd("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const i=COe(t.metrics,this.outputNames),s=(o,a,u)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([u,o])};Hd("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=i[o];(l=>{const c="";let f,h,d;for(const p of l){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[o];g[g.length-1]===1||this.lossFunctions[o]===hD?["accuracy","acc"].indexOf(p)!==-1?h=hre:["crossentropy","ce"].indexOf(p)!==-1&&(h=YFe):this.lossFunctions[o]===R$?["accuracy","acc"].indexOf(p)!==-1?h=KFe:["crossentropy","ce"].indexOf(p)!==-1&&(h=gre):["accuracy","acc"].indexOf(p)!==-1?h=dre:["crossentropy","ce"].indexOf(p)!==-1&&(h=pre);let y;["accuracy","acc"].indexOf(p)!==-1?y="acc":["crossentropy","ce"].indexOf(p)!==-1&&(y="ce"),d=h,f=c+y}else d=iOe(p),f=c+yS(p);let m;Hd(f,()=>{m=d}),s(o,f,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,n,r={}){const i=r.batchSize==null?32:r.batchSize;ZO(i);const s=!0,o=this.standardizeUserDataXY(t,n,s,i);try{const a=o[0].concat(o[1]);this.makeTestFunction();const u=this.testFunction,l=this.testLoop(u,a,i,r.verbose,r.steps);return Ri(l)}finally{Ko(o[0],t),Ko(o[1],n)}}async evaluateDataset(t,n){return this.makeTestFunction(),bOe(this,t,n)}checkNumSamples(t,n,r,i="steps"){let s;if(r!=null){if(s=null,n!=null)throw new ee(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(t!=null)Array.isArray(t)?s=t[0].shape[0]:s=t.shape[0];else throw new ee(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(t,n){if(Array.isArray(n)&&n.length===0)throw new ee("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(n),i=r?n:[n],s=this.retrieveSymbolicTensors(i),o=new Xc;if(t instanceof Vt&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new ee(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)o.add(this.inputs[u],t[u])}else for(const u of this.inputs){const l=t[u.name];if(l==null)throw new ee(`No value is provided for the model's input ${u.name}`);o.add(u,l)}const a=bb(s,o);return r?a:a[0]}retrieveSymbolicTensors(t){const n=pp(null,t.length);let r=t.length;for(const i of this.layers){const s=Array.isArray(i.output)?i.output:[i.output],o=s.map(a=>a.name);for(let a=0;a<t.length;++a){const u=o.indexOf(t[a]);if(u!==-1&&(n[a]=s[u],r--),r===0)break}if(r===0)break}if(r>0){const i=[];throw n.forEach((s,o)=>{s==null&&i.push(t[o])}),new ee(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return n}predictLoop(t,n=32,r=!1){return ue(()=>{const i=this.checkNumSamples(t);if(r)throw new ut("Verbose predictLoop() is not implemented yet.");const s=JO(i,n),o=this.outputs.map(a=>[]);for(let a=0;a<s.length;++a)ue(()=>{const l=s[a][0],c=s[a][1],f=Iy(t,l,c),h=[];if(Array.isArray(f))for(let p=0;p<f.length;++p)h.push({key:this.inputs[p],value:f[p]});else h.push({key:this.inputs[0],value:f});const d=new Xc(h);return bb(this.outputs,d)}).forEach((l,c)=>o[c].push(l));return Ri(o.map(a=>hr(a,0)))})}predict(t,n={}){const r=wre(t);LV(r,this.inputNames,this.feedInputShapes,!1);try{const i=n.batchSize==null?32:n.batchSize;return ZO(i),this.predictLoop(r,i)}finally{Ko(r,t)}}predictOnBatch(t){LV(t,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)}standardizeUserDataXY(t,n,r=!0,i){if(this.optimizer_==null)throw new xo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const s=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===R$?s.push(a.slice(0,a.length-1).concat([1])):s.push(a)}if(t=PV(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=PV(n,this.feedOutputNames,s,!1,"target"),xOe(t,n),wOe(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new ee(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${t[0].shape[0]} sample(s).`);return[t,n]}async standardizeUserData(t,n,r,i,s=!0,o){const[a,u]=this.standardizeUserDataXY(t,n,s,o);if(r!=null)throw new Error("sample weight is not supported yet.");let l=null;if(i!=null){const c=bre(i,this.outputNames);l=[];for(let f=0;f<c.length;++f)l.push(await vre(u[f],null,c[f]))}return[a,u,l]}testLoop(t,n,r,i=0,s){return ue(()=>{const o=this.checkNumSamples(n,r,s,"steps"),a=[];if(i>0)throw new ut("Verbose mode is not implemented yet.");if(s!=null)throw new ut("steps mode in testLoop() is not implemented yet");{const u=JO(o,r),l=Ui(Ea(0,o));for(let c=0;c<u.length;++c){const f=u[c][0],h=u[c][1],d=qd(l,f,h-f),p=JM(n,d),m=t(p);if(c===0)for(let g=0;g<m.length;++g)a.push(et(0));for(let g=0;g<m.length;++g){const y=m[g];a[g]=be(a[g],Q(h-f,y))}}for(let c=0;c<a.length;++c)a[c]=je(a[c],o)}return a})}getDedupedMetricsNames(){const t=this.metricsNames,n=[];for(let r=0;r<t.length;++r){const i=t[r];let s=i;if(CV(t,i)>1){const o=CV(t.slice(0,r),i);s+=`_${o}`}n.push(s)}return n}makeTrainFunction(){return t=>{const n=[],r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let m=0;m<this.inputs.length;++m)f.push({key:this.inputs[m],value:r[m]});const h=new Xc(f),d=bb(this.outputs,h,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let y=g(i[m],d[m]);s[m]!=null&&(y=hOe(y,s[m]));const b=In(y);n.push(b),m===0?p=y:p=be(p,y)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=n[m];else{const y=this.metricsTensors[m][0],b=this.metricsTensors[m][1];g=In(y(i[b],d[b]))}va(g),o.push(g)}return p=In(p),this.calculateLosses().forEach(m=>{p=be(p,m)}),p},u=this.collectedTrainableWeights.map(f=>f.read()),l=!0;return[this.optimizer_.minimize(a,l,u)].concat(o)}}makeTestFunction(){this.testFunction=t=>ue(()=>{const n=[];let r;const i=t.slice(0,this.inputs.length),s=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let l=0;l<this.inputs.length;++l)o.push({key:this.inputs[l],value:i[l]});const a=new Xc(o),u=bb(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const c=this.lossFunctions[l],f=In(c(s[l],u[l]));l===0?r=f:r=be(r,f),n.push(r)}for(let l=0;l<this.metricsTensors.length;++l){const c=this.metricsTensors[l][0],f=this.metricsTensors[l][1],h=In(c(s[f],u[f]));n.push(h)}return n})}async fit(t,n,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let i,s,o,a,u,l,c,f,h;try{const d=r.batchSize==null?32:r.batchSize;ZO(d);const p=!1,m=await this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,p,d);i=m[0],s=m[1],h=m[2];let g=!1,y;if(r.validationData!=null&&r.validationData.length>0){if(g=!0,r.validationData.length===2)u=r.validationData[0],l=r.validationData[1];else throw r.validationData.length===3?new ut("validationData including sample weights is not supported yet."):new ee(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const $=!0,k=await this.standardizeUserData(u,l,null,null,$,d);c=k[0],f=k[1],y=c.concat(f)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){g=!0;const $=Math.floor(i[0].shape[0]*(1-r.validationSplit)),k=i[0].shape[0];c=Iy(i,$,k),o=i,i=Iy(i,0,$),f=Iy(s,$,k),a=s,s=Iy(s,0,$),y=c.concat(f)}else r.validationSteps!=null&&(g=!0);const b=i.concat(s).concat(h);this.checkTrainableWeightsConsistency();const x=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let w,C;g?(this.makeTestFunction(),w=this.testFunction,C=v.slice().concat(v.map($=>"val_"+$))):(w=null,y=[],C=v.slice());const S=lre(r.callbacks,r.yieldEvery);return await this.fitLoop(x,b,v,d,r.epochs,r.verbose,S,w,y,r.shuffle,C,r.initialEpoch,null,null)}finally{this.isTraining=!1,Ko(i,t),Ko(s,n),Ko(o,t),Ko(a,n),Ko(c,u),Ko(f,l),h!=null&&ct(h)}}async fitLoop(t,n,r,i,s,o,a,u,l,c,f,h,d,p){i==null&&(i=32),s==null&&(s=1),c==null&&(c=!0),h==null&&(h=0);let m=!1;if(u!=null&&l!=null&&(m=!0),p!=null&&(m=!0,d==null))throw new ee("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(n,i,d,"steps_per_epoch");let y;g!=null&&(y=Ea(0,g)),o==null&&(o=1);const{callbackList:b,history:x}=cre(a,o,s,h,g,d,i,m,f);b.setModel(this),this.history=x,await b.onTrainBegin(),this.stopTraining_=!1;for(let v=h;v<s;++v){await b.onEpochBegin(v);const w={};if(d!=null)throw new ut("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new ut("batch shuffling is not implemneted yet");c&&P4(y);const C=Ui(y),S=JO(g,i);for(let _=0;_<S.length;++_){const $={};if(await b.onBatchBegin(_,$),ue(()=>{const k=S[_][0],E=S[_][1],F=qd(C,k,E-k);$.batch=_,$.size=E-k;const T=JM(n,F),I=t(T);for(let D=0;D<r.length;++D){const N=r[D],V=I[D];$[N]=V,va(V)}if(_===S.length-1&&m){const D=this.testLoop(u,l,i);for(let N=0;N<r.length;++N){const V=r[N],U=D[N];va(U),w["val_"+V]=U}}}),await b.onBatchEnd(_,$),ure($),this.stopTraining_)break}C.dispose()}if(await b.onEpochEnd(v,w),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,n){return gOe(this,t,n)}async trainOnBatch(t,n){const r=await this.standardizeUserData(t,n),i=r[0],s=r[1],a=this.makeTrainFunction()(i.concat(s)),u=[];for(const l of a){const c=await l.data();u.push(c[0])}return ct(a),Ko(r[0],t),Ko(r[1],n),Ri(u)}getNamedWeights(t){const n=[],r=t!=null&&t.trainableOnly,i=r?this.trainableWeights:this.weights,s=this.getWeights(r);for(let o=0;o<i.length;++o)r&&!i[o].trainable||n.push({name:i[o].originalName,tensor:s[o]});return n}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=A$().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-A$().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Sl(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(n=>Sl(n))}else{const n=Object.keys(this.loss);t={};const r=this.loss;for(const i of n)if(typeof r[i]=="string")t[i]=Sl(r[i]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Sl(yS(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Sl(yS(t)));{const t={};for(const n in this.metrics)t[n]=Sl(yS(this.metrics[n]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=z$(t.optimizer_config),r=xu(n);let i;if(typeof t.loss=="string")i=vd(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(o=>vd(o));else if(t.loss!=null){i={};for(const o in t.loss)i[o]=vd(t.loss[o])}let s;if(Array.isArray(t.metrics))s=t.metrics.map(o=>vd(o));else if(t.metrics!=null){s={};for(const o in t.metrics)s[o]=vd(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:r})}async save(t,n){if(typeof t=="string"){const l=Eee(t);if(l.length===0)throw new ee(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new ee(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new ee("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await NM(this.getNamedWeights(n)),i=!1,s=null,a={modelTopology:this.toJSON(s,i),format:SOe,generatedBy:`TensorFlow.js tfjs-layers v${yre}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:c,specs:f}=await NM(await this.optimizer.getWeights(),l);r.specs.push(...f),r.data=See([r.data,c])}return this.userDefinedMetadata!=null&&(OV(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,t.save(a)}setUserDefinedMetadata(t){OV(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}vm.className="Model";ve(vm);class Cre extends vm{}Cre.className="Functional";ve(Cre);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function _Oe(e,t){if(t==null&&(t={}),typeof e=="string"){const n=Aee(e,t);if(n.length===0)n.push(Zte(e,t));else if(n.length>1)throw new ee(`Found more than one (${n.length}) load handlers for URL '${e}'`);e=n[0]}return $Oe(e,void 0,t)}async function $Oe(e,t,n){if(n==null&&(n={}),e.load==null)throw new ee("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await e.load();let i=r.modelTopology;i.model_config!=null&&(i=i.model_config);const s=n.strict==null?!0:n.strict,o=r.weightData!=null&&r.weightSpecs!=null&&s,a=xu(z$(i),t,o),u=r.trainingConfig;if(u!=null&&a.loadTrainingConfig(u),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new ee("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:l,optimizerWeights:c}=kOe(r.weightData,r.weightSpecs);a.loadWeights(l,s),a.optimizer!=null&&c.length>0&&await a.optimizer.setWeights(c),ct(l),ct(c.map(f=>f.tensor))}return a}function kOe(e,t){const n=Y4(e,t),r={},i=[];return t.forEach(s=>{s.group==="optimizer"?i.push({name:s.name,tensor:n[s.name]}):r[s.name]=n[s.name]}),{modelWeights:r,optimizerWeights:i}}let Sre=class eR extends vm{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:uD("sequential_"),t.layers!=null)for(const n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new ee(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const n=t instanceof eR||t instanceof vm;let r;if(n){if(r=t,r.outputs.length!==1)throw new ee("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new ee("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new ee("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=kFe({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(t.inboundNodes.length!==1)throw new ee(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new ee("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=rre(this.outputs[0])}this.inboundNodes=[],new cD({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:pp(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=t.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(It(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new vm({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,r=console.log){this.built||this.build(),super.summary(t,n,r)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,r={}){if(!this.built)throw new xo("The model needs to be compiled before being used.");return this.model.evaluate(t,n,r)}async evaluateDataset(t,n){if(!this.built)throw new xo("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,r={}){if(!this.built)throw new xo("The model needs to be compiled before being used.");return this.model.fit(t,n,r)}async fitDataset(t,n){if(!this.built)throw new xo("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,r={},i=!1){let s,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new ee("Legacy serialization format not supported yet.");s=n}else z(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=n.layers,delete n.layers,o=n;const a=new t(o);if(!(a instanceof eR))throw new ut(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const u of s){const c=xu(u,void 0,i);i&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(t){if(this.model==null)throw new ee("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new ee("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const n of this.layers){const r={};r.className=n.getClassName(),r.config=n.getConfig(),t.push(r)}return{name:this.name,layers:t}}};Sre.className="Sequential";ve(Sre);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let es=class extends tg{getConfig(){return{}}};class _re extends es{apply(t,n=1){return hFe(t,n)}}_re.className="elu";ve(_re);class $re extends es{apply(t){return kB(t)}}$re.className="selu";ve($re);class kre extends es{apply(t){return qu(t)}}kre.className="relu";ve(kre);class Ere extends es{apply(t){return ue(()=>hp(6,qu(t)))}}Ere.className="relu6";ve(Ere);let Are=class extends es{apply(t){return t}};Are.className="linear";ve(Are);class Tre extends es{apply(t){return mu(t)}}Tre.className="sigmoid";ve(Tre);class Dre extends es{apply(t){return pFe(t)}}Dre.className="hardSigmoid";ve(Dre);class Ire extends es{apply(t){return I1(t)}}Ire.className="softplus";ve(Ire);class Fre extends es{apply(t){return dFe(t)}}Fre.className="softsign";ve(Fre);class Ore extends es{apply(t){return Rm(t)}}Ore.className="tanh";ve(Ore);let O5=class extends es{apply(t,n=-1){return VT(t,n)}};O5.className="softmax";ve(O5);class Nre extends es{apply(t,n=-1){return lB(t,n)}}Nre.className="logSoftmax";ve(Nre);class Mre extends es{apply(t,n=1){return ue(()=>Q(mu(Q(t,n)),t))}}Mre.className="swish";ve(Mre);class Rre extends es{apply(t){return ue(()=>Q(t,Rm(I1(t))))}}Rre.className="mish";ve(Rre);function Ff(e){return e.getClassName()}function QO(e,t={}){return Tw(e,Us.getMap().classNameMap,t,"activation")}function Of(e){if(e==null){const t={};return t.className="linear",t.config={},QO(t)}if(typeof e=="string"){const t={};return t.className=e,t.config={},QO(t)}else return e instanceof es?e:QO(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EOe(e){if(e!=null&&typeof e!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}class Pre extends tg{}class Lre extends Pre{constructor(t){super(),EOe(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return ue(()=>{let n=Kn([1]);return this.hasL1&&(n=be(n,Oe(Q(this.l1,Yn(t))))),this.hasL2&&(n=be(n,Oe(Q(this.l2,Iw(t))))),ne(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,n){return new t({l1:n.l1,l2:n.l2})}}Lre.className="L1L2";ve(Lre);const BV={l1l2:"L1L2"};function Qt(e){return v5(e)}function zV(e,t={}){return Tw(e,Us.getMap().classNameMap,t,"regularizer")}function xn(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in BV?BV[e]:e,config:{}};return zV(n)}else return e instanceof Pre?e:zV(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Bre extends gt{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,n){t=Je(t);let r=qu(t);return this.maxValue!=null&&(r=Ss(r,0,this.maxValue)),r}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},n=super.getConfig();return Object.assign(t,n),t}}Bre.className="ReLU";ve(Bre);class zre extends gt{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const r=Je(t);return OT(r,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}zre.className="LeakyReLU";ve(zre);class jre extends gt{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=vn(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=xn(t.alphaRegularizer),this.alphaConstraint=er(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new ee(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=It(t);const n=t.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)n[i-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let i=1;i<t.length;++i)r[i]=t[i];this.inputSpec=[new Jn({ndim:t.length,axes:r})],this.built=!0}call(t,n){return t=Je(t),zT(t,this.alpha.read())}getConfig(){const t={alphaInitializer:kn(this.alphaInitializer),alphaRegularizer:Qt(this.alphaRegularizer),alphaConstraint:Qn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(t,n),t}}jre.className="PReLU";ve(jre);let Ure=class extends gt{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new ut(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const r=Je(t);return Cw(r)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}};Ure.className="ELU";ve(Ure);class Wre extends gt{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,n){const r=Je(t);return Q(r,Ee(Rs(r,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},n=super.getConfig();return Object.assign(t,n),t}}Wre.className="ThresholdedReLU";ve(Wre);class Vre extends gt{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new O5().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,n){const r=Je(t);return this.softmax(r,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}Vre.className="Softmax";ve(Vre);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xm(e,t,n){if(typeof e=="number")return pp(e,t);if(e.length!==t)throw new ee(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){const i=e[r];if(!uFe(i))throw new ee(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${i}`)}return e}function xa(e,t,n,r,i=1){if(e==null)return e;const s=t+(t-1)*(i-1);let o;return n==="same"?o=e:o=e-s+1,Math.floor((o+r-1)/r)}function nu(e,t,n,r){if(e==null)return null;if(r==="valid")e=e*t+If([n-t,0]);else if(r==="same")e=e*t;else throw new ee(`Unsupport padding mode: ${r}.`);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function N5(e,t){return ue(()=>(jn(t),t==="channelsFirst"?Ct(e,[0,2,3,1]):e))}function Gre(e,t){return ue(()=>(jn(t),t==="channelsFirst"?Ct(e,[0,2,3,4,1]):e))}function AOe(e,t,n,r=1,i="valid",s,o=1){return ue(()=>{if(s==null&&(s=Aa()),jn(s),e.shape.length!==3)throw new ee(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(t.shape.length!==3)throw new ee(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new ee(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(s==="channelsFirst"&&(e=Ct(e,[0,2,1])),i==="causal")throw new ut("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=nB(e,t,r,i==="same"?"same":"valid","NWC",o);return n!=null&&(a=Na(a,n)),a})}function jV(e,t,n,r=[1,1],i="valid",s,o,a=null){return ue(()=>{if(s==null&&(s=Aa()),jn(s),e.rank!==3&&e.rank!==4)throw new ee(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(t.rank!==3&&t.rank!==4)throw new ee(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let u=N5(e,s);if(i==="causal")throw new ut("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=zte({x:u,filter:t,strides:r,pad:i==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),s==="channelsFirst"&&(u=Ct(u,[0,3,1,2])),u})}function TOe(e,t,n,r=[1,1,1],i="valid",s,o){return ue(()=>{if(s==null&&(s=Aa()),jn(s),e.rank!==4&&e.rank!==5)throw new ee(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(t.rank!==4&&t.rank!==5)throw new ee(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let a=Gre(e,s);if(i==="causal")throw new ut("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=nte(a,t,r,i==="same"?"same":"valid","NDHWC",o),n!=null&&(a=Na(a,n)),s==="channelsFirst"&&(a=Ct(a,[0,4,1,2,3])),a})}class dD extends gt{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",dD.verifyArgs(n),this.rank=t,lr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new ut(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=xm(n.kernelSize,t,"kernelSize"),this.strides=xm(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,so(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,jn(this.dataFormat),this.activation=Of(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=vn(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=er(n.biasConstraint),this.biasRegularizer=xn(n.biasRegularizer),this.activityRegularizer=xn(n.activityRegularizer),this.dilationRate=xm(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ee(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ee(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ee(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(tu("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!x5(t.kernelSize,"number",1,3))throw new ee(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ff(this.activation),useBias:this.useBias,biasInitializer:kn(this.biasInitializer),biasRegularizer:Qt(this.biasRegularizer),activityRegularizer:Qt(this.activityRegularizer),biasConstraint:Qn(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}class N1 extends dD{constructor(t,n){super(t,n),this.kernel=null,N1.verifyArgs(n),this.filters=n.filters,lr(this.filters,"filters"),this.kernelInitializer=vn(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=er(n.kernelConstraint),this.kernelRegularizer=xn(n.kernelRegularizer)}build(t){t=It(t);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new ee(`The channel dimension of the input should be defined. Found ${t[n]}`);const r=t[n],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:r}}],this.built=!0}call(t,n){return ue(()=>{t=Je(t);let r;const i=this.bias==null?null:this.bias.read(),s=Une(this.activation.getClassName());if(s!=null&&this.rank===2)r=jV(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=AOe(t,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=jV(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=TOe(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new ut("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=It(t);const n=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let s=0;s<r.length;++s){const o=xa(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);n.push(o)}let i=[t[0]];return this.dataFormat==="channelsLast"?(i=i.concat(n),i.push(this.filters)):(i.push(this.filters),i=i.concat(n)),i}getConfig(){const t={filters:this.filters,kernelInitializer:kn(this.kernelInitializer),kernelRegularizer:Qt(this.kernelRegularizer),kernelConstraint:Qn(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new ee(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class Mw extends N1{constructor(t){super(2,t),Mw.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!x5(t.kernelSize,"number",1,2))throw new ee(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}Mw.className="Conv2D";ve(Mw);class Rw extends N1{constructor(t){super(3,t),Rw.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new ee(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Rw.className="Conv3D";ve(Rw);class Hre extends Mw{constructor(t){if(super(t),this.inputSpec=[new Jn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ee(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=It(t),t.length!==4)throw new ee("Input should have rank 4; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new ee("The channel dimension of the inputs should be defined. Found `None`.");const r=t[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Jn({ndim:4,axes:{[n]:r}})],this.built=!0}call(t,n){return ue(()=>{let r=Je(t);if(r.shape.length!==4)throw new ee(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const i=r.shape,s=i[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const u=i[o],l=i[a],c=this.kernelSize[0],f=this.kernelSize[1],h=this.strides[0],d=this.strides[1],p=nu(u,h,c,this.padding),m=nu(l,d,f,this.padding),g=[s,p,m,this.filters];this.dataFormat!=="channelsLast"&&(r=Ct(r,[0,2,3,1]));let y=iB(r,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=Ct(y,[0,3,1,2])),this.bias!=null&&(y=Na(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(t){t=It(t);const n=t.slice();let r,i,s;this.dataFormat==="channelsFirst"?(r=1,i=2,s=3):(r=3,i=1,s=2);const o=this.kernelSize[0],a=this.kernelSize[1],u=this.strides[0],l=this.strides[1];return n[r]=this.filters,n[i]=nu(n[i],u,o,this.padding),n[s]=nu(n[s],l,a,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}Hre.className="Conv2DTranspose";ve(Hre);class qre extends Rw{constructor(t){if(super(t),this.inputSpec=[new Jn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ee(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=It(t),t.length!==5)throw new ee("Input should have rank 5; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new ee("The channel dimension of the inputs should be defined. Found `None`.");const r=t[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Jn({ndim:5,axes:{[n]:r}})],this.built=!0}call(t,n){return ue(()=>{let r=Je(t);if(r.shape.length!==5)throw new ee(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const i=r.shape,s=i[0];let o,a,u;this.dataFormat==="channelsFirst"?(u=2,o=3,a=4):(u=1,o=2,a=3);const l=i[u],c=i[o],f=i[a],h=this.kernelSize[0],d=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],y=this.strides[2],b=nu(l,m,h,this.padding),x=nu(c,g,d,this.padding),v=nu(f,y,p,this.padding),w=[s,b,x,v,this.filters];this.dataFormat!=="channelsLast"&&(r=Ct(r,[0,2,3,4,1]));let C=ite(r,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=Ct(C,[0,4,1,2,3])),this.bias!==null&&(C=Na(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(t){t=It(t);const n=t.slice();let r,i,s,o;this.dataFormat==="channelsFirst"?(r=1,i=2,s=3,o=4):(r=4,i=1,s=2,o=3);const a=this.kernelSize[0],u=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],f=this.strides[1],h=this.strides[2];return n[r]=this.filters,n[i]=nu(n[i],c,a,this.padding),n[s]=nu(n[s],f,u,this.padding),n[o]=nu(n[o],h,l,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}qre.className="Conv3DTranspose";ve(qre);class Xre extends N1{constructor(t,n){if(super(t,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new ee("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new ee("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new ee(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=vn(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=xn(n.depthwiseRegularizer),this.depthwiseConstraint=er(n.depthwiseConstraint),this.pointwiseInitializer=vn(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=xn(n.pointwiseRegularizer),this.pointwiseConstraint=er(n.pointwiseConstraint)}build(t){if(t=It(t),t.length<this.rank+2)throw new ee(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null||t[n]<0)throw new ee(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[n])}`);const r=t[n],i=this.kernelSize.concat([r,this.depthMultiplier]),s=[];for(let a=0;a<this.rank;++a)s.push(1);s.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Jn({ndim:this.rank+2,axes:{[n]:r}})],this.built=!0}call(t,n){return ue(()=>{t=Je(t);let r;if(this.rank===1)throw new ut("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=Ct(t,[0,2,3,1])),r=EB(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=Na(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=Ct(r,[0,3,1,2])),r})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=kn(this.depthwiseInitializer),t.pointwiseInitializer=kn(this.pointwiseInitializer),t.depthwiseRegularizer=Qt(this.depthwiseRegularizer),t.pointwiseRegularizer=Qt(this.pointwiseRegularizer),t.depthwiseConstraint=Qn(this.depthwiseConstraint),t.pointwiseConstraint=Qn(this.pointwiseConstraint),t}}Xre.className="SeparableConv";class Yre extends Xre{constructor(t){super(2,t)}}Yre.className="SeparableConv2D";ve(Yre);class pD extends N1{constructor(t){super(1,t),pD.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!x5(t.kernelSize,"number",1,1))throw new ee(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}pD.className="Conv1D";ve(pD);class Kre extends gt{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,n){return ue(()=>{if(t=Je(t),this.dataFormat==="channelsLast"){const r=mS(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return mS(r,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=mS(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return mS(r,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}Kre.className="Cropping2D";ve(Kre);class Zre extends gt{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,jn(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,sFe(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const n=t[2]==null?null:this.size[0]*t[2],r=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,r]}else{const n=t[1]==null?null:this.size[0]*t[1],r=t[2]==null?null:this.size[1]*t[2];return[t[0],n,r,t[3]]}}call(t,n){return ue(()=>{let r=Je(t);const i=r.shape;if(this.dataFormat==="channelsFirst"){r=Ct(r,[0,2,3,1]);const s=this.size[0]*i[2],o=this.size[1]*i[3],a=this.interpolation==="nearest"?fu.resizeNearestNeighbor(r,[s,o]):fu.resizeBilinear(r,[s,o]);return Ct(a,[0,3,1,2])}else{const s=this.size[0]*i[1],o=this.size[1]*i[2];return this.interpolation==="nearest"?fu.resizeNearestNeighbor(r,[s,o]):fu.resizeBilinear(r,[s,o])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}}Zre.className="UpSampling2D";ve(Zre);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DOe(e,t,n=[1,1],r="valid",i,s){return ue(()=>{i==null&&(i=Aa()),jn(i);let o=N5(e,i);if(e.rank!==4)throw new ee(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(t.rank!==4)throw new ee(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return o=ww(o,t,n,r==="same"?"same":"valid","NHWC",s),i==="channelsFirst"&&(o=Ct(o,[0,3,1,2])),o})}class Jre extends dD{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=vn(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=er(t.depthwiseConstraint),this.depthwiseRegularizer=xn(t.depthwiseRegularizer)}build(t){if(t=It(t),t.length<4)throw new ee(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new ee(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[n]}).`);const r=t[n],i=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return ue(()=>{t=Je(t);let r=DOe(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=Na(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(t){t=It(t);const n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,s=xa(n,this.kernelSize[0],this.padding,this.strides[0]),o=xa(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,s,o]:[t[0],s,o,i]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=kn(this.depthwiseInitializer),t.depthwiseRegularizer=Qt(this.depthwiseRegularizer),t.depthwiseConstraint=Qn(this.depthwiseRegularizer),t}}Jre.className="DepthwiseConv2D";ve(Jre);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qre(e,t,n,r){if(Array.isArray(e)){if(t!=null||n!=null)throw new ee("When inputs is an array, neither initialState or constants should be provided");r!=null&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(s){return s==null||Array.isArray(s)?s:[s]}return t=i(t),n=i(n),{inputs:e,initialState:t,constants:n}}function eie(e,t,n,r=!1,i,s,o=!1,a=!1){return ue(()=>{const u=t.shape.length;if(u<3)throw new ee(`Input should be at least 3D, but is ${u}D.`);const l=[1,0].concat(Ea(2,u));if(t=Ct(t,l),s!=null)throw new ut("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=Ee(Ee(i,"bool"),"float32"),i.rank===u-1&&(i=Mi(i,-1)),i=Ct(i,l)),r&&(t=Fo(t,0),i!=null&&(i=Fo(i,0)));const c=[];let f,h=n;const d=t.shape[0],p=Df(t);let m;i!=null&&(m=Df(i));for(let y=0;y<d;++y){const b=p[y],x=ue(()=>e(b,h));if(i==null)f=x[0],h=x[1];else{const v=ue(()=>{const w=m[y],C=Ie(Qs(w),w),S=be(Q(x[0],w),Q(h[0],C)),_=h.map(($,k)=>be(Q(x[1][k],w),Q($,C)));return{output:S,newStates:_}});f=v.output,h=v.newStates}a&&c.push(f)}let g;return a&&(g=Ql(c,1)),[f,g,h]})}class Ch extends gt{constructor(t){super(t);let n;if(t.cell==null)throw new ee("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new P5({cells:t.cell}):n=t.cell,n.stateSize==null)throw new ee("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new Jn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ea(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){XM(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const r=n[0];let i;if(this.returnSequences?i=[t[0],t[1],r]:i=[t[0],r],this.returnState){const s=[];for(const o of n)s.push([t[0],o]);return[i].concat(s)}else return i}computeMask(t,n){return ue(()=>{Array.isArray(n)&&(n=n[0]);const r=this.returnSequences?n:null;if(this.returnState){const i=this.states.map(s=>null);return[r].concat(i)}else return r})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let r=0;r<t;++r)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new ut("Constants support is not implemented in RNN yet.");XM(t)&&(t=t[0]),t=t;const n=this.stateful?t[0]:null,r=t.slice(2);this.inputSpec[0]=new Jn({shape:[n,null,...r]});const i=[t[0]].concat(t.slice(2));this.cell.build(i);let s;if(Array.isArray(this.cell.stateSize)?s=this.cell.stateSize:s=[this.cell.stateSize],this.stateSpec!=null){if(!_t(this.stateSpec.map(o=>o.shape[o.shape.length-1]),s))throw new ee(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map(o=>new Jn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){ue(()=>{if(!this.stateful)throw new eu("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new ee("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Kn([r,i])):this.states_=[Kn([r,this.cell.stateSize])];else if(t==null)ct(this.states_),this.keptStates!=null&&(ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Kn([r,i])):this.states_[0]=Kn([r,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new ee(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):ct(this.states_);for(let i=0;i<this.states_.length;++i){const s=t[i],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,a=[r,o];if(!_t(s.shape,a))throw new ee(`State ${i} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>va(i.clone()))})}apply(t,n){let r=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const s=Qre(t,r,i,this.numConstants);t=s.inputs,r=s.initialState,i=s.constants;let o=[],a=[];if(r!=null){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(const l of r)this.stateSpec.push(new Jn({shape:l.shape}));a=a.concat(this.stateSpec)}if(i!=null&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof hu){const l=[t].concat(o),c=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=c;const h=super.apply(l,n);return this.inputSpec=f,h}else return super.apply(t,n)}call(t,n){return ue(()=>{const r=n==null?null:n.mask,i=n==null?null:n.training;let s=n==null?null:n.initialState;t=Je(t),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(t));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==o)throw new ee(`RNN Layer has ${o} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},l=eie((p,m)=>{const g=this.cell.call([p].concat(m),a);return[g[0],g.slice(1)]},t,s,this.goBackwards,r,null,this.unroll,this.returnSequences),c=l[0],f=l[1],h=l[2];this.stateful&&this.resetStates(h,i);const d=this.returnSequences?f:c;return this.returnState?[d].concat(h):d})}getInitialState(t){return ue(()=>{let n=Kn(t.shape);return n=Oe(n,[1,2]),n=Dw(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?HM(n,[1,r]):n):this.cell.stateSize>1?[HM(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Ch.className&&(n.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),t),n)}static fromConfig(t,n,r={}){const i=n.cell,s=xu(i,r);return new t(Object.assign(n,{cell:s}))}}Ch.className="RNN";ve(Ch);class gD extends gt{}class M5 extends gD{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,lr(this.units,"units"),this.activation=Of(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=xn(t.kernelRegularizer),this.recurrentRegularizer=xn(t.recurrentRegularizer),this.biasRegularizer=xn(t.biasRegularizer),this.kernelConstraint=er(t.kernelConstraint),this.recurrentConstraint=er(t.recurrentConstraint),this.biasConstraint=er(t.biasConstraint),this.dropout=Bm([1,If([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Bm([1,If([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=It(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return ue(()=>{if(t=t,t.length!==2)throw new ee(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let r=t[1];t=t[0];const i=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Nf({ones:()=>Qs(t),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Nf({ones:()=>Qs(r),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let s;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?s=vu(Q(t,o),this.kernel.read()):s=vu(t,this.kernel.read()),this.bias!=null&&(s=Na(s,this.bias.read())),a!=null&&(r=Q(r,a));let u=be(s,vu(r,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Ff(this.activation),useBias:this.useBias,kernelInitializer:kn(this.kernelInitializer),recurrentInitializer:kn(this.recurrentInitializer),biasInitializer:kn(this.biasInitializer),kernelRegularizer:Qt(this.kernelRegularizer),recurrentRegularizer:Qt(this.recurrentRegularizer),biasRegularizer:Qt(this.biasRegularizer),activityRegularizer:Qt(this.activityRegularizer),kernelConstraint:Qn(this.kernelConstraint),recurrentConstraint:Qn(this.recurrentConstraint),biasConstraint:Qn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)}}M5.className="SimpleRNNCell";ve(M5);class tie extends Ch{constructor(t){t.cell=new M5(t),super(t)}call(t,n){return ue(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return new t(n)}}tie.className="SimpleRNN";ve(tie);class R5 extends gD{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new ee("GRUCell does not support reset_after parameter set to true.");this.units=t.units,lr(this.units,"units"),this.activation=Of(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Of(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=xn(t.kernelRegularizer),this.recurrentRegularizer=xn(t.recurrentRegularizer),this.biasRegularizer=xn(t.biasRegularizer),this.kernelConstraint=er(t.kernelConstraint),this.recurrentConstraint=er(t.recurrentConstraint),this.biasConstraint=er(t.biasConstraint),this.dropout=Bm([1,If([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Bm([1,If([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=It(t);const n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return ue(()=>{if(t=t,t.length!==2)throw new ee(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const r=n.training==null?!1:n.training;let i=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Nf({ones:()=>Qs(t),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Nf({ones:()=>Qs(i),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;let a,u,l;0<this.dropout&&this.dropout<1&&(t=Q(t,s[0]));let c=vu(t,this.kernel.read());this.useBias&&(c=Na(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=Q(i,o[0]));const f=this.recurrentKernel.read(),[h,d]=ws(f,[2*this.units,this.units],f.rank-1),p=vu(i,h),[m,g,y]=ws(c,3,c.rank-1),[b,x]=ws(p,2,p.rank-1);a=this.recurrentActivation.apply(be(m,b)),u=this.recurrentActivation.apply(be(g,x));const v=vu(Q(u,i),d);l=this.activation.apply(be(y,v));const w=be(Q(a,i),Q(be(1,dn(a)),l));return[w,w]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Ff(this.activation),recurrentActivation:Ff(this.recurrentActivation),useBias:this.useBias,kernelInitializer:kn(this.kernelInitializer),recurrentInitializer:kn(this.recurrentInitializer),biasInitializer:kn(this.biasInitializer),kernelRegularizer:Qt(this.kernelRegularizer),recurrentRegularizer:Qt(this.recurrentRegularizer),biasRegularizer:Qt(this.biasRegularizer),activityRegularizer:Qt(this.activityRegularizer),kernelConstraint:Qn(this.kernelConstraint),recurrentConstraint:Qn(this.recurrentConstraint),biasConstraint:Qn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)}}R5.className="GRUCell";ve(R5);class nie extends Ch{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new R5(t),super(t)}call(t,n){return ue(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}nie.className="GRU";ve(nie);class mD extends gD{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,lr(this.units,"units"),this.activation=Of(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Of(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=vn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=vn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=vn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=xn(t.kernelRegularizer),this.recurrentRegularizer=xn(t.recurrentRegularizer),this.biasRegularizer=xn(t.biasRegularizer),this.kernelConstraint=er(t.kernelConstraint),this.recurrentConstraint=er(t.recurrentConstraint),this.biasConstraint=er(t.biasConstraint),this.dropout=Bm([1,If([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Bm([1,If([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var n;t=It(t);const r=t[t.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const s=this.biasInitializer,o=this.units;i=new(n=class extends Uo{apply(u,l){const c=s.apply([o]),f=new C5().apply([o]),h=s.apply([o*2]);return _V(_V(c,f),h)}},n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,n){return ue(()=>{const r=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new ee(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let i=t[1];const s=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Nf({ones:()=>Qs(t),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Nf({ones:()=>Qs(i),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let u,l,c,f;0<this.dropout&&this.dropout<1&&(t=Q(t,o[0]));let h=vu(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=Q(i,a[0])),h=be(h,vu(i,this.recurrentKernel.read())),this.useBias&&(h=Na(h,this.bias.read()));const[d,p,m,g]=ws(h,4,h.rank-1);u=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),c=be(Q(l,s),Q(u,this.activation.apply(m))),f=this.recurrentActivation.apply(g);const y=Q(f,this.activation.apply(c));return[y,y,c]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Ff(this.activation),recurrentActivation:Ff(this.recurrentActivation),useBias:this.useBias,kernelInitializer:kn(this.kernelInitializer),recurrentInitializer:kn(this.recurrentInitializer),biasInitializer:kn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Qt(this.kernelRegularizer),recurrentRegularizer:Qt(this.recurrentRegularizer),biasRegularizer:Qt(this.biasRegularizer),activityRegularizer:Qt(this.activityRegularizer),kernelConstraint:Qn(this.kernelConstraint),recurrentConstraint:Qn(this.recurrentConstraint),biasConstraint:Qn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)}}mD.className="LSTMCell";ve(mD);class rie extends Ch{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new mD(t),super(t)}call(t,n){return ue(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}rie.className="LSTM";ve(rie);class P5 extends gD{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?t.push(...n.stateSize):t.push(n.stateSize);return t}call(t,n){return ue(()=>{t=t;let r=t.slice(1);const i=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?i.push(r.splice(0,a.stateSize.length)):i.push(r.splice(0,1));i.reverse();const s=[];let o;for(let a=0;a<this.cells.length;++a){const u=this.cells[a];r=i[a],a===0?o=[t[0]].concat(r):o=[o[0]].concat(r),o=u.call(o,n),s.push(o.slice(1))}r=[];for(const a of s.slice().reverse())r.push(...a);return[o[0]].concat(r)})}build(t){XM(t)&&(t=t[0]),t=t;let n;this.cells.forEach((r,i)=>{Hd(`RNNCell_${i}`,()=>{r.build(t),Array.isArray(r.stateSize)?n=r.stateSize[0]:n=r.stateSize,t=[t[0],n]})}),this.built=!0}getConfig(){const t=super.getConfig(),n=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(n)};return Object.assign(Object.assign({},t),i)}static fromConfig(t,n,r={}){const i=[];for(const s of n.cells)i.push(xu(s,r));return new t({cells:i})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const n of this.cells)t.push(...n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.cells)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.cells)n.push(...r.trainableWeights);return n.concat(t)}return t}getWeights(){const t=[];for(const n of this.cells)t.push(...n.weights);return YM(t)}setWeights(t){const n=[];for(const r of this.cells){const i=r.weights.length,s=t.splice(i);for(let o=0;o<r.weights.length;++o)n.push([r.weights[o],s[o]])}T5(n)}}P5.className="StackedRNNCells";ve(P5);function Nf(e){const{ones:t,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=e,o=()=>s!=null?s(t(),n):Yne(t(),n),a=()=>Fw(o,t,r);return!i||i<=1?va(a().clone()):Array(i).fill(void 0).map(a).map(l=>va(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var IOe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};class iie extends Ch{constructor(t){if(t.unroll)throw new ut("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new ut("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new Jn({ndim:5})]}call(t,n){return ue(()=>{if(this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new ee("ConvRNN2D cell does not support constants");const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}computeOutputShape(t){let n=this.computeSingleOutputShape(t);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([t[0],...n.slice(-3)])]),n}getInitialState(t){return ue(()=>{const{stateSize:n}=this.cell,r=t.shape,i=this.computeSingleOutputShape(r),s=[i[0],...i.slice(2)],o=Kn(s);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(t,n=!1){ue(()=>{if(!this.stateful)throw new eu("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,i=this.computeSingleOutputShape(r),s=[i[0],...i.slice(2)];if(r[0]==null)throw new ee("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Kn(s)):this.states_=[Kn(s)];else if(t==null)ct(this.states_),this.keptStates!=null&&(ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Kn(s)):this.states_[0]=Kn(s);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new ee(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n?this.keptStates.push(this.states_.slice()):ct(this.states_);for(let a=0;a<this.states_.length;++a){const u=t[a],l=s;if(!_t(u.shape,l))throw new ee(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${u.shape}`);this.states_[a]=u}}this.states_=this.states_.map(a=>va(a.clone()))})}computeSingleOutputShape(t){const{dataFormat:n,filters:r,kernelSize:i,padding:s,strides:o,dilationRate:a}=this.cell,u=n==="channelsFirst",l=t[u?3:2],c=t[u?4:3],f=xa(l,i[0],s,o[0],a[0]),h=xa(c,i[1],s,o[1],a[1]);return[...t.slice(0,2),...u?[r,f,h]:[f,h,r]]}}iie.className="ConvRNN2D";class L5 extends mD{constructor(t){const{filters:n,kernelSize:r,strides:i,padding:s,dataFormat:o,dilationRate:a}=t;super(Object.assign(Object.assign({},t),{units:n})),this.filters=n,lr(this.filters,"filters"),this.kernelSize=xm(r,2,"kernelSize"),this.kernelSize.forEach(u=>lr(u,"kernelSize")),this.strides=xm(i||1,2,"strides"),this.strides.forEach(u=>lr(u,"strides")),this.padding=s||"valid",so(this.padding),this.dataFormat=o||"channelsLast",jn(this.dataFormat),this.dilationRate=xm(a||1,2,"dilationRate"),this.dilationRate.forEach(u=>lr(u,"dilationRate"))}build(t){var n;t=It(t);const r=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[r]==null)throw new ee(`The channel dimension of the input should be defined. Found ${t[r]}`);const i=t[r],s=4,o=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const l=this.biasInitializer,c=this.filters;u=new(n=class extends Uo{apply(h,d){const p=l.apply([c]),m=Vs([c]),g=l.apply([c*2]);return w5([p,m,g])}},n.className="CustomInit",n)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,n){return ue(()=>{if(t.length!==3)throw new ee(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const r=n.training||!1,i=t[0],s=t[1],o=t[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Nf({ones:()=>Qs(i),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,l=(M,P,j)=>!P||!P[j]?M:Q(P[j],M);let c=l(i,u,0),f=l(i,u,1),h=l(i,u,2),d=l(i,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Nf({ones:()=>Qs(s),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=l(s,p,0),g=l(s,p,1),y=l(s,p,2),b=l(s,p,3);const x=3,[v,w,C,S]=ws(this.kernel.read(),a,x),[_,$,k,E]=this.useBias?ws(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,v,_,this.padding),f=this.inputConv(f,w,$,this.padding),h=this.inputConv(h,C,k,this.padding),d=this.inputConv(d,S,E,this.padding);const[F,T,I,D]=ws(this.recurrentKernel.read(),a,x);m=this.recurrentConv(m,F),g=this.recurrentConv(g,T),y=this.recurrentConv(y,I),b=this.recurrentConv(b,D);const N=this.recurrentActivation.apply(be(c,m)),V=this.recurrentActivation.apply(be(f,g)),U=be(Q(V,o),Q(N,this.activation.apply(be(h,y)))),A=Q(this.recurrentActivation.apply(be(d,b)),this.activation.apply(U));return[A,A,U]})}getConfig(){const t=super.getConfig(),n=IOe(t,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(t,n,r,i){const s=Af(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?Na(s,r,this.dataFormat):s}recurrentConv(t,n){return Af(t,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}L5.className="ConvLSTM2DCell";ve(L5);class sie extends iie{constructor(t){const n=new L5(t);super(Object.assign(Object.assign({},t),{cell:n}))}static fromConfig(t,n){return new t(n)}}sie.className="ConvLSTM2D";ve(sie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class B5 extends gt{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const n=t.shape,r=[];for(let i=0;i<this.noiseShape.length;++i)r.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return r}call(t,n){return ue(()=>{this.invokeCallHook(t,n);const r=Je(t);if(0<this.rate&&this.rate<1){const i=n.training==null?!1:n.training,s=this.getNoiseShape(r);return Fw(()=>Yne(r,this.rate,s,this.seed),()=>r,i)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(t,n),t}dispose(){return super.dispose()}}B5.className="Dropout";ve(B5);class oie extends B5{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const n=t.shape;return[n[0],1,n[2]]}}oie.className="SpatialDropout1D";ve(oie);class aie extends gt{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let n=null;t.batchSize!=null&&(n=t.batchSize),this.batchInputShape=[n,t.inputDim]}this.units=t.units,lr(this.units,"units"),this.activation=Of(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=vn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=vn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=er(t.kernelConstraint),this.biasConstraint=er(t.biasConstraint),this.kernelRegularizer=xn(t.kernelRegularizer),this.biasRegularizer=xn(t.biasRegularizer),this.activityRegularizer=xn(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=It(t);const n=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(t){t=It(t);const n=t.slice();return n[n.length-1]=this.units,n}call(t,n){return ue(()=>{this.invokeCallHook(t,n);const r=Je(t),i=Une(this.activation.getClassName());let s;return i!=null?s=vu(r,this.kernel.read(),i,this.bias?this.bias.read():null):(s=vu(r,this.kernel.read()),this.bias!=null&&(s=Na(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){const t={units:this.units,activation:Ff(this.activation),useBias:this.useBias,kernelInitializer:kn(this.kernelInitializer),biasInitializer:kn(this.biasInitializer),kernelRegularizer:Qt(this.kernelRegularizer),biasRegularizer:Qt(this.biasRegularizer),activityRegularizer:Qt(this.activityRegularizer),kernelConstraint:Qn(this.kernelConstraint),biasConstraint:Qn(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}aie.className="Dense";ve(aie);let uie=class extends gt{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=It(t);for(const n of t.slice(1))if(n==null)throw new ee(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],gf(t,1)]}call(t,n){return ue(()=>{this.invokeCallHook(t,n);let r=Je(t);if(this.dataFormat==="channelsFirst"&&r.rank>1){const i=[0];for(let s=2;s<r.rank;++s)i.push(s);i.push(1),r=Ct(r,i)}return fFe(r)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(t,n),t}};uie.className="Flatten";ve(uie);class lie extends gt{constructor(t){super(t),this.supportsMasking=!0,this.activation=Of(t.activation)}call(t,n){return ue(()=>{this.invokeCallHook(t,n);const r=Je(t);return this.activation.apply(r)})}getConfig(){const t={activation:Ff(this.activation)},n=super.getConfig();return Object.assign(t,n),t}}lie.className="Activation";ve(lie);class cie extends gt{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,n){return ue(()=>(t=Je(t),lFe(t,this.n)))}getConfig(){const t={n:this.n},n=super.getConfig();return Object.assign(t,n),t}}cie.className="RepeatVector";ve(cie);class fie extends gt{constructor(t){super(t),this.targetShape=t.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,n){const r="Total size of new array must be unchanged.",i=n.slice();let s=1,o=null;for(let u=0;u<i.length;++u){const l=i[u];if(this.isUnknown(l))if(o===null)o=u;else throw new ee("Can only specifiy one unknown dimension.");else s*=l}const a=gf(t);if(o!==null){if(s===0||a%s!==0)throw new ee(r);i[o]=a/s}else if(a!==s)throw new ee(r);return i}computeOutputShape(t){let n=!1;for(let r=0;r<t.length;++r)if(this.isUnknown(t[r])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,n){return ue(()=>{this.invokeCallHook(t,n);const r=Je(t),i=r.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return ne(r,s)})}getConfig(){const t={targetShape:this.targetShape},n=super.getConfig();return Object.assign(t,n),t}}fie.className="Reshape";ve(fie);class hie extends gt{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const n=Ea(1,t.dims.length+1);if(!_t(t.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Jn({ndim:this.dims.length+1})]}computeOutputShape(t){t=It(t);const n=t.slice();return this.dims.forEach((r,i)=>{n[i+1]=t[r]}),n}call(t,n){return Ct(Je(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},n=super.getConfig();return Object.assign(t,n),t}}hie.className="Permute";ve(hie);class die extends gt{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,t),n}computeMask(t,n){const r=Je(t),i=-1;return T$(Pm(r,this.maskValue),i)}call(t,n){return ue(()=>{this.invokeCallHook(t,n);const r=Je(t),i=-1,s=!0,o=T$(Pm(r,this.maskValue),i,s);return Q(r,Ee(o,r.dtype))})}}die.className="Masking";ve(die);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pie extends gt{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let n=null;t.batchSize!=null&&(n=t.batchSize),t.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(cn(t.inputLength))}this.inputDim=t.inputDim,lr(this.inputDim,"inputDim"),this.outputDim=t.outputDim,lr(this.outputDim,"outputDim"),this.embeddingsInitializer=vn(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=xn(t.embeddingsRegularizer),this.activityRegularizer=xn(t.activityRegularizer),this.embeddingsConstraint=er(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,n){return ue(()=>this.maskZero?(t=Je(t),Pm(t,$t(t))):null)}computeOutputShape(t){if(t=It(t),this.inputLength==null)return[...t,this.outputDim];const n=cn(this.inputLength);if(n.length!==t.length-1)throw new ee(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let r=0;for(let i=0;i<n.length;++i){const s=n[i],o=t[i+1];if(s!=null&&o!=null&&s!==o)throw new ee(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);s==null&&(n[r]=o),r++}}return[t[0],...n,this.outputDim]}call(t,n){return ue(()=>{this.invokeCallHook(t,n);let r=Je(t);r.dtype!=="int32"&&(r=bu(r,"int32"));const i=Xne(this.embeddings.read(),ne(r,[r.size]));return ne(i,It(this.computeOutputShape(r.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:kn(this.embeddingsInitializer),embeddingsRegularizer:Qt(this.embeddingsRegularizer),activityRegularizer:Qt(this.activityRegularizer),embeddingsConstraint:Qn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(t,n),t}}pie.className="Embedding";ve(pie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rg extends gt{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new ut}computeElementwiseOpOutputShape(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;const r=t.slice(0,t.length-n.length);for(let i=0;i<n.length;++i){const s=t[t.length-n.length+i],o=n[i];if(s==null||o==null||s<0||o<0)r.push(null);else if(s===1)r.push(o);else if(o===1)r.push(s);else{if(s!==o)throw new ee("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));r.push(s)}}return r}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[It(t)]),t=t,t.length<2)throw new ee(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let n=[];for(const s of t)s!=null&&s[0]!==null&&n.push(s[0]);if(n=pf(n),n.length>1)throw new ee(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let r=t[0]==null?null:t[0].slice(1);for(let s=1;s<t.length;++s){const o=t[s]==null?null:t[s].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const i=t.map(s=>s.length);t.indexOf(null)===-1&&pf(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,n){return ue(()=>{if(t=t,this.reshapeRequired){const r=[],i=t.map(s=>s.rank);if(i.indexOf(null)===-1){const s=If(i);for(let o of t){const a=o.rank;for(let u=0;u<s-a;++u)o=Dw(o,1);r.push(o)}return this.mergeFunction(r)}else{let s=!1;for(const u of t){const l=u.rank;if(l==null){const c=u.shape,f=c[0],h=c.slice(1).concat([f]);let d=ne(u,[f].concat(gf(c.slice(1))));d=Ct(d,[1,0]),d=ne(d,h),r.push(d),s=!0}else if(l>1){const c=Ea(1,l).concat([0]);r.push(Ct(u,c)),s=!0}else r.push(u)}let o=this.mergeFunction(r);const a=o.rank;if(s){if(a==null){const u=o.shape,l=u.length,c=u[l-1],f=[c].concat(u.slice(0,u.length-1));o=ne(Ct(ne(o,[-1,c]),[1,0]),f)}else if(a>1){const u=[a-1].concat(Ea(0,a-1));o=Ct(o,u)}}return o}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let n;t[0]==null?n=null:n=t[0].slice(1);for(let i=1;i<t.length;++i){const s=t[i]==null?null:t[i].slice(1);n=this.computeElementwiseOpOutputShape(n,s)}let r=[];for(const i of t)i!=null&&i[0]!==null&&r.push(i[0]);return r=pf(r),r.length===1?n=r.concat(n):n=[null].concat(n),n}computeMask(t,n){return ue(()=>{if(n==null)return null;if(!Array.isArray(n))throw new ee("`mask` should be an Array");if(!Array.isArray(t))throw new ee("`inputs` should be an Array");if(n.length!==t.length)throw new ee(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${n.length})`);if(n.every(i=>i==null))return null;n=n.map(i=>i==null?i:Mi(i,0));let r=n[0];for(let i=1;i<n.length-1;++i)r=Fu(r,n[i]);return r})}}class gie extends rg{constructor(t){super(t)}mergeFunction(t){return ue(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=be(n,t[r]);return n})}}gie.className="Add";ve(gie);class mie extends rg{constructor(t){super(t)}mergeFunction(t){return ue(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=Q(n,t[r]);return n})}}mie.className="Multiply";ve(mie);class yie extends rg{constructor(t){super(t)}mergeFunction(t){return ue(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=be(n,t[r]);return Q(1/t.length,n)})}}yie.className="Average";ve(yie);class bie extends rg{constructor(t){super(t)}mergeFunction(t){return ue(()=>{let n=t[0];for(let r=1;r<t.length;++r)n=pc(n,t[r]);return n})}}bie.className="Maximum";ve(bie);class vie extends rg{constructor(t){super(t)}mergeFunction(t){return ue(()=>{let n=t[0];for(let r=1;r<t.length;++r)n=hp(n,t[r]);return n})}}vie.className="Minimum";ve(vie);class xie extends rg{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new ee("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let n=!0;for(const i of t)if(i!=null){n=!1;break}if(n)return;const r=[];for(let i=0;i<t.length;++i){const s=t[i].slice();s.splice(this.axis,1);let o=!1;for(const a of r)if(_t(a,s)){o=!0;break}o||r.push(s)}if(r.length>1)throw new ee("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return ue(()=>w5(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new ee("A `Concatenate` layer should be called on a list of inputs.");const n=t,r=n[0].slice(),i=this.axis<0?r.length+this.axis:this.axis;for(const s of n.slice(1)){if(r[i]==null||s[i]==null){r[i]=null;break}r[i]+=s[i]}return r}computeMask(t,n){if(n==null)return null;if(!Array.isArray(n))throw new ee("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new ee("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new ee(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${t.length})`);return ue(()=>{let r=!0;if(n.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const i=[];for(let o=0;o<t.length;++o)n[o]==null?i.push(Ee(Qs(t[o]),"bool")):n[o].rank<t[o].rank?i.push(Mi(n[o],-1)):i.push(n[o]);const s=hr(i,this.axis);return eB(s,-1,!1)})}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}xie.className="Concatenate";ve(xie);function Fy(e,t){for(;e<0;)e+=t;return e}function FOe(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new ut("batchDot is not implemented for tensors of 4D or higher rank yet");if(z(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),z(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),e.dtype==="complex64"||t.dtype==="complex64")throw new ut("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,i=t.shape.length;n==null&&(n=[r-1,i-2]);const s=n;return ue(()=>{let o;if(r>i){o=r-i;const u=[];for(let l=0;l<o;++l)u.push(1);t=ne(t,t.shape.concat(u))}else if(i>r){o=i-r;const u=[];for(let l=0;l<o;++l)u.push(1);e=ne(e,e.shape.concat(u))}else o=0;let a;if(e.shape.length===2&&t.shape.length===2)s[0]===s[1]?a=Oe(Q(e,t),s[0]):a=Oe(Q(Ct(e,[1,0]),t),s[1]);else{const u=s[0]!==e.shape.length-1,l=s[1]===t.shape.length-1;a=pt(e,t,u,l)}if(o>0){let u;r>i?u=r+i-3:u=r-1;const l=[];for(let c=u;c<u+o;++c)l.push(c);a=xh(a,l)}return a.shape.length===1&&(a=Mi(a,1)),a})}class wie extends rg{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){z(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0],r=t[1];if(n.length>3||r.length>3)throw new ut("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,r);if(n[i[0]]!==r[i[1]])throw new ee(`Dimension incompatibility: ${n[i[0]]} !== ${r[i[1]]}`)}mergeFunction(t){if(t.length!==2)throw new ee(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let n=t[0],r=t[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,o)=>Fy(s,t[o].shape.length)):i=[Fy(this.axes,n.shape.length),Fy(this.axes,r.shape.length)],this.normalize&&(n=M$(n,i[0]),r=M$(r,i[1])),FOe(n,r,i)}interpretAxes(t,n){let r;return Array.isArray(this.axes)?r=this.axes:r=[Fy(this.axes,t.length),Fy(this.axes,n.length)],r}computeOutputShape(t){z(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0].slice(),r=t[1].slice();if(n.length>3||r.length>3)throw new ut("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,r);n.splice(i[0],1),r.splice(i[1],1),r.splice(0,1);const s=n.concat(r);return s.length===1&&s.push(1),s}computeMask(t,n){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(t,n),t}}wie.className="Dot";ve(wie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Cie extends gt{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,t),n}call(t,n){return ue(()=>{this.invokeCallHook(t,n);const r=Je(t);return Fw(()=>be(lD(r.shape,0,this.stddev),r),()=>r,n.training||!1)})}}Cie.className="GaussianNoise";ve(Cie);class Sie extends gt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return ue(()=>{this.invokeCallHook(t,n);const r=Je(t);return this.rate>0&&this.rate<1?Fw(()=>{const s=Math.sqrt(this.rate/(1-this.rate));return Q(r,lD(r.shape,1,s))},()=>r,n.training||!1):r})}}Sie.className="GaussianDropout";ve(Sie);class _ie extends gt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Je(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return ue(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(t);return Fw(()=>{const s=Je(t),o=1.6732632423543772,a=1.0507009873554805,u=-o*a;let l=bh(eg(r),this.rate);l=bu(l,"float32");const c=((1-this.rate)*(1+this.rate*u**2))**-.5,f=-c*u*this.rate,h=be(Q(s,l),Q(be(l,-1),u));return be(Q(h,c),f)},()=>Je(t),n.training||!1)}return t})}}_ie.className="AlphaDropout";ve(_ie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jv(e,t,n,r,i,s=.001){let o;if(e.rank===2)o=qee(e,t,n,r,i,s);else if(e.rank===3)o=Xee(e,t,n,r,i,s);else if(e.rank===4)o=Yee(e,t,n,r,i,s);else throw new ut(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return o}function OOe(e,t,n,r,i=.001){return ue(()=>{const s=LT(e,r),o=s.mean,a=s.variance;return[jv(e,o,a,n,t,i),o,a]})}function NOe(e,t,n,r,i=.001){return ue(()=>{const s=LT(e,r),o=s.mean,a=s.variance,u=[];for(const p of Ea(0,e.rank))r.indexOf(p)!==-1?u.push(1):u.push(e.shape[p]);const l=ne(o,u),c=ne(a,u),f=t==null?null:ne(t,u),h=n==null?null:ne(n,u);return[jv(e,l,c,h,f,i),o,a]})}function MOe(e,t,n,r,i=.001){return _t(r.slice().sort(),Ea(0,e.rank-1))?OOe(e,t,n,r,i):NOe(e,t,n,r,i)}class $ie extends gt{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=vn(t.betaInitializer||"zeros"),this.gammaInitializer=vn(t.gammaInitializer||"ones"),this.movingMeanInitializer=vn(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=vn(t.movingVarianceInitializer||"ones"),this.betaConstraint=er(t.betaConstraint),this.gammaConstraint=er(t.gammaConstraint),this.betaRegularizer=xn(t.betaRegularizer),this.gammaRegularizer=xn(t.gammaRegularizer)}build(t){t=It(t);const n=this.axis>=0?this.axis:this.axis+t.length,r=t[n];if(r==null)throw new ee(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new Jn({ndim:t.length,axes:{[n]:r}})];const i=[r];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,n){return ue(()=>{const r=n.training==null?!1:n.training,i=Je(t),s=i.shape,o=s.length,a=Ea(0,o),u=this.axis>=0?this.axis:this.axis+o;a.splice(u,1);const l=pp(1,o);l[u]=s[u];const c=a.slice();c.sort();const f=!_t(c,Ea(0,o).slice(0,o-1)),h=()=>{if(f){const b=ne(this.movingMean.read(),l),x=ne(this.movingVariance.read(),l),v=this.center?ne(this.beta.read(),l):null,w=this.scale?ne(this.gamma.read(),l):null;return jv(i,b,x,v,w,this.epsilon)}else return jv(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return h();const[d,p,m]=MOe(i,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(b,x,v)=>{ue(()=>{const w=1-v,C=b.read(),S=Q(Ie(C,x),w);b.write(Ie(C,S))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),d})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:kn(this.betaInitializer),gammaInitializer:kn(this.gammaInitializer),movingMeanInitializer:kn(this.movingMeanInitializer),movingVarianceInitializer:kn(this.movingVarianceInitializer),betaRegularizer:Qt(this.betaRegularizer),gammaRegularizer:Qt(this.gammaRegularizer),betaConstraint:Qn(this.betaConstraint),gammaConstraint:Qn(this.gammaConstraint)},n=super.getConfig();return Object.assign(t,n),t}}$ie.className="BatchNormalization";ve($ie);class kie extends gt{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=vn(t.betaInitializer||"zeros"),this.gammaInitializer=vn(t.gammaInitializer||"ones"),this.betaRegularizer=xn(t.betaRegularizer),this.gammaRegularizer=xn(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=It(t);const n=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=n);for(const s of this.axis)if(s<0||s>=n)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==pf(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(s=>t[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(t,n){const r=Je(t),i=r.shape,s=i.length;return ue(()=>{let{mean:a,variance:u}=LT(r,this.axis,!0);const l=pp(1,s);for(const m of this.axis)l[m]=i[m];const c=m=>m!=null&&m.shape.length!==s?ne(m,l):m;let f=this.scale?c(this.gamma.read()):null,h=this.center?c(this.beta.read()):null;const d=[],p=[];for(let m=0;m<s;++m)this.axis.indexOf(m)!==-1?(d.push(i[m]),p.push(1)):(d.push(1),p.push(i[m]));return a=vo(a,d),u=vo(u,d),f!=null&&(f=vo(f,p)),h!=null&&(h=vo(h,p)),jv(r,a,u,h,f,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:kn(this.betaInitializer),gammaInitializer:kn(this.gammaInitializer),betaRegularizer:Qt(this.betaRegularizer),gammaRegularizer:Qt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(t,n),t}}kie.className="LayerNormalization";ve(kie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ROe(e,t,n){return ue(()=>{if(e.rank!==4)throw new ee(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new ee("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Aa()),n!=="channelsLast"&&n!=="channelsFirst")throw new ee(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return n==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],vh(e,r)})}class Eie extends gt{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?Aa():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new ee(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let n,r;if(typeof t.padding[0]=="number")n=[t.padding[0],t.padding[0]],r=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new ee(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(n=t.padding[0],t.padding[1].length!==2)throw new ee(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);r=t.padding[1]}this.padding=[n,r]}this.inputSpec=[new Jn({ndim:4})]}computeOutputShape(t){t=It(t);let n,r;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?r=t[3]+this.padding[1][0]+this.padding[1][1]:r=null,[t[0],t[1],n,r]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?r=t[2]+this.padding[1][0]+this.padding[1][1]:r=null,[t[0],n,r,t[3]])}call(t,n){return ue(()=>ROe(Je(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}Eie.className="ZeroPadding2D";ve(Eie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yD(e,t,n,r,i,s){return ue(()=>{jn(i),Vne(s),so(r),n==null&&(n=[1,1]),r==null&&(r="valid"),i==null&&(i=Aa()),s==null&&(s="max"),e=N5(e,i);let o;const a=r==="same"?"same":"valid";return s==="max"?o=PT(e,t,n,a):o=TT(e,t,n,a),i==="channelsFirst"&&(o=Ct(o,[0,3,1,2])),o})}function Aie(e,t,n,r,i,s){return ue(()=>{jn(i),Vne(s),so(r),n==null&&(n=[1,1,1]),r==null&&(r="valid"),i==null&&(i=Aa()),s==null&&(s="max"),e=Gre(e,i);let o;const a=r==="same"?"same":"valid";return s==="max"?o=wte(e,t,n,a):o=Hee(e,t,n,a),i==="channelsFirst"&&(o=Ct(o,[0,4,1,2,3])),o})}class Tie extends gt{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new ee(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(lr(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new ee(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);lr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,so(this.padding),this.inputSpec=[new Jn({ndim:3})]}computeOutputShape(t){t=It(t);const n=xa(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]}call(t,n){return ue(()=>{this.invokeCallHook(t,n),t=Dw(Je(t),2);const r=this.poolingFunction(Je(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return xh(r,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(t,n),t}}class Die extends Tie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return jn(s),so(i),yD(t,n,r,i,s,"max")}}Die.className="MaxPooling1D";ve(Die);class Iie extends Tie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return jn(s),so(i),yD(t,n,r,i,s,"avg")}}Iie.className="AveragePooling1D";ve(Iie);class Fie extends gt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new ee(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];lr(this.poolSize,"poolSize"),lr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,jn(this.dataFormat),so(this.padding),this.inputSpec=[new Jn({ndim:4})]}computeOutputShape(t){t=It(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=xa(n,this.poolSize[0],this.padding,this.strides[0]),r=xa(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,r]:[t[0],n,r,t[3]]}call(t,n){return ue(()=>(this.invokeCallHook(t,n),this.poolingFunction(Je(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class Oie extends Fie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return jn(s),so(i),yD(t,n,r,i,s,"max")}}Oie.className="MaxPooling2D";ve(Oie);class Nie extends Fie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return jn(s),so(i),yD(t,n,r,i,s,"avg")}}Nie.className="AveragePooling2D";ve(Nie);class Mie extends gt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new ee(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];lr(this.poolSize,"poolSize"),lr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,jn(this.dataFormat),so(this.padding),this.inputSpec=[new Jn({ndim:5})]}computeOutputShape(t){t=It(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=xa(n,this.poolSize[0],this.padding,this.strides[0]),r=xa(r,this.poolSize[1],this.padding,this.strides[1]),i=xa(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,r,i]:[t[0],n,r,i,t[4]]}call(t,n){return ue(()=>(this.invokeCallHook(t,n),this.poolingFunction(Je(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class Rie extends Mie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return jn(s),so(i),Aie(t,n,r,i,s,"max")}}Rie.className="MaxPooling3D";ve(Rie);class Pie extends Mie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return jn(s),so(i),Aie(t,n,r,i,s,"avg")}}Pie.className="AveragePooling3D";ve(Pie);class Lie extends gt{constructor(t){super(t),this.inputSpec=[new Jn({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,n){throw new ut}}class Bie extends Lie{constructor(t){super(t||{})}call(t,n){return ue(()=>{const r=Je(t);return In(r,1)})}}Bie.className="GlobalAveragePooling1D";ve(Bie);class zie extends Lie{constructor(t){super(t||{})}call(t,n){return ue(()=>{const r=Je(t);return To(r,1)})}}zie.className="GlobalMaxPooling1D";ve(zie);class jie extends gt{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,jn(this.dataFormat),this.inputSpec=[new Jn({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,n){throw new ut}getConfig(){const t={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class Uie extends jie{call(t,n){return ue(()=>{const r=Je(t);return this.dataFormat==="channelsLast"?In(r,[1,2]):In(r,[2,3])})}}Uie.className="GlobalAveragePooling2D";ve(Uie);class Wie extends jie{call(t,n){return ue(()=>{const r=Je(t);return this.dataFormat==="channelsLast"?To(r,[1,2]):To(r,[2,3])})}}Wie.className="GlobalMaxPooling2D";ve(Wie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Vie extends gt{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(t,n),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,n,r={}){const i=n.layer,s=xu(i,r);delete n.layer;const o={layer:s};return Object.assign(o,n),new t(o)}}class Gie extends Vie{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=It(t),t.length<3)throw new ee(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=It(t);const n=[t[0]].concat(t.slice(2)),r=this.layer.computeOutputShape(n),i=t[1];return[r[0],i].concat(r.slice(1))}call(t,n){return ue(()=>(t=Je(t),eie((o,a)=>[Je(this.layer.call(o,n)),[]],t,[],!1,null,null,!1,!0)[1]))}}Gie.className="TimeDistributed";ve(Gie);function POe(e){ng(iFe,"BidirectionalMergeMode",e)}const LOe="concat";class Hie extends Vie{constructor(t){super(t);const n=t.layer.getConfig(),r={};r.className=t.layer.getClassName(),r.config=n,this.forwardLayer=xu(r),n.goBackwards=n.goBackwards!==!0;const i={};if(i.className=t.layer.getClassName(),i.config=n,this.backwardLayer=xu(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?LOe:t.mergeMode,POe(this.mergeMode),t.weights)throw new ut("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const n=t.length,r=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,r)),this.backwardLayer.setWeights(t.slice(r))}computeOutputShape(t){let n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let r,i,s;return this.returnState&&(s=n.slice(1)),r=n[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,i=[r]):this.mergeMode==null?i=[r,r.slice()]:i=[r],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[r].concat(s).concat(s.slice()):Ri(i)}apply(t,n){let r=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const s=Qre(t,r,i,this.numConstants);if(t=s.inputs,r=s.initialState,i=s.constants,Array.isArray(t)&&(r=t.slice(1),t=t[0]),(r==null||r.length===0)&&i==null)return super.apply(t,n);const o=[],a=[];if(r!=null){const l=r.length;if(l%2>0)throw new ee("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,o.push(...r);const c=r.map(f=>new Jn({shape:f.shape}));this.forwardLayer.stateSpec=c.slice(0,l/2),this.backwardLayer.stateSpec=c.slice(l/2),a.push(...c)}if(i!=null)throw new ut("Support for constants in Bidirectional layers is not implemented yet.");const u=o[0]instanceof hu;for(const l of o)if(l instanceof hu!==u)throw new ee("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const l=[t].concat(o),c=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=c;const h=super.apply(l,n);return this.inputSpec=f,h}else return super.apply(t,n)}call(t,n){return ue(()=>{const r=n.initialState;let i,s;if(r==null)i=this.forwardLayer.call(t,n),s=this.backwardLayer.call(t,n);else{const u=r.slice(0,r.length/2),l=r.slice(r.length/2);i=this.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=this.backwardLayer.call(t,Object.assign(n,{initialState:l}))}let o;this.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=Fo(s,1));let a;return this.mergeMode==="concat"?a=w5([i,s]):this.mergeMode==="sum"?a=be(i,s):this.mergeMode==="ave"?a=Q(.5,be(i,s)):this.mergeMode==="mul"?a=Q(i,s):this.mergeMode==null&&(a=[i,s]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){Hd(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),Hd(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,n){Array.isArray(n)&&(n=n[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[n,n]:r=n:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const s=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(s).concat(s):[r].concat(s).concat(s)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,n){const r=xu(n.layer);if(delete n.layer,n.numConstants!=null)throw new ut("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=n;return i.layer=r,new t(i)}}Hie.className="Bidirectional";ve(Hie);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qie extends gt{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return ue(()=>(t=Je(t),t.dtype!=="float32"&&(t=bu(t,"float32")),be(Q(t,this.scale),this.offset)))}}qie.className="Rescaling";ve(qie);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:BOe,cropAndResize:zOe}=fu;class Xie extends gt{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,n,r,i,s,o,a,u){return ue(()=>{let l,c=!1;const f=n/o,h=r/a,d=(i+n)/o,p=(s+r)/a,m=[f,h,d,p],g=[];t.rank===3?(c=!0,l=Ql([t])):l=t;for(let w=0;w<l.shape[0];w++)g.push(m);const y=Gd(g,[g.length,4]),b=Lm(0,g.length,1,"int32"),v=zOe(l,y,b,[i,s],"nearest");return bu(c?Je(Df(v)):v,u)})}upsize(t,n,r,i){return ue(()=>{const s=BOe(t,[n,r]);return bu(s,i)})}call(t,n){return ue(()=>{const r=Je(t),i=r.dtype,s=r.shape,o=s[s.length-3],a=s[s.length-2];let u=0;o!==this.height&&(u=Math.floor((o-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),u>=0&&l>=0?this.centerCrop(r,u,l,this.height,this.width,o,a,i):this.upsize(t,this.height,this.width,i)})}getConfig(){const t={height:this.height,width:this.width},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=It(t);const n=t.length-3,r=t.length-2;return t[n]=this.height,t[r]=this.width,t}}Xie.className="CenterCrop";ve(Xie);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jOe(e,t,n,r){let i=Je(e);if(i.dtype!=="int32"&&(i=bu(i,"int32")),t==="int")return i;const s=i.shape;if(i.rank===0&&(i=Mi(i,-1)),t==="oneHot"&&i.shape[i.shape.length-1]!==1&&(i=Mi(i,-1)),i.rank>2)throw new ee(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${s} which would result in output rank ${i.rank}.`);const o=["multiHot","oneHot"].includes(t),a=i;let u;if(typeof r<"u"&&t==="count"?u=BM(a,r,n,o):u=BM(a,[],n,o),t!=="tfIdf")return u;if(r)return Q(u,r);throw new ee("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Yie extends gt{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){return t=It(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,n){return ue(()=>{t=Je(t),t.dtype!=="int32"&&(t=bu(t,"int32"));let r;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new ee(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);r=Je(n.countWeights)}const i=To(t),s=Ov(t),o=Rs(this.numTokens,i).bufferSync().get(0),a=bh(s,0).bufferSync().get(0);if(!(o&&a))throw new ee(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return jOe(t,this.outputMode,this.numTokens,r)})}}Yie.className="CategoryEncoding";ve(Yie);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const UOe=["bilinear","nearest"],UV=new Set(UOe);class Kie extends gt{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(UV.has(t.interpolation))this.interpolation=t.interpolation;else throw new ee(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=It(t);const n=t[2];return[this.height,this.width,n]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return ue(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return fu.resizeBilinear(t,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return fu.resizeNearestNeighbor(t,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...UV]} are supported`)})}}Kie.className="Resizing";ve(Kie);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Zie{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}Zie.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Jie extends gt{constructor(t){super(t),this.randomGenerator=new Zie(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(t,n),t}}Jie.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const WOe=["bilinear","nearest"],WV=new Set(WOe);class Qie extends Jie{constructor(t){super(t);const{factor:n,interpolation:r="bilinear"}=t;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new ee(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new ee(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ee(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(WV.has(r))this.interpolation=r;else throw new ee(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=It(t);const n=t[2];return[this.imgHeight,-1,n]}call(t,n){return ue(()=>{const r=Je(t);this.imgHeight=r.shape[r.shape.length-3];const i=r.shape[r.shape.length-2];this.widthFactor=eg([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let s=this.widthFactor.dataSync()[0]*i;s=Math.round(s);const o=[this.imgHeight,s];switch(this.interpolation){case"bilinear":return fu.resizeBilinear(t,o);case"nearest":return fu.resizeNearestNeighbor(t,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...WV]} are supported`)}})}}Qie.className="RandomWidth";ve(Qie);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VOe=ae();VOe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var VV;(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"})(VV||(VV={}));var GV;(function(e){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(GV||(GV={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var HV;(function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"})(HV||(HV={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ne(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&z(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GOe=XT;class bD extends vA{nextDataId(){return bD.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new R4(this,ra())}write(t,n,r){this.firstUse&&(this.firstUse=!1,ae().get("IS_NODE")&&js(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:r,refCount:1}),i}makeTensorInfo(t,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&cu(r[0])){const s=r.map(o=>gu(o));i=this.write(s,t,n)}else i=this.write(r,t,n);return{dataId:i,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){const n=this.data.get(t);n.refCount--}}move(t,n,r,i,s){this.data.set(t,{values:n,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:n,complexTensorInfos:r}=this.data.get(t);if(n==="complex64"){const i=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return ec(i,s)}return QQ(this.data.get(t).values,n)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const r=n.map(i=>Jl(i));return ft(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ft(t.shape,t.dtype,n)}makeOutput(t,n,r){return ra().makeTensorFromTensorInfo(this.makeTensorInfo(n,r,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(t);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const n=ui();return t(),{kernelMs:ui()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Ne([t],"where");const n=this.readSync(t.dataId);return GOe(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}bD.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ese(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const HOe=e=>{const{x:t}=e.inputs,n=e.backend;Ne(t,"abs");let r=new Float32Array(ce(t.shape));const i=n.data.get(t.dataId).values;return r=ese(i),n.makeOutput(r,t.shape,t.dtype)},qOe={kernelName:d2,backendName:"cpu",kernelFunc:HOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Un(e){return(t,n,r,i,s)=>{const o=rt(t,n),a=o.length,u=Ue(o),l=ce(o),c=gr(s,l),f=t.length,h=n.length,d=Ue(t),p=Ue(n),m=fp(t,o),g=fp(n,o);if(m.length+g.length===0)for(let y=0;y<c.length;++y)c[y]=e(r[y%r.length],i[y%i.length]);else for(let y=0;y<c.length;++y){const b=Xp(y,a,u),x=b.slice(-f);m.forEach(S=>x[S]=0);const v=ba(x,f,d),w=b.slice(-h);g.forEach(S=>w[S]=0);const C=ba(w,h,p);c[y]=e(r[v],i[C])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hs(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(r.shape,"complex64"),u=n.data.get(a.dataId);return u.complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const XOe={kernelName:TA,backendName:"cpu",kernelFunc:hs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j$(e,t,n="float32"){if(n==="complex64"){const i=j$(e,t,"float32"),s=j$(e,t,"float32");return hs({inputs:{real:i,imag:s},backend:e})}const r=Ir(ce(t),n);return e.makeTensorInfo(t,n,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ou(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const YOe={kernelName:t1,backendName:"cpu",kernelFunc:Ou};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gp(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const KOe={kernelName:aT,backendName:"cpu",kernelFunc:gp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tse(e,t,n,r){if(r==="int32"){const i=Int32Array.from(e);return[t,"int32",i]}if(r==="bool"){const i=ph([0],n),[s,o]=Un((a,u)=>a!==u?1:0)(t,[],e,i,"bool");return[o,"bool",s]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function Mf(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:s}=r;if(s==="complex64"){if(i.dtype==="complex64")return Ou({inputs:{x:i},backend:n});const c=j$(n,i.shape,i.dtype),f=Mf({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),h=hs({inputs:{real:f,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),h}if(i.dtype==="complex64"){const c=gp({inputs:{input:i},backend:n}),f=Mf({inputs:{x:c},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(c),f}if(!B4(i.dtype,s)){const c=Ou({inputs:{x:i},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:s}}const o=n.data.get(i.dataId).values,[a,u,l]=tse(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,u,l)}const ZOe={kernelName:U0,backendName:"cpu",kernelFunc:Mf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(e,t,n,r){return n==null?({inputs:i,backend:s})=>{const{a:o,b:a}=i,u=s;Ne([o,a],e);const l=u.data.get(o.dataId).values,c=u.data.get(a.dataId).values,f=o.dtype==="string"?tc(l):l,h=o.dtype==="string"?tc(c):c,d=r||o.dtype,[p,m]=t(o.shape,a.shape,f,h,d);return u.makeTensorInfo(m,d,p)}:({inputs:i,backend:s})=>{const{a:o,b:a}=i,u=s;if(o.dtype==="complex64"||a.dtype==="complex64"){const l=Mf({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),c=u.data.get(l.dataId),f=c.complexTensorInfos.real,h=c.complexTensorInfos.imag,d=u.data.get(f.dataId).values,p=u.data.get(h.dataId).values,m=Mf({inputs:{x:a},backend:u,attrs:{dtype:"complex64"}}),g=u.data.get(m.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,x=u.data.get(y.dataId).values,v=u.data.get(b.dataId).values,[w,C,S]=n(o.shape,a.shape,d,p,x,v),_=u.makeTensorInfo(S,"float32",w),$=u.makeTensorInfo(S,"float32",C),k=hs({inputs:{real:_,imag:$},backend:u});return u.disposeIntermediateTensorInfo(l),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(_),u.disposeIntermediateTensorInfo($),k}else{const l=u.data.get(o.dataId).values,c=u.data.get(a.dataId).values,f=r||o.dtype,[h,d]=t(o.shape,a.shape,l,c,f);return u.makeTensorInfo(d,f,h)}}}function z5(e){return(t,n,r,i,s,o)=>{const a=rt(t,n),u=ce(a),l=a.length,c=Ue(a),f=gr("float32",u),h=gr("float32",u),d=fp(t,a),p=fp(n,a),m=ec(r,i),g=ec(s,o),y=t.length,b=Ue(t),x=n.length,v=Ue(n);if(d.length+p.length===0)for(let w=0;w<f.length;w++){const C=w%m.length,S=w%g.length,_=e(m[C*2],m[C*2+1],g[S*2],g[S*2+1]);f[w]=_.real,h[w]=_.imag}else for(let w=0;w<f.length;w++){const C=Xp(w,l,c),S=C.slice(-y);d.forEach(F=>S[F]=0);const _=ba(S,y,b),$=C.slice(-x);p.forEach(F=>$[F]=0);const k=ba($,x,v),E=e(m[_*2],m[_*2+1],g[k*2],g[k*2+1]);f[w]=E.real,h[w]=E.imag}return[f,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nse=Un((e,t)=>e+t),JOe=z5((e,t,n,r)=>({real:e+n,imag:t+r})),zm=rr(Yp,nse,JOe),QOe={kernelName:Yp,backendName:"cpu",kernelFunc:zm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j5(e,t,n,r,i){const s=ce(r),o=Ir(i,n);for(let a=0;a<e.length;a++){const u=e[a];if(u<0)throw new Error("Input x must be non-negative!");u>=i||(s>0?o[u]+=t[a]:o[u]+=1)}return o}function rse(e,t,n,r=!1){const i=e.shape[0],s=e.shape[1],o=ft([i,n],t.dtype);for(let a=0;a<i;a++)for(let u=0;u<s;u++){const l=e.get(a,u);if(l<0)throw new Error("Input x must be non-negative!");l>=n||(r?o.set(1,a,l):t.size>0?o.set(o.get(a,l)+t.get(a,u),a,l):o.set(o.get(a,l)+1,a,l))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise=Un((e,t)=>e&t),eNe=rr(w2,ise),tNe={kernelName:w2,backendName:"cpu",kernelFunc:eNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xu(e){return(t,n,r)=>{const i=Fn(n,t.length);for(let s=0;s<t.length;++s)i[s]=e(t[s],r);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qt(e,t,n){const r=Xu(t);return Sh(e,r,n)}function Sh(e,t,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;Ne(o,e);const a=s,u=a.data.get(o.dataId).values;let l;if(o.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");l=tc(u)}else l=u;const c=n||o.dtype,f=t(l,c,i);return a.makeTensorInfo(o.shape,c,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sse=Xu(e=>Math.ceil(e)),nNe=Sh(W0,sse),rNe={kernelName:W0,backendName:"cpu",kernelFunc:nNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ose(e,t,n,r){const i=Fn(n,ce(t));if(r&&n!=="string"){let s=0;e.forEach(o=>{const a=ce(o.shape);i.set(o.vals,s),s+=a})}else{let s=0;e.forEach(o=>{const a=n==="string"?tc(o.vals):o.vals;let u=0;for(let l=0;l<o.shape[0];++l){const c=l*t[1]+s;for(let f=0;f<o.shape[1];++f)i[c+f]=a[u++]}s+=o.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ase=Un((e,t)=>e===t?1:0),use=rr(D2,ase,null,"bool"),iNe={kernelName:D2,backendName:"cpu",kernelFunc:use};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lse=Xu(e=>Math.exp(e)),cse=Sh(K0,lse,"float32"),sNe={kernelName:K0,backendName:"cpu",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse=Xu(e=>Math.expm1(e)),oNe=Sh(Z0,fse),aNe={kernelName:Z0,backendName:"cpu",kernelFunc:oNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hse=Xu(e=>Math.floor(e)),uNe=Sh(J0,hse),lNe={kernelName:J0,backendName:"cpu",kernelFunc:uNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dse=Un((e,t)=>Math.floor(e/t)),cNe=rr(Q0,dse,null,"int32"),fNe={kernelName:Q0,backendName:"cpu",kernelFunc:cNe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pse(e,t,n,r,i,s,o,a,u){const l=ft([r,s],n);for(let c=0;c<r;c++){const f=[];let h=0;for(let d=0;d<i;d++){const p=e[c*i+d];h+=p*o[d],f.push(p)}if(h<0||h>=u/s)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let d=0;d<s;d++)l.values[c*s+d]=t.get(...t.indexToLoc(h*s+d))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gse(e,t,n){const r=ft(n,e.dtype);for(let i=0;i<r.size;++i){const o=r.indexToLoc(i).slice(),a=o[0],u=o[2],l=t.locToIndex([a,u]);o[2]=t.values[l];const c=e.locToIndex(o);0<=c&&c<e.values.length&&(r.values[i]=e.values[c])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mse=Un((e,t)=>e>t?1:0),hNe=rr(N2,mse,null,"bool"),dNe={kernelName:N2,backendName:"cpu",kernelFunc:hNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yse=Un((e,t)=>e>=t?1:0),pNe=rr(e1,yse,null,"bool"),gNe={kernelName:e1,backendName:"cpu",kernelFunc:pNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bse=Un((e,t)=>e<t?1:0),mNe=rr(R2,bse,null,"bool"),yNe={kernelName:R2,backendName:"cpu",kernelFunc:mNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vse=Un((e,t)=>e<=t?1:0),bNe=rr(P2,vse,null,"bool"),vNe={kernelName:P2,backendName:"cpu",kernelFunc:bNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(e,t,n){const r=(t-e)/(n-1),i=Ir(n,"float32");i[0]=e;for(let s=1;s<i.length;s++)i[s]=i[s-1]+r;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wse=Xu(e=>Math.log(e)),xNe=Sh(s1,wse),wNe={kernelName:s1,backendName:"cpu",kernelFunc:xNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cse(e,t,n,r){const i=gr(r,ce(n));for(let s=0;s<i.length;++s){const o=s*t;let a=e[o];for(let u=0;u<t;++u){const l=e[o+u];(Number.isNaN(l)||l>a)&&(a=l)}i[s]=a}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sse=Un((e,t)=>Math.max(e,t)),CNe=rr(a1,Sse),SNe={kernelName:a1,backendName:"cpu",kernelFunc:CNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _se=Un((e,t)=>Math.min(e,t)),_Ne=rr(u1,_se),$Ne={kernelName:u1,backendName:"cpu",kernelFunc:_Ne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U5=Un((e,t)=>e*t),kNe=z5((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),vD=rr(c1,U5,kNe),ENe={kernelName:c1,backendName:"cpu",kernelFunc:vD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(e,t,n){const r=fc(-1,n);return U5([],t,r,e,n)}function ANe(e){const{inputs:t,backend:n}=e,{x:r}=t;Ne(r,"neg");const i=n.data.get(r.dataId).values,[s,o]=$se(i,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,s)}const TNe={kernelName:X2,backendName:"cpu",kernelFunc:ANe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kse=Un((e,t)=>e!==t?1:0),DNe=rr(Y2,kse,null,"bool"),INe={kernelName:Y2,backendName:"cpu",kernelFunc:DNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5(e,t,n,r,i){const s=t.length,o=ce(t),a=Ue(t),u=Ue(i),l=gr(n,ce(i));for(let c=0;c<o;++c){const f=Xp(c,s,a),h=new Array(f.length);for(let p=0;p<h.length;p++)h[p]=f[r[p]];const d=ba(h,s,u);l[d]=e[c]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xi(e){const{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{perm:s}=n;Ne(i,"transpose");const o=i.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=i.shape[s[f]];const u=r.data.get(i.dataId).values,l=W5(u,i.shape,i.dtype,s,a);return{dataId:r.write(l,a,i.dtype),shape:a,dtype:i.dtype}}const FNe={kernelName:Vd,backendName:"cpu",kernelFunc:Xi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ese(e,t,n,r){const[i,s]=yr(e,r),o=Hi(t,"int32"),a=Ir(ce(i),o),u=ce(s);for(let l=0;l<a.length;++l){const c=l*u;let f=1;for(let h=0;h<u;++h)f*=n[c+h];a[l]=f}return{outVals:a,outShape:i,outDtype:o}}function ONe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Ne(i,"prod");const a=i.shape.length,u=dt(s,i.shape),l=Tn(u,a);let c=u,f=i;const h=[];l!=null&&(f=Xi({inputs:{x:i},backend:n,attrs:{perm:l}}),h.push(f),c=zn(c.length,a));const d=n.data.get(f.dataId).values,{outVals:p,outShape:m,outDtype:g}=Ese(f.shape,f.dtype,d,c);let y=m;return o&&(y=Bn(m,u)),h.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(y,g,p)}const NNe={kernelName:tw,backendName:"cpu",kernelFunc:ONe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MNe(e,t,n){e.forEach((r,i)=>{if(r<0||r>=n){const s=Xp(i,t.length,Ue(t)).join(",");throw new Error(`indices[${s}] = ${r} is not in [0, ${n})`)}})}function RNe(e,t){for(let n=0;n<e.length;++n){const r=e[n],i=n===e.length-1?t:e[n+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let s=1;s<r.length;++s)if(r[s-1]>r[s])throw new Error("Ragged splits must be sorted in ascending order")}}function PNe(e,t,n,r){const i=[];let s=0;const o=t.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);RNe(n,r);let u=1;for(let l=0;l<t.length-1;++l){u*=t[l];const c=t[l+1];for(let f=1;f<u+1;++f)a[l].push(f*c)}for(let l=0;l<e.length;++l){let c=e[l],f=e[l]+1;for(let h=0;h<n.length;++h){const d=n[h],p=h+t.length-1;if(p>=0){const m=a[p],g=m[m.length-1]-d[c];for(let y=c;y<f;++y)a[p].push(d[y+1]+g)}c=d[c],f=d[f]}f!==c&&(i.push([c,f]),s+=f-c)}return{outSplits:a,valueSlices:i,numValues:s}}function LNe(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n].length,i=Fn("int32",r);t.push(i),e[n].forEach((s,o)=>i[o]=s)}return t}function qV(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function BNe(e,t,n,r,i,s){const o=qV(t,2)[1],a=qV(s,2)[1];let u=0;for(const l of n)for(let c=l[0];c<l[1];++c){for(let f=0;f<r;++f)i[u*a+f]=e[c*o+f];++u}}function zNe(e,t,n,r,i){const s=t.slice();s[0]=i;const o=Fn(n,ce(s)),a=e.length,u=a===0?0:a/t[0];return BNe(e,t,r,u,o,s),[o,s]}function Ase(e,t,n,r,i,s,o,a){if(e.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const u=t[0][0]-1;if(MNe(s,o,u),r.length===0)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:f,numValues:h}=PNe(s,o,e,l),d=LNe(c),p=zNe(n,r,i,f,h);return[d,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XV=2147483647;function Tse(e,t,n,r,i,s,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=t.length===0,u=i.length===0,l=o.length===0,c=[];a||c.push(t[0]),u||c.push(i[0]),l||c.push(o[0]);for(let g=1;g<c.length;++g)if(c[g]!==c[g-1])throw new Error("starts, limits, and deltas must have the same shape");const f=c.length===0?1:c[0],h=Fn("int32",f+1);h[0]=0;for(let g=0;g<f;++g){const y=a?e[0]:e[g],b=u?r[0]:r[g],x=l?s[0]:s[g];if(x===0)throw new Error("Requires delta != 0");let v;if(x>0&&b<y||x<0&&b>y)v=0;else if(v=Math.ceil(Math.abs((b-y)/x)),v>XV)throw new Error(`Requires ((limit - start) / delta) <= ${XV}`);h[g+1]=h[g]+v}const d=h[f],p=Fn(n,d);let m=0;for(let g=0;g<f;++g){const y=h[g+1]-h[g];let b=a?e[0]:e[g];const x=l?s[0]:s[g];for(let v=0;v<y;++v)p[m++]=b,b+=x}return[h,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lo=aa;class U${constructor(t,n,r,i,s,o,a,u,l,c){this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=i,this.valuesDType=s,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=pne(c),this.raggedRank=gne(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===lo.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===lo.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case lo.VALUE_ROWIDS:return U$.getMaxWidthValueRowID(n);case lo.ROW_SPLITS:return U$.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${lo[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const n=t.length;if(n===0||n===1)return 0;let r=0;for(let i=0;i<n-1;++i){const s=t[i+1]-t[i];s>r&&(r=s)}return r}static getMaxWidthValueRowID(t){const n=t.length;if(n===0)return 0;let r=0,i=t[0],s=0;for(let o=1;o<n;++o){const a=t[o];a!==i&&(i=a,s=Math.max(o-r,s),r=o)}return Math.max(n-r,s)}tensorShapeFromTensor(t,n,r=!0){if(n.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return KV(t,r)}calculateOutputSize(t){const n=this.valuesShape,r=this.defaultValueShape;mne(r,n);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=dne(this.raggedRank,i,n);o[0]<0&&(o[0]=t);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(t,n,r){const i=Math.min(t,r),s=[];let o=0;for(let a=0;a<i;++a,o+=n)s.push(o);for(let a=i;a<t;++a)s.push(-1);return z(s.length===t,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(t,n,r,i){const s=t.length,o=[];for(let a=0;a<s-1;++a){const u=t[a+1]-t[a];let l=Math.min(i,u),c=n[a];c===-1&&(l=0);for(let f=0;f<l;++f)o.push(c),c+=r;for(let f=0;f<u-l;++f)o.push(-1)}if(s>0&&o.length!==t[s-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(t,n,r,i){const s=t.length,o=[];if(s===0)return[];let a=0,u=t[0];if(u>=n.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${n.length}`);let l=n[u];o.push(l);for(let c=1;c<s;++c){const f=t[c];if(f===u)l>=0&&(++a,a<i?l+=r:l=-1);else{if(a=0,u=f,f>=n.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${n.length}`);l=n[f]}o.push(l)}if(o.length!==t.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(t,n,r,i){const s=this.getRowPartitionTensor(t),o=this.getRowPartitionTypeByDimension(t);switch(o){case lo.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,n,r,i);case lo.ROW_SPLITS:if(s.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(s,n,r,i);default:throw new Error(`Unsupported partition type: ${lo[o]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case lo.FIRST_DIM_SIZE:return t[0];case lo.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case lo.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${lo[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),r=this.calculateOutputSize(n),i=new Array(this.raggedRank+1);i[i.length-1]=1;for(let u=i.length-2;u>=0;--u)i[u]=i[u+1]*r[u+1];const s=KV(r,!1),o=Fn(this.valuesDType,ce(s));if(i[0]*r[0]>0){let u=this.calculateFirstParentOutputIndex(n,i[0],r[0]);for(let l=1;l<=this.raggedRank;++l)u=this.calculateOutputIndex(l-1,u,i[l],r[l]);this.setOutput(this.raggedRank,u,o,s)}return[s,o]}setOutput(t,n,r,i){if(r.length===0)return;const s=this.values,o=r;let a=i.slice();a=a.slice(t+1);const u=ce(a),l=n.length;let c=this.defaultValue;if(c.length!==u&&c.length!==1){const p=this.defaultValueShape;ue(()=>{const m=ne(c,p);c=bm(m,a).dataSync()})}let f=0,h=0,d=0;for(let p=0;p<=l;++p){let m=p<l?n[p]:-1;if(m===d){++d;continue}if(h<d){const g=s.subarray(f*u),y=o.subarray(h*u),b=(d-h)*u;YV(y,g,b)}if(p>=l){const g=r.length;m=Math.floor(g/u)}if(m>d)if(this.defaultValue.length===1)o.subarray(d*u,m*u).fill(this.defaultValue[0]),d=m;else for(;m>d;){const g=o.slice(d*u);YV(g,c,u),++d}m<0?(f=p+1,h=d):(f=p,h=d,d=h+1)}}}function YV(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function KV(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function Dse(e,t,n,r,i,s,o,a,u,l){return new U$(e,t,n,r,i,s,o,a,u,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(e,t,n,r){const i=e===t,s=e<t&&n<0,o=t<e&&n>1;if(i||s||o)return Ir(0,r);const a=Math.abs(Math.ceil((t-e)/n)),u=Ir(a,r);t<e&&n===1&&(n=-1),u[0]=e;for(let l=1;l<u.length;l++)u[l]=u[l-1]+n;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fse=Xu(e=>1/Math.sqrt(e)),jNe=Sh(m1,Fse),UNe={kernelName:m1,backendName:"cpu",kernelFunc:jNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Od(e,t,n,r,i,s,o,a,u,l){const c=[r/i,i],f=e.values,h=t.values;if(r===0)return ft(n,t.dtype);const d=u instanceof Gn?u:ft(c,t.dtype);typeof u=="string"||typeof u=="number"?d.values.fill(u):typeof u=="boolean"&&d.values.fill(+u);for(let p=0;p<s;p++){const m=[];let g=0;for(let y=0;y<o;y++){const b=f[p*o+y];m.push(b),g+=b*a[y]}if(g<0||g>=r/i)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let y=0;y<i;y++)l?d.values[g*i+y]+=h[p*i+y]:d.values[g*i+y]=t.rank===0?h[0]:h[p*i+y]}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WNe=Xu(e=>1/(1+Math.exp(-e))),Ose=qt(w1,e=>1/(1+Math.exp(-e))),VNe={kernelName:w1,backendName:"cpu",kernelFunc:Ose};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(e,t,n,r,i){const s=YB(r,t,n),o=ce(n),a=Ue(r);if(s){const f=KB(t,a);return i==="string"?e.slice(f,f+o):e.subarray(f,f+o)}const u=i==="string"?tc(e):e,l=ft(r,i,u),c=ft(n,i);for(let f=0;f<c.size;++f){const h=c.indexToLoc(f),d=h.map((p,m)=>p+t[m]);c.set(l.get(...d),...h)}return i==="string"?Rne(c.values):c.values}function mp(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,size:o}=r;Ne(i,"slice");const[a,u]=iD(i,s,o);qB(i,a,u);const l=n.data.get(i.dataId).values,c=Nse(l,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,c)}const GNe={kernelName:aw,backendName:"cpu",kernelFunc:mp};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(e,t,n,r,i,s,o){const a=t[0],u=s[0],l=new Array(u),c=new Array(a),f=t[1];if(u===0){if(a!==0)throw new Error(Sne(a));const g=Fn(n,0),y=Fn(i,0);return[g,[0,f],y,l,c]}let h=!0,d=0;const p=new Array(u).fill(0);for(let g=0;g<a;++g){const y=e[g*f];if(y<0)throw new Error(_ne(g,y));if(y>=u)throw new Error($ne(g,y,u));++p[y],h=h&&y>=d,d=y}let m=!0;for(let g=0;g<u;++g){const y=p[g]===0;l[g]=y,m=m&&!y,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&h){const g=e,y=r;for(let b=0;b<a;++b)c[b]=b;return[g,[a,f],y,l,c]}else{const g=p[u-1],y=Fn(n,g*f),b=Fn(i,g),x=new Array(u).fill(0);for(let v=0;v<a;++v){const w=e[v*f],C=x[w],S=(w===0?0:p[w-1])+C;x[w]++;for(let _=0;_<f;++_)y[S*f+_]=e[v*f+_];b[S]=r[v],c[v]=S}for(let v=0;v<u;++v)if(x[v]===0){const C=v===0?0:p[v-1];y[C*f+0]=v;for(let S=1;S<f;++S)y[C*f+S]=0;b[C]=o}return[y,[g,f],b,l,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rse(e,t,n,r,i){const s=ce(r),o=t[0],a=i.length,u=[];let l=1,c=-1;for(let g=0;g<a;++g){const y=i[g];if(y===-1){if(c!==-1)throw new Error(kne(c,g));c=g,u.push(1)}else{if(y<0)throw new Error(Ene(g,y));l*=y,u.push(y)}}if(c!==-1){if(l<=0)throw new Error(Ane());const g=Math.trunc(s/l);if(l*g!==s)throw new Error(Tne(r,u));u[c]=g}if(ce(u)!==s)throw new Error(Dne(r,u));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let g=h-2;g>=0;--g)d[g]=d[g+1]*r[g+1]}const p=[];if(a>0){p[a-1]=1;for(let g=a-2;g>=0;--g)p[g]=p[g+1]*u[g+1]}const m=Fn(n,o*a);for(let g=0;g<o;++g){let y=0;for(let b=0;b<h;++b)y+=e[g*h+b]*d[b];for(let b=0;b<a;++b)m[g*a+b]=Math.trunc(y/p[b]),y%=p[b]}return[m,[o,a],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5(e,t,n,r,i,s=!1,o=0){const a=r.length,u=[t[0],e.length/t[0]],l=u[1],f=a>0?i[a-1]+1:0;if(f<0)throw new Error(VM());const h=t.slice();h[0]=f;const d=h.reduce((x,v)=>x*v,1),p=Fn(n,d);if(a===0)return f>0&&p.fill(o),[p,h];if(f<=0)throw new Error(VM());let m=0,g=1,y=0,b=i[m];for(;;){let x=0;if(g<a){if(x=i[g],b===x){++g;continue}if(b>=x)throw new Error(Ine())}if(b<0||b>=f)throw new Error(Fne(b,f));b>y&&p.fill(o,y*l,b*l);for(let v=m;v<g;++v){const w=r[v];if(w<0||w>=u[0])throw new Error(One(v,r[v],u[0]));for(let C=0;C<l;C++)p[b*l+C]+=e[w*l+C]}if(s)for(let v=0;v<l;v++)p[b*l+v]/=g-m;if(m=g,++g,y=b+1,b=x,g>a)break}return y<f&&p.fill(o,y*l,f*l),[p,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HNe=Xu(e=>Math.sqrt(e)),qNe=qt(S1,e=>Math.sqrt(e)),XNe={kernelName:S1,backendName:"cpu",kernelFunc:qNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pse=Un((e,t)=>{const n=e-t;return n*n}),YNe=rr(_1,Pse),KNe={kernelName:_1,backendName:"cpu",kernelFunc:YNe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse=Xu((e,t)=>{const{pattern:n,replaceGlobal:r,rewrite:i}=t;return e.replace(new RegExp(n,r?"g":""),i)}),ZNe=Sh(hw,Lse),JNe={kernelName:hw,backendName:"cpu",kernelFunc:ZNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse(e,t,n,r){const i=ft(e,t.dtype);for(let s=0;s<i.size;s++){const o=i.indexToLoc(s),a=new Array(o.length);for(let u=0;u<a.length;u++)a[u]=o[u]*n[u]+r[u];i.set(t.get(...a),...o)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QNe{constructor(t,n,r,i,s,o){this.separator=gu(t),this.nGramWidths=n,this.leftPad=gu(r),this.rightPad=gu(i),this.padWidth=s,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,n){const r=this.getPadWidth(n);return Math.max(0,t+2*r-n+1)}createNGrams(t,n,r,i,s,o){for(let a=0;a<s;++a){const u=this.getPadWidth(o),l=Math.max(0,u-a),c=Math.max(0,u-(s-(a+1))),f=o-(l+c),h=n+(l>0?0:a-u);let d=0;d+=l*this.leftPad.length;for(let b=0;b<f;++b)d+=t[h+b].length;d+=c*this.rightPad.length;const p=l+c+f-1;d+=p*this.separator.length,r[i+a]=new Uint8Array(d);const m=r[i+a];let g=0;const y=b=>b.forEach(x=>m[g++]=x);for(let b=0;b<l;++b)y(this.leftPad),y(this.separator);for(let b=0;b<f-1;++b)y(t[h+b]),y(this.separator);if(f>0){y(t[h+f-1]);for(let b=0;b<c;++b)y(this.separator),y(this.rightPad)}else{for(let b=0;b<c-1;++b)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(t,n){const r=t.length,i=n.length;if(i>0){let u=n[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let l=1;l<i;++l){let c=n[l]>=u;if(c=c&&n[l]<=r,!c)throw new Error(`Invalid split value ${n[l]}, must be in [${u}, ${r}]`);u=n[l]}if(u!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${u}`)}const s=i-1,o=Fn("int32",i);if(r===0||i===0){const u=new Array(r);for(let l=0;l<=s;++l)o[l]=0;return[u,o]}o[0]=0;for(let u=1;u<=s;++u){const l=n[u]-n[u-1];let c=0;this.nGramWidths.forEach(f=>{c+=this.getNumNGrams(l,f)}),this.preserveShort&&l>0&&c===0&&(c=1),o[u]=o[u-1]+c}const a=new Array(o[s]);for(let u=0;u<s;++u){const l=n[u];let c=o[u];if(this.nGramWidths.forEach(f=>{const h=n[u+1]-n[u],d=this.getNumNGrams(h,f);this.createNGrams(t,l,a,c,d,f),c+=d}),this.preserveShort&&c===o[u]){const f=n[u+1]-n[u];if(f===0)continue;const h=f+2*this.padWidth,d=1;this.createNGrams(t,l,a,c,d,h)}}return[a,o]}}function zse(e,t,n,r,i,s,o,a){return new QNe(n,r,i,s,o,a).compute(e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e3e(e,t,n,r){if(!e.length)return;if(t.length===0){for(let s=0;s<e.length;++s)r.push(e.subarray(s,s+1));return}if(t.length===1){const s=t[0];let o=e.indexOf(s);for(;o!==-1;){const a=e.subarray(0,o);(!n||a.length!==0)&&r.push(a),e=e.subarray(o+1),o=e.indexOf(s)}(!n||e.length!==0)&&r.push(e);return}let i=0;for(let s=0;s<e.length+1;s++)if(s===e.length||t.indexOf(e[s])!==-1){const o=e.subarray(i,s);(!n||o.length!==0)&&r.push(o),i=s+1}}function jse(e,t,n){const r=e.length,i=[];let s=0,o=0;const a=new Array(r);for(let h=0;h<r;++h){const d=i.length;e3e(e[h],t,n,i);const p=i.length-d;a[h]=p,s+=p,o=Math.max(o,p)}const u=Fn("int32",s*2),l=new Array(s),c=[r,o];let f=0;for(let h=0;h<r;++h)for(let d=0;d<a[h];++d)u[f*2]=h,u[f*2+1]=d,l[f]=i[f],++f;return[u,l,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(e,t){const n=Fn("int32",e.length);for(let r=0;r<e.length;++r)n[r]=pee(e[r]).modulo(t).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wse=Un((e,t)=>e-t),t3e=z5((e,t,n,r)=>({real:e-n,imag:t-r})),G5=rr($1,Wse,t3e),n3e={kernelName:$1,backendName:"cpu",kernelFunc:G5};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vse(e,t){const n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=e.shape[i]*t[i];const r=ft(n,e.dtype);for(let i=0;i<r.values.length;++i){const s=r.indexToLoc(i),o=new Array(e.rank);for(let u=0;u<o.length;u++)o[u]=s[u]%e.shape[u];const a=e.locToIndex(o);r.values[i]=e.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vb=(e,t)=>{const n=t.value-e.value;return n===0?e.index-t.index:n};function Gse(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,u=t-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(a-c)/a)*Math.sign(u-a/2),h=Math.max(n,Math.floor(t-u*c/a+f)),d=Math.min(r,Math.floor(t+(a-u)*c/a+f));Gse(e,t,h,d)}const i=e[t];let s=n,o=r;for(Tl(e,n,t),vb(e[r],i)>0&&Tl(e,n,r);s<o;){for(Tl(e,s,o),s++,o--;vb(e[s],i)<0;)s=s+1;for(;vb(e[o],i)>0;)o=o-1}vb(e[n],i)===0?Tl(e,n,o):(o=o+1,Tl(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}}function Hse(e,t,n,r,i){const s=t[t.length-1],[o,a]=[e.length/s,s],u=gr(n,o*r),l=gr("int32",o*r);for(let f=0;f<o;f++){const h=f*a,d=e.subarray(h,h+a);let p=new Array(d.length);d.forEach((b,x)=>p[x]={value:b,index:x}),r<p.length&&(Gse(p,r),p=p.slice(0,r)),i&&p.sort(vb);const m=f*r,g=u.subarray(m,m+r),y=l.subarray(m,m+r);for(let b=0;b<r;b++)g[b]=p[b].value,y[b]=p[b].index}const c=t.slice();return c[c.length-1]=r,[ft(c,n,u),ft(c,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(e,t,n,r){const i=dt(t,n)[0],s=[1,n[0],1];for(let p=0;p<i;p++)s[0]*=n[p];s[1]=n[i];for(let p=i+1;p<n.length;p++)s[2]*=n[p];const o=new Map,a=new Int32Array(n[i]),u=new Gn(s,r,e),l=[],c=s[0]===1&&s[2]===1;for(let p=0;p<n[i];p++){let m;if(c)m=e[p].toString();else{const y=[];for(let b=0;b<s[0];b++)for(let x=0;x<s[2];x++)y.push(u.get(b,p,x));m=y.join(",")}const g=o.get(m);if(g!=null)a[p]=g;else{const y=o.size;o.set(m,y),a[p]=y,l.push(p)}}const f=s.slice();f[1]=o.size;const h=new Gn(f,r);l.forEach((p,m)=>{for(let g=0;g<s[0];g++)for(let y=0;y<s[2];y++)h.set(u.get(g,p,y),g,m,y)});const d=n.slice();return d[i]=f[1],{outputValues:h.values,outputShape:d,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r3e=Object.freeze(Object.defineProperty({__proto__:null,addImpl:nse,bincountImpl:j5,bincountReduceImpl:rse,bitwiseAndImpl:ise,castImpl:tse,ceilImpl:sse,concatImpl:ose,equalImpl:ase,expImpl:lse,expm1Impl:fse,floorDivImpl:dse,floorImpl:hse,gatherNdImpl:pse,gatherV2Impl:gse,greaterEqualImpl:yse,greaterImpl:mse,lessEqualImpl:vse,lessImpl:bse,linSpaceImpl:xse,logImpl:wse,maxImpl:Cse,maximumImpl:Sse,minimumImpl:_se,multiplyImpl:U5,negImpl:$se,notEqualImpl:kse,prodImpl:Ese,raggedGatherImpl:Ase,raggedRangeImpl:Tse,raggedTensorToTensorImpl:Dse,rangeImpl:Ise,rsqrtImpl:Fse,scatterImpl:Od,sigmoidImpl:WNe,simpleAbsImpl:ese,sliceImpl:Nse,sparseFillEmptyRowsImpl:Mse,sparseReshapeImpl:Rse,sparseSegmentReductionImpl:V5,sqrtImpl:HNe,squaredDifferenceImpl:Pse,staticRegexReplaceImpl:Lse,stridedSliceImpl:Bse,stringNGramsImpl:zse,stringSplitImpl:jse,stringToHashBucketFastImpl:Use,subImpl:Wse,tileImpl:Vse,topKImpl:Hse,transposeImpl:W5,uniqueImpl:qse},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J4("cpu",()=>new bD,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xse=qt(X0,e=>e>=0?e:Math.exp(e)-1),i3e={kernelName:X0,backendName:"cpu",kernelFunc:Xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yse(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:s}=r;Ne([i],"leakyRelu");const o=ce(i.shape),a=n.data.get(i.dataId).values,u=gr("float32",o);for(let l=0;l<a.length;l++)u[l]=a[l]<0?s*a[l]:a[l];return n.makeTensorInfo(i.shape,"float32",u)}const s3e={kernelName:M2,backendName:"cpu",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o3e=Un((e,t)=>e<0?t*e:e);function Kse(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t;Ne([r,i],"prelu");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[a,u]=o3e(r.shape,i.shape,s,o,"float32");return n.makeTensorInfo(u,"float32",a)}const a3e={kernelName:ew,backendName:"cpu",kernelFunc:Kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zse=qt(d1,e=>Math.max(0,e)),u3e={kernelName:d1,backendName:"cpu",kernelFunc:Zse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jse=qt(p1,e=>Math.min(Math.max(0,e),6)),l3e={kernelName:p1,backendName:"cpu",kernelFunc:Jse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W$(e,t,n,r,i){if(n==="linear")return Ou({inputs:{x:t},backend:e});if(n==="relu")return Zse({inputs:{x:t},backend:e});if(n==="elu")return Xse({inputs:{x:t},backend:e});if(n==="relu6")return Jse({inputs:{x:t},backend:e});if(n==="prelu")return Kse({inputs:{x:t,alpha:r},backend:e});if(n==="leakyrelu")return Yse({inputs:{x:t},backend:e,attrs:{alpha:i}});if(n==="sigmoid")return Ose({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function an(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:s}=r,o=ce(i.shape),a=L4(s,o),u=ce(a);z(o===u,()=>`The new shape (${a}) has ${u} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const l=n.data.get(i.dataId);if(l.complexTensorInfos!=null){const c=l.complexTensorInfos.real,f=l.complexTensorInfos.imag;c.shape=a,f.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const c3e={kernelName:nw,backendName:"cpu",kernelFunc:an};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qse(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s}=t,{transposeA:o,transposeB:a}=r;Ne([i,s],"matMul");const u=i.shape.length,l=s.shape.length,c=o?i.shape[u-2]:i.shape[u-1],f=a?s.shape[l-1]:s.shape[l-2],h=o?i.shape[u-1]:i.shape[u-2],d=a?s.shape[l-2]:s.shape[l-1],p=i.shape.slice(0,-2),m=s.shape.slice(0,-2),g=ce(p),y=ce(m),x=rt(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([h,d]);z(c===f,()=>`Error in matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${o} and transposeB=${a} must match.`);const v=o?[g,c,h]:[g,h,c],w=a?[y,d,f]:[y,f,d],C=an({inputs:{x:i},backend:n,attrs:{shape:v}}),S=an({inputs:{x:s},backend:n,attrs:{shape:w}}),_=o?C.shape[1]:C.shape[2],$=o?C.shape[2]:C.shape[1],k=a?S.shape[1]:S.shape[2],E=Math.max(g,y),F=n.data.get(C.dataId).values,T=n.data.get(S.dataId).values,I=Ue(C.shape),D=Ue(S.shape),[N,V,U]=o?[I[0],1,I[1]]:[I[0],I[1],1],[A,M,P]=a?[1,D[1],D[0]]:[D[1],1,D[0]],j=$*k,q=ft([E,$,k],C.dtype),B=q.values,O=n.blockSize;for(let G=0;G<E;G++){const Z=G%g,re=G%y;for(let R=0;R<$;R+=O){const H=Math.min(R+O,$);for(let Y=0;Y<k;Y+=O){const L=Math.min(Y+O,k);for(let te=0;te<_;te+=O){const X=Math.min(te+O,_);for(let ie=R;ie<H;ie++)for(let se=Y;se<L;se++){let oe=0;for(let le=te;le<X;le++){const Ce=F[Z*N+ie*V+le*U],Me=T[le*A+se*M+re*P];oe+=Ce*Me}B[G*j+(ie*k+se)]+=oe}}}}}return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(S),n.makeTensorInfo(x,q.dtype,q.values)}const f3e={kernelName:v2,backendName:"cpu",kernelFunc:Qse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h3e(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s,bias:o,preluActivationWeights:a}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:f}=r;let h,d,p;const m=[];h=Qse({inputs:{a:i,b:s},attrs:{transposeA:u,transposeB:l},backend:n}),o&&(d=zm({inputs:{a:h,b:o},backend:n}),m.push(h),h=d),c&&(p=W$(n,h,c,a,f),m.push(h),h=p);for(const y of m)n.disposeIntermediateTensorInfo(y);return h}const d3e={kernelName:$v,backendName:"cpu",kernelFunc:h3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p3e=qt(M0,e=>Math.acos(e)),g3e={kernelName:M0,backendName:"cpu",kernelFunc:p3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m3e=qt(R0,e=>Math.acosh(e)),y3e={kernelName:R0,backendName:"cpu",kernelFunc:m3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b3e(e){const{inputs:t,backend:n}=e,r=t;Ne(t,"addN");const i=r.map(a=>n.data.get(a.dataId).values),s=ft(r[0].shape,r[0].dtype),o=s.values;for(let a=0;a<r.length;a++){const u=i[a];for(let l=0;l<o.length;l++)o[l]+=u[l]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}const v3e={kernelName:p2,backendName:"cpu",kernelFunc:b3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Ne(i,"all");const a=dt(s,i.shape);let u=a;const l=Tn(u,i.shape.length);let c=i;l!=null&&(c=Xi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=zn(u.length,i.shape.length)),Rr("all",u,c.shape.length);const[f,h]=yr(c.shape,u),d=ce(h),p=Ir(ce(f),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let x=m[b];for(let v=0;v<d;++v){const w=m[b+v];x=x&&w}p[y]=x}l!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Bn(f,a),b=an({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),b}return g}const w3e={kernelName:SA,backendName:"cpu",kernelFunc:x3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Ne(i,"any");const a=dt(s,i.shape);let u=a;const l=Tn(u,i.shape.length);let c=i;l!=null&&(c=Xi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=zn(u.length,i.shape.length)),Rr("any",u,c.shape.length);const[f,h]=yr(c.shape,u),d=ce(h),p=Ir(ce(f),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let x=m[b];for(let v=0;v<d;++v){const w=m[b+v];x=x||w}p[y]=x}l!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Bn(f,a),b=an({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),b}return g}const S3e={kernelName:_A,backendName:"cpu",kernelFunc:C3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;Ne(i,"argMax");let o=dt(s,i.shape);const a=Tn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Xi({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=zn(o.length,u.shape.length)),o=[o[0]],Rr("argMax",o,u.shape.length);const[c,f]=yr(u.shape,o),h=ce(c),d=Ir(h,"int32"),p=ce(f),m=n.data.get(u.dataId).values;for(let g=0;g<d.length;++g){const y=g*p;let b=m[y],x=0;for(let v=0;v<p;++v){const w=m[y+v];w>b&&(b=w,x=v)}d[g]=x}return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(c,"int32",d)}const $3e={kernelName:g2,backendName:"cpu",kernelFunc:_3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;Ne(i,"argMin");let o=dt(s,i.shape);const a=Tn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Xi({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=zn(o.length,u.shape.length)),o=[o[0]],Rr("argMin",o,u.shape.length);const[c,f]=yr(u.shape,o),h=ce(c),d=Ir(h,"int32"),p=ce(f),m=n.data.get(u.dataId).values;for(let g=0;g<d.length;++g){const y=g*p;let b=m[y],x=0;for(let v=0;v<p;++v){const w=m[y+v];w<b&&(b=w,x=v)}d[g]=x}return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(c,"int32",d)}const E3e={kernelName:m2,backendName:"cpu",kernelFunc:k3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A3e=qt(P0,e=>Math.asin(e)),T3e={kernelName:P0,backendName:"cpu",kernelFunc:A3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D3e=qt(L0,e=>Math.asinh(e)),I3e={kernelName:L0,backendName:"cpu",kernelFunc:D3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F3e=qt(B0,e=>Math.atan(e)),O3e={kernelName:B0,backendName:"cpu",kernelFunc:F3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N3e=Un((e,t)=>Math.atan2(e,t)),M3e=rr(j0,N3e),R3e={kernelName:j0,backendName:"cpu",kernelFunc:M3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P3e=qt(z0,e=>Math.atanh(e)),L3e={kernelName:z0,backendName:"cpu",kernelFunc:P3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(e,t,n,r,i,s){const o=i.strideHeight,a=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=i.padInfo.top,d=i.padInfo.left,p=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=ft(i.outShape,n),g=m.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],x=i.outShape[3];for(let v=0;v<i.batchSize;++v){const w=v*y,C=v*r[0];for(let S=0;S<i.inChannels;++S)for(let _=0;_<i.outHeight;++_){const $=_*o-h,k=Math.max(0,$),E=Math.min(i.inHeight,c+$),F=w+_*b;for(let T=0;T<i.outWidth;++T){const I=T*a-d,D=Math.max(0,I),N=Math.min(i.inWidth,f+I);let V=p,U=0,A=0;for(let P=k;P<E;P+=u){const j=C+P*r[1];for(let q=D;q<N;q+=l){const B=j+q*r[2],O=e[B+S];s==="max"&&O>V?V=O:s==="avg"&&(U+=O,A++)}if(isNaN(V))break}const M=F+T*x+S;g[M]=s==="avg"?U/A:V}}}return m}function eoe(e,t,n,r,i=!1,s=!1){const o=ft(r.outShape,"int32"),a=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,m=ft(t,n,e);for(let g=0;g<r.batchSize;++g)for(let y=0;y<r.inChannels;++y)for(let b=0;b<r.outHeight;++b){const x=b*a-d;let v=x;for(;v<0;)v+=l;const w=Math.min(r.inHeight,f+x);for(let C=0;C<r.outWidth;++C){const S=C*u-p;let _=S;for(;_<0;)_+=c;const $=Math.min(r.inWidth,h+S);let k=Number.NEGATIVE_INFINITY,E=-1;for(let F=v;F<w;F+=l){const T=F-x;for(let I=_;I<$;I+=c){const D=I-S,N=m.get(g,F,I,y);N>k&&(k=N,i?E=s?((g*r.inHeight+F)*r.inWidth+I)*r.inChannels+y:(F*r.inWidth+I)*r.inChannels+y:E=T*h+D)}}o.set(E,g,b,C,y)}}return o}function toe(e,t,n,r,i,s){const o=i.strideDepth,a=i.strideHeight,u=i.strideWidth,l=i.dilationDepth,c=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,d=i.effectiveFilterHeight,p=i.effectiveFilterWidth,m=i.padInfo.front,g=i.padInfo.top,y=i.padInfo.left,b=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=ft(i.outShape,n),v=x.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],C=i.outShape[2]*i.outShape[3]*i.outShape[4],S=i.outShape[3]*i.outShape[4],_=i.outShape[4];for(let $=0;$<i.batchSize;++$){const k=$*w,E=$*r[0];for(let F=0;F<i.inChannels;++F)for(let T=0;T<i.outDepth;++T){const I=T*o-m;let D=I;for(;D<0;)D+=l;const N=Math.min(i.inDepth,h+I),V=k+T*C;for(let U=0;U<i.outHeight;++U){const A=U*a-g;let M=A;for(;M<0;)M+=c;const P=Math.min(i.inHeight,d+A),j=V+U*S;for(let q=0;q<i.outWidth;++q){const B=q*u-y;let O=B;for(;O<0;)O+=f;const G=Math.min(i.inWidth,p+B),Z=j+q*_;let re=b,R=0,H=0;for(let L=D;L<N;L+=l){const te=E+L*r[1];for(let X=M;X<P;X+=c){const ie=te+X*r[2];for(let se=O;se<G;se+=f){const oe=ie+se*r[3],le=e[oe+F];if(s==="max"&&le>re?re=le:s==="avg"&&(R+=le,H++),isNaN(re))break}if(isNaN(re))break}if(isNaN(re))break}const Y=Z+F;v[Y]=s==="avg"?R/Math.max(H,1):re}}}}return x}function B3e(e,t){const n=ft(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,s=t.strideWidth,o=t.dilationDepth,a=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let y=0;y<t.outDepth;++y){const b=y*r-h;let x=b;for(;x<0;)x+=o;const v=Math.min(t.inDepth,l+b);for(let w=0;w<t.outHeight;++w){const C=w*i-d;let S=C;for(;S<0;)S+=a;const _=Math.min(t.inHeight,c+C);for(let $=0;$<t.outWidth;++$){const k=$*s-p;let E=k;for(;E<0;)E+=u;const F=Math.min(t.inWidth,f+k);let T=Number.NEGATIVE_INFINITY,I=-1;for(let D=x;D<v;D+=o){const N=D-b;for(let V=S;V<_;V+=a){const U=V-C;for(let A=E;A<F;A+=u){const M=A-k,P=e.get(m,D,V,A,g);P>=T&&(T=P,I=N*c*f+U*c+M)}}}n.set(I,m,y,w,$,g)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Ne(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;z(Mr(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=jo(i.shape,s,o,l,a,u);let f;if(c.filterWidth===1&&c.filterHeight===1&&_t(c.inShape,c.outShape))f=Ou({inputs:{x:i},backend:n});else{const h=n.data.get(i.dataId).values,d=Ue(i.shape),p=H5(h,i.shape,i.dtype,d,c,"avg");f=n.makeTensorInfo(c.outShape,i.dtype,p.values)}return f}const j3e={kernelName:y2,backendName:"cpu",kernelFunc:z3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r;Ne(i,"avgPool3d");const c=hc(i.shape,s,o,1,a,u,l),f=n.data.get(i.dataId).values,h=toe(f,i.shape,i.dtype,Ue(i.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const W3e={kernelName:b2,backendName:"cpu",kernelFunc:U3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V3e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=r;Ne([i,s],"avgPool3DGrad");const c=hc(s.shape,o,a,1,u,l),f=c.strideDepth,h=c.strideHeight,d=c.strideWidth,p=c.filterDepth,m=c.filterHeight,g=c.filterWidth,y=c.dilationDepth,b=c.dilationHeight,x=c.dilationWidth,v=c.effectiveFilterDepth,w=c.effectiveFilterHeight,C=c.effectiveFilterWidth,S=v-1-c.padInfo.front,_=C-1-c.padInfo.left,$=w-1-c.padInfo.top,k=ft(s.shape,"float32"),E=1/(p*m*g),F=n.bufferSync(i);for(let T=0;T<c.batchSize;++T)for(let I=0;I<c.inChannels;++I)for(let D=0;D<c.inDepth;++D)for(let N=0;N<c.inHeight;++N)for(let V=0;V<c.inWidth;++V){const U=D-S,A=N-$,M=V-_;let P=0;for(let j=0;j<v;j+=y){const q=(U+j)/f;if(!(q<0||q>=c.outDepth||Math.floor(q)!==q))for(let B=0;B<w;B+=b){const O=(A+B)/h;if(!(O<0||O>=c.outHeight||Math.floor(O)!==O))for(let G=0;G<C;G+=x){const Z=(M+G)/d;if(Z<0||Z>=c.outWidth||Math.floor(Z)!==Z)continue;const re=F.get(T,q,O,Z,I);P+=re}}}k.set(P*E,T,D,N,V,I)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const G3e={kernelName:kA,backendName:"cpu",kernelFunc:V3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H3e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s;Ne([i,s],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=r,c=jo(o.shape,a,u,1,l),f=c.strideHeight,h=c.strideWidth,d=c.filterHeight,p=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,y=c.effectiveFilterHeight,b=c.effectiveFilterWidth,x=b-1-c.padInfo.left,v=y-1-c.padInfo.top,w=ft(o.shape,"float32"),C=1/(d*p),S=n.data.get(i.dataId).values,_=ft(i.shape,"float32",S);for(let $=0;$<c.batchSize;++$)for(let k=0;k<c.inChannels;++k)for(let E=0;E<c.inHeight;++E)for(let F=0;F<c.inWidth;++F){const T=E-v,I=F-x;let D=0;for(let N=0;N<y;N+=m){const V=(T+N)/f;if(!(V<0||V>=c.outHeight||Math.floor(V)!==V))for(let U=0;U<b;U+=g){const A=(I+U)/h;if(A<0||A>=c.outWidth||Math.floor(A)!==A)continue;const M=_.get($,V,A,k);D+=M}}w.set(D*C,$,E,F,k)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const q3e={kernelName:$A,backendName:"cpu",kernelFunc:H3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,scale:s,offset:o,mean:a,variance:u}=t;z(a.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ne([i,a,u,s,o],"batchNorm");let{varianceEpsilon:l}=r;l==null&&(l=.001);const c=n.data.get(i.dataId).values,f=n.data.get(a.dataId).values,h=n.data.get(u.dataId).values,d=s?n.data.get(s.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=p.length,y=d.length,b=h.length,x=f.length;let v=0,w=0,C=0,S=0;for(let _=0;_<c.length;++_)m[_]=p[v++]+(c[_]-f[w++])*d[C++]/Math.sqrt(h[S++]+l),v>=g&&(v=0),w>=x&&(w=0),C>=y&&(C=0),S>=b&&(S=0);return n.makeTensorInfo(i.shape,i.dtype,m)}const Y3e={kernelName:F2,backendName:"cpu",kernelFunc:X3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,crops:o}=r;Ne([i],"batchToSpaceND");const a=s.reduce((y,b)=>y*b),u=kw(i.shape,s,a),l=Ew(u.length,s.length),c=Aw(i.shape,s,a),f=n5(o,s.length),h=r5(c,o,s.length),d=an({inputs:{x:i},backend:n,attrs:{shape:u}}),p=Xi({inputs:{x:d},backend:n,attrs:{perm:l}}),m=an({inputs:{x:p},backend:n,attrs:{shape:c}}),g=mp({inputs:{x:m},backend:n,attrs:{begin:f,size:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const Z3e={kernelName:x2,backendName:"cpu",kernelFunc:K3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o}=r,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,l=j5(a,u,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,l)}const Q3e={kernelName:EA,backendName:"cpu",kernelFunc:J3e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eMe(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=rt(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const tMe={kernelName:AA,backendName:"cpu",kernelFunc:eMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nMe=qt(V0,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),rMe={kernelName:V0,backendName:"cpu",kernelFunc:nMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iMe=e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(ce(t.shape)),i=n.data.get(t.dataId),s=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values;for(let l=0;l<a.length;l++){const c=a[l],f=u[l];r[l]=Math.hypot(c,f)}return n.makeOutput(r,t.shape,"float32")},sMe={kernelName:C2,backendName:"cpu",kernelFunc:iMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jm(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const oMe={kernelName:qA,backendName:"cpu",kernelFunc:jm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Um(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,s=dt(i,t[0].shape)[0],o=t.map(m=>m.shape);QB(o,s);let a=yu(t.map(m=>m.shape),s);if(ce(a)===0)return n.makeTensorInfo(a,t[0].dtype,[]);const u=t.filter(m=>ce(m.shape)>0);if(u.length===1)return Ou({inputs:{x:u[0]},backend:n});if(u[0].dtype==="complex64"){const m=u.map(v=>gp({inputs:{input:v},backend:n})),g=u.map(v=>jm({inputs:{input:v},backend:n})),y=Um({inputs:m,backend:n,attrs:{axis:s}}),b=Um({inputs:g,backend:n,attrs:{axis:s}}),x=hs({inputs:{real:y,imag:b},backend:n});return m.forEach(v=>n.disposeIntermediateTensorInfo(v)),g.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),x}const l=u.map(m=>{const y=[-1,ce(m.shape.slice(s))];return an({inputs:{x:m},backend:n,attrs:{shape:y}})}),c=l.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=yu(l.map(m=>m.shape),1);const f=l[0].shape[0]===1,h=ose(c,a,t[0].dtype,f),d=yu(u.map(m=>m.shape),s),p=n.makeTensorInfo(d,t[0].dtype,h);return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const aMe={kernelName:S2,backendName:"cpu",kernelFunc:Um};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=r;Ne([i,s],"conv2d");const f=dc(u),h=mr(i.shape,s.shape,o,l,a,c,!1,f),d=h.filterHeight,p=h.filterWidth,m=h.dilationHeight,g=h.dilationWidth,y=h.padInfo.left,b=h.padInfo.top,x=h.dataFormat==="channelsLast",v=new Gn(h.outShape,i.dtype),w=Ue(i.shape),C=Ue(s.shape),S=w[0],_=x?w[1]:w[2],$=x?w[2]:1,k=x?1:w[1],E=v.strides[0],F=x?v.strides[1]:v.strides[2],T=x?v.strides[2]:1,I=x?1:v.strides[1],D=n.data.get(i.dataId).values,N=n.data.get(s.dataId).values,V=v.values;for(let U=0;U<h.batchSize;++U){const A=U*S,M=U*E;for(let P=0;P<h.outHeight;++P){const j=M+P*F,q=P*h.strideHeight-b;for(let B=0;B<d;++B){const O=q+B*m;if(O<0||O>=h.inHeight)continue;const G=B*C[0],Z=A+O*_;for(let re=0;re<h.outWidth;++re){const R=j+re*T,H=re*h.strideWidth-y;for(let Y=0;Y<p;++Y){const L=H+Y*g;if(L<0||L>=h.inWidth)continue;const te=G+Y*C[1],X=Z+L*$;let ie=te;for(let se=0;se<h.inChannels;++se){const oe=D[X+se*k];for(let le=0;le<h.outChannels;++le)V[R+le*I]+=oe*N[ie+le];ie+=h.outChannels}}}}}}return n.makeTensorInfo(v.shape,v.dtype,V)}const uMe={kernelName:_2,backendName:"cpu",kernelFunc:noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=r;Ne([i,s],"conv2dBackpropFilter");const f=dc(u),h=mr(i.shape,c,o,1,a,l,!1,f),{strideHeight:d,strideWidth:p,filterHeight:m,filterWidth:g}=h,y=h.dataFormat==="channelsLast",b=new Gn(h.filterShape,"float32"),x=h.padInfo.left,v=h.padInfo.top,w=n.data.get(i.dataId).values,C=n.data.get(s.dataId).values,S=new Gn(i.shape,i.dtype,w),_=new Gn(s.shape,s.dtype,C);for(let $=0;$<m;++$){const k=Math.max(0,Math.ceil((v-$)/d)),E=Math.min(h.outHeight,(h.inHeight+v-$)/d);for(let F=0;F<g;++F){const T=Math.max(0,Math.ceil((x-F)/p)),I=Math.min(h.outWidth,(h.inWidth+x-F)/p);for(let D=0;D<h.inChannels;++D)for(let N=0;N<h.outChannels;++N){let V=0;for(let U=0;U<h.batchSize;++U)for(let A=k;A<E;++A){const M=$+A*d-v;for(let P=T;P<I;++P){const j=F+P*p-x;y?V+=S.get(U,M,j,D)*_.get(U,A,P,N):V+=S.get(U,D,M,j)*_.get(U,N,A,P)}}b.set(V,$,F,D,N)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const cMe={kernelName:DA,backendName:"cpu",kernelFunc:lMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fMe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=r;Ne([i,s],"conv2dBackpropInput");const f=Ue(s.shape),h=Ue(i.shape);let d=dc(l);const p=mr(o,s.shape,a,1,u,c,!1,d),m=new Gn(p.inShape,"float32"),g=m.values,y=n.data.get(i.dataId).values,b=n.data.get(s.dataId).values,[x,v,w]=f,{batchSize:C,filterHeight:S,filterWidth:_,inChannels:$,inHeight:k,inWidth:E,outChannels:F,outHeight:T,outWidth:I,strideHeight:D,strideWidth:N}=p;d=p.dataFormat;const V=S-1-p.padInfo.top,U=_-1-p.padInfo.left,A=d==="channelsLast",M=m.strides[0],P=A?m.strides[1]:m.strides[2],j=A?m.strides[2]:1,q=A?1:m.strides[1],B=h[0],O=A?h[1]:h[2],G=A?h[2]:1,Z=A?1:h[1];for(let re=0;re<C;++re)for(let R=0;R<$;++R)for(let H=0;H<k;++H){const Y=H-V,L=Math.max(0,Math.ceil(Y/D)),te=Math.min(T,(S+Y)/D);for(let X=0;X<E;++X){const ie=X-U,se=Math.max(0,Math.ceil(ie/N)),oe=Math.min(I,(_+ie)/N);let le=0;for(let Me=L;Me<te;++Me){const Fe=Me*D-Y;for(let de=se;de<oe;++de){const Re=de*N-ie,qe=B*re+O*Me+G*de,ot=x*(S-1-Fe)+v*(_-1-Re)+w*R;for(let Ft=0;Ft<F;++Ft){const xt=y[qe+Z*Ft],Cn=b[ot+Ft];le+=xt*Cn}}}const Ce=M*re+P*H+j*X+q*R;g[Ce]=le}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const hMe={kernelName:$2,backendName:"cpu",kernelFunc:fMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r;Ne([i,s],"conv3d");const l=mh(i.shape,s.shape,o,u,a),{filterDepth:c,filterHeight:f,filterWidth:h,dilationDepth:d,dilationHeight:p,dilationWidth:m,padInfo:g}=l,y=g.front,b=g.left,x=g.top,v=new Gn(l.outShape,i.dtype),w=n.data.get(i.dataId).values,C=n.data.get(s.dataId).values,S=v.values,_=Ue(i.shape),$=Ue(s.shape);for(let k=0;k<l.batchSize;++k){const E=k*_[0],F=k*v.strides[0];for(let T=0;T<l.outDepth;++T){const I=F+T*v.strides[1],D=T*l.strideDepth-y;for(let N=0;N<c;++N){const V=D+N*d;if(V<0||V>=l.inDepth)continue;const U=N*$[0],A=E+V*_[1];for(let M=0;M<l.outHeight;++M){const P=I+M*v.strides[2],j=M*l.strideHeight-x;for(let q=0;q<f;++q){const B=j+q*p;if(B<0||B>=l.inHeight)continue;const O=U+q*$[1],G=A+B*_[2];for(let Z=0;Z<l.outWidth;++Z){const re=P+Z*l.outChannels,R=Z*l.strideWidth-b;for(let H=0;H<h;++H){const Y=R+H*m;if(Y<0||Y>=l.inWidth)continue;const L=O+H*$[2],te=G+Y*l.inChannels;let X=L;for(let ie=0;ie<l.inChannels;++ie){const se=w[te+ie];for(let oe=0;oe<l.outChannels;++oe)S[re+oe]+=se*C[X+oe];X+=l.outChannels}}}}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const pMe={kernelName:k2,backendName:"cpu",kernelFunc:dMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,filterShape:u}=r;Ne([i,s],"conv3dBackpropFilterV2");const l=Ue(i.shape),c=Ue(s.shape),f=mh(i.shape,u,o,1,a),h=f.strideDepth,d=f.strideHeight,p=f.strideWidth,m=f.filterDepth,g=f.filterHeight,y=f.filterWidth,b=new Gn(f.filterShape,"float32"),x=b.values,[v,w,C,S]=b.strides,_=n.data.get(s.dataId).values,[$,k,E,F]=c,T=n.data.get(i.dataId).values,[I,D,N,V]=l,U=f.padInfo.front,A=f.padInfo.left,M=f.padInfo.top;for(let P=0;P<m;++P){const j=Math.max(0,Math.ceil((U-P)/h)),q=Math.min(f.outDepth,(f.inDepth+U-P)/h),B=P*v;for(let O=0;O<g;++O){const G=Math.max(0,Math.ceil((M-O)/d)),Z=Math.min(f.outHeight,(f.inHeight+M-O)/d),re=O*w+B;for(let R=0;R<y;++R){const H=Math.max(0,Math.ceil((A-R)/p)),Y=Math.min(f.outWidth,(f.inWidth+A-R)/p),L=R*C+re;for(let te=0;te<f.inChannels;++te){const X=te*S+L;for(let ie=0;ie<f.outChannels;++ie){let se=0;for(let oe=0;oe<f.batchSize;++oe){const le=oe*I,Ce=oe*$;for(let Me=j;Me<q;++Me){const de=(P+Me*h-U)*D+le,Re=Me*k+Ce;for(let qe=G;qe<Z;++qe){const Ft=(O+qe*d-M)*N+de,xt=qe*E+Re;for(let Cn=H;Cn<Y;++Cn){const Yo=(R+Cn*p-A)*V+Ft,ml=Cn*F+xt;se+=T[Yo+te]*_[ml+ie]}}}}x[X+ie]=se}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const mMe={kernelName:IA,backendName:"cpu",kernelFunc:gMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yMe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{pad:o,strides:a,inputShape:u}=r;Ne([i],"conv3dBackpropInputV2");const l=Ue(i.shape),c=Ue(s.shape),f=mh(u,s.shape,a,1,o),h=new Gn(f.inShape,"float32"),d=h.values,[p,m,g,y]=h.strides,b=n.data.get(i.dataId).values,[x,v,w,C]=l,S=n.data.get(s.dataId).values,[_,$,k,E]=c,{batchSize:F,filterDepth:T,filterHeight:I,filterWidth:D,inChannels:N,inDepth:V,inHeight:U,inWidth:A,outChannels:M,outDepth:P,outHeight:j,outWidth:q,strideDepth:B,strideHeight:O,strideWidth:G}=f,Z=T-1-f.padInfo.front,re=I-1-f.padInfo.top,R=D-1-f.padInfo.left;for(let H=0;H<F;++H)for(let Y=0;Y<N;++Y)for(let L=0;L<V;++L){const te=L-Z,X=Math.max(0,Math.ceil(te/B)),ie=Math.min(P,(T+te)/B);for(let se=0;se<U;++se){const oe=se-re,le=Math.max(0,Math.ceil(oe/O)),Ce=Math.min(j,(I+oe)/O);for(let Me=0;Me<A;++Me){const Fe=Me-R,de=Math.max(0,Math.ceil(Fe/G)),Re=Math.min(q,(D+Fe)/G);let qe=0;for(let ot=X;ot<ie;++ot){const Ft=ot*B-te;for(let xt=le;xt<Ce;++xt){const Cn=xt*O-oe;for(let ln=de;ln<Re;++ln){const Yo=ln*G-Fe,ml=x*H+v*ot+w*xt+C*ln,ao=_*(T-1-Ft)+$*(I-1-Cn)+k*(D-1-Yo)+E*Y;for(let jg=0;jg<M;++jg){const fS=b[ml+jg],zO=S[ao+jg];qe+=fS*zO}}}}d[p*H+m*L+g*se+y*Me+Y]=qe}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const bMe={kernelName:FA,backendName:"cpu",kernelFunc:yMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vMe=qt(G0,e=>Math.cos(e)),xMe={kernelName:G0,backendName:"cpu",kernelFunc:vMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wMe=qt(H0,e=>Math.cosh(e)),CMe={kernelName:H0,backendName:"cpu",kernelFunc:wMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SMe(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:s,boxInd:o}=t,{cropSize:a,method:u,extrapolationValue:l}=r,[c,f,h,d]=i.shape,p=s.shape[0],[m,g]=a,y=ft([p,m,g,d],"float32"),b=n.data.get(s.dataId).values,x=n.data.get(o.dataId).values,v=n.data.get(i.dataId).values,w=Ue(i.shape),C=Ue(y.shape);for(let S=0;S<p;S++){const _=S*4,$=b[_],k=b[_+1],E=b[_+2],F=b[_+3],T=x[S];if(T>=c)continue;const I=m>1?(E-$)*(f-1)/(m-1):0,D=g>1?(F-k)*(h-1)/(g-1):0;for(let N=0;N<m;N++){const V=m>1?$*(f-1)+N*I:.5*($+E)*(f-1);if(V<0||V>f-1){for(let U=0;U<g;U++)for(let A=0;A<d;A++){const M=A+U*C[2]+N*C[1]+S*C[0];y.values[M]=l}continue}if(u==="bilinear"){const U=Math.floor(V),A=Math.ceil(V),M=V-U;for(let P=0;P<g;P++){const j=g>1?k*(h-1)+P*D:.5*(k+F)*(h-1);if(j<0||j>h-1){for(let G=0;G<d;G++){const Z=G+P*C[2]+N*C[1]+S*C[0];y.values[Z]=l}continue}const q=Math.floor(j),B=Math.ceil(j),O=j-q;for(let G=0;G<d;G++){let Z=G+q*w[2]+U*w[1]+T*w[0];const re=v[Z];Z=G+B*w[2]+U*w[1]+T*w[0];const R=v[Z];Z=G+q*w[2]+A*w[1]+T*w[0];const H=v[Z];Z=G+B*w[2]+A*w[1]+T*w[0];const Y=v[Z],L=re+(R-re)*O,te=H+(Y-H)*O;Z=G+P*C[2]+N*C[1]+S*C[0],y.values[Z]=L+(te-L)*M}}}else for(let U=0;U<g;++U){const A=g>1?k*(h-1)+U*D:.5*(k+F)*(h-1);if(A<0||A>h-1){for(let j=0;j<d;j++){const q=j+U*C[2]+N*C[1]+S*C[0];y.values[q]=l}continue}const M=Math.round(A),P=Math.round(V);for(let j=0;j<d;j++){const q=j+M*w[2]+P*w[1]+T*w[0],B=j+U*C[2]+N*C[1]+S*C[0];y.values[B]=v[q]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const _Me={kernelName:NA,backendName:"cpu",kernelFunc:SMe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Me(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;Ne(i,"cumprod");const u=Tn([s],i.shape.length);let l=i;u!=null&&(l=Xi({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=zn(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const f=Hi(l.dtype,"int32"),h=wA(ce(l.shape),f),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],m=a?(y,b)=>y+p-b-1:(y,b)=>y+b;for(let y=0;y<d.length;y+=p)for(let b=0;b<p;b++){const x=m(y,b);if(b===0)h[x]=o?1:d[x];else{const v=m(y,b-1);h[x]=o?d[v]*h[v]:d[x]*h[v]}}const g=n.makeTensorInfo(l.shape,f,h);if(u!=null){const y=yh(u),b=Xi({inputs:{x:g},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),b}return g}const kMe={kernelName:OA,backendName:"cpu",kernelFunc:$Me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;Ne(i,"cumsum");const u=Tn([s],i.shape.length);let l=i;u!=null&&(l=Xi({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=zn(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const f=Hi(l.dtype,"int32"),h=Ir(ce(l.shape),f),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],m=a?(y,b)=>y+p-b-1:(y,b)=>y+b;for(let y=0;y<d.length;y+=p)for(let b=0;b<p;b++){const x=m(y,b);if(b===0)h[x]=o?0:d[x];else{const v=m(y,b-1);h[x]=o?d[v]+h[v]:d[x]+h[v]}}const g=n.makeTensorInfo(l.shape,f,h);if(u!=null){const y=yh(u),b=Xi({inputs:{x:g},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),b}return g}const AMe={kernelName:E2,backendName:"cpu",kernelFunc:EMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o,binaryOutput:a}=r;if(i.shape.length===1){const u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=j5(u,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}else if(i.shape.length===2){const u=n.bufferSync(i),l=n.bufferSync(s),c=rse(u,l,o,a);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const DMe={kernelName:MA,backendName:"cpu",kernelFunc:TMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:s,dataFormat:o}=r;z(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=i.shape[0],u=i.shape[1],l=i.shape[2],c=i.shape[3],f=u*s,h=l*s,d=c/(s*s),p=n.data.get(i.dataId).values,m=new Float32Array(a*f*h*d);let g=0;for(let y=0;y<a;++y)for(let b=0;b<f;++b){const x=Math.floor(b/s),v=b%s;for(let w=0;w<h;++w){const C=Math.floor(w/s),S=w%s,_=(v*s+S)*d;for(let $=0;$<d;++$){const E=$+_+c*(C+l*(x+u*y));m[g++]=p[E]}}}return n.makeTensorInfo([a,f,h,d],i.dtype,m)}const FMe={kernelName:RA,backendName:"cpu",kernelFunc:IMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=r;Ne([i,s],"depthwiseConv2DNative");const c=Ue(i.shape),f=Ue(s.shape);let h=u;h==null&&(h=[1,1]),z(Mr(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=mr(i.shape,s.shape,o,h,a,l,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:b}=d,x=b.left,v=b.top,w=d.outChannels/d.inChannels,C=new Gn(d.outShape,i.dtype),S=n.data.get(i.dataId).values,_=n.data.get(s.dataId).values,$=C.values;for(let k=0;k<d.batchSize;++k){const E=k*c[0],F=k*C.strides[0];for(let T=0;T<d.outHeight;++T){const I=F+T*C.strides[1],D=T*d.strideHeight-v;for(let N=0;N<p;++N){const V=D+N*g;if(V<0||V>=d.inHeight)continue;const U=N*f[0],A=E+V*c[1];for(let M=0;M<d.outWidth;++M){const P=I+M*C.strides[2],j=M*d.strideWidth-x;for(let q=0;q<m;++q){const B=j+q*y;if(B<0||B>=d.inWidth)continue;const O=U+q*f[1],G=A+B*d.inChannels;let Z=P,re=O;for(let R=0;R<d.inChannels;++R){const H=S[G+R];for(let Y=0;Y<w;++Y)$[Z+Y]+=H*_[re+Y];Z+=w,re+=w}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const OMe={kernelName:A2,backendName:"cpu",kernelFunc:roe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=r;Ne([i,s],"depthwiseConv2dNativeBackpropFilter");const f=mr(i.shape,c,o,a,u,l,!0),{strideHeight:h,strideWidth:d,filterHeight:p,filterWidth:m}=f,g=new Gn(f.filterShape,"float32"),y=f.padInfo.left,b=f.padInfo.top,x=f.outChannels/f.inChannels,v=n.data.get(i.dataId).values,w=new Gn(i.shape,i.dtype,v),C=n.data.get(s.dataId).values,S=new Gn(s.shape,s.dtype,C);for(let _=0;_<p;++_){const $=Math.max(0,Math.ceil((b-_)/h)),k=Math.min(f.outHeight,(f.inHeight+b-_)/h);for(let E=0;E<m;++E){const F=Math.max(0,Math.ceil((y-E)/d)),T=Math.min(f.outWidth,(f.inWidth+y-E)/d);for(let I=0;I<f.outChannels;++I){const D=Math.trunc(I/x),N=I%x;let V=0;for(let U=0;U<f.batchSize;++U)for(let A=$;A<k;++A){const M=_+A*h-b;for(let P=F;P<T;++P){const j=E+P*d-y;V+=w.get(U,M,j,D)*S.get(U,A,P,I)}}g.set(V,_,E,D,N)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const MMe={kernelName:PA,backendName:"cpu",kernelFunc:NMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RMe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=r;Ne([i,s],"depthwiseConv2DNativeBackpropInput");const f=Ue(i.shape),h=Ue(s.shape),d=mr(c,s.shape,o,a,u,l,!0),p=new Gn(d.inShape,"float32"),m=p.values,[g,y,b]=p.strides,x=n.data.get(i.dataId).values,[v,w,C]=f,S=n.data.get(s.dataId).values,[_,$,k]=h,{batchSize:E,filterHeight:F,filterWidth:T,inChannels:I,inHeight:D,inWidth:N,outChannels:V,outHeight:U,outWidth:A,strideHeight:M,strideWidth:P}=d,j=F-1-d.padInfo.top,q=T-1-d.padInfo.left,B=V/I;for(let O=0;O<E;++O)for(let G=0;G<I;++G)for(let Z=0;Z<D;++Z){const re=Z-j,R=Math.max(0,Math.ceil(re/M)),H=Math.min(U,(F+re)/M);for(let Y=0;Y<N;++Y){const L=Y-q,te=Math.max(0,Math.ceil(L/P)),X=Math.min(A,(T+L)/P);let ie=0;for(let se=R;se<H;++se){const oe=se*M-re;for(let le=te;le<X;++le){const Ce=le*P-L,Me=v*O+w*se+C*le,Fe=_*(F-1-oe)+$*(T-1-Ce)+k*G;for(let de=0;de<B;++de){const Re=G*B+de,qe=x[Me+Re],ot=S[Fe+de];ie+=qe*ot}}}m[g*O+y*Z+b*Y+G]=ie}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const PMe={kernelName:LA,backendName:"cpu",kernelFunc:RMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LMe(e){const{inputs:t,backend:n}=e,{x:r}=t,i=ce(r.shape),s=n.data.get(r.dataId).values,o=ft([i,i],r.dtype),a=o.values;for(let l=0;l<s.length;l++)a[l*i+l]=s[l];const u=[...r.shape,...r.shape];return n.makeTensorInfo(u,o.dtype,o.values)}const BMe={kernelName:BA,backendName:"cpu",kernelFunc:LMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zMe={kernelName:T2,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i}=e,{strides:s,pad:o,dilations:a}=n,u=t,l=u.data.get(r.dataId).values,c=r.shape.length,f=u.data.get(i.dataId).values,h=i.shape.length,{batchSize:d,inHeight:p,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:x,strideHeight:v,strideWidth:w,filterHeight:C,filterWidth:S,dilationHeight:_,dilationWidth:$,outShape:k}=vw(r.shape,i.shape,s,o,"NHWC",a),E=ce(k),F=k.length,T=Fn(r.dtype,E);for(let D=0;D<d;++D)for(let N=0;N<y;++N){const V=N*v-x.top;for(let U=0;U<b;++U){const A=U*w-x.left;for(let M=0;M<g;++M){let P=Number.MIN_SAFE_INTEGER;for(let q=0;q<C;++q){const B=V+q*_;if(B>=0&&B<p)for(let O=0;O<S;++O){const G=A+O*$;if(G>=0&&G<m){const Z=ba([D,B,G,M],c,Ue(r.shape)),re=ba([q,O,M],h,Ue(i.shape)),R=l[Z]+f[re];R>P&&(P=R)}}}const j=ba([D,N,U,M],F,Ue(k));T[j]=P}}}return{dataId:u.write(ph(T,r.dtype),k,r.dtype),shape:k,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jMe={kernelName:C$,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:s}=e,{strides:o,pad:a,dilations:u}=n,l=t,c=Ao(r.shape,l.data.get(r.dataId).values),f=Ao(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:d,inWidth:p,inChannels:m,outHeight:g,outWidth:y,padInfo:b,strideHeight:x,strideWidth:v,filterHeight:w,filterWidth:C,dilationHeight:S,dilationWidth:_,outShape:$}=vw(r.shape,i.shape,o,a,"NHWC",u);z(s.rank===$.length,()=>`Error in ${C$}, dy must have the same rank as output ${$.length}, but got ${s.rank}`);const k=Ao($,l.data.get(s.dataId).values),E=z4(i.shape,i.dtype);for(let T=0;T<h;++T)for(let I=0;I<g;++I){const D=I*x-b.top;for(let N=0;N<y;++N){const V=N*v-b.left;for(let U=0;U<m;++U){let A=Number.MIN_SAFE_INTEGER,M=0,P=0;for(let j=0;j<w;++j){const q=D+j*S;if(q>=0&&q<d)for(let B=0;B<C;++B){const O=V+B*_;if(O>=0&&O<p){const G=c[T][q][O][U]+f[j][B][U];G>A&&(A=G,M=j,P=B)}}}E[M][P][U]+=k[T][I][N][U]}}}return{dataId:l.write(ph(E,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UMe={kernelName:w$,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:s}=e,{strides:o,pad:a,dilations:u}=n,l=t,c=Ao(r.shape,l.data.get(r.dataId).values),f=Ao(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:d,inWidth:p,inChannels:m,outHeight:g,outWidth:y,padInfo:b,strideHeight:x,strideWidth:v,filterHeight:w,filterWidth:C,dilationHeight:S,dilationWidth:_,outShape:$}=vw(r.shape,i.shape,o,a,"NHWC",u);z(s.rank===$.length,()=>`Error in ${w$}, dy must have the same rank as output ${$.length}, but got ${s.rank}`);const k=Ao($,l.data.get(s.dataId).values),E=z4(r.shape,r.dtype);for(let T=0;T<h;++T)for(let I=0;I<g;++I){const D=I*x-b.top;for(let N=0;N<y;++N){const V=N*v-b.left;for(let U=0;U<m;++U){let A=Number.MIN_SAFE_INTEGER,M=D<0?0:D,P=V<0?0:V;for(let j=0;j<w;++j){const q=D+j*S;if(q>=0&&q<d)for(let B=0;B<C;++B){const O=V+B*_;if(O>=0&&O<p){const G=c[T][q][O][U]+f[j][B][U];G>A&&(A=G,M=q,P=O)}}}E[T][M][P][U]+=k[T][I][N][U]}}}return{dataId:l.write(ph(E,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WMe(e){const{inputs:t,backend:n,attrs:r}=e,{image:i}=t,{canvas:s,options:o}=r,{contextOptions:a,imageOptions:u}=o||{},l=(u==null?void 0:u.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=s.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${c} type.`);const[h,d]=i.shape.slice(0,2),p=i.shape.length===2?1:i.shape[2],m=n.data.get(i.dataId).values,g=i.dtype==="float32"?255:1,y=new Uint8ClampedArray(d*h*4);for(let x=0;x<h*d;++x){const v=[0,0,0,255*l];for(let C=0;C<p;C++){const S=m[x*p+C];if(i.dtype==="float32"){if(S<0||S>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${S}.`)}else if(i.dtype==="int32"&&(S<0||S>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${S}.`);p===1?(v[0]=S*g,v[1]=S*g,v[2]=S*g):v[C]=S*g}const w=x*4;y[w+0]=Math.round(v[0]),y[w+1]=Math.round(v[1]),y[w+2]=Math.round(v[2]),y[w+3]=Math.round(v[3])}s.width=d,s.height=h;const b=new ImageData(y,d,h);return f.putImageData(b,0,0),i}const VMe={kernelName:W4,backendName:"cpu",kernelFunc:WMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pw(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Ne(i,"sum");let a;i.dtype==="bool"?a=Mf({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):a=Ou({inputs:{x:i},backend:n});const u=a.shape.length,l=dt(s,a.shape),c=Tn(l,u);let f=l,h=a;c!=null&&(h=Xi({inputs:{x:a},backend:n,attrs:{perm:c}}),f=zn(f.length,u)),Rr("sum",f,h.shape.length);const[d,p]=yr(h.shape,f),m=Hi(h.dtype,"int32");let g=j$(n,d,m);const y=ce(p),b=n.data.get(g.dataId).values,x=n.data.get(h.dataId).values;for(let v=0;v<b.length;++v){const w=v*y;let C=0;for(let S=0;S<y;++S)C+=x[w+S];b[v]=C}if(o){const v=Bn(g.shape,l),w=g;g=an({inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(w)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(h),g}const GMe={kernelName:uw,backendName:"cpu",kernelFunc:Pw};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HMe(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,s=t,{allDims:o,summedDims:a,idDims:u}=f5(i,s.length);d5(o.length,u,s);const{path:l,steps:c}=p5(a,u),f=c.length;let h=null,d=o.length;const p=[];for(let m=0;m<f;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:b}=h5(d,u[g]);let x;g5(y)?x=s[g]:(x=Xi({inputs:{x:s[g]},backend:n,attrs:{perm:y}}),p.push(x));const v=x.shape.slice();for(let w=0;w<b.length;++w)v.splice(b[w],0,1);_t(x.shape,v)||(x=an({inputs:{x},backend:n,attrs:{shape:v}}),p.push(x)),h===null?h=x:(h=vD({inputs:{a:x,b:h},backend:n}),p.push(h))}m<f-1&&(l[m]>=0&&(h=Pw({inputs:{x:h},backend:n,attrs:{axis:l[m]-(o.length-d),keepDims:!1}}),p.push(h)),d--)}for(const m of p)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const qMe={kernelName:zA,backendName:"cpu",kernelFunc:HMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XMe(e){const{inputs:t,backend:n}=e,{dy:r,y:i}=t;Ne([r,i],"eluGrad");const s=new Float32Array(ce(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values;for(let u=0;u<o.length;++u){const l=o[u];l>=0?s[u]=a[u]:s[u]=a[u]*(l+1)}return n.makeTensorInfo(i.shape,"float32",s)}const YMe={kernelName:jA,backendName:"cpu",kernelFunc:XMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KMe=i5,ZMe=s5,JMe=o5,QMe=a5,eRe=u5,tRe=l5,nRe=qt(Y0,e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+KMe*n);return t*(1-((((tRe*r+eRe)*r+QMe)*r+JMe)*r+ZMe)*r*Math.exp(-n*n))}),rRe={kernelName:Y0,backendName:"cpu",kernelFunc:nRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V$(e){const{inputs:t,backend:n,attrs:r}=e,{input:i}=t,{dim:s}=r,o=i.shape.length,a=i.shape.slice();let u=s;return s<0&&(z(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+s+1),a.splice(u,0,1),an({inputs:{x:i},backend:n,attrs:{shape:a}})}const iRe={kernelName:I2,backendName:"cpu",kernelFunc:V$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sRe=Un((e,t)=>e/t),q5=rr(q0,sRe),tR={kernelName:q0,backendName:"cpu",kernelFunc:q5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(e,t,n){const r=e.shape,i=r[0],s=r[1],o=n.data.get(e.dataId),a=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[i,s],c=ce(l),f=gr("float32",c),h=gr("float32",c);for(let g=0;g<i;g++){const y=mp({inputs:{x:a},backend:n,attrs:{begin:[g,0],size:[1,s]}}),b=mp({inputs:{x:u},backend:n,attrs:{begin:[g,0],size:[1,s]}}),x=hs({inputs:{real:y,imag:b},backend:n}),{real:v,imag:w}=oRe(x,t,n),C=ec(v,w);for(let S=0;S<s;S++){const _=c5(C,S);f[g*s+S]=_.real,h[g*s+S]=_.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x)}const d=n.makeTensorInfo(l,"float32",f),p=n.makeTensorInfo(l,"float32",h),m=hs({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),m}function oRe(e,t,n){const r=ce(e.shape),i=n.data.get(e.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(aRe(r)){const a=nR(s,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){const l=n.makeTensorInfo(u,"float32",a.real),c=n.makeTensorInfo(u,"float32",a.imag),f=n.makeTensorInfo([],"float32",fc(r,"float32")),h=Ou({inputs:{x:f},backend:n}),d=tR.kernelFunc({inputs:{a:l,b:f},backend:n}),p=tR.kernelFunc({inputs:{a:c,b:h},backend:n}),m=n.data.get(d.dataId).values,g=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return a}else{const a=ec(s,o),u=uRe(a,r,t);return yne(u)}}function aRe(e){return(e&e-1)===0}function nR(e,t,n,r,i){if(n===1)return{real:e,imag:t};const s=ec(e,t),o=n/2,a=bne(s),u=a.real,l=a.imag,c=[u.length],f=i.makeTensorInfo(c,"float32",u),h=i.makeTensorInfo(c,"float32",l),d=hs({inputs:{real:f,imag:h},backend:i}),p=vne(s),m=p.real,g=p.imag,y=[m.length],b=i.makeTensorInfo(y,"float32",m),x=i.makeTensorInfo(y,"float32",g),v=hs({inputs:{real:b,imag:x},backend:i}),w=nR(u,l,o,r,i),C=w.real,S=w.imag,_=[C.length],$=i.makeTensorInfo(_,"float32",C),k=i.makeTensorInfo(_,"float32",S),E=hs({inputs:{real:$,imag:k},backend:i}),F=nR(m,g,o,r,i),T=F.real,I=F.imag,D=[T.length],N=i.makeTensorInfo(D,"float32",T),V=i.makeTensorInfo(D,"float32",I),U=hs({inputs:{real:N,imag:V},backend:i}),A=wne(n,r),M=[A.real.length],P=i.makeTensorInfo(M,"float32",A.real),j=i.makeTensorInfo(M,"float32",A.imag),q=hs({inputs:{real:P,imag:j},backend:i}),B=vD({inputs:{a:q,b:U},backend:i}),O=zm({inputs:{a:E,b:B},backend:i}),G=G5({inputs:{a:E,b:B},backend:i}),Z=gp({inputs:{input:O},backend:i}),re=gp({inputs:{input:G},backend:i}),R=jm({inputs:{input:O},backend:i}),H=jm({inputs:{input:G},backend:i}),Y=Um({inputs:[Z,re],backend:i,attrs:{axis:0}}),L=Um({inputs:[R,H],backend:i,attrs:{axis:0}}),te=i.data.get(Y.dataId).values,X=i.data.get(L.dataId).values;return i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo($),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(N),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(Z),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(re),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(Y),i.disposeIntermediateTensorInfo(L),{real:te,imag:X}}function uRe(e,t,n){const r=new Float32Array(t*2);for(let i=0;i<t;i++){let s=0,o=0;for(let a=0;a<t;a++){const u=Cne(i*a,t,n),l=c5(e,a);s+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}n&&(s/=t,o/=t),xne(r,s,o,i)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lRe(e){const{inputs:t,backend:n}=e,{input:r}=t,i=ce(r.shape),s=r.shape[r.shape.length-1],o=i/s,a=an({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),u=ioe(a,!1,n),l=an({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),l}const cRe={kernelName:UA,backendName:"cpu",kernelFunc:lRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(e){const{backend:t,attrs:n}=e,{shape:r,value:i,dtype:s}=n,o=s||qp(i),a=Fn(o,ce(r));return hRe(a,i,o),t.makeTensorInfo(r,o,a)}const fRe={kernelName:WA,backendName:"cpu",kernelFunc:X5};function hRe(e,t,n){e.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dRe={kernelName:VA,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,i=n,s=gr(r.dtype,ce(r.shape)),[o,a,u,l]=r.shape,c=i.data.get(r.dataId).values;for(let h=0;h<o;h++){const d=h*u*a*l;for(let p=0;p<a;p++){const m=p*(u*l);for(let g=0;g<u;g++){const y=g*l;for(let b=0;b<l;b++){const x=Math.round(u-g-1),v=d+m+y+b;let w=c[v];if(x>=0&&x<u){const C=x*l,S=d+m+C+b;w=c[S]}s[v]=w}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r;let m=noe({inputs:{x:i,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){const g=m;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=an({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=zm({inputs:{a:m,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else m=zm({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(g)}if(d){const g=m;if(c==="NCHW"&&d==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=an({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=W$(n,m,d,y,p),n.disposeIntermediateTensorInfo(y)}else m=W$(n,m,d,a,p);n.disposeIntermediateTensorInfo(g)}return m}const gRe={kernelName:kv,backendName:"cpu",kernelFunc:pRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r;let m=roe({inputs:{x:i,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){const g=m;m=zm({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(g)}if(d){const g=m;m=W$(n,m,d,a,p),n.disposeIntermediateTensorInfo(g)}return m}const yRe={kernelName:Ev,backendName:"cpu",kernelFunc:mRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bRe(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,s=ce(r.shape),o=i.shape,a=o[o.length-1],[u,l,c,f]=rD(r,i);if(l===0)return n.makeTensorInfo(u,r.dtype,[]);const h=n.data.get(i.dataId).values,d=n.bufferSync(r),p=pse(h,d,r.dtype,l,a,c,f,r.shape,s);return n.makeTensorInfo(u,r.dtype,p.values)}const vRe={kernelName:GA,backendName:"cpu",kernelFunc:bRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:s}=t,{axis:o,batchDims:a}=r;Ne([i,s],"gatherV2");const u=dt(o,i.shape)[0],l=n.data.get(s.dataId).values,c=i.shape[u];for(let v=0;v<l.length;++v){const w=l[v];z(w<=c-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${c-1}]`)}let f=a;a==null&&(f=0);const h=ce(s.shape),d=y5(i,s,u,f),p=an({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),m=an({inputs:{x:s},backend:n,attrs:{shape:[d.batchSize,h/d.batchSize]}}),g=[d.batchSize,d.outerSize,h/d.batchSize,d.sliceSize],y=n.bufferSync(m),b=n.bufferSync(p),x=gse(b,y,g);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(d.outputShape,x.dtype,x.values)}const wRe={kernelName:O2,backendName:"cpu",kernelFunc:xRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CRe(e){const{inputs:t,backend:n}=e,{input:r}=t,i=ce(r.shape),s=r.shape[r.shape.length-1],o=i/s,a=an({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),u=ioe(a,!0,n),l=an({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),l}const SRe={kernelName:HA,backendName:"cpu",kernelFunc:CRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Re=qt(n1,e=>Number.isFinite(e)?1:0,"bool"),$Re={kernelName:n1,backendName:"cpu",kernelFunc:_Re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kRe=qt(r1,e=>Math.abs(e)===1/0?1:0,"bool"),ERe={kernelName:r1,backendName:"cpu",kernelFunc:kRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ARe=qt(i1,e=>Number.isNaN(e)?1:0,"bool"),TRe={kernelName:i1,backendName:"cpu",kernelFunc:ARe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DRe(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:s}=n,o=xse(r,i,s);return t.makeTensorInfo([o.length],"float32",o)}const IRe={kernelName:XA,backendName:"cpu",kernelFunc:DRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FRe=qt(o1,e=>Math.log1p(e)),ORe={kernelName:o1,backendName:"cpu",kernelFunc:FRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NRe=Un((e,t)=>e&&t),MRe=rr(L2,NRe,null,"bool"),RRe={kernelName:L2,backendName:"cpu",kernelFunc:MRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PRe=qt(B2,e=>e?0:1,"bool"),LRe={kernelName:B2,backendName:"cpu",kernelFunc:PRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BRe=Un((e,t)=>e||t),zRe=rr(z2,BRe,null,"bool"),jRe={kernelName:z2,backendName:"cpu",kernelFunc:zRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function URe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:s,bias:o,alpha:a,beta:u}=r;Ne(i,"LRN");const l=i.shape[3],c=l-1,f=n.data.get(i.dataId).values,h=ce(i.shape),d=new Float32Array(h);function p(m){const g=m%l;let y=m-g+Math.max(0,g-s);const b=m-g+Math.min(g+s,c);let x=0;for(;y<=b;y++){const v=f[y];x+=v*v}return x}for(let m=0;m<h;m++){const g=p(m),y=f[m]*Math.pow(o+a*g,-u);d[m]=y}return n.makeTensorInfo(i.shape,i.dtype,d)}const WRe={kernelName:j2,backendName:"cpu",kernelFunc:URe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,y:s,dy:o}=t,{depthRadius:a,bias:u,alpha:l,beta:c}=r;Ne(o,"LRNGrad");const f=ce(o.shape),h=o.shape[3],d=n.data.get(o.dataId).values,p=n.data.get(i.dataId).values,m=n.data.get(s.dataId).values,g=new Float32Array(f),y=f;for(let b=0;b<y;b++){const x=b%h,v=b-x+Math.max(0,x-a),w=b-x+Math.min(h,x+a+1);let C=0;for(let S=v;S<w;S++)C+=Math.pow(p[S],2);C=l*C+u;for(let S=v;S<w;S++){let _=-2*l*c*p[S]*m[b]/C;b===S&&(_+=Math.pow(C,-c)),_*=d[b],g[S]+=_}}return n.makeTensorInfo(o.shape,i.dtype,g)}const GRe={kernelName:YA,backendName:"cpu",kernelFunc:VRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function soe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:s,keepDims:o}=r,a=n;let u=i.shape;const l=u.length,c=dt(s,u);let f=c;const h=Tn(f,l);let d=a.data.get(i.dataId).values;if(h!=null){const v=new Array(l);for(let w=0;w<v.length;w++)v[w]=u[h[w]];d=W5(d,u,i.dtype,h,v),f=zn(f.length,l),u=v}Ne(i,"max"),Rr("max",f,l);const[p,m]=yr(u,f),g=ce(m),y=Cse(d,g,p,i.dtype),b=a.write(y,p,i.dtype);let x=p;return o&&(x=Bn(p,c)),{dataId:b,shape:x,dtype:i.dtype}}const HRe={kernelName:U2,backendName:"cpu",kernelFunc:soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Ne(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;z(Mr(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=jo(i.shape,s,o,l,a,u);let f;if(c.filterWidth===1&&c.filterHeight===1&&_t(c.inShape,c.outShape))f=Ou({inputs:{x:i},backend:n});else{const h=n.data.get(i.dataId).values,d=Ue(i.shape),p=H5(h,i.shape,i.dtype,d,c,"max");f=n.makeTensorInfo(c.outShape,i.dtype,p.values)}return f}const XRe={kernelName:W2,backendName:"cpu",kernelFunc:qRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r;Ne(i,"maxPool3d");const c=hc(i.shape,s,o,1,a,u,l),f=n.data.get(i.dataId).values,h=toe(f,i.shape,i.dtype,Ue(i.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const KRe={kernelName:V2,backendName:"cpu",kernelFunc:YRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZRe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=r;Ne([i,s],"maxPool3DGrad");const c=hc(s.shape,o,a,1,u,l),f=n.bufferSync(s),h=B3e(f,c),d=c.strideDepth,p=c.strideHeight,m=c.strideWidth,g=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,x=c.effectiveFilterDepth,v=c.effectiveFilterHeight,w=c.effectiveFilterWidth,C=x-1-c.padInfo.front,S=w-1-c.padInfo.left,_=v-1-c.padInfo.top,$=ft(s.shape,"float32"),k=n.bufferSync(i);for(let E=0;E<c.batchSize;++E)for(let F=0;F<c.inChannels;++F)for(let T=0;T<c.inDepth;++T)for(let I=0;I<c.inHeight;++I)for(let D=0;D<c.inWidth;++D){const N=T-C,V=I-_,U=D-S;let A=0;for(let M=0;M<x;M+=g){const P=(N+M)/d;if(!(P<0||P>=c.outDepth||Math.floor(P)!==P))for(let j=0;j<v;j+=y){const q=(V+j)/p;if(!(q<0||q>=c.outHeight||Math.floor(q)!==q))for(let B=0;B<w;B+=b){const O=(U+B)/m;if(O<0||O>=c.outWidth||Math.floor(O)!==O)continue;const G=x*v*w-1-h.get(E,P,q,O,F),Z=M*v*w+j*w+B,re=G===Z?1:0;if(re===0)continue;const R=k.get(E,P,q,O,F);A+=R*re}}}$.set(A,E,T,I,D,F)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const JRe={kernelName:ZA,backendName:"cpu",kernelFunc:ZRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QRe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s,output:o}=t,a=s;Ne([s,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:f}=r,h=jo(a.shape,u,l,1,c,f),d=n.data.get(a.dataId).values,p=ft(h.outShape,a.dtype,eoe(d,a.shape,a.dtype,h).values),m=h.strideHeight,g=h.strideWidth,y=h.dilationHeight,b=h.dilationWidth,x=h.effectiveFilterHeight,v=h.effectiveFilterWidth,w=v-1-h.padInfo.left,C=x-1-h.padInfo.top,S=ft(a.shape,"float32"),_=n.data.get(i.dataId).values,$=ft(i.shape,"float32",_);for(let k=0;k<h.batchSize;++k)for(let E=0;E<h.inChannels;++E)for(let F=0;F<h.inHeight;++F)for(let T=0;T<h.inWidth;++T){const I=F-C,D=T-w;let N=0;for(let V=0;V<x;V+=y){const U=(I+V)/m;if(!(U<0||U>=h.outHeight||Math.floor(U)!==U))for(let A=0;A<v;A+=b){const M=(D+A)/g;if(M<0||M>=h.outWidth||Math.floor(M)!==M)continue;const P=x*v-1-p.get(k,U,M,E),j=V*v+A,q=P===j?1:0;if(q===0)continue;const B=$.get(k,U,M,E);N+=B*q}}S.set(N,k,F,T,E)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const ePe={kernelName:KA,backendName:"cpu",kernelFunc:QRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tPe(e,t,n,r,i){const s=Ue(t),o=H5(e,t,n,s,i,"max"),a=eoe(e,t,n,i,!0,r);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nPe={kernelName:JA,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=t,u=n;Ne(r,"MaxPoolWithArgmax");const l=u.data.get(r.dataId).values,c=jo(r.shape,i,s,[1,1],o),[f,h]=tPe(l,r.shape,r.dtype,a,c),d=u.write(f,c.outShape,r.dtype),p=u.write(h,c.outShape,r.dtype);return[{dataId:d,shape:c.outShape,dtype:r.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=dt(s,i.shape),l=yr(i.shape,a)[1],c=ce(l),f=[],h=n.makeTensorInfo([],"float32",new Float32Array([c]));f.push(h);const d=Mf({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});f.push(d);const p=q5({inputs:{a:d,b:h},backend:n});f.push(p);const m=Pw({inputs:{x:p},backend:n,attrs:{axis:s,keepDims:o}});return f.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const iPe={kernelName:G2,backendName:"cpu",kernelFunc:rPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Ne(i,"min");const a=dt(s,i.shape);let u=a;const l=Tn(u,i.shape.length);let c=i;l!=null&&(c=Xi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=zn(u.length,i.shape.length)),Rr("min",u,c.shape.length);const[f,h]=yr(c.shape,u),d=ce(h),p=Ir(ce(f),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let x=m[b];for(let v=0;v<d;++v){const w=m[b+v];(Number.isNaN(w)||w<x)&&(x=w)}p[y]=x}l!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Bn(f,a),b=an({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),b}return g}const oPe={kernelName:H2,backendName:"cpu",kernelFunc:sPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,mode:o}=r;Ne(i,"mirrorPad");const a=s.map((x,v)=>x[0]+i.shape[v]+x[1]),u=s.map(x=>x[0]),l=s.map((x,v)=>x[0]+i.shape[v]),c=o==="reflect"?0:1,f=n.data.get(i.dataId).values,h=i.shape.length,d=Ue(i.shape),p=ce(a),m=a.length,g=Ue(a),y=gr(i.dtype,p);for(let x=0;x<p;x++){let v=Xp(x,m,g);for(let C=0;C<m;C++)v[C]<u[C]?v[C]=u[C]*2-v[C]-c:v[C]>=l[C]&&(v[C]=(l[C]-1)*2-v[C]+c);v=v.map((C,S)=>C-u[S]);const w=ba(v,h,d);y[x]=f[w]}return{dataId:n.write(y,a,i.dtype),shape:a,dtype:i.dtype}}const uPe={kernelName:q2,backendName:"cpu",kernelFunc:aPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lPe=Un((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),cPe=rr(l1,lPe),fPe={kernelName:l1,backendName:"cpu",kernelFunc:cPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:s}=r,o=i.shape.length;let a=s;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const u=dt([a],i.shape),l=soe({inputs:{x:i},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=Bn(l.shape,u),f=an({inputs:{x:l},backend:n,attrs:{shape:c}}),h=G5({inputs:{a:i,b:f},backend:n}),d=cse({inputs:{x:h},backend:n}),p=Pw({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),m=an({inputs:{x:p},backend:n,attrs:{shape:c}}),g=q5({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const hPe={kernelName:fw,backendName:"cpu",kernelFunc:ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dPe(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:s,seed:o,normalized:a}=r;Ne(i,"multinomial");const u=a?i:ooe({inputs:{logits:i},backend:n,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],f=n.data.get(u.dataId).values,h=[l,s],d=Ir(ce(h),"int32");for(let p=0;p<l;++p){const m=p*c,g=new Float32Array(c-1);g[0]=f[m];for(let x=1;x<g.length;++x)g[x]=g[x-1]+f[m+x];const y=jT.alea(o.toString()),b=p*s;for(let x=0;x<s;++x){const v=y();d[b+x]=g.length;for(let w=0;w<g.length;w++)if(v<g[w]){d[b+x]=w;break}}}return a||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(h,"int32",d)}const pPe={kernelName:QA,backendName:"cpu",kernelFunc:dPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gPe=QT;function mPe(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=r;Ne(i,"NonMaxSuppression");const l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,{selectedIndices:f}=gPe(l,c,o,a,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}const yPe={kernelName:eT,backendName:"cpu",kernelFunc:mPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bPe=eD;function vPe(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=r;Ne(i,"NonMaxSuppressionPadded");const c=n.data.get(i.dataId).values,f=n.data.get(s.dataId).values,{selectedIndices:h,validOutputs:d}=bPe(c,f,o,a,u,l);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const xPe={kernelName:tT,backendName:"cpu",kernelFunc:vPe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wPe=tD;function CPe(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=r;Ne(i,"NonMaxSuppressionWithScore");const c=n.data.get(i.dataId).values,f=n.data.get(s.dataId).values,h=o,d=a,p=u,m=l,{selectedIndices:g,selectedScores:y}=wPe(c,f,h,d,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const SPe={kernelName:nT,backendName:"cpu",kernelFunc:CPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Pe(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:s,depth:o,onValue:a,offValue:u}=r;Ne(i,"oneHot");const l=ce(i.shape),c=new Float32Array(l*o);c.fill(u);const f=n.data.get(i.dataId).values;for(let h=0;h<l;++h)f[h]>=0&&f[h]<o&&(c[h*o+f[h]]=a);return n.makeTensorInfo([...i.shape,o],s,c)}const $Pe={kernelName:Z2,backendName:"cpu",kernelFunc:_Pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G$(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const i=gp({inputs:{input:r},backend:n}),s=G$({inputs:{x:i},backend:n}),o=jm({inputs:{input:r},backend:n}),a=G$({inputs:{x:o},backend:n}),u=hs({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return X5({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const kPe={kernelName:gw,backendName:"cpu",kernelFunc:G$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const i=gp({inputs:{input:r},backend:n}),s=aoe({inputs:{x:i},backend:n}),o=jm({inputs:{input:r},backend:n}),a=G$({inputs:{x:o},backend:n}),u=hs({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return X5({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const EPe={kernelName:K2,backendName:"cpu",kernelFunc:aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(t.length===1)return V$({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const s=t[0].shape,o=t[0].dtype;t.forEach(c=>{Nr(s,c.shape,"All tensors passed to stack must have matching shapes"),z(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=t.map(c=>{const f=V$({inputs:{input:c},backend:n,attrs:{dim:i}});return a.push(f),f}),l=Um({inputs:u,backend:n,attrs:{axis:i}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),l}const APe={kernelName:J2,backendName:"cpu",kernelFunc:uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,constantValue:o}=r;Ne(i,"pad");const a=s.map((b,x)=>b[0]+i.shape[x]+b[1]),u=s.map(b=>b[0]),l=n.data.get(i.dataId).values,c=ce(i.shape),f=i.shape.length,h=Ue(i.shape),d=ce(a),p=a.length,m=Ue(a),g=gr(i.dtype,d);o!==0&&g.fill(o);for(let b=0;b<c;b++){const v=Xp(b,f,h).map((C,S)=>C+u[S]),w=ba(v,p,m);g[w]=l[b]}return{dataId:n.write(g,a,i.dtype),shape:a,dtype:i.dtype}}const loe={kernelName:Q2,backendName:"cpu",kernelFunc:TPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DPe=Un((e,t)=>Math.pow(e,t)),IPe=rr(f1,DPe),FPe={kernelName:f1,backendName:"cpu",kernelFunc:IPe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OPe(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=t,a=i.map(g=>n.data.get(g.dataId).values),u=i.map(g=>g.shape),l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values,[f,h,d]=Ase(a,u,l,s.shape,s.dtype,c,o.shape),p=f.map(g=>n.makeTensorInfo([g.length],"int32",g)),m=n.makeTensorInfo(d,s.dtype,h);return p.concat([m])}const NPe={kernelName:rT,backendName:"cpu",kernelFunc:OPe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MPe(e){const{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:s}=t,o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=Tse(o,r.shape,r.dtype,a,i.shape,u,s.shape),f=n.makeTensorInfo([l.length],"int32",l),h=n.makeTensorInfo([c.length],r.dtype,c);return[f,h]}const RPe={kernelName:iT,backendName:"cpu",kernelFunc:MPe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PPe(e){const{inputs:t,backend:n,attrs:r}=e,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=r,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,f=n.data.get(o.dataId).values,h=a.map(g=>n.data.get(g.dataId).values),d=a.map(g=>g.shape),[p,m]=Dse(l,i.shape,c,s.shape,s.dtype,f,o.shape,h,d,u);return n.makeTensorInfo(p,s.dtype,m)}const LPe={kernelName:sT,backendName:"cpu",kernelFunc:PPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BPe(e){const{backend:t,attrs:n}=e,{start:r,stop:i,dtype:s,step:o}=n,a=Ise(r,i,o,s);return t.makeTensorInfo([a.length],s,a)}const zPe={kernelName:oT,backendName:"cpu",kernelFunc:BPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jPe=qt(h1,e=>1/e),UPe={kernelName:h1,backendName:"cpu",kernelFunc:jPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WPe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r;Ne(i,"resizeBilinear");const u=Ue(i.shape),[l,c]=a,[f,h,d,p]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(ce([f,l,c,p])),y=[s&&l>1?h-1:h,s&&c>1?d-1:d],b=[s&&l>1?l-1:l,s&&c>1?c-1:c];let x=0;const v=y[0]/b[0],w=y[1]/b[1];for(let C=0;C<f;C++)for(let S=0;S<l;S++){let _;o?_=v*(S+.5)-.5:_=v*S;const $=Math.max(0,Math.floor(_)),k=_-$,E=Math.min(h-1,Math.ceil(_)),F=C*u[0]+$*u[1],T=C*u[0]+E*u[1];for(let I=0;I<c;I++){let D;o?D=w*(I+.5)-.5:D=w*I;const N=Math.max(0,Math.floor(D)),V=D-N,U=Math.min(d-1,Math.ceil(D)),A=F+N*u[2],M=T+N*u[2],P=F+U*u[2],j=T+U*u[2];for(let q=0;q<p;q++){const B=m[A+q],O=m[M+q],G=m[P+q],Z=m[j+q],re=B+(G-B)*V,R=O+(Z-O)*V,H=re+(R-re)*k;g[x++]=H}}}return n.makeTensorInfo([f,l,c,p],"float32",g)}const VPe={kernelName:iw,backendName:"cpu",kernelFunc:WPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GPe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r;Ne([s,i],"resizeBilinearGrad");const a=Ue(i.shape),[u,l,c,f]=i.shape,[,h,d]=s.shape,p=new Float32Array(u*l*c*f),m=[o&&h>1?l-1:l,o&&d>1?c-1:c],g=[o&&h>1?h-1:h,o&&d>1?d-1:d],y=m[0]/g[0],b=m[1]/g[1],x=n.data.get(s.dataId).values;let v=0;for(let w=0;w<u;w++){const C=w*a[0];for(let S=0;S<h;S++){const _=S*y,$=Math.floor(_),k=Math.min(Math.ceil(_),l-1),E=C+$*a[1],F=C+k*a[1],T=_-$,I=1-T;for(let D=0;D<d;D++){const N=D*b,V=Math.floor(N),U=Math.min(Math.ceil(N),c-1),A=N-V,M=1-A,P=E+V*a[2],j=E+U*a[2],q=F+V*a[2],B=F+U*a[2],O=I*M,G=I*A,Z=T*M,re=T*A;for(let R=0;R<f;R++){const H=x[v++];p[P+R]+=H*O,p[j+R]+=H*G,p[q+R]+=H*Z,p[B+R]+=H*re}}}}return n.makeTensorInfo([u,c,l,f],"float32",p)}const HPe={kernelName:lT,backendName:"cpu",kernelFunc:GPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qPe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r;Ne(i,"resizeNearestNeighbor");const u=Ue(i.shape),[l,c]=a,[f,h,d,p]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(f*l*c*p),y=[s&&l>1?h-1:h,s&&c>1?d-1:d],b=[s&&l>1?l-1:l,s&&c>1?c-1:c],x=y[0]/b[0],v=y[1]/b[1];let w=0;for(let C=0;C<f;C++){const S=C*u[0];for(let _=0;_<l;_++){const $=o?x*(_+.5):x*_;let k=Math.min(h-1,s?Math.round($):Math.floor($));o&&(k=Math.max(0,k));const E=S+k*u[1];for(let F=0;F<c;F++){const T=o?v*(F+.5):v*F;let I=Math.min(d-1,s?Math.round(T):Math.floor(T));o&&(I=Math.max(0,I));const D=E+I*u[2];for(let N=0;N<p;N++){const V=m[D+N];g[w++]=V}}}}return n.makeTensorInfo([f,l,c,p],i.dtype,g)}const XPe={kernelName:rw,backendName:"cpu",kernelFunc:qPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YPe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r;Ne([s,i],"resizeNearestNeighborGrad");const a=Ue(i.shape),u=Ue(s.shape),[l,c,f,h]=i.shape,[,d,p]=s.shape,m=new Float32Array(l*c*f*h),g=n.data.get(s.dataId).values,y=[o&&d>1?c-1:c,o&&p>1?f-1:f],b=[o&&d>1?d-1:d,o&&p>1?p-1:p],x=y[0]/b[0],v=y[1]/b[1],w=1/x,C=1/v,S=Math.ceil(w)*2+2,_=Math.ceil(C)*2+2;for(let $=0;$<l;$++){const k=$*a[0];for(let E=0;E<c;E++){const F=k+E*a[1],T=Math.floor(E*w),I=Math.floor(T-S/2);for(let D=0;D<f;D++){const N=F+D*a[2],V=Math.floor(D*C),U=Math.floor(V-_/2);for(let A=0;A<h;A++){let M=0;for(let P=0;P<S;P++){const j=P+I;if(j<0||j>=d)continue;const q=k+j*u[1],B=j*x,O=Math.min(c-1,o?Math.round(B):Math.floor(B));if(E===O)for(let G=0;G<_;G++){const Z=G+U;if(Z<0||Z>=p)continue;const re=q+Z*u[2],R=Z*v,H=Math.min(f-1,o?Math.round(R):Math.floor(R));D===H&&(M+=g[re+A])}}m[N+A]=M}}}}return n.makeTensorInfo(i.shape,i.dtype,m)}const KPe={kernelName:uT,backendName:"cpu",kernelFunc:YPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:s}=r;Ne(i,"reverse");const o=i.shape.length,a=dt(s,i.shape);if(o===0)return Ou({inputs:{x:i},backend:n});const u=new Gn(i.shape,i.dtype),l=n.bufferSync(i);for(let c=0;c<u.size;c++){const f=u.indexToLoc(c),h=f.slice();a.forEach(d=>h[d]=i.shape[d]-1-h[d]),u.set(l.get(...h),...f)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}const JPe={kernelName:sw,backendName:"cpu",kernelFunc:ZPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QPe={kernelName:kT,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:s,center:o}=t,a=n,u=gr(r.dtype,ce(r.shape)),[l,c,f,h]=r.shape,[d,p]=t5(o,c,f),m=255,g=Math.sin(i),y=Math.cos(i),b=a.data.get(r.dataId).values;for(let v=0;v<l;v++){const w=v*f*c*h;for(let C=0;C<c;C++){const S=C*(f*h);for(let _=0;_<f;_++){const $=_*h;for(let k=0;k<h;k++){const E=[l,C,_,k],F=E[2],T=E[1];let I=(F-d)*y-(T-p)*g,D=(F-d)*g+(T-p)*y;I=Math.round(I+d),D=Math.round(D+p);let N=s;if(typeof s!="number"&&(k===3?N=m:N=s[k]),I>=0&&I<f&&D>=0&&D<c){const U=D*(f*h),A=I*h,M=w+U+A+k;N=b[M]}const V=w+S+$+k;u[V]=N}}}}return{dataId:a.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eLe=qt(g1,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),tLe={kernelName:g1,backendName:"cpu",kernelFunc:eLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nLe(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:s}=t,{shape:o}=r,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=wh(s,i,o),h=!0,d=n.bufferSync(i),p=n.bufferSync(s),m=Od(d,p,o,f,l,u,a,c,0,h);return n.makeTensorInfo(o,m.dtype,m.values)}const rLe={kernelName:cT,backendName:"cpu",kernelFunc:nLe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iLe(e,t){let n=0,r=e.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),e[i]<t?n=i+1:r=i;return r}function sLe(e,t){let n=0,r=e.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),e[i]<=t?n=i+1:r=i;return r}function oLe(e,t,n,r,i,s){const o=Fn("int32",n*i);for(let a=0;a<n;++a){const u=e.slice(a*r,(a+1)*r),l=a*i;for(let c=0;c<i;++c)o[l+c]=s==="left"?iLe(u,t[c+l]):sLe(u,t[c+l])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aLe(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:s}=t,{side:o}=r,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,l=oLe(a,u,i.shape[0],i.shape[1],s.shape[1],o);return n.makeTensorInfo(s.shape,"int32",l)}const uLe={kernelName:hT,backendName:"cpu",kernelFunc:aLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lLe(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:s}=t;Ne([r,i,s],"select");const o=r.shape.length,a=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=Hi(i.dtype,s.dtype),f=Ir(ce(i.shape),c);let h=0;const d=o===0||o>1||i.shape.length===1?1:ce(i.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<d;m++)a[p]===1?f[h++]=u[p]:f[h++]=l[p];return n.makeTensorInfo(i.shape,c,f)}const cLe={kernelName:ow,backendName:"cpu",kernelFunc:lLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fLe=oD,hLe=aD,dLe=qt(y1,e=>e>=0?hLe*e:fLe*(Math.exp(e)-1)),pLe={kernelName:y1,backendName:"cpu",kernelFunc:dLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gLe=qt(x1,e=>e<0?-1:e>0?1:0),mLe={kernelName:x1,backendName:"cpu",kernelFunc:gLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yLe=qt(b1,e=>Math.sin(e)),bLe={kernelName:b1,backendName:"cpu",kernelFunc:yLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vLe=qt(v1,e=>Math.sinh(e)),xLe={kernelName:v1,backendName:"cpu",kernelFunc:vLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wLe=11920928955078125e-23,ZV=Math.log(wLe)+2,CLe=qt(C1,e=>{const t=e>-ZV,n=e<ZV,r=Math.exp(e);let i;return n?i=r:t?i=e:i=Math.log(1+r),i}),SLe={kernelName:C1,backendName:"cpu",kernelFunc:CLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Le(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,paddings:o}=r;Ne([i],"spaceToBatchND");const a=ce(s),u=[[0,0]];u.push(...o);for(let C=1+s.length;C<i.shape.length;++C)u.push([0,0]);const l=loe.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),c=kw(l.shape,s,a,!1),f=Ew(c.length,s.length,!1),h=Aw(l.shape,s,a,!1),m=an({inputs:{x:l},backend:n,attrs:{shape:c}}),b=Xi({inputs:{x:m},backend:n,attrs:{perm:f}}),w=an({inputs:{x:b},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(b),w}const $Le={kernelName:lw,backendName:"cpu",kernelFunc:_Le};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kLe(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:s,defaultValue:o}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values[0],[f,h,d,p,m]=Mse(a,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const ELe={kernelName:dT,backendName:"cpu",kernelFunc:kLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ALe(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(r.dataId).values,u=Array.from(n.data.get(s.dataId).values),[l,c,f]=Rse(a,r.shape,r.dtype,o,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([f.length],s.dtype,new Int32Array(f))]}const TLe={kernelName:pT,backendName:"cpu",kernelFunc:ALe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DLe(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=V5(o,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(c,r.dtype,l)}const ILe={kernelName:gT,backendName:"cpu",kernelFunc:DLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FLe(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=V5(o,r.shape,r.dtype,a,u);return n.makeTensorInfo(c,r.dtype,l)}const OLe={kernelName:mT,backendName:"cpu",kernelFunc:FLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NLe(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:s,defaultValue:o}=t,{outputShape:a}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:f,outputSize:h}=wh(s,i,a),d=!1,p=n.bufferSync(i);let m;switch(s.dtype){case"bool":{const g=n.bufferSync(s),y=!!n.data.get(o.dataId).values[0];m=Od(p,g,a,h,c,l,u,f,y,d);break}case"float32":{const g=n.bufferSync(s),y=n.data.get(o.dataId).values[0];m=Od(p,g,a,h,c,l,u,f,y,d);break}case"int32":{const g=n.bufferSync(s),y=n.data.get(o.dataId).values[0];m=Od(p,g,a,h,c,l,u,f,y,d);break}case"string":{const g=n.bufferSync(s),y=Jl(n.data.get(o.dataId).values[0]);m=Od(p,g,a,h,c,l,u,f,y,d);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const MLe={kernelName:yT,backendName:"cpu",kernelFunc:NLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RLe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:s,axis:o}=r,a=dt(o,i.shape)[0],u=m5(i,s,a),l=new Array(i.shape.length).fill(0),c=i.shape.slice();return u.map(f=>{const h=[...c];h[a]=f;const d=mp({inputs:{x:i},backend:n,attrs:{begin:l,size:h}});return l[a]+=f,d})}const PLe={kernelName:cw,backendName:"cpu",kernelFunc:RLe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LLe={kernelName:bT,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,r=t;Ne(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let a=0;a<i.length;++a){const u=i[a];s[a]=u*u}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BLe=qt(T1,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),zLe={kernelName:T1,backendName:"cpu",kernelFunc:BLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jLe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:f,shrinkAxisMask:h}=r;Ne(i,"stridedSlice");const{finalShapeSparse:d,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:b,end:x,strides:v}=ZB(i.shape,s,o,a,u,l,c,f,h);let w;if(m)w=an({inputs:{x:i},backend:n,attrs:{shape:p}});else if(g||y){z(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const C=XB(b,x,v),S=mp({inputs:{x:i},backend:n,attrs:{begin:b,size:C}});w=an({inputs:{x:S},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(S)}else{const C=n.bufferSync(i),S=Bse(d,C,v,b);w=n.makeTensorInfo(p,S.dtype,S.values)}return w}const ULe={kernelName:vT,backendName:"cpu",kernelFunc:jLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WLe(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:f}=t,h=n.data.get(c.dataId).values,d=n.data.get(f.dataId).values,[p,m]=zse(h,d,i,s,o,a,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(f.shape,"int32",m)]}const VLe={kernelName:xT,backendName:"cpu",kernelFunc:WLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GLe(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:s,delimiter:o}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values[0],[l,c,f]=jse(a,u,i),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(f))]}const HLe={kernelName:wT,backendName:"cpu",kernelFunc:GLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qLe(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(s.dataId).values,a=Use(o,i);return n.makeTensorInfo(s.shape,"int32",a)}const XLe={kernelName:CT,backendName:"cpu",kernelFunc:qLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YLe=qt(k1,e=>Math.tan(e)),KLe={kernelName:k1,backendName:"cpu",kernelFunc:YLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZLe=qt(E1,e=>Math.tanh(e)),JLe={kernelName:E1,backendName:"cpu",kernelFunc:ZLe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QLe(e){const{inputs:t,backend:n}=e,{tensor:r,indices:i,updates:s}=t,{sliceRank:o,numUpdates:a,sliceSize:u,strides:l,outputSize:c}=wh(s,i,r.shape),f=!1,h=n.bufferSync(i),d=n.bufferSync(s),p=n.bufferSync(r),m=Od(h,d,r.shape,c,u,a,o,l,p,f);return n.makeTensorInfo(r.shape,m.dtype,m.values)}const e4e={kernelName:fT,backendName:"cpu",kernelFunc:QLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:s}=r;Ne(i,"tile");const o=Vse(n.bufferSync(i),s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const n4e={kernelName:A1,backendName:"cpu",kernelFunc:t4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:s,sorted:o}=r;Ne(i,"topk");const a=n.data.get(i.dataId).values,[u,l]=Hse(a,i.shape,i.dtype,s,o);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}const i4e={kernelName:ST,backendName:"cpu",kernelFunc:r4e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s4e(e){const{inputs:t,attrs:n,backend:r}=e,{image:i,transforms:s}=t,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=n,[c,f,h,d]=i.shape,[p,m]=l??[f,h],g=[c,p,m,d],y=Ue(i.shape),b=y[0],x=y[1],v=y[2],w=Ue(g),C=w[0],S=w[1],_=w[2],$=gr(i.dtype,ce(g));$.fill(u);const k=r.data.get(i.dataId).values,E=r.data.get(s.dataId).values;for(let T=0;T<c;++T){const I=s.shape[0]===1?E:E.subarray(T*8,T*8+8);for(let D=0;D<p;++D)for(let N=0;N<m;++N)for(let V=0;V<d;++V){let U;const A=I[6]*N+I[7]*D+1;if(A===0)continue;const M=(I[0]*N+I[1]*D+I[2])/A,P=(I[3]*N+I[4]*D+I[5])/A,j=JV(M,h,a),q=JV(P,f,a);switch(o){case"nearest":U=f4e(k,f,h,b,x,v,T,q,j,V,u);break;case"bilinear":U=h4e(k,f,h,b,x,v,T,q,j,V,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const B=T*C+D*S+N*_+V;$[B]=U}return r.makeTensorInfo(g,i.dtype,$)}return{dataId:r.write($,g,i.dtype),shape:i.shape,dtype:i.dtype}}const o4e={kernelName:_T,backendName:"cpu",kernelFunc:s4e};function JV(e,t,n){switch(n){case"reflect":return a4e(e,t);case"wrap":return u4e(e,t);case"nearest":return c4e(e,t);case"constant":default:return l4e(e)}}function a4e(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{const r=2*t;n-=r*Math.trunc(n/r),n>=t&&(n=r-n-1)}return _f(0,n,t-1)}function u4e(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{const r=t-1;n-=t*Math.trunc(n/r)}return _f(0,n,t-1)}function l4e(e,t){return e}function c4e(e,t){return _f(0,e,t-1)}function xb(e,t,n,r,i,s,o,a,u,l,c){const f=o*r+a*i+u*s+l;return 0<=a&&a<t&&0<=u&&u<n?e[f]:c}function f4e(e,t,n,r,i,s,o,a,u,l,c){const f=Math.round(a),h=Math.round(u);return xb(e,t,n,r,i,s,o,f,h,l,c)}function h4e(e,t,n,r,i,s,o,a,u,l,c){const f=Math.floor(a),h=Math.floor(u),d=f+1,p=h+1,m=(p-u)*xb(e,t,n,r,i,s,o,f,h,l,c)+(u-h)*xb(e,t,n,r,i,s,o,f,p,l,c),g=(p-u)*xb(e,t,n,r,i,s,o,d,h,l,c)+(u-h)*xb(e,t,n,r,i,s,o,d,p,l,c);return(d-a)*m+(a-f)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4e(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:s}=t;Ne(s,"unique");const o=r.data.get(s.dataId).values,{outputValues:a,outputShape:u,indices:l}=qse(o,i,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}const p4e={kernelName:$T,backendName:"cpu",kernelFunc:d4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g4e(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i.shape.length,a=i.shape[s],u=new Array(o-1);let l=0;for(let d=0;d<o;d++)d!==s&&(u[l++]=i.shape[d]);const c=new Array(o).fill(0),f=i.shape.slice();f[s]=1;const h=new Array(a);for(let d=0;d<h.length;d++){c[s]=d;const p=mp({inputs:{x:i},backend:n,attrs:{begin:c,size:f}});h[d]=an({inputs:{x:p},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(p)}return h}const m4e={kernelName:dw,backendName:"cpu",kernelFunc:g4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:s}=t,{numSegments:o}=r;Ne(i,"unsortedSegmentSum");const a=i.shape.length,u=s.shape.length,l=[],c=[],f=a-u;let h=s;for(let p=0;p<f;++p){const m=V$({inputs:{input:h},backend:n,attrs:{dim:p+1}});h=m,c.push(m)}for(let p=0;p<o;++p){const m=fc(p,"int32"),g=n.makeTensorInfo([],"int32",m),y=use({inputs:{a:g,b:h},backend:n}),b=Mf({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),x=vD({inputs:{a:b,b:i},backend:n}),v=Pw({inputs:{x},backend:n,attrs:{axis:0,keepDims:!1}});l.push(v),c.push(g),c.push(y),c.push(b),c.push(x),c.push(v)}const d=uoe({inputs:l,backend:n,attrs:{axis:0}});return c.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const b4e={kernelName:pw,backendName:"cpu",kernelFunc:y4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v4e=[d3e,qOe,g3e,y3e,QOe,v3e,w3e,S3e,$3e,E3e,T3e,I3e,O3e,R3e,L3e,j3e,W3e,G3e,q3e,f3e,Y3e,Z3e,Q3e,tNe,tMe,ZOe,rNe,rMe,XOe,sMe,aMe,uMe,cMe,hMe,pMe,mMe,bMe,xMe,CMe,_Me,kMe,AMe,DMe,FMe,OMe,MMe,PMe,BMe,zMe,jMe,UMe,VMe,qMe,i3e,YMe,iNe,rRe,sNe,iRe,aNe,cRe,fRe,dRe,lNe,fNe,gRe,yRe,vRe,wRe,dNe,gNe,YOe,SRe,oMe,$Re,ERe,TRe,s3e,yNe,vNe,IRe,wNe,ORe,RRe,LRe,jRe,WRe,GRe,HRe,SNe,XRe,KRe,JRe,ePe,nPe,iPe,oPe,$Ne,uPe,fPe,pPe,ENe,TNe,yPe,xPe,SPe,INe,$Pe,EPe,APe,loe,FPe,a3e,NNe,NPe,RPe,LPe,zPe,KOe,tR,UPe,u3e,l3e,c3e,VPe,HPe,XPe,KPe,JPe,QPe,tLe,UNe,rLe,uLe,cLe,pLe,VNe,mLe,bLe,xLe,GNe,hPe,SLe,$Le,ELe,TLe,ILe,OLe,MLe,PLe,XNe,LLe,KNe,JNe,zLe,ULe,VLe,HLe,XLe,n3e,GMe,KLe,JLe,e4e,n4e,i4e,o4e,FNe,p4e,m4e,b4e,kPe];for(const e of v4e)ET(e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xd={},bS={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function x4e(e,t){xd[e]=t}function Ta(e,t){if(!(e in xd)||t!=null){const r=C4e(e,t);if(r!==null)xd[e]=r;else return console.log("Could not get context for WebGL version",e),null}const n=xd[e];return n==null||n.isContextLost()?(delete xd[e],Ta(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),xd[e])}function w4e(e){if(!ae().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&e===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function C4e(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=t??w4e(e);return n.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete xd[e]},!1),ae().getBool("SOFTWARE_WEBGL_ENABLED")&&(bS.failIfMajorPerformanceCaveat=!1),e===1?n.getContext("webgl",bS)||n.getContext("experimental-webgl",bS):n.getContext("webgl2",bS)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Uv;(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(Uv||(Uv={}));var Gs;(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(Gs||(Gs={}));var Cr;(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Cr||(Cr={}));function Lw(e,t){return[t,e]}function S4e(e,t){return e*t}function vS(e){const t=ce(e),n=Math.ceil(t/4);return b$(n)}function M1(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function _4e(e,t){const[n,r]=M1(e,t);return n*r*4}function Y5(e,t){const n=e;let r,i,s,o,a,u,l,c,f,h;return ae().getNumber("WEBGL_VERSION")===2?(r=n.R32F,i=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,l=4,c=1,f=n.HALF_FLOAT,h=n.FLOAT,u=n.RGBA8):(r=e.RGBA,i=e.RGBA,s=e.RGBA,o=n.RGBA,a=e.RGBA,l=4,c=4,f=t!=null?t.HALF_FLOAT_OES:null,h=e.FLOAT,u=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:f,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function De(e,t){const n=t();return ae().getBool("DEBUG")&&$4e(e),n}function $4e(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+T4e(e,t))}const k4e=596e-10,E4e=65504;function A4e(e){return!!(ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||k4e<Math.abs(e)&&Math.abs(e)<E4e)}function T4e(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function xS(e,t){return yc(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function D4e(e,t){const n=yc(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(De(e,()=>e.shaderSource(n,t)),De(e,()=>e.compileShader(n)),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function I4e(e,t){const n=yc(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(De(e,()=>e.shaderSource(n,t)),De(e,()=>e.compileShader(n)),ae().get("ENGINE_COMPILE_ONLY"))return n;if(e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw coe(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const F4e=/ERROR: [0-9]+:([0-9]+):/g;function coe(e,t){const n=F4e.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}const r=+n[1],i=e.split(`
`),s=i.length.toString().length+2,o=i.map((f,h)=>Wd((h+1).toString(),s)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const u=o.slice(0,r-1),l=o.slice(r-1,r),c=o.slice(r);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${Wd(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function O4e(e){return yc(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function N4e(e,t){if(De(e,()=>e.linkProgram(t)),!ae().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function eN(e,t){if(De(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function M4e(e,t){const n=yc(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return De(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),De(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function R4e(e,t){const n=yc(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return De(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),De(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function P4e(e){return yc(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function L4e(e,t){const n=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const r=`[${e}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){const r=`[${e}x${t}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+i+".")}}function B4e(e){return yc(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function QV(e,t,n,r,i,s,o){const a=e.getAttribLocation(t,n);return a===-1?!1:(De(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),De(e,()=>e.vertexAttribPointer(a,i,e.FLOAT,!1,s,o)),De(e,()=>e.enableVertexAttribArray(a)),!0)}function z4e(e,t,n){G4e(e,n),De(e,()=>e.activeTexture(e.TEXTURE0+n)),De(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function j4e(e,t,n){return yc(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function U4e(e,t,n){return e.getUniformLocation(t,n)}function W4e(e,t,n,r){De(e,()=>z4e(e,t,r)),De(e,()=>e.uniform1i(n,r))}function tN(e,t,n){De(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),De(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function eG(e,t){De(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),De(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function wS(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+V4e(e,t))}function V4e(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function yc(e,t,n){const r=De(e,()=>t());if(r==null)throw new Error(n);return r}function G4e(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function Wm(e,t=2){return ce(e.slice(0,e.length-t))}function Vm(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function CS(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[Wm(e),...Vm(e)]),t}function H4e(e,t=!1){let n=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=ae().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&ae().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n=n*2,r=r*2,e=e.map((a,u)=>u>=e.length-2?xA(e[u]):e[u]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=cc(e).newShape);let i=ce(e),s=null;e.length<=1&&i<=n?s=[1,i]:e.length===2&&e[0]<=n&&e[1]<=n?s=e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);const o=s!=null&&Math.max(...s)>r&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(s==null||o)if(t){const a=Wm(e);let u=2,l=2;e.length&&([u,l]=Vm(e)),i=a*(u/2)*(l/2),s=b$(i).map(c=>c*2)}else s=b$(i);return s}function SS(e){return e%2===0}function H$(e,t){if(e=e.slice(-2),t=t.slice(-2),_t(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){const n=e[e.length-1],r=t[t.length-1];if(n===r||SS(n)&&SS(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&SS(e[0])&&SS(t[0])}let nN,rN;function q4e(e){if(nN==null){const t=Ta(e);nN=t.getParameter(t.MAX_TEXTURE_SIZE)}return nN}function X4e(e){if(rN==null){const t=Ta(e);rN=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,rN)}function Y4e(e){if(e===0)return 0;let t;const n=Ta(e);return wo(n,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:wo(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function wo(e,t){return e.getExtension(t)!=null}function tG(e){try{if(Ta(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function K4e(e){if(e===0)return!1;const t=Ta(e);if(e===1){if(!wo(t,"OES_texture_float"))return!1}else if(!wo(t,"EXT_color_buffer_float"))return!1;return rR(t)}function Z4e(e){if(e===0)return!1;const t=Ta(e);if(e===1){if(!wo(t,"OES_texture_float")||!wo(t,"WEBGL_color_buffer_float"))return!1}else{if(wo(t,"EXT_color_buffer_float"))return rR(t);const r="EXT_color_buffer_half_float";if(wo(t,r)){const i=t.getExtension(r);return J4e(t,i)}return!1}return rR(t)}function rR(e){const t=Y5(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);const r=1,i=1;e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,r,i,0,t.textureFormatFloat,t.textureTypeFloat,null);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(s),o}function J4e(e,t){const n=Y5(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);const i=1,s=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,i,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),a}function Q4e(e){return e!==2?!1:Ta(e).fenceSync!=null}function Bw(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&z(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ze=ae();ze.registerFlag("HAS_WEBGL",()=>ze.getNumber("WEBGL_VERSION")>0);ze.registerFlag("WEBGL_VERSION",()=>tG(2)?2:tG(1)?1:0);ze.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ze.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ze.get("WEBGL_VERSION")===2);ze.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ze.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ze.registerFlag("WEBGL_PACK",()=>ze.getBool("HAS_WEBGL"));ze.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_CLIP",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_REDUCE",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_LAZILY_UNPACK",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_CONV_IM2COL",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>q4e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>X4e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=ze.getNumber("WEBGL_VERSION");return e===0?0:Y4e(e)});ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ze.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!q4());ze.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>K4e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ze.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ze.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ze.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Z4e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Q4e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ze.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ze.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});ze.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>q4()?1:-1,e=>{if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});ze.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ze.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ze.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ze.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ze.registerFlag("WEBGL_EXP_CONV",()=>!1);ze.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ze.getBool("IS_TEST"));ze.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ze.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ze.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ze.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Di(){let e,t,n,r,i,s,o,a,u,l;return ae().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a=ae().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ig(e,t,n="index"){const r=Ue(t);return r.map((i,s)=>{const o=`int ${e[s]} = ${n} / ${i}`,a=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * ${i}`:`index -= ${e[s]} * ${i}`;return`${o}; ${a};`}).join("")}function xD(e,t,n="index"){const r=Ue(t);return r.map((i,s)=>{const o=`int ${e[s]} = ${n} / outShapeStrides[${s}]`,a=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * outShapeStrides[${s}]`:`index -= ${e[s]} * outShapeStrides[${s}]`;return`${o}; ${a};`}).join("")}function eBe(e,t){const n=e.length,r=e.map(s=>`${t}[${s}]`),i=new Array(n-1);i[n-2]=r[n-1];for(let s=n-3;s>=0;--s)i[s]=`(${i[s+1]} * ${r[s+1]})`;return i}function tBe(e,t,n="index"){const r=e.map((s,o)=>o),i=eBe(r,t);return i.map((s,o)=>{const a=`int ${e[o]} = ${n} / ${i[o]}`,u=o===i.length-1?`int ${e[o+1]} = ${n} - ${e[o]} * ${i[o]}`:`index -= ${e[o]} * ${i[o]}`;return`${a}; ${u};`}).join("")}function K5(e){const t=Ue(e).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function Z5(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const foe=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:hoe}=Pne;function nBe(e,t,n){const r=[];if(e.forEach(d=>{const p=ce(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?r.push(`uniform float ${d.name}${p>1?`[${p}]`:""};`):(r.push(`uniform sampler2D ${d.name};`),r.push(`uniform int offset${d.name};`)),n.enableShapeUniforms){const{uniformShape:m}=J5(n.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(m.length){case 1:r.push(`uniform int ${d.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${d.name}Shape;`);break}r.push(`uniform ivec2 ${d.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(d=>{r.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});const i=r.join(`
`),s=e.map(d=>rBe(d,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=t.texShape,a=Di(),u=oBe(a);let l,c,f=lBe(a);return t.isPacked?(l=iBe(t.logicalShape,o,n.enableShapeUniforms),c=uBe(a)):(l=sBe(t.logicalShape,o,n.enableShapeUniforms),c=aBe(a)),n.packedInputs&&(f+=dBe),[f,u,c,i,l,s,n.userCode].join(`
`)}function R1(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return $Be(e,t);case 1:return EBe(e,t);case 2:return TBe(e,t);case 3:return IBe(e,t);case 4:return OBe(e,t);case 5:return NBe(e);case 6:return MBe(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function doe(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return _Be(e);case 1:return kBe(e,t);case 2:return ABe(e,t);case 3:return DBe(e,t);default:return FBe(e,t)}}function rBe(e,t,n=!1,r){let i="";n?i+=doe(e,r):i+=R1(e,r);const s=e.shapeInfo.logicalShape,o=t.logicalShape;return s.length<=o.length&&(n?i+=RBe(e,t):i+=PBe(e,t)),i}function iBe(e,t,n){switch(e.length){case 0:return poe();case 1:return pBe(e,t,n);case 2:return CBe(e,t,n);case 3:return mBe(e,t,n);default:return bBe(e,t,n)}}function sBe(e,t,n){switch(e.length){case 0:return poe();case 1:return gBe(e,t,n);case 2:return SBe(e,t,n);case 3:return yBe(e,t,n);case 4:return vBe(e,t,n);case 5:return xBe(e,t);case 6:return wBe(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function oBe(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function aBe(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function uBe(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function lBe(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${cBe}
    ${fBe}
    ${hBe}
  `}const cBe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,fBe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,hBe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,dBe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function poe(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function pBe(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function gBe(e,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function mBe(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[2]/2),s=i*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function yBe(e,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${xD(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;const r=ig(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function bBe(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[e.length-1]/2),s=i*Math.ceil(e[e.length-2]/2);let o=s,a="",u="b, r, c";for(let l=2;l<e.length-1;l++)o*=e[e.length-l-1],a=`
      int b${l} = index / ${o};
      index -= b${l} * ${o};
    `+a,u=`b${l}, `+u;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${e.length}(${u});
    }
  `}function vBe(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${xD(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;const r=ig(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function xBe(e,t){const n=ig(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function wBe(e,t){const n=ig(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function CBe(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(_t(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const i=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function SBe(e,t,n){return _t(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function sg(e){return`offset${e}`}function _Be(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Di();return`
    vec4 ${n}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function $Be(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,s]=e.shapeInfo.texShape;if(i===1&&s===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=sg(n);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,u]=e.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${u}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function kBe(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,s=Di();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function EBe(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${P1(e)}
      }
    `;const i=e.shapeInfo.texShape,s=i[0],o=i[1];if(o===1&&s===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=sg(n);return o===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function ABe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=s[0],a=s[1],u=Di();if(s!=null&&_t(n,s))return t?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${u.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${u.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `;const l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `}function TBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape;if(s!=null&&_t(n,s)){if(t)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const h=s[0],d=s[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:a}=cc(n),u=o;if(u.length<n.length){const h=L1(e,u),d=["row","col"];return`
      ${R1(h,t)}
      float ${i}(int row, int col) {
        return ${i}(${B1(d,a)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${P1(e)}
      }
    `;const l=s[0],c=s[1],f=sg(r);return c===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${r}, uv);
    }
  `:l===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${f};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function DBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){const h=n.slice(1),d=[1,2],p=L1(e,h),m=["b","row","col"];return`
        ${doe(p,t)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${B1(m,d)});
        }
      `}const a=Di();if(t)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const u=o[0],l=o[1],c=Math.ceil(n[2]/2),f=c*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${l}, ${f}, ${c}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function IBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:u}=cc(n),l=a;if(l.length<n.length){const m=L1(e,l),g=["row","col","depth"];return`
        ${R1(m,t)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${B1(g,u)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${o}, 1)));
        ${P1(e)}
      }
    `;const c=e.shapeInfo.texShape,f=c[0],h=c[1],d=e.shapeInfo.flatOffset;if(h===s&&d==null)return t?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${f}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(h===o&&d==null)return t?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `;const p=sg(r);return t?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${f}, ${h}, index);
        return sampleTexture(${r}, uv);
      }
  `}function FBe(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=Di();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const s=e.shapeInfo.logicalShape,o=s.length,a=e.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=u[0],c=u[1],f=Math.ceil(s[o-1]/2);let h=f*Math.ceil(s[o-2]/2),d="int b, int row, int col",p=`b * ${h} + (row / 2) * ${f} + (col / 2)`;for(let m=2;m<o-1;m++)d=`int b${m}, `+d,h*=s[o-m-1],p=`b${m} * ${h} + `+p;return`
    vec4 ${r}(${d}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});
      return ${i.texture2D}(${n}, uv);
    }
  `}function OBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:u,keptDims:l}=cc(n);if(u.length<n.length){const b=L1(e,u),x=["row","col","depth","depth2"];return`
      ${R1(b,t)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${B1(x,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${s}, 1)));
        ${P1(e)}
      }
    `;const c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],d=f[1],p=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(d===a&&c==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(d===s&&c==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;const y=sg(r);return t?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${h}, ${d}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function NBe(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],s=t[3]*i,o=t[2]*s,a=t[1]*o,{newShape:u,keptDims:l}=cc(t);if(u.length<t.length){const m=L1(e,u),g=["row","col","depth","depth2","depth3"];return`
      ${R1(m)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${B1(g,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${s}, ${i})) +
          depth3;
        ${P1(e)}
      }
    `;const c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],d=f[1];if(d===a&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${s}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===i&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=sg(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${s} +
          depth2 * ${i} + depth3 + ${p};
      vec2 uv = uvFromFlat(${h}, ${d}, index);
      return sampleTexture(${n}, uv);
    }
  `}function MBe(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=cc(t);if(i.length<t.length){const g=L1(e,i),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${R1(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${B1(y,s)});
      }
    `}const o=t[5],a=t[4]*o,u=t[3]*a,l=t[2]*u,c=t[1]*l;if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${l}, ${u}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${P1(e)}
      }
    `;const f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];if(p===c&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${u}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===o&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=sg(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} + depth * ${u} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function P1(e){const t=e.name,n=ce(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function RBe(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,a=hoe(e.shapeInfo.logicalShape,t.logicalShape),u=Zt(o),l=o-s;let c;const f=["x","y","z","w","u","v"];s===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(b=>`coords.${f[b+l]} = 0;`).join(`
`);let h="";o<2&&s>0?h="coords":h=e.shapeInfo.logicalShape.map((b,x)=>`coords.${f[x+l]}`).join(", ");let d="return outputValue;";const m=ce(e.shapeInfo.logicalShape)===1,y=ce(t.logicalShape)===1;if(s===1&&!m&&!y)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)o===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=s-2,x=s-1;a.indexOf(b)>-1&&a.indexOf(x)>-1?d="return vec4(outputValue.x);":a.indexOf(b)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(x)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${u} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${h});
      ${d}
    }
  `}function PBe(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=t.texShape,o=e.shapeInfo.texShape,a=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&a===u&&e.shapeInfo.flatOffset==null&&_t(o,s))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const l=Zt(u),c=hoe(e.shapeInfo.logicalShape,t.logicalShape),f=u-a;let h;const d=["x","y","z","w","u","v"];a===0?h="":u<2&&c.length>=1?h="coords = 0;":h=c.map(m=>`coords.${d[m+f]} = 0;`).join(`
`);let p="";return u<2&&a>0?p="coords":p=e.shapeInfo.logicalShape.map((m,g)=>`coords.${d[g+f]}`).join(", "),`
    float ${i}() {
      ${l} coords = getOutputCoords();
      ${h}
      return get${r}(${p});
    }
  `}function Zt(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function J5(e,t,n){const{newShape:r,keptDims:i}=cc(t),s=t.length,o=e&&s===3&&t[0]===1,a=o?t.slice(1):r,u=!e&&s>1&&!_t(t,n)&&r.length<s||o;return{useSqueezeShape:u,uniformShape:u?a:t,keptDims:i}}function L1(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function B1(e,t){return t.map(n=>e[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LBe(e,t,n,r){const i=n.map((c,f)=>{const h={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(h.flatOffset=c.texData.slice.flatOffset),{name:t.variableNames[f],shapeInfo:h}}),s=i.map(c=>c.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=nBe(i,o,t),u=I4e(e.gl,a),l=e.createProgram(u);return ae().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(l),Object.assign({program:t,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o},goe(e,t,l)))}function goe(e,t,n){const r=[],i=[];let s,o,a,u=null,l=null;l=e.getUniformLocation(n,"NAN",!1),ae().getNumber("WEBGL_VERSION")===1&&(u=e.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const f of t.variableNames){const h={name:f,uniform:e.getUniformLocation(n,f,c),offset:e.getUniformLocation(n,`offset${f}`,c)};t.enableShapeUniforms&&(h.shape=e.getUniformLocation(n,`${f}Shape`,c),h.texShape=e.getUniformLocation(n,`${f}TexShape`,c)),r.push(h)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(n,"outShape",c),a=e.getUniformLocation(n,"outShapeStrides",c),o=e.getUniformLocation(n,"outTexShape",c)),t.customUniforms)for(const f of t.customUniforms)i.push(e.getUniformLocation(n,f.name,c));return{variablesLocations:r,customUniformLocations:i,infLoc:u,nanLoc:l,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}}function nG(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((n,r)=>{const i=n.logicalShape,s=t[r],o=s.shape;if(!_t(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(n.isUniform&&s.isUniform)return;const a=n.texShape,u=s.isUniform?null:s.texData.texShape;if(!_t(a,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${u} must match`)})}function BBe(e,t,n,r,i){t.program.enableShapeUniforms||(nG(t.inShapeInfos,n),nG([t.outShapeInfo],[r]));const s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):e.setOutputMatrixTexture(s.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),ae().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<n.length;++u){const l=n[u],{uniform:c,offset:f,shape:h,texShape:d}=t.variablesLocations[u];if(h){const{uniformShape:p}=J5(t.program.packedInputs,l.shape,l.texData.texShape);switch(p.length){case 1:e.gl.uniform1iv(h,new Int32Array(p));break;case 2:e.gl.uniform2iv(h,new Int32Array(p));break;case 3:e.gl.uniform3iv(h,new Int32Array(p));break;case 4:e.gl.uniform4iv(h,new Int32Array(p));break}}if(d&&e.gl.uniform2i(d,l.texData.texShape[0],l.texData.texShape[1]),c!=null){if(l.isUniform){if(ce(l.shape)<2)e.gl.uniform1f(c,l.uniformValues[0]);else{let p=l.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),e.gl.uniform1fv(c,p)}continue}l.texData.slice!=null&&f!=null&&e.gl.uniform1i(f,l.texData.slice.flatOffset),e.setInputMatrixTexture(l.texData.texture.texture,c,u)}}const a=t.outShapeLocation;if(a)switch(r.shape.length){case 1:e.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(a,new Int32Array(r.shape));break}if(t.outShapeStridesLocation){const u=Ue(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&i)for(let u=0;u<t.program.customUniforms.length;++u){const l=t.program.customUniforms[u],c=t.customUniformLocations[u],f=i[u];if(l.type==="float")e.gl.uniform1fv(c,f);else if(l.type==="vec2")e.gl.uniform2fv(c,f);else if(l.type==="vec3")e.gl.uniform3fv(c,f);else if(l.type==="vec4")e.gl.uniform4fv(c,f);else if(l.type==="int")e.gl.uniform1iv(c,f);else if(l.type==="ivec2")e.gl.uniform2iv(c,f);else if(l.type==="ivec3")e.gl.uniform3iv(c,f);else if(l.type==="ivec4")e.gl.uniform4iv(c,f);else throw Error(`uniform type ${l.type} is not supported yet.`)}e.executeProgram()}function zBe(e,t,n){let r="";t.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!o.isUniform){const u=o.texData.texShape,{useSqueezeShape:l,uniformShape:c,keptDims:f}=J5(e.packedInputs,o.shape,u);let h="",d="",p="";if(c.length===1&&e.packedInputs){const w=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];h=`${w[0]>1}_${w[1]>1}`}else if(c.length===2&&!e.packedInputs)d=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!e.packedInputs){const w=Ue(c);p=`${w[0]===u[1]}_${w[w.length-1]===u[1]}`}const m=o.shape.length,g=c.length===2&&_t(o.shape,u),y=ce(o.shape)===1,b=fp(o.shape,n.shape),x=!e.packedInputs&&m===n.shape.length&&_t(u,n.texData.texShape),v=e.packedInputs||c.length>2?"":`${u[0]>1}_${u[1]>1}`;r+=`${m}_${x}_${l?f:""}_${c.length}_${y}_${b}_${g}_${h}_${d}_${p}_${v}_${a}`}else{const u=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${u}_${a}`}});const i=e.userCode;let s=e.constructor.name;return s+="_"+r+"_"+i+`${ae().getNumber("WEBGL_VERSION")}`,s}function Qr(e){return ae().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jBe{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Uv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Di();this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?xD(["r","c","d"],t):ig(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UBe{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Uv.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Di();this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?xD(["r","c","d"],t):ig(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WBe{constructor(t){this.variableNames=["A"],this.outTexUsage=Gs.DOWNLOAD;const n=Di();this.outputShape=t,this.userCode=`
      ${foe}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VBe{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Gs.DOWNLOAD;const n=Di();this.outputShape=t,this.userCode=`
      ${foe}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GBe={R:0,G:1,B:2,A:3};class rG{constructor(t,n=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=Di();this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length);let s="result";n&&(s="floor(result * 255. + 0.5)");let o="";for(let a=0;a<r.length;a++){const u=r[a];o+=`
          if(offset == ${a}) {
            result = values[${GBe[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Z5():K5(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${i.texture2D}(A, uv);
          ${o}
        }
        ${i.output} = vec4(${s}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HBe{constructor(t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Di();this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length);let i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const u=o*2+a;i+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Z5():K5(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${r.output} = ${s};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qBe(e){const t=Di(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return D4e(e,n)}function XBe(e){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return M4e(e,t)}function YBe(e){const t=new Uint16Array([0,1,2,2,1,3]);return R4e(e,t)}function zw(e,t,n,r,i,s){L4e(t,n);const o=P4e(e),a=e.TEXTURE_2D;return De(e,()=>e.bindTexture(a,o)),De(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),De(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),De(e,()=>e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)),De(e,()=>e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST)),ae().getNumber("WEBGL_VERSION")===1?De(e,()=>e.texImage2D(a,0,r,t,n,0,i,s,null)):De(e,()=>e.texStorage2D(a,1,r,t,n)),De(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:o,texShape:[n,t]}}function moe(e){return e.internalFormatFloat}function KBe(e,t,n,r){const[i,s]=Lw(t,n);return zw(e,i,s,moe(r),r.textureFormatFloat,e.FLOAT)}function yoe(e){return e.internalFormatHalfFloat}function ZBe(e,t,n,r){const[i,s]=Lw(t,n);return zw(e,i,s,yoe(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function boe(e){return e.downloadTextureFormat}function JBe(e,t,n,r){const[i,s]=Lw(t,n);return zw(e,i,s,boe(r),e.RGBA,e.UNSIGNED_BYTE)}function voe(e){return e.internalFormatPackedFloat}function QBe(e,t,n,r){const[i,s]=M1(t,n);return zw(e,i,s,voe(r),e.RGBA,e.FLOAT)}function xoe(e){return e.internalFormatPackedHalfFloat}function e5e(e,t,n,r){const[i,s]=M1(t,n);return zw(e,i,s,xoe(r),e.RGBA,r.textureTypeHalfFloat)}function t5e(e,t,n){return De(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),QV(e,t,"clipSpacePos",n,3,20,0)&&QV(e,t,"uv",n,2,20,12)}function n5e(e,t,n,r,i,s){De(e,()=>e.bindTexture(e.TEXTURE_2D,t));let o,a,u;i instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),a=e.FLOAT,u=s.internalFormatPackedFloat),o.set(i),ae().getNumber("WEBGL_VERSION")===2?De(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,a,o)):De(e,()=>e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,a,o)),De(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function r5e(e,t,n){De(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?ae().getNumber("WEBGL_VERSION")===2?De(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):De(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):ae().getNumber("WEBGL_VERSION")===2?De(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):De(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),De(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function i5e(e,t,n,r){const i=e.createBuffer();De(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));const a=4*4*t*n;return De(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),De(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),De(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}function s5e(e,t,n){const r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function o5e(e,t,n,r){const[i,s]=Lw(t,n),o=4,a=new Uint8Array(S4e(t*n,o));return De(e,()=>e.readPixels(0,0,i,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function a5e(e,t,n,r,i,s,o,a){const u=e,l=new Float32Array(_4e(s,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function u5e(e,t,n){const r=new Float32Array(t*n*4);return De(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iN{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=ae().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,x4e(n,t)):this.gl=Ta(n),t=this.gl,ae().getNumber("WEBGL_VERSION")===2){const s=t;this.createVertexArray=()=>De(s,()=>s.createVertexArray()),this.bindVertexArray=o=>De(s,()=>s.bindVertexArray(o)),this.deleteVertexArray=o=>De(s,()=>s.deleteVertexArray(o)),this.getVertexArray=()=>De(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(t!=null){const s=t.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>De(t,()=>s.createVertexArrayOES()),this.bindVertexArray=o=>De(t,()=>s.bindVertexArrayOES(o)),this.deleteVertexArray=o=>De(t,()=>s.deleteVertexArrayOES(o)),this.getVertexArray=()=>De(t,()=>t.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ae().getNumber("WEBGL_VERSION")===1){const s="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=xS(this.gl,s),wo(this.gl,o))this.textureHalfFloatExtension=xS(this.gl,o);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),wo(this.gl,i))this.colorBufferHalfFloatExtension=xS(this.gl,i);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",wo(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(wo(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=XBe(this.gl),this.indexBuffer=YBe(this.gl),this.framebuffer=B4e(this.gl),this.textureConfig=Y5(this.gl,this.textureHalfFloatExtension)}get debug(){return ae().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;De(t,()=>t.finish()),De(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),De(t,()=>t.deleteFramebuffer(this.framebuffer)),De(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),De(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),De(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,n){return this.throwIfDisposed(),KBe(this.gl,t,n,this.textureConfig)}createFloat16MatrixTexture(t,n){return this.throwIfDisposed(),ZBe(this.gl,t,n,this.textureConfig)}createUnsignedBytesMatrixTexture(t,n){return this.throwIfDisposed(),JBe(this.gl,t,n,this.textureConfig)}uploadPixelDataToTexture(t,n){this.throwIfDisposed(),r5e(this.gl,t,n)}uploadDenseMatrixToTexture(t,n,r,i){this.throwIfDisposed(),n5e(this.gl,t,n,r,i,this.textureConfig)}createFloat16PackedMatrixTexture(t,n){return this.throwIfDisposed(),e5e(this.gl,t,n,this.textureConfig)}createPackedMatrixTexture(t,n){return this.throwIfDisposed(),QBe(this.gl,t,n,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(eG(this.gl,this.framebuffer),this.outputTexture=null),De(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,n,r){return this.downloadMatrixDriver(t,()=>o5e(this.gl,n,r,this.textureConfig))}downloadPackedMatrixFromBuffer(t,n,r,i,s,o){return a5e(this.gl,t,n,r,i,s,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,n){return s5e(this.gl,t,n)}createBufferFromTexture(t,n,r){this.bindTextureToFrameBuffer(t);const i=i5e(this.gl,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let n,r;if(ae().getBool("WEBGL_FENCE_API_ENABLED")){const i=t,s=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=()=>{const o=i.clientWaitSync(s,0,0);return o===i.ALREADY_SIGNALED||o===i.CONDITION_SATISFIED},n=s}else ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(n,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:n,isFencePassed:r}}downloadMatrixFromPackedTexture(t,n,r){return this.downloadMatrixDriver(t,()=>u5e(this.gl,n,r))}createProgram(t){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=qBe(n));const r=O4e(n);De(n,()=>n.attachShader(r,this.vertexShader)),De(n,()=>n.attachShader(r,t)),N4e(n,r);const i=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&eN(n,i),i}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const n=this.gl;De(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),t5e(n,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(De(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&eN(this.gl,this.program),De(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,n,r=!0){return this.throwIfDisposed(),r?j4e(this.gl,t,n):U4e(this.gl,t,n)}getAttributeLocation(t,n){return this.throwIfDisposed(),De(this.gl,()=>this.gl.getAttribLocation(t,n))}getUniformLocationNoThrow(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)}setInputMatrixTexture(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),W4e(this.gl,t,n,r)}setOutputMatrixTexture(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)}setOutputPackedMatrixTexture(t,n,r){this.throwIfDisposed();const[i,s]=M1(n,r);this.setOutputMatrixTextureDriver(t,i,s)}setOutputMatrixWriteRegion(t,n,r,i){this.setOutputMatrixWriteRegionDriver(r,t,i,n)}setOutputPackedMatrixWriteRegion(t,n,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&eN(this.gl,this.program),wS(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}De(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),De(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=xS(this.gl,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.createQuery();return r.beginQuery(i.TIME_ELAPSED_EXT,s),s}const t=this.getQueryTimerExtensionWebGL1(),n=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,n),n}endQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await SM(()=>this.disposed||this.isQueryAvailable(t,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,n){if(n===0)return null;if(n===2){const r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,n){if(n===0)return!0;if(n===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),i=r.getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(t){return new Promise(n=>{this.addItemToPoll(()=>t.isFencePassed(),()=>n())})}pollItems(){const t=l5e(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=t;++n){const{resolveFn:r}=this.itemsToPoll[n];r()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,n){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in ae().platform&&(r=ae().platform.setTimeoutCustom.bind(ae().platform)),SM(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),tN(this.gl,t,this.framebuffer),this.debug&&wS(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(tN(this.gl,this.outputTexture,this.framebuffer),this.debug&&wS(this.gl)):eG(this.gl,this.framebuffer)}downloadMatrixDriver(t,n){this.bindTextureToFrameBuffer(t);const r=n();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(t,n,r){this.throwIfDisposed();const i=this.gl;tN(i,t,this.framebuffer),this.debug&&wS(i),this.outputTexture=t,De(i,()=>i.viewport(0,0,n,r)),De(i,()=>i.scissor(0,0,n,r))}setOutputMatrixWriteRegionDriver(t,n,r,i){this.throwIfDisposed(),De(this.gl,()=>this.gl.scissor(t,n,r,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function l5e(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:c5e,bincountImpl:woe,bincountReduceImpl:f5e,bitwiseAndImpl:h5e,castImpl:d5e,ceilImpl:p5e,concatImpl:g5e,equalImpl:m5e,expImpl:y5e,expm1Impl:b5e,floorImpl:v5e,gatherNdImpl:x5e,gatherV2Impl:w5e,greaterImpl:C5e,greaterEqualImpl:S5e,lessImpl:_5e,lessEqualImpl:$5e,linSpaceImpl:k5e,logImpl:E5e,maxImpl:A5e,maximumImpl:T5e,minimumImpl:D5e,multiplyImpl:I5e,negImpl:F5e,notEqualImpl:O5e,prodImpl:N5e,raggedGatherImpl:M5e,raggedRangeImpl:R5e,raggedTensorToTensorImpl:P5e,rangeImpl:L5e,rsqrtImpl:B5e,scatterImpl:z5e,sigmoidImpl:j5e,simpleAbsImpl:Coe,sliceImpl:U5e,sparseFillEmptyRowsImpl:W5e,sparseReshapeImpl:V5e,sparseSegmentReductionImpl:Soe,sqrtImpl:G5e,staticRegexReplaceImpl:H5e,stridedSliceImpl:q5e,stringNGramsImpl:X5e,stringSplitImpl:Y5e,stringToHashBucketFastImpl:K5e,subImpl:Z5e,tileImpl:J5e,topKImpl:Q5e,transposeImpl:Q5,uniqueImpl:eze}=r3e;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(e,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${e}.${n}`)}function di(e,t){return t===1?[e]:_oe(e,t)}function tze(e,t){if(e===1)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nze{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Qr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=di("rc",this.rank),r=Zt(this.rank),i=this.getOutOfBoundsCondition(n),s=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(t){const n=[];for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){let s=`${r===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)s=`${t[t.length-1-o]},`+s;n.push(s)}return n}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let r=this.rank-2;r<this.rank;r++)n+=`${t[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(n+="||");return n}getSetup(t){if(this.rank===1)return"";const n=t.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${i};
    `}getOutput(t){const n=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $oe{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length);let r="";for(let i=0;i<4;i++){let s="thisRC = rc;";i%2===1&&(s+="thisRC.z += 1;"),i>1&&(s+="thisRC.y += 1;"),r+=`
        ${s}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${rze(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Z5():K5(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${r}

        setOutput(result);
      }
    `}}function rze(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?tBe(["r","c","d"],"inputShape"):ig(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ize{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,n,r){const i=sG(n,r),s=oG(t,i,r);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const o=iG(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const u=this.freeTextures[s].pop();return this.usedTextures[s].push(u),u}let a;return i===Cr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===Cr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===Cr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===Cr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===Cr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(t,n,r,i){if(this.freeTextures==null)return;const s=sG(r,i),o=oG(n,s,i);o in this.freeTextures||(this.freeTextures[o]=[]);const a=iG(n,s,this.gpgpu.gl,this.gpgpu.textureConfig,i),u=ae().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[o],c=l&&l.indexOf(t);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function sze(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function iG(e,t,n,r,i){const s=oze(t,r);let o;if(i){const[u,l]=M1(e[0],e[1]);o=u*l}else{const[u,l]=Lw(e[0],e[1]);o=u*l}const a=sze(n,s);return o*a}function oze(e,t){switch(e){case Cr.PACKED_2X2_FLOAT32:return voe(t);case Cr.PACKED_2X2_FLOAT16:return xoe(t);case Cr.UNPACKED_FLOAT32:return moe(t);case Cr.UNPACKED_FLOAT16:return yoe(t);case Cr.PACKED_4X1_UNSIGNED_BYTE:return boe(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function aze(e){return ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Cr.PACKED_2X2_FLOAT32:Cr.UNPACKED_FLOAT32:e?Cr.PACKED_2X2_FLOAT16:Cr.UNPACKED_FLOAT16}function sG(e,t){if(e===Gs.UPLOAD)return Cr.PACKED_2X2_FLOAT32;if(e===Gs.RENDER||e==null)return aze(t);if(e===Gs.DOWNLOAD||e===Gs.PIXELS)return Cr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function oG(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class du{constructor(t,n){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Wo="if (isnan(x)) return x;",uze="return x;",aG="return abs(x);",lze="return (x >= 0.0) ? x : (exp(x) - 1.0);",cze=Wo+`
  return (x < 0.0) ? 0.0 : x;
`,fze=Wo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Lc="return x;",hze="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dze="return x;",pze=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,gze=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,mze=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,yze="return 1.0 / (1.0 + exp(-1.0 * x));";class Yc{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bze{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length);const n=t.length,r=di("rc",n),i=Zt(n),s=tze(n,r),o=r.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vze=XT,xze=1e-7,wze=1e-4,_S={};function Cze(e){return e in _S||(_S[e]={}),_S[e]}const Sze=ae().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),_ze=600;function $ze(){return ae().global.screen==null?1024:ae().global.screen.height*ae().global.screen.width*window.devicePixelRatio*_ze/1024/1024}class wD extends vA{nextDataId(){return wD.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ae().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof iN)n=t;else{const r=Ta(ae().getNumber("WEBGL_VERSION"),t);n=new iN(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=Ta(ae().getNumber("WEBGL_VERSION"));n=new iN(r),this.binaryCache=Cze(ae().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new ize(this.gpgpu),this.numMBBeforeWarning=$ze(),this.texData=new R4(this,ra())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,r,i,s,o){const a=this.makeTensorInfo(n,r),u=this.texData.get(a.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[i,s]},u.texShape=[i,s];const l=CS(n),c=new rG(l,!1,o),f=this.runWebGLProgram(c,[a],r,[[i,s]]);return f.shape=n,u.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(t,n,r){if((ae().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ae().getBool("DEBUG"))&&this.checkNumericalProblems(t),r==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:r,values:t,usage:Gs.UPLOAD,refCount:1}),i}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){const n=this.texData.get(t);n.refCount--}}move(t,n,r,i,s){if(ae().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:i,values:n,usage:Gs.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const n=this.texData.get(t),{values:r,dtype:i,complexTensorInfos:s,slice:o,shape:a,isPacked:u}=n;if(o!=null){let h;u?h=new Yc(a,Lc):h=new du(a,Lc);const d=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:i}],i),p=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),p}if(r!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return r;const l=this.activeTimers!=null;let c;l&&(c=ui());let f;if(i==="complex64"){const h=this.readSync(s.real.dataId),d=this.readSync(s.imag.dataId);f=ec(h,d)}else f=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=ui()-c),this.convertAndCacheOnCPU(t,f)}async read(t){if(this.pendingRead.has(t)){const p=this.pendingRead.get(t);return new Promise(m=>p.push(m))}const n=this.texData.get(t),{values:r,shape:i,slice:s,dtype:o,complexTensorInfos:a,isPacked:u}=n;if(s!=null){let p;u?p=new Yc(i,Lc):p=new du(i,Lc);const m=this.runWebGLProgram(p,[{dataId:t,shape:i,dtype:o}],o),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(r!=null)return this.convertAndCacheOnCPU(t);if(ae().getBool("DEBUG")&&!ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ae().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,c;if(o!=="complex64"&&ae().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(t);const p=this.texData.get(c.dataId);l=this.gpgpu.createBufferFromTexture(p.texture.texture,...vS(i))}this.pendingRead.set(t,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],g=p[1];f=ec(m,g)}else if(l==null)f=this.getValuesFromTexture(t);else{const p=ce(i);f=this.gpgpu.downloadFloat32MatrixFromBuffer(l,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),l!=null){const p=this.gpgpu.gl;De(p,()=>p.deleteBuffer(l))}const h=this.convertAndCacheOnCPU(t,f),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach(p=>p(h)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&ra().removeDataId(t,this),this.pendingDeletes--),h}readToGPU(t,n={}){const r=this.texData.get(t),{values:i,shape:s,slice:o,dtype:a,isPacked:u,texture:l}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let d;u?d=new Yc(s,Lc):d=new du(s,Lc);const p=this.runWebGLProgram(d,[{dataId:t,shape:s,dtype:a}],a),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,n.customTexShape),f=ra().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:f},h.texture)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const r=n.map(i=>Jl(i));return ft(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ft(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){const r=t[n];if(!A4e(r))throw ae().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:n,dtype:r,isPacked:i}=this.texData.get(t),s=ce(n);if(ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(t),d=this.texData.get(h.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(d.texture.texture,...vS(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(h),p}const o=ae().getBool("WEBGL_PACK")&&i===!0,a=o?CS(n):n,u=o?new VBe(a):new WBe(a),l=this.runWebGLProgram(u,[{shape:a,dtype:r,dataId:t}],"float32"),c=this.texData.get(l.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(l),f}timerAvailable(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const n=this.activeTimers,r=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,t();const s=Tu(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),o=Tu(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(s);a.kernelMs=HQ(u),a.getExtraProfileInfo=()=>u.map((l,c)=>({name:o[c],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ui(),endMs:null}}endTimer(t){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=ui(),t)}async getQueryTime(t){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:r}=this.texData.get(t);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:n,dtype:r,texShape:i,usage:s,isPacked:o,slice:a}=this.texData.get(t),u=a&&a.origDataId||t,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,s,o)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=Sze){return ae().getBool("WEBGL_CPU_FORWARD")&&t.every(r=>this.texData.get(r.dataId).texture==null&&ce(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){js("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=t.dataSync();return vze(t.shape,n)}packedUnaryOp(t,n,r){const i=new Yc(t.shape,n),s=this.compileAndRun(i,[t],r);return ra().makeTensorFromTensorInfo(s)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const i=Coe(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,i)}if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,aG,t.dtype);const n=new du(t.shape,aG),r=this.compileAndRun(n,[t]);return ra().makeTensorFromTensorInfo(r)}makeTensorInfo(t,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&cu(r[0])){const s=r.map(o=>gu(o));i=this.write(s,t,n)}else i=this.write(r,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}}makeOutput(t,n,r){return ra().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,r),this)}unpackTensor(t){const n=new bze(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){const n=new nze(t.shape),r=!0;return this.runWebGLProgram(n,[t],t.dtype,null,r)}packedReshape(t,n){const r=[Wm(t.shape),...Vm(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[Wm(n),...Vm(n)],o=new $oe(s,r),a=!0,u=[r],l=this.runWebGLProgram(o,[i],t.dtype,u,a);return{dataId:l.dataId,shape:n,dtype:l.dtype}}decode(t,n){const r=this.texData.get(t),{isPacked:i,shape:s,dtype:o}=r;if(n!=null){const h=ce(s),d=n[0]*n[1]*4;z(h<=d,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=CS(s);let u;i?u=new UBe(a):u=new jBe(a);const l=!0,c=[n??vS(a)],f=this.runWebGLProgram(u,[{shape:a,dtype:o,dataId:t}],o,c,l,n);return{dtype:o,shape:s,dataId:f.dataId}}runWebGLProgram(t,n,r,i,s=!1,o){const a=this.makeTensorInfo(t.outputShape,r),u=this.texData.get(a.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===Uv.DENSE){const y=o??vS(t.outputShape);u.texShape=y.map(b=>b*2)}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),ce(a.shape)===0)return u.values=gr(a.dtype,0),a;const l=[],c=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!t.packedInputs&&ce(y.shape)<=ae().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!t.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!H$(b.shape,y.shape)){const x=y,v=y.shape;y.shape=b.shape,y=this.packedReshape(y,v),l.push(y),b=this.texData.get(y.dataId),x.shape=v}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:u,isUniform:!1},h=zBe(t,c,f),d=this.getAndSaveBinary(h,()=>LBe(this.gpgpu,t,c,f)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),ae().get("ENGINE_COMPILE_ONLY")||BBe(this.gpgpu,d,c,f,i),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),p&&(m=this.endTimer(m),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(m)}));const g=ae().get("WEBGL_FLUSH_THRESHOLD");if(g>0){const y=ui();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!ae().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&s===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(t,n,r,i,s=!1){return r=r||n[0].dtype,this.runWebGLProgram(t,n,r,i,s)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ae().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ue(()=>{if(!ae().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=ae().getBool("DEBUG");ae().set("DEBUG",!1);const n=this.abs(et(1e-8)).dataSync()[0];if(ae().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?xze:wze}uploadToGPU(t){const n=this.texData.get(t),{shape:r,dtype:i,values:s,texture:o,usage:a,isPacked:u}=n;if(o!=null)return;const l=this.activeTimers!=null;let c;l&&(c=ui());let f=n.texShape;if(f==null&&(f=H4e(r,u),n.texShape=f),s!=null){const h=CS(r);let d,p=f[1],m=f[0];const g=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(u||!g)&&([p,m]=M1(f[0],f[1])),u?d=new HBe(h,g):d=new rG(h,g);const y=g?[m,p]:f,b=this.makeTensorInfo(y,i),x=this.texData.get(b.dataId);g?x.usage=Gs.PIXELS:x.usage=Gs.UPLOAD,x.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),p,m,s);const v=[[m,p]],w=!0,C=this.runWebGLProgram(d,[b],i,v,w),S=this.texData.get(C.dataId);n.texShape=S.texShape,n.isPacked=S.isPacked,n.usage=S.usage,ae().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=S.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=ui()-c)}else{const h=this.acquireTexture(f,a,i,u);n.texture=h}}convertAndCacheOnCPU(t,n){const r=this.texData.get(t),{dtype:i}=r;return n!=null&&(r.values=kze(n,i)),r.values}acquireTexture(t,n,r,i){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,i)}computeBytes(t,n){return t[0]*t[1]*_v(n)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(const[,n]of Object.entries(this.binaryCache)){const r=new Promise(i=>{try{this.checkCompletion_(n),i(!0)}catch(s){throw s}});t.push(r)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await JB(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(coe(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:n,customUniformLocations:r,infLoc:i,nanLoc:s,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:u}=goe(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=n,t.customUniformLocations=r,t.infLoc=i,t.nanLoc=s,t.outShapeLocation=o,t.outShapeStridesLocation=a,t.outTexShapeLocation=u}}createTensorFromGPUData(t,n,r){t.channels=t.channels||"RGBA";const{texture:i,height:s,width:o,channels:a}=t,u=ra().backend;if(!u.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=u.writeTexture(i,n,r,s,o,a);return ra().makeTensorFromDataId(l,n,r,u)}}wD.nextDataId=0;function kze(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){const n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */X4()&&J4("webgl",()=>new wD,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ez=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class yp{constructor(t,n,r){this.variableNames=["A","B"],this.outputShape=rt(n,r),this.enableShapeUniforms=Qr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const og=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class z1{constructor(t,n,r,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=rt(n,r);const s=this.outputShape.length;this.enableShapeUniforms=Qr(s);let o="";if(i)if(s===0||ce(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Zt(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=di("coords",s);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Eze={kernelName:t1,backendName:"webgl",kernelFunc:$s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _h(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),a=$s({inputs:{x:r},backend:n}),u=$s({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:u},s}const Aze={kernelName:TA,backendName:"webgl",kernelFunc:_h};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const koe="return (a < 0.) ? b * a : a;",Eoe=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Tze(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:s}=r,o=n.makeTensorInfo([],"float32",fc(s,"float32")),a=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new z1(Eoe,i.shape,o.shape):new yp(koe,i.shape,o.shape),u=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),u}const Dze={kernelName:M2,backendName:"webgl",kernelFunc:Tze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aoe="return (a < 0.) ? b * a : a;",Toe=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Ize(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t,s=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new z1(Toe,r.shape,i.shape):new yp(Aoe,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}const Fze={kernelName:ew,backendName:"webgl",kernelFunc:Ize};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j1="if (isnan(x)) return x;";function kt({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{const{x:o}=i,a=s,u=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const f=a.texData.get(o.dataId),h=n(f.values,u);return a.makeTensorInfo(o.shape,u,h)}const l=ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let c;return l?c=new Yc(o.shape,t):c=new du(o.shape,e),a.runWebGLProgram(c,[o],u)}}function Pr({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:o,backend:a})=>{const{a:u,b:l}=o,c=a;if(r&&u.dtype==="complex64"){const p=c.texData.get(u.dataId),m=c.texData.get(l.dataId),[g,y]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(x=>{const[v,w]=x,C={dataId:v.dataId,dtype:v.dtype,shape:u.shape},S={dataId:w.dataId,dtype:w.dtype,shape:l.shape},_=new yp(e,u.shape,l.shape);return c.runWebGLProgram(_,[C,S],Hi(v.dtype,w.dtype))}),b=_h({inputs:{real:g,imag:y},backend:c});return c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(y),b}const f=s||Hi(u.dtype,l.dtype);if((u.dtype==="string"||l.dtype==="string"||c.shouldExecuteOnCPU([u,l]))&&i!=null){const p=c.texData.get(u.dataId).values,m=c.texData.get(l.dataId).values,g=u.dtype==="string"?tc(p):p,y=u.dtype==="string"?tc(m):m,[b,x]=i(u.shape,l.shape,g,y,f),v=c.makeTensorInfo(x,f),w=c.texData.get(v.dataId);return w.values=b,v}const h=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let d;return h?d=new z1(t,u.shape,l.shape,n):d=new yp(e,u.shape,l.shape),c.runWebGLProgram(d,[u,l],f)}}function Wv(e,t=!1){if(e==="linear")return t?dze:uze;if(e==="relu")return t?gze:cze;if(e==="elu")return t?pze:lze;if(e==="relu6")return t?mze:fze;if(e==="prelu")return t?Toe:Aoe;if(e==="leakyrelu")return t?Eoe:koe;if(e==="sigmoid")return t?yze:hze;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Doe{constructor(t,n,r,i=!1,s=!1,o=!1,a=null,u=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Qr(this.outputShape.length);const c=i?t[1]:t[2],f=Math.ceil(c/2),h=i?"i * 2, rc.y":"rc.y, i * 2",d=s?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",y="";a&&(u?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let x="rc.x",v="rc.x";t[0]<n[0]?x=`imod(rc.x, ${t[0]})`:n[0]<t[0]&&(v=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${x};
        int batchB = ${v};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class lG{constructor(t,n,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=rt(n,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG="return a * b;";function tz(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,s=Hi(r.dtype,i.dtype);if(r.dtype==="complex64"){const a=n.texData.get(r.dataId),u=n.texData.get(i.dataId),l=new lG(uG.REAL,r.shape,i.shape),c=new lG(uG.IMAG,r.shape,i.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],h=n.runWebGLProgram(l,f,"float32"),d=n.runWebGLProgram(c,f,"float32"),p=_h({inputs:{real:h,imag:d},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),p}if(n.shouldExecuteOnCPU([r,i])){const a=n.texData.get(r.dataId),u=n.texData.get(i.dataId),[l,c]=I5e(r.shape,i.shape,a.values,u.values,s),f=n.makeTensorInfo(c,s),h=n.texData.get(f.dataId);return h.values=l,f}let o;return ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new z1(cG,r.shape,i.shape):o=new yp(cG,r.shape,i.shape),n.runWebGLProgram(o,[r,i],s)}const Oze={kernelName:c1,backendName:"webgl",kernelFunc:tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nze(e,t,n){const r=[Wm(e.shape),...Vm(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},s=[Wm(t),...Vm(t)],o=new $oe(s,r),a=!0,u=[r],l=n.runWebGLProgram(o,[i],e.dtype,u,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ke(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:s}=r,o=n,a=ce(i.shape),u=L4(s,a),l=ce(u);z(a===l,()=>`The new shape (${u}) has ${l} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(i.dataId);return c.isPacked&&!H$(i.shape,u)&&!(c.texture!==null&&H$(c.shape,u))?Nze(i,u,o):(o.incRef(i.dataId),{dataId:i.dataId,shape:u,dtype:i.dtype})}const Mze={kernelName:nw,backendName:"webgl",kernelFunc:ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fG{constructor(t,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:s,outSize:o}=t;this.outputShape=[i,o];const a=Math.floor(r/4)*4,u=r%4;let l="sumValue += dot(values, ones);";if(n!=null){const f=1/n;l=`sumValue += dot(values * ${ap(f)?f.toPrecision(2):f}, ones);`}let c="";s%r>0&&(c=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rze{constructor(t,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:s,outSize:o}=t;this.outputShape=[i,o];let a="0.0",u="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",u="min"):n==="max"&&(a="-1.0 / 1e-20",u="max");let l=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?l="sumValue":n==="prod"?l="prodValue":n==="all"?l="allValue":n==="any"&&(l="anyValue");const c=Math.floor(r/4)*4,f=r%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${f===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${f===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${f===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pze(e){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const n=t.length?t[t.length-1].outSize:e[1],r=sD(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}function ag(e,t,n,r){const i=Pze(e.shape);let s=e;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:u,outSize:l}=i[o];let c,f;n==="mean"?c=o===0?new fG({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l},a):new fG({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l}):c=new Rze({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l},n),f=s,s=r.runWebGLProgram(c,[s],t),f.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(f)}return s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lze{constructor(t,n){this.variableNames=["A"];const r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[n[o]];this.outputShape=r,this.rank=r.length;const i=Zt(this.rank),s=Bze(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}}function Bze(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zze{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(t.length);for(let c=0;c<r.length;c++)r[c]=t[n[c]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=Zt(this.rank),s=_oe("rc",this.rank),o=new Array(this.rank);for(let c=0;c<n.length;c++)o[n[c]]=s[c];const a=`vec2(${o.slice(-2).join()})`,u=`++${s[this.rank-1]} < ${r[this.rank-1]}`,l=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${u}) {
        result[1] = ${l};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${l};
        if(${u}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CD(e,t,n){const r=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zze(e.shape,t):new Lze(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jze(e,t,n,r){const i=t,s=e.shape.length,o=dt(i,e.shape);let a=o;const u=Tn(a,s),l=u!=null;let c=e;l&&(c=CD(e,u,r),a=zn(a.length,s)),Rr("sum",a,s);const[f,h]=yr(c.shape,a);let d=f;n&&(d=Bn(f,o));const p=ce(h),g=ce(e.shape)/p,y=ke({inputs:{x:c},attrs:{shape:[g,p]},backend:r}),b=AT(e.dtype),x=ag(y,b,"sum",r),v=ke({inputs:{x},attrs:{shape:d},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(x),l&&r.disposeIntermediateTensorInfo(c),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;return jze(i,s,o,n)}const Uze={kernelName:uw,backendName:"webgl",kernelFunc:SD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ai(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{perm:s}=r,o=n,a=i.shape.length,u=new Array(a);for(let c=0;c<u.length;c++)u[c]=i.shape[s[c]];let l;if(o.shouldExecuteOnCPU([i])){const f=o.texData.get(i.dataId).values,h=Q5(f,i.shape,i.dtype,s,u);l=o.makeTensorInfo(u,i.dtype);const d=o.texData.get(l.dataId);d.values=h}else l=CD(i,s,o);return l}const Wze={kernelName:Vd,backendName:"webgl",kernelFunc:Ai};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ioe=1e3;function q$({a:e,b:t,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:u=null}){const l=e.shape.length,c=t.shape.length,f=n?e.shape[l-2]:e.shape[l-1],h=r?t.shape[c-1]:t.shape[c-2],d=n?e.shape[l-1]:e.shape[l-2],p=r?t.shape[c-2]:t.shape[c-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),y=ce(m),b=ce(g),v=rt(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([d,p]);z(f===h,()=>`Error in matMul: inner shapes (${f}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`);const w=n?[y,f,d]:[y,d,f],C=r?[b,p,h]:[b,h,p],S=ke({inputs:{x:e},backend:i,attrs:{shape:w}}),_=ke({inputs:{x:t},backend:i,attrs:{shape:C}}),$=[S,_],k=Math.max(y,b),E=n?S.shape[1]:S.shape[2],F=s!=null,T=o!=null,I=u==="leakyrelu",D=u!=null?Wv(u,!0):null,N=F||T||I||D!=null;let V;if((d===1||p===1)&&E>Ioe&&N===!1){let A=S,M=_;n&&(A=Ai({inputs:{x:S},backend:i,attrs:{perm:[0,2,1]}}),$.push(A)),r&&(M=Ai({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),$.push(M));const P=p!==1,j=p===1;let q=A;P&&(q=ke({inputs:{x:A},backend:i,attrs:{shape:[k,E,1]}}),$.push(q));const B=p===1?2:1;let O=M;j&&(O=ke({inputs:{x:M},backend:i,attrs:{shape:[k,1,E]}}),$.push(O));const G=tz({inputs:{a:q,b:O},backend:i});V=SD({inputs:{x:G},backend:i,attrs:{axis:B,keepDims:!0}}),$.push(G)}else{const A=Hi(e.dtype,t.dtype),M=new Doe(w,C,[k,d,p],n,r,F,D,T,I),P=[S,_];if(s!=null&&P.push(s),T&&P.push(o),I){const j=i.makeTensorInfo([],"float32",fc(a,"float32"));P.push(j),$.push(j)}V=i.runWebGLProgram(M,P,A)}const U=ke({inputs:{x:V},backend:i,attrs:{shape:v}});$.push(V);for(const A of $)i.disposeIntermediateTensorInfo(A);return U}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vze(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s,bias:o,preluActivationWeights:a}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:f}=r;return q$({a:i,b:s,transposeA:u,transposeB:l,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:c})}const Gze={kernelName:$v,backendName:"webgl",kernelFunc:Vze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG="return abs(x);";function Hze(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const s=n.texData.get(r.dataId),o=Coe(s.values);return n.makeTensorInfo(r.shape,r.dtype,o)}let i;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new Yc(r.shape,hG):i=new du(r.shape,hG),n.runWebGLProgram(i,[r],r.dtype)}const qze={kernelName:d2,backendName:"webgl",kernelFunc:Hze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xze=Wo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Yze=kt({opSnippet:Xze}),Kze={kernelName:M0,backendName:"webgl",kernelFunc:Yze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zze=Wo+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Jze=kt({opSnippet:Zze}),Qze={kernelName:R0,backendName:"webgl",kernelFunc:Jze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG="return a + b;",e6e=Pr({opSnippet:dG,packedOpSnippet:dG,supportsComplex:!0,cpuKernelImpl:c5e}),t6e={kernelName:Yp,backendName:"webgl",kernelFunc:e6e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n6e{constructor(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map((s,o)=>`T${o}`);const r=[];this.variableNames.forEach(s=>{r.push(`float v${s} = get${s}AtOutCoords();`)});const i=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r6e{constructor(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((s,o)=>`T${o}`);const r=[];this.variableNames.forEach(s=>{r.push(`vec4 v${s} = get${s}AtOutCoords();`)});const i=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O_(e){const{inputs:t,backend:n}=e,r=t;if(r.length===1)return $s({inputs:{x:r[0]},backend:n});if(r.length>ae().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(r.length/2),l=O_({inputs:r.slice(0,u),backend:n}),c=O_({inputs:r.slice(u),backend:n});return O_({inputs:[l,c],backend:n})}const i=r.map(u=>u.dtype).reduce((u,l)=>Hi(u,l)),s=r.map(u=>u.shape),a=ae().getBool("WEBGL_PACK")?new r6e(r[0].shape,s):new n6e(r[0].shape,s);return n.runWebGLProgram(a,r,i)}const i6e={kernelName:p2,backendName:"webgl",kernelFunc:O_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s6e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=dt(s,i.shape);let l=u;const c=Tn(l,a);let f=i;c!=null&&(f=Ai({inputs:{x:i},backend:n,attrs:{perm:c}}),l=zn(l.length,a)),Rr("all",l,a);const[h,d]=yr(f.shape,l),p=ce(d),m=ke({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),g=ag(m,m.dtype,"all",n);let y;if(o){const b=Bn(h,u);y=ke({inputs:{x:g},backend:n,attrs:{shape:b}})}else y=ke({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(f),y}const o6e={kernelName:SA,backendName:"webgl",kernelFunc:s6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=dt(s,i.shape);let l=u;const c=Tn(l,a);let f=i;c!=null&&(f=Ai({inputs:{x:i},backend:n,attrs:{perm:c}}),l=zn(l.length,a)),Rr("any",l,a);const[h,d]=yr(f.shape,l),p=ce(d),m=ke({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),g=ag(m,m.dtype,"any",n);let y;if(o){const b=Bn(h,u);y=ke({inputs:{x:g},backend:n,attrs:{shape:b}})}else y=ke({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(f),y}const u6e={kernelName:_A,backendName:"webgl",kernelFunc:a6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l6e{constructor(t,n,r){this.variableNames=["A"];const{windowSize:i,batchSize:s,outSize:o}=t;r||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];const a=n==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c6e{constructor(t,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,z(t.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const s=t[t.length-1],o=Math.ceil(s/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,u=a.length,l=Zt(u),c=di("coords",u);let f,h;if(o===1){h=u+1;const _=Zt(h);f=`
        ${_} sourceLocR = ${_}(${c.join()}, 0);
        ++${c[u-1]};
        ${_} sourceLocG = ${_}(${c.join()}, 0);
        ++${c[u-2]};
        ${_} sourceLocA = ${_}(${c.join()}, 0);
        --${c[u-1]};
        ${_} sourceLocB = ${_}(${c.join()}, 0);
        --${c[u-2]};`}else h=u,f=`
        ${l} sourceLocR = coords;
        ++${c[u-1]};
        ${l} sourceLocG = coords;
        ++${c[u-2]};
        ${l} sourceLocA = coords;
        --${c[u-1]};
        ${l} sourceLocB = coords;
        --${c[u-2]};`;const d=["x","y","z","w","u","v"].slice(0,h),p="."+d[h-1],m=d.map(_=>"int "+_),g=di("sourceLocR",h-1).concat("inIdx.r"),y=di("sourceLocG",h-1).concat("inIdx.g"),b=di("sourceLocB",h-1).concat("inIdx.b"),x=di("sourceLocA",h-1).concat("inIdx.a"),v=r==="max"?"greaterThan":"lessThan",w=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${x.join()})));`,C=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${x.join()}) : 0.)`,S=i?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${S}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${c[u-1]} < ${a[u-1]-1};
        bool hasNextRow = ${c[u-2]} < ${a[u-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(e,t,n,r=null){let i=t.shape[0],s=t.shape[1];r!=null&&(i=r.shape[0],s=r.shape[1]);const o=sD(s),a={windowSize:o,inSize:s,batchSize:i,outSize:Math.ceil(s/o)},u=new l6e(a,n,r==null),l=[t];r!=null&&l.push(r);const c=e.runWebGLProgram(u,l,"int32");if(c.shape[1]===1)return c;const f=Foe(e,t,n,c);return e.disposeIntermediateTensorInfo(c),f}function Ooe(e,t,n,r=null){const i=r!=null?r.shape:t.shape,s=i[i.length-1],o=sD(s),a=new c6e(i,o,n,r==null),u=r==null?[t]:[t,r],l=e.runWebGLProgram(a,u,"int32");if(l.shape.length===t.shape.length){const c=Ooe(e,t,n,l);return e.disposeIntermediateTensorInfo(l),c}return l}function Noe(e,t,n,r){const i=[n];if(Rr("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,t.shape.length),!ae().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const s=[],o=e.texData.get(t.dataId),a=o!==null&&o.isPacked;let u=t;a&&(u=e.unpackTensor(t),s.push(u));const[l,c]=yr(u.shape,i),f=ce(c),h=ke({inputs:{x:u},backend:e,attrs:{shape:[-1,f]}});s.push(h);const d=Foe(e,h,r);s.push(d);const p=ke({inputs:{x:d},backend:e,attrs:{shape:l}});return s.forEach(m=>e.disposeIntermediateTensorInfo(m)),p}return Ooe(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;let o=dt(s,i.shape);const a=Tn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Ai({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=zn(o.length,u.shape.length)),Rr("argMax",[o[0]],u.shape.length);const c=Noe(n,u,o[0],"max");return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),c}const h6e={kernelName:g2,backendName:"webgl",kernelFunc:f6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;let o=dt(s,i.shape);const a=Tn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Ai({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=zn(o.length,u.shape.length)),Rr("argMin",[o[0]],u.shape.length);const c=Noe(n,u,o[0],"min");return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),c}const p6e={kernelName:m2,backendName:"webgl",kernelFunc:d6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g6e=Wo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,m6e=kt({opSnippet:g6e}),y6e={kernelName:P0,backendName:"webgl",kernelFunc:m6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b6e=Wo+"return log(x + sqrt(x * x + 1.0));",v6e=kt({opSnippet:b6e}),x6e={kernelName:L0,backendName:"webgl",kernelFunc:v6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w6e=Wo+`
  return atan(x);
`,C6e=kt({opSnippet:w6e}),S6e={kernelName:B0,backendName:"webgl",kernelFunc:C6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _6e=ez+`
  return atan(a, b);
`,$6e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+og+`
  return result;
`,k6e=Pr({opSnippet:_6e,packedOpSnippet:$6e}),E6e={kernelName:j0,backendName:"webgl",kernelFunc:k6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A6e=Wo+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,T6e=kt({opSnippet:A6e}),D6e={kernelName:z0,backendName:"webgl",kernelFunc:T6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vv{constructor(t,n,r,i=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideHeight,u=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const m=n==="avg",g=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,y=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let b="0.0";if(m||(b="-1.0 / 1e-20"),r){const _=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${u});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${_} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?s?g:y:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const x="max";let v=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(v="avgValue / max(count, 1.0)");const w=Math.floor(o/4)*4,C=o%4,S=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${x}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${u});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${S}
          }

          int xC = xCCorner + ${w};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${S}
          }
        }
        setOutput(${v});
      }
    `}}class nz{constructor(t,n,r,i=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideDepth,u=t.strideHeight,l=t.strideWidth,c=t.dilationDepth,f=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,m=t.effectiveFilterWidth,g=t.padInfo.front,y=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;const x=n==="avg";let v="0.0";if(x||(v="-1.0 / 1e-20"),r){const k=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${u}, ${l});
        const ivec3 pads = ivec3(${g}, ${y}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${k} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?s?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const S=Math.floor(o/4)*4,_=o%4,$=`
      if (${x}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${u}, ${l});
      const ivec3 pads = ivec3(${g}, ${y}, ${b});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${S}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${S};
            if (${_===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${_===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${_===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I6e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Bw(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;z(Mr(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=jo(i.shape,s,o,l,a,u);if(c.filterWidth===1&&c.filterHeight===1&&_t(c.inShape,c.outShape))return $s({inputs:{x:i},backend:n});const f=new Vv(c,"avg",!1);return n.runWebGLProgram(f,[i],"float32")}const F6e={kernelName:y2,backendName:"webgl",kernelFunc:I6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O6e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r,c=[1,1,1],f=hc(i.shape,s,o,c,a,u,l),h=new nz(f,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}const N6e={kernelName:b2,backendName:"webgl",kernelFunc:O6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M6e{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=u-1-t.padInfo.top,f=l-1-t.padInfo.left,h=1/(n*r);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${f});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class R6e{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterDepth,r=t.filterHeight,i=t.filterWidth,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,f=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=f-1-t.padInfo.front,m=h-1-t.padInfo.top,g=d-1-t.padInfo.left,y=1/(n*r*i);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P6e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=r,f=[1,1,1],h=hc(o.shape,a,u,f,l,c),d=new R6e(h);return n.runWebGLProgram(d,[i],o.dtype)}const L6e={kernelName:kA,backendName:"webgl",kernelFunc:P6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s;Bw([i,s],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=r,c=jo(o.shape,a,u,1,l),f=new M6e(c);return n.runWebGLProgram(f,[i],o.dtype)}const z6e={kernelName:$A,backendName:"webgl",kernelFunc:B6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j6e(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s}=t,{transposeA:o,transposeB:a}=r;return q$({a:i,b:s,transposeA:o,transposeB:a,backend:n})}const U6e={kernelName:v2,backendName:"webgl",kernelFunc:j6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W6e{constructor(t,n,r,i,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],rt(t,n),rt(t,r);let a="0.0";i!=null&&(rt(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="1.0";s!=null&&(rt(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V6e{constructor(t,n,r,i,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],rt(t,n),rt(t,r);let a="vec4(0.0)";i!=null&&(rt(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="vec4(1.0)";s!=null&&(rt(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G6e=({inputs:e,backend:t,attrs:n})=>{const{x:r,mean:i,variance:s,offset:o,scale:a}=e;z(i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),z(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),z(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=n;u==null&&(u=.001);const l=[r,i,s];let c=null;o!=null&&(c=o.shape,l.push(o));let f=null;a!=null&&(f=a.shape,l.push(a));const h=ae().getBool("WEBGL_PACK_NORMALIZATION")?new V6e(r.shape,i.shape,s.shape,c,f,u):new W6e(r.shape,i.shape,s.shape,c,f,u);return t.runWebGLProgram(h,l,l[0].dtype)},H6e={kernelName:F2,backendName:"webgl",kernelFunc:G6e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q6e{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const n=Zt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=X6e(this.rank);let i;const s=t.map((o,a)=>`sourceLoc.${iR[a]} = start[${a}] + coords.${iR[a]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${r}));
      }
    `}}const iR=["x","y","z","w","u","v"];function X6e(e){if(e===1)return"sourceLoc";if(e<=6)return iR.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y6e{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Zt(this.rank),r=di("coords",this.rank),i=di("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,o=`getChannel(getSource(${i.join()}), ${s})`,a=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${o};
        --${i[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${t[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${o};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${n}(${t.map((c,f)=>`start[${f}]`).join()});`:t.map((c,f)=>`${i[f]} = ${r[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6e(e,t,n,r){const i=r.texData.get(e.dataId),s=r.makeTensorInfo(n,e.dtype),o=r.texData.get(s.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=e.dtype;let a=KB(t,Ue(e.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||e.dataId};const u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),s}function U1(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,size:o}=r,[a,u]=iD(i,s,o);if(qB(i,a,u),ce(u)===0)return n.makeTensorInfo(u,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const f=n.texData.get(i.dataId),h=U5e(f.values,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,h)}const{isPacked:l}=n.texData.get(i.dataId),c=YB(i.shape,a,u);if(l||!c){const f=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Y6e(u):new q6e(u),h=[a];return n.runWebGLProgram(f,[i],i.dtype,h)}return n.uploadToGPU(i.dataId),K6e(i,a,u,n)}const Z6e={kernelName:aw,backendName:"webgl",kernelFunc:U1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J6e=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,crops:o}=r;z(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((b,x)=>b*x),u=kw(i.shape,s,a),l=Ew(u.length,s.length),c=Aw(i.shape,s,a),f=n5(o,s.length),h=r5(c,o,s.length),d=[],p=ke({inputs:{x:i},backend:n,attrs:{shape:u}}),m=Ai({inputs:{x:p},backend:n,attrs:{perm:l}}),g=ke({inputs:{x:m},backend:n,attrs:{shape:c}}),y=U1({inputs:{x:g},backend:n,attrs:{begin:f,size:h}});return d.push(p),d.push(m),d.push(g),d.forEach(b=>n.disposeIntermediateTensorInfo(b)),y},Q6e={kernelName:x2,backendName:"webgl",kernelFunc:J6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o}=r,a=n.readSync(i.dataId),u=n.readSync(s.dataId),l=woe(a,u,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,l)}const t8e={kernelName:EA,backendName:"webgl",kernelFunc:e8e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,r8e=`
  return float(int(a.r) & int(b.r));
`;function i8e(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,s=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=ae().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,i])||o===1){const u=n.texData.get(r.dataId).values,l=n.texData.get(i.dataId).values,[c,f]=h5e(r.shape,i.shape,u,l,r.dtype),h=n.makeTensorInfo(f,r.dtype),d=n.texData.get(h.dataId);return d.values=c,h}let a;return s?a=new z1(n8e,r.shape,i.shape,!1):a=new yp(r8e,r.shape,i.shape),n.runWebGLProgram(a,[r,i],r.dtype)}const s8e={kernelName:w2,backendName:"webgl",kernelFunc:i8e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o8e(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,s=n.readSync(r.dataId),o=n.readSync(i.dataId),a=rt(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const a8e={kernelName:AA,backendName:"webgl",kernelFunc:o8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8e="return float(a != b);",Moe=Pr({opSnippet:u8e,cpuKernelImpl:O5e,dtype:"bool"}),l8e={kernelName:Y2,backendName:"webgl",kernelFunc:Moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jw(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.texData.get(r.dataId);return $s({inputs:{x:i.complexTensorInfos.real},backend:n})}const c8e={kernelName:aT,backendName:"webgl",kernelFunc:jw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f8e="return float(int(x));";function h8e(e,t){const n=new du(e.shape,f8e),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sR(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:s}=r;if(s==="complex64"){if(i.dtype==="complex64")return $s({inputs:{x:i},backend:n});const o=Kn(i.shape),a=sR({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),u=_h({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),u}if(i.dtype==="complex64"){const o=jw({inputs:{input:i},backend:n}),a=sR({inputs:{x:o},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(o),a}if(!B4(i.dtype,s)){const o=$s({inputs:{x:i},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:s}}if(n.shouldExecuteOnCPU([i])){const o=n.texData.get(i.dataId).values,[a,u,l]=d5e(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,u,l)}if(s==="int32")return h8e(i,n);if(s==="bool"){const o=n.makeTensorInfo([],"bool",gr("bool",1)),u=Moe({inputs:{a:i,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),u}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${s}`)}const d8e={kernelName:U0,backendName:"webgl",kernelFunc:sR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG="return ceil(x);",p8e=kt({opSnippet:pG,packedOpSnippet:pG,cpuKernelImpl:p5e}),g8e={kernelName:W0,backendName:"webgl",kernelFunc:p8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m8e{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y8e{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{clipValueMin:s,clipValueMax:o}=r;let a;ae().getBool("WEBGL_PACK_CLIP")?a=new y8e(i.shape):a=new m8e(i.shape);const u=[[s],[o]];return n.runWebGLProgram(a,[i],i.dtype,u)}const v8e={kernelName:V0,backendName:"webgl",kernelFunc:b8e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x8e{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gG(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function w8e(e){const{inputs:t,backend:n}=e,{x:r}=t,i=n.texData.get(r.dataId),s=new x8e(r.shape),o=[gG(r,i.complexTensorInfos.real),gG(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}const C8e={kernelName:C2,backendName:"webgl",kernelFunc:w8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S8e{constructor(t){this.outputShape=[],this.outputShape=yu(t,1),this.variableNames=t.map((o,a)=>`T${a}`);const n=new Array(t.length-1);n[0]=t[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+t[o][1];const r=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];r.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const i=n.length,s=n[n.length-1];r.push(`else setOutput(getT${i}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _8e{constructor(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=yu(t,n);const r=this.outputShape,i=r.length,s=Zt(i),o=di("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=t.map((m,g)=>`T${g}`);const u=new Array(t.length-1);u[0]=t[0][n];for(let m=1;m<u.length;m++)u[m]=u[m-1]+t[m][n];const l=a[n],c=a.slice(-2),f=a.join();let h=`if (${l} < ${u[0]}) {
        return getChannel(
            getT0(${f}), vec2(${c.join()}));
        }`;for(let m=1;m<u.length;m++){const g=u[m-1];h+=`
        if (${l} < ${u[m]}  && ${l} >= ${u[m-1]}) {
          return getChannel(
            getT${m}(${$S(a,l,g)}),
            vec2(${$S(c,l,g)}));
        }`}const d=u.length,p=u[u.length-1];h+=`
        return getChannel(
          getT${d}(${$S(a,l,p)}),
          vec2(${$S(c,l,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${h}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[i-1]} = ${o[i-1]} + 1;
        if (${o[i-1]} < ${r[i-1]}) {
          result.g = getValue(${o});
        }

        ${o[i-2]} = ${o[i-2]} + 1;
        if (${o[i-2]} < ${r[i-2]}) {
          result.a = getValue(${o});
        }

        ${o[i-1]} = ${o[i-1]} - 1;
        if (${o[i-2]} < ${r[i-2]} &&
            ${o[i-1]} < ${r[i-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function $S(e,t,n){const r=e.indexOf(t);return e.map((s,o)=>o===r?`${s} - ${n}`:s).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.texData.get(r.dataId);return $s({inputs:{x:i.complexTensorInfos.imag},backend:n})}const $8e={kernelName:qA,backendName:"webgl",kernelFunc:_D};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wb(e,t,n){const r=e[0].dtype;if(r==="complex64"){const d=e.map(b=>jw({inputs:{input:b},backend:n})),p=e.map(b=>_D({inputs:{input:b},backend:n})),m=wb(d,t,n),g=wb(p,t,n),y=_h({inputs:{real:m,imag:g},backend:n});return d.forEach(b=>n.disposeIntermediateTensorInfo(b)),p.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}let i=n.shouldExecuteOnCPU(e);if(r==="string"&&(i=!0),i){const d=e.map(v=>{const C=[-1,ce(v.shape.slice(t))];return ke({inputs:{x:v},backend:n,attrs:{shape:C}})}),p=d.map(v=>({vals:n.readSync(v.dataId),shape:v.shape})),m=yu(d.map(v=>v.shape),1),g=d[0].shape[0]===1,y=g5e(p,m,r,g),b=yu(e.map(v=>v.shape),t),x=n.makeTensorInfo(b,r,y);return d.forEach(v=>n.disposeIntermediateTensorInfo(v)),x}const s=e.filter(d=>ce(d.shape)>0),o=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){const d=o?new du(e[0].shape,Lc):new Yc(e[0].shape,Lc);return n.runWebGLProgram(d,e,r)}const a=ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){const d=[];for(let m=0;m<s.length;m+=a){const g=s.slice(m,m+a);d.push(wb(g,t,n))}const p=wb(d,t,n);for(const m of d)n.disposeIntermediateTensorInfo(m);return p}if(o){const d=new _8e(s.map(p=>p.shape),t);return n.runWebGLProgram(d,s,r)}const{tensors2D:u,outShape:l}=k8e(s,t,n),c=new S8e(u.map(d=>d.shape)),f=n.runWebGLProgram(c,u,r);u.forEach(d=>n.disposeIntermediateTensorInfo(d));const h=ke({inputs:{x:f},attrs:{shape:l},backend:n});return n.disposeIntermediateTensorInfo(f),h}function k8e(e,t,n){const r=yu(e.map(s=>s.shape),t);return{tensors2D:e.map(s=>ke({inputs:{x:s},attrs:{shape:[-1,ce(s.shape.slice(t))]},backend:n})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Roe(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,s=dt(i,t[0].shape)[0],o=t.map(l=>l.shape);QB(o,s);const a=yu(t.map(l=>l.shape),s);if(ce(a)===0)return n.makeTensorInfo(a,t[0].dtype,[]);const u=t.filter(l=>ce(l.shape)>0);return u.length===1?$s({inputs:{x:u[0]},backend:n}):wb(u,s,n)}const E8e={kernelName:S2,backendName:"webgl",kernelFunc:Roe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Poe{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,f=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,m=t.inChannels%4,g=t.dataFormat==="channelsLast",y=g?1:2,b=g?2:3,x=g?3:1;let v="",w="";r&&(i?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:v=`
          float activation(float x) {
            ${r}
          }
        `,w="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${u}, ${l});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${x}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${w}
        setOutput(result);
      }
    `}}class A8e{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const n=t.padInfo.front,r=t.padInfo.top,i=t.padInfo.left,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,f=t.filterDepth,h=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,m=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${r}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Loe{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Qr(this.outputShape.length);const o=t.padInfo.left,a=t.strideWidth,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,f=c;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<c;g++)h+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;h+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let g=0;g<c;g++)h+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(f+1)/2;g++){const y=g*2;if(h+=`
           xC = xCCorner + ${y*u};
           `,a===1){if(y<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,u===1&&y>0?h+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<c)){const b=o%2===0?xA(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:h+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):b===1?h+=`
                     xC${y+1} = xTexelC${y};
                     `:h+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<c&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<c&&(h+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<c&&(h+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<c&&(h+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let d="",p="";r&&(i?d=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:s?d=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:d=`vec4 activation(vec4 x) {
           ${r}
         }`,p="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T8e{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Qr(this.outputShape.length);const{dataFormat:r}=n,i=Di(),s=r==="channelsLast",o=s?1:2,a=s?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let c=0;c<=1;c++)for(let f=0;f<=1;f++)l+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${c};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&n===1&&e[0]>1?[e[0],1]:null}function Boe({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const u=e.shape,l=r.texData.get(e.dataId),c=n.inChannels,f=u[0]*u[1]*u[2],h=n.outChannels,d=n.dataFormat==="channelsLast",p=!1,m=!1;let g;const y=[];if(s!=null){const v=X$(s.shape,d);v!=null&&(s=ke({inputs:{x:s},backend:r,attrs:{shape:v}}),y.push(s))}if(i!=null){const v=X$(i.shape,d);v!=null&&(i=ke({inputs:{x:i},backend:r,attrs:{shape:v}}),y.push(i))}if(!((f===1||h===1)&&c>Ioe)&&l.isPacked&&d&&l.texture!=null&&u[2]%2!==0&&_t(l.shape.slice(-3),u.slice(-3))){const v=u[0]*u[1]*(u[2]+1),w={dataId:e.dataId,shape:[1,v,n.inChannels],dtype:e.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,z(H$(l.shape,w.shape),()=>`packed reshape ${l.shape} to ${w.shape} isn't free`);const S=ke({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(S);const _=q$({a:w,b:S,backend:r,transposeA:p,transposeB:m,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),$=r.texData.get(_.dataId);z($.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=C,$.shape=n.outShape,g=$s({inputs:{x:_},backend:r}),g.shape=n.outShape,y.push(_)}else{const v=n.outHeight*n.outWidth,w=ke({inputs:{x:e},backend:r,attrs:{shape:d?[n.batchSize,v,n.inChannels]:[n.batchSize,n.inChannels,v]}}),C=ke({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),S=q$({a:d?w:C,b:d?C:w,transposeA:!d,transposeB:m,backend:r,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o});g=ke({inputs:{x:S},backend:r,attrs:{shape:n.outShape}}),y.push(w),y.push(C),y.push(S)}for(const v of y)r.disposeIntermediateTensorInfo(v);return g}function zoe({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:f,outHeight:h,dataFormat:d}=n,p=d==="channelsLast",m=u*l*c,g=h*f,y=[n.batchSize,m,g],b=!0,x=!1,v=[];if(s!=null){const U=X$(s.shape,p);U!=null&&(s=ke({inputs:{x:s},backend:r,attrs:{shape:U}}),v.push(s))}if(i!=null){const U=X$(i.shape,p);U!=null&&(i=ke({inputs:{x:i},backend:r,attrs:{shape:U}}),v.push(i))}const w=ke({inputs:{x:t},backend:r,attrs:{shape:[1,m,ce(t.shape)/m]}});v.push(w);const C=new T8e(y,n),S=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=r.runWebGLProgram(C,[e],"float32",S),$=ke({inputs:{x:_},backend:r,attrs:{shape:y}});v.push(_),v.push($);const k=i!=null,E=s!=null,F=a==="leakyrelu",T=a?Wv(a,!0):null,I=new Doe(p?$.shape:w.shape,p?w.shape:$.shape,p?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],b,x,k,T,E,F),D=p?[$,w]:[w,$];if(i&&D.push(i),E&&D.push(s),F){const U=r.makeTensorInfo([],"float32",fc(o,"float32"));D.push(U),v.push(U)}const N=r.runWebGLProgram(I,D,"float32"),V=ke({inputs:{x:N},backend:r,attrs:{shape:n.outShape}});v.push(N);for(const U of v)r.disposeIntermediateTensorInfo(U);return V}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=r,f=dc(u),h=mr(i.shape,s.shape,o,l,a,c,!1,f);let d;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))d=Boe({x:i,filter:s,convInfo:h,backend:n});else if(h.strideWidth<=2&&f==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const m=new Loe(h),g=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];d=n.runWebGLProgram(m,[i,s],"float32",g)}else if(ae().getBool("WEBGL_CONV_IM2COL"))d=zoe({x:i,filter:s,convInfo:h,backend:n});else{const m=new Poe(h);d=n.runWebGLProgram(m,[i,s],"float32")}const p=ke({inputs:{x:d},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(d),p}const I8e={kernelName:_2,backendName:"webgl",kernelFunc:D8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F8e{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,r=t.strideWidth,i=t.padInfo.top,s=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class O8e{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=t.dataFormat==="channelsLast",a=n-1-t.padInfo.top,u=r-1-t.padInfo.left,l=o?1:2,c=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class N8e{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideDepth,r=t.strideHeight,i=t.strideWidth,s=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${s};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class M8e{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterDepth,r=t.filterHeight,i=t.filterWidth,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=n-1-t.padInfo.front,l=r-1-t.padInfo.top,c=i-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${l}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=r,f=dc(u),h=mr(i.shape,c,o,1,a,l,!1,f),d=new F8e(h);return n.runWebGLProgram(d,[i,s],"float32")}const P8e={kernelName:DA,backendName:"webgl",kernelFunc:R8e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L8e{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=Qr(this.outputShape.length);const n=t.filterHeight,r=t.filterWidth,i=n-1-t.padInfo.top,s=r-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B8e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=r,f=dc(l),h=mr(o,s.shape,a,1,u,c,!1,f);if(ae().getBool("WEBGL_PACK")&&f==="channelsLast"){const d=[[h.strideHeight,h.strideWidth]],p=new L8e(h);return n.runWebGLProgram(p,[i,s],"float32",d)}else{const d=new O8e(h);return n.runWebGLProgram(d,[i,s],"float32")}}const z8e={kernelName:$2,backendName:"webgl",kernelFunc:B8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r,l=mh(i.shape,s.shape,o,u,a),c=new A8e(l);return n.runWebGLProgram(c,[i,s],"float32")}const U8e={kernelName:k2,backendName:"webgl",kernelFunc:j8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,filterShape:u}=r,l=mh(i.shape,u,o,1,a),c=new N8e(l);return n.runWebGLProgram(c,[i,s],"float32")}const V8e={kernelName:IA,backendName:"webgl",kernelFunc:W8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G8e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{pad:o,strides:a,inputShape:u}=r,l=mh(u,s.shape,a,1,o),c=new M8e(l);return n.runWebGLProgram(c,[i,s],"float32")}const H8e={kernelName:FA,backendName:"webgl",kernelFunc:G8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8e=j1+`
  return cos(x);
`,X8e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${og}
  return result;
`,Y8e=kt({opSnippet:q8e,packedOpSnippet:X8e}),K8e={kernelName:G0,backendName:"webgl",kernelFunc:Y8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z8e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,J8e=kt({opSnippet:Z8e}),Q8e={kernelName:H0,backendName:"webgl",kernelFunc:J8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e7e{constructor(t,n,r,i,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,u,l]=t,[c]=n,[f,h]=r;this.outputShape=[c,f,h,l];const d=i==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${u-1}.0`],[g,y,b]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[x,v,w]=h>1?[`${(u-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${x});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${v};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t7e=e=>{const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:s,boxInd:o}=t,{cropSize:a,method:u,extrapolationValue:l}=r,c=new e7e(i.shape,s.shape,a,u,l);return n.runWebGLProgram(c,[i,s,o],"float32")},n7e={kernelName:NA,backendName:"webgl",kernelFunc:t7e};var Gv;(function(e){e.Prod="*",e.Sum="+"})(Gv||(Gv={}));class mG{constructor(t,n,r,i){this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const s=this.outputShape.length,o=this.op===Gv.Prod?"1.0":"0.0",a=r?o:`getX(${yG(s,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let l="",c="";r?(l=i?`end != ${u-1}`:"end != 0",c=i?"end + 1":"end - 1"):(l=i?`end + pow2 < ${u}`:"end >= pow2",c=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Zt(s)} coords = getOutputCoords();
        int end = ${bG(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${c};
          ${bG(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${yG(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function yG(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function bG(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(e,t,n,r,i,s){const o=t.shape.length,a=Tn([r],o);let u=t;a!=null&&(u=Ai({inputs:{x:t},backend:n,attrs:{perm:a}}));const l=zn(1,o)[0];if(l!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);const c=u.shape[l];let f=$s({inputs:{x:u},backend:n});for(let h=0;h<=Math.ceil(Math.log2(c))-1;h++){const d=new mG(e,u.shape,!1,s),p=[[h]],m=f;f=n.runWebGLProgram(d,[f],f.dtype,p),n.disposeIntermediateTensorInfo(m)}if(i){const h=new mG(e,u.shape,i,s),d=f;f=n.runWebGLProgram(h,[f],f.dtype),n.disposeIntermediateTensorInfo(d)}if(a!=null){const h=yh(a),d=Ai({inputs:{x:f},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(u),d}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;return joe(Gv.Prod,i,n,s,o,a)}const i7e={kernelName:OA,backendName:"webgl",kernelFunc:r7e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;return joe(Gv.Sum,i,n,s,o,a)}const o7e={kernelName:E2,backendName:"webgl",kernelFunc:s7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o,binaryOutput:a}=r;if(i.shape.length===1){const u=n.readSync(i.dataId),l=n.readSync(s.dataId),c=woe(u,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}else if(i.shape.length===2){const u=n.bufferSync(i),l=n.bufferSync(s),c=f5e(u,l,o,a);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const u7e={kernelName:MA,backendName:"webgl",kernelFunc:a7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l7e{constructor(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:s,dataFormat:o}=r,a=i.shape[0],u=o==="NHWC"?i.shape[1]:i.shape[2],l=o==="NHWC"?i.shape[2]:i.shape[3],c=o==="NHWC"?i.shape[3]:i.shape[1],f=u*s,h=l*s,d=c/(s*s),p=o==="NHWC"?[a,f,h,d]:[a,d,f,h],m=new l7e(p,s,o);return n.runWebGLProgram(m,[i],i.dtype)}const f7e={kernelName:RA,backendName:"webgl",kernelFunc:c7e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uoe{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Qr(this.outputShape.length);const o=t.filterHeight,a=t.filterWidth,u=t.outChannels/t.inChannels;let l="",c="";r&&(i?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:l=`
          float activation(float x) {
            ${r}
          }
        `,c="result = activation(result);");const f=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Woe{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Qr(this.outputShape.length);const o=t.outChannels/t.inChannels,a=t.padInfo.left,u=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,f=t.filterWidth,h=f;let d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<f;y++)d+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;d+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let y=0;y<f;y++)d+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(h+1)/2;y++){const b=y*2;if(d+=`
          xC = xCCorner + ${b*l};
          `,u===1){if(b<f&&(a%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?d+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<f)){const x=a%2===0?xA(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${x};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:d+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):x===1?d+=`
                    xC${b+1} = xTexelC${b};
                    `:d+=`
                    xCOffset = xC + ${x};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<f&&(a%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<f&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<f&&(d+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<f&&(d+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<f&&(d+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let p="",m="";r&&(i?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:p=`vec4 activation(vec4 x) {
          ${r}
        }`,m="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=r;let c=u;c==null&&(c=[1,1]),z(Mr(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const f=mr(i.shape,s.shape,o,c,a,l,!0);let h;ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new Woe(f):h=new Uoe(f);const d=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(h,[i,s],"float32",d)}const d7e={kernelName:A2,backendName:"webgl",kernelFunc:h7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p7e{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,r=t.strideWidth,i=t.padInfo.top,s=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class g7e{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=n-1-t.padInfo.top,a=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=r,f=mr(i.shape,c,o,a,u,l,!0),h=new p7e(f);return n.runWebGLProgram(h,[i,s],"float32")}const y7e={kernelName:PA,backendName:"webgl",kernelFunc:m7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=r,f=mr(c,s.shape,o,a,u,l,!0),h=new g7e(f);return n.runWebGLProgram(h,[i,s],"float32")}const v7e={kernelName:LA,backendName:"webgl",kernelFunc:b7e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x7e{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7e(e){const{inputs:t,backend:n}=e,{x:r}=t,i=[...r.shape,...r.shape],s=ce(r.shape),o=ke({inputs:{x:r},backend:n,attrs:{shape:[s]}}),a=new x7e(s),u=n.runWebGLProgram(a,[o],o.dtype),l=ke({inputs:{x:u},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),l}const C7e={kernelName:BA,backendName:"webgl",kernelFunc:w7e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S7e{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:n,inWidth:r,padInfo:i,strideHeight:s,strideWidth:o,filterHeight:a,filterWidth:u,dilationHeight:l,dilationWidth:c}=t,{top:f,left:h}=i;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${o});
      const ivec2 pads = ivec2(${f}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r,l=vw(i.shape,s.shape,o,a,"NHWC",u);let c;const f=new S7e(l);c=n.runWebGLProgram(f,[i,s],"float32");const h=ke({inputs:{x:c},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(c),h}const $7e={kernelName:T2,backendName:"webgl",kernelFunc:_7e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7e(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,s=t,{allDims:o,summedDims:a,idDims:u}=f5(i,s.length);d5(o.length,u,s);const{path:l,steps:c}=p5(a,u),f=c.length;let h=null,d=o.length;const p=[];for(let m=0;m<f;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:b}=h5(d,u[g]);let x;g5(y)?x=s[g]:(x=Ai({inputs:{x:s[g]},backend:n,attrs:{perm:y}}),p.push(x));const v=x.shape.slice();for(let w=0;w<b.length;++w)v.splice(b[w],0,1);_t(x.shape,v)||(x=ke({inputs:{x},backend:n,attrs:{shape:v}}),p.push(x)),h===null?h=x:(h=tz({inputs:{a:x,b:h},backend:n}),p.push(h))}m<f-1&&(l[m]>=0&&(h=SD({inputs:{x:h},backend:n,attrs:{axis:l[m]-(o.length-d),keepDims:!1}}),p.push(h)),d--)}for(const m of p)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const E7e={kernelName:zA,backendName:"webgl",kernelFunc:k7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7e="return (x >= 0.0) ? x : (exp(x) - 1.0);",T7e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,D7e=kt({opSnippet:A7e,packedOpSnippet:T7e}),I7e={kernelName:X0,backendName:"webgl",kernelFunc:D7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7e="return (b >= 0.0) ? a : a * (b + 1.0);",O7e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,N7e=e=>{const{inputs:t,backend:n}=e,{dy:r,y:i}=t,s=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new z1(O7e,r.shape,i.shape):new yp(F7e,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)},M7e={kernelName:jA,backendName:"webgl",kernelFunc:N7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R7e=`
  return vec4(equal(a, b));
`,P7e="return float(a == b);",L7e=Pr({opSnippet:P7e,packedOpSnippet:R7e,dtype:"bool",cpuKernelImpl:m5e}),B7e={kernelName:D2,backendName:"webgl",kernelFunc:L7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${i5};
  float a1 = ${s5};
  float a2 = ${o5};
  float a3 = ${a5};
  float a4 = ${u5};
  float a5 = ${l5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,j7e=kt({opSnippet:z7e}),U7e={kernelName:Y0,backendName:"webgl",kernelFunc:j7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7e=j1+`
  return exp(x);
`,V7e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Voe=kt({opSnippet:W7e,packedOpSnippet:V7e,cpuKernelImpl:y5e,dtype:"float32"}),G7e={kernelName:K0,backendName:"webgl",kernelFunc:Voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oR(e){const{inputs:t,attrs:n,backend:r}=e,{dim:i}=n,{input:s}=t,o=s.shape.length,a=s.shape.slice();let u=i;return i<0&&(z(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+i+1),a.splice(u,0,1),ke({inputs:{x:s},backend:r,attrs:{shape:a}})}const H7e={kernelName:I2,backendName:"webgl",kernelFunc:oR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG="return exp(x) - 1.0;",q7e=kt({opSnippet:vG,packedOpSnippet:vG,cpuKernelImpl:b5e}),X7e={kernelName:Z0,backendName:"webgl",kernelFunc:q7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xG{constructor(t,n,r){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const s=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${i}.0`:"1.0";let a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Goe(e,t,n){const r=n.texData.get(e.dataId),i=ce(e.shape),s=e.shape[e.shape.length-1],o=i/s,a=ke({inputs:{x:e},backend:n,attrs:{shape:[o,s]}}),u=a.shape,l=new xG("real",u,t),c=new xG("imag",u,t),f=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],h=n.runWebGLProgram(l,f,"float32"),d=n.runWebGLProgram(c,f,"float32"),p=_h({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const m=ke({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7e(e){const{inputs:t,backend:n}=e,{input:r}=t;return Goe(r,!1,n)}const K7e={kernelName:UA,backendName:"webgl",kernelFunc:Y7e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z7e{constructor(t,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uw(e){const{backend:t,attrs:n}=e,{shape:r,value:i}=n;let{dtype:s}=n;if(s=s||qp(i),s==="string"){const o=Fn(s,ce(r));return o.fill(i),t.makeTensorInfo(r,s,o)}else{const o=new Z7e(r,i),a=[[i]];return t.runWebGLProgram(o,[],s,a)}}const J7e={kernelName:WA,backendName:"webgl",kernelFunc:Uw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q7e{constructor(t){this.variableNames=["Image"],this.outputShape=[];const n=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e9e={kernelName:VA,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,r=t,i=new Q7e(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG="return floor(x);",t9e=kt({opSnippet:wG,packedOpSnippet:wG,cpuKernelImpl:v5e}),n9e={kernelName:J0,backendName:"webgl",kernelFunc:t9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r9e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,i9e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,s9e=Pr({opSnippet:r9e,packedOpSnippet:i9e,dtype:"int32"}),o9e={kernelName:Q0,backendName:"webgl",kernelFunc:s9e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a9e{constructor(t){this.variableNames=["A"];const n=Di(),[r,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${r}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u9e{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Di(),[r,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${r}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l9e={kernelName:S$,backendName:"webgl",kernelFunc:c9e};let Wg,sN=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function c9e(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:i}=t;const{numChannels:s}=r,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[u,l]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=[l,u],f=[l,u,s];if(a||o){const m=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Wg==null||m!==sN)&&(sN=m,Wg=document.createElement("canvas").getContext("2d",{willReadFrequently:sN})),Wg.canvas.width=u,Wg.canvas.height=l,Wg.drawImage(i,0,0,u,l),i=Wg.canvas}const h=n.makeTensorInfo(c,"int32");n.texData.get(h.dataId).usage=Gs.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);const d=ae().getBool("WEBGL_PACK")?new u9e(f):new a9e(f),p=n.runWebGLProgram(d,[h],"int32");return n.disposeData(h.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r,m=dc(c),g=mr(i.shape,s.shape,u,f,l,h,!1,m);let y;const b=[],x=o!=null,v=a!=null,w=d==="leakyrelu",C=()=>{const _=[i,s],$=(k,E)=>{if(E==="NCHW"&&k.shape.length===1&&k.shape[0]!==1){const F=ke({inputs:{x:k},backend:n,attrs:{shape:[k.shape[0],1,1]}});return b.push(F),F}return k};if(x&&_.push($(o,c)),v&&_.push($(a,c)),w){const k=n.makeTensorInfo([],"float32",fc(p,"float32"));_.push(k),b.push(k)}return _};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=Boe({x:i,filter:s,convInfo:g,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else if(g.strideWidth<=2&&m==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const _=d?Wv(d,!0):null,$=new Loe(g,x,_,v,w),k=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],E=C();y=n.runWebGLProgram($,E,"float32",k)}else if(ae().getBool("WEBGL_CONV_IM2COL"))y=zoe({x:i,filter:s,convInfo:g,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else{const _=d?Wv(d,!1):null,$=new Poe(g,x,_,v,w),k=C();y=n.runWebGLProgram($,k,"float32")}const S=ke({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return b.push(y),b.forEach(_=>n.disposeIntermediateTensorInfo(_)),S}const h9e={kernelName:kv,backendName:"webgl",kernelFunc:f9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dilations:c,dimRoundingMode:f,activation:h,leakyreluAlpha:d}=r,p=[];let m=c;m==null&&(m=[1,1]),z(Mr(u,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`);const g=mr(i.shape,s.shape,u,m,l,f,!0),y=ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=h?Wv(h,y):null,x=[i,s],v=o!=null,w=a!=null,C=h==="leakyrelu";if(v&&x.push(o),w&&x.push(a),C){const k=n.makeTensorInfo([],"float32",fc(d,"float32"));x.push(k),p.push(k)}let S;y?S=new Woe(g,v,b,w,C):S=new Uoe(g,v,b,w,C);const _=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],$=n.runWebGLProgram(S,x,"float32",_);return p.forEach(k=>n.disposeIntermediateTensorInfo(k)),$}const p9e={kernelName:Ev,backendName:"webgl",kernelFunc:d9e};class g9e{constructor(t,n,r,i){this.sliceDim=t,this.strides=n,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=r;const s=Zt(r.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9e(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,s=i.shape,o=s[s.length-1],a=ce(r.shape),[u,l,c,f]=rD(r,i),h=ke({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),d=ke({inputs:{x:r},backend:n,attrs:{shape:[ce(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const y=n.readSync(i.dataId),b=n.bufferSync(r),x=x5e(y,b,r.dtype,l,o,c,f,r.shape,a);return n.makeTensorInfo(u,r.dtype,x.values)}const p=new g9e(o,f,[l,c],r.shape),m=n.runWebGLProgram(p,[d,h],d.dtype),g=ke({inputs:{x:m},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),g}const y9e={kernelName:GA,backendName:"webgl",kernelFunc:m9e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b9e{constructor(t,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const r=Zt(this.rank),i=v9e(t);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function v9e(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let i=0;i<e.length;i++)i===2?r.push("index"):r.push(`${n[i]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hoe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:s}=t,{axis:o,batchDims:a}=r,u=dt(o,i.shape)[0];if(ae().get("DEBUG")){const b=n.readSync(s.dataId),x=i.shape[u];for(let v=0;v<b.length;++v){const w=b[v];z(w<=x-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${x-1}]`)}}const l=y5(i,s,u,a),c=ce(s.shape),f=[],h=ke({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),d=ke({inputs:{x:s},backend:n,attrs:{shape:[l.batchSize,c/l.batchSize]}});f.push(h),f.push(d);const p=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([i,s])||i.dtype==="string"){const b=n.bufferSync(d),x=n.bufferSync(h),v=w5e(x,b,p);return f.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(l.outputShape,v.dtype,v.values)}const m=new b9e(h.shape,p),g=n.runWebGLProgram(m,[h,d],h.dtype);f.push(g);const y=ke({inputs:{x:g},backend:n,attrs:{shape:l.outputShape}});return f.forEach(b=>n.disposeIntermediateTensorInfo(b)),y}const x9e={kernelName:O2,backendName:"webgl",kernelFunc:Hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9e="return float(a > b);",C9e=`
  return vec4(greaterThan(a, b));
`,S9e=Pr({opSnippet:w9e,packedOpSnippet:C9e,cpuKernelImpl:C5e,dtype:"bool"}),_9e={kernelName:N2,backendName:"webgl",kernelFunc:S9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $9e="return float(a >= b);",k9e=`
  return vec4(greaterThanEqual(a, b));
`,E9e=Pr({opSnippet:$9e,packedOpSnippet:k9e,dtype:"bool",cpuKernelImpl:S5e}),A9e={kernelName:e1,backendName:"webgl",kernelFunc:E9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T9e(e){const{inputs:t,backend:n}=e,{input:r}=t;return Goe(r,!0,n)}const D9e={kernelName:HA,backendName:"webgl",kernelFunc:T9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I9e="return float(!isnan(x) && !isinf(x));",F9e=kt({opSnippet:I9e,dtype:"bool"}),O9e={kernelName:n1,backendName:"webgl",kernelFunc:F9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N9e="return float(isinf(x));",M9e=kt({opSnippet:N9e,dtype:"bool"}),R9e={kernelName:r1,backendName:"webgl",kernelFunc:M9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P9e="return float(isnan(x));",L9e=kt({opSnippet:P9e,dtype:"bool"}),B9e={kernelName:i1,backendName:"webgl",kernelFunc:L9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z9e="return float(a < b);",j9e=`
  return vec4(lessThan(a, b));
`,U9e=Pr({opSnippet:z9e,packedOpSnippet:j9e,cpuKernelImpl:_5e,dtype:"bool"}),W9e={kernelName:R2,backendName:"webgl",kernelFunc:U9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V9e="return float(a <= b);",G9e=`
  return vec4(lessThanEqual(a, b));
`,H9e=Pr({opSnippet:V9e,packedOpSnippet:G9e,cpuKernelImpl:$5e,dtype:"bool"}),q9e={kernelName:P2,backendName:"webgl",kernelFunc:H9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9e(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:s}=n,o=k5e(r,i,s);return t.makeTensorInfo([o.length],"float32",o)}const Y9e={kernelName:XA,backendName:"webgl",kernelFunc:X9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K9e=j1+`
  return x < 0.0 ? 0./0. : log(x);
`,Z9e=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,J9e=kt({opSnippet:K9e,packedOpSnippet:Z9e,cpuKernelImpl:E5e}),Q9e={kernelName:s1,backendName:"webgl",kernelFunc:J9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eje=j1+`
  return log(1.0 + x);
`,tje=kt({opSnippet:eje}),nje={kernelName:o1,backendName:"webgl",kernelFunc:tje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rje="return float(a >= 1.0 && b >= 1.0);",ije=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,sje=Pr({opSnippet:rje,packedOpSnippet:ije,dtype:"bool"}),oje={kernelName:L2,backendName:"webgl",kernelFunc:sje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aje="return float(!(x >= 1.0));",uje=kt({opSnippet:aje}),lje={kernelName:B2,backendName:"webgl",kernelFunc:uje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cje="return float(a >= 1.0 || b >= 1.0);",fje=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,hje=Pr({opSnippet:cje,packedOpSnippet:fje,dtype:"bool"}),dje={kernelName:z2,backendName:"webgl",kernelFunc:hje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pje{constructor(t,n,r,i,s){this.variableNames=["x"],this.outputShape=[];const o=n,a=t[3]-1;this.outputShape=t;let u;const l=`float(${r}) + float(${i}) * sum`;s===.5?u=`inversesqrt(${l})`:s===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gje{constructor(t,n,r,i,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=t[3]-1;this.outputShape=t;let u;const l=`float(${r}) + float(${i}) * sum`;s===.5?u=`inversesqrt(${l})`:s===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mje=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:s,bias:o,alpha:a,beta:u}=r,l=ae().getBool("WEBGL_PACK_NORMALIZATION")?new gje(i.shape,s,o,a,u):new pje(i.shape,s,o,a,u);return n.runWebGLProgram(l,[i],i.dtype)},yje={kernelName:j2,backendName:"webgl",kernelFunc:mje};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bje{constructor(t,n,r,i,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=i,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${s})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vje=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i,y:s,dy:o}=t,{depthRadius:a,bias:u,alpha:l,beta:c}=r,f=new bje(i.shape,a,u,l,c);return n.runWebGLProgram(f,[i,s,o],i.dtype)},xje={kernelName:YA,backendName:"webgl",kernelFunc:vje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wje(e,t,n,r){const i=ce(t),o=ce(e.shape)/i,a=ke({inputs:{x:e},attrs:{shape:[o,i]},backend:r}),u=ag(a,e.dtype,"max",r),l=ke({inputs:{x:u},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:s,keepDims:o}=r,a=i.shape.length,u=dt(s,i.shape);let l=u;const c=Tn(l,a),f=c!=null,h=n.shouldExecuteOnCPU([i]);let d=i;if(f){if(h){const x=n.texData.get(d.dataId).values,v=new Array(a);for(let S=0;S<v.length;S++)v[S]=i.shape[c[S]];const w=Q5(x,i.shape,i.dtype,c,v);d=n.makeTensorInfo(v,i.dtype);const C=n.texData.get(d.dataId);C.values=w}else d=CD(i,c,n);l=zn(l.length,a)}Rr("max",l,a);const[p,m]=yr(d.shape,l);let g=p;o&&(g=Bn(p,u));let y;if(h){const x=n.texData.get(d.dataId).values,v=A5e(x,ce(m),g,i.dtype);y=n.makeTensorInfo(g,i.dtype);const w=n.texData.get(y.dataId);w.values=v}else y=wje(d,m,g,n);return f&&n.disposeIntermediateTensorInfo(d),y}const Cje={kernelName:U2,backendName:"webgl",kernelFunc:qoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sje=ez+`
  return max(a, b);
`,_je=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+og+`
  return result;
`,$je=Pr({opSnippet:Sje,packedOpSnippet:_je,cpuKernelImpl:T5e}),kje={kernelName:a1,backendName:"webgl",kernelFunc:$je};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eje(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Bw(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;z(Mr(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=jo(i.shape,s,o,l,a,u);if(c.filterWidth===1&&c.filterHeight===1&&_t(c.inShape,c.outShape))return $s({inputs:{x:i},backend:n});const f=new Vv(c,"max",!1);return n.runWebGLProgram(f,[i],i.dtype)}const Aje={kernelName:W2,backendName:"webgl",kernelFunc:Eje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tje(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dataFormat:u,dimRoundingMode:l}=r,c=[1,1,1],f=hc(i.shape,s,o,c,a,l,u),h=new nz(f,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}const Dje={kernelName:V2,backendName:"webgl",kernelFunc:Tje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ije{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideHeight,r=t.strideWidth,i=t.dilationHeight,s=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=s-1-t.padInfo.top,u=o-1-t.padInfo.left,l=s*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Fje{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideDepth,r=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,f=u-1-t.padInfo.front,h=l-1-t.padInfo.top,d=c-1-t.padInfo.left,p=u*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${h}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oje(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=r,f=[1,1,1],h=hc(o.shape,a,u,f,l,c),d=new nz(h,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),m=new Fje(h),g=n.runWebGLProgram(m,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),g}const Nje={kernelName:ZA,backendName:"webgl",kernelFunc:Oje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mje(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s,output:o}=t,a=s;Bw([s,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:f}=r,h=jo(a.shape,u,l,1,c,f),d=!0,p=new Vv(h,"max",d),m=n.runWebGLProgram(p,[a],a.dtype),g=new Ije(h),y=n.runWebGLProgram(g,[i,m],a.dtype);return n.disposeIntermediateTensorInfo(m),y}const Rje={kernelName:KA,backendName:"webgl",kernelFunc:Mje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pje(e,t,n,r){let i=new Vv(n,"max",!1);const s=r.runWebGLProgram(i,[e],"float32");i=new Vv(n,"max",!0,!0,t);const o=r.runWebGLProgram(i,[e],"float32");return[s,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lje={kernelName:JA,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=t,u=n;z(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const l=[1,1];z(Mr(s,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${l}'`);const c=jo(r.shape,i,s,l,o),[f,h]=Pje(r,a,c,u);return[f,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bje(e,t,n,r){const i=ce(t),o=ce(e.shape)/i,a=ke({inputs:{x:e},attrs:{shape:[o,i]},backend:r}),u=ag(a,"float32","mean",r),l=ke({inputs:{x:u},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zje={kernelName:G2,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{keepDims:i,axis:s}=t,o=n,a=r.shape.length,u=dt(s,r.shape);let l=u;const c=Tn(l,a),f=c!=null,h=o.shouldExecuteOnCPU([r]),d=[];let p=r;if(f){if(h){const v=o.texData.get(p.dataId).values,w=new Array(a);for(let _=0;_<w.length;_++)w[_]=r.shape[c[_]];const C=Q5(v,r.shape,r.dtype,c,w);p=o.makeTensorInfo(w,r.dtype);const S=o.texData.get(p.dataId);S.values=C}else p=CD(r,c,o);d.push(p),l=zn(l.length,a)}Rr("sum",l,a);const[m,g]=yr(p.shape,l);let y=m;i&&(y=Bn(m,u));const b=Bje(p,g,y,o);for(const x of d)o.disposeIntermediateTensorInfo(x);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jje(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=dt(s,i.shape);let l=u;const c=Tn(l,a);let f=i;c!=null&&(f=Ai({inputs:{x:i},backend:n,attrs:{perm:c}}),l=zn(l.length,i.shape.length)),Rr("min",l,a);const[h,d]=yr(f.shape,l),p=ce(d),m=ke({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),g=ag(m,m.dtype,"min",n);let y;if(o){const b=Bn(h,u);y=ke({inputs:{x:g},backend:n,attrs:{shape:b}})}else y=ke({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(f),y}const Uje={kernelName:H2,backendName:"webgl",kernelFunc:jje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wje=ez+`
  return min(a, b);
`,Vje=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+og+`
  return result;
`,Gje=Pr({opSnippet:Wje,packedOpSnippet:Vje,cpuKernelImpl:D5e}),Hje={kernelName:u1,backendName:"webgl",kernelFunc:Gje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qje{constructor(t,n,r){this.variableNames=["x"],this.outputShape=n.map((c,f)=>c[0]+t[f]+c[1]);const i=t.length,s=Zt(i),o=n.map(c=>c[0]).join(","),a=n.map((c,f)=>c[0]+t[f]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),l=r==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xje{constructor(t,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+t[m]+p[1]);const i=t.length,s=Zt(i),o=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+t[m]).join(","),u=di("rc",i),l=di("source",i),c=`${u[i-1]} < ${this.outputShape[i-1]}`,f=i===1?"source":`vec2(${l.slice(-2).join()})`,h=r==="reflect"?0:1;let d="";if(i===1){const p=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${f});
        ${u[i-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${f});
        }
      `}else{const p=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${f});
        ${u[i-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${f});
        }
        rc = outputLoc;
        ${u[i-2]} += 1;
        if(${u[i-2]} < ${this.outputShape[i-2]}) {
          ${p}
          result[2] = getChannel(getX(${l.join()}), ${f});
          ${u[i-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${l.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yje=({inputs:e,backend:t,attrs:n})=>{const{x:r}=e,{paddings:i,mode:s}=n,o=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xje(r.shape,i,s):new qje(r.shape,i,s);return t.runWebGLProgram(o,[r],r.dtype)},Kje={kernelName:q2,backendName:"webgl",kernelFunc:Yje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zje=`if (b == 0.0) return NAN;
  return mod(a, b);`,Jje=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+og+`
  return result;
`,Qje=Pr({opSnippet:Zje,packedOpSnippet:Jje}),eUe={kernelName:l1,backendName:"webgl",kernelFunc:Qje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tUe{constructor(t,n,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nUe=`
if (a == b) {
  return 1.0;
};
return a / b;`,rUe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Xoe=Pr({opSnippet:nUe,packedOpSnippet:rUe,checkOutOfBounds:!0}),iUe={kernelName:q0,backendName:"webgl",kernelFunc:Xoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG="return a - b;",Yoe=Pr({opSnippet:CG,packedOpSnippet:CG,supportsComplex:!0,cpuKernelImpl:Z5e}),sUe={kernelName:$1,backendName:"webgl",kernelFunc:Yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Koe(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:s}=r,o=dt([s],i.shape),a=qoe({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=Bn(a.shape,o),l=ke({inputs:{x:a},backend:n,attrs:{shape:u}}),c=Yoe({inputs:{a:i,b:l},backend:n}),f=Voe({inputs:{x:c},backend:n}),h=SD({inputs:{x:f},backend:n,attrs:{axis:o,keepDims:!1}}),d=ke({inputs:{x:h},backend:n,attrs:{shape:u}}),p=Xoe({inputs:{a:f,b:d},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),p}const oUe={kernelName:fw,backendName:"webgl",kernelFunc:Koe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aUe(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:s,seed:o,normalized:a}=r,u=a?i:Koe({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),l=u.shape[0],c=u.shape[1],f=new tUe(l,c,s),h=[[o]],d=n.runWebGLProgram(f,[u],"int32",h);return a||n.disposeIntermediateTensorInfo(u),d}const uUe={kernelName:QA,backendName:"webgl",kernelFunc:aUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lUe=Wo+`
  return -x;
`,cUe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function fUe(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const s=n.texData.get(r.dataId),[o,a]=F5e(s.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,o)}let i;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new Yc(r.shape,cUe):i=new du(r.shape,lUe),n.runWebGLProgram(i,[r],r.dtype)}const hUe={kernelName:X2,backendName:"webgl",kernelFunc:fUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dUe=QT;function pUe(e){js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=r,l=n.readSync(i.dataId),c=n.readSync(s.dataId),{selectedIndices:f}=dUe(l,c,o,a,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}const gUe={kernelName:eT,backendName:"webgl",kernelFunc:pUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mUe=eD;function yUe(e){js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=r,c=n.readSync(i.dataId),f=n.readSync(s.dataId),{selectedIndices:h,validOutputs:d}=mUe(c,f,o,a,u,l);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const bUe={kernelName:tT,backendName:"webgl",kernelFunc:yUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vUe=tD;function xUe(e){js("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=r,c=n.readSync(i.dataId),f=n.readSync(s.dataId),h=o,d=a,p=u,m=l,{selectedIndices:g,selectedScores:y}=vUe(c,f,h,d,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const wUe={kernelName:nT,backendName:"webgl",kernelFunc:xUe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CUe{constructor(t,n,r,i){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SUe=e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:s,depth:o,onValue:a,offValue:u}=r,l=ce(i.shape),c=new CUe(l,o,a,u),f=ke({inputs:{x:i},backend:n,attrs:{shape:[l]}}),h=n.runWebGLProgram(c,[f],s);n.disposeIntermediateTensorInfo(f);const d=[...i.shape,o],p=ke({inputs:{x:h},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(h),p},_Ue={kernelName:Z2,backendName:"webgl",kernelFunc:SUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="complex64"){const i=jw({inputs:{input:r},backend:n}),s=Y$({inputs:{x:i},backend:n}),o=_D({inputs:{input:r},backend:n}),a=Y$({inputs:{x:o},backend:n}),u=_h({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return Uw({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}const $Ue={kernelName:gw,backendName:"webgl",kernelFunc:Y$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zoe(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const i=jw({inputs:{input:r},backend:n}),s=Zoe({inputs:{x:i},backend:n}),o=_D({inputs:{input:r},backend:n}),a=Y$({inputs:{x:o},backend:n}),u=_h({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return Uw({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}const kUe={kernelName:K2,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EUe(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(t.length===1)return oR({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const s=t[0].shape,o=t[0].dtype;t.forEach(c=>{Nr(s,c.shape,"All tensors passed to stack must have matching shapes"),z(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=t.map(c=>{const f=oR({inputs:{input:c},backend:n,attrs:{dim:i}});return a.push(f),f}),l=Roe({inputs:u,backend:n,attrs:{axis:i}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),l}const AUe={kernelName:J2,backendName:"webgl",kernelFunc:EUe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TUe{constructor(t,n,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((l,c)=>l[0]+t[c]+l[1]);const i=t.length,s=Zt(i),o=n.map(l=>l[0]).join(","),a=n.map((l,c)=>l[0]+t[c]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DUe{constructor(t,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,g)=>m[0]+t[g]+m[1]);const i=t.length,s=Zt(i),o=n.map(m=>m[0]).join(","),a=n.map((m,g)=>m[0]+t[g]).join(","),u=di("rc",i),l=di("source",i),c=`${u[i-1]} < ${this.outputShape[i-1]}`,f=i===1?"source":`vec2(${l.slice(-2).join()})`,h=[`${s} rc = outputLoc;`,`${u[i-1]} += 1;
       if(${c}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${u[i-2]} += 1;
       if(${u[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${u[i-1]} += 1;
         if(${c}) {`],d=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=i===1?2:4;m<g;m++)p+=`
        ${h[m]}
        if (${d}) {
          result[${m}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${m}] = getChannel(getX(${l.join()}), ${f});
        }
      `;p+=i===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Joe=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,constantValue:o}=r;if(ce(i.shape)===0){const l=s.map((c,f)=>c[0]+i.shape[f]+c[1]);return Uw({backend:n,attrs:{shape:l,value:o,dtype:i.dtype}})}const a=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new DUe(i.shape,s,o):new TUe(i.shape,s,o),u=[[o]];return n.runWebGLProgram(a,[i],i.dtype,u)},IUe={kernelName:Q2,backendName:"webgl",kernelFunc:Joe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FUe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,OUe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+og+`
  return result;
`,NUe=Pr({opSnippet:FUe,packedOpSnippet:OUe}),MUe={kernelName:f1,backendName:"webgl",kernelFunc:NUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RUe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=[],l=dt(s,i.shape);let c=l;const f=Tn(c,a);let h=i;f!=null&&(h=Ai({inputs:{x:i},backend:n,attrs:{perm:f}}),c=zn(c.length,a),u.push(h)),Rr("prod",c,a);let d;if(n.shouldExecuteOnCPU([h])){const p=n.texData.get(h.dataId).values,{outVals:m,outShape:g,outDtype:y}=N5e(h.shape,h.dtype,p,c);d=n.makeTensorInfo(g,y,m)}else{const[p,m]=yr(h.shape,c),g=ce(m),y=ke({inputs:{x:h},backend:n,attrs:{shape:[-1,g]}}),b=AT(i.dtype),x=ag(y,b,"prod",n);d=ke({inputs:{x},backend:n,attrs:{shape:p}}),u.push(y),u.push(x)}if(o){u.push(d);const p=Bn(d.shape,l);d=ke({inputs:{x:d},backend:n,attrs:{shape:p}})}return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const PUe={kernelName:tw,backendName:"webgl",kernelFunc:RUe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LUe(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=t,{outputRaggedRank:a}=r,u=i.map(y=>n.readSync(y.dataId)),l=i.map(y=>y.shape),c=n.readSync(s.dataId),f=n.readSync(o.dataId),[h,d,p]=M5e(u,l,c,s.shape,s.dtype,f,o.shape,a),m=h.map(y=>n.makeTensorInfo([y.length],"int32",y)),g=n.makeTensorInfo(p,s.dtype,d);return m.concat([g])}const BUe={kernelName:rT,backendName:"webgl",kernelFunc:LUe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zUe(e){const{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:s}=t,o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=R5e(o,r.shape,r.dtype,a,i.shape,u,s.shape),f=n.makeTensorInfo([l.length],"int32",l),h=n.makeTensorInfo([c.length],r.dtype,c);return[f,h]}const jUe={kernelName:iT,backendName:"webgl",kernelFunc:zUe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UUe(e){const{inputs:t,backend:n,attrs:r}=e,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=r,l=n.readSync(i.dataId),c=n.readSync(s.dataId),f=n.readSync(o.dataId),h=a.map(g=>n.readSync(g.dataId)),d=a.map(g=>g.shape),[p,m]=P5e(l,i.shape,c,s.shape,s.dtype,f,o.shape,h,d,u);return n.makeTensorInfo(p,s.dtype,m)}const WUe={kernelName:sT,backendName:"webgl",kernelFunc:UUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qoe=e=>{const{backend:t,attrs:n}=e,{start:r,stop:i,step:s,dtype:o}=n,a=L5e(r,i,s,o);return t.makeTensorInfo([a.length],o,a)},VUe={kernelName:oT,backendName:"webgl",kernelFunc:Qoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GUe="return 1.0 / x;",HUe=kt({opSnippet:GUe}),qUe={kernelName:h1,backendName:"webgl",kernelFunc:HUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XUe=Wo+`
  return (x < 0.0) ? 0.0 : x;
`,YUe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,KUe=kt({opSnippet:XUe,packedOpSnippet:YUe}),ZUe={kernelName:d1,backendName:"webgl",kernelFunc:KUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JUe=Wo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,QUe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,eWe=kt({opSnippet:JUe,packedOpSnippet:QUe}),tWe={kernelName:p1,backendName:"webgl",kernelFunc:eWe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nWe{constructor(t,n,r,i,s){this.variableNames=["A"],this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r];let h;s?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/f[0]},
          ${c[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rWe{constructor(t,n,r,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r];let h;s?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/f[0]},
          ${c[1]/f[1]},
          ${c[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iWe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r,[u,l]=a,c=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new rWe(i.shape,u,l,s,o):new nWe(i.shape,u,l,s,o);return n.runWebGLProgram(c,[i],"float32")}const sWe={kernelName:iw,backendName:"webgl",kernelFunc:iWe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oWe{constructor(t,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,s]=n,[,o,a]=t,u=[r&&o>1?i-1:i,r&&a>1?s-1:s],l=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=u[0]/l[0],f=u[1]/l[1],h=1/c,d=1/f,p=Math.ceil(h)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${f});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aWe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r,a=new oWe(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const uWe={kernelName:lT,backendName:"webgl",kernelFunc:aWe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lWe{constructor(t,n,r,i,s){this.variableNames=["A"],this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r],h=i?"0.5":"0.0";let d;s?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/f[0]},
          ${c[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cWe{constructor(t,n,r,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r],h=i?"0.5":"0.0";let d;s?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/f[0]},
          ${c[1]/f[1]},
          ${c[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fWe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r,[u,l]=a,c=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new cWe(i.shape,u,l,s,o):new lWe(i.shape,u,l,s,o);return n.runWebGLProgram(c,[i],i.dtype)}const hWe={kernelName:rw,backendName:"webgl",kernelFunc:fWe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dWe{constructor(t,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,s]=n,[,o,a]=t,u=[r&&o>1?i-1:i,r&&a>1?s-1:s],l=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=u[0]/l[0],f=u[1]/l[1],h=1/c,d=1/f,p=Math.ceil(h)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${f});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pWe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r,a=new dWe(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const gWe={kernelName:uT,backendName:"webgl",kernelFunc:pWe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mWe{constructor(t,n){this.variableNames=["x"];const r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=t,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const i=a=>n.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,s=t.map((a,u)=>i(u)).join(","),o=Zt(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yWe{constructor(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=t;const i=di("rc",r),s=`${i[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${i[r-2]} + 1 < ${this.outputShape[r-2]}`,a=Zt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(i.slice())};
          if(${s}){
            result.g = ${l(i.slice())};
          }
          if(${o}) {
            result.b = ${c(i.slice())};
            if(${s}) {
              result.a = ${f(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(p){return h(p)}function l(p){return p[r-1]="("+p[r-1]+" + 1)",h(p)}function c(p){return p[r-2]="("+p[r-2]+" + 1)",h(p)}function f(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",h(p)}function h(p){const m=t.map((b,x)=>d(x,p)),g=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function d(p,m){return n.indexOf(p)!==-1&&t[p]!==1?`${t[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bWe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:s}=r,o=i.shape.length,a=dt(s,i.shape);if(o===0)return $s({inputs:{x:i},backend:n});const u=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yWe(i.shape,a):new mWe(i.shape,a);return n.runWebGLProgram(u,[i],i.dtype)}const vWe={kernelName:sw,backendName:"webgl",kernelFunc:bWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xWe{constructor(t,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=t[1],i=t[2];this.outputShape=t;let s="";typeof n=="number"?s=`float outputValue = ${n.toFixed(2)};`:s=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wWe={kernelName:kT,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:s,center:o}=t,a=n,u=new xWe(r.shape,s),[l,c]=t5(o,r.shape[1],r.shape[2]),f=[[l,c,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(u,[r],r.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CWe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,SWe=kt({opSnippet:CWe}),_We={kernelName:g1,backendName:"webgl",kernelFunc:SWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $We="return inversesqrt(x);",kWe=kt({opSnippet:$We,cpuKernelImpl:B5e}),EWe={kernelName:m1,backendName:"webgl",kernelFunc:kWe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rz{constructor(t,n,r,i,s,o,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const l=Zt(s.length),c=Zt(o.length);let f="";r===1?f="i":r===2&&(f="i, j");const h=`getIndices(${f})`;let d="";i===1?d="i":i===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let m="";u&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AWe{constructor(t,n,r,i,s,o,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const l=Zt(s.length),c=Zt(o.length);let f="";r===1?f="i":r===2&&(f="i, j");const h=`getIndices(${f})`;let d="";i===1?d="i":i===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let m="";u&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides",b=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TWe(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:s}=t,{shape:o}=r,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=wh(s,i,o),h=[f/l,l];if(f===0)return n.makeTensorInfo(o,i.dtype);const d=ke({inputs:{x:i},backend:n,attrs:{shape:[u,a]}}),p=ke({inputs:{x:s},backend:n,attrs:{shape:[u,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;ae().getBool("WEBGL_PACK")?g=new AWe(u,a,d.shape.length,p.shape.length,c,h):g=new rz(u,a,d.shape.length,p.shape.length,c,h);const y=n.runWebGLProgram(g,[p,d,m],p.dtype),b=ke({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}const DWe={kernelName:cT,backendName:"webgl",kernelFunc:TWe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IWe{constructor(t,n,r,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];const s="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=ae().getNumber("WEBGL_VERSION")===2?s:o,u=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FWe(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:s}=t,{side:o}=r,a=new IWe(i.shape[0],i.shape[1],s.shape[1],o),u=[[i.shape[1]]];return n.runWebGLProgram(a,[i,s],"int32",u)}const OWe={kernelName:hT,backendName:"webgl",kernelFunc:FWe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NWe{constructor(t,n,r){this.variableNames=["c","a","b"],this.outputShape=n;let i,s;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)s="resRC",i="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],l=[];for(let c=0;c<n.length;c++)l.push(`${a[c]}`),c<t&&u.push(`${a[c]}`);i=u.join(),s=l.join()}const o=Zt(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MWe(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:s}=t,o=new NWe(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[r,i,s],Hi(i.dtype,s.dtype))}const RWe={kernelName:ow,backendName:"webgl",kernelFunc:MWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PWe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${oD};
  float scale = ${aD};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,LWe=kt({opSnippet:PWe}),BWe={kernelName:y1,backendName:"webgl",kernelFunc:LWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zWe=j1+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,jWe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,UWe=kt({opSnippet:zWe,packedOpSnippet:jWe,cpuKernelImpl:j5e}),WWe={kernelName:w1,backendName:"webgl",kernelFunc:UWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VWe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,GWe=kt({opSnippet:VWe}),HWe={kernelName:x1,backendName:"webgl",kernelFunc:GWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qWe=j1+`
  return sin(x);
`,XWe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${og}
  return result;
`,YWe=kt({opSnippet:qWe,packedOpSnippet:XWe}),KWe={kernelName:b1,backendName:"webgl",kernelFunc:YWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZWe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,JWe=kt({opSnippet:ZWe}),QWe={kernelName:v1,backendName:"webgl",kernelFunc:JWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eVe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,tVe=kt({opSnippet:eVe}),nVe={kernelName:C1,backendName:"webgl",kernelFunc:tVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rVe=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,paddings:o}=r;z(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((y,b)=>y*b),u=[[0,0]];u.push(...o);for(let y=1+s.length;y<i.shape.length;++y)u.push([0,0]);const l=[],c=Joe({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),f=kw(c.shape,s,a,!1),h=Ew(f.length,s.length,!1),d=Aw(c.shape,s,a,!1),p=ke({inputs:{x:c},backend:n,attrs:{shape:f}}),m=Ai({inputs:{x:p},backend:n,attrs:{perm:h}}),g=ke({inputs:{x:m},backend:n,attrs:{shape:d}});return l.push(c),l.push(p),l.push(m),l.forEach(y=>n.disposeIntermediateTensorInfo(y)),g},iVe={kernelName:lw,backendName:"webgl",kernelFunc:rVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sVe(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:s,defaultValue:o}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(r.dataId),u=n.readSync(i.dataId),l=n.readSync(s.dataId),c=n.readSync(o.dataId)[0],[f,h,d,p,m]=W5e(a,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const oVe={kernelName:dT,backendName:"webgl",kernelFunc:sVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aVe(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(r.dataId),u=Array.from(n.readSync(s.dataId)),[l,c,f]=V5e(a,r.shape,r.dtype,o,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([f.length],s.dtype,new Int32Array(f))]}const uVe={kernelName:pT,backendName:"webgl",kernelFunc:aVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lVe(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=Soe(o,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(c,r.dtype,l)}const cVe={kernelName:gT,backendName:"webgl",kernelFunc:lVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fVe(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=Soe(o,r.shape,r.dtype,a,u);return n.makeTensorInfo(c,r.dtype,l)}const hVe={kernelName:mT,backendName:"webgl",kernelFunc:fVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dVe(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:s,defaultValue:o}=t,{outputShape:a}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:f,outputSize:h}=wh(s,i,a),d=!1;if(s.dtype==="string"){const y=n.bufferSync(i),b=n.bufferSync(s),x=Jl(n.readSync(o.dataId)[0]),v=z5e(y,b,a,h,c,l,u,f,x,d);return n.makeTensorInfo(a,v.dtype,v.values)}const p=new rz(l,u,i.shape.length,s.shape.length,f,[h,1],d),m=n.runWebGLProgram(p,[s,i,o],s.dtype),g=ke({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),g}const pVe={kernelName:yT,backendName:"webgl",kernelFunc:dVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gVe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:s,axis:o}=r,a=dt(o,i.shape)[0],u=m5(i,s,a),l=i.shape.length,c=new Array(l).fill(0),f=i.shape.slice();return u.map(h=>{const d=[...f];d[a]=h;const p=U1({inputs:{x:i},backend:n,attrs:{begin:c,size:d}});return c[a]+=h,p})}const mVe={kernelName:cw,backendName:"webgl",kernelFunc:gVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG="return sqrt(x);",yVe=kt({opSnippet:SG,packedOpSnippet:SG,cpuKernelImpl:G5e}),bVe={kernelName:S1,backendName:"webgl",kernelFunc:yVe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vVe="return x * x;",xVe=kt({opSnippet:vVe}),wVe={kernelName:bT,backendName:"webgl",kernelFunc:xVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G="return (a - b) * (a - b);",CVe=Pr({opSnippet:_G,packedOpSnippet:_G}),SVe={kernelName:_1,backendName:"webgl",kernelFunc:CVe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ve(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");const s=n.readSync(i.dataId),o=tc(s),a=H5e(o,"string",r);return n.makeTensorInfo(i.shape,"string",a)}const $Ve={kernelName:hw,backendName:"webgl",kernelFunc:_Ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kVe({inputs:e,attrs:t,backend:n}){const{x:r}=e,i=Wo+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new du(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}const EVe={kernelName:T1,backendName:"webgl",kernelFunc:kVe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AVe{constructor(t,n,r){this.variableNames=["x"],this.outputShape=r;const i=r.length,s=Zt(r.length),o=Zt(r.length);let a="";if(i===1)a="coords * strides + begin";else{let u=0;a=r.map((l,c)=>(u++,r.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${u-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${t});
      ${s} strides = ${s}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TVe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:f,shrinkAxisMask:h}=r,{finalShapeSparse:d,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:b,end:x,strides:v}=ZB(i.shape,s,o,a,u,l,c,f,h);let w;if(m)w=ke({inputs:{x:i},backend:n,attrs:{shape:p}});else if(g||y){z(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const S=XB(b,x,v),_=U1({inputs:{x:i},backend:n,attrs:{begin:b,size:S}});w=ke({inputs:{x:_},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(_)}else if(n.shouldExecuteOnCPU([i])){const _=n.readSync(i.dataId),$=ft(i.shape,i.dtype,_),k=q5e(d,$,v,b);w=n.makeTensorInfo(p,i.dtype,k.values)}else{const _=new AVe(b,v,d);w=n.runWebGLProgram(_,[i],i.dtype)}const C=ke({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),C}const DVe={kernelName:vT,backendName:"webgl",kernelFunc:TVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IVe(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:f}=t,h=n.readSync(c.dataId),d=n.readSync(f.dataId),[p,m]=X5e(h,d,i,s,o,a,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(f.shape,"int32",m)]}const FVe={kernelName:xT,backendName:"webgl",kernelFunc:IVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OVe(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:s,delimiter:o}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[l,c,f]=Y5e(a,u,i),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(f))]}const NVe={kernelName:wT,backendName:"webgl",kernelFunc:OVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MVe(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=K5e(o,i);return n.makeTensorInfo(s.shape,"int32",a)}const RVe={kernelName:CT,backendName:"webgl",kernelFunc:MVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PVe="return tan(x);",LVe=kt({opSnippet:PVe}),BVe={kernelName:k1,backendName:"webgl",kernelFunc:LVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zVe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,jVe=kt({opSnippet:zVe}),UVe={kernelName:E1,backendName:"webgl",kernelFunc:jVe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WVe(e){const{inputs:t,backend:n,attrs:r}=e,{tensor:i,indices:s,updates:o}=t,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=wh(o,s,i.shape),h=[f/l,l];if(f===0)return n.makeTensorInfo(i.shape,s.dtype);const d=ke({inputs:{x:s},backend:n,attrs:{shape:[u,a]}}),p=ke({inputs:{x:o},backend:n,attrs:{shape:[u,l]}}),m=ke({inputs:{x:i},backend:n,attrs:{shape:h}}),g=new rz(u,a,d.shape.length,p.shape.length,c,h,!1,!0),y=n.runWebGLProgram(g,[p,d,m],m.dtype),b=ke({inputs:{x:y},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),b}const VVe={kernelName:fT,backendName:"webgl",kernelFunc:WVe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GVe{constructor(t,n){this.variableNames=["A"];const r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[o]*n[o];this.outputShape=r,this.rank=r.length;const i=Zt(this.rank),s=HVe(t);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}}function HVe(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<e.length;i++)r.push(`imod(${n[i]}, ${e[i]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eae(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:s}=r;if(i.dtype==="string"||i.shape.length>5){const u=n.readSync(i.dataId),l=i.dtype==="string"?u.map(h=>Jl(h)):u,c=ft(i.shape,i.dtype,l),f=J5e(c,s);return n.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new GVe(i.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const qVe={kernelName:A1,backendName:"webgl",kernelFunc:eae};class XVe{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class YVe{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xh(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function $G(e){let t=1;for(;t<e;)t*=2;return t}function KVe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:s,sorted:o}=r,a=ae().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=ae().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=i.shape,c=l[l.length-1];if(n.shouldExecuteOnCPU([i])||c<a||s>u){const k=n.readSync(i.dataId),[E,F]=Q5e(k,l,i.dtype,s,o);return[n.makeTensorInfo(E.shape,E.dtype,E.values),n.makeTensorInfo(F.shape,F.dtype,F.values)]}if(s===0)return l[l.length-1]=0,[n.makeTensorInfo(l,i.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(c===1)return[i,Uw({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const f=n.texData.get(i.dataId),h=f!==null&&f.isPacked,d=h?n.unpackTensor(i):i,m=ce(l)/c,g=ke({inputs:{x:d},attrs:{shape:[m,c]},backend:n});h&&Xh(n,d);const y=$G(s),b=$G(c);let x=null;const v=()=>x===null?[g,g]:[g,x],w=(k,E,F)=>{const T=v(),I=new XVe(F),N=[[c],[x===null?1:0],[Number.NEGATIVE_INFINITY],[k],[E]],V=x;x=n.runWebGLProgram(I,T,"int32",N),Xh(n,V)};for(let k=1;k<y;k*=2){const E=k*2;for(let F=k;F>=1;F/=2)w(E,F,[m,b])}for(let k=b;k>y;k/=2){const E=v(),F=new YVe([m,k/2]),I=[[c],[x===null?1:0],[y]],D=x;x=n.runWebGLProgram(F,E,"int32",I),Xh(n,D);const N=y/2,V=N*2;for(let U=N;U>=1;U/=2)w(V,U,x.shape)}let C=x;x=U1({inputs:{x},backend:n,attrs:{begin:0,size:[m,s]}}),Xh(n,C);let S=Hoe({inputs:{x:g,indices:x},backend:n,attrs:{axis:1,batchDims:1}});Xh(n,g);const _=l.slice(0,-1);_.push(s),C=x,x=ke({inputs:{x},attrs:{shape:_},backend:n}),Xh(n,C);const $=S;return S=ke({inputs:{x:S},attrs:{shape:_},backend:n}),Xh(n,$),[S,x]}const ZVe={kernelName:ST,backendName:"webgl",kernelFunc:KVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JVe{constructor(t,n,r,i,s,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=r==="nearest"?1:2;let u;switch(i){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QVe(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,transforms:s}=t,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=r,[c,f,h,d]=i.shape,[p,m]=l??[f,h],g=[c,p,m,d],y=new JVe(f,h,o,a,u,g);return n.runWebGLProgram(y,[i,s],"float32")}const eGe={kernelName:_T,backendName:"webgl",kernelFunc:QVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tGe(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:s}=t;Bw(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(s.dataId),{outputValues:a,outputShape:u,indices:l}=eze(o,i,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}const nGe={kernelName:$T,backendName:"webgl",kernelFunc:tGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rGe(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i,a=o.shape.length,u=i.shape[s],l=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==s&&(l[c++]=o.shape[m]);const f=[],h=new Array(a).fill(0),d=o.shape.slice();d[s]=1;const p=new Array(u);for(let m=0;m<p.length;m++){h[s]=m;const g=U1({inputs:{x:o},backend:n,attrs:{begin:h,size:d}}),y=ke({inputs:{x:g},backend:n,attrs:{shape:l}});p[m]=y,f.push(g)}return f.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const iGe={kernelName:dw,backendName:"webgl",kernelFunc:rGe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sGe{constructor(t,n){this.variableNames=["x","segmentIds"];const r=t.windowSize,i=t.batchSize,s=t.inSize,o=t.numSegments,a=o*Math.ceil(s/r);this.outputShape=[i,a];const u="0.0",l="sumValue",c=Math.floor(r/4)*4,f=r%4,h=`
        sumValue += dot(values, segFilter);
    `;let d="";s%r>0&&(d=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oGe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:s}=t,{numSegments:o}=r,a=i.shape.length,u=[];let l=0;const c=Tn([l],a);let f=i;c!=null&&(f=Ai({inputs:{x:i},backend:n,attrs:{perm:c}}),u.push(f),l=zn(1,a)[0]);const h=Mne(f.shape,l,o),d=ce([f.shape[l]]),p=ke({inputs:{x:f},backend:n,attrs:{shape:[-1,d]}});u.push(p);const m=AT(i.dtype),g=(v,w,C,S,_)=>{const $=v.shape[0],k=v.shape[1],E=Nne(k,_),F={windowSize:E,inSize:k,batchSize:$,numSegments:_},T=new sGe(F,w),I=n.compileAndRun(T,[v,C],S);if(u.push(I),I.shape[1]===_)return I;const D=Qoe({backend:n,attrs:{start:0,stop:_,step:1,dtype:"float32"}}),N=eae({inputs:{x:D},backend:n,attrs:{reps:[k/E]}});return u.push(D),u.push(N),g(I,w,N,S,_)},y=g(p,"unsortedSegmentSum",s,m,o),b=ke({inputs:{x:y},backend:n,attrs:{shape:h}});let x=b;if(c!=null){u.push(b);const v=yh(c);x=Ai({inputs:{x},backend:n,attrs:{perm:v}})}return u.forEach(v=>n.disposeIntermediateTensorInfo(v)),x}const aGe={kernelName:pw,backendName:"webgl",kernelFunc:oGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uGe=[Gze,qze,Kze,Qze,t6e,i6e,o6e,u6e,h6e,p6e,y6e,x6e,S6e,E6e,D6e,F6e,N6e,L6e,z6e,U6e,H6e,Q6e,t8e,s8e,a8e,d8e,g8e,v8e,Aze,C8e,E8e,I8e,P8e,z8e,U8e,V8e,H8e,K8e,Q8e,n7e,i7e,o7e,u7e,f7e,d7e,y7e,v7e,C7e,$7e,E7e,I7e,M7e,B7e,U7e,G7e,H7e,X7e,K7e,J7e,e9e,n9e,o9e,l9e,h9e,p9e,y9e,x9e,_9e,A9e,Eze,D9e,$8e,O9e,R9e,B9e,Dze,W9e,q9e,Y9e,Q9e,nje,oje,lje,dje,yje,xje,Cje,kje,Aje,Dje,Nje,Rje,Lje,zje,Uje,Hje,Kje,eUe,uUe,Oze,hUe,gUe,bUe,wUe,l8e,_Ue,kUe,AUe,IUe,MUe,Fze,PUe,BUe,jUe,WUe,VUe,c8e,iUe,qUe,ZUe,tWe,Mze,sWe,uWe,hWe,gWe,vWe,wWe,_We,EWe,DWe,OWe,RWe,BWe,WWe,HWe,KWe,QWe,Z6e,oUe,nVe,iVe,oVe,uVe,cVe,hVe,pVe,mVe,bVe,wVe,SVe,$Ve,EVe,DVe,FVe,NVe,RVe,sUe,Uze,BVe,UVe,VVe,qVe,ZVe,eGe,Wze,nGe,iGe,aGe,$Ue];for(const e of uGe)ET(e);const lGe=!1;async function cGe({url:e}){const t=new URL(x2e+"/model.json",e);return{model:await _Oe(t.toString())}}const r9t=Object.freeze(Object.defineProperty({__proto__:null,load:cGe,ssr:lGe},Symbol.toStringTag,{value:"Module"}));var tae={};(function(e){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(e.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var n=F_,r=new n.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=r.document,t.jsdomImplForWrapper=F_.implForWrapper,t.nodeCanvas=F_.Canvas,t.window=r,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function a(d,p){if(this.__eventListeners[d]){var m=this.__eventListeners[d];p?m[m.indexOf(p)]=!1:t.util.array.fill(m,!1)}}function u(d,p){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var m in d)this.on(m,d[m]);else this.__eventListeners[d]||(this.__eventListeners[d]=[]),this.__eventListeners[d].push(p);return this}function l(d,p){var m=function(){p.apply(this,arguments),this.off(d,m)}.bind(this);this.on(d,m)}function c(d,p){if(arguments.length===1)for(var m in d)l.call(this,m,d[m]);else l.call(this,d,p);return this}function f(d,p){if(!this.__eventListeners)return this;if(arguments.length===0)for(d in this.__eventListeners)a.call(this,d);else if(arguments.length===1&&typeof arguments[0]=="object")for(var m in d)a.call(this,m,d[m]);else a.call(this,d,p);return this}function h(d,p){if(!this.__eventListeners)return this;var m=this.__eventListeners[d];if(!m)return this;for(var g=0,y=m.length;g<y;g++)m[g]&&m[g].call(this,p||{});return this.__eventListeners[d]=m.filter(function(b){return b!==!1}),this}t.Observable={fire:h,on:u,once:c,off:f}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,u=arguments.length;a<u;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(a,u,l){var c=this._objects;return l?c[u]=a:c.splice(u,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var a=this._objects,u,l=!1,c=0,f=arguments.length;c<f;c++)u=a.indexOf(arguments[c]),u!==-1&&(l=!0,a.splice(u,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[c]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(a,u){for(var l=this.getObjects(),c=0,f=l.length;c<f;c++)a.call(u,l[c],c,l);return this},getObjects:function(a){return typeof a>"u"?this._objects.concat():this._objects.filter(function(u){return u.type===a})},item:function(a){return this._objects[a]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(a,u){return this._objects.indexOf(a)>-1?!0:u?this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(a,!0)}):!1},complexity:function(){return this._objects.reduce(function(a,u){return a+=u.complexity?u.complexity():0,a},0)}},t.CommonMethods={_setOptions:function(a){for(var u in a)this.set(u,a[u])},_initGradient:function(a,u){a&&a.colorStops&&!(a instanceof t.Gradient)&&this.set(u,new t.Gradient(a))},_initPattern:function(a,u,l){a&&a.source&&!(a instanceof t.Pattern)?this.set(u,new t.Pattern(a,l)):l&&l()},_setObject:function(a){for(var u in a)this._set(u,a[u])},set:function(a,u){return typeof a=="object"?this._setObject(a):this._set(a,u),this},_set:function(a,u){this[a]=u},toggle:function(a){var u=this.get(a);return typeof u=="boolean"&&this.set(a,!u),this},get:function(a){return this[a]}},function(a){var u=Math.sqrt,l=Math.atan2,c=Math.pow,f=Math.PI/180,h=Math.PI/2;t.util={cos:function(d){if(d===0)return 1;d<0&&(d=-d);var p=d/h;switch(p){case 1:case 3:return 0;case 2:return-1}return Math.cos(d)},sin:function(d){if(d===0)return 0;var p=d/h,m=1;switch(d<0&&(m=-1),p){case 1:return m;case 2:return 0;case 3:return-m}return Math.sin(d)},removeFromArray:function(d,p){var m=d.indexOf(p);return m!==-1&&d.splice(m,1),d},getRandomInt:function(d,p){return Math.floor(Math.random()*(p-d+1))+d},degreesToRadians:function(d){return d*f},radiansToDegrees:function(d){return d/f},rotatePoint:function(d,p,m){var g=new t.Point(d.x-p.x,d.y-p.y),y=t.util.rotateVector(g,m);return new t.Point(y.x,y.y).addEquals(p)},rotateVector:function(d,p){var m=t.util.sin(p),g=t.util.cos(p),y=d.x*g-d.y*m,b=d.x*m+d.y*g;return{x:y,y:b}},createVector:function(d,p){return new t.Point(p.x-d.x,p.y-d.y)},calcAngleBetweenVectors:function(d,p){return Math.acos((d.x*p.x+d.y*p.y)/(Math.hypot(d.x,d.y)*Math.hypot(p.x,p.y)))},getHatVector:function(d){return new t.Point(d.x,d.y).multiply(1/Math.hypot(d.x,d.y))},getBisector:function(d,p,m){var g=t.util.createVector(d,p),y=t.util.createVector(d,m),b=t.util.calcAngleBetweenVectors(g,y),x=t.util.calcAngleBetweenVectors(t.util.rotateVector(g,b),y),v=b*(x===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(g,v)),angle:b}},projectStrokeOnPoints:function(d,p,m){var g=[],y=p.strokeWidth/2,b=p.strokeUniform?new t.Point(1/p.scaleX,1/p.scaleY):new t.Point(1,1),x=function(v){var w=y/Math.hypot(v.x,v.y);return new t.Point(v.x*w*b.x,v.y*w*b.y)};return d.length<=1||d.forEach(function(v,w){var C=new t.Point(v.x,v.y),S,_;w===0?(_=d[w+1],S=m?x(t.util.createVector(_,C)).addEquals(C):d[d.length-1]):w===d.length-1?(S=d[w-1],_=m?x(t.util.createVector(S,C)).addEquals(C):d[0]):(S=d[w-1],_=d[w+1]);var $=t.util.getBisector(C,S,_),k=$.vector,E=$.angle,F,T;if(p.strokeLineJoin==="miter"&&(F=-y/Math.sin(E/2),T=new t.Point(k.x*F*b.x,k.y*F*b.y),Math.hypot(T.x,T.y)/y<=p.strokeMiterLimit)){g.push(C.add(T)),g.push(C.subtract(T));return}F=-y*Math.SQRT2,T=new t.Point(k.x*F*b.x,k.y*F*b.y),g.push(C.add(T)),g.push(C.subtract(T))}),g},transformPoint:function(d,p,m){return m?new t.Point(p[0]*d.x+p[2]*d.y,p[1]*d.x+p[3]*d.y):new t.Point(p[0]*d.x+p[2]*d.y+p[4],p[1]*d.x+p[3]*d.y+p[5])},makeBoundingBoxFromPoints:function(d,p){if(p)for(var m=0;m<d.length;m++)d[m]=t.util.transformPoint(d[m],p);var g=[d[0].x,d[1].x,d[2].x,d[3].x],y=t.util.array.min(g),b=t.util.array.max(g),x=b-y,v=[d[0].y,d[1].y,d[2].y,d[3].y],w=t.util.array.min(v),C=t.util.array.max(v),S=C-w;return{left:y,top:w,width:x,height:S}},invertTransform:function(d){var p=1/(d[0]*d[3]-d[1]*d[2]),m=[p*d[3],-p*d[1],-p*d[2],p*d[0]],g=t.util.transformPoint({x:d[4],y:d[5]},m,!0);return m[4]=-g.x,m[5]=-g.y,m},toFixed:function(d,p){return parseFloat(Number(d).toFixed(p))},parseUnit:function(d,p){var m=/\D{0,2}$/.exec(d),g=parseFloat(d);switch(p||(p=t.Text.DEFAULT_SVG_FONT_SIZE),m[0]){case"mm":return g*t.DPI/25.4;case"cm":return g*t.DPI/2.54;case"in":return g*t.DPI;case"pt":return g*t.DPI/72;case"pc":return g*t.DPI/72*12;case"em":return g*p;default:return g}},falseFunction:function(){return!1},getKlass:function(d,p){return d=t.util.string.camelize(d.charAt(0).toUpperCase()+d.slice(1)),t.util.resolveNamespace(p)[d]},getSvgAttributes:function(d){var p=["instantiated_by_use","style","id","class"];switch(d){case"linearGradient":p=p.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":p=p.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":p=p.concat(["offset","stop-color","stop-opacity"]);break}return p},resolveNamespace:function(d){if(!d)return t;var p=d.split("."),m=p.length,g,y=a||t.window;for(g=0;g<m;++g)y=y[p[g]];return y},loadImage:function(d,p,m,g){if(!d){p&&p.call(m,d);return}var y=t.util.createImage(),b=function(){p&&p.call(m,y,!1),y=y.onload=y.onerror=null};y.onload=b,y.onerror=function(){t.log("Error loading "+y.src),p&&p.call(m,null,!0),y=y.onload=y.onerror=null},d.indexOf("data")!==0&&g!==void 0&&g!==null&&(y.crossOrigin=g),d.substring(0,14)==="data:image/svg"&&(y.onload=null,t.util.loadImageInDom(y,b)),y.src=d},loadImageInDom:function(d,p){var m=t.document.createElement("div");m.style.width=m.style.height="1px",m.style.left=m.style.top="-100%",m.style.position="absolute",m.appendChild(d),t.document.querySelector("body").appendChild(m),d.onload=function(){p(),m.parentNode.removeChild(m),m=null}},enlivenObjects:function(d,p,m,g){d=d||[];var y=[],b=0,x=d.length;function v(){++b===x&&p&&p(y.filter(function(w){return w}))}if(!x){p&&p(y);return}d.forEach(function(w,C){if(!w||!w.type){v();return}var S=t.util.getKlass(w.type,m);S.fromObject(w,function(_,$){$||(y[C]=_),g&&g(w,_,$),v()})})},enlivenObjectEnlivables:function(d,p,m){var g=t.Object.ENLIVEN_PROPS.filter(function(y){return!!d[y]});t.util.enlivenObjects(g.map(function(y){return d[y]}),function(y){var b={};g.forEach(function(x,v){b[x]=y[v],p&&(p[x]=y[v])}),m&&m(b)})},enlivenPatterns:function(d,p){d=d||[];function m(){++y===b&&p&&p(g)}var g=[],y=0,b=d.length;if(!b){p&&p(g);return}d.forEach(function(x,v){x&&x.source?new t.Pattern(x,function(w){g[v]=w,m()}):(g[v]=x,m())})},groupSVGElements:function(d,p,m){var g;return d&&d.length===1?(typeof m<"u"&&(d[0].sourcePath=m),d[0]):(p&&(p.width&&p.height?p.centerPoint={x:p.width/2,y:p.height/2}:(delete p.width,delete p.height)),g=new t.Group(d,p),typeof m<"u"&&(g.sourcePath=m),g)},populateWithProperties:function(d,p,m){if(m&&Array.isArray(m))for(var g=0,y=m.length;g<y;g++)m[g]in d&&(p[m[g]]=d[m[g]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(d){var p=t.util.createCanvasElement();return p.width=d.width,p.height=d.height,p.getContext("2d").drawImage(d,0,0),p},toDataURL:function(d,p,m){return d.toDataURL("image/"+p,m)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(d,p,m){return[d[0]*p[0]+d[2]*p[1],d[1]*p[0]+d[3]*p[1],d[0]*p[2]+d[2]*p[3],d[1]*p[2]+d[3]*p[3],m?0:d[0]*p[4]+d[2]*p[5]+d[4],m?0:d[1]*p[4]+d[3]*p[5]+d[5]]},qrDecompose:function(d){var p=l(d[1],d[0]),m=c(d[0],2)+c(d[1],2),g=u(m),y=(d[0]*d[3]-d[2]*d[1])/g,b=l(d[0]*d[2]+d[1]*d[3],m);return{angle:p/f,scaleX:g,scaleY:y,skewX:b/f,skewY:0,translateX:d[4],translateY:d[5]}},calcRotateMatrix:function(d){if(!d.angle)return t.iMatrix.concat();var p=t.util.degreesToRadians(d.angle),m=t.util.cos(p),g=t.util.sin(p);return[m,g,-g,m,0,0]},calcDimensionsMatrix:function(d){var p=typeof d.scaleX>"u"?1:d.scaleX,m=typeof d.scaleY>"u"?1:d.scaleY,g=[d.flipX?-p:p,0,0,d.flipY?-m:m,0,0],y=t.util.multiplyTransformMatrices,b=t.util.degreesToRadians;return d.skewX&&(g=y(g,[1,0,Math.tan(b(d.skewX)),1],!0)),d.skewY&&(g=y(g,[1,Math.tan(b(d.skewY)),0,1],!0)),g},composeMatrix:function(d){var p=[1,0,0,1,d.translateX||0,d.translateY||0],m=t.util.multiplyTransformMatrices;return d.angle&&(p=m(p,t.util.calcRotateMatrix(d))),(d.scaleX!==1||d.scaleY!==1||d.skewX||d.skewY||d.flipX||d.flipY)&&(p=m(p,t.util.calcDimensionsMatrix(d))),p},resetObjectTransform:function(d){d.scaleX=1,d.scaleY=1,d.skewX=0,d.skewY=0,d.flipX=!1,d.flipY=!1,d.rotate(0)},saveObjectTransform:function(d){return{scaleX:d.scaleX,scaleY:d.scaleY,skewX:d.skewX,skewY:d.skewY,angle:d.angle,left:d.left,flipX:d.flipX,flipY:d.flipY,top:d.top}},isTransparent:function(d,p,m,g){g>0&&(p>g?p-=g:p=0,m>g?m-=g:m=0);var y=!0,b,x,v=d.getImageData(p,m,g*2||1,g*2||1),w=v.data.length;for(b=3;b<w&&(x=v.data[b],y=x<=0,y!==!1);b+=4);return v=null,y},parsePreserveAspectRatioAttribute:function(d){var p="meet",m="Mid",g="Mid",y=d.split(" "),b;return y&&y.length&&(p=y.pop(),p!=="meet"&&p!=="slice"?(b=p,p="meet"):y.length&&(b=y.pop())),m=b!=="none"?b.slice(1,4):"none",g=b!=="none"?b.slice(5,8):"none",{meetOrSlice:p,alignX:m,alignY:g}},clearFabricFontCache:function(d){d=(d||"").toLowerCase(),d?t.charWidthsCache[d]&&delete t.charWidthsCache[d]:t.charWidthsCache={}},limitDimsByArea:function(d,p){var m=Math.sqrt(p*d),g=Math.floor(p/m);return{x:Math.floor(m),y:g}},capValue:function(d,p,m){return Math.max(d,Math.min(p,m))},findScaleToFit:function(d,p){return Math.min(p.width/d.width,p.height/d.height)},findScaleToCover:function(d,p){return Math.max(p.width/d.width,p.height/d.height)},matrixToSVG:function(d){return"matrix("+d.map(function(p){return t.util.toFixed(p,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(d,p){var m=t.util.invertTransform(p),g=t.util.multiplyTransformMatrices(m,d.calcOwnMatrix());t.util.applyTransformToObject(d,g)},addTransformToObject:function(d,p){t.util.applyTransformToObject(d,t.util.multiplyTransformMatrices(p,d.calcOwnMatrix()))},applyTransformToObject:function(d,p){var m=t.util.qrDecompose(p),g=new t.Point(m.translateX,m.translateY);d.flipX=!1,d.flipY=!1,d.set("scaleX",m.scaleX),d.set("scaleY",m.scaleY),d.skewX=m.skewX,d.skewY=m.skewY,d.angle=m.angle,d.setPositionByOrigin(g,"center","center")},sizeAfterTransform:function(d,p,m){var g=d/2,y=p/2,b=[{x:-g,y:-y},{x:g,y:-y},{x:-g,y},{x:g,y}],x=t.util.calcDimensionsMatrix(m),v=t.util.makeBoundingBoxFromPoints(b,x);return{x:v.width,y:v.height}},mergeClipPaths:function(d,p){var m=d,g=p;m.inverted&&!g.inverted&&(m=p,g=d),t.util.applyTransformToObject(g,t.util.multiplyTransformMatrices(t.util.invertTransform(m.calcTransformMatrix()),g.calcTransformMatrix()));var y=m.inverted&&g.inverted;return y&&(m.inverted=g.inverted=!1),new t.Group([m],{clipPath:g,inverted:y})},hasStyleChanged:function(d,p,m){return m=m||!1,d.fill!==p.fill||d.stroke!==p.stroke||d.strokeWidth!==p.strokeWidth||d.fontSize!==p.fontSize||d.fontFamily!==p.fontFamily||d.fontWeight!==p.fontWeight||d.fontStyle!==p.fontStyle||d.textBackgroundColor!==p.textBackgroundColor||d.deltaY!==p.deltaY||m&&(d.overline!==p.overline||d.underline!==p.underline||d.linethrough!==p.linethrough)},stylesToArray:function(m,p){for(var m=t.util.object.clone(m,!0),g=p.split(`
`),y=-1,b={},x=[],v=0;v<g.length;v++){if(!m[v]){y+=g[v].length;continue}for(var w=0;w<g[v].length;w++){y++;var C=m[v][w];if(C&&Object.keys(C).length>0){var S=t.util.hasStyleChanged(b,C,!0);S?x.push({start:y,end:y+1,style:C}):x[x.length-1].end++}b=C||{}}}return x},stylesFromArray:function(d,p){if(!Array.isArray(d))return d;for(var m=p.split(`
`),g=-1,y=0,b={},x=0;x<m.length;x++)for(var v=0;v<m[x].length;v++)g++,d[y]&&d[y].start<=g&&g<d[y].end&&(b[x]=b[x]||{},b[x][v]=Object.assign({},d[y].style),g===d[y].end-1&&y++);return b}}}(e),function(){var a=Array.prototype.join,u={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function c(A,M,P,j,q,B,O,G,Z,re,R){var H=t.util.cos(A),Y=t.util.sin(A),L=t.util.cos(M),te=t.util.sin(M),X=P*q*L-j*B*te+O,ie=j*q*L+P*B*te+G,se=re+Z*(-P*q*Y-j*B*H),oe=R+Z*(-j*q*Y+P*B*H),le=X+Z*(P*q*te+j*B*L),Ce=ie+Z*(j*q*te-P*B*L);return["C",se,oe,le,Ce,X,ie]}function f(A,M,P,j,q,B,O){var G=Math.PI,Z=O*G/180,re=t.util.sin(Z),R=t.util.cos(Z),H=0,Y=0;P=Math.abs(P),j=Math.abs(j);var L=-R*A*.5-re*M*.5,te=-R*M*.5+re*A*.5,X=P*P,ie=j*j,se=te*te,oe=L*L,le=X*ie-X*se-ie*oe,Ce=0;if(le<0){var Me=Math.sqrt(1-le/(X*ie));P*=Me,j*=Me}else Ce=(q===B?-1:1)*Math.sqrt(le/(X*se+ie*oe));var Fe=Ce*P*te/j,de=-Ce*j*L/P,Re=R*Fe-re*de+A*.5,qe=re*Fe+R*de+M*.5,ot=h(1,0,(L-Fe)/P,(te-de)/j),Ft=h((L-Fe)/P,(te-de)/j,(-L-Fe)/P,(-te-de)/j);B===0&&Ft>0?Ft-=2*G:B===1&&Ft<0&&(Ft+=2*G);for(var xt=Math.ceil(Math.abs(Ft/G*2)),Cn=[],ln=Ft/xt,Yo=8/3*Math.sin(ln/4)*Math.sin(ln/4)/Math.sin(ln/2),ml=ot+ln,ao=0;ao<xt;ao++)Cn[ao]=c(ot,ml,R,re,P,j,Re,qe,Yo,H,Y),H=Cn[ao][5],Y=Cn[ao][6],ot=ml,ml+=ln;return Cn}function h(A,M,P,j){var q=Math.atan2(M,A),B=Math.atan2(j,P);return B>=q?B-q:2*Math.PI-(q-B)}function d(A,M,P,j,q,B,O,G){var Z;if(t.cachesBoundsOfCurve&&(Z=a.call(arguments),t.boundsOfCurveCache[Z]))return t.boundsOfCurveCache[Z];var re=Math.sqrt,R=Math.min,H=Math.max,Y=Math.abs,L=[],te=[[],[]],X,ie,se,oe,le,Ce,Me,Fe;ie=6*A-12*P+6*q,X=-3*A+9*P-9*q+3*O,se=3*P-3*A;for(var de=0;de<2;++de){if(de>0&&(ie=6*M-12*j+6*B,X=-3*M+9*j-9*B+3*G,se=3*j-3*M),Y(X)<1e-12){if(Y(ie)<1e-12)continue;oe=-se/ie,0<oe&&oe<1&&L.push(oe);continue}Me=ie*ie-4*se*X,!(Me<0)&&(Fe=re(Me),le=(-ie+Fe)/(2*X),0<le&&le<1&&L.push(le),Ce=(-ie-Fe)/(2*X),0<Ce&&Ce<1&&L.push(Ce))}for(var Re,qe,ot=L.length,Ft=ot,xt;ot--;)oe=L[ot],xt=1-oe,Re=xt*xt*xt*A+3*xt*xt*oe*P+3*xt*oe*oe*q+oe*oe*oe*O,te[0][ot]=Re,qe=xt*xt*xt*M+3*xt*xt*oe*j+3*xt*oe*oe*B+oe*oe*oe*G,te[1][ot]=qe;te[0][Ft]=A,te[1][Ft]=M,te[0][Ft+1]=O,te[1][Ft+1]=G;var Cn=[{x:R.apply(null,te[0]),y:R.apply(null,te[1])},{x:H.apply(null,te[0]),y:H.apply(null,te[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[Z]=Cn),Cn}function p(A,M,P){for(var j=P[1],q=P[2],B=P[3],O=P[4],G=P[5],Z=P[6],re=P[7],R=f(Z-A,re-M,j,q,O,G,B),H=0,Y=R.length;H<Y;H++)R[H][1]+=A,R[H][2]+=M,R[H][3]+=A,R[H][4]+=M,R[H][5]+=A,R[H][6]+=M;return R}function m(A){var M=0,P=0,j=A.length,q=0,B=0,O,G,Z,re=[],R,H,Y;for(G=0;G<j;++G){switch(Z=!1,O=A[G].slice(0),O[0]){case"l":O[0]="L",O[1]+=M,O[2]+=P;case"L":M=O[1],P=O[2];break;case"h":O[1]+=M;case"H":O[0]="L",O[2]=P,M=O[1];break;case"v":O[1]+=P;case"V":O[0]="L",P=O[1],O[1]=M,O[2]=P;break;case"m":O[0]="M",O[1]+=M,O[2]+=P;case"M":M=O[1],P=O[2],q=O[1],B=O[2];break;case"c":O[0]="C",O[1]+=M,O[2]+=P,O[3]+=M,O[4]+=P,O[5]+=M,O[6]+=P;case"C":H=O[3],Y=O[4],M=O[5],P=O[6];break;case"s":O[0]="S",O[1]+=M,O[2]+=P,O[3]+=M,O[4]+=P;case"S":R==="C"?(H=2*M-H,Y=2*P-Y):(H=M,Y=P),M=O[3],P=O[4],O[0]="C",O[5]=O[3],O[6]=O[4],O[3]=O[1],O[4]=O[2],O[1]=H,O[2]=Y,H=O[3],Y=O[4];break;case"q":O[0]="Q",O[1]+=M,O[2]+=P,O[3]+=M,O[4]+=P;case"Q":H=O[1],Y=O[2],M=O[3],P=O[4];break;case"t":O[0]="T",O[1]+=M,O[2]+=P;case"T":R==="Q"?(H=2*M-H,Y=2*P-Y):(H=M,Y=P),O[0]="Q",M=O[1],P=O[2],O[1]=H,O[2]=Y,O[3]=M,O[4]=P;break;case"a":O[0]="A",O[6]+=M,O[7]+=P;case"A":Z=!0,re=re.concat(p(M,P,O)),M=O[6],P=O[7];break;case"z":case"Z":M=q,P=B;break}Z||re.push(O),R=O[0]}return re}function g(A,M,P,j){return Math.sqrt((P-A)*(P-A)+(j-M)*(j-M))}function y(A){return A*A*A}function b(A){return 3*A*A*(1-A)}function x(A){return 3*A*(1-A)*(1-A)}function v(A){return(1-A)*(1-A)*(1-A)}function w(A,M,P,j,q,B,O,G){return function(Z){var re=y(Z),R=b(Z),H=x(Z),Y=v(Z);return{x:O*re+q*R+P*H+A*Y,y:G*re+B*R+j*H+M*Y}}}function C(A,M,P,j,q,B,O,G){return function(Z){var re=1-Z,R=3*re*re*(P-A)+6*re*Z*(q-P)+3*Z*Z*(O-q),H=3*re*re*(j-M)+6*re*Z*(B-j)+3*Z*Z*(G-B);return Math.atan2(H,R)}}function S(A){return A*A}function _(A){return 2*A*(1-A)}function $(A){return(1-A)*(1-A)}function k(A,M,P,j,q,B){return function(O){var G=S(O),Z=_(O),re=$(O);return{x:q*G+P*Z+A*re,y:B*G+j*Z+M*re}}}function E(A,M,P,j,q,B){return function(O){var G=1-O,Z=2*G*(P-A)+2*O*(q-P),re=2*G*(j-M)+2*O*(B-j);return Math.atan2(re,Z)}}function F(A,M,P){var j={x:M,y:P},q,B=0,O;for(O=1;O<=100;O+=1)q=A(O/100),B+=g(j.x,j.y,q.x,q.y),j=q;return B}function T(A,M){for(var P=0,j=0,q=A.iterator,B={x:A.x,y:A.y},O,G,Z=.01,re=A.angleFinder,R;j<M&&Z>1e-4;)O=q(P),R=P,G=g(B.x,B.y,O.x,O.y),G+j>M?(P-=Z,Z/=2):(B=O,P+=Z,j+=G);return O.angle=re(R),O}function I(A){for(var M=0,P=A.length,j,q=0,B=0,O=0,G=0,Z=[],re,R,H,Y=0;Y<P;Y++){switch(j=A[Y],R={x:q,y:B,command:j[0]},j[0]){case"M":R.length=0,O=q=j[1],G=B=j[2];break;case"L":R.length=g(q,B,j[1],j[2]),q=j[1],B=j[2];break;case"C":re=w(q,B,j[1],j[2],j[3],j[4],j[5],j[6]),H=C(q,B,j[1],j[2],j[3],j[4],j[5],j[6]),R.iterator=re,R.angleFinder=H,R.length=F(re,q,B),q=j[5],B=j[6];break;case"Q":re=k(q,B,j[1],j[2],j[3],j[4]),H=E(q,B,j[1],j[2],j[3],j[4]),R.iterator=re,R.angleFinder=H,R.length=F(re,q,B),q=j[3],B=j[4];break;case"Z":case"z":R.destX=O,R.destY=G,R.length=g(q,B,O,G),q=O,B=G;break}M+=R.length,Z.push(R)}return Z.push({length:M,x:q,y:B}),Z}function D(A,M,P){P||(P=I(A));for(var j=0;M-P[j].length>0&&j<P.length-2;)M-=P[j].length,j++;var q=P[j],B=M/q.length,O=q.command,G=A[j],Z;switch(O){case"M":return{x:q.x,y:q.y,angle:0};case"Z":case"z":return Z=new t.Point(q.x,q.y).lerp(new t.Point(q.destX,q.destY),B),Z.angle=Math.atan2(q.destY-q.y,q.destX-q.x),Z;case"L":return Z=new t.Point(q.x,q.y).lerp(new t.Point(G[1],G[2]),B),Z.angle=Math.atan2(G[2]-q.y,G[1]-q.x),Z;case"C":return T(q,M);case"Q":return T(q,M)}}function N(A){var M=[],P=[],j,q,B=t.rePathCommand,O="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",G="("+O+")"+t.commaWsp,Z="([01])"+t.commaWsp+"?",re=G+"?"+G+"?"+G+Z+Z+G+"?("+O+")",R=new RegExp(re,"g"),H,Y,L;if(!A||!A.match)return M;L=A.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var te=0,X,ie=L.length;te<ie;te++){j=L[te],Y=j.slice(1).trim(),P.length=0;var se=j.charAt(0);if(X=[se],se.toLowerCase()==="a")for(var oe;oe=R.exec(Y);)for(var le=1;le<oe.length;le++)P.push(oe[le]);else for(;H=B.exec(Y);)P.push(H[0]);for(var le=0,Ce=P.length;le<Ce;le++)q=parseFloat(P[le]),isNaN(q)||X.push(q);var Me=u[se.toLowerCase()],Fe=l[se]||se;if(X.length-1>Me)for(var de=1,Re=X.length;de<Re;de+=Me)M.push([se].concat(X.slice(de,de+Me))),se=Fe;else M.push(X)}return M}function V(A,M){var P=[],j,q=new t.Point(A[0].x,A[0].y),B=new t.Point(A[1].x,A[1].y),O=A.length,G=1,Z=0,re=O>2;for(M=M||0,re&&(G=A[2].x<B.x?-1:A[2].x===B.x?0:1,Z=A[2].y<B.y?-1:A[2].y===B.y?0:1),P.push(["M",q.x-G*M,q.y-Z*M]),j=1;j<O;j++){if(!q.eq(B)){var R=q.midPointFrom(B);P.push(["Q",q.x,q.y,R.x,R.y])}q=A[j],j+1<A.length&&(B=A[j+1])}return re&&(G=q.x>A[j-2].x?1:q.x===A[j-2].x?0:-1,Z=q.y>A[j-2].y?1:q.y===A[j-2].y?0:-1),P.push(["L",q.x+G*M,q.y+Z*M]),P}function U(A,M,P){return P&&(M=t.util.multiplyTransformMatrices(M,[1,0,0,1,-P.x,-P.y])),A.map(function(j){for(var q=j.slice(0),B={},O=1;O<j.length-1;O+=2)B.x=j[O],B.y=j[O+1],B=t.util.transformPoint(B,M),q[O]=B.x,q[O+1]=B.y;return q})}t.util.joinPath=function(A){return A.map(function(M){return M.join(" ")}).join(" ")},t.util.parsePath=N,t.util.makePathSimpler=m,t.util.getSmoothPathFromPoints=V,t.util.getPathSegmentsInfo=I,t.util.getBoundsOfCurve=d,t.util.getPointOnPath=D,t.util.transformPath=U}(),function(){var a=Array.prototype.slice;function u(d,p){for(var m=a.call(arguments,2),g=[],y=0,b=d.length;y<b;y++)g[y]=m.length?d[y][p].apply(d[y],m):d[y][p].call(d[y]);return g}function l(d,p){return h(d,p,function(m,g){return m>=g})}function c(d,p){return h(d,p,function(m,g){return m<g})}function f(d,p){for(var m=d.length;m--;)d[m]=p;return d}function h(d,p,m){if(!(!d||d.length===0)){var g=d.length-1,y=p?d[g][p]:d[g];if(p)for(;g--;)m(d[g][p],y)&&(y=d[g][p]);else for(;g--;)m(d[g],y)&&(y=d[g]);return y}}t.util.array={fill:f,invoke:u,min:c,max:l}}(),function(){function a(l,c,f){if(f)if(!t.isLikelyNode&&c instanceof Element)l=c;else if(c instanceof Array){l=[];for(var h=0,d=c.length;h<d;h++)l[h]=a({},c[h],f)}else if(c&&typeof c=="object")for(var p in c)p==="canvas"||p==="group"?l[p]=null:c.hasOwnProperty(p)&&(l[p]=a({},c[p],f));else l=c;else for(var p in c)l[p]=c[p];return l}function u(l,c){return a({},l,c)}t.util.object={extend:a,clone:u},t.util.object.extend(t.util,t.Observable)}(),function(){function a(h){return h.replace(/-+(.)?/g,function(d,p){return p?p.toUpperCase():""})}function u(h,d){return h.charAt(0).toUpperCase()+(d?h.slice(1):h.slice(1).toLowerCase())}function l(h){return h.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(h){var d=0,p,m=[];for(d=0,p;d<h.length;d++)(p=f(h,d))!==!1&&m.push(p);return m}function f(h,d){var p=h.charCodeAt(d);if(isNaN(p))return"";if(p<55296||p>57343)return h.charAt(d);if(55296<=p&&p<=56319){if(h.length<=d+1)throw"High surrogate without following low surrogate";var m=h.charCodeAt(d+1);if(56320>m||m>57343)throw"High surrogate without following low surrogate";return h.charAt(d)+h.charAt(d+1)}if(d===0)throw"Low surrogate without preceding high surrogate";var g=h.charCodeAt(d-1);if(55296>g||g>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:a,capitalize:u,escapeXml:l,graphemeSplit:c}}(),function(){var a=Array.prototype.slice,u=function(){},l=function(){for(var p in{toString:1})if(p==="toString")return!1;return!0}(),c=function(p,m,g){for(var y in m)y in p.prototype&&typeof p.prototype[y]=="function"&&(m[y]+"").indexOf("callSuper")>-1?p.prototype[y]=function(b){return function(){var x=this.constructor.superclass;this.constructor.superclass=g;var v=m[b].apply(this,arguments);if(this.constructor.superclass=x,b!=="initialize")return v}}(y):p.prototype[y]=m[y],l&&(m.toString!==Object.prototype.toString&&(p.prototype.toString=m.toString),m.valueOf!==Object.prototype.valueOf&&(p.prototype.valueOf=m.valueOf))};function f(){}function h(p){for(var m=null,g=this;g.constructor.superclass;){var y=g.constructor.superclass.prototype[p];if(g[p]!==y){m=y;break}g=g.constructor.superclass.prototype}return m?arguments.length>1?m.apply(this,a.call(arguments,1)):m.call(this):console.log("tried to callSuper "+p+", method not found in prototype chain",this)}function d(){var p=null,m=a.call(arguments,0);typeof m[0]=="function"&&(p=m.shift());function g(){this.initialize.apply(this,arguments)}g.superclass=p,g.subclasses=[],p&&(f.prototype=p.prototype,g.prototype=new f,p.subclasses.push(g));for(var y=0,b=m.length;y<b;y++)c(g,m[y],p);return g.prototype.initialize||(g.prototype.initialize=u),g.prototype.constructor=g,g.prototype.callSuper=h,g}t.util.createClass=d}(),function(){var a=!!t.document.createElement("div").attachEvent,u=["touchstart","touchmove","touchend"];t.util.addListener=function(c,f,h,d){c&&c.addEventListener(f,h,a?!1:d)},t.util.removeListener=function(c,f,h,d){c&&c.removeEventListener(f,h,a?!1:d)};function l(c){var f=c.changedTouches;return f&&f[0]?f[0]:c}t.util.getPointer=function(c){var f=c.target,h=t.util.getScrollLeftTop(f),d=l(c);return{x:d.clientX+h.left,y:d.clientY+h.top}},t.util.isTouchEvent=function(c){return u.indexOf(c.type)>-1||c.pointerType==="touch"}}(),function(){function a(d,p){var m=d.style;if(!m)return d;if(typeof p=="string")return d.style.cssText+=";"+p,p.indexOf("opacity")>-1?h(d,p.match(/opacity:\s*(\d?\.?\d*)/)[1]):d;for(var g in p)if(g==="opacity")h(d,p[g]);else{var y=g==="float"||g==="cssFloat"?typeof m.styleFloat>"u"?"cssFloat":"styleFloat":g;m.setProperty(y,p[g])}return d}var u=t.document.createElement("div"),l=typeof u.style.opacity=="string",c=typeof u.style.filter=="string",f=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,h=function(d){return d};l?h=function(d,p){return d.style.opacity=p,d}:c&&(h=function(d,p){var m=d.style;return d.currentStyle&&!d.currentStyle.hasLayout&&(m.zoom=1),f.test(m.filter)?(p=p>=.9999?"":"alpha(opacity="+p*100+")",m.filter=m.filter.replace(f,p)):m.filter+=" alpha(opacity="+p*100+")",d}),t.util.setStyle=a}(),function(){var a=Array.prototype.slice;function u(v){return typeof v=="string"?t.document.getElementById(v):v}var l,c=function(v){return a.call(v,0)};try{l=c(t.document.childNodes)instanceof Array}catch{}l||(c=function(v){for(var w=new Array(v.length),C=v.length;C--;)w[C]=v[C];return w});function f(v,w){var C=t.document.createElement(v);for(var S in w)S==="class"?C.className=w[S]:S==="for"?C.htmlFor=w[S]:C.setAttribute(S,w[S]);return C}function h(v,w){v&&(" "+v.className+" ").indexOf(" "+w+" ")===-1&&(v.className+=(v.className?" ":"")+w)}function d(v,w,C){return typeof w=="string"&&(w=f(w,C)),v.parentNode&&v.parentNode.replaceChild(w,v),w.appendChild(v),w}function p(v){for(var w=0,C=0,S=t.document.documentElement,_=t.document.body||{scrollLeft:0,scrollTop:0};v&&(v.parentNode||v.host)&&(v=v.parentNode||v.host,v===t.document?(w=_.scrollLeft||S.scrollLeft||0,C=_.scrollTop||S.scrollTop||0):(w+=v.scrollLeft||0,C+=v.scrollTop||0),!(v.nodeType===1&&v.style.position==="fixed")););return{left:w,top:C}}function m(v){var w,C=v&&v.ownerDocument,S={left:0,top:0},_={left:0,top:0},$,k={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return _;for(var E in k)_[k[E]]+=parseInt(g(v,E),10)||0;return w=C.documentElement,typeof v.getBoundingClientRect<"u"&&(S=v.getBoundingClientRect()),$=p(v),{left:S.left+$.left-(w.clientLeft||0)+_.left,top:S.top+$.top-(w.clientTop||0)+_.top}}var g;t.document.defaultView&&t.document.defaultView.getComputedStyle?g=function(v,w){var C=t.document.defaultView.getComputedStyle(v,null);return C?C[w]:void 0}:g=function(v,w){var C=v.style[w];return!C&&v.currentStyle&&(C=v.currentStyle[w]),C},function(){var v=t.document.documentElement.style,w="userSelect"in v?"userSelect":"MozUserSelect"in v?"MozUserSelect":"WebkitUserSelect"in v?"WebkitUserSelect":"KhtmlUserSelect"in v?"KhtmlUserSelect":"";function C(_){return typeof _.onselectstart<"u"&&(_.onselectstart=t.util.falseFunction),w?_.style[w]="none":typeof _.unselectable=="string"&&(_.unselectable="on"),_}function S(_){return typeof _.onselectstart<"u"&&(_.onselectstart=null),w?_.style[w]="":typeof _.unselectable=="string"&&(_.unselectable=""),_}t.util.makeElementUnselectable=C,t.util.makeElementSelectable=S}();function y(v){var w=t.jsdomImplForWrapper(v);return w._canvas||w._image}function b(v){if(t.isLikelyNode){var w=t.jsdomImplForWrapper(v);w&&(w._image=null,w._canvas=null,w._currentSrc=null,w._attributes=null,w._classList=null)}}function x(v,w){v.imageSmoothingEnabled=v.imageSmoothingEnabled||v.webkitImageSmoothingEnabled||v.mozImageSmoothingEnabled||v.msImageSmoothingEnabled||v.oImageSmoothingEnabled,v.imageSmoothingEnabled=w}t.util.setImageSmoothing=x,t.util.getById=u,t.util.toArray=c,t.util.addClass=h,t.util.makeElement=f,t.util.wrapElement=d,t.util.getScrollLeftTop=p,t.util.getElementOffset=m,t.util.getNodeCanvas=y,t.util.cleanUpJsdomNode=b}(),function(){function a(c,f){return c+(/\?/.test(c)?"&":"?")+f}function u(){}function l(c,f){f||(f={});var h=f.method?f.method.toUpperCase():"GET",d=f.onComplete||function(){},p=new t.window.XMLHttpRequest,m=f.body||f.parameters;return p.onreadystatechange=function(){p.readyState===4&&(d(p),p.onreadystatechange=u)},h==="GET"&&(m=null,typeof f.parameters=="string"&&(c=a(c,f.parameters))),p.open(h,c,!0),(h==="POST"||h==="PUT")&&p.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),p.send(m),p}t.util.request=l}(),t.log=console.log,t.warn=console.warn,function(){var a=t.util.object.extend,u=t.util.object.clone,l=[];t.util.object.extend(l,{cancelAll:function(){var y=this.splice(0);return y.forEach(function(b){b.cancel()}),y},cancelByCanvas:function(y){if(!y)return[];var b=this.filter(function(x){return typeof x.target=="object"&&x.target.canvas===y});return b.forEach(function(x){x.cancel()}),b},cancelByTarget:function(y){var b=this.findAnimationsByTarget(y);return b.forEach(function(x){x.cancel()}),b},findAnimationIndex:function(y){return this.indexOf(this.findAnimation(y))},findAnimation:function(y){return this.find(function(b){return b.cancel===y})},findAnimationsByTarget:function(y){return y?this.filter(function(b){return b.target===y}):[]}});function c(){return!1}function f(y,b,x,v){return-x*Math.cos(y/v*(Math.PI/2))+x+b}function h(y){y||(y={});var b=!1,x,v=function(){var w=t.runningAnimations.indexOf(x);return w>-1&&t.runningAnimations.splice(w,1)[0]};return x=a(u(y),{cancel:function(){return b=!0,v()},currentValue:"startValue"in y?y.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(x),m(function(w){var C=w||+new Date,S=y.duration||500,_=C+S,$,k=y.onChange||c,E=y.abort||c,F=y.onComplete||c,T=y.easing||f,I="startValue"in y?y.startValue.length>0:!1,D="startValue"in y?y.startValue:0,N="endValue"in y?y.endValue:100,V=y.byValue||(I?D.map(function(U,A){return N[A]-D[A]}):N-D);y.onStart&&y.onStart(),function U(A){$=A||+new Date;var M=$>_?S:$-C,P=M/S,j=I?D.map(function(B,O){return T(M,D[O],V[O],S)}):T(M,D,V,S),q=Math.abs(I?(j[0]-D[0])/V[0]:(j-D)/V);if(x.currentValue=I?j.slice():j,x.completionRate=q,x.durationRate=P,!b){if(E(j,q,P)){v();return}if($>_){x.currentValue=I?N.slice():N,x.completionRate=1,x.durationRate=1,k(I?N.slice():N,1,1),F(N,1,1),v();return}else k(j,q,P),m(U)}}(C)}),x.cancel}var d=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(y){return t.window.setTimeout(y,1e3/60)},p=t.window.cancelAnimationFrame||t.window.clearTimeout;function m(){return d.apply(t.window,arguments)}function g(){return p.apply(t.window,arguments)}t.util.animate=h,t.util.requestAnimFrame=m,t.util.cancelAnimFrame=g,t.runningAnimations=l}(),function(){function a(l,c,f){var h="rgba("+parseInt(l[0]+f*(c[0]-l[0]),10)+","+parseInt(l[1]+f*(c[1]-l[1]),10)+","+parseInt(l[2]+f*(c[2]-l[2]),10);return h+=","+(l&&c?parseFloat(l[3]+f*(c[3]-l[3])):1),h+=")",h}function u(l,c,f,h){var d=new t.Color(l).getSource(),p=new t.Color(c).getSource(),m=h.onComplete,g=h.onChange;return h=h||{},t.util.animate(t.util.object.extend(h,{duration:f||500,startValue:d,endValue:p,byValue:p,easing:function(y,b,x,v){var w=h.colorEasing?h.colorEasing(y,v):1-Math.cos(y/v*(Math.PI/2));return a(b,x,w)},onComplete:function(y,b,x){if(m)return m(a(p,p,0),b,x)},onChange:function(y,b,x){if(g){if(Array.isArray(y))return g(a(y,y,0),b,x);g(y,b,x)}}}))}t.util.animateColor=u}(),function(){function a(A,M,P,j){return A<Math.abs(M)?(A=M,j=P/4):M===0&&A===0?j=P/(2*Math.PI)*Math.asin(1):j=P/(2*Math.PI)*Math.asin(M/A),{a:A,c:M,p:P,s:j}}function u(A,M,P){return A.a*Math.pow(2,10*(M-=1))*Math.sin((M*P-A.s)*(2*Math.PI)/A.p)}function l(A,M,P,j){return P*((A=A/j-1)*A*A+1)+M}function c(A,M,P,j){return A/=j/2,A<1?P/2*A*A*A+M:P/2*((A-=2)*A*A+2)+M}function f(A,M,P,j){return P*(A/=j)*A*A*A+M}function h(A,M,P,j){return-P*((A=A/j-1)*A*A*A-1)+M}function d(A,M,P,j){return A/=j/2,A<1?P/2*A*A*A*A+M:-P/2*((A-=2)*A*A*A-2)+M}function p(A,M,P,j){return P*(A/=j)*A*A*A*A+M}function m(A,M,P,j){return P*((A=A/j-1)*A*A*A*A+1)+M}function g(A,M,P,j){return A/=j/2,A<1?P/2*A*A*A*A*A+M:P/2*((A-=2)*A*A*A*A+2)+M}function y(A,M,P,j){return-P*Math.cos(A/j*(Math.PI/2))+P+M}function b(A,M,P,j){return P*Math.sin(A/j*(Math.PI/2))+M}function x(A,M,P,j){return-P/2*(Math.cos(Math.PI*A/j)-1)+M}function v(A,M,P,j){return A===0?M:P*Math.pow(2,10*(A/j-1))+M}function w(A,M,P,j){return A===j?M+P:P*(-Math.pow(2,-10*A/j)+1)+M}function C(A,M,P,j){return A===0?M:A===j?M+P:(A/=j/2,A<1?P/2*Math.pow(2,10*(A-1))+M:P/2*(-Math.pow(2,-10*--A)+2)+M)}function S(A,M,P,j){return-P*(Math.sqrt(1-(A/=j)*A)-1)+M}function _(A,M,P,j){return P*Math.sqrt(1-(A=A/j-1)*A)+M}function $(A,M,P,j){return A/=j/2,A<1?-P/2*(Math.sqrt(1-A*A)-1)+M:P/2*(Math.sqrt(1-(A-=2)*A)+1)+M}function k(A,M,P,j){var q=1.70158,B=0,O=P;if(A===0)return M;if(A/=j,A===1)return M+P;B||(B=j*.3);var G=a(O,P,B,q);return-u(G,A,j)+M}function E(A,M,P,j){var q=1.70158,B=0,O=P;if(A===0)return M;if(A/=j,A===1)return M+P;B||(B=j*.3);var G=a(O,P,B,q);return G.a*Math.pow(2,-10*A)*Math.sin((A*j-G.s)*(2*Math.PI)/G.p)+G.c+M}function F(A,M,P,j){var q=1.70158,B=0,O=P;if(A===0)return M;if(A/=j/2,A===2)return M+P;B||(B=j*(.3*1.5));var G=a(O,P,B,q);return A<1?-.5*u(G,A,j)+M:G.a*Math.pow(2,-10*(A-=1))*Math.sin((A*j-G.s)*(2*Math.PI)/G.p)*.5+G.c+M}function T(A,M,P,j,q){return q===void 0&&(q=1.70158),P*(A/=j)*A*((q+1)*A-q)+M}function I(A,M,P,j,q){return q===void 0&&(q=1.70158),P*((A=A/j-1)*A*((q+1)*A+q)+1)+M}function D(A,M,P,j,q){return q===void 0&&(q=1.70158),A/=j/2,A<1?P/2*(A*A*(((q*=1.525)+1)*A-q))+M:P/2*((A-=2)*A*(((q*=1.525)+1)*A+q)+2)+M}function N(A,M,P,j){return P-V(j-A,0,P,j)+M}function V(A,M,P,j){return(A/=j)<1/2.75?P*(7.5625*A*A)+M:A<2/2.75?P*(7.5625*(A-=1.5/2.75)*A+.75)+M:A<2.5/2.75?P*(7.5625*(A-=2.25/2.75)*A+.9375)+M:P*(7.5625*(A-=2.625/2.75)*A+.984375)+M}function U(A,M,P,j){return A<j/2?N(A*2,0,P,j)*.5+M:V(A*2-j,0,P,j)*.5+P*.5+M}t.util.ease={easeInQuad:function(A,M,P,j){return P*(A/=j)*A+M},easeOutQuad:function(A,M,P,j){return-P*(A/=j)*(A-2)+M},easeInOutQuad:function(A,M,P,j){return A/=j/2,A<1?P/2*A*A+M:-P/2*(--A*(A-2)-1)+M},easeInCubic:function(A,M,P,j){return P*(A/=j)*A*A+M},easeOutCubic:l,easeInOutCubic:c,easeInQuart:f,easeOutQuart:h,easeInOutQuart:d,easeInQuint:p,easeOutQuint:m,easeInOutQuint:g,easeInSine:y,easeOutSine:b,easeInOutSine:x,easeInExpo:v,easeOutExpo:w,easeInOutExpo:C,easeInCirc:S,easeOutCirc:_,easeInOutCirc:$,easeInElastic:k,easeOutElastic:E,easeInOutElastic:F,easeInBack:T,easeOutBack:I,easeInOutBack:D,easeInBounce:N,easeOutBounce:V,easeInOutBounce:U}}(),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.extend,c=u.util.object.clone,f=u.util.toFixed,h=u.util.parseUnit,d=u.util.multiplyTransformMatrices,p=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],m=["symbol","image","marker","pattern","view","svg"],g=["pattern","defs","symbol","metadata","clipPath","mask","desc"],y=["symbol","g","a","svg","clipPath","defs"],b={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},x={stroke:"strokeOpacity",fill:"fillOpacity"},v="font-size",w="clip-path";u.svgValidTagNamesRegEx=_(p),u.svgViewBoxElementsRegEx=_(m),u.svgInvalidAncestorsRegEx=_(g),u.svgValidParentsRegEx=_(y),u.cssRules={},u.gradientDefs={},u.clipPaths={};function C(B){return B in b?b[B]:B}function S(B,O,G,Z){var re=Array.isArray(O),R;if((B==="fill"||B==="stroke")&&O==="none")O="";else{if(B==="strokeUniform")return O==="non-scaling-stroke";if(B==="strokeDashArray")O==="none"?O=null:O=O.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(B==="transformMatrix")G&&G.transformMatrix?O=d(G.transformMatrix,u.parseTransformAttribute(O)):O=u.parseTransformAttribute(O);else if(B==="visible")O=O!=="none"&&O!=="hidden",G&&G.visible===!1&&(O=!1);else if(B==="opacity")O=parseFloat(O),G&&typeof G.opacity<"u"&&(O*=G.opacity);else if(B==="textAnchor")O=O==="start"?"left":O==="end"?"right":"center";else if(B==="charSpacing")R=h(O,Z)/Z*1e3;else if(B==="paintFirst"){var H=O.indexOf("fill"),Y=O.indexOf("stroke"),O="fill";(H>-1&&Y>-1&&Y<H||H===-1&&Y>-1)&&(O="stroke")}else{if(B==="href"||B==="xlink:href"||B==="font")return O;if(B==="imageSmoothing")return O==="optimizeQuality";R=re?O.map(h):h(O,Z)}}return!re&&isNaN(R)?O:R}function _(B){return new RegExp("^("+B.join("|")+")\\b","i")}function $(B){for(var O in x)if(!(typeof B[x[O]]>"u"||B[O]==="")){if(typeof B[O]>"u"){if(!u.Object.prototype[O])continue;B[O]=u.Object.prototype[O]}if(B[O].indexOf("url(")!==0){var G=new u.Color(B[O]);B[O]=G.setAlpha(f(G.getAlpha()*B[x[O]],2)).toRgba()}}return B}function k(B,O){var G,Z=[],re,R,H;for(R=0,H=O.length;R<H;R++)G=O[R],re=B.getElementsByTagName(G),Z=Z.concat(Array.prototype.slice.call(re));return Z}u.parseTransformAttribute=function(){function B(de,Re){var qe=u.util.cos(Re[0]),ot=u.util.sin(Re[0]),Ft=0,xt=0;Re.length===3&&(Ft=Re[1],xt=Re[2]),de[0]=qe,de[1]=ot,de[2]=-ot,de[3]=qe,de[4]=Ft-(qe*Ft-ot*xt),de[5]=xt-(ot*Ft+qe*xt)}function O(de,Re){var qe=Re[0],ot=Re.length===2?Re[1]:Re[0];de[0]=qe,de[3]=ot}function G(de,Re,qe){de[qe]=Math.tan(u.util.degreesToRadians(Re[0]))}function Z(de,Re){de[4]=Re[0],Re.length===2&&(de[5]=Re[1])}var re=u.iMatrix,R=u.reNum,H=u.commaWsp,Y="(?:(skewX)\\s*\\(\\s*("+R+")\\s*\\))",L="(?:(skewY)\\s*\\(\\s*("+R+")\\s*\\))",te="(?:(rotate)\\s*\\(\\s*("+R+")(?:"+H+"("+R+")"+H+"("+R+"))?\\s*\\))",X="(?:(scale)\\s*\\(\\s*("+R+")(?:"+H+"("+R+"))?\\s*\\))",ie="(?:(translate)\\s*\\(\\s*("+R+")(?:"+H+"("+R+"))?\\s*\\))",se="(?:(matrix)\\s*\\(\\s*("+R+")"+H+"("+R+")"+H+"("+R+")"+H+"("+R+")"+H+"("+R+")"+H+"("+R+")\\s*\\))",oe="(?:"+se+"|"+ie+"|"+X+"|"+te+"|"+Y+"|"+L+")",le="(?:"+oe+"(?:"+H+"*"+oe+")*)",Ce="^\\s*(?:"+le+"?)\\s*$",Me=new RegExp(Ce),Fe=new RegExp(oe,"g");return function(de){var Re=re.concat(),qe=[];if(!de||de&&!Me.test(de))return Re;de.replace(Fe,function(Ft){var xt=new RegExp(oe).exec(Ft).filter(function(Yo){return!!Yo}),Cn=xt[1],ln=xt.slice(2).map(parseFloat);switch(Cn){case"translate":Z(Re,ln);break;case"rotate":ln[0]=u.util.degreesToRadians(ln[0]),B(Re,ln);break;case"scale":O(Re,ln);break;case"skewX":G(Re,ln,2);break;case"skewY":G(Re,ln,1);break;case"matrix":Re=ln;break}qe.push(Re.concat()),Re=re.concat()});for(var ot=qe[0];qe.length>1;)qe.shift(),ot=u.util.multiplyTransformMatrices(ot,qe[0]);return ot}}();function E(B,O){var G,Z;B.replace(/;\s*$/,"").split(";").forEach(function(re){var R=re.split(":");G=R[0].trim().toLowerCase(),Z=R[1].trim(),O[G]=Z})}function F(B,O){var G,Z;for(var re in B)typeof B[re]>"u"||(G=re.toLowerCase(),Z=B[re],O[G]=Z)}function T(B,O){var G={};for(var Z in u.cssRules[O])if(I(B,Z.split(" ")))for(var re in u.cssRules[O][Z])G[re]=u.cssRules[O][Z][re];return G}function I(B,O){var G,Z=!0;return G=N(B,O.pop()),G&&O.length&&(Z=D(B,O)),G&&Z&&O.length===0}function D(B,O){for(var G,Z=!0;B.parentNode&&B.parentNode.nodeType===1&&O.length;)Z&&(G=O.pop()),B=B.parentNode,Z=N(B,G);return O.length===0}function N(B,O){var G=B.nodeName,Z=B.getAttribute("class"),re=B.getAttribute("id"),R,H;if(R=new RegExp("^"+G,"i"),O=O.replace(R,""),re&&O.length&&(R=new RegExp("#"+re+"(?![a-zA-Z\\-]+)","i"),O=O.replace(R,"")),Z&&O.length)for(Z=Z.split(" "),H=Z.length;H--;)R=new RegExp("\\."+Z[H]+"(?![a-zA-Z\\-]+)","i"),O=O.replace(R,"");return O.length===0}function V(B,O){var G;if(B.getElementById&&(G=B.getElementById(O)),G)return G;var Z,re,R,H=B.getElementsByTagName("*");for(re=0,R=H.length;re<R;re++)if(Z=H[re],O===Z.getAttribute("id"))return Z}function U(B){for(var O=k(B,["use","svg:use"]),G=0;O.length&&G<O.length;){var Z=O[G],re=Z.getAttribute("xlink:href")||Z.getAttribute("href");if(re===null)return;var R=re.slice(1),H=Z.getAttribute("x")||0,Y=Z.getAttribute("y")||0,L=V(B,R).cloneNode(!0),te=(L.getAttribute("transform")||"")+" translate("+H+", "+Y+")",X,ie=O.length,se,oe,le,Ce,Me=u.svgNS;if(M(L),/^svg$/i.test(L.nodeName)){var Fe=L.ownerDocument.createElementNS(Me,"g");for(oe=0,le=L.attributes,Ce=le.length;oe<Ce;oe++)se=le.item(oe),Fe.setAttributeNS(Me,se.nodeName,se.nodeValue);for(;L.firstChild;)Fe.appendChild(L.firstChild);L=Fe}for(oe=0,le=Z.attributes,Ce=le.length;oe<Ce;oe++)se=le.item(oe),!(se.nodeName==="x"||se.nodeName==="y"||se.nodeName==="xlink:href"||se.nodeName==="href")&&(se.nodeName==="transform"?te=se.nodeValue+" "+te:L.setAttribute(se.nodeName,se.nodeValue));L.setAttribute("transform",te),L.setAttribute("instantiated_by_use","1"),L.removeAttribute("id"),X=Z.parentNode,X.replaceChild(L,Z),O.length===ie&&G++}}var A=new RegExp("^\\s*("+u.reNum+"+)\\s*,?\\s*("+u.reNum+"+)\\s*,?\\s*("+u.reNum+"+)\\s*,?\\s*("+u.reNum+"+)\\s*$");function M(B){if(!u.svgViewBoxElementsRegEx.test(B.nodeName))return{};var O=B.getAttribute("viewBox"),G=1,Z=1,re=0,R=0,H,Y,L,te,X=B.getAttribute("width"),ie=B.getAttribute("height"),se=B.getAttribute("x")||0,oe=B.getAttribute("y")||0,le=B.getAttribute("preserveAspectRatio")||"",Ce=!O||!(O=O.match(A)),Me=!X||!ie||X==="100%"||ie==="100%",Fe=Ce&&Me,de={},Re="",qe=0,ot=0;if(de.width=0,de.height=0,de.toBeParsed=Fe,Ce&&(se||oe)&&B.parentNode&&B.parentNode.nodeName!=="#document"&&(Re=" translate("+h(se)+" "+h(oe)+") ",L=(B.getAttribute("transform")||"")+Re,B.setAttribute("transform",L),B.removeAttribute("x"),B.removeAttribute("y")),Fe)return de;if(Ce)return de.width=h(X),de.height=h(ie),de;if(re=-parseFloat(O[1]),R=-parseFloat(O[2]),H=parseFloat(O[3]),Y=parseFloat(O[4]),de.minX=re,de.minY=R,de.viewBoxWidth=H,de.viewBoxHeight=Y,Me?(de.width=H,de.height=Y):(de.width=h(X),de.height=h(ie),G=de.width/H,Z=de.height/Y),le=u.util.parsePreserveAspectRatioAttribute(le),le.alignX!=="none"&&(le.meetOrSlice==="meet"&&(Z=G=G>Z?Z:G),le.meetOrSlice==="slice"&&(Z=G=G>Z?G:Z),qe=de.width-H*G,ot=de.height-Y*G,le.alignX==="Mid"&&(qe/=2),le.alignY==="Mid"&&(ot/=2),le.alignX==="Min"&&(qe=0),le.alignY==="Min"&&(ot=0)),G===1&&Z===1&&re===0&&R===0&&se===0&&oe===0)return de;if((se||oe)&&B.parentNode.nodeName!=="#document"&&(Re=" translate("+h(se)+" "+h(oe)+") "),L=Re+" matrix("+G+" 0 0 "+Z+" "+(re*G+qe)+" "+(R*Z+ot)+") ",B.nodeName==="svg"){for(te=B.ownerDocument.createElementNS(u.svgNS,"g");B.firstChild;)te.appendChild(B.firstChild);B.appendChild(te)}else te=B,te.removeAttribute("x"),te.removeAttribute("y"),L=te.getAttribute("transform")+L;return te.setAttribute("transform",L),de}function P(B,O){for(;B&&(B=B.parentNode);)if(B.nodeName&&O.test(B.nodeName.replace("svg:",""))&&!B.getAttribute("instantiated_by_use"))return!0;return!1}u.parseSVGDocument=function(B,O,G,Z){if(B){U(B);var re=u.Object.__uid++,R,H,Y=M(B),L=u.util.toArray(B.getElementsByTagName("*"));if(Y.crossOrigin=Z&&Z.crossOrigin,Y.svgUid=re,L.length===0&&u.isLikelyNode){L=B.selectNodes('//*[name(.)!="svg"]');var te=[];for(R=0,H=L.length;R<H;R++)te[R]=L[R];L=te}var X=L.filter(function(se){return M(se),u.svgValidTagNamesRegEx.test(se.nodeName.replace("svg:",""))&&!P(se,u.svgInvalidAncestorsRegEx)});if(!X||X&&!X.length){O&&O([],{});return}var ie={};L.filter(function(se){return se.nodeName.replace("svg:","")==="clipPath"}).forEach(function(se){var oe=se.getAttribute("id");ie[oe]=u.util.toArray(se.getElementsByTagName("*")).filter(function(le){return u.svgValidTagNamesRegEx.test(le.nodeName.replace("svg:",""))})}),u.gradientDefs[re]=u.getGradientDefs(B),u.cssRules[re]=u.getCSSRules(B),u.clipPaths[re]=ie,u.parseElements(X,function(se,oe){O&&(O(se,Y,oe,L),delete u.gradientDefs[re],delete u.cssRules[re],delete u.clipPaths[re])},c(Y),G,Z)}};function j(B,O){var G=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],Z="xlink:href",re=O.getAttribute(Z).slice(1),R=V(B,re);if(R&&R.getAttribute(Z)&&j(B,R),G.forEach(function(Y){R&&!O.hasAttribute(Y)&&R.hasAttribute(Y)&&O.setAttribute(Y,R.getAttribute(Y))}),!O.children.length)for(var H=R.cloneNode(!0);H.firstChild;)O.appendChild(H.firstChild);O.removeAttribute(Z)}var q=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+u.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+u.reNum+"))?\\s+(.*)");l(u,{parseFontDeclaration:function(B,O){var G=B.match(q);if(G){var Z=G[1],re=G[3],R=G[4],H=G[5],Y=G[6];Z&&(O.fontStyle=Z),re&&(O.fontWeight=isNaN(parseFloat(re))?re:parseFloat(re)),R&&(O.fontSize=h(R)),Y&&(O.fontFamily=Y),H&&(O.lineHeight=H==="normal"?1:H)}},getGradientDefs:function(B){var O=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],G=k(B,O),Z,re=0,R={};for(re=G.length;re--;)Z=G[re],Z.getAttribute("xlink:href")&&j(B,Z),R[Z.getAttribute("id")]=Z;return R},parseAttributes:function(B,O,G){if(B){var Z,re={},R,H;typeof G>"u"&&(G=B.getAttribute("svgUid")),B.parentNode&&u.svgValidParentsRegEx.test(B.parentNode.nodeName)&&(re=u.parseAttributes(B.parentNode,O,G));var Y=O.reduce(function(le,Ce){return Z=B.getAttribute(Ce),Z&&(le[Ce]=Z),le},{}),L=l(T(B,G),u.parseStyleAttribute(B));Y=l(Y,L),L[w]&&B.setAttribute(w,L[w]),R=H=re.fontSize||u.Text.DEFAULT_SVG_FONT_SIZE,Y[v]&&(Y[v]=R=h(Y[v],H));var te,X,ie={};for(var se in Y)te=C(se),X=S(te,Y[se],re,R),ie[te]=X;ie&&ie.font&&u.parseFontDeclaration(ie.font,ie);var oe=l(re,ie);return u.svgValidParentsRegEx.test(B.nodeName)?oe:$(oe)}},parseElements:function(B,O,G,Z,re){new u.ElementsParser(B,O,G,Z,re).parse()},parseStyleAttribute:function(B){var O={},G=B.getAttribute("style");return G&&(typeof G=="string"?E(G,O):F(G,O)),O},parsePointsAttribute:function(B){if(!B)return null;B=B.replace(/,/g," ").trim(),B=B.split(/\s+/);var O=[],G,Z;for(G=0,Z=B.length;G<Z;G+=2)O.push({x:parseFloat(B[G]),y:parseFloat(B[G+1])});return O},getCSSRules:function(B){var O=B.getElementsByTagName("style"),G,Z,re={},R;for(G=0,Z=O.length;G<Z;G++){var H=O[G].textContent;H=H.replace(/\/\*[\s\S]*?\*\//g,""),H.trim()!==""&&(R=H.split("}"),R=R.filter(function(Y){return Y.trim()}),R.forEach(function(Y){var L=Y.split("{"),te={},X=L[1].trim(),ie=X.split(";").filter(function(Ce){return Ce.trim()});for(G=0,Z=ie.length;G<Z;G++){var se=ie[G].split(":"),oe=se[0].trim(),le=se[1].trim();te[oe]=le}Y=L[0].trim(),Y.split(",").forEach(function(Ce){Ce=Ce.replace(/^svg/i,"").trim(),Ce!==""&&(re[Ce]?u.util.object.extend(re[Ce],te):re[Ce]=u.util.object.clone(te))})}))}return re},loadSVGFromURL:function(B,O,G,Z){B=B.replace(/^\n\s*/,"").trim(),new u.util.request(B,{method:"get",onComplete:re});function re(R){var H=R.responseXML;if(!H||!H.documentElement)return O&&O(null),!1;u.parseSVGDocument(H.documentElement,function(Y,L,te,X){O&&O(Y,L,te,X)},G,Z)}},loadSVGFromString:function(B,O,G,Z){var re=new u.window.DOMParser,R=re.parseFromString(B.trim(),"text/xml");u.parseSVGDocument(R.documentElement,function(H,Y,L,te){O(H,Y,L,te)},G,Z)}})}(e),t.ElementsParser=function(a,u,l,c,f,h){this.elements=a,this.callback=u,this.options=l,this.reviver=c,this.svgUid=l&&l.svgUid||0,this.parsingOptions=f,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=h},function(a){a.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},a.createObjects=function(){var u=this;this.elements.forEach(function(l,c){l.setAttribute("svgUid",u.svgUid),u.createObject(l,c)})},a.findTag=function(u){return t[t.util.string.capitalize(u.tagName.replace("svg:",""))]},a.createObject=function(u,l){var c=this.findTag(u);if(c&&c.fromElement)try{c.fromElement(u,this.createCallback(l,u),this.options)}catch(f){t.log(f)}else this.checkIfDone()},a.createCallback=function(u,l){var c=this;return function(f){var h;c.resolveGradient(f,l,"fill"),c.resolveGradient(f,l,"stroke"),f instanceof t.Image&&f._originalElement&&(h=f.parsePreserveAspectRatioAttribute(l)),f._removeTransformMatrix(h),c.resolveClipPath(f,l),c.reviver&&c.reviver(l,f),c.instances[u]=f,c.checkIfDone()}},a.extractPropertyDefinition=function(u,l,c){var f=u[l],h=this.regexUrl;if(h.test(f)){h.lastIndex=0;var d=h.exec(f)[1];return h.lastIndex=0,t[c][this.svgUid][d]}},a.resolveGradient=function(u,l,c){var f=this.extractPropertyDefinition(u,c,"gradientDefs");if(f){var h=l.getAttribute(c+"-opacity"),d=t.Gradient.fromElement(f,u,h,this.options);u.set(c,d)}},a.createClipPathCallback=function(u,l){return function(c){c._removeTransformMatrix(),c.fillRule=c.clipRule,l.push(c)}},a.resolveClipPath=function(u,l){var c=this.extractPropertyDefinition(u,"clipPath","clipPaths"),f,h,d,p,m,g;if(c){p=[],d=t.util.invertTransform(u.calcTransformMatrix());for(var y=c[0].parentNode,b=l;b.parentNode&&b.getAttribute("clip-path")!==u.clipPath;)b=b.parentNode;b.parentNode.appendChild(y);for(var x=0;x<c.length;x++)f=c[x],h=this.findTag(f),h.fromElement(f,this.createClipPathCallback(u,p),this.options);p.length===1?c=p[0]:c=new t.Group(p),m=t.util.multiplyTransformMatrices(d,c.calcTransformMatrix()),c.clipPath&&this.resolveClipPath(c,b);var g=t.util.qrDecompose(m);c.flipX=!1,c.flipY=!1,c.set("scaleX",g.scaleX),c.set("scaleY",g.scaleY),c.angle=g.angle,c.skewX=g.skewX,c.skewY=0,c.setPositionByOrigin({x:g.translateX,y:g.translateY},"center","center"),u.clipPath=c}else delete u.clipPath},a.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(u){return u!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(a){var u=a.fabric||(a.fabric={});if(u.Point){u.warn("fabric.Point is already defined");return}u.Point=l;function l(c,f){this.x=c,this.y=f}l.prototype={type:"point",constructor:l,add:function(c){return new l(this.x+c.x,this.y+c.y)},addEquals:function(c){return this.x+=c.x,this.y+=c.y,this},scalarAdd:function(c){return new l(this.x+c,this.y+c)},scalarAddEquals:function(c){return this.x+=c,this.y+=c,this},subtract:function(c){return new l(this.x-c.x,this.y-c.y)},subtractEquals:function(c){return this.x-=c.x,this.y-=c.y,this},scalarSubtract:function(c){return new l(this.x-c,this.y-c)},scalarSubtractEquals:function(c){return this.x-=c,this.y-=c,this},multiply:function(c){return new l(this.x*c,this.y*c)},multiplyEquals:function(c){return this.x*=c,this.y*=c,this},divide:function(c){return new l(this.x/c,this.y/c)},divideEquals:function(c){return this.x/=c,this.y/=c,this},eq:function(c){return this.x===c.x&&this.y===c.y},lt:function(c){return this.x<c.x&&this.y<c.y},lte:function(c){return this.x<=c.x&&this.y<=c.y},gt:function(c){return this.x>c.x&&this.y>c.y},gte:function(c){return this.x>=c.x&&this.y>=c.y},lerp:function(c,f){return typeof f>"u"&&(f=.5),f=Math.max(Math.min(1,f),0),new l(this.x+(c.x-this.x)*f,this.y+(c.y-this.y)*f)},distanceFrom:function(c){var f=this.x-c.x,h=this.y-c.y;return Math.sqrt(f*f+h*h)},midPointFrom:function(c){return this.lerp(c)},min:function(c){return new l(Math.min(this.x,c.x),Math.min(this.y,c.y))},max:function(c){return new l(Math.max(this.x,c.x),Math.max(this.y,c.y))},toString:function(){return this.x+","+this.y},setXY:function(c,f){return this.x=c,this.y=f,this},setX:function(c){return this.x=c,this},setY:function(c){return this.y=c,this},setFromPoint:function(c){return this.x=c.x,this.y=c.y,this},swap:function(c){var f=this.x,h=this.y;this.x=c.x,this.y=c.y,c.x=f,c.y=h},clone:function(){return new l(this.x,this.y)}}}(e),function(a){var u=a.fabric||(a.fabric={});if(u.Intersection){u.warn("fabric.Intersection is already defined");return}function l(c){this.status=c,this.points=[]}u.Intersection=l,u.Intersection.prototype={constructor:l,appendPoint:function(c){return this.points.push(c),this},appendPoints:function(c){return this.points=this.points.concat(c),this}},u.Intersection.intersectLineLine=function(c,f,h,d){var p,m=(d.x-h.x)*(c.y-h.y)-(d.y-h.y)*(c.x-h.x),g=(f.x-c.x)*(c.y-h.y)-(f.y-c.y)*(c.x-h.x),y=(d.y-h.y)*(f.x-c.x)-(d.x-h.x)*(f.y-c.y);if(y!==0){var b=m/y,x=g/y;0<=b&&b<=1&&0<=x&&x<=1?(p=new l("Intersection"),p.appendPoint(new u.Point(c.x+b*(f.x-c.x),c.y+b*(f.y-c.y)))):p=new l}else m===0||g===0?p=new l("Coincident"):p=new l("Parallel");return p},u.Intersection.intersectLinePolygon=function(c,f,h){var d=new l,p=h.length,m,g,y,b;for(b=0;b<p;b++)m=h[b],g=h[(b+1)%p],y=l.intersectLineLine(c,f,m,g),d.appendPoints(y.points);return d.points.length>0&&(d.status="Intersection"),d},u.Intersection.intersectPolygonPolygon=function(c,f){var h=new l,d=c.length,p;for(p=0;p<d;p++){var m=c[p],g=c[(p+1)%d],y=l.intersectLinePolygon(m,g,f);h.appendPoints(y.points)}return h.points.length>0&&(h.status="Intersection"),h},u.Intersection.intersectPolygonRectangle=function(c,f,h){var d=f.min(h),p=f.max(h),m=new u.Point(p.x,d.y),g=new u.Point(d.x,p.y),y=l.intersectLinePolygon(d,m,c),b=l.intersectLinePolygon(m,p,c),x=l.intersectLinePolygon(p,g,c),v=l.intersectLinePolygon(g,d,c),w=new l;return w.appendPoints(y.points),w.appendPoints(b.points),w.appendPoints(x.points),w.appendPoints(v.points),w.points.length>0&&(w.status="Intersection"),w}}(e),function(a){var u=a.fabric||(a.fabric={});if(u.Color){u.warn("fabric.Color is already defined.");return}function l(f){f?this._tryParsingColor(f):this.setSource([0,0,0,1])}u.Color=l,u.Color.prototype={_tryParsingColor:function(f){var h;f in l.colorNameMap&&(f=l.colorNameMap[f]),f==="transparent"&&(h=[255,255,255,0]),h||(h=l.sourceFromHex(f)),h||(h=l.sourceFromRgb(f)),h||(h=l.sourceFromHsl(f)),h||(h=[0,0,0,1]),h&&this.setSource(h)},_rgbToHsl:function(f,h,d){f/=255,h/=255,d/=255;var p,m,g,y=u.util.array.max([f,h,d]),b=u.util.array.min([f,h,d]);if(g=(y+b)/2,y===b)p=m=0;else{var x=y-b;switch(m=g>.5?x/(2-y-b):x/(y+b),y){case f:p=(h-d)/x+(h<d?6:0);break;case h:p=(d-f)/x+2;break;case d:p=(f-h)/x+4;break}p/=6}return[Math.round(p*360),Math.round(m*100),Math.round(g*100)]},getSource:function(){return this._source},setSource:function(f){this._source=f},toRgb:function(){var f=this.getSource();return"rgb("+f[0]+","+f[1]+","+f[2]+")"},toRgba:function(){var f=this.getSource();return"rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+")"},toHsl:function(){var f=this.getSource(),h=this._rgbToHsl(f[0],f[1],f[2]);return"hsl("+h[0]+","+h[1]+"%,"+h[2]+"%)"},toHsla:function(){var f=this.getSource(),h=this._rgbToHsl(f[0],f[1],f[2]);return"hsla("+h[0]+","+h[1]+"%,"+h[2]+"%,"+f[3]+")"},toHex:function(){var f=this.getSource(),h,d,p;return h=f[0].toString(16),h=h.length===1?"0"+h:h,d=f[1].toString(16),d=d.length===1?"0"+d:d,p=f[2].toString(16),p=p.length===1?"0"+p:p,h.toUpperCase()+d.toUpperCase()+p.toUpperCase()},toHexa:function(){var f=this.getSource(),h;return h=Math.round(f[3]*255),h=h.toString(16),h=h.length===1?"0"+h:h,this.toHex()+h.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var h=this.getSource();return h[3]=f,this.setSource(h),this},toGrayscale:function(){var f=this.getSource(),h=parseInt((f[0]*.3+f[1]*.59+f[2]*.11).toFixed(0),10),d=f[3];return this.setSource([h,h,h,d]),this},toBlackWhite:function(f){var h=this.getSource(),d=(h[0]*.3+h[1]*.59+h[2]*.11).toFixed(0),p=h[3];return f=f||127,d=Number(d)<Number(f)?0:255,this.setSource([d,d,d,p]),this},overlayWith:function(f){f instanceof l||(f=new l(f));var h=[],d=this.getAlpha(),p=.5,m=this.getSource(),g=f.getSource(),y;for(y=0;y<3;y++)h.push(Math.round(m[y]*(1-p)+g[y]*p));return h[3]=d,this.setSource(h),this}},u.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,u.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,u.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,u.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function c(f,h,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?f+(h-f)*6*d:d<1/2?h:d<2/3?f+(h-f)*(2/3-d)*6:f}u.Color.fromRgb=function(f){return l.fromSource(l.sourceFromRgb(f))},u.Color.sourceFromRgb=function(f){var h=f.match(l.reRGBa);if(h){var d=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),p=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),m=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(d,10),parseInt(p,10),parseInt(m,10),h[4]?parseFloat(h[4]):1]}},u.Color.fromRgba=l.fromRgb,u.Color.fromHsl=function(f){return l.fromSource(l.sourceFromHsl(f))},u.Color.sourceFromHsl=function(f){var h=f.match(l.reHSLa);if(h){var d=(parseFloat(h[1])%360+360)%360/360,p=parseFloat(h[2])/(/%$/.test(h[2])?100:1),m=parseFloat(h[3])/(/%$/.test(h[3])?100:1),g,y,b;if(p===0)g=y=b=m;else{var x=m<=.5?m*(p+1):m+p-m*p,v=m*2-x;g=c(v,x,d+1/3),y=c(v,x,d),b=c(v,x,d-1/3)}return[Math.round(g*255),Math.round(y*255),Math.round(b*255),h[4]?parseFloat(h[4]):1]}},u.Color.fromHsla=l.fromHsl,u.Color.fromHex=function(f){return l.fromSource(l.sourceFromHex(f))},u.Color.sourceFromHex=function(f){if(f.match(l.reHex)){var h=f.slice(f.indexOf("#")+1),d=h.length===3||h.length===4,p=h.length===8||h.length===4,m=d?h.charAt(0)+h.charAt(0):h.substring(0,2),g=d?h.charAt(1)+h.charAt(1):h.substring(2,4),y=d?h.charAt(2)+h.charAt(2):h.substring(4,6),b=p?d?h.charAt(3)+h.charAt(3):h.substring(6,8):"FF";return[parseInt(m,16),parseInt(g,16),parseInt(y,16),parseFloat((parseInt(b,16)/255).toFixed(2))]}},u.Color.fromSource=function(f){var h=new l;return h.setSource(f),h}}(e),function(a){var u=a.fabric||(a.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],c=["ns","nesw","ew","nwse"],f={},h="left",d="top",p="right",m="bottom",g="center",y={top:m,bottom:d,left:p,right:h,center:g},b=u.util.radiansToDegrees,x=Math.sign||function(te){return(te>0)-(te<0)||+te};function v(te,X){var ie=te.angle+b(Math.atan2(X.y,X.x))+360;return Math.round(ie%360/45)}function w(te,X){var ie=X.transform.target,se=ie.canvas,oe=u.util.object.clone(X);oe.target=ie,se&&se.fire("object:"+te,oe),ie.fire(te,X)}function C(te,X){var ie=X.canvas,se=ie.uniScaleKey,oe=te[se];return ie.uniformScaling&&!oe||!ie.uniformScaling&&oe}function S(te){return te.originX===g&&te.originY===g}function _(te,X,ie){var se=te.lockScalingX,oe=te.lockScalingY;return!!(se&&oe||!X&&(se||oe)&&ie||se&&X==="x"||oe&&X==="y")}function $(te,X,ie){var se="not-allowed",oe=C(te,ie),le="";if(X.x!==0&&X.y===0?le="x":X.x===0&&X.y!==0&&(le="y"),_(ie,le,oe))return se;var Ce=v(ie,X);return l[Ce]+"-resize"}function k(te,X,ie){var se="not-allowed";if(X.x!==0&&ie.lockSkewingY||X.y!==0&&ie.lockSkewingX)return se;var oe=v(ie,X)%4;return c[oe]+"-resize"}function E(te,X,ie){return te[ie.canvas.altActionKey]?f.skewCursorStyleHandler(te,X,ie):f.scaleCursorStyleHandler(te,X,ie)}function F(te,X,ie){var se=te[ie.canvas.altActionKey];if(X.x===0)return se?"skewX":"scaleY";if(X.y===0)return se?"skewY":"scaleX"}function T(te,X,ie){return ie.lockRotation?"not-allowed":X.cursorStyle}function I(te,X,ie,se){return{e:te,transform:X,pointer:{x:ie,y:se}}}function D(te){return function(X,ie,se,oe){var le=ie.target,Ce=le.getCenterPoint(),Me=le.translateToOriginPoint(Ce,ie.originX,ie.originY),Fe=te(X,ie,se,oe);return le.setPositionByOrigin(Me,ie.originX,ie.originY),Fe}}function N(te,X){return function(ie,se,oe,le){var Ce=X(ie,se,oe,le);return Ce&&w(te,I(ie,se,oe,le)),Ce}}function V(te,X,ie,se,oe){var le=te.target,Ce=le.controls[te.corner],Me=le.canvas.getZoom(),Fe=le.padding/Me,de=le.toLocalPoint(new u.Point(se,oe),X,ie);return de.x>=Fe&&(de.x-=Fe),de.x<=-Fe&&(de.x+=Fe),de.y>=Fe&&(de.y-=Fe),de.y<=Fe&&(de.y+=Fe),de.x-=Ce.offsetX,de.y-=Ce.offsetY,de}function U(te){return te.flipX!==te.flipY}function A(te,X,ie,se,oe){if(te[X]!==0){var le=te._getTransformedDimensions()[se],Ce=oe/le*te[ie];te.set(ie,Ce)}}function M(te,X,ie,se){var oe=X.target,le=oe._getTransformedDimensions(0,oe.skewY),Ce=V(X,X.originX,X.originY,ie,se),Me=Math.abs(Ce.x*2)-le.x,Fe=oe.skewX,de;Me<2?de=0:(de=b(Math.atan2(Me/oe.scaleX,le.y/oe.scaleY)),X.originX===h&&X.originY===m&&(de=-de),X.originX===p&&X.originY===d&&(de=-de),U(oe)&&(de=-de));var Re=Fe!==de;if(Re){var qe=oe._getTransformedDimensions().y;oe.set("skewX",de),A(oe,"skewY","scaleY","y",qe)}return Re}function P(te,X,ie,se){var oe=X.target,le=oe._getTransformedDimensions(oe.skewX,0),Ce=V(X,X.originX,X.originY,ie,se),Me=Math.abs(Ce.y*2)-le.y,Fe=oe.skewY,de;Me<2?de=0:(de=b(Math.atan2(Me/oe.scaleY,le.x/oe.scaleX)),X.originX===h&&X.originY===m&&(de=-de),X.originX===p&&X.originY===d&&(de=-de),U(oe)&&(de=-de));var Re=Fe!==de;if(Re){var qe=oe._getTransformedDimensions().x;oe.set("skewY",de),A(oe,"skewX","scaleX","x",qe)}return Re}function j(te,X,ie,se){var oe=X.target,le=oe.skewX,Ce,Me=X.originY;if(oe.lockSkewingX)return!1;if(le===0){var Fe=V(X,g,g,ie,se);Fe.x>0?Ce=h:Ce=p}else le>0&&(Ce=Me===d?h:p),le<0&&(Ce=Me===d?p:h),U(oe)&&(Ce=Ce===h?p:h);X.originX=Ce;var de=N("skewing",D(M));return de(te,X,ie,se)}function q(te,X,ie,se){var oe=X.target,le=oe.skewY,Ce,Me=X.originX;if(oe.lockSkewingY)return!1;if(le===0){var Fe=V(X,g,g,ie,se);Fe.y>0?Ce=d:Ce=m}else le>0&&(Ce=Me===h?d:m),le<0&&(Ce=Me===h?m:d),U(oe)&&(Ce=Ce===d?m:d);X.originY=Ce;var de=N("skewing",D(P));return de(te,X,ie,se)}function B(te,X,ie,se){var oe=X,le=oe.target,Ce=le.translateToOriginPoint(le.getCenterPoint(),oe.originX,oe.originY);if(le.lockRotation)return!1;var Me=Math.atan2(oe.ey-Ce.y,oe.ex-Ce.x),Fe=Math.atan2(se-Ce.y,ie-Ce.x),de=b(Fe-Me+oe.theta),Re=!0;if(le.snapAngle>0){var qe=le.snapAngle,ot=le.snapThreshold||qe,Ft=Math.ceil(de/qe)*qe,xt=Math.floor(de/qe)*qe;Math.abs(de-xt)<ot?de=xt:Math.abs(de-Ft)<ot&&(de=Ft)}return de<0&&(de=360+de),de%=360,Re=le.angle!==de,le.angle=de,Re}function O(te,X,ie,se,oe){oe=oe||{};var le=X.target,Ce=le.lockScalingX,Me=le.lockScalingY,Fe=oe.by,de,Re,qe,ot,Ft=C(te,le),xt=_(le,Fe,Ft),Cn,ln,Yo=X.gestureScale;if(xt)return!1;if(Yo)Re=X.scaleX*Yo,qe=X.scaleY*Yo;else{if(de=V(X,X.originX,X.originY,ie,se),Cn=Fe!=="y"?x(de.x):1,ln=Fe!=="x"?x(de.y):1,X.signX||(X.signX=Cn),X.signY||(X.signY=ln),le.lockScalingFlip&&(X.signX!==Cn||X.signY!==ln))return!1;if(ot=le._getTransformedDimensions(),Ft&&!Fe){var ml=Math.abs(de.x)+Math.abs(de.y),ao=X.original,jg=Math.abs(ot.x*ao.scaleX/le.scaleX)+Math.abs(ot.y*ao.scaleY/le.scaleY),fS=ml/jg;Re=ao.scaleX*fS,qe=ao.scaleY*fS}else Re=Math.abs(de.x*le.scaleX/ot.x),qe=Math.abs(de.y*le.scaleY/ot.y);S(X)&&(Re*=2,qe*=2),X.signX!==Cn&&Fe!=="y"&&(X.originX=y[X.originX],Re*=-1,X.signX=Cn),X.signY!==ln&&Fe!=="x"&&(X.originY=y[X.originY],qe*=-1,X.signY=ln)}var zO=le.scaleX,v2e=le.scaleY;return Fe?(Fe==="x"&&le.set("scaleX",Re),Fe==="y"&&le.set("scaleY",qe)):(!Ce&&le.set("scaleX",Re),!Me&&le.set("scaleY",qe)),zO!==le.scaleX||v2e!==le.scaleY}function G(te,X,ie,se){return O(te,X,ie,se)}function Z(te,X,ie,se){return O(te,X,ie,se,{by:"x"})}function re(te,X,ie,se){return O(te,X,ie,se,{by:"y"})}function R(te,X,ie,se){return te[X.target.canvas.altActionKey]?f.skewHandlerX(te,X,ie,se):f.scalingY(te,X,ie,se)}function H(te,X,ie,se){return te[X.target.canvas.altActionKey]?f.skewHandlerY(te,X,ie,se):f.scalingX(te,X,ie,se)}function Y(te,X,ie,se){var oe=X.target,le=V(X,X.originX,X.originY,ie,se),Ce=oe.strokeWidth/(oe.strokeUniform?oe.scaleX:1),Me=S(X)?2:1,Fe=oe.width,de=Math.abs(le.x*Me/oe.scaleX)-Ce;return oe.set("width",Math.max(de,0)),Fe!==de}function L(te,X,ie,se){var oe=X.target,le=ie-X.offsetX,Ce=se-X.offsetY,Me=!oe.get("lockMovementX")&&oe.left!==le,Fe=!oe.get("lockMovementY")&&oe.top!==Ce;return Me&&oe.set("left",le),Fe&&oe.set("top",Ce),(Me||Fe)&&w("moving",I(te,X,ie,se)),Me||Fe}f.scaleCursorStyleHandler=$,f.skewCursorStyleHandler=k,f.scaleSkewCursorStyleHandler=E,f.rotationWithSnapping=N("rotating",D(B)),f.scalingEqually=N("scaling",D(G)),f.scalingX=N("scaling",D(Z)),f.scalingY=N("scaling",D(re)),f.scalingYOrSkewingX=R,f.scalingXOrSkewingY=H,f.changeWidth=N("resizing",D(Y)),f.skewHandlerX=j,f.skewHandlerY=q,f.dragHandler=L,f.scaleOrSkewActionName=F,f.rotationStyleHandler=T,f.fireEvent=w,f.wrapWithFixedAnchor=D,f.wrapWithFireEvent=N,f.getLocalPoint=V,u.controlsUtils=f}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.degreesToRadians,c=u.controlsUtils;function f(d,p,m,g,y){g=g||{};var b=this.sizeX||g.cornerSize||y.cornerSize,x=this.sizeY||g.cornerSize||y.cornerSize,v=typeof g.transparentCorners<"u"?g.transparentCorners:y.transparentCorners,w=v?"stroke":"fill",C=!v&&(g.cornerStrokeColor||y.cornerStrokeColor),S=p,_=m,$;d.save(),d.fillStyle=g.cornerColor||y.cornerColor,d.strokeStyle=g.cornerStrokeColor||y.cornerStrokeColor,b>x?($=b,d.scale(1,x/b),_=m*b/x):x>b?($=x,d.scale(b/x,1),S=p*x/b):$=b,d.lineWidth=1,d.beginPath(),d.arc(S,_,$/2,0,2*Math.PI,!1),d[w](),C&&d.stroke(),d.restore()}function h(d,p,m,g,y){g=g||{};var b=this.sizeX||g.cornerSize||y.cornerSize,x=this.sizeY||g.cornerSize||y.cornerSize,v=typeof g.transparentCorners<"u"?g.transparentCorners:y.transparentCorners,w=v?"stroke":"fill",C=!v&&(g.cornerStrokeColor||y.cornerStrokeColor),S=b/2,_=x/2;d.save(),d.fillStyle=g.cornerColor||y.cornerColor,d.strokeStyle=g.cornerStrokeColor||y.cornerStrokeColor,d.lineWidth=1,d.translate(p,m),d.rotate(l(y.angle)),d[w+"Rect"](-S,-_,b,x),C&&d.strokeRect(-S,-_,b,x),d.restore()}c.renderCircleControl=f,c.renderSquareControl=h}(e),function(a){var u=a.fabric||(a.fabric={});function l(c){for(var f in c)this[f]=c[f]}u.Control=l,u.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(c,f){return f.cursorStyle},getActionName:function(c,f){return f.actionName},getVisibility:function(c,f){var h=c._controlsVisibility;return h&&typeof h[f]<"u"?h[f]:this.visible},setVisibility:function(c){this.visible=c},positionHandler:function(c,f){var h=u.util.transformPoint({x:this.x*c.x+this.offsetX,y:this.y*c.y+this.offsetY},f);return h},calcCornerCoords:function(c,f,h,d,p){var m,g,y,b,x=p?this.touchSizeX:this.sizeX,v=p?this.touchSizeY:this.sizeY;if(x&&v&&x!==v){var w=Math.atan2(v,x),C=Math.sqrt(x*x+v*v)/2,S=w-u.util.degreesToRadians(c),_=Math.PI/2-w-u.util.degreesToRadians(c);m=C*u.util.cos(S),g=C*u.util.sin(S),y=C*u.util.cos(_),b=C*u.util.sin(_)}else{var $=x&&v?x:f;C=$*.7071067812;var S=u.util.degreesToRadians(45-c);m=y=C*u.util.cos(S),g=b=C*u.util.sin(S)}return{tl:{x:h-b,y:d-y},tr:{x:h+m,y:d-g},bl:{x:h-m,y:d+g},br:{x:h+b,y:d+y}}},render:function(c,f,h,d,p){switch(d=d||{},d.cornerStyle||p.cornerStyle){case"circle":u.controlsUtils.renderCircleControl.call(this,c,f,h,d,p);break;default:u.controlsUtils.renderSquareControl.call(this,c,f,h,d,p)}}}}(e),function(){function a(h,d){var p=h.getAttribute("style"),m=h.getAttribute("offset")||0,g,y,b,x;if(m=parseFloat(m)/(/%$/.test(m)?100:1),m=m<0?0:m>1?1:m,p){var v=p.split(/\s*;\s*/);for(v[v.length-1]===""&&v.pop(),x=v.length;x--;){var w=v[x].split(/\s*:\s*/),C=w[0].trim(),S=w[1].trim();C==="stop-color"?g=S:C==="stop-opacity"&&(b=S)}}return g||(g=h.getAttribute("stop-color")||"rgb(0,0,0)"),b||(b=h.getAttribute("stop-opacity")),g=new t.Color(g),y=g.getAlpha(),b=isNaN(parseFloat(b))?1:parseFloat(b),b*=y*d,{offset:m,color:g.toRgb(),opacity:b}}function u(h){return{x1:h.getAttribute("x1")||0,y1:h.getAttribute("y1")||0,x2:h.getAttribute("x2")||"100%",y2:h.getAttribute("y2")||0}}function l(h){return{x1:h.getAttribute("fx")||h.getAttribute("cx")||"50%",y1:h.getAttribute("fy")||h.getAttribute("cy")||"50%",r1:0,x2:h.getAttribute("cx")||"50%",y2:h.getAttribute("cy")||"50%",r2:h.getAttribute("r")||"50%"}}var c=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(h){h||(h={}),h.coords||(h.coords={});var d,p=this;Object.keys(h).forEach(function(m){p[m]=h[m]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,d={x1:h.coords.x1||0,y1:h.coords.y1||0,x2:h.coords.x2||0,y2:h.coords.y2||0},this.type==="radial"&&(d.r1=h.coords.r1||0,d.r2=h.coords.r2||0),this.coords=d,this.colorStops=h.colorStops.slice()},addColorStop:function(h){for(var d in h){var p=new t.Color(h[d]);this.colorStops.push({offset:parseFloat(d),color:p.toRgb(),opacity:p.getAlpha()})}return this},toObject:function(h){var d={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,d,h),d},toSVG:function(h,y){var p=c(this.coords,!0),m,g,y=y||{},b,x,v=c(this.colorStops,!0),w=p.r1>p.r2,C=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,_=-this.offsetY,$=!!y.additionalTransform,k=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(v.sort(function(D,N){return D.offset-N.offset}),k==="objectBoundingBox"?(S/=h.width,_/=h.height):(S+=h.width/2,_+=h.height/2),h.type==="path"&&this.gradientUnits!=="percentage"&&(S-=h.pathOffset.x,_-=h.pathOffset.y),C[4]-=S,C[5]-=_,x='id="SVGID_'+this.id+'" gradientUnits="'+k+'"',x+=' gradientTransform="'+($?y.additionalTransform+" ":"")+t.util.matrixToSVG(C)+'" ',this.type==="linear"?b=["<linearGradient ",x,' x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,`">
`]:this.type==="radial"&&(b=["<radialGradient ",x,' cx="',w?p.x1:p.x2,'" cy="',w?p.y1:p.y2,'" r="',w?p.r1:p.r2,'" fx="',w?p.x2:p.x1,'" fy="',w?p.y2:p.y1,`">
`]),this.type==="radial"){if(w)for(v=v.concat(),v.reverse(),m=0,g=v.length;m<g;m++)v[m].offset=1-v[m].offset;var E=Math.min(p.r1,p.r2);if(E>0){var F=Math.max(p.r1,p.r2),T=E/F;for(m=0,g=v.length;m<g;m++)v[m].offset+=T*(1-v[m].offset)}}for(m=0,g=v.length;m<g;m++){var I=v[m];b.push("<stop ",'offset="',I.offset*100+"%",'" style="stop-color:',I.color,typeof I.opacity<"u"?";stop-opacity: "+I.opacity:";",`"/>
`)}return b.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),b.join("")},toLive:function(h){var d,p=t.util.object.clone(this.coords),m,g;if(this.type){for(this.type==="linear"?d=h.createLinearGradient(p.x1,p.y1,p.x2,p.y2):this.type==="radial"&&(d=h.createRadialGradient(p.x1,p.y1,p.r1,p.x2,p.y2,p.r2)),m=0,g=this.colorStops.length;m<g;m++){var y=this.colorStops[m].color,b=this.colorStops[m].opacity,x=this.colorStops[m].offset;typeof b<"u"&&(y=new t.Color(y).setAlpha(b).toRgba()),d.addColorStop(x,y)}return d}}}),t.util.object.extend(t.Gradient,{fromElement:function(h,d,p,m){var g=parseFloat(p)/(/%$/.test(p)?100:1);g=g<0?0:g>1?1:g,isNaN(g)&&(g=1);var y=h.getElementsByTagName("stop"),b,x=h.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",v=h.getAttribute("gradientTransform")||"",w=[],C,S,_=0,$=0,k;for(h.nodeName==="linearGradient"||h.nodeName==="LINEARGRADIENT"?(b="linear",C=u(h)):(b="radial",C=l(h)),S=y.length;S--;)w.push(a(y[S],g));k=t.parseTransformAttribute(v),f(d,C,m,x),x==="pixels"&&(_=-d.left,$=-d.top);var E=new t.Gradient({id:h.getAttribute("id"),type:b,coords:C,colorStops:w,gradientUnits:x,gradientTransform:k,offsetX:_,offsetY:$});return E}});function f(h,d,p,m){var g,y;Object.keys(d).forEach(function(b){g=d[b],g==="Infinity"?y=1:g==="-Infinity"?y=0:(y=parseFloat(d[b],10),typeof g=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(g)&&(y*=.01,m==="pixels"&&((b==="x1"||b==="x2"||b==="r2")&&(y*=p.viewBoxWidth||p.width),(b==="y1"||b==="y2")&&(y*=p.viewBoxHeight||p.height)))),d[b]=y})}}(),function(){var a=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(u,l){if(u||(u={}),this.id=t.Object.__uid++,this.setOptions(u),!u.source||u.source&&typeof u.source!="string"){l&&l(this);return}else{var c=this;this.source=t.util.createImage(),t.util.loadImage(u.source,function(f,h){c.source=f,l&&l(c,h)},null,this.crossOrigin)}},toObject:function(u){var l=t.Object.NUM_FRACTION_DIGITS,c,f;return typeof this.source.src=="string"?c=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(c=this.source.toDataURL()),f={type:"pattern",source:c,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:a(this.offsetX,l),offsetY:a(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,f,u),f},toSVG:function(u){var l=typeof this.source=="function"?this.source():this.source,c=l.width/u.width,f=l.height/u.height,h=this.offsetX/u.width,d=this.offsetY/u.height,p="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(f=1,d&&(f+=Math.abs(d))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(c=1,h&&(c+=Math.abs(h))),l.src?p=l.src:l.toDataURL&&(p=l.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+h+'" y="'+d+'" width="'+c+'" height="'+f+`">
<image x="0" y="0" width="`+l.width+'" height="'+l.height+'" xlink:href="'+p+`"></image>
</pattern>
`},setOptions:function(u){for(var l in u)this[l]=u[l]},toLive:function(u){var l=this.source;return!l||typeof l.src<"u"&&(!l.complete||l.naturalWidth===0||l.naturalHeight===0)?"":u.createPattern(l,this.repeat)}})}(),function(a){var u=a.fabric||(a.fabric={}),l=u.util.toFixed;if(u.Shadow){u.warn("fabric.Shadow is already defined.");return}u.Shadow=u.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(c){typeof c=="string"&&(c=this._parseShadow(c));for(var f in c)this[f]=c[f];this.id=u.Object.__uid++},_parseShadow:function(c){var f=c.trim(),h=u.Shadow.reOffsetsAndBlur.exec(f)||[],d=f.replace(u.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:d.trim(),offsetX:parseFloat(h[1],10)||0,offsetY:parseFloat(h[2],10)||0,blur:parseFloat(h[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(c){var f=40,h=40,d=u.Object.NUM_FRACTION_DIGITS,p=u.util.rotateVector({x:this.offsetX,y:this.offsetY},u.util.degreesToRadians(-c.angle)),m=20,g=new u.Color(this.color);return c.width&&c.height&&(f=l((Math.abs(p.x)+this.blur)/c.width,d)*100+m,h=l((Math.abs(p.y)+this.blur)/c.height,d)*100+m),c.flipX&&(p.x*=-1),c.flipY&&(p.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+h+'%" height="'+(100+2*h)+'%" x="-'+f+'%" width="'+(100+2*f)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,d)+`"></feGaussianBlur>
	<feOffset dx="`+l(p.x,d)+'" dy="'+l(p.y,d)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+g.toRgb()+'" flood-opacity="'+g.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var c={},f=u.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(h){this[h]!==f[h]&&(c[h]=this[h])},this),c}}),u.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(e),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var a=t.util.object.extend,u=t.util.getElementOffset,l=t.util.removeFromArray,c=t.util.toFixed,f=t.util.transformPoint,h=t.util.invertTransform,d=t.util.getNodeCanvas,p=t.util.createCanvasElement,m=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(g,y){y||(y={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(g,y)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(g,y){var b=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(g),this._initOptions(y),this.interactive||this._initRetinaScaling(),y.overlayImage&&this.setOverlayImage(y.overlayImage,b),y.backgroundImage&&this.setBackgroundImage(y.backgroundImage,b),y.backgroundColor&&this.setBackgroundColor(y.backgroundColor,b),y.overlayColor&&this.setOverlayColor(y.overlayColor,b),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var g=t.devicePixelRatio;this.__initRetinaScaling(g,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(g,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(g,y,b){y.setAttribute("width",this.width*g),y.setAttribute("height",this.height*g),b.scale(g,g)},calcOffset:function(){return this._offset=u(this.lowerCanvasEl),this},setOverlayImage:function(g,y,b){return this.__setBgOverlayImage("overlayImage",g,y,b)},setBackgroundImage:function(g,y,b){return this.__setBgOverlayImage("backgroundImage",g,y,b)},setOverlayColor:function(g,y){return this.__setBgOverlayColor("overlayColor",g,y)},setBackgroundColor:function(g,y){return this.__setBgOverlayColor("backgroundColor",g,y)},__setBgOverlayImage:function(g,y,b,x){return typeof y=="string"?t.util.loadImage(y,function(v,w){if(v){var C=new t.Image(v,x);this[g]=C,C.canvas=this}b&&b(v,w)},this,x&&x.crossOrigin):(x&&y.setOptions(x),this[g]=y,y&&(y.canvas=this),b&&b(y,!1)),this},__setBgOverlayColor:function(g,y,b){return this[g]=y,this._initGradient(y,g),this._initPattern(y,g,b),this},_createCanvasElement:function(){var g=p();if(!g||(g.style||(g.style={}),typeof g.getContext>"u"))throw m;return g},_initOptions:function(g){var y=this.lowerCanvasEl;this._setOptions(g),this.width=this.width||parseInt(y.width,10)||0,this.height=this.height||parseInt(y.height,10)||0,this.lowerCanvasEl.style&&(y.width=this.width,y.height=this.height,y.style.width=this.width+"px",y.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(g){g&&g.getContext?this.lowerCanvasEl=g:this.lowerCanvasEl=t.util.getById(g)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(g,y){return this.setDimensions({width:g},y)},setHeight:function(g,y){return this.setDimensions({height:g},y)},setDimensions:function(g,y){var b;y=y||{};for(var x in g)b=g[x],y.cssOnly||(this._setBackstoreDimension(x,g[x]),b+="px",this.hasLostContext=!0),y.backstoreOnly||this._setCssDimension(x,b);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),y.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(g,y){return this.lowerCanvasEl[g]=y,this.upperCanvasEl&&(this.upperCanvasEl[g]=y),this.cacheCanvasEl&&(this.cacheCanvasEl[g]=y),this[g]=y,this},_setCssDimension:function(g,y){return this.lowerCanvasEl.style[g]=y,this.upperCanvasEl&&(this.upperCanvasEl.style[g]=y),this.wrapperEl&&(this.wrapperEl.style[g]=y),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(g){var y=this._activeObject,b=this.backgroundImage,x=this.overlayImage,v,w,C;for(this.viewportTransform=g,w=0,C=this._objects.length;w<C;w++)v=this._objects[w],v.group||v.setCoords(!0);return y&&y.setCoords(),b&&b.setCoords(!0),x&&x.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(g,y){var b=g,x=this.viewportTransform.slice(0);g=f(g,h(this.viewportTransform)),x[0]=y,x[3]=y;var v=f(g,x);return x[4]+=b.x-v.x,x[5]+=b.y-v.y,this.setViewportTransform(x)},setZoom:function(g){return this.zoomToPoint(new t.Point(0,0),g),this},absolutePan:function(g){var y=this.viewportTransform.slice(0);return y[4]=-g.x,y[5]=-g.y,this.setViewportTransform(y)},relativePan:function(g){return this.absolutePan(new t.Point(-g.x-this.viewportTransform[4],-g.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(g){this.stateful&&g.setupState(),g._set("canvas",this),g.setCoords(),this.fire("object:added",{target:g}),g.fire("added")},_onObjectRemoved:function(g){this.fire("object:removed",{target:g}),g.fire("removed"),delete g.canvas},clearContext:function(g){return g.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var g=this.contextContainer;return this.renderCanvas(g,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var g={},y=this.width,b=this.height,x=h(this.viewportTransform);return g.tl=f({x:0,y:0},x),g.br=f({x:y,y:b},x),g.tr=new t.Point(g.br.x,g.tl.y),g.bl=new t.Point(g.tl.x,g.br.y),this.vptCoords=g,g},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(g,y){var b=this.viewportTransform,x=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(g),t.util.setImageSmoothing(g,this.imageSmoothingEnabled),this.fire("before:render",{ctx:g}),this._renderBackground(g),g.save(),g.transform(b[0],b[1],b[2],b[3],b[4],b[5]),this._renderObjects(g,y),g.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),x&&(x.canvas=this,x.shouldCache(),x._transformDone=!0,x.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(g)),this._renderOverlay(g),this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),this.fire("after:render",{ctx:g})},drawClipPathOnCanvas:function(g){var y=this.viewportTransform,b=this.clipPath;g.save(),g.transform(y[0],y[1],y[2],y[3],y[4],y[5]),g.globalCompositeOperation="destination-in",b.transform(g),g.scale(1/b.zoomX,1/b.zoomY),g.drawImage(b._cacheCanvas,-b.cacheTranslationX,-b.cacheTranslationY),g.restore()},_renderObjects:function(g,y){var b,x;for(b=0,x=y.length;b<x;++b)y[b]&&y[b].render(g)},_renderBackgroundOrOverlay:function(g,y){var b=this[y+"Color"],x=this[y+"Image"],v=this.viewportTransform,w=this[y+"Vpt"];if(!(!b&&!x)){if(b){g.save(),g.beginPath(),g.moveTo(0,0),g.lineTo(this.width,0),g.lineTo(this.width,this.height),g.lineTo(0,this.height),g.closePath(),g.fillStyle=b.toLive?b.toLive(g,this):b,w&&g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),g.transform(1,0,0,1,b.offsetX||0,b.offsetY||0);var C=b.gradientTransform||b.patternTransform;C&&g.transform(C[0],C[1],C[2],C[3],C[4],C[5]),g.fill(),g.restore()}x&&(g.save(),w&&g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),x.render(g),g.restore())}},_renderBackground:function(g){this._renderBackgroundOrOverlay(g,"background")},_renderOverlay:function(g){this._renderBackgroundOrOverlay(g,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(g){return this._centerObject(g,new t.Point(this.getCenterPoint().x,g.getCenterPoint().y))},centerObjectV:function(g){return this._centerObject(g,new t.Point(g.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(g){var y=this.getCenterPoint();return this._centerObject(g,y)},viewportCenterObject:function(g){var y=this.getVpCenter();return this._centerObject(g,y)},viewportCenterObjectH:function(g){var y=this.getVpCenter();return this._centerObject(g,new t.Point(y.x,g.getCenterPoint().y)),this},viewportCenterObjectV:function(g){var y=this.getVpCenter();return this._centerObject(g,new t.Point(g.getCenterPoint().x,y.y))},getVpCenter:function(){var g=this.getCenterPoint(),y=h(this.viewportTransform);return f(g,y)},_centerObject:function(g,y){return g.setPositionByOrigin(y,"center","center"),g.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(g){return this.toDatalessObject(g)},toObject:function(g){return this._toObjectMethod("toObject",g)},toDatalessObject:function(g){return this._toObjectMethod("toDatalessObject",g)},_toObjectMethod:function(g,y){var b=this.clipPath,x={version:t.version,objects:this._toObjects(g,y)};return b&&!b.excludeFromExport&&(x.clipPath=this._toObject(this.clipPath,g,y)),a(x,this.__serializeBgOverlay(g,y)),t.util.populateWithProperties(this,x,y),x},_toObjects:function(g,y){return this._objects.filter(function(b){return!b.excludeFromExport}).map(function(b){return this._toObject(b,g,y)},this)},_toObject:function(g,y,b){var x;this.includeDefaultValues||(x=g.includeDefaultValues,g.includeDefaultValues=!1);var v=g[y](b);return this.includeDefaultValues||(g.includeDefaultValues=x),v},__serializeBgOverlay:function(g,y){var b={},x=this.backgroundImage,v=this.overlayImage,w=this.backgroundColor,C=this.overlayColor;return w&&w.toObject?w.excludeFromExport||(b.background=w.toObject(y)):w&&(b.background=w),C&&C.toObject?C.excludeFromExport||(b.overlay=C.toObject(y)):C&&(b.overlay=C),x&&!x.excludeFromExport&&(b.backgroundImage=this._toObject(x,g,y)),v&&!v.excludeFromExport&&(b.overlayImage=this._toObject(v,g,y)),b},svgViewportTransformation:!0,toSVG:function(g,y){g||(g={}),g.reviver=y;var b=[];return this._setSVGPreamble(b,g),this._setSVGHeader(b,g),this.clipPath&&b.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(b,"background"),this._setSVGBgOverlayImage(b,"backgroundImage",y),this._setSVGObjects(b,y),this.clipPath&&b.push(`</g>
`),this._setSVGBgOverlayColor(b,"overlay"),this._setSVGBgOverlayImage(b,"overlayImage",y),b.push("</svg>"),b.join("")},_setSVGPreamble:function(g,y){y.suppressPreamble||g.push('<?xml version="1.0" encoding="',y.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(g,y){var b=y.width||this.width,x=y.height||this.height,v,w='viewBox="0 0 '+this.width+" "+this.height+'" ',C=t.Object.NUM_FRACTION_DIGITS;y.viewBox?w='viewBox="'+y.viewBox.x+" "+y.viewBox.y+" "+y.viewBox.width+" "+y.viewBox.height+'" ':this.svgViewportTransformation&&(v=this.viewportTransform,w='viewBox="'+c(-v[4]/v[0],C)+" "+c(-v[5]/v[3],C)+" "+c(this.width/v[0],C)+" "+c(this.height/v[3],C)+'" '),g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',b,'" ','height="',x,'" ',w,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(y),`</defs>
`)},createSVGClipPathMarkup:function(g){var y=this.clipPath;return y?(y.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+y.clipPathId+`" >
`+this.clipPath.toClipPathSVG(g.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var g=this,y=["background","overlay"].map(function(b){var x=g[b+"Color"];if(x&&x.toLive){var v=g[b+"Vpt"],w=g.viewportTransform,C={width:g.width/(v?w[0]:1),height:g.height/(v?w[3]:1)};return x.toSVG(C,{additionalTransform:v?t.util.matrixToSVG(w):""})}});return y.join("")},createSVGFontFacesMarkup:function(){var g="",y={},b,x,v,w,C,S,_,$,k,E=t.fontPaths,F=[];for(this._objects.forEach(function I(D){F.push(D),D._objects&&D._objects.forEach(I)}),$=0,k=F.length;$<k;$++)if(b=F[$],x=b.fontFamily,!(b.type.indexOf("text")===-1||y[x]||!E[x])&&(y[x]=!0,!!b.styles)){v=b.styles;for(C in v){w=v[C];for(_ in w)S=w[_],x=S.fontFamily,!y[x]&&E[x]&&(y[x]=!0)}}for(var T in y)g+=[`		@font-face {
`,"			font-family: '",T,`';
`,"			src: url('",E[T],`');
`,`		}
`].join("");return g&&(g=['	<style type="text/css">',`<![CDATA[
`,g,"]]>",`</style>
`].join("")),g},_setSVGObjects:function(g,y){var b,x,v,w=this._objects;for(x=0,v=w.length;x<v;x++)b=w[x],!b.excludeFromExport&&this._setSVGObject(g,b,y)},_setSVGObject:function(g,y,b){g.push(y.toSVG(b))},_setSVGBgOverlayImage:function(g,y,b){this[y]&&!this[y].excludeFromExport&&this[y].toSVG&&g.push(this[y].toSVG(b))},_setSVGBgOverlayColor:function(g,y){var b=this[y+"Color"],x=this.viewportTransform,v=this.width,w=this.height;if(b)if(b.toLive){var C=b.repeat,S=t.util.invertTransform(x),_=this[y+"Vpt"],$=_?t.util.matrixToSVG(S):"";g.push('<rect transform="'+$+" translate(",v/2,",",w/2,')"',' x="',b.offsetX-v/2,'" y="',b.offsetY-w/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?b.source.width:v,'" height="',C==="repeat-x"||C==="no-repeat"?b.source.height:w,'" fill="url(#SVGID_'+b.id+')"',`></rect>
`)}else g.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',b,'"',`></rect>
`)},sendToBack:function(g){if(!g)return this;var y=this._activeObject,b,x,v;if(g===y&&g.type==="activeSelection")for(v=y._objects,b=v.length;b--;)x=v[b],l(this._objects,x),this._objects.unshift(x);else l(this._objects,g),this._objects.unshift(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(g){if(!g)return this;var y=this._activeObject,b,x,v;if(g===y&&g.type==="activeSelection")for(v=y._objects,b=0;b<v.length;b++)x=v[b],l(this._objects,x),this._objects.push(x);else l(this._objects,g),this._objects.push(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(g,y){if(!g)return this;var b=this._activeObject,x,v,w,C,S,_=0;if(g===b&&g.type==="activeSelection")for(S=b._objects,x=0;x<S.length;x++)v=S[x],w=this._objects.indexOf(v),w>0+_&&(C=w-1,l(this._objects,v),this._objects.splice(C,0,v)),_++;else w=this._objects.indexOf(g),w!==0&&(C=this._findNewLowerIndex(g,w,y),l(this._objects,g),this._objects.splice(C,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(g,y,b){var x,v;if(b)for(x=y,v=y-1;v>=0;--v){var w=g.intersectsWithObject(this._objects[v])||g.isContainedWithinObject(this._objects[v])||this._objects[v].isContainedWithinObject(g);if(w){x=v;break}}else x=y-1;return x},bringForward:function(g,y){if(!g)return this;var b=this._activeObject,x,v,w,C,S,_=0;if(g===b&&g.type==="activeSelection")for(S=b._objects,x=S.length;x--;)v=S[x],w=this._objects.indexOf(v),w<this._objects.length-1-_&&(C=w+1,l(this._objects,v),this._objects.splice(C,0,v)),_++;else w=this._objects.indexOf(g),w!==this._objects.length-1&&(C=this._findNewUpperIndex(g,w,y),l(this._objects,g),this._objects.splice(C,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(g,y,b){var x,v,w;if(b)for(x=y,v=y+1,w=this._objects.length;v<w;++v){var C=g.intersectsWithObject(this._objects[v])||g.isContainedWithinObject(this._objects[v])||this._objects[v].isContainedWithinObject(g);if(C){x=v;break}}else x=y+1;return x},moveTo:function(g,y){return l(this._objects,g),this._objects.splice(y,0,g),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(g){g.dispose&&g.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),a(t.StaticCanvas.prototype,t.Observable),a(t.StaticCanvas.prototype,t.Collection),a(t.StaticCanvas.prototype,t.DataURLExporter),a(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var y=p();if(!y||!y.getContext)return null;var b=y.getContext("2d");if(!b)return null;switch(g){case"setLineDash":return typeof b.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var g=d(this.lowerCanvasEl);return g&&g.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(g){var y=d(this.lowerCanvasEl);return y&&y.createJPEGStream(g)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(a){a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.miterLimit=this.strokeMiterLimit,a.lineJoin=this.strokeLineJoin,a.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(a){var u=this.canvas.viewportTransform;a.save(),a.transform(u[0],u[1],u[2],u[3],u[4],u[5])},_setShadow:function(){if(this.shadow){var a=this.canvas,u=this.shadow,l=a.contextTop,c=a.getZoom();a&&a._isRetinaScaling()&&(c*=t.devicePixelRatio),l.shadowColor=u.color,l.shadowBlur=u.blur*c,l.shadowOffsetX=u.offsetX*c,l.shadowOffsetY=u.offsetY*c}},needsFullRender:function(){var a=new t.Color(this.color);return a.getAlpha()<1||!!this.shadow},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_isOutSideCanvas:function(a){return a.x<0||a.x>this.canvas.getWidth()||a.y<0||a.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(a){this.canvas=a,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(a,u,l){var c=u.midPointFrom(l);return a.quadraticCurveTo(u.x,u.y,c.x,c.y),c},onMouseDown:function(a,u){this.canvas._isMainEvent(u.e)&&(this.drawStraightLine=u.e[this.straightLineKey],this._prepareForDrawing(a),this._captureDrawingPath(a),this._render())},onMouseMove:function(a,u){if(this.canvas._isMainEvent(u.e)&&(this.drawStraightLine=u.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a))&&this._captureDrawingPath(a)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,c=l.length,f=this.canvas.contextTop;this._saveAndTransform(f),this.oldEnd&&(f.beginPath(),f.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(f,l[c-2],l[c-1],!0),f.stroke(),f.restore()}},onMouseUp:function(a){return this.canvas._isMainEvent(a.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(a){var u=new t.Point(a.x,a.y);this._reset(),this._addPoint(u),this.canvas.contextTop.moveTo(u.x,u.y)},_addPoint:function(a){return this._points.length>1&&a.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(a),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(a){var u=new t.Point(a.x,a.y);return this._addPoint(u)},_render:function(a){var u,l,c=this._points[0],f=this._points[1];if(a=a||this.canvas.contextTop,this._saveAndTransform(a),a.beginPath(),this._points.length===2&&c.x===f.x&&c.y===f.y){var h=this.width/1e3;c=new t.Point(c.x,c.y),f=new t.Point(f.x,f.y),c.x-=h,f.x+=h}for(a.moveTo(c.x,c.y),u=1,l=this._points.length;u<l;u++)this._drawSegment(a,c,f),c=this._points[u],f=this._points[u+1];a.lineTo(c.x,c.y),a.stroke(),a.restore()},convertPointsToSVGPath:function(a){var u=this.width/1e3;return t.util.getSmoothPathFromPoints(a,u)},_isEmptySVGPath:function(a){var u=t.util.joinPath(a);return u==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(a){var u=new t.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,u.shadow=new t.Shadow(this.shadow)),u},decimatePoints:function(a,u){if(a.length<=2)return a;var l=this.canvas.getZoom(),c=Math.pow(u/l,2),f,h=a.length-1,d=a[0],p=[d],m;for(f=1;f<h-1;f++)m=Math.pow(d.x-a[f].x,2)+Math.pow(d.y-a[f].y,2),m>=c&&(d=a[f],p.push(d));return p.push(a[h]),p},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var u=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(u)){this.canvas.requestRenderAll();return}var l=this.createPath(u);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.requestRenderAll(),l.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:l})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var u=this.addPoint(a),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,u),l.restore()},dot:function(a,u){a.fillStyle=u.fill,a.beginPath(),a.arc(u.x,u.y,u.radius,0,Math.PI*2,!1),a.closePath(),a.fill()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},_render:function(){var a=this.canvas.contextTop,u,l,c=this.points;for(this._saveAndTransform(a),u=0,l=c.length;u<l;u++)this.dot(a,c[u]);a.restore()},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(a),this._render()):this.drawDot(a))},onMouseUp:function(){var a=this.canvas.renderOnAddRemove,u,l;this.canvas.renderOnAddRemove=!1;var c=[];for(u=0,l=this.points.length;u<l;u++){var f=this.points[u],h=new t.Circle({radius:f.radius,left:f.x,top:f.y,originX:"center",originY:"center",fill:f.fill});this.shadow&&(h.shadow=new t.Shadow(this.shadow)),c.push(h)}var d=new t.Group(c);d.canvas=this.canvas,this.canvas.fire("before:path:created",{path:d}),this.canvas.add(d),this.canvas.fire("path:created",{path:d}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},addPoint:function(a){var u=new t.Point(a.x,a.y),l=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,c=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return u.radius=l,u.fill=c,this.points.push(u),u}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render(this.sprayChunkPoints)},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.addSprayChunk(a),this.render(this.sprayChunkPoints))},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var u=[],l=0,c=this.sprayChunks.length;l<c;l++)for(var f=this.sprayChunks[l],h=0,d=f.length;h<d;h++){var p=new t.Rect({width:f[h].width,height:f[h].width,left:f[h].x+1,top:f[h].y+1,originX:"center",originY:"center",fill:this.color});u.push(p)}this.optimizeOverlapping&&(u=this._getOptimizedRects(u));var m=new t.Group(u);this.shadow&&m.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:m}),this.canvas.add(m),this.canvas.fire("path:created",{path:m}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},_getOptimizedRects:function(a){var u={},l,c,f;for(c=0,f=a.length;c<f;c++)l=a[c].left+""+a[c].top,u[l]||(u[l]=a[c]);var h=[];for(l in u)h.push(u[l]);return h},render:function(a){var u=this.canvas.contextTop,l,c;for(u.fillStyle=this.color,this._saveAndTransform(u),l=0,c=a.length;l<c;l++){var f=a[l];typeof f.opacity<"u"&&(u.globalAlpha=f.opacity),u.fillRect(f.x,f.y,f.width,f.width)}u.restore()},_render:function(){var a=this.canvas.contextTop,u,l;for(a.fillStyle=this.color,this._saveAndTransform(a),u=0,l=this.sprayChunks.length;u<l;u++)this.render(this.sprayChunks[u]);a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];var u,l,c,f=this.width/2,h;for(h=0;h<this.density;h++){u=t.util.getRandomInt(a.x-f,a.x+f),l=t.util.getRandomInt(a.y-f,a.y+f),this.dotWidthVariance?c=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):c=this.dotWidth;var d=new t.Point(u,l);d.width=c,this.randomOpacity&&(d.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(d)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var a=20,u=5,l=t.util.createCanvasElement(),c=l.getContext("2d");return l.width=l.height=a+u,c.fillStyle=this.color,c.beginPath(),c.arc(a/2,a/2,a/2,0,Math.PI*2,!1),c.closePath(),c.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(a){return a.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(a){this.callSuper("_setBrushStyles",a),a.strokeStyle=this.getPattern(a)},createPath:function(a){var u=this.callSuper("createPath",a),l=u._getLeftTopCoords().scalarAdd(u.strokeWidth/2);return u.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),u}}),function(){var a=t.util.getPointer,u=t.util.degreesToRadians,l=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(f,h){h||(h={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(f,h),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var f=this.getActiveObjects(),h,d,p;if(f.length>0&&!this.preserveObjectStacking){d=[],p=[];for(var m=0,g=this._objects.length;m<g;m++)h=this._objects[m],f.indexOf(h)===-1?d.push(h):p.push(h);f.length>1&&(this._activeObject._objects=p),d.push.apply(d,p)}else d=this._objects;return d},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var f=this.contextContainer;return this.renderCanvas(f,this._chooseObjectsToRender()),this},renderTopLayer:function(f){f.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(f),this.contextTopDirty=!0),f.restore()},renderTop:function(){var f=this.contextTop;return this.clearContext(f),this.renderTopLayer(f),this.fire("after:render"),this},_normalizePointer:function(f,h){var d=f.calcTransformMatrix(),p=t.util.invertTransform(d),m=this.restorePointerVpt(h);return t.util.transformPoint(m,p)},isTargetTransparent:function(f,h,d){if(f.shouldCache()&&f._cacheCanvas&&f!==this._activeObject){var p=this._normalizePointer(f,{x:h,y:d}),m=Math.max(f.cacheTranslationX+p.x*f.zoomX,0),g=Math.max(f.cacheTranslationY+p.y*f.zoomY,0),v=t.util.isTransparent(f._cacheContext,Math.round(m),Math.round(g),this.targetFindTolerance);return v}var y=this.contextCache,b=f.selectionBackgroundColor,x=this.viewportTransform;f.selectionBackgroundColor="",this.clearContext(y),y.save(),y.transform(x[0],x[1],x[2],x[3],x[4],x[5]),f.render(y),y.restore(),f.selectionBackgroundColor=b;var v=t.util.isTransparent(y,h,d,this.targetFindTolerance);return v},_isSelectionKeyPressed:function(f){var h=!1;return Array.isArray(this.selectionKey)?h=!!this.selectionKey.find(function(d){return f[d]===!0}):h=f[this.selectionKey],h},_shouldClearSelection:function(f,h){var d=this.getActiveObjects(),p=this._activeObject;return!h||h&&p&&d.length>1&&d.indexOf(h)===-1&&p!==h&&!this._isSelectionKeyPressed(f)||h&&!h.evented||h&&!h.selectable&&p&&p!==h},_shouldCenterTransform:function(f,h,d){if(f){var p;return h==="scale"||h==="scaleX"||h==="scaleY"||h==="resizing"?p=this.centeredScaling||f.centeredScaling:h==="rotate"&&(p=this.centeredRotation||f.centeredRotation),p?!d:d}},_getOriginFromCorner:function(f,h){var d={x:f.originX,y:f.originY};return h==="ml"||h==="tl"||h==="bl"?d.x="right":(h==="mr"||h==="tr"||h==="br")&&(d.x="left"),h==="tl"||h==="mt"||h==="tr"?d.y="bottom":(h==="bl"||h==="mb"||h==="br")&&(d.y="top"),d},_getActionFromCorner:function(f,h,d,p){if(!h||!f)return"drag";var m=p.controls[h];return m.getActionName(d,m,p)},_setupCurrentTransform:function(f,h,d){if(h){var p=this.getPointer(f),m=h.__corner,g=h.controls[m],y=d&&m?g.getActionHandler(f,h,g):t.controlsUtils.dragHandler,b=this._getActionFromCorner(d,m,f,h),x=this._getOriginFromCorner(h,m),v=f[this.centeredKey],w={target:h,action:b,actionHandler:y,corner:m,scaleX:h.scaleX,scaleY:h.scaleY,skewX:h.skewX,skewY:h.skewY,offsetX:p.x-h.left,offsetY:p.y-h.top,originX:x.x,originY:x.y,ex:p.x,ey:p.y,lastX:p.x,lastY:p.y,theta:u(h.angle),width:h.width*h.scaleX,shiftKey:f.shiftKey,altKey:v,original:t.util.saveObjectTransform(h)};this._shouldCenterTransform(h,b,v)&&(w.originX="center",w.originY="center"),w.original.originX=x.x,w.original.originY=x.y,this._currentTransform=w,this._beforeTransform(f)}},setCursor:function(f){this.upperCanvasEl.style.cursor=f},_drawSelection:function(f){var h=this._groupSelector,d=new t.Point(h.ex,h.ey),p=t.util.transformPoint(d,this.viewportTransform),m=new t.Point(h.ex+h.left,h.ey+h.top),g=t.util.transformPoint(m,this.viewportTransform),y=Math.min(p.x,g.x),b=Math.min(p.y,g.y),x=Math.max(p.x,g.x),v=Math.max(p.y,g.y),w=this.selectionLineWidth/2;this.selectionColor&&(f.fillStyle=this.selectionColor,f.fillRect(y,b,x-y,v-b)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(f.lineWidth=this.selectionLineWidth,f.strokeStyle=this.selectionBorderColor,y+=w,b+=w,x-=w,v-=w,t.Object.prototype._setLineDash.call(this,f,this.selectionDashArray),f.strokeRect(y,b,x-y,v-b))},findTarget:function(f,h){if(!this.skipTargetFind){var d=!0,p=this.getPointer(f,d),m=this._activeObject,g=this.getActiveObjects(),y,b,x=l(f),v=g.length>1&&!h||g.length===1;if(this.targets=[],v&&m._findTargetCorner(p,x)||g.length>1&&!h&&m===this._searchPossibleTargets([m],p))return m;if(g.length===1&&m===this._searchPossibleTargets([m],p))if(this.preserveObjectStacking)y=m,b=this.targets,this.targets=[];else return m;var w=this._searchPossibleTargets(this._objects,p);return f[this.altSelectionKey]&&w&&y&&w!==y&&(w=y,this.targets=b),w}},_checkTarget:function(f,h,d){if(h&&h.visible&&h.evented&&h.containsPoint(f))if((this.perPixelTargetFind||h.perPixelTargetFind)&&!h.isEditing){var p=this.isTargetTransparent(h,d.x,d.y);if(!p)return!0}else return!0},_searchPossibleTargets:function(f,h){for(var d,p=f.length,m;p--;){var g=f[p],y=g.group?this._normalizePointer(g.group,h):h;if(this._checkTarget(y,g,h)){d=f[p],d.subTargetCheck&&d instanceof t.Group&&(m=this._searchPossibleTargets(d._objects,h),m&&this.targets.push(m));break}}return d},restorePointerVpt:function(f){return t.util.transformPoint(f,t.util.invertTransform(this.viewportTransform))},getPointer:function(f,h){if(this._absolutePointer&&!h)return this._absolutePointer;if(this._pointer&&h)return this._pointer;var d=a(f),p=this.upperCanvasEl,m=p.getBoundingClientRect(),g=m.width||0,y=m.height||0,b;(!g||!y)&&("top"in m&&"bottom"in m&&(y=Math.abs(m.top-m.bottom)),"right"in m&&"left"in m&&(g=Math.abs(m.right-m.left))),this.calcOffset(),d.x=d.x-this._offset.left,d.y=d.y-this._offset.top,h||(d=this.restorePointerVpt(d));var x=this.getRetinaScaling();return x!==1&&(d.x/=x,d.y/=x),g===0||y===0?b={width:1,height:1}:b={width:p.width/g,height:p.height/y},{x:d.x*b.width,y:d.y*b.height}},_createUpperCanvas:function(){var f=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),h=this.lowerCanvasEl,d=this.upperCanvasEl;d?d.className="":(d=this._createCanvasElement(),this.upperCanvasEl=d),t.util.addClass(d,"upper-canvas "+f),this.wrapperEl.appendChild(d),this._copyCanvasStyle(h,d),this._applyCanvasStyle(d),this.contextTop=d.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(f){var h=this.width||f.width,d=this.height||f.height;t.util.setStyle(f,{position:"absolute",width:h+"px",height:d+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),f.width=h,f.height=d,t.util.makeElementUnselectable(f)},_copyCanvasStyle:function(f,h){h.style.cssText=f.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var f=this._activeObject;return f?f.type==="activeSelection"&&f._objects?f._objects.slice(0):[f]:[]},_onObjectRemoved:function(f){f===this._activeObject&&(this.fire("before:selection:cleared",{target:f}),this._discardActiveObject(),this.fire("selection:cleared",{target:f}),f.fire("deselected")),f===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",f)},_fireSelectionEvents:function(f,h){var d=!1,p=this.getActiveObjects(),m=[],g=[];f.forEach(function(y){p.indexOf(y)===-1&&(d=!0,y.fire("deselected",{e:h,target:y}),g.push(y))}),p.forEach(function(y){f.indexOf(y)===-1&&(d=!0,y.fire("selected",{e:h,target:y}),m.push(y))}),f.length>0&&p.length>0?d&&this.fire("selection:updated",{e:h,selected:m,deselected:g}):p.length>0?this.fire("selection:created",{e:h,selected:m}):f.length>0&&this.fire("selection:cleared",{e:h,deselected:g})},setActiveObject:function(f,h){var d=this.getActiveObjects();return this._setActiveObject(f,h),this._fireSelectionEvents(d,h),this},_setActiveObject:function(f,h){return this._activeObject===f||!this._discardActiveObject(h,f)||f.onSelect({e:h})?!1:(this._activeObject=f,!0)},_discardActiveObject:function(f,h){var d=this._activeObject;if(d){if(d.onDeselect({e:f,object:h}))return!1;this._activeObject=null}return!0},discardActiveObject:function(f){var h=this.getActiveObjects(),d=this.getActiveObject();return h.length&&this.fire("before:selection:cleared",{target:d,e:f}),this._discardActiveObject(f),this._fireSelectionEvents(h,f),this},dispose:function(){var f=this.wrapperEl;return this.removeListeners(),f.removeChild(this.upperCanvasEl),f.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(h){t.util.cleanUpJsdomNode(this[h]),this[h]=void 0}.bind(this)),f.parentNode&&f.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(f){var h=this._activeObject;h&&h._renderControls(f)},_toObject:function(f,h,d){var p=this._realizeGroupTransformOnObject(f),m=this.callSuper("_toObject",f,h,d);return this._unwindGroupTransformOnObject(f,p),m},_realizeGroupTransformOnObject:function(f){if(f.group&&f.group.type==="activeSelection"&&this._activeObject===f.group){var h=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],d={};return h.forEach(function(p){d[p]=f[p]}),t.util.addTransformToObject(f,this._activeObject.calcOwnMatrix()),d}else return null},_unwindGroupTransformOnObject:function(f,h){h&&f.set(h)},_setSVGObject:function(f,h,d){var p=this._realizeGroupTransformOnObject(h);this.callSuper("_setSVGObject",f,h,d),this._unwindGroupTransformOnObject(h,p)},setViewportTransform:function(f){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,f)}});for(var c in t.StaticCanvas)c!=="prototype"&&(t.Canvas[c]=t.StaticCanvas[c])}(),function(){var a=t.util.addListener,u=t.util.removeListener,l=3,c=2,f=1,h={passive:!1};function d(p,m){return p.button&&p.button===m-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(a,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(p,m){var g=this.upperCanvasEl,y=this._getEventPrefix();p(t.window,"resize",this._onResize),p(g,y+"down",this._onMouseDown),p(g,y+"move",this._onMouseMove,h),p(g,y+"out",this._onMouseOut),p(g,y+"enter",this._onMouseEnter),p(g,"wheel",this._onMouseWheel),p(g,"contextmenu",this._onContextMenu),p(g,"dblclick",this._onDoubleClick),p(g,"dragover",this._onDragOver),p(g,"dragenter",this._onDragEnter),p(g,"dragleave",this._onDragLeave),p(g,"drop",this._onDrop),this.enablePointerEvents||p(g,"touchstart",this._onTouchStart,h),typeof eventjs<"u"&&m in eventjs&&(eventjs[m](g,"gesture",this._onGesture),eventjs[m](g,"drag",this._onDrag),eventjs[m](g,"orientation",this._onOrientationChange),eventjs[m](g,"shake",this._onShake),eventjs[m](g,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(u,"remove");var p=this._getEventPrefix();u(t.document,p+"up",this._onMouseUp),u(t.document,"touchend",this._onTouchEnd,h),u(t.document,p+"move",this._onMouseMove,h),u(t.document,"touchmove",this._onMouseMove,h)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(p,m){this.__onTransformGesture&&this.__onTransformGesture(p,m)},_onDrag:function(p,m){this.__onDrag&&this.__onDrag(p,m)},_onMouseWheel:function(p){this.__onMouseWheel(p)},_onMouseOut:function(p){var m=this._hoveredTarget;this.fire("mouse:out",{target:m,e:p}),this._hoveredTarget=null,m&&m.fire("mouseout",{e:p});var g=this;this._hoveredTargets.forEach(function(y){g.fire("mouse:out",{target:m,e:p}),y&&m.fire("mouseout",{e:p})}),this._hoveredTargets=[]},_onMouseEnter:function(p){!this._currentTransform&&!this.findTarget(p)&&(this.fire("mouse:over",{target:null,e:p}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(p,m){this.__onOrientationChange&&this.__onOrientationChange(p,m)},_onShake:function(p,m){this.__onShake&&this.__onShake(p,m)},_onLongPress:function(p,m){this.__onLongPress&&this.__onLongPress(p,m)},_onDragOver:function(p){p.preventDefault();var m=this._simpleEventHandler("dragover",p);this._fireEnterLeaveEvents(m,p)},_onDrop:function(p){return this._simpleEventHandler("drop:before",p),this._simpleEventHandler("drop",p)},_onContextMenu:function(p){return this.stopContextMenu&&(p.stopPropagation(),p.preventDefault()),!1},_onDoubleClick:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"dblclick"),this._resetTransformEventData(p)},getPointerId:function(p){var m=p.changedTouches;return m?m[0]&&m[0].identifier:this.enablePointerEvents?p.pointerId:-1},_isMainEvent:function(p){return p.isPrimary===!0?!0:p.isPrimary===!1?!1:p.type==="touchend"&&p.touches.length===0?!0:p.changedTouches?p.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(p){p.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(p)),this.__onMouseDown(p),this._resetTransformEventData();var m=this.upperCanvasEl,g=this._getEventPrefix();a(t.document,"touchend",this._onTouchEnd,h),a(t.document,"touchmove",this._onMouseMove,h),u(m,g+"down",this._onMouseDown)},_onMouseDown:function(p){this.__onMouseDown(p),this._resetTransformEventData();var m=this.upperCanvasEl,g=this._getEventPrefix();u(m,g+"move",this._onMouseMove,h),a(t.document,g+"up",this._onMouseUp),a(t.document,g+"move",this._onMouseMove,h)},_onTouchEnd:function(p){if(!(p.touches.length>0)){this.__onMouseUp(p),this._resetTransformEventData(),this.mainTouchId=null;var m=this._getEventPrefix();u(t.document,"touchend",this._onTouchEnd,h),u(t.document,"touchmove",this._onMouseMove,h);var g=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){a(g.upperCanvasEl,m+"down",g._onMouseDown),g._willAddMouseDown=0},400)}},_onMouseUp:function(p){this.__onMouseUp(p),this._resetTransformEventData();var m=this.upperCanvasEl,g=this._getEventPrefix();this._isMainEvent(p)&&(u(t.document,g+"up",this._onMouseUp),u(t.document,g+"move",this._onMouseMove,h),a(m,g+"move",this._onMouseMove,h))},_onMouseMove:function(p){!this.allowTouchScrolling&&p.preventDefault&&p.preventDefault(),this.__onMouseMove(p)},_onResize:function(){this.calcOffset()},_shouldRender:function(p){var m=this._activeObject;return!!m!=!!p||m&&p&&m!==p?!0:(m&&m.isEditing,!1)},__onMouseUp:function(p){var m,g=this._currentTransform,y=this._groupSelector,b=!1,x=!y||y.left===0&&y.top===0;if(this._cacheTransformEventData(p),m=this._target,this._handleEvent(p,"up:before"),d(p,l)){this.fireRightClick&&this._handleEvent(p,"up",l,x);return}if(d(p,c)){this.fireMiddleClick&&this._handleEvent(p,"up",c,x),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(p);return}if(this._isMainEvent(p)){if(g&&(this._finalizeCurrentTransform(p),b=g.actionPerformed),!x){var v=m===this._activeObject;this._maybeGroupObjects(p),b||(b=this._shouldRender(m)||!v&&m===this._activeObject)}var w,C;if(m){if(w=m._findTargetCorner(this.getPointer(p,!0),t.util.isTouchEvent(p)),m.selectable&&m!==this._activeObject&&m.activeOn==="up")this.setActiveObject(m,p),b=!0;else{var S=m.controls[w],_=S&&S.getMouseUpHandler(p,m,S);_&&(C=this.getPointer(p),_(p,g,C.x,C.y))}m.isMoving=!1}if(g&&(g.target!==m||g.corner!==w)){var $=g.target&&g.target.controls[g.corner],k=$&&$.getMouseUpHandler(p,m,S);C=C||this.getPointer(p),k&&k(p,g,C.x,C.y)}this._setCursorFromEvent(p,m),this._handleEvent(p,"up",f,x),this._groupSelector=null,this._currentTransform=null,m&&(m.__corner=0),b?this.requestRenderAll():x||this.renderTop()}},_simpleEventHandler:function(p,m){var g=this.findTarget(m),y=this.targets,b={e:m,target:g,subTargets:y};if(this.fire(p,b),g&&g.fire(p,b),!y)return g;for(var x=0;x<y.length;x++)y[x].fire(p,b);return g},_handleEvent:function(p,m,g,y){var b=this._target,x=this.targets||[],v={e:p,target:b,subTargets:x,button:g||f,isClick:y||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};m==="up"&&(v.currentTarget=this.findTarget(p),v.currentSubTargets=this.targets),this.fire("mouse:"+m,v),b&&b.fire("mouse"+m,v);for(var w=0;w<x.length;w++)x[w].fire("mouse"+m,v)},_finalizeCurrentTransform:function(p){var m=this._currentTransform,g=m.target,y={e:p,target:g,transform:m,action:m.action};g._scaling&&(g._scaling=!1),g.setCoords(),(m.actionPerformed||this.stateful&&g.hasStateChanged())&&this._fire("modified",y)},_onMouseDownInDrawingMode:function(p){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(p).requestRenderAll();var m=this.getPointer(p);this.freeDrawingBrush.onMouseDown(m,{e:p,pointer:m}),this._handleEvent(p,"down")},_onMouseMoveInDrawingMode:function(p){if(this._isCurrentlyDrawing){var m=this.getPointer(p);this.freeDrawingBrush.onMouseMove(m,{e:p,pointer:m})}this.setCursor(this.freeDrawingCursor),this._handleEvent(p,"move")},_onMouseUpInDrawingMode:function(p){var m=this.getPointer(p);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:p,pointer:m}),this._handleEvent(p,"up")},__onMouseDown:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"down:before");var m=this._target;if(d(p,l)){this.fireRightClick&&this._handleEvent(p,"down",l);return}if(d(p,c)){this.fireMiddleClick&&this._handleEvent(p,"down",c);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(p);return}if(this._isMainEvent(p)&&!this._currentTransform){var g=this._pointer;this._previousPointer=g;var y=this._shouldRender(m),b=this._shouldGroup(p,m);if(this._shouldClearSelection(p,m)?this.discardActiveObject(p):b&&(this._handleGrouping(p,m),m=this._activeObject),this.selection&&(!m||!m.selectable&&!m.isEditing&&m!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),m){var x=m===this._activeObject;m.selectable&&m.activeOn==="down"&&this.setActiveObject(m,p);var v=m._findTargetCorner(this.getPointer(p,!0),t.util.isTouchEvent(p));if(m.__corner=v,m===this._activeObject&&(v||!b)){this._setupCurrentTransform(p,m,x);var w=m.controls[v],g=this.getPointer(p),C=w&&w.getMouseDownHandler(p,m,w);C&&C(p,this._currentTransform,g.x,g.y)}}this._handleEvent(p,"down"),(y||b)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(p){this._resetTransformEventData(),this._pointer=this.getPointer(p,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(p)||null},_beforeTransform:function(p){var m=this._currentTransform;this.stateful&&m.target.saveState(),this.fire("before:transform",{e:p,transform:m})},__onMouseMove:function(p){this._handleEvent(p,"move:before"),this._cacheTransformEventData(p);var m,g;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(p);return}if(this._isMainEvent(p)){var y=this._groupSelector;y?(g=this._absolutePointer,y.left=g.x-y.ex,y.top=g.y-y.ey,this.renderTop()):this._currentTransform?this._transformObject(p):(m=this.findTarget(p)||null,this._setCursorFromEvent(p,m),this._fireOverOutEvents(m,p)),this._handleEvent(p,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(p,m){var g=this._hoveredTarget,y=this._hoveredTargets,b=this.targets,x=Math.max(y.length,b.length);this.fireSyntheticInOutEvents(p,m,{oldTarget:g,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var v=0;v<x;v++)this.fireSyntheticInOutEvents(b[v],m,{oldTarget:y[v],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=p,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(p,m){var g=this._draggedoverTarget,y=this._hoveredTargets,b=this.targets,x=Math.max(y.length,b.length);this.fireSyntheticInOutEvents(p,m,{oldTarget:g,evtOut:"dragleave",evtIn:"dragenter"});for(var v=0;v<x;v++)this.fireSyntheticInOutEvents(b[v],m,{oldTarget:y[v],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=p},fireSyntheticInOutEvents:function(p,m,g){var y,b,x=g.oldTarget,v,w,C=x!==p,S=g.canvasEvtIn,_=g.canvasEvtOut;C&&(y={e:m,target:p,previousTarget:x},b={e:m,target:x,nextTarget:p}),w=p&&C,v=x&&C,v&&(_&&this.fire(_,b),x.fire(g.evtOut,b)),w&&(S&&this.fire(S,y),p.fire(g.evtIn,y))},__onMouseWheel:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"wheel"),this._resetTransformEventData()},_transformObject:function(p){var m=this.getPointer(p),g=this._currentTransform;g.reset=!1,g.shiftKey=p.shiftKey,g.altKey=p[this.centeredKey],this._performTransformAction(p,g,m),g.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(p,m,g){var y=g.x,b=g.y,x=m.action,v=!1,w=m.actionHandler;w&&(v=w(p,m,y,b)),x==="drag"&&v&&(m.target.isMoving=!0,this.setCursor(m.target.moveCursor||this.moveCursor)),m.actionPerformed=m.actionPerformed||v},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(p,m){if(!m)return this.setCursor(this.defaultCursor),!1;var g=m.hoverCursor||this.hoverCursor,y=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,b=(!y||!y.contains(m))&&m._findTargetCorner(this.getPointer(p,!0));b?this.setCursor(this.getCornerCursor(b,m,p)):(m.subTargetCheck&&this.targets.concat().reverse().map(function(x){g=x.hoverCursor||g}),this.setCursor(g))},getCornerCursor:function(p,m,g){var y=m.controls[p];return y.cursorStyleHandler(g,y,m)}})}(),function(){var a=Math.min,u=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(l,c){var f=this._activeObject;return f&&this._isSelectionKeyPressed(l)&&c&&c.selectable&&this.selection&&(f!==c||f.type==="activeSelection")&&!c.onSelect({e:l})},_handleGrouping:function(l,c){var f=this._activeObject;f.__corner||c===f&&(c=this.findTarget(l,!0),!c||!c.selectable)||(f&&f.type==="activeSelection"?this._updateActiveSelection(c,l):this._createActiveSelection(c,l))},_updateActiveSelection:function(l,c){var f=this._activeObject,h=f._objects.slice(0);f.contains(l)?(f.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),f.size()===1&&this._setActiveObject(f.item(0),c)):(f.addWithUpdate(l),this._hoveredTarget=f,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(h,c)},_createActiveSelection:function(l,c){var f=this.getActiveObjects(),h=this._createGroup(l);this._hoveredTarget=h,this._setActiveObject(h,c),this._fireSelectionEvents(f,c)},_createGroup:function(l){var c=this._objects,f=c.indexOf(this._activeObject)<c.indexOf(l),h=f?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(h,{canvas:this})},_groupSelectedObjects:function(l){var c=this._collectObjects(l),f;c.length===1?this.setActiveObject(c[0],l):c.length>1&&(f=new t.ActiveSelection(c.reverse(),{canvas:this}),this.setActiveObject(f,l))},_collectObjects:function(l){for(var c=[],f,h=this._groupSelector.ex,d=this._groupSelector.ey,p=h+this._groupSelector.left,m=d+this._groupSelector.top,g=new t.Point(a(h,p),a(d,m)),y=new t.Point(u(h,p),u(d,m)),b=!this.selectionFullyContained,x=h===p&&d===m,v=this._objects.length;v--&&(f=this._objects[v],!(!(!f||!f.selectable||!f.visible)&&(b&&f.intersectsWithRect(g,y,!0)||f.isContainedWithinRect(g,y,!0)||b&&f.containsPoint(g,null,!0)||b&&f.containsPoint(y,null,!0))&&(c.push(f),x))););return c.length>1&&(c=c.filter(function(w){return!w.onSelect({e:l})})),c},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var u=a.format||"png",l=a.quality||1,c=(a.multiplier||1)*(a.enableRetinaScaling?this.getRetinaScaling():1),f=this.toCanvasElement(c,a);return t.util.toDataURL(f,u,l)},toCanvasElement:function(a,u){a=a||1,u=u||{};var l=(u.width||this.width)*a,c=(u.height||this.height)*a,f=this.getZoom(),h=this.width,d=this.height,p=f*a,m=this.viewportTransform,g=(m[4]-(u.left||0))*a,y=(m[5]-(u.top||0))*a,b=this.interactive,x=[p,0,0,p,g,y],v=this.enableRetinaScaling,w=t.util.createCanvasElement(),C=this.contextTop;return w.width=l,w.height=c,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=x,this.width=l,this.height=c,this.calcViewportBoundaries(),this.renderCanvas(w.getContext("2d"),this._objects),this.viewportTransform=m,this.width=h,this.height=d,this.calcViewportBoundaries(),this.interactive=b,this.enableRetinaScaling=v,this.contextTop=C,w}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(a,u,l){if(a){var c=typeof a=="string"?JSON.parse(a):t.util.object.clone(a),f=this,h=c.clipPath,d=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete c.clipPath,this._enlivenObjects(c.objects,function(p){f.clear(),f._setBgOverlay(c,function(){h?f._enlivenObjects([h],function(m){f.clipPath=m[0],f.__setupCanvas.call(f,c,p,d,u)}):f.__setupCanvas.call(f,c,p,d,u)})},l),this}},__setupCanvas:function(a,u,l,c){var f=this;u.forEach(function(h,d){f.insertAt(h,d)}),this.renderOnAddRemove=l,delete a.objects,delete a.backgroundImage,delete a.overlayImage,delete a.background,delete a.overlay,this._setOptions(a),this.renderAll(),c&&c()},_setBgOverlay:function(a,u){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!a.backgroundImage&&!a.overlayImage&&!a.background&&!a.overlay){u&&u();return}var c=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&u&&u()};this.__setBgOverlay("backgroundImage",a.backgroundImage,l,c),this.__setBgOverlay("overlayImage",a.overlayImage,l,c),this.__setBgOverlay("backgroundColor",a.background,l,c),this.__setBgOverlay("overlayColor",a.overlay,l,c)},__setBgOverlay:function(a,u,l,c){var f=this;if(!u){l[a]=!0,c&&c();return}a==="backgroundImage"||a==="overlayImage"?t.util.enlivenObjects([u],function(h){f[a]=h[0],l[a]=!0,c&&c()}):this["set"+t.util.string.capitalize(a,!0)](u,function(){l[a]=!0,c&&c()})},_enlivenObjects:function(a,u,l){if(!a||a.length===0){u&&u([]);return}t.util.enlivenObjects(a,function(c){u&&u(c)},null,l)},_toDataURL:function(a,u){this.clone(function(l){u(l.toDataURL(a))})},_toDataURLWithMultiplier:function(a,u,l){this.clone(function(c){l(c.toDataURLWithMultiplier(a,u))})},clone:function(a,u){var l=JSON.stringify(this.toJSON(u));this.cloneWithoutData(function(c){c.loadFromJSON(l,function(){a&&a(c)})})},cloneWithoutData:function(a){var u=t.util.createCanvasElement();u.width=this.width,u.height=this.height;var l=new t.Canvas(u);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),a&&a(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):a&&a(l)}}),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.extend,c=u.util.object.clone,f=u.util.toFixed,h=u.util.string.capitalize,d=u.util.degreesToRadians,p=!u.isLikelyNode,m=2;u.Object||(u.Object=u.util.createClass(u.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:p,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(g){g&&this.setOptions(g)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=u.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(g){var y=u.perfLimitSizeTotal,b=g.width,x=g.height,v=u.maxCacheSideLimit,w=u.minCacheSideLimit;if(b<=v&&x<=v&&b*x<=y)return b<w&&(g.width=w),x<w&&(g.height=w),g;var C=b/x,S=u.util.limitDimsByArea(C,y),_=u.util.capValue,$=_(w,S.x,v),k=_(w,S.y,v);return b>$&&(g.zoomX/=b/$,g.width=$,g.capped=!0),x>k&&(g.zoomY/=x/k,g.height=k,g.capped=!0),g},_getCacheCanvasDimensions:function(){var g=this.getTotalObjectScaling(),y=this._getTransformedDimensions(0,0),b=y.x*g.scaleX/this.scaleX,x=y.y*g.scaleY/this.scaleY;return{width:b+m,height:x+m,zoomX:g.scaleX,zoomY:g.scaleY,x:b,y:x}},_updateCacheCanvas:function(){var g=this.canvas;if(this.noScaleCache&&g&&g._currentTransform){var y=g._currentTransform.target,b=g._currentTransform.action;if(this===y&&b.slice&&b.slice(0,5)==="scale")return!1}var x=this._cacheCanvas,v=this._limitCacheSize(this._getCacheCanvasDimensions()),w=u.minCacheSideLimit,C=v.width,S=v.height,_,$,k=v.zoomX,E=v.zoomY,F=C!==this.cacheWidth||S!==this.cacheHeight,T=this.zoomX!==k||this.zoomY!==E,I=F||T,D=0,N=0,V=!1;if(F){var U=this._cacheCanvas.width,A=this._cacheCanvas.height,M=C>U||S>A,P=(C<U*.9||S<A*.9)&&U>w&&A>w;V=M||P,M&&!v.capped&&(C>w||S>w)&&(D=C*.1,N=S*.1)}return this instanceof u.Text&&this.path&&(I=!0,V=!0,D+=this.getHeightOfLine(0)*this.zoomX,N+=this.getHeightOfLine(0)*this.zoomY),I?(V?(x.width=Math.ceil(C+D),x.height=Math.ceil(S+N)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,x.width,x.height)),_=v.x/2,$=v.y/2,this.cacheTranslationX=Math.round(x.width/2-_)+_,this.cacheTranslationY=Math.round(x.height/2-$)+$,this.cacheWidth=C,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(k,E),this.zoomX=k,this.zoomY=E,!0):!1},setOptions:function(g){this._setOptions(g),this._initGradient(g.fill,"fill"),this._initGradient(g.stroke,"stroke"),this._initPattern(g.fill,"fill"),this._initPattern(g.stroke,"stroke")},transform:function(g){var y=this.group&&!this.group._transformDone||this.group&&this.canvas&&g===this.canvas.contextTop,b=this.calcTransformMatrix(!y);g.transform(b[0],b[1],b[2],b[3],b[4],b[5])},toObject:function(g){var y=u.Object.NUM_FRACTION_DIGITS,b={type:this.type,version:u.version,originX:this.originX,originY:this.originY,left:f(this.left,y),top:f(this.top,y),width:f(this.width,y),height:f(this.height,y),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:f(this.strokeWidth,y),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:f(this.strokeMiterLimit,y),scaleX:f(this.scaleX,y),scaleY:f(this.scaleY,y),angle:f(this.angle,y),flipX:this.flipX,flipY:this.flipY,opacity:f(this.opacity,y),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:f(this.skewX,y),skewY:f(this.skewY,y)};return this.clipPath&&!this.clipPath.excludeFromExport&&(b.clipPath=this.clipPath.toObject(g),b.clipPath.inverted=this.clipPath.inverted,b.clipPath.absolutePositioned=this.clipPath.absolutePositioned),u.util.populateWithProperties(this,b,g),this.includeDefaultValues||(b=this._removeDefaultValues(b)),b},toDatalessObject:function(g){return this.toObject(g)},_removeDefaultValues:function(g){var y=u.util.getKlass(g.type).prototype,b=y.stateProperties;return b.forEach(function(x){x==="left"||x==="top"||(g[x]===y[x]&&delete g[x],Array.isArray(g[x])&&Array.isArray(y[x])&&g[x].length===0&&y[x].length===0&&delete g[x])}),g},toString:function(){return"#<fabric."+h(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var g=u.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(g.scaleX),scaleY:Math.abs(g.scaleY)}},getTotalObjectScaling:function(){var g=this.getObjectScaling(),y=g.scaleX,b=g.scaleY;if(this.canvas){var x=this.canvas.getZoom(),v=this.canvas.getRetinaScaling();y*=x*v,b*=x*v}return{scaleX:y,scaleY:b}},getObjectOpacity:function(){var g=this.opacity;return this.group&&(g*=this.group.getObjectOpacity()),g},_set:function(g,y){var b=g==="scaleX"||g==="scaleY",x=this[g]!==y,v=!1;return b&&(y=this._constrainScale(y)),g==="scaleX"&&y<0?(this.flipX=!this.flipX,y*=-1):g==="scaleY"&&y<0?(this.flipY=!this.flipY,y*=-1):g==="shadow"&&y&&!(y instanceof u.Shadow)?y=new u.Shadow(y):g==="dirty"&&this.group&&this.group.set("dirty",y),this[g]=y,x&&(v=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(g)>-1?(this.dirty=!0,v&&this.group.set("dirty",!0)):v&&this.stateProperties.indexOf(g)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:u.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(g){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(g.save(),this._setupCompositeOperation(g),this.drawSelectionBackground(g),this.transform(g),this._setOpacity(g),this._setShadow(g,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(g)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(g),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),g.restore())},renderCache:function(g){g=g||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,g.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(g,y){if(g.save(),y.inverted?g.globalCompositeOperation="destination-out":g.globalCompositeOperation="destination-in",y.absolutePositioned){var b=u.util.invertTransform(this.calcTransformMatrix());g.transform(b[0],b[1],b[2],b[3],b[4],b[5])}y.transform(g),g.scale(1/y.zoomX,1/y.zoomY),g.drawImage(y._cacheCanvas,-y.cacheTranslationX,-y.cacheTranslationY),g.restore()},drawObject:function(g,y){var b=this.fill,x=this.stroke;y?(this.fill="black",this.stroke="",this._setClippingProperties(g)):this._renderBackground(g),this._render(g),this._drawClipPath(g,this.clipPath),this.fill=b,this.stroke=x},_drawClipPath:function(g,y){y&&(y.canvas=this.canvas,y.shouldCache(),y._transformDone=!0,y.renderCache({forClipping:!0}),this.drawClipPathOnCache(g,y))},drawCacheOnCanvas:function(g){g.scale(1/this.zoomX,1/this.zoomY),g.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(g){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!g&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!g){var y=this.cacheWidth/this.zoomX,b=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-y/2,-b/2,y,b)}return!0}return!1},_renderBackground:function(g){if(this.backgroundColor){var y=this._getNonTransformedDimensions();g.fillStyle=this.backgroundColor,g.fillRect(-y.x/2,-y.y/2,y.x,y.y),this._removeShadow(g)}},_setOpacity:function(g){this.group&&!this.group._transformDone?g.globalAlpha=this.getObjectOpacity():g.globalAlpha*=this.opacity},_setStrokeStyles:function(g,y){var b=y.stroke;b&&(g.lineWidth=y.strokeWidth,g.lineCap=y.strokeLineCap,g.lineDashOffset=y.strokeDashOffset,g.lineJoin=y.strokeLineJoin,g.miterLimit=y.strokeMiterLimit,b.toLive?b.gradientUnits==="percentage"||b.gradientTransform||b.patternTransform?this._applyPatternForTransformedGradient(g,b):(g.strokeStyle=b.toLive(g,this),this._applyPatternGradientTransform(g,b)):g.strokeStyle=y.stroke)},_setFillStyles:function(g,y){var b=y.fill;b&&(b.toLive?(g.fillStyle=b.toLive(g,this),this._applyPatternGradientTransform(g,y.fill)):g.fillStyle=b)},_setClippingProperties:function(g){g.globalAlpha=1,g.strokeStyle="transparent",g.fillStyle="#000000"},_setLineDash:function(g,y){!y||y.length===0||(1&y.length&&y.push.apply(y,y),g.setLineDash(y))},_renderControls:function(g,y){var b=this.getViewportTransform(),x=this.calcTransformMatrix(),v,w,C;y=y||{},w=typeof y.hasBorders<"u"?y.hasBorders:this.hasBorders,C=typeof y.hasControls<"u"?y.hasControls:this.hasControls,x=u.util.multiplyTransformMatrices(b,x),v=u.util.qrDecompose(x),g.save(),g.translate(v.translateX,v.translateY),g.lineWidth=1*this.borderScaleFactor,this.group||(g.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(v.angle-=180),g.rotate(d(this.group?v.angle:this.angle)),y.forActiveSelection||this.group?w&&this.drawBordersInGroup(g,v,y):w&&this.drawBorders(g,y),C&&this.drawControls(g,y),g.restore()},_setShadow:function(g){if(this.shadow){var y=this.shadow,b=this.canvas,x,v=b&&b.viewportTransform[0]||1,w=b&&b.viewportTransform[3]||1;y.nonScaling?x={scaleX:1,scaleY:1}:x=this.getObjectScaling(),b&&b._isRetinaScaling()&&(v*=u.devicePixelRatio,w*=u.devicePixelRatio),g.shadowColor=y.color,g.shadowBlur=y.blur*u.browserShadowBlurConstant*(v+w)*(x.scaleX+x.scaleY)/4,g.shadowOffsetX=y.offsetX*v*x.scaleX,g.shadowOffsetY=y.offsetY*w*x.scaleY}},_removeShadow:function(g){this.shadow&&(g.shadowColor="",g.shadowBlur=g.shadowOffsetX=g.shadowOffsetY=0)},_applyPatternGradientTransform:function(g,y){if(!y||!y.toLive)return{offsetX:0,offsetY:0};var b=y.gradientTransform||y.patternTransform,x=-this.width/2+y.offsetX||0,v=-this.height/2+y.offsetY||0;return y.gradientUnits==="percentage"?g.transform(this.width,0,0,this.height,x,v):g.transform(1,0,0,1,x,v),b&&g.transform(b[0],b[1],b[2],b[3],b[4],b[5]),{offsetX:x,offsetY:v}},_renderPaintInOrder:function(g){this.paintFirst==="stroke"?(this._renderStroke(g),this._renderFill(g)):(this._renderFill(g),this._renderStroke(g))},_render:function(){},_renderFill:function(g){this.fill&&(g.save(),this._setFillStyles(g,this),this.fillRule==="evenodd"?g.fill("evenodd"):g.fill(),g.restore())},_renderStroke:function(g){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(g),g.save(),this.strokeUniform&&this.group){var y=this.getObjectScaling();g.scale(1/y.scaleX,1/y.scaleY)}else this.strokeUniform&&g.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(g,this.strokeDashArray),this._setStrokeStyles(g,this),g.stroke(),g.restore()}},_applyPatternForTransformedGradient:function(g,y){var b=this._limitCacheSize(this._getCacheCanvasDimensions()),x=u.util.createCanvasElement(),v,w=this.canvas.getRetinaScaling(),C=b.x/this.scaleX/w,S=b.y/this.scaleY/w;x.width=C,x.height=S,v=x.getContext("2d"),v.beginPath(),v.moveTo(0,0),v.lineTo(C,0),v.lineTo(C,S),v.lineTo(0,S),v.closePath(),v.translate(C/2,S/2),v.scale(b.zoomX/this.scaleX/w,b.zoomY/this.scaleY/w),this._applyPatternGradientTransform(v,y),v.fillStyle=y.toLive(g),v.fill(),g.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),g.scale(w*this.scaleX/b.zoomX,w*this.scaleY/b.zoomY),g.strokeStyle=v.createPattern(x,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var g=u.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",g.scaleX),this.set("scaleY",g.scaleY),this.angle=g.angle,this.skewX=g.skewX,this.skewY=0}},_removeTransformMatrix:function(g){var y=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),y=u.util.transformPoint(y,this.transformMatrix)),this.transformMatrix=null,g&&(this.scaleX*=g.scaleX,this.scaleY*=g.scaleY,this.cropX=g.cropX,this.cropY=g.cropY,y.x+=g.offsetLeft,y.y+=g.offsetTop,this.width=g.width,this.height=g.height),this.setPositionByOrigin(y,"center","center")},clone:function(g,y){var b=this.toObject(y);this.constructor.fromObject?this.constructor.fromObject(b,g):u.Object._fromObject("Object",b,g)},cloneAsImage:function(g,y){var b=this.toCanvasElement(y);return g&&g(new u.Image(b)),this},toCanvasElement:function(g){g||(g={});var y=u.util,b=y.saveObjectTransform(this),x=this.group,v=this.shadow,w=Math.abs,C=(g.multiplier||1)*(g.enableRetinaScaling?u.devicePixelRatio:1);delete this.group,g.withoutTransform&&y.resetObjectTransform(this),g.withoutShadow&&(this.shadow=null);var S=u.util.createCanvasElement(),_=this.getBoundingRect(!0,!0),$=this.shadow,k,E={x:0,y:0},F,T,I;$&&(F=$.blur,$.nonScaling?k={scaleX:1,scaleY:1}:k=this.getObjectScaling(),E.x=2*Math.round(w($.offsetX)+F)*w(k.scaleX),E.y=2*Math.round(w($.offsetY)+F)*w(k.scaleY)),T=_.width+E.x,I=_.height+E.y,S.width=Math.ceil(T),S.height=Math.ceil(I);var D=new u.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});g.format==="jpeg"&&(D.backgroundColor="#fff"),this.setPositionByOrigin(new u.Point(D.width/2,D.height/2),"center","center");var N=this.canvas;D.add(this);var V=D.toCanvasElement(C||1,g);return this.shadow=v,this.set("canvas",N),x&&(this.group=x),this.set(b).setCoords(),D._objects=[],D.dispose(),D=null,V},toDataURL:function(g){return g||(g={}),u.util.toDataURL(this.toCanvasElement(g),g.format||"png",g.quality||1)},isType:function(g){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===g},complexity:function(){return 1},toJSON:function(g){return this.toObject(g)},rotate:function(g){var y=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return y&&this._setOriginToCenter(),this.set("angle",g),y&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(g,y){y=y||this.canvas.getPointer(g);var b=new u.Point(y.x,y.y),x=this._getLeftTopCoords();return this.angle&&(b=u.util.rotatePoint(b,x,d(-this.angle))),{x:b.x-x.x,y:b.y-x.y}},_setupCompositeOperation:function(g){this.globalCompositeOperation&&(g.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){u.runningAnimations&&u.runningAnimations.cancelByTarget(this)}}),u.util.createAccessors&&u.util.createAccessors(u.Object),l(u.Object.prototype,u.Observable),u.Object.NUM_FRACTION_DIGITS=2,u.Object.ENLIVEN_PROPS=["clipPath"],u.Object._fromObject=function(g,y,b,x){var v=u[g];y=c(y,!0),u.util.enlivenPatterns([y.fill,y.stroke],function(w){typeof w[0]<"u"&&(y.fill=w[0]),typeof w[1]<"u"&&(y.stroke=w[1]),u.util.enlivenObjectEnlivables(y,y,function(){var C=x?new v(y[x],y):new v(y);b&&b(C)})})},u.Object.__uid=0)}(e),function(){var a=t.util.degreesToRadians,u={left:-.5,center:0,right:.5},l={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(c,f,h,d,p){var m=c.x,g=c.y,y,b,x;return typeof f=="string"?f=u[f]:f-=.5,typeof d=="string"?d=u[d]:d-=.5,y=d-f,typeof h=="string"?h=l[h]:h-=.5,typeof p=="string"?p=l[p]:p-=.5,b=p-h,(y||b)&&(x=this._getTransformedDimensions(),m=c.x+y*x.x,g=c.y+b*x.y),new t.Point(m,g)},translateToCenterPoint:function(c,f,h){var d=this.translateToGivenOrigin(c,f,h,"center","center");return this.angle?t.util.rotatePoint(d,c,a(this.angle)):d},translateToOriginPoint:function(c,f,h){var d=this.translateToGivenOrigin(c,"center","center",f,h);return this.angle?t.util.rotatePoint(d,c,a(this.angle)):d},getCenterPoint:function(){var c=new t.Point(this.left,this.top);return this.translateToCenterPoint(c,this.originX,this.originY)},getPointByOrigin:function(c,f){var h=this.getCenterPoint();return this.translateToOriginPoint(h,c,f)},toLocalPoint:function(c,f,h){var d=this.getCenterPoint(),p,m;return typeof f<"u"&&typeof h<"u"?p=this.translateToGivenOrigin(d,"center","center",f,h):p=new t.Point(this.left,this.top),m=new t.Point(c.x,c.y),this.angle&&(m=t.util.rotatePoint(m,d,-a(this.angle))),m.subtractEquals(p)},setPositionByOrigin:function(c,f,h){var d=this.translateToCenterPoint(c,f,h),p=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",p.x),this.set("top",p.y)},adjustPosition:function(c){var f=a(this.angle),h=this.getScaledWidth(),d=t.util.cos(f)*h,p=t.util.sin(f)*h,m,g;typeof this.originX=="string"?m=u[this.originX]:m=this.originX-.5,typeof c=="string"?g=u[c]:g=c-.5,this.left+=d*(g-m),this.top+=p*(g-m),this.setCoords(),this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var c=this.getCenterPoint();this.originX="center",this.originY="center",this.left=c.x,this.top=c.y},_resetOrigin:function(){var c=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=c.x,this.top=c.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function a(h){return[new t.Point(h.tl.x,h.tl.y),new t.Point(h.tr.x,h.tr.y),new t.Point(h.br.x,h.br.y),new t.Point(h.bl.x,h.bl.y)]}var u=t.util,l=u.degreesToRadians,c=u.multiplyTransformMatrices,f=u.transformPoint;u.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(h,d){return d?h?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),h?this.aCoords:this.lineCoords)},getCoords:function(h,d){return a(this._getCoords(h,d))},intersectsWithRect:function(h,d,p,m){var g=this.getCoords(p,m),y=t.Intersection.intersectPolygonRectangle(g,h,d);return y.status==="Intersection"},intersectsWithObject:function(h,d,p){var m=t.Intersection.intersectPolygonPolygon(this.getCoords(d,p),h.getCoords(d,p));return m.status==="Intersection"||h.isContainedWithinObject(this,d,p)||this.isContainedWithinObject(h,d,p)},isContainedWithinObject:function(h,d,p){for(var m=this.getCoords(d,p),g=d?h.aCoords:h.lineCoords,y=0,b=h._getImageLines(g);y<4;y++)if(!h.containsPoint(m[y],b))return!1;return!0},isContainedWithinRect:function(h,d,p,m){var g=this.getBoundingRect(p,m);return g.left>=h.x&&g.left+g.width<=d.x&&g.top>=h.y&&g.top+g.height<=d.y},containsPoint:function(h,y,p,m){var g=this._getCoords(p,m),y=y||this._getImageLines(g),b=this._findCrossPoints(h,y);return b!==0&&b%2===1},isOnScreen:function(h){if(!this.canvas)return!1;var d=this.canvas.vptCoords.tl,p=this.canvas.vptCoords.br,m=this.getCoords(!0,h);return m.some(function(g){return g.x<=p.x&&g.x>=d.x&&g.y<=p.y&&g.y>=d.y})||this.intersectsWithRect(d,p,!0,h)?!0:this._containsCenterOfCanvas(d,p,h)},_containsCenterOfCanvas:function(h,d,p){var m={x:(h.x+d.x)/2,y:(h.y+d.y)/2};return!!this.containsPoint(m,null,!0,p)},isPartiallyOnScreen:function(h){if(!this.canvas)return!1;var d=this.canvas.vptCoords.tl,p=this.canvas.vptCoords.br;if(this.intersectsWithRect(d,p,!0,h))return!0;var m=this.getCoords(!0,h).every(function(g){return(g.x>=p.x||g.x<=d.x)&&(g.y>=p.y||g.y<=d.y)});return m&&this._containsCenterOfCanvas(d,p,h)},_getImageLines:function(h){var d={topline:{o:h.tl,d:h.tr},rightline:{o:h.tr,d:h.br},bottomline:{o:h.br,d:h.bl},leftline:{o:h.bl,d:h.tl}};return d},_findCrossPoints:function(h,d){var p,m,g,y,b,x=0,v;for(var w in d)if(v=d[w],!(v.o.y<h.y&&v.d.y<h.y)&&!(v.o.y>=h.y&&v.d.y>=h.y)&&(v.o.x===v.d.x&&v.o.x>=h.x?b=v.o.x:(p=0,m=(v.d.y-v.o.y)/(v.d.x-v.o.x),g=h.y-p*h.x,y=v.o.y-m*v.o.x,b=-(g-y)/(p-m)),b>=h.x&&(x+=1),x===2))break;return x},getBoundingRect:function(h,d){var p=this.getCoords(h,d);return u.makeBoundingBoxFromPoints(p)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(h){return Math.abs(h)<this.minScaleLimit?h<0?-this.minScaleLimit:this.minScaleLimit:h===0?1e-4:h},scale:function(h){return this._set("scaleX",h),this._set("scaleY",h),this.setCoords()},scaleToWidth:function(h,d){var p=this.getBoundingRect(d).width/this.getScaledWidth();return this.scale(h/this.width/p)},scaleToHeight:function(h,d){var p=this.getBoundingRect(d).height/this.getScaledHeight();return this.scale(h/this.height/p)},calcLineCoords:function(){var h=this.getViewportTransform(),d=this.padding,p=l(this.angle),m=u.cos(p),g=u.sin(p),y=m*d,b=g*d,x=y+b,v=y-b,w=this.calcACoords(),C={tl:f(w.tl,h),tr:f(w.tr,h),bl:f(w.bl,h),br:f(w.br,h)};return d&&(C.tl.x-=v,C.tl.y-=x,C.tr.x+=x,C.tr.y-=v,C.bl.x-=x,C.bl.y+=v,C.br.x+=v,C.br.y+=x),C},calcOCoords:function(){var h=this._calcRotateMatrix(),d=this._calcTranslateMatrix(),p=this.getViewportTransform(),m=c(p,d),g=c(m,h),g=c(g,[1/p[0],0,0,1/p[3],0,0]),y=this._calculateCurrentDimensions(),b={};return this.forEachControl(function(x,v,w){b[v]=x.positionHandler(y,g,w)}),b},calcACoords:function(){var h=this._calcRotateMatrix(),d=this._calcTranslateMatrix(),p=c(d,h),m=this._getTransformedDimensions(),g=m.x/2,y=m.y/2;return{tl:f({x:-g,y:-y},p),tr:f({x:g,y:-y},p),bl:f({x:-g,y},p),br:f({x:g,y},p)}},setCoords:function(h){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),h?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return u.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var h=this.getCenterPoint();return[1,0,0,1,h.x,h.y]},transformMatrixKey:function(h){var d="_",p="";return!h&&this.group&&(p=this.group.transformMatrixKey(h)+d),p+this.top+d+this.left+d+this.scaleX+d+this.scaleY+d+this.skewX+d+this.skewY+d+this.angle+d+this.originX+d+this.originY+d+this.width+d+this.height+d+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(h){var d=this.calcOwnMatrix();if(h||!this.group)return d;var p=this.transformMatrixKey(h),m=this.matrixCache||(this.matrixCache={});return m.key===p?m.value:(this.group&&(d=c(this.group.calcTransformMatrix(!1),d)),m.key=p,m.value=d,d)},calcOwnMatrix:function(){var h=this.transformMatrixKey(!0),d=this.ownMatrixCache||(this.ownMatrixCache={});if(d.key===h)return d.value;var p=this._calcTranslateMatrix(),m={angle:this.angle,translateX:p[4],translateY:p[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return d.key=h,d.value=u.composeMatrix(m),d.value},_getNonTransformedDimensions:function(){var h=this.strokeWidth,d=this.width+h,p=this.height+h;return{x:d,y:p}},_getTransformedDimensions:function(h,d){typeof h>"u"&&(h=this.skewX),typeof d>"u"&&(d=this.skewY);var p,m,g,y=h===0&&d===0;if(this.strokeUniform?(m=this.width,g=this.height):(p=this._getNonTransformedDimensions(),m=p.x,g=p.y),y)return this._finalizeDimensions(m*this.scaleX,g*this.scaleY);var b=u.sizeAfterTransform(m,g,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:h,skewY:d});return this._finalizeDimensions(b.x,b.y)},_finalizeDimensions:function(h,d){return this.strokeUniform?{x:h+this.strokeWidth,y:d+this.strokeWidth}:{x:h,y:d}},_calculateCurrentDimensions:function(){var h=this.getViewportTransform(),d=this._getTransformedDimensions(),p=f(d,h,!0);return p.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas&&this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas&&this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas&&this.canvas.moveTo(this,a),this}}),function(){function a(l,c){if(c){if(c.toLive)return l+": url(#SVGID_"+c.id+"); ";var f=new t.Color(c),h=l+": "+f.toRgb()+"; ",d=f.getAlpha();return d!==1&&(h+=l+"-opacity: "+d.toString()+"; "),h}else return l+": none; "}var u=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(l){var c=this.fillRule?this.fillRule:"nonzero",f=this.strokeWidth?this.strokeWidth:"0",h=this.strokeDashArray?this.strokeDashArray.join(" "):"none",d=this.strokeDashOffset?this.strokeDashOffset:"0",p=this.strokeLineCap?this.strokeLineCap:"butt",m=this.strokeLineJoin?this.strokeLineJoin:"miter",g=this.strokeMiterLimit?this.strokeMiterLimit:"4",y=typeof this.opacity<"u"?this.opacity:"1",b=this.visible?"":" visibility: hidden;",x=l?"":this.getSvgFilter(),v=a("fill",this.fill),w=a("stroke",this.stroke);return[w,"stroke-width: ",f,"; ","stroke-dasharray: ",h,"; ","stroke-linecap: ",p,"; ","stroke-dashoffset: ",d,"; ","stroke-linejoin: ",m,"; ","stroke-miterlimit: ",g,"; ",v,"fill-rule: ",c,"; ","opacity: ",y,";",x,b].join("")},getSvgSpanStyles:function(l,c){var f="; ",d=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+f:"",h=l.strokeWidth?"stroke-width: "+l.strokeWidth+f:"",d=d,p=l.fontSize?"font-size: "+l.fontSize+"px"+f:"",m=l.fontStyle?"font-style: "+l.fontStyle+f:"",g=l.fontWeight?"font-weight: "+l.fontWeight+f:"",y=l.fill?a("fill",l.fill):"",b=l.stroke?a("stroke",l.stroke):"",x=this.getSvgTextDecoration(l),v=l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"";return x&&(x="text-decoration: "+x+f),[b,h,d,p,m,g,x,y,v,c?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(c){return l[c.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,c){var f=l?this.calcTransformMatrix():this.calcOwnMatrix(),h='transform="'+t.util.matrixToSVG(f);return h+(c||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var c=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',u(-this.width/2,c),'" y="',u(-this.height/2,c),'" width="',u(this.width,c),'" height="',u(this.height,c),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,c){c=c||{};var f=c.reviver,h=c.additionalTransform||"",d=[this.getSvgTransform(!0,h),this.getSvgCommons()].join(""),p=l.indexOf("COMMON_PARTS");return l[p]=d,f?f(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,c){c=c||{};var f=c.noStyle,h=c.reviver,d=f?"":'style="'+this.getSvgStyles()+'" ',p=c.withShadow?'style="'+this.getSvgFilter()+'" ':"",m=this.clipPath,g=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",y=m&&m.absolutePositioned,b=this.stroke,x=this.fill,v=this.shadow,w,C=[],S,_=l.indexOf("COMMON_PARTS"),$=c.additionalTransform;return m&&(m.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+m.clipPathId+`" >
`+m.toClipPathSVG(h)+`</clipPath>
`),y&&C.push("<g ",p,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),y?"":p+this.getSvgCommons(),` >
`),w=[d,g,f?"":this.addPaintOrder()," ",$?'transform="'+$+'" ':""].join(""),l[_]=w,x&&x.toLive&&C.push(x.toSVG(this)),b&&b.toLive&&C.push(b.toSVG(this)),v&&C.push(v.toSVG(this)),m&&C.push(S),C.push(l.join("")),C.push(`</g>
`),y&&C.push(`</g>
`),h?h(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var a=t.util.object.extend,u="stateProperties";function l(f,h,d){var p={},m=!0;d.forEach(function(g){p[g]=f[g]}),a(f[h],p,m)}function c(f,h,d){if(f===h)return!0;if(Array.isArray(f)){if(!Array.isArray(h)||f.length!==h.length)return!1;for(var p=0,m=f.length;p<m;p++)if(!c(f[p],h[p]))return!1;return!0}else if(f&&typeof f=="object"){var g=Object.keys(f),y;if(!h||typeof h!="object"||!d&&g.length!==Object.keys(h).length)return!1;for(var p=0,m=g.length;p<m;p++)if(y=g[p],!(y==="canvas"||y==="group")&&!c(f[y],h[y]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(f){f=f||u;var h="_"+f;return Object.keys(this[h]).length<this[f].length?!0:!c(this[h],this,!0)},saveState:function(f){var h=f&&f.propertySet||u,d="_"+h;return this[d]?(l(this,d,this[h]),f&&f.stateProperties&&l(this,d,f.stateProperties),this):this.setupState(f)},setupState:function(f){f=f||{};var h=f.propertySet||u;return f.propertySet=h,this["_"+h]={},this.saveState(f),this}})}(),function(){var a=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(u,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var c=u.x,f=u.y,h,d,p=Object.keys(this.oCoords),m=p.length-1,g;for(this.__corner=0;m>=0;m--)if(g=p[m],!!this.isControlVisible(g)&&(d=this._getImageLines(l?this.oCoords[g].touchCorner:this.oCoords[g].corner),h=this._findCrossPoints({x:c,y:f},d),h!==0&&h%2===1))return this.__corner=g,g;return!1},forEachControl:function(u){for(var l in this.controls)u(this.controls[l],l,this)},_setCornerCoords:function(){var u=this.oCoords;for(var l in u){var c=this.controls[l];u[l].corner=c.calcCornerCoords(this.angle,this.cornerSize,u[l].x,u[l].y,!1),u[l].touchCorner=c.calcCornerCoords(this.angle,this.touchCornerSize,u[l].x,u[l].y,!0)}},drawSelectionBackground:function(u){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;u.save();var l=this.getCenterPoint(),c=this._calculateCurrentDimensions(),f=this.canvas.viewportTransform;return u.translate(l.x,l.y),u.scale(1/f[0],1/f[3]),u.rotate(a(this.angle)),u.fillStyle=this.selectionBackgroundColor,u.fillRect(-c.x/2,-c.y/2,c.x,c.y),u.restore(),this},drawBorders:function(u,l){l=l||{};var c=this._calculateCurrentDimensions(),f=this.borderScaleFactor,h=c.x+f,d=c.y+f,p=typeof l.hasControls<"u"?l.hasControls:this.hasControls,m=!1;return u.save(),u.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(u,l.borderDashArray||this.borderDashArray),u.strokeRect(-h/2,-d/2,h,d),p&&(u.beginPath(),this.forEachControl(function(g,y,b){g.withConnection&&g.getVisibility(b,y)&&(m=!0,u.moveTo(g.x*h,g.y*d),u.lineTo(g.x*h+g.offsetX,g.y*d+g.offsetY))}),m&&u.stroke()),u.restore(),this},drawBordersInGroup:function(u,l,c){c=c||{};var f=t.util.sizeAfterTransform(this.width,this.height,l),h=this.strokeWidth,d=this.strokeUniform,p=this.borderScaleFactor,m=f.x+h*(d?this.canvas.getZoom():l.scaleX)+p,g=f.y+h*(d?this.canvas.getZoom():l.scaleY)+p;return u.save(),this._setLineDash(u,c.borderDashArray||this.borderDashArray),u.strokeStyle=c.borderColor||this.borderColor,u.strokeRect(-m/2,-g/2,m,g),u.restore(),this},drawControls:function(u,l){l=l||{},u.save();var c=this.canvas.getRetinaScaling(),f,h;return u.setTransform(c,0,0,c,0,0),u.strokeStyle=u.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(u.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(u,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(f=this.group.calcTransformMatrix()),this.forEachControl(function(d,p,m){h=m.oCoords[p],d.getVisibility(m,p)&&(f&&(h=t.util.transformPoint(h,f)),d.render(u,h.x,h.y,l,m))}),u.restore(),this},isControlVisible:function(u){return this.controls[u]&&this.controls[u].getVisibility(this,u)},setControlVisible:function(u,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[u]=l,this},setControlsVisibility:function(u){u||(u={});for(var l in u)this.setControlVisible(l,u[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,u){u=u||{};var l=function(){},c=u.onComplete||l,f=u.onChange||l,h=this;return t.util.animate({target:this,startValue:a.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(d){a.set("left",d),h.requestRenderAll(),f()},onComplete:function(){a.setCoords(),c()}})},fxCenterObjectV:function(a,u){u=u||{};var l=function(){},c=u.onComplete||l,f=u.onChange||l,h=this;return t.util.animate({target:this,startValue:a.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(d){a.set("top",d),h.requestRenderAll(),f()},onComplete:function(){a.setCoords(),c()}})},fxRemove:function(a,u){u=u||{};var l=function(){},c=u.onComplete||l,f=u.onChange||l,h=this;return t.util.animate({target:this,startValue:a.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(d){a.set("opacity",d),h.requestRenderAll(),f()},onComplete:function(){h.remove(a),c()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var a=[],u,l,c=[];for(u in arguments[0])a.push(u);for(var f=0,h=a.length;f<h;f++)u=a[f],l=f!==h-1,c.push(this._animate(u,arguments[0][u],arguments[1],l));return c}else return this._animate.apply(this,arguments)},_animate:function(a,u,l,c){var f=this,h;u=u.toString(),l?l=t.util.object.clone(l):l={},~a.indexOf(".")&&(h=a.split("."));var d=f.colorProperties.indexOf(a)>-1||h&&f.colorProperties.indexOf(h[1])>-1,p=h?this.get(h[0])[h[1]]:this.get(a);"from"in l||(l.from=p),d||(~u.indexOf("=")?u=p+parseFloat(u.replace("=","")):u=parseFloat(u));var m={target:this,startValue:l.from,endValue:u,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(g,y,b){return l.abort.call(f,g,y,b)},onChange:function(g,y,b){h?f[h[0]][h[1]]=g:f.set(a,g),!c&&l.onChange&&l.onChange(g,y,b)},onComplete:function(g,y,b){c||(f.setCoords(),l.onComplete&&l.onComplete(g,y,b))}};return d?t.util.animateColor(m.startValue,m.endValue,m.duration,m):t.util.animate(m)}}),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.extend,c=u.util.object.clone,f={x1:1,x2:1,y1:1,y2:1};if(u.Line){u.warn("fabric.Line is already defined");return}u.Line=u.util.createClass(u.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:u.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(d,p){d||(d=[0,0,0,0]),this.callSuper("initialize",p),this.set("x1",d[0]),this.set("y1",d[1]),this.set("x2",d[2]),this.set("y2",d[3]),this._setWidthHeight(p)},_setWidthHeight:function(d){d||(d={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in d?d.left:this._getLeftToOriginX(),this.top="top"in d?d.top:this._getTopToOriginY()},_set:function(d,p){return this.callSuper("_set",d,p),typeof f[d]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:h({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:h({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(d){d.beginPath();var p=this.calcLinePoints();d.moveTo(p.x1,p.y1),d.lineTo(p.x2,p.y2),d.lineWidth=this.strokeWidth;var m=d.strokeStyle;d.strokeStyle=this.stroke||d.fillStyle,this.stroke&&this._renderStroke(d),d.strokeStyle=m},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(d){return l(this.callSuper("toObject",d),this.calcLinePoints())},_getNonTransformedDimensions:function(){var d=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(d.y-=this.strokeWidth),this.height===0&&(d.x-=this.strokeWidth)),d},calcLinePoints:function(){var d=this.x1<=this.x2?-1:1,p=this.y1<=this.y2?-1:1,m=d*this.width*.5,g=p*this.height*.5,y=d*this.width*-.5,b=p*this.height*-.5;return{x1:m,x2:y,y1:g,y2:b}},_toSVG:function(){var d=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,`" />
`]}}),u.Line.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),u.Line.fromElement=function(d,p,m){m=m||{};var g=u.parseAttributes(d,u.Line.ATTRIBUTE_NAMES),y=[g.x1||0,g.y1||0,g.x2||0,g.y2||0];p(new u.Line(y,l(g,m)))},u.Line.fromObject=function(d,p){function m(y){delete y.points,p&&p(y)}var g=c(d,!0);g.points=[d.x1,d.y1,d.x2,d.y2],u.Object._fromObject("Line",g,m,"points")};function h(d,p){var m=d.origin,g=d.axis1,y=d.axis2,b=d.dimension,x=p.nearest,v=p.center,w=p.farthest;return function(){switch(this.get(m)){case x:return Math.min(this.get(g),this.get(y));case v:return Math.min(this.get(g),this.get(y))+.5*this.get(b);case w:return Math.max(this.get(g),this.get(y))}}}}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.degreesToRadians;if(u.Circle){u.warn("fabric.Circle is already defined.");return}u.Circle=u.util.createClass(u.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:u.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(f,h){return this.callSuper("_set",f,h),f==="radius"&&this.setRadius(h),this},toObject:function(f){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(f))},_toSVG:function(){var f,h=0,d=0,p=(this.endAngle-this.startAngle)%360;if(p===0)f=["<circle ","COMMON_PARTS",'cx="'+h+'" cy="'+d+'" ','r="',this.radius,`" />
`];else{var m=l(this.startAngle),g=l(this.endAngle),y=this.radius,b=u.util.cos(m)*y,x=u.util.sin(m)*y,v=u.util.cos(g)*y,w=u.util.sin(g)*y,C=p>180?"1":"0";f=['<path d="M '+b+" "+x," A "+y+" "+y," 0 ",+C+" 1"," "+v+" "+w,'" ',"COMMON_PARTS",` />
`]}return f},_render:function(f){f.beginPath(),f.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(f)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){return this.radius=f,this.set("width",f*2).set("height",f*2)}}),u.Circle.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),u.Circle.fromElement=function(f,h){var d=u.parseAttributes(f,u.Circle.ATTRIBUTE_NAMES);if(!c(d))throw new Error("value of `r` attribute is required and can not be negative");d.left=(d.left||0)-d.radius,d.top=(d.top||0)-d.radius,h(new u.Circle(d))};function c(f){return"radius"in f&&f.radius>=0}u.Circle.fromObject=function(f,h){u.Object._fromObject("Circle",f,h)}}(e),function(a){var u=a.fabric||(a.fabric={});if(u.Triangle){u.warn("fabric.Triangle is already defined");return}u.Triangle=u.util.createClass(u.Object,{type:"triangle",width:100,height:100,_render:function(l){var c=this.width/2,f=this.height/2;l.beginPath(),l.moveTo(-c,f),l.lineTo(0,-f),l.lineTo(c,f),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,c=this.height/2,f=[-l+" "+c,"0 "+-c,l+" "+c].join(",");return["<polygon ","COMMON_PARTS",'points="',f,'" />']}}),u.Triangle.fromObject=function(l,c){return u.Object._fromObject("Triangle",l,c)}}(e),function(a){var u=a.fabric||(a.fabric={}),l=Math.PI*2;if(u.Ellipse){u.warn("fabric.Ellipse is already defined.");return}u.Ellipse=u.util.createClass(u.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:u.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(c){this.callSuper("initialize",c),this.set("rx",c&&c.rx||0),this.set("ry",c&&c.ry||0)},_set:function(c,f){switch(this.callSuper("_set",c,f),c){case"rx":this.rx=f,this.set("width",f*2);break;case"ry":this.ry=f,this.set("height",f*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(c){return this.callSuper("toObject",["rx","ry"].concat(c))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(c){c.beginPath(),c.save(),c.transform(1,0,0,this.ry/this.rx,0,0),c.arc(0,0,this.rx,0,l,!1),c.restore(),this._renderPaintInOrder(c)}}),u.Ellipse.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),u.Ellipse.fromElement=function(c,f){var h=u.parseAttributes(c,u.Ellipse.ATTRIBUTE_NAMES);h.left=(h.left||0)-h.rx,h.top=(h.top||0)-h.ry,f(new u.Ellipse(h))},u.Ellipse.fromObject=function(c,f){u.Object._fromObject("Ellipse",c,f)}}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.extend;if(u.Rect){u.warn("fabric.Rect is already defined");return}u.Rect=u.util.createClass(u.Object,{stateProperties:u.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:u.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(c){this.callSuper("initialize",c),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(c){var f=this.rx?Math.min(this.rx,this.width/2):0,h=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,p=this.height,m=-this.width/2,g=-this.height/2,y=f!==0||h!==0,b=1-.5522847498;c.beginPath(),c.moveTo(m+f,g),c.lineTo(m+d-f,g),y&&c.bezierCurveTo(m+d-b*f,g,m+d,g+b*h,m+d,g+h),c.lineTo(m+d,g+p-h),y&&c.bezierCurveTo(m+d,g+p-b*h,m+d-b*f,g+p,m+d-f,g+p),c.lineTo(m+f,g+p),y&&c.bezierCurveTo(m+b*f,g+p,m,g+p-b*h,m,g+p-h),c.lineTo(m,g+h),y&&c.bezierCurveTo(m,g+b*h,m+b*f,g,m+f,g),c.closePath(),this._renderPaintInOrder(c)},toObject:function(c){return this.callSuper("toObject",["rx","ry"].concat(c))},_toSVG:function(){var c=-this.width/2,f=-this.height/2;return["<rect ","COMMON_PARTS",'x="',c,'" y="',f,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),u.Rect.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),u.Rect.fromElement=function(c,f,h){if(!c)return f(null);h=h||{};var d=u.parseAttributes(c,u.Rect.ATTRIBUTE_NAMES);d.left=d.left||0,d.top=d.top||0,d.height=d.height||0,d.width=d.width||0;var p=new u.Rect(l(h?u.util.object.clone(h):{},d));p.visible=p.visible&&p.width>0&&p.height>0,f(p)},u.Rect.fromObject=function(c,f){return u.Object._fromObject("Rect",c,f)}}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.extend,c=u.util.array.min,f=u.util.array.max,h=u.util.toFixed,d=u.util.projectStrokeOnPoints;if(u.Polyline){u.warn("fabric.Polyline is already defined");return}u.Polyline=u.util.createClass(u.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:u.Object.prototype.cacheProperties.concat("points"),initialize:function(p,m){m=m||{},this.points=p||[],this.callSuper("initialize",m),this._setPositionDimensions(m)},_projectStrokeOnPoints:function(){return d(this.points,this,!0)},_setPositionDimensions:function(p){var m=this._calcDimensions(p),g,y=this.exactBoundingBox?this.strokeWidth:0;this.width=m.width-y,this.height=m.height-y,p.fromSVG||(g=this.translateToGivenOrigin({x:m.left-this.strokeWidth/2+y/2,y:m.top-this.strokeWidth/2+y/2},"left","top",this.originX,this.originY)),typeof p.left>"u"&&(this.left=p.fromSVG?m.left:g.x),typeof p.top>"u"&&(this.top=p.fromSVG?m.top:g.y),this.pathOffset={x:m.left+this.width/2+y/2,y:m.top+this.height/2+y/2}},_calcDimensions:function(){var p=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,m=c(p,"x")||0,g=c(p,"y")||0,y=f(p,"x")||0,b=f(p,"y")||0,x=y-m,v=b-g;return{left:m,top:g,width:x,height:v}},toObject:function(p){return l(this.callSuper("toObject",p),{points:this.points.concat()})},_toSVG:function(){for(var p=[],m=this.pathOffset.x,g=this.pathOffset.y,y=u.Object.NUM_FRACTION_DIGITS,b=0,x=this.points.length;b<x;b++)p.push(h(this.points[b].x-m,y),",",h(this.points[b].y-g,y)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',p.join(""),`" />
`]},commonRender:function(p){var m,g=this.points.length,y=this.pathOffset.x,b=this.pathOffset.y;if(!g||isNaN(this.points[g-1].y))return!1;p.beginPath(),p.moveTo(this.points[0].x-y,this.points[0].y-b);for(var x=0;x<g;x++)m=this.points[x],p.lineTo(m.x-y,m.y-b);return!0},_render:function(p){this.commonRender(p)&&this._renderPaintInOrder(p)},complexity:function(){return this.get("points").length}}),u.Polyline.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat(),u.Polyline.fromElementGenerator=function(p){return function(m,g,y){if(!m)return g(null);y||(y={});var b=u.parsePointsAttribute(m.getAttribute("points")),x=u.parseAttributes(m,u[p].ATTRIBUTE_NAMES);x.fromSVG=!0,g(new u[p](b,l(x,y)))}},u.Polyline.fromElement=u.Polyline.fromElementGenerator("Polyline"),u.Polyline.fromObject=function(p,m){return u.Object._fromObject("Polyline",p,m,"points")}}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.projectStrokeOnPoints;if(u.Polygon){u.warn("fabric.Polygon is already defined");return}u.Polygon=u.util.createClass(u.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(c){this.commonRender(c)&&(c.closePath(),this._renderPaintInOrder(c))}}),u.Polygon.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat(),u.Polygon.fromElement=u.Polyline.fromElementGenerator("Polygon"),u.Polygon.fromObject=function(c,f){u.Object._fromObject("Polygon",c,f,"points")}}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.array.min,c=u.util.array.max,f=u.util.object.extend,h=u.util.object.clone,d=u.util.toFixed;if(u.Path){u.warn("fabric.Path is already defined");return}u.Path=u.util.createClass(u.Object,{type:"path",path:null,cacheProperties:u.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:u.Object.prototype.stateProperties.concat("path"),initialize:function(p,m){m=h(m||{}),delete m.path,this.callSuper("initialize",m),this._setPath(p||[],m)},_setPath:function(p,m){this.path=u.util.makePathSimpler(Array.isArray(p)?p:u.util.parsePath(p)),u.Polyline.prototype._setPositionDimensions.call(this,m||{})},_renderPathCommands:function(p){var m,g=0,y=0,b=0,x=0,v=0,w=0,C=-this.pathOffset.x,S=-this.pathOffset.y;p.beginPath();for(var _=0,$=this.path.length;_<$;++_)switch(m=this.path[_],m[0]){case"L":b=m[1],x=m[2],p.lineTo(b+C,x+S);break;case"M":b=m[1],x=m[2],g=b,y=x,p.moveTo(b+C,x+S);break;case"C":b=m[5],x=m[6],v=m[3],w=m[4],p.bezierCurveTo(m[1]+C,m[2]+S,v+C,w+S,b+C,x+S);break;case"Q":p.quadraticCurveTo(m[1]+C,m[2]+S,m[3]+C,m[4]+S),b=m[3],x=m[4],v=m[1],w=m[2];break;case"z":case"Z":b=g,x=y,p.closePath();break}},_render:function(p){this._renderPathCommands(p),this._renderPaintInOrder(p)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(p){return f(this.callSuper("toObject",p),{path:this.path.map(function(m){return m.slice()})})},toDatalessObject:function(p){var m=this.toObject(["sourcePath"].concat(p));return m.sourcePath&&delete m.path,m},_toSVG:function(){var p=u.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',p,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var p=u.Object.NUM_FRACTION_DIGITS;return" translate("+d(-this.pathOffset.x,p)+", "+d(-this.pathOffset.y,p)+")"},toClipPathSVG:function(p){var m=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:m})},toSVG:function(p){var m=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:m})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var p=[],m=[],g,y=0,b=0,x=0,v=0,w,C=0,S=this.path.length;C<S;++C){switch(g=this.path[C],g[0]){case"L":x=g[1],v=g[2],w=[];break;case"M":x=g[1],v=g[2],y=x,b=v,w=[];break;case"C":w=u.util.getBoundsOfCurve(x,v,g[1],g[2],g[3],g[4],g[5],g[6]),x=g[5],v=g[6];break;case"Q":w=u.util.getBoundsOfCurve(x,v,g[1],g[2],g[1],g[2],g[3],g[4]),x=g[3],v=g[4];break;case"z":case"Z":x=y,v=b;break}w.forEach(function(I){p.push(I.x),m.push(I.y)}),p.push(x),m.push(v)}var _=l(p)||0,$=l(m)||0,k=c(p)||0,E=c(m)||0,F=k-_,T=E-$;return{left:_,top:$,width:F,height:T}}}),u.Path.fromObject=function(p,m){if(typeof p.sourcePath=="string"){var g=p.sourcePath;u.loadSVGFromURL(g,function(y){var b=y[0];b.setOptions(p),p.clipPath?u.util.enlivenObjects([p.clipPath],function(x){b.clipPath=x[0],m&&m(b)}):m&&m(b)})}else u.Object._fromObject("Path",p,m,"path")},u.Path.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat(["d"]),u.Path.fromElement=function(p,m,g){var y=u.parseAttributes(p,u.Path.ATTRIBUTE_NAMES);y.fromSVG=!0,m(new u.Path(y.d,f(y,g)))}}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.array.min,c=u.util.array.max;u.Group||(u.Group=u.util.createClass(u.Object,u.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(f,h,d){h=h||{},this._objects=[],d&&this.callSuper("initialize",h),this._objects=f||[];for(var p=this._objects.length;p--;)this._objects[p].group=this;if(d)this._updateObjectsACoords();else{var m=h&&h.centerPoint;h.originX!==void 0&&(this.originX=h.originX),h.originY!==void 0&&(this.originY=h.originY),m||this._calcBounds(),this._updateObjectsCoords(m),delete h.centerPoint,this.callSuper("initialize",h)}this.setCoords()},_updateObjectsACoords:function(){for(var f=!0,h=this._objects.length;h--;)this._objects[h].setCoords(f)},_updateObjectsCoords:function(h){for(var h=h||this.getCenterPoint(),d=this._objects.length;d--;)this._updateObjectCoords(this._objects[d],h)},_updateObjectCoords:function(f,h){var d=f.left,p=f.top,m=!0;f.set({left:d-h.x,top:p-h.y}),f.group=this,f.setCoords(m)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(f){var h=!!this.group;return this._restoreObjectsState(),u.util.resetObjectTransform(this),f&&(h&&u.util.removeTransformFromObject(f,this.group.calcTransformMatrix()),this._objects.push(f),f.group=this,f._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,h?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(f){return this._restoreObjectsState(),u.util.resetObjectTransform(this),this.remove(f),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(f){this.dirty=!0,f.group=this,f._set("canvas",this.canvas)},_onObjectRemoved:function(f){this.dirty=!0,delete f.group},_set:function(f,h){var d=this._objects.length;if(this.useSetOnGroup)for(;d--;)this._objects[d].setOnGroup(f,h);if(f==="canvas")for(;d--;)this._objects[d]._set(f,h);u.Object.prototype._set.call(this,f,h)},toObject:function(f){var h=this.includeDefaultValues,d=this._objects.filter(function(m){return!m.excludeFromExport}).map(function(m){var g=m.includeDefaultValues;m.includeDefaultValues=h;var y=m.toObject(f);return m.includeDefaultValues=g,y}),p=u.Object.prototype.toObject.call(this,f);return p.objects=d,p},toDatalessObject:function(f){var h,d=this.sourcePath;if(d)h=d;else{var p=this.includeDefaultValues;h=this._objects.map(function(g){var y=g.includeDefaultValues;g.includeDefaultValues=p;var b=g.toDatalessObject(f);return g.includeDefaultValues=y,b})}var m=u.Object.prototype.toDatalessObject.call(this,f);return m.objects=h,m},render:function(f){this._transformDone=!0,this.callSuper("render",f),this._transformDone=!1},shouldCache:function(){var f=u.Object.prototype.shouldCache.call(this);if(f){for(var h=0,d=this._objects.length;h<d;h++)if(this._objects[h].willDrawShadow())return this.ownCaching=!1,!1}return f},willDrawShadow:function(){if(u.Object.prototype.willDrawShadow.call(this))return!0;for(var f=0,h=this._objects.length;f<h;f++)if(this._objects[f].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(f){for(var h=0,d=this._objects.length;h<d;h++)this._objects[h].render(f);this._drawClipPath(f,this.clipPath)},isCacheDirty:function(f){if(this.callSuper("isCacheDirty",f))return!0;if(!this.statefullCache)return!1;for(var h=0,d=this._objects.length;h<d;h++)if(this._objects[h].isCacheDirty(!0)){if(this._cacheCanvas){var p=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-p/2,-m/2,p,m)}return!0}return!1},_restoreObjectsState:function(){var f=this.calcOwnMatrix();return this._objects.forEach(function(h){u.util.addTransformToObject(h,f),delete h.group,h.setCoords()}),this},destroy:function(){return this._objects.forEach(function(f){f.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(f){f.dispose&&f.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var f=this._objects,h=this.canvas;this._objects=[];var d=this.toObject();delete d.objects;var p=new u.ActiveSelection([]);return p.set(d),p.type="activeSelection",h.remove(this),f.forEach(function(m){m.group=p,m.dirty=!0,h.add(m)}),p.canvas=h,p._objects=f,h._activeObject=p,p.setCoords(),p}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var f=!0;return this.forEachObject(function(h){h.setCoords(f)}),this},_calcBounds:function(f){for(var h=[],d=[],p,m,g,y=["tr","br","bl","tl"],b=0,x=this._objects.length,v,w=y.length;b<x;++b){for(p=this._objects[b],g=p.calcACoords(),v=0;v<w;v++)m=y[v],h.push(g[m].x),d.push(g[m].y);p.aCoords=g}this._getBounds(h,d,f)},_getBounds:function(f,h,d){var p=new u.Point(l(f),l(h)),m=new u.Point(c(f),c(h)),g=p.y||0,y=p.x||0,b=m.x-p.x||0,x=m.y-p.y||0;this.width=b,this.height=x,d||this.setPositionByOrigin({x:y,y:g},"left","top")},_toSVG:function(f){for(var h=["<g ","COMMON_PARTS",` >
`],d=0,p=this._objects.length;d<p;d++)h.push("		",this._objects[d].toSVG(f));return h.push(`</g>
`),h},getSvgStyles:function(){var f=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",h=this.visible?"":" visibility: hidden;";return[f,this.getSvgFilter(),h].join("")},toClipPathSVG:function(f){for(var h=[],d=0,p=this._objects.length;d<p;d++)h.push("	",this._objects[d].toClipPathSVG(f));return this._createBaseClipPathSVGMarkup(h,{reviver:f})}}),u.Group.fromObject=function(f,h){var d=f.objects,p=u.util.object.clone(f,!0);if(delete p.objects,typeof d=="string"){u.loadSVGFromURL(d,function(m){var g=u.util.groupSVGElements(m,f,d),y=p.clipPath;delete p.clipPath,g.set(p),y?u.util.enlivenObjects([y],function(b){g.clipPath=b[0],h&&h(g)}):h&&h(g)});return}u.util.enlivenObjects(d,function(m){u.util.enlivenObjectEnlivables(f,p,function(){h&&h(new u.Group(m,p,!0))})})})}(e),function(a){var u=a.fabric||(a.fabric={});u.ActiveSelection||(u.ActiveSelection=u.util.createClass(u.Group,{type:"activeSelection",initialize:function(l,c){c=c||{},this._objects=l||[];for(var f=this._objects.length;f--;)this._objects[f].group=this;c.originX&&(this.originX=c.originX),c.originY&&(this.originY=c.originY),this._calcBounds(),this._updateObjectsCoords(),u.Object.prototype.initialize.call(this,c),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var c=u.Object.prototype.toObject.call(this),f=new u.Group([]);if(delete c.type,f.set(c),l.forEach(function(d){d.canvas.remove(d),d.group=f}),f._objects=l,!this.canvas)return f;var h=this.canvas;return h.add(f),h._activeObject=f,f.setCoords(),f},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,c,f){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,c),f=f||{},typeof f.hasControls>"u"&&(f.hasControls=!1),f.forActiveSelection=!0;for(var h=0,d=this._objects.length;h<d;h++)this._objects[h]._renderControls(l,f);l.restore()}}),u.ActiveSelection.fromObject=function(l,c){u.util.enlivenObjects(l.objects,function(f){delete l.objects,c&&c(new u.ActiveSelection(f,l,!0))})})}(e),function(a){var u=t.util.object.extend;if(a.fabric||(a.fabric={}),a.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,c){c||(c={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",c),this._initElement(l,c)},getElement:function(){return this._element||{}},setElement:function(l,c){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(c),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var c=t.filterBackend;c&&c.evictCachesForKey&&c.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){var c=this.width/2,f=this.height/2;l.beginPath(),l.moveTo(-c,-f),l.lineTo(c,-f),l.lineTo(c,f),l.lineTo(-c,f),l.lineTo(-c,-f),l.closePath()}},toObject:function(l){var c=[];this.filters.forEach(function(h){h&&c.push(h.toObject())});var f=u(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:c});return this.resizeFilter&&(f.resizeFilter=this.resizeFilter.toObject()),f},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l=[],c=[],f,h=this._element,d=-this.width/2,p=-this.height/2,m="",g="";if(!h)return[];if(this.hasCrop()){var y=t.Object.__uid++;l.push('<clipPath id="imageCrop_'+y+`">
`,'	<rect x="'+d+'" y="'+p+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),m=' clip-path="url(#imageCrop_'+y+')" '}if(this.imageSmoothing||(g='" image-rendering="optimizeSpeed'),c.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',d-this.cropX,'" y="',p-this.cropY,'" width="',h.width||h.naturalWidth,'" height="',h.height||h.height,g,'"',m,`></image>
`),this.stroke||this.strokeDashArray){var b=this.fill;this.fill=null,f=["	<rect ",'x="',d,'" y="',p,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=b}return this.paintFirst!=="fill"?l=l.concat(f,c):l=l.concat(c,f),l},getSrc:function(l){var c=l?this._element:this._originalElement;return c?c.toDataURL?c.toDataURL():this.srcFromAttribute?c.getAttribute("src"):c.src:this.src||""},setSrc:function(l,c,f){return t.util.loadImage(l,function(h,d){this.setElement(h,f),this._setWidthHeight(),c&&c(this,d)},this,f&&f.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,c=this.minimumScaleTrigger,f=this.getTotalObjectScaling(),h=f.scaleX,d=f.scaleY,p=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||h>c&&d>c){this._element=p,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=h,this._lastScaleY=d;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var m=t.util.createCanvasElement(),g=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,y=p.width,b=p.height;m.width=y,m.height=b,this._element=m,this._lastScaleX=l.scaleX=h,this._lastScaleY=l.scaleY=d,t.filterBackend.applyFilters([l],p,y,b,this._element,g),this._filterScalingX=m.width/this._originalElement.width,this._filterScalingY=m.height/this._originalElement.height},applyFilters:function(l){if(l=l||this.filters||[],l=l.filter(function(p){return p&&!p.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var c=this._originalElement,f=c.naturalWidth||c.width,h=c.naturalHeight||c.height;if(this._element===this._originalElement){var d=t.util.createCanvasElement();d.width=f,d.height=h,this._element=d,this._filteredEl=d}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,f,h),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(l,this._originalElement,f,h,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var c=this._element;if(c){var f=this._filterScalingX,h=this._filterScalingY,d=this.width,p=this.height,m=Math.min,g=Math.max,y=g(this.cropX,0),b=g(this.cropY,0),x=c.naturalWidth||c.width,v=c.naturalHeight||c.height,w=y*f,C=b*h,S=m(d*f,x-w),_=m(p*h,v-C),$=-d/2,k=-p/2,E=m(d,x/f-y),F=m(p,v/h-b);c&&l.drawImage(c,w,C,S,_,$,k,E,F)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,c){this.setElement(t.util.getById(l),c),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,c){l&&l.length?t.util.enlivenObjects(l,function(f){c&&c(f)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(l){l||(l={});var c=this.getElement();this.width=l.width||c.naturalWidth||c.width||0,this.height=l.height||c.naturalHeight||c.height||0},parsePreserveAspectRatioAttribute:function(){var l=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),c=this._element.width,f=this._element.height,h=1,d=1,p=0,m=0,g=0,y=0,b,x=this.width,v=this.height,w={width:x,height:v};return l&&(l.alignX!=="none"||l.alignY!=="none")?(l.meetOrSlice==="meet"&&(h=d=t.util.findScaleToFit(this._element,w),b=(x-c*h)/2,l.alignX==="Min"&&(p=-b),l.alignX==="Max"&&(p=b),b=(v-f*d)/2,l.alignY==="Min"&&(m=-b),l.alignY==="Max"&&(m=b)),l.meetOrSlice==="slice"&&(h=d=t.util.findScaleToCover(this._element,w),b=c-x/h,l.alignX==="Mid"&&(g=b/2),l.alignX==="Max"&&(g=b),b=f-v/d,l.alignY==="Mid"&&(y=b/2),l.alignY==="Max"&&(y=b),c=x/h,f=v/d)):(h=x/c,d=v/f),{width:c,height:f,scaleX:h,scaleY:d,offsetLeft:p,offsetTop:m,cropX:g,cropY:y}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(l,c){var f=t.util.object.clone(l);t.util.loadImage(f.src,function(h,d){if(d){c&&c(null,!0);return}t.Image.prototype._initFilters.call(f,f.filters,function(p){f.filters=p||[],t.Image.prototype._initFilters.call(f,[f.resizeFilter],function(m){f.resizeFilter=m[0],t.util.enlivenObjectEnlivables(f,f,function(){var g=new t.Image(h,f);c(g,!1)})})})},null,f.crossOrigin)},t.Image.fromURL=function(l,c,f){t.util.loadImage(l,function(h,d){c&&c(new t.Image(h,f),d)},null,f&&f.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(l,c,f){var h=t.parseAttributes(l,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(h["xlink:href"],c,u(f?t.util.object.clone(f):{},h))}}(e),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.angle%360;return a>0?Math.round((a-1)/90)*90:Math.round(a/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(a){a=a||{};var u=function(){},l=a.onComplete||u,c=a.onChange||u,f=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(h){f.rotate(h),c()},onComplete:function(){f.setCoords(),l()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function a(l,c){var f="precision "+c+` float;
void main(){}`,h=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(h,f),l.compileShader(h),!!l.getShaderParameter(h,l.COMPILE_STATUS)}t.isWebglSupported=function(l){if(t.isLikelyNode)return!1;l=l||t.WebglFilterBackend.prototype.tileSize;var c=document.createElement("canvas"),f=c.getContext("webgl")||c.getContext("experimental-webgl"),h=!1;if(f){t.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE),h=t.maxTextureSize>=l;for(var d=["highp","mediump","lowp"],p=0;p<3;p++)if(a(f,d[p])){t.webGlPrecision=d[p];break}}return this.isSupported=h,h},t.WebglFilterBackend=u;function u(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}u.prototype={tileSize:2048,resources:{},setupGLContext:function(l,c){this.dispose(),this.createWebGLCanvas(l,c),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,c)},chooseFastestCopyGLTo2DMethod:function(l,c){var f=typeof window.performance<"u",h;try{new ImageData(1,1),h=!0}catch{h=!1}var d=typeof ArrayBuffer<"u",p=typeof Uint8ClampedArray<"u";if(f&&h&&d&&p){var m=t.util.createCanvasElement(),g=new ArrayBuffer(l*c*4);if(t.forceGLPutImageData){this.imageBuffer=g,this.copyGLTo2D=o;return}var y={imageBuffer:g,destinationWidth:l,destinationHeight:c,targetCanvas:m},b,x,v;m.width=l,m.height=c,b=window.performance.now(),s.call(y,this.gl,y),x=window.performance.now()-b,b=window.performance.now(),o.call(y,this.gl,y),v=window.performance.now()-b,x>v?(this.imageBuffer=g,this.copyGLTo2D=o):this.copyGLTo2D=s}},createWebGLCanvas:function(l,c){var f=t.util.createCanvasElement();f.width=l,f.height=c;var h={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},d=f.getContext("webgl",h);d||(d=f.getContext("experimental-webgl",h)),d&&(d.clearColor(0,0,0,0),this.canvas=f,this.gl=d)},applyFilters:function(l,c,f,h,d,p){var m=this.gl,g;p&&(g=this.getCachedTexture(p,c));var y={originalWidth:c.width||c.originalWidth,originalHeight:c.height||c.originalHeight,sourceWidth:f,sourceHeight:h,destinationWidth:f,destinationHeight:h,context:m,sourceTexture:this.createTexture(m,f,h,!g&&c),targetTexture:this.createTexture(m,f,h),originalTexture:g||this.createTexture(m,f,h,!g&&c),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:d},b=m.createFramebuffer();return m.bindFramebuffer(m.FRAMEBUFFER,b),l.forEach(function(x){x&&x.applyTo(y)}),i(y),this.copyGLTo2D(m,y),m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(y.sourceTexture),m.deleteTexture(y.targetTexture),m.deleteFramebuffer(b),d.getContext("2d").setTransform(1,0,0,1,0,0),y},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,c,f,h,d){var p=l.createTexture();return l.bindTexture(l.TEXTURE_2D,p),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,d||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,d||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),h?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,h):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,c,f,0,l.RGBA,l.UNSIGNED_BYTE,null),p},getCachedTexture:function(l,c){if(this.textureCache[l])return this.textureCache[l];var f=this.createTexture(this.gl,c.width,c.height,c);return this.textureCache[l]=f,f},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:s,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,c={renderer:"",vendor:""};if(!l)return c;var f=l.getExtension("WEBGL_debug_renderer_info");if(f){var h=l.getParameter(f.UNMASKED_RENDERER_WEBGL),d=l.getParameter(f.UNMASKED_VENDOR_WEBGL);h&&(c.renderer=h.toLowerCase()),d&&(c.vendor=d.toLowerCase())}return this.gpuInfo=c,c}}}();function i(a){var u=a.targetCanvas,l=u.width,c=u.height,f=a.destinationWidth,h=a.destinationHeight;(l!==f||c!==h)&&(u.width=f,u.height=h)}function s(a,u){var l=a.canvas,c=u.targetCanvas,f=c.getContext("2d");f.translate(0,c.height),f.scale(1,-1);var h=l.height-c.height;f.drawImage(l,0,h,c.width,c.height,0,0,c.width,c.height)}function o(a,u){var l=u.targetCanvas,c=l.getContext("2d"),f=u.destinationWidth,h=u.destinationHeight,d=f*h*4,p=new Uint8Array(this.imageBuffer,0,d),m=new Uint8ClampedArray(this.imageBuffer,0,d);a.readPixels(0,0,f,h,a.RGBA,a.UNSIGNED_BYTE,p);var g=new ImageData(m,f,h);c.putImageData(g,0,0)}(function(){var a=function(){};t.Canvas2dFilterBackend=u;function u(){}u.prototype={evictCachesForKey:a,dispose:a,clearWebGLCaches:a,resources:{},applyFilters:function(l,c,f,h,d){var p=d.getContext("2d");p.drawImage(c,0,0,f,h);var m=p.getImageData(0,0,f,h),g=p.getImageData(0,0,f,h),y={sourceWidth:f,sourceHeight:h,imageData:m,originalEl:c,originalImageData:g,canvasEl:d,ctx:p,filterBackend:this};return l.forEach(function(b){b.applyTo(y)}),(y.imageData.width!==f||y.imageData.height!==h)&&(d.width=y.imageData.width,d.height=y.imageData.height),p.putImageData(y.imageData,0,0),y}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var u in a)this[u]=a[u]},createProgram:function(a,u,l){u=u||this.fragmentSource,l=l||this.vertexSource,t.webGlPrecision!=="highp"&&(u=u.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var c=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(c,l),a.compileShader(c),!a.getShaderParameter(c,a.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+a.getShaderInfoLog(c));var f=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(f,u),a.compileShader(f),!a.getShaderParameter(f,a.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+a.getShaderInfoLog(f));var h=a.createProgram();if(a.attachShader(h,c),a.attachShader(h,f),a.linkProgram(h),!a.getProgramParameter(h,a.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+a.getProgramInfoLog(h));var d=this.getAttributeLocations(a,h),p=this.getUniformLocations(a,h)||{};return p.uStepW=a.getUniformLocation(h,"uStepW"),p.uStepH=a.getUniformLocation(h,"uStepH"),{program:h,attributeLocations:d,uniformLocations:p}},getAttributeLocations:function(a,u){return{aPosition:a.getAttribLocation(u,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(a,u,l){var c=u.aPosition,f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f),a.enableVertexAttribArray(c),a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,l,a.STATIC_DRAW)},_setupFrameBuffer:function(a){var u=a.context,l,c;a.passes>1?(l=a.destinationWidth,c=a.destinationHeight,(a.sourceWidth!==l||a.sourceHeight!==c)&&(u.deleteTexture(a.targetTexture),a.targetTexture=a.filterBackend.createTexture(u,l,c)),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a.targetTexture,0)):(u.bindFramebuffer(u.FRAMEBUFFER,null),u.finish())},_swapTextures:function(a){a.passes--,a.pass++;var u=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=u},isNeutralState:function(){var a=this.mainParameter,u=t.Image.filters[this.type].prototype;if(a)if(Array.isArray(u[a])){for(var l=u[a].length;l--;)if(this[a][l]!==u[a][l])return!1;return!0}else return u[a]===this[a];else return!1},applyTo:function(a){a.webgl?(this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},retrieveShader:function(a){return a.programCache.hasOwnProperty(this.type)||(a.programCache[this.type]=this.createProgram(a.context)),a.programCache[this.type]},applyToWebGL:function(a){var u=a.context,l=this.retrieveShader(a);a.pass===0&&a.originalTexture?u.bindTexture(u.TEXTURE_2D,a.originalTexture):u.bindTexture(u.TEXTURE_2D,a.sourceTexture),u.useProgram(l.program),this.sendAttributeData(u,l.attributeLocations,a.aPosition),u.uniform1f(l.uniformLocations.uStepW,1/a.sourceWidth),u.uniform1f(l.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(u,l.uniformLocations),u.viewport(0,0,a.destinationWidth,a.destinationHeight),u.drawArrays(u.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(a,u,l){a.activeTexture(l),a.bindTexture(a.TEXTURE_2D,u),a.activeTexture(a.TEXTURE0)},unbindAdditionalTexture:function(a,u){a.activeTexture(u),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var u=document.createElement("canvas");u.width=a.sourceWidth,u.height=a.sourceHeight,a.helpLayer=u}},toObject:function(){var a={type:this.type},u=this.mainParameter;return u&&(a[u]=this[u]),a},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(a,u){var l=new t.Image.filters[a.type](a);return u&&u(l),l},function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.ColorMatrix=c(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(f){this.callSuper("initialize",f),this.matrix=this.matrix.slice(0)},applyTo2d:function(f){var h=f.imageData,d=h.data,p=d.length,m=this.matrix,g,y,b,x,v,w=this.colorsOnly;for(v=0;v<p;v+=4)g=d[v],y=d[v+1],b=d[v+2],w?(d[v]=g*m[0]+y*m[1]+b*m[2]+m[4]*255,d[v+1]=g*m[5]+y*m[6]+b*m[7]+m[9]*255,d[v+2]=g*m[10]+y*m[11]+b*m[12]+m[14]*255):(x=d[v+3],d[v]=g*m[0]+y*m[1]+b*m[2]+x*m[3]+m[4]*255,d[v+1]=g*m[5]+y*m[6]+b*m[7]+x*m[8]+m[9]*255,d[v+2]=g*m[10]+y*m[11]+b*m[12]+x*m[13]+m[14]*255,d[v+3]=g*m[15]+y*m[16]+b*m[17]+x*m[18]+m[19]*255)},getUniformLocations:function(f,h){return{uColorMatrix:f.getUniformLocation(h,"uColorMatrix"),uConstants:f.getUniformLocation(h,"uConstants")}},sendUniformData:function(f,h){var d=this.matrix,p=[d[0],d[1],d[2],d[3],d[5],d[6],d[7],d[8],d[10],d[11],d[12],d[13],d[15],d[16],d[17],d[18]],m=[d[4],d[9],d[14],d[19]];f.uniformMatrix4fv(h.uColorMatrix,!1,p),f.uniform4fv(h.uConstants,m)}}),u.Image.filters.ColorMatrix.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Brightness=c(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(f){if(this.brightness!==0){var h=f.imageData,d=h.data,p,m=d.length,g=Math.round(this.brightness*255);for(p=0;p<m;p+=4)d[p]=d[p]+g,d[p+1]=d[p+1]+g,d[p+2]=d[p+2]+g}},getUniformLocations:function(f,h){return{uBrightness:f.getUniformLocation(h,"uBrightness")}},sendUniformData:function(f,h){f.uniform1f(h.uBrightness,this.brightness)}}),u.Image.filters.Brightness.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.extend,c=u.Image.filters,f=u.util.createClass;c.Convolute=f(c.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(h){var d=Math.sqrt(this.matrix.length),p=this.type+"_"+d+"_"+(this.opaque?1:0),m=this.fragmentSource[p];return h.programCache.hasOwnProperty(p)||(h.programCache[p]=this.createProgram(h.context,m)),h.programCache[p]},applyTo2d:function(h){var d=h.imageData,p=d.data,m=this.matrix,g=Math.round(Math.sqrt(m.length)),y=Math.floor(g/2),b=d.width,x=d.height,v=h.ctx.createImageData(b,x),w=v.data,C=this.opaque?1:0,S,_,$,k,E,F,T,I,D,N,V,U,A;for(V=0;V<x;V++)for(N=0;N<b;N++){for(E=(V*b+N)*4,S=0,_=0,$=0,k=0,A=0;A<g;A++)for(U=0;U<g;U++)T=V+A-y,F=N+U-y,!(T<0||T>=x||F<0||F>=b)&&(I=(T*b+F)*4,D=m[A*g+U],S+=p[I]*D,_+=p[I+1]*D,$+=p[I+2]*D,C||(k+=p[I+3]*D));w[E]=S,w[E+1]=_,w[E+2]=$,C?w[E+3]=p[E+3]:w[E+3]=k}h.imageData=v},getUniformLocations:function(h,d){return{uMatrix:h.getUniformLocation(d,"uMatrix"),uOpaque:h.getUniformLocation(d,"uOpaque"),uHalfSize:h.getUniformLocation(d,"uHalfSize"),uSize:h.getUniformLocation(d,"uSize")}},sendUniformData:function(h,d){h.uniform1fv(d.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),u.Image.filters.Convolute.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Grayscale=c(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(f){var h=f.imageData,d=h.data,p,m=d.length,g,y=this.mode;for(p=0;p<m;p+=4)y==="average"?g=(d[p]+d[p+1]+d[p+2])/3:y==="lightness"?g=(Math.min(d[p],d[p+1],d[p+2])+Math.max(d[p],d[p+1],d[p+2]))/2:y==="luminosity"&&(g=.21*d[p]+.72*d[p+1]+.07*d[p+2]),d[p]=g,d[p+1]=g,d[p+2]=g},retrieveShader:function(f){var h=this.type+"_"+this.mode;if(!f.programCache.hasOwnProperty(h)){var d=this.fragmentSource[this.mode];f.programCache[h]=this.createProgram(f.context,d)}return f.programCache[h]},getUniformLocations:function(f,h){return{uMode:f.getUniformLocation(h,"uMode")}},sendUniformData:function(f,h){var d=1;f.uniform1i(h.uMode,d)},isNeutralState:function(){return!1}}),u.Image.filters.Grayscale.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Invert=c(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(f){var h=f.imageData,d=h.data,p,m=d.length;for(p=0;p<m;p+=4)d[p]=255-d[p],d[p+1]=255-d[p+1],d[p+2]=255-d[p+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(f,h){return{uInvert:f.getUniformLocation(h,"uInvert")}},sendUniformData:function(f,h){f.uniform1i(h.uInvert,this.invert)}}),u.Image.filters.Invert.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.extend,c=u.Image.filters,f=u.util.createClass;c.Noise=f(c.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(h){if(this.noise!==0){var d=h.imageData,p=d.data,m,g=p.length,y=this.noise,b;for(m=0,g=p.length;m<g;m+=4)b=(.5-Math.random())*y,p[m]+=b,p[m+1]+=b,p[m+2]+=b}},getUniformLocations:function(h,d){return{uNoise:h.getUniformLocation(d,"uNoise"),uSeed:h.getUniformLocation(d,"uSeed")}},sendUniformData:function(h,d){h.uniform1f(d.uNoise,this.noise/255),h.uniform1f(d.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),u.Image.filters.Noise.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Pixelate=c(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(f){var h=f.imageData,d=h.data,p=h.height,m=h.width,g,y,b,x,v,w,C,S,_,$,k;for(y=0;y<p;y+=this.blocksize)for(b=0;b<m;b+=this.blocksize)for(g=y*4*m+b*4,x=d[g],v=d[g+1],w=d[g+2],C=d[g+3],$=Math.min(y+this.blocksize,p),k=Math.min(b+this.blocksize,m),S=y;S<$;S++)for(_=b;_<k;_++)g=S*4*m+_*4,d[g]=x,d[g+1]=v,d[g+2]=w,d[g+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(f,h){return{uBlocksize:f.getUniformLocation(h,"uBlocksize"),uStepW:f.getUniformLocation(h,"uStepW"),uStepH:f.getUniformLocation(h,"uStepH")}},sendUniformData:function(f,h){f.uniform1f(h.uBlocksize,this.blocksize)}}),u.Image.filters.Pixelate.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.extend,c=u.Image.filters,f=u.util.createClass;c.RemoveColor=f(c.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(h){var d=h.imageData,p=d.data,m,g=this.distance*255,y,b,x,v=new u.Color(this.color).getSource(),w=[v[0]-g,v[1]-g,v[2]-g],C=[v[0]+g,v[1]+g,v[2]+g];for(m=0;m<p.length;m+=4)y=p[m],b=p[m+1],x=p[m+2],y>w[0]&&b>w[1]&&x>w[2]&&y<C[0]&&b<C[1]&&x<C[2]&&(p[m+3]=0)},getUniformLocations:function(h,d){return{uLow:h.getUniformLocation(d,"uLow"),uHigh:h.getUniformLocation(d,"uHigh")}},sendUniformData:function(h,d){var p=new u.Color(this.color).getSource(),m=parseFloat(this.distance),g=[0+p[0]/255-m,0+p[1]/255-m,0+p[2]/255-m,1],y=[p[0]/255+m,p[1]/255+m,p[2]/255+m,1];h.uniform4fv(d.uLow,g),h.uniform4fv(d.uHigh,y)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),u.Image.filters.RemoveColor.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass,f={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var h in f)l[h]=c(l.ColorMatrix,{type:h,matrix:f[h],mainParameter:!1,colorsOnly:!0}),u.Image.filters[h].fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric,l=u.Image.filters,c=u.util.createClass;l.BlendColor=c(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(f){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[f]+`}
}`},retrieveShader:function(f){var h=this.type+"_"+this.mode,d;return f.programCache.hasOwnProperty(h)||(d=this.buildSource(this.mode),f.programCache[h]=this.createProgram(f.context,d)),f.programCache[h]},applyTo2d:function(f){var h=f.imageData,d=h.data,p=d.length,m,g,y,b,x,v,w,C=1-this.alpha;w=new u.Color(this.color).getSource(),m=w[0]*this.alpha,g=w[1]*this.alpha,y=w[2]*this.alpha;for(var S=0;S<p;S+=4)switch(b=d[S],x=d[S+1],v=d[S+2],this.mode){case"multiply":d[S]=b*m/255,d[S+1]=x*g/255,d[S+2]=v*y/255;break;case"screen":d[S]=255-(255-b)*(255-m)/255,d[S+1]=255-(255-x)*(255-g)/255,d[S+2]=255-(255-v)*(255-y)/255;break;case"add":d[S]=b+m,d[S+1]=x+g,d[S+2]=v+y;break;case"diff":case"difference":d[S]=Math.abs(b-m),d[S+1]=Math.abs(x-g),d[S+2]=Math.abs(v-y);break;case"subtract":d[S]=b-m,d[S+1]=x-g,d[S+2]=v-y;break;case"darken":d[S]=Math.min(b,m),d[S+1]=Math.min(x,g),d[S+2]=Math.min(v,y);break;case"lighten":d[S]=Math.max(b,m),d[S+1]=Math.max(x,g),d[S+2]=Math.max(v,y);break;case"overlay":d[S]=m<128?2*b*m/255:255-2*(255-b)*(255-m)/255,d[S+1]=g<128?2*x*g/255:255-2*(255-x)*(255-g)/255,d[S+2]=y<128?2*v*y/255:255-2*(255-v)*(255-y)/255;break;case"exclusion":d[S]=m+b-2*m*b/255,d[S+1]=g+x-2*g*x/255,d[S+2]=y+v-2*y*v/255;break;case"tint":d[S]=m+b*C,d[S+1]=g+x*C,d[S+2]=y+v*C}},getUniformLocations:function(f,h){return{uColor:f.getUniformLocation(h,"uColor")}},sendUniformData:function(f,h){var d=new u.Color(this.color).getSource();d[0]=this.alpha*d[0]/255,d[1]=this.alpha*d[1]/255,d[2]=this.alpha*d[2]/255,d[3]=this.alpha,f.uniform4fv(h.uColor,d)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),u.Image.filters.BlendColor.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric,l=u.Image.filters,c=u.util.createClass;l.BlendImage=c(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(f){var h=this.type+"_"+this.mode,d=this.fragmentSource[this.mode];return f.programCache.hasOwnProperty(h)||(f.programCache[h]=this.createProgram(f.context,d)),f.programCache[h]},applyToWebGL:function(f){var h=f.context,d=this.createTexture(f.filterBackend,this.image);this.bindAdditionalTexture(h,d,h.TEXTURE1),this.callSuper("applyToWebGL",f),this.unbindAdditionalTexture(h,h.TEXTURE1)},createTexture:function(f,h){return f.getCachedTexture(h.cacheKey,h._element)},calculateMatrix:function(){var f=this.image,h=f._element.width,d=f._element.height;return[1/f.scaleX,0,0,0,1/f.scaleY,0,-f.left/h,-f.top/d,1]},applyTo2d:function(f){var h=f.imageData,d=f.filterBackend.resources,p=h.data,m=p.length,g=h.width,y=h.height,b,x,v,w,C,S,_,$,k,E,F=this.image,T;d.blendImage||(d.blendImage=u.util.createCanvasElement()),k=d.blendImage,E=k.getContext("2d"),k.width!==g||k.height!==y?(k.width=g,k.height=y):E.clearRect(0,0,g,y),E.setTransform(F.scaleX,0,0,F.scaleY,F.left,F.top),E.drawImage(F._element,0,0,g,y),T=E.getImageData(0,0,g,y).data;for(var I=0;I<m;I+=4)switch(C=p[I],S=p[I+1],_=p[I+2],$=p[I+3],b=T[I],x=T[I+1],v=T[I+2],w=T[I+3],this.mode){case"multiply":p[I]=C*b/255,p[I+1]=S*x/255,p[I+2]=_*v/255,p[I+3]=$*w/255;break;case"mask":p[I+3]=w;break}},getUniformLocations:function(f,h){return{uTransformMatrix:f.getUniformLocation(h,"uTransformMatrix"),uImage:f.getUniformLocation(h,"uImage")}},sendUniformData:function(f,h){var d=this.calculateMatrix();f.uniform1i(h.uImage,1),f.uniformMatrix3fv(h.uTransformMatrix,!1,d)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),u.Image.filters.BlendImage.fromObject=function(f,h){u.Image.fromObject(f.image,function(d){var p=u.util.object.clone(f);p.image=d,h(new u.Image.filters.BlendImage(p))})}}(e),function(a){var u=a.fabric||(a.fabric={}),l=Math.pow,c=Math.floor,f=Math.sqrt,h=Math.abs,d=Math.round,p=Math.sin,m=Math.ceil,g=u.Image.filters,y=u.util.createClass;g.Resize=y(g.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(b,x){return{uDelta:b.getUniformLocation(x,"uDelta"),uTaps:b.getUniformLocation(x,"uTaps")}},sendUniformData:function(b,x){b.uniform2fv(x.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),b.uniform1fv(x.uTaps,this.taps)},retrieveShader:function(b){var x=this.getFilterWindow(),v=this.type+"_"+x;if(!b.programCache.hasOwnProperty(v)){var w=this.generateShader(x);b.programCache[v]=this.createProgram(b.context,w)}return b.programCache[v]},getFilterWindow:function(){var b=this.tempScale;return Math.ceil(this.lanczosLobes/b)},getTaps:function(){for(var b=this.lanczosCreate(this.lanczosLobes),x=this.tempScale,v=this.getFilterWindow(),w=new Array(v),C=1;C<=v;C++)w[C-1]=b(C*x);return w},generateShader:function(w){for(var x=new Array(w),v=this.fragmentSourceTOP,w,C=1;C<=w;C++)x[C-1]=C+".0 * uDelta";return v+="uniform float uTaps["+w+`];
`,v+=`void main() {
`,v+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,v+=`  float sum = 1.0;
`,x.forEach(function(S,_){v+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+_+`];
`,v+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+_+`];
`,v+="  sum += 2.0 * uTaps["+_+`];
`}),v+=`  gl_FragColor = color / sum;
`,v+="}",v},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(b){b.webgl?(b.passes++,this.width=b.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=b.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),b.destinationWidth=this.dW,this._setupFrameBuffer(b),this.applyToWebGL(b),this._swapTextures(b),b.sourceWidth=b.destinationWidth,this.height=b.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),b.destinationHeight=this.dH,this._setupFrameBuffer(b),this.applyToWebGL(b),this._swapTextures(b),b.sourceHeight=b.destinationHeight):this.applyTo2d(b)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(b){return function(x){if(x>=b||x<=-b)return 0;if(x<11920929e-14&&x>-11920929e-14)return 1;x*=Math.PI;var v=x/b;return p(x)/x*p(v)/v}},applyTo2d:function(b){var x=b.imageData,v=this.scaleX,w=this.scaleY;this.rcpScaleX=1/v,this.rcpScaleY=1/w;var C=x.width,S=x.height,_=d(C*v),$=d(S*w),k;this.resizeType==="sliceHack"?k=this.sliceByTwo(b,C,S,_,$):this.resizeType==="hermite"?k=this.hermiteFastResize(b,C,S,_,$):this.resizeType==="bilinear"?k=this.bilinearFiltering(b,C,S,_,$):this.resizeType==="lanczos"&&(k=this.lanczosResize(b,C,S,_,$)),b.imageData=k},sliceByTwo:function(b,x,v,w,C){var S=b.imageData,_=.5,$=!1,k=!1,E=x*_,F=v*_,T=u.filterBackend.resources,I,D,N=0,V=0,U=x,A=0;for(T.sliceByTwo||(T.sliceByTwo=document.createElement("canvas")),I=T.sliceByTwo,(I.width<x*1.5||I.height<v)&&(I.width=x*1.5,I.height=v),D=I.getContext("2d"),D.clearRect(0,0,x*1.5,v),D.putImageData(S,0,0),w=c(w),C=c(C);!$||!k;)x=E,v=F,w<c(E*_)?E=c(E*_):(E=w,$=!0),C<c(F*_)?F=c(F*_):(F=C,k=!0),D.drawImage(I,N,V,x,v,U,A,E,F),N=U,V=A,A+=F;return D.getImageData(N,V,w,C)},lanczosResize:function(b,x,v,w,C){function S(P){var j,q,B,O,G,Z,re,R,H,Y,L;for(A.x=(P+.5)*F,M.x=c(A.x),j=0;j<C;j++){for(A.y=(j+.5)*T,M.y=c(A.y),G=0,Z=0,re=0,R=0,H=0,q=M.x-N;q<=M.x+N;q++)if(!(q<0||q>=x)){Y=c(1e3*h(q-A.x)),U[Y]||(U[Y]={});for(var te=M.y-V;te<=M.y+V;te++)te<0||te>=v||(L=c(1e3*h(te-A.y)),U[Y][L]||(U[Y][L]=E(f(l(Y*I,2)+l(L*D,2))/1e3)),B=U[Y][L],B>0&&(O=(te*x+q)*4,G+=B,Z+=B*_[O],re+=B*_[O+1],R+=B*_[O+2],H+=B*_[O+3]))}O=(j*w+P)*4,k[O]=Z/G,k[O+1]=re/G,k[O+2]=R/G,k[O+3]=H/G}return++P<w?S(P):$}var _=b.imageData.data,$=b.ctx.createImageData(w,C),k=$.data,E=this.lanczosCreate(this.lanczosLobes),F=this.rcpScaleX,T=this.rcpScaleY,I=2/this.rcpScaleX,D=2/this.rcpScaleY,N=m(F*this.lanczosLobes/2),V=m(T*this.lanczosLobes/2),U={},A={},M={};return S(0)},bilinearFiltering:function(b,x,v,w,C){var S,_,$,k,E,F,T,I,D,N,V,U,A=0,M,P=this.rcpScaleX,j=this.rcpScaleY,q=4*(x-1),B=b.imageData,O=B.data,G=b.ctx.createImageData(w,C),Z=G.data;for(T=0;T<C;T++)for(I=0;I<w;I++)for(E=c(P*I),F=c(j*T),D=P*I-E,N=j*T-F,M=4*(F*x+E),V=0;V<4;V++)S=O[M+V],_=O[M+4+V],$=O[M+q+V],k=O[M+q+4+V],U=S*(1-D)*(1-N)+_*D*(1-N)+$*N*(1-D)+k*D*N,Z[A++]=U;return G},hermiteFastResize:function(b,x,v,w,C){for(var S=this.rcpScaleX,_=this.rcpScaleY,$=m(S/2),k=m(_/2),E=b.imageData,F=E.data,T=b.ctx.createImageData(w,C),I=T.data,D=0;D<C;D++)for(var N=0;N<w;N++){for(var V=(N+D*w)*4,U=0,A=0,M=0,P=0,j=0,q=0,B=0,O=(D+.5)*_,G=c(D*_);G<(D+1)*_;G++)for(var Z=h(O-(G+.5))/k,re=(N+.5)*S,R=Z*Z,H=c(N*S);H<(N+1)*S;H++){var Y=h(re-(H+.5))/$,L=f(R+Y*Y);L>1&&L<-1||(U=2*L*L*L-3*L*L+1,U>0&&(Y=4*(H+G*x),B+=U*F[Y+3],M+=U,F[Y+3]<255&&(U=U*F[Y+3]/250),P+=U*F[Y],j+=U*F[Y+1],q+=U*F[Y+2],A+=U))}I[V]=P/A,I[V+1]=j/A,I[V+2]=q/A,I[V+3]=B/M}return T},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),u.Image.filters.Resize.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Contrast=c(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(f){if(this.contrast!==0){var h=f.imageData,d,m,p=h.data,m=p.length,g=Math.floor(this.contrast*255),y=259*(g+255)/(255*(259-g));for(d=0;d<m;d+=4)p[d]=y*(p[d]-128)+128,p[d+1]=y*(p[d+1]-128)+128,p[d+2]=y*(p[d+2]-128)+128}},getUniformLocations:function(f,h){return{uContrast:f.getUniformLocation(h,"uContrast")}},sendUniformData:function(f,h){f.uniform1f(h.uContrast,this.contrast)}}),u.Image.filters.Contrast.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Saturation=c(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(f){if(this.saturation!==0){var h=f.imageData,d=h.data,p=d.length,m=-this.saturation,g,y;for(g=0;g<p;g+=4)y=Math.max(d[g],d[g+1],d[g+2]),d[g]+=y!==d[g]?(y-d[g])*m:0,d[g+1]+=y!==d[g+1]?(y-d[g+1])*m:0,d[g+2]+=y!==d[g+2]?(y-d[g+2])*m:0}},getUniformLocations:function(f,h){return{uSaturation:f.getUniformLocation(h,"uSaturation")}},sendUniformData:function(f,h){f.uniform1f(h.uSaturation,-this.saturation)}}),u.Image.filters.Saturation.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Vibrance=c(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(f){if(this.vibrance!==0){var h=f.imageData,d=h.data,p=d.length,m=-this.vibrance,g,y,b,x;for(g=0;g<p;g+=4)y=Math.max(d[g],d[g+1],d[g+2]),b=(d[g]+d[g+1]+d[g+2])/3,x=Math.abs(y-b)*2/255*m,d[g]+=y!==d[g]?(y-d[g])*x:0,d[g+1]+=y!==d[g+1]?(y-d[g+1])*x:0,d[g+2]+=y!==d[g+2]?(y-d[g+2])*x:0}},getUniformLocations:function(f,h){return{uVibrance:f.getUniformLocation(h,"uVibrance")}},sendUniformData:function(f,h){f.uniform1f(h.uVibrance,-this.vibrance)}}),u.Image.filters.Vibrance.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Blur=c(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(f){f.webgl?(this.aspectRatio=f.sourceWidth/f.sourceHeight,f.passes++,this._setupFrameBuffer(f),this.horizontal=!0,this.applyToWebGL(f),this._swapTextures(f),this._setupFrameBuffer(f),this.horizontal=!1,this.applyToWebGL(f),this._swapTextures(f)):this.applyTo2d(f)},applyTo2d:function(f){f.imageData=this.simpleBlur(f)},simpleBlur:function(f){var h=f.filterBackend.resources,d,p,m=f.imageData.width,g=f.imageData.height;h.blurLayer1||(h.blurLayer1=u.util.createCanvasElement(),h.blurLayer2=u.util.createCanvasElement()),d=h.blurLayer1,p=h.blurLayer2,(d.width!==m||d.height!==g)&&(p.width=d.width=m,p.height=d.height=g);var y=d.getContext("2d"),b=p.getContext("2d"),x=15,v,w,C,S,_=this.blur*.06*.5;for(y.putImageData(f.imageData,0,0),b.clearRect(0,0,m,g),S=-x;S<=x;S++)v=(Math.random()-.5)/4,w=S/x,C=_*w*m+v,b.globalAlpha=1-Math.abs(w),b.drawImage(d,C,v),y.drawImage(p,0,0),b.globalAlpha=1,b.clearRect(0,0,p.width,p.height);for(S=-x;S<=x;S++)v=(Math.random()-.5)/4,w=S/x,C=_*w*g+v,b.globalAlpha=1-Math.abs(w),b.drawImage(d,v,C),y.drawImage(p,0,0),b.globalAlpha=1,b.clearRect(0,0,p.width,p.height);f.ctx.drawImage(d,0,0);var $=f.ctx.getImageData(0,0,d.width,d.height);return y.globalAlpha=1,y.clearRect(0,0,d.width,d.height),$},getUniformLocations:function(f,h){return{delta:f.getUniformLocation(h,"uDelta")}},sendUniformData:function(f,h){var d=this.chooseRightDelta();f.uniform2fv(h.delta,d)},chooseRightDelta:function(){var f=1,h=[0,0],d;return this.horizontal?this.aspectRatio>1&&(f=1/this.aspectRatio):this.aspectRatio<1&&(f=this.aspectRatio),d=f*this.blur*.12,this.horizontal?h[0]=d:h[1]=d,h}}),l.Blur.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Gamma=c(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(f){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,f)},applyTo2d:function(f){var h=f.imageData,d=h.data,p=this.gamma,m=d.length,g=1/p[0],y=1/p[1],b=1/p[2],x;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),x=0,m=256;x<m;x++)this.rVals[x]=Math.pow(x/255,g)*255,this.gVals[x]=Math.pow(x/255,y)*255,this.bVals[x]=Math.pow(x/255,b)*255;for(x=0,m=d.length;x<m;x+=4)d[x]=this.rVals[d[x]],d[x+1]=this.gVals[d[x+1]],d[x+2]=this.bVals[d[x+2]]},getUniformLocations:function(f,h){return{uGamma:f.getUniformLocation(h,"uGamma")}},sendUniformData:function(f,h){f.uniform3fv(h.uGamma,this.gamma)}}),u.Image.filters.Gamma.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.Composed=c(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(f){this.callSuper("initialize",f),this.subFilters=this.subFilters.slice(0)},applyTo:function(f){f.passes+=this.subFilters.length-1,this.subFilters.forEach(function(h){h.applyTo(f)})},toObject:function(){return u.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(f){return f.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(f){return!f.isNeutralState()})}}),u.Image.filters.Composed.fromObject=function(f,h){var d=f.subFilters||[],p=d.map(function(g){return new u.Image.filters[g.type](g)}),m=new u.Image.filters.Composed({subFilters:p});return h&&h(m),m}}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.Image.filters,c=u.util.createClass;l.HueRotation=c(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var f=this.rotation*Math.PI,h=u.util.cos(f),d=u.util.sin(f),p=1/3,m=Math.sqrt(p)*d,g=1-h;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=h+g/3,this.matrix[1]=p*g-m,this.matrix[2]=p*g+m,this.matrix[5]=p*g+m,this.matrix[6]=h+p*g,this.matrix[7]=p*g-m,this.matrix[10]=p*g-m,this.matrix[11]=p*g+m,this.matrix[12]=h+p*g},isNeutralState:function(f){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,f)},applyTo:function(f){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,f)}}),u.Image.filters.HueRotation.fromObject=u.Image.filters.BaseFilter.fromObject}(e),function(a){var u=a.fabric||(a.fabric={}),l=u.util.object.clone;if(u.Text){u.warn("fabric.Text is already defined");return}var c="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");u.Text=u.util.createClass(u.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:u.Object.prototype.stateProperties.concat(c),cacheProperties:u.Object.prototype.cacheProperties.concat(c),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(f,h){this.styles=h?h.styles||{}:{},this.text=f,this.__skipDimension=!0,this.callSuper("initialize",h),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var f=this.path;f&&(f.segmentsInfo=u.util.getPathSegmentsInfo(f.path))},getMeasuringContext:function(){return u._measuringContext||(u._measuringContext=this.canvas&&this.canvas.contextCache||u.util.createCanvasElement().getContext("2d")),u._measuringContext},_splitText:function(){var f=this._splitTextIntoLines(this.text);return this.textLines=f.lines,this._textLines=f.graphemeLines,this._unwrappedTextLines=f._unwrappedLines,this._text=f.graphemeText,f},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var f,h,d,p,m,g,y,b=0,x=this._textLines.length;b<x;b++)if(!(this.textAlign!=="justify"&&(b===x-1||this.isEndOfWrapping(b)))&&(p=0,m=this._textLines[b],h=this.getLineWidth(b),h<this.width&&(y=this.textLines[b].match(this._reSpacesAndTabs)))){d=y.length,f=(this.width-h)/d;for(var v=0,w=m.length;v<=w;v++)g=this.__charBounds[b][v],this._reSpaceAndTab.test(m[v])?(g.width+=f,g.kernedWidth+=f,g.left+=p,p+=f):g.left+=p}},isEndOfWrapping:function(f){return f===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var f=this.callSuper("_getCacheCanvasDimensions"),h=this.fontSize;return f.width+=h*f.zoomX,f.height+=h*f.zoomY,f},_render:function(f){var h=this.path;h&&!h.isNotVisible()&&h._render(f),this._setTextStyles(f),this._renderTextLinesBackground(f),this._renderTextDecoration(f,"underline"),this._renderText(f),this._renderTextDecoration(f,"overline"),this._renderTextDecoration(f,"linethrough")},_renderText:function(f){this.paintFirst==="stroke"?(this._renderTextStroke(f),this._renderTextFill(f)):(this._renderTextFill(f),this._renderTextStroke(f))},_setTextStyles:function(f,h,d){if(f.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":f.textBaseline="middle";break;case"ascender":f.textBaseline="top";break;case"descender":f.textBaseline="bottom";break}f.font=this._getFontDeclaration(h,d)},calcTextWidth:function(){for(var f=this.getLineWidth(0),h=1,d=this._textLines.length;h<d;h++){var p=this.getLineWidth(h);p>f&&(f=p)}return f},_renderTextLine:function(f,h,d,p,m,g){this._renderChars(f,h,d,p,m,g)},_renderTextLinesBackground:function(f){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var h,d,p=f.fillStyle,m,g,y=this._getLeftOffset(),b=this._getTopOffset(),x=0,v=0,w,C,S=this.path,_,$=0,k=this._textLines.length;$<k;$++){if(h=this.getHeightOfLine($),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",$)){b+=h;continue}m=this._textLines[$],d=this._getLineLeftOffset($),v=0,x=0,g=this.getValueOfPropertyAt($,0,"textBackgroundColor");for(var E=0,F=m.length;E<F;E++)w=this.__charBounds[$][E],C=this.getValueOfPropertyAt($,E,"textBackgroundColor"),S?(f.save(),f.translate(w.renderLeft,w.renderTop),f.rotate(w.angle),f.fillStyle=C,C&&f.fillRect(-w.width/2,-h/this.lineHeight*(1-this._fontSizeFraction),w.width,h/this.lineHeight),f.restore()):C!==g?(_=y+d+x,this.direction==="rtl"&&(_=this.width-_-v),f.fillStyle=g,g&&f.fillRect(_,b,v,h/this.lineHeight),x=w.left,v=w.width,g=C):v+=w.kernedWidth;C&&!S&&(_=y+d+x,this.direction==="rtl"&&(_=this.width-_-v),f.fillStyle=C,f.fillRect(_,b,v,h/this.lineHeight)),b+=h}f.fillStyle=p,this._removeShadow(f)}},getFontCache:function(f){var h=f.fontFamily.toLowerCase();u.charWidthsCache[h]||(u.charWidthsCache[h]={});var d=u.charWidthsCache[h],p=f.fontStyle.toLowerCase()+"_"+(f.fontWeight+"").toLowerCase();return d[p]||(d[p]={}),d[p]},_measureChar:function(f,h,d,p){var m=this.getFontCache(h),g=this._getFontDeclaration(h),y=this._getFontDeclaration(p),b=d+f,x=g===y,v,w,C,S=h.fontSize/this.CACHE_FONT_SIZE,_;if(d&&m[d]!==void 0&&(C=m[d]),m[f]!==void 0&&(_=v=m[f]),x&&m[b]!==void 0&&(w=m[b],_=w-C),v===void 0||C===void 0||w===void 0){var $=this.getMeasuringContext();this._setTextStyles($,h,!0)}return v===void 0&&(_=v=$.measureText(f).width,m[f]=v),C===void 0&&x&&d&&(C=$.measureText(d).width,m[d]=C),x&&w===void 0&&(w=$.measureText(b).width,m[b]=w,_=w-C),{width:v*S,kernedWidth:_*S}},getHeightOfChar:function(f,h){return this.getValueOfPropertyAt(f,h,"fontSize")},measureLine:function(f){var h=this._measureLine(f);return this.charSpacing!==0&&(h.width-=this._getWidthOfCharSpacing()),h.width<0&&(h.width=0),h},_measureLine:function(f){var h=0,d,p,m=this._textLines[f],g,y,b=0,x=new Array(m.length),v=0,w,C,S=this.path,_=this.pathSide==="right";for(this.__charBounds[f]=x,d=0;d<m.length;d++)p=m[d],y=this._getGraphemeBox(p,f,d,g),x[d]=y,h+=y.kernedWidth,g=p;if(x[d]={left:y?y.left+y.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(C=S.segmentsInfo[S.segmentsInfo.length-1].length,w=u.util.getPointOnPath(S.path,0,S.segmentsInfo),w.x+=S.pathOffset.x,w.y+=S.pathOffset.y,this.textAlign){case"left":v=_?C-h:0;break;case"center":v=(C-h)/2;break;case"right":v=_?0:C-h;break}for(v+=this.pathStartOffset*(_?-1:1),d=_?m.length-1:0;_?d>=0:d<m.length;_?d--:d++)y=x[d],v>C?v%=C:v<0&&(v+=C),this._setGraphemeOnPath(v,y,w),v+=y.kernedWidth}return{width:h,numOfSpaces:b}},_setGraphemeOnPath:function(f,h,d){var p=f+h.kernedWidth/2,m=this.path,g=u.util.getPointOnPath(m.path,p,m.segmentsInfo);h.renderLeft=g.x-d.x,h.renderTop=g.y-d.y,h.angle=g.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(f,h,d,p,m){var g=this.getCompleteStyleDeclaration(h,d),y=p?this.getCompleteStyleDeclaration(h,d-1):{},b=this._measureChar(f,g,p,y),x=b.kernedWidth,v=b.width,w;this.charSpacing!==0&&(w=this._getWidthOfCharSpacing(),v+=w,x+=w);var C={width:v,left:0,height:g.fontSize,kernedWidth:x,deltaY:g.deltaY};if(d>0&&!m){var S=this.__charBounds[h][d-1];C.left=S.left+S.width+b.kernedWidth-b.width}return C},getHeightOfLine:function(f){if(this.__lineHeights[f])return this.__lineHeights[f];for(var h=this._textLines[f],d=this.getHeightOfChar(f,0),p=1,m=h.length;p<m;p++)d=Math.max(this.getHeightOfChar(f,p),d);return this.__lineHeights[f]=d*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var f,h=0,d=0,p=this._textLines.length;d<p;d++)f=this.getHeightOfLine(d),h+=d===p-1?f/this.lineHeight:f;return h},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(f,h){f.save();for(var d=0,p=this._getLeftOffset(),m=this._getTopOffset(),g=0,y=this._textLines.length;g<y;g++){var b=this.getHeightOfLine(g),x=b/this.lineHeight,v=this._getLineLeftOffset(g);this._renderTextLine(h,f,this._textLines[g],p+v,m+d+x,g),d+=b}f.restore()},_renderTextFill:function(f){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(f,"fillText")},_renderTextStroke:function(f){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this._setLineDash(f,this.strokeDashArray),f.beginPath(),this._renderTextCommon(f,"strokeText"),f.closePath(),f.restore())},_renderChars:function(f,h,d,p,m,g){var y=this.getHeightOfLine(g),b=this.textAlign.indexOf("justify")!==-1,x,v,w="",C,S=0,_,$=this.path,k=!b&&this.charSpacing===0&&this.isEmptyStyles(g)&&!$,E=this.direction==="ltr",F=this.direction==="ltr"?1:-1,T,I=h.canvas.getAttribute("dir");if(h.save(),I!==this.direction&&(h.canvas.setAttribute("dir",E?"ltr":"rtl"),h.direction=E?"ltr":"rtl",h.textAlign=E?"left":"right"),m-=y*this._fontSizeFraction/this.lineHeight,k){this._renderChar(f,h,g,0,d.join(""),p,m,y),h.restore();return}for(var D=0,N=d.length-1;D<=N;D++)_=D===N||this.charSpacing||$,w+=d[D],C=this.__charBounds[g][D],S===0?(p+=F*(C.kernedWidth-C.width),S+=C.width):S+=C.kernedWidth,b&&!_&&this._reSpaceAndTab.test(d[D])&&(_=!0),_||(x=x||this.getCompleteStyleDeclaration(g,D),v=this.getCompleteStyleDeclaration(g,D+1),_=u.util.hasStyleChanged(x,v,!1)),_&&($?(h.save(),h.translate(C.renderLeft,C.renderTop),h.rotate(C.angle),this._renderChar(f,h,g,D,w,-S/2,0,y),h.restore()):(T=p,this._renderChar(f,h,g,D,w,T,m,y)),w="",x=v,p+=F*S,S=0);h.restore()},_applyPatternGradientTransformText:function(f){var h=u.util.createCanvasElement(),d,p=this.width+this.strokeWidth,m=this.height+this.strokeWidth;return h.width=p,h.height=m,d=h.getContext("2d"),d.beginPath(),d.moveTo(0,0),d.lineTo(p,0),d.lineTo(p,m),d.lineTo(0,m),d.closePath(),d.translate(p/2,m/2),d.fillStyle=f.toLive(d),this._applyPatternGradientTransform(d,f),d.fill(),d.createPattern(h,"no-repeat")},handleFiller:function(f,h,d){var p,m;return d.toLive?d.gradientUnits==="percentage"||d.gradientTransform||d.patternTransform?(p=-this.width/2,m=-this.height/2,f.translate(p,m),f[h]=this._applyPatternGradientTransformText(d),{offsetX:p,offsetY:m}):(f[h]=d.toLive(f,this),this._applyPatternGradientTransform(f,d)):(f[h]=d,{offsetX:0,offsetY:0})},_setStrokeStyles:function(f,h){return f.lineWidth=h.strokeWidth,f.lineCap=this.strokeLineCap,f.lineDashOffset=this.strokeDashOffset,f.lineJoin=this.strokeLineJoin,f.miterLimit=this.strokeMiterLimit,this.handleFiller(f,"strokeStyle",h.stroke)},_setFillStyles:function(f,h){return this.handleFiller(f,"fillStyle",h.fill)},_renderChar:function(f,h,d,p,m,g,y){var b=this._getStyleDeclaration(d,p),x=this.getCompleteStyleDeclaration(d,p),v=f==="fillText"&&x.fill,w=f==="strokeText"&&x.stroke&&x.strokeWidth,C,S;!w&&!v||(h.save(),v&&(C=this._setFillStyles(h,x)),w&&(S=this._setStrokeStyles(h,x)),h.font=this._getFontDeclaration(x),b&&b.textBackgroundColor&&this._removeShadow(h),b&&b.deltaY&&(y+=b.deltaY),v&&h.fillText(m,g-C.offsetX,y-C.offsetY),w&&h.strokeText(m,g-S.offsetX,y-S.offsetY),h.restore())},setSuperscript:function(f,h){return this._setScript(f,h,this.superscript)},setSubscript:function(f,h){return this._setScript(f,h,this.subscript)},_setScript:function(f,h,d){var p=this.get2DCursorLocation(f,!0),m=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"fontSize"),g=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"deltaY"),y={fontSize:m*d.size,deltaY:g+m*d.baseline};return this.setSelectionStyles(y,f,h),this},_getLineLeftOffset:function(f){var h=this.getLineWidth(f),d=this.width-h,p=this.textAlign,m=this.direction,y,g=0,y=this.isEndOfWrapping(f);return p==="justify"||p==="justify-center"&&!y||p==="justify-right"&&!y||p==="justify-left"&&!y?0:(p==="center"&&(g=d/2),p==="right"&&(g=d),p==="justify-center"&&(g=d/2),p==="justify-right"&&(g=d),m==="rtl"&&(g-=d),g)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var f=this._forceClearCache;return f||(f=this.hasStateChanged("_dimensionAffectingProps")),f&&(this.dirty=!0,this._forceClearCache=!1),f},getLineWidth:function(f){if(this.__lineWidths[f]!==void 0)return this.__lineWidths[f];var h=this.measureLine(f),d=h.width;return this.__lineWidths[f]=d,d},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(f,h,d){var p=this._getStyleDeclaration(f,h);return p&&typeof p[d]<"u"?p[d]:this[d]},_renderTextDecoration:function(f,h){if(!(!this[h]&&!this.styleHas(h))){for(var d,p,m,g,y,b,x,v,w=this._getLeftOffset(),C=this._getTopOffset(),S,_,$,k,E,F,T,I,D=this.path,N=this._getWidthOfCharSpacing(),V=this.offsets[h],U=0,A=this._textLines.length;U<A;U++){if(d=this.getHeightOfLine(U),!this[h]&&!this.styleHas(h,U)){C+=d;continue}x=this._textLines[U],F=d/this.lineHeight,g=this._getLineLeftOffset(U),_=0,$=0,v=this.getValueOfPropertyAt(U,0,h),I=this.getValueOfPropertyAt(U,0,"fill"),S=C+F*(1-this._fontSizeFraction),p=this.getHeightOfChar(U,0),y=this.getValueOfPropertyAt(U,0,"deltaY");for(var M=0,P=x.length;M<P;M++)if(k=this.__charBounds[U][M],E=this.getValueOfPropertyAt(U,M,h),T=this.getValueOfPropertyAt(U,M,"fill"),m=this.getHeightOfChar(U,M),b=this.getValueOfPropertyAt(U,M,"deltaY"),D&&E&&T)f.save(),f.fillStyle=I,f.translate(k.renderLeft,k.renderTop),f.rotate(k.angle),f.fillRect(-k.kernedWidth/2,V*m+b,k.kernedWidth,this.fontSize/15),f.restore();else if((E!==v||T!==I||m!==p||b!==y)&&$>0){var j=w+g+_;this.direction==="rtl"&&(j=this.width-j-$),v&&I&&(f.fillStyle=I,f.fillRect(j,S+V*p+y,$,this.fontSize/15)),_=k.left,$=k.width,v=E,I=T,p=m,y=b}else $+=k.kernedWidth;var j=w+g+_;this.direction==="rtl"&&(j=this.width-j-$),f.fillStyle=T,E&&T&&f.fillRect(j,S+V*p+y,$-N,this.fontSize/15),C+=d}this._removeShadow(f)}},_getFontDeclaration:function(f,h){var d=f||this,p=this.fontFamily,m=u.Text.genericFonts.indexOf(p.toLowerCase())>-1,g=p===void 0||p.indexOf("'")>-1||p.indexOf(",")>-1||p.indexOf('"')>-1||m?d.fontFamily:'"'+d.fontFamily+'"';return[u.isLikelyNode?d.fontWeight:d.fontStyle,u.isLikelyNode?d.fontStyle:d.fontWeight,h?this.CACHE_FONT_SIZE+"px":d.fontSize+"px",g].join(" ")},render:function(f){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",f)))},_splitTextIntoLines:function(f){for(var h=f.split(this._reNewline),d=new Array(h.length),p=[`
`],m=[],g=0;g<h.length;g++)d[g]=u.util.string.graphemeSplit(h[g]),m=m.concat(d[g],p);return m.pop(),{_unwrappedLines:d,lines:h,graphemeText:m,graphemeLines:d}},toObject:function(f){var h=c.concat(f),d=this.callSuper("toObject",h);return d.styles=u.util.stylesToArray(this.styles,this.text),d.path&&(d.path=this.path.toObject()),d},set:function(f,h){this.callSuper("set",f,h);var d=!1,p=!1;if(typeof f=="object")for(var m in f)m==="path"&&this.setPathInfo(),d=d||this._dimensionAffectingProps.indexOf(m)!==-1,p=p||m==="path";else d=this._dimensionAffectingProps.indexOf(f)!==-1,p=f==="path";return p&&this.setPathInfo(),d&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),u.Text.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),u.Text.DEFAULT_SVG_FONT_SIZE=16,u.Text.fromElement=function(f,h,d){if(!f)return h(null);var p=u.parseAttributes(f,u.Text.ATTRIBUTE_NAMES),m=p.textAnchor||"left";if(d=u.util.object.extend(d?l(d):{},p),d.top=d.top||0,d.left=d.left||0,p.textDecoration){var g=p.textDecoration;g.indexOf("underline")!==-1&&(d.underline=!0),g.indexOf("overline")!==-1&&(d.overline=!0),g.indexOf("line-through")!==-1&&(d.linethrough=!0),delete d.textDecoration}"dx"in p&&(d.left+=p.dx),"dy"in p&&(d.top+=p.dy),"fontSize"in d||(d.fontSize=u.Text.DEFAULT_SVG_FONT_SIZE);var y="";"textContent"in f?y=f.textContent:"firstChild"in f&&f.firstChild!==null&&"data"in f.firstChild&&f.firstChild.data!==null&&(y=f.firstChild.data),y=y.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var b=d.strokeWidth;d.strokeWidth=0;var x=new u.Text(y,d),v=x.getScaledHeight()/x.height,w=(x.height+x.strokeWidth)*x.lineHeight-x.height,C=w*v,S=x.getScaledHeight()+C,_=0;m==="center"&&(_=x.getScaledWidth()/2),m==="right"&&(_=x.getScaledWidth()),x.set({left:x.left-_,top:x.top-(S-x.fontSize*(.07+x._fontSizeFraction))/x.lineHeight,strokeWidth:typeof b<"u"?b:1}),h(x)},u.Text.fromObject=function(f,h){var d=l(f),p=f.path;return delete d.path,u.Object._fromObject("Text",d,function(m){m.styles=u.util.stylesFromArray(f.styles,f.text),p?u.Object._fromObject("Path",p,function(g){m.set("path",g),h(m)},"path"):h(m)},"text")},u.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],u.util.createAccessors&&u.util.createAccessors(u.Text)}(e),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(a){if(!this.styles||typeof a<"u"&&!this.styles[a])return!0;var u=typeof a>"u"?this.styles:{line:this.styles[a]};for(var l in u)for(var c in u[l])for(var f in u[l][c])return!1;return!0},styleHas:function(a,u){if(!this.styles||!a||a===""||typeof u<"u"&&!this.styles[u])return!1;var l=typeof u>"u"?this.styles:{0:this.styles[u]};for(var c in l)for(var f in l[c])if(typeof l[c][f][a]<"u")return!0;return!1},cleanStyle:function(a){if(!this.styles||!a||a==="")return!1;var u=this.styles,l=0,c,f,h=!0,d=0,p;for(var m in u){c=0;for(var g in u[m]){var p=u[m][g],y=p.hasOwnProperty(a);l++,y?(f?p[a]!==f&&(h=!1):f=p[a],p[a]===this[a]&&delete p[a]):h=!1,Object.keys(p).length!==0?c++:delete u[m][g]}c===0&&delete u[m]}for(var b=0;b<this._textLines.length;b++)d+=this._textLines[b].length;h&&l===d&&(this[a]=f,this.removeStyle(a))},removeStyle:function(a){if(!(!this.styles||!a||a==="")){var u=this.styles,l,c,f;for(c in u){l=u[c];for(f in l)delete l[f][a],Object.keys(l[f]).length===0&&delete l[f];Object.keys(l).length===0&&delete u[c]}}},_extendStyles:function(a,u){var l=this.get2DCursorLocation(a);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),u)},get2DCursorLocation:function(a,u){typeof a>"u"&&(a=this.selectionStart);for(var l=u?this._unwrappedTextLines:this._textLines,c=l.length,f=0;f<c;f++){if(a<=l[f].length)return{lineIndex:f,charIndex:a};a-=l[f].length+this.missingNewlineOffset(f)}return{lineIndex:f-1,charIndex:l[f-1].length<a?l[f-1].length:a}},getSelectionStyles:function(a,u,l){typeof a>"u"&&(a=this.selectionStart||0),typeof u>"u"&&(u=this.selectionEnd||a);for(var c=[],f=a;f<u;f++)c.push(this.getStyleAtPosition(f,l));return c},getStyleAtPosition:function(a,u){var l=this.get2DCursorLocation(a),c=u?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex);return c||{}},setSelectionStyles:function(a,u,l){typeof u>"u"&&(u=this.selectionStart||0),typeof l>"u"&&(l=this.selectionEnd||u);for(var c=u;c<l;c++)this._extendStyles(c,a);return this._forceClearCache=!0,this},_getStyleDeclaration:function(a,u){var l=this.styles&&this.styles[a];return l?l[u]:null},getCompleteStyleDeclaration:function(a,u){for(var l=this._getStyleDeclaration(a,u)||{},c={},f,h=0;h<this._styleProperties.length;h++)f=this._styleProperties[h],c[f]=typeof l[f]>"u"?this[f]:l[f];return c},_setStyleDeclaration:function(a,u,l){this.styles[a][u]=l},_deleteStyleDeclaration:function(a,u){delete this.styles[a][u]},_getLineStyle:function(a){return!!this.styles[a]},_setLineStyle:function(a){this.styles[a]={}},_deleteLineStyle:function(a){delete this.styles[a]}})}(),function(){function a(u){u.textDecoration&&(u.textDecoration.indexOf("underline")>-1&&(u.underline=!0),u.textDecoration.indexOf("line-through")>-1&&(u.linethrough=!0),u.textDecoration.indexOf("overline")>-1&&(u.overline=!0),delete u.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(u,l){this.callSuper("initialize",u,l),this.initBehavior()},setSelectionStart:function(u){u=Math.max(u,0),this._updateAndFire("selectionStart",u)},setSelectionEnd:function(u){u=Math.min(u,this.text.length),this._updateAndFire("selectionEnd",u)},_updateAndFire:function(u,l){this[u]!==l&&(this._fireSelectionChanged(),this[u]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(u){this.clearContextTop(),this.callSuper("render",u),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(u){this.callSuper("_render",u)},clearContextTop:function(u){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this.canvas.contextTop,c=this.canvas.viewportTransform;l.save(),l.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this.transform(l),this._clearTextArea(l),u||l.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var u=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(u,l):this.renderSelection(u,l),l.restore()}},_clearTextArea:function(u){var l=this.width+4,c=this.height+4;u.clearRect(-l/2,-c/2,l,c)},_getCursorBoundaries:function(u){typeof u>"u"&&(u=this.selectionStart);var l=this._getLeftOffset(),c=this._getTopOffset(),f=this._getCursorBoundariesOffsets(u);return{left:l,top:c,leftOffset:f.left,topOffset:f.top}},_getCursorBoundariesOffsets:function(u){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,c,f,h=0,d=0,p,m=this.get2DCursorLocation(u);f=m.charIndex,c=m.lineIndex;for(var g=0;g<c;g++)h+=this.getHeightOfLine(g);l=this._getLineLeftOffset(c);var y=this.__charBounds[c][f];return y&&(d=y.left),this.charSpacing!==0&&f===this._textLines[c].length&&(d-=this._getWidthOfCharSpacing()),p={top:h,left:l+(d>0?d:0)},this.direction==="rtl"&&(p.left*=-1),this.cursorOffsetCache=p,this.cursorOffsetCache},renderCursor:function(u,l){var c=this.get2DCursorLocation(),f=c.lineIndex,h=c.charIndex>0?c.charIndex-1:0,d=this.getValueOfPropertyAt(f,h,"fontSize"),p=this.scaleX*this.canvas.getZoom(),m=this.cursorWidth/p,g=u.topOffset,y=this.getValueOfPropertyAt(f,h,"deltaY");g+=(1-this._fontSizeFraction)*this.getHeightOfLine(f)/this.lineHeight-d*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(u,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(f,h,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(u.left+u.leftOffset-m/2,g+u.top+y,m,d)},renderSelection:function(u,l){for(var c=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,f=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,h=this.textAlign.indexOf("justify")!==-1,d=this.get2DCursorLocation(c),p=this.get2DCursorLocation(f),m=d.lineIndex,g=p.lineIndex,y=d.charIndex<0?0:d.charIndex,b=p.charIndex<0?0:p.charIndex,x=m;x<=g;x++){var v=this._getLineLeftOffset(x)||0,w=this.getHeightOfLine(x),C=0,S=0,_=0;if(x===m&&(S=this.__charBounds[m][y].left),x>=m&&x<g)_=h&&!this.isEndOfWrapping(x)?this.width:this.getLineWidth(x)||5;else if(x===g)if(b===0)_=this.__charBounds[g][b].left;else{var $=this._getWidthOfCharSpacing();_=this.__charBounds[g][b-1].left+this.__charBounds[g][b-1].width-$}C=w,(this.lineHeight<1||x===g&&this.lineHeight>1)&&(w/=this.lineHeight);var k=u.left+v+S,E=_-S,F=w,T=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",F=1,T=w):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(k=this.width-k-E),l.fillRect(k,u.top+u.topOffset+T,E,F),u.topOffset+=C}},getCurrentCharFontSize:function(){var u=this._getCurrentCharIndex();return this.getValueOfPropertyAt(u.l,u.c,"fontSize")},getCurrentCharColor:function(){var u=this._getCurrentCharIndex();return this.getValueOfPropertyAt(u.l,u.c,"fill")},_getCurrentCharIndex:function(){var u=this.get2DCursorLocation(this.selectionStart,!0),l=u.charIndex>0?u.charIndex-1:0;return{l:u.lineIndex,c:l}}}),t.IText.fromObject=function(u,l){var c=t.util.stylesFromArray(u.styles,u.text),f=Object.assign({},u,{styles:c});if(a(f),f.styles)for(var h in f.styles)for(var d in f.styles[h])a(f.styles[h][d]);t.Object._fromObject("IText",f,l,"text")}}(),function(){var a=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var u=this;this.on("added",function(){var l=u.canvas;l&&(l._hasITextHandlers||(l._hasITextHandlers=!0,u._initCanvasHandlers(l)),l._iTextInstances=l._iTextInstances||[],l._iTextInstances.push(u))})},initRemovedHandler:function(){var u=this;this.on("removed",function(){var l=u.canvas;l&&(l._iTextInstances=l._iTextInstances||[],t.util.removeFromArray(l._iTextInstances,u),l._iTextInstances.length===0&&(l._hasITextHandlers=!1,u._removeCanvasHandlers(l)))})},_initCanvasHandlers:function(u){u._mouseUpITextHandler=function(){u._iTextInstances&&u._iTextInstances.forEach(function(l){l.__isMousedown=!1})},u.on("mouse:up",u._mouseUpITextHandler)},_removeCanvasHandlers:function(u){u.off("mouse:up",u._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(u,l,c,f){var h;return h={isAborted:!1,abort:function(){this.isAborted=!0}},u.animate("_currentCursorOpacity",l,{duration:c,onComplete:function(){h.isAborted||u[f]()},onChange:function(){u.canvas&&u.selectionStart===u.selectionEnd&&u.renderCursorOrSelection()},abort:function(){return h.isAborted}}),h},_onTickComplete:function(){var u=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){u._currentTickCompleteState=u._animateCursor(u,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(u){var l=this,c=u?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){l._tick()},c)},abortCursorAnimation:function(){var u=this._currentTickState||this._currentTickCompleteState,l=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,u&&l&&l.clearContext(l.contextTop||l.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(u){var l=0,c=u-1;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)l++,c--;for(;/\S/.test(this._text[c])&&c>-1;)l++,c--;return u-l},findWordBoundaryRight:function(u){var l=0,c=u;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)l++,c++;for(;/\S/.test(this._text[c])&&c<this._text.length;)l++,c++;return u+l},findLineBoundaryLeft:function(u){for(var l=0,c=u-1;!/\n/.test(this._text[c])&&c>-1;)l++,c--;return u-l},findLineBoundaryRight:function(u){for(var l=0,c=u;!/\n/.test(this._text[c])&&c<this._text.length;)l++,c++;return u+l},searchWordBoundary:function(u,l){for(var c=this._text,f=this._reSpace.test(c[u])?u-1:u,h=c[f],d=t.reNonWord;!d.test(h)&&f>0&&f<c.length;)f+=l,h=c[f];return d.test(h)&&(f+=l===1?0:1),f},selectWord:function(u){u=u||this.selectionStart;var l=this.searchWordBoundary(u,-1),c=this.searchWordBoundary(u,1);this.selectionStart=l,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(u){u=u||this.selectionStart;var l=this.findLineBoundaryLeft(u),c=this.findLineBoundaryRight(u);return this.selectionStart=l,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(u){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(u),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(u){u._iTextInstances&&u._iTextInstances.forEach(function(l){l.selected=!1,l.isEditing&&l.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(u){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var l=this.getSelectionStartFromPointer(u.e),c=this.selectionStart,f=this.selectionEnd;(l!==this.__selectionStartOnMouseDown||c===f)&&(c===l||f===l)||(l>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=l):(this.selectionStart=l,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==c||this.selectionEnd!==f)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(u,l,c){var f=c.slice(0,u),h=t.util.string.graphemeSplit(f).length;if(u===l)return{selectionStart:h,selectionEnd:h};var d=c.slice(u,l),p=t.util.string.graphemeSplit(d).length;return{selectionStart:h,selectionEnd:h+p}},fromGraphemeToStringSelection:function(u,l,c){var f=c.slice(0,u),h=f.join("").length;if(u===l)return{selectionStart:h,selectionEnd:h};var d=c.slice(u,l),p=d.join("").length;return{selectionStart:h,selectionEnd:h+p}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var u=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=u.selectionStart,this.hiddenTextarea.selectionEnd=u.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var u=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=u.selectionEnd,this.inCompositionMode||(this.selectionStart=u.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var u=this._calcTextareaPosition();this.hiddenTextarea.style.left=u.left,this.hiddenTextarea.style.top=u.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var u=this.inCompositionMode?this.compositionStart:this.selectionStart,l=this._getCursorBoundaries(u),c=this.get2DCursorLocation(u),f=c.lineIndex,h=c.charIndex,d=this.getValueOfPropertyAt(f,h,"fontSize")*this.lineHeight,p=l.leftOffset,m=this.calcTransformMatrix(),g={x:l.left+p,y:l.top+l.topOffset+d},y=this.canvas.getRetinaScaling(),b=this.canvas.upperCanvasEl,x=b.width/y,v=b.height/y,w=x-d,C=v-d,S=b.clientWidth/x,_=b.clientHeight/v;return g=t.util.transformPoint(g,m),g=t.util.transformPoint(g,this.canvas.viewportTransform),g.x*=S,g.y*=_,g.x<0&&(g.x=0),g.x>w&&(g.x=w),g.y<0&&(g.y=0),g.y>C&&(g.y=C),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:g.x+"px",top:g.y+"px",fontSize:d+"px",charHeight:d}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var u=this._textBeforeEdit!==this.text,l=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,l&&(l.blur&&l.blur(),l.parentNode&&l.parentNode.removeChild(l)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),u&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),u&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var u in this.styles)this._textLines[u]||delete this.styles[u]},removeStyleFromTo:function(u,l){var c=this.get2DCursorLocation(u,!0),f=this.get2DCursorLocation(l,!0),h=c.lineIndex,d=c.charIndex,p=f.lineIndex,m=f.charIndex,g,y;if(h!==p){if(this.styles[h])for(g=d;g<this._unwrappedTextLines[h].length;g++)delete this.styles[h][g];if(this.styles[p])for(g=m;g<this._unwrappedTextLines[p].length;g++)y=this.styles[p][g],y&&(this.styles[h]||(this.styles[h]={}),this.styles[h][d+g-m]=y);for(g=h+1;g<=p;g++)delete this.styles[g];this.shiftLineStyles(p,h-p)}else if(this.styles[h]){y=this.styles[h];var b=m-d,x,v;for(g=d;g<m;g++)delete y[g];for(v in this.styles[h])x=parseInt(v,10),x>=m&&(y[x-b]=y[v],delete y[v])}},shiftLineStyles:function(u,l){var c=a(this.styles);for(var f in this.styles){var h=parseInt(f,10);h>u&&(this.styles[h+l]=c[h],c[h-l]||delete this.styles[h])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(u,l,c,f){var h,d={},p=!1,m=this._unwrappedTextLines[u].length===l;c||(c=1),this.shiftLineStyles(u,c),this.styles[u]&&(h=this.styles[u][l===0?l:l-1]);for(var g in this.styles[u]){var y=parseInt(g,10);y>=l&&(p=!0,d[y-l]=this.styles[u][g],m&&l===0||delete this.styles[u][g])}var b=!1;for(p&&!m&&(this.styles[u+c]=d,b=!0),b&&c--;c>0;)f&&f[c-1]?this.styles[u+c]={0:a(f[c-1])}:h?this.styles[u+c]={0:a(h)}:delete this.styles[u+c],c--;this._forceClearCache=!0},insertCharStyleObject:function(u,l,c,f){this.styles||(this.styles={});var h=this.styles[u],d=h?a(h):{};c||(c=1);for(var p in d){var m=parseInt(p,10);m>=l&&(h[m+c]=d[m],d[m-c]||delete h[m])}if(this._forceClearCache=!0,f){for(;c--;)Object.keys(f[c]).length&&(this.styles[u]||(this.styles[u]={}),this.styles[u][l+c]=a(f[c]));return}if(h)for(var g=h[l?l-1:1];g&&c--;)this.styles[u][l+c]=a(g)},insertNewStyleBlock:function(u,l,c){for(var f=this.get2DCursorLocation(l,!0),h=[0],d=0,p=0;p<u.length;p++)u[p]===`
`?(d++,h[d]=0):h[d]++;h[0]>0&&(this.insertCharStyleObject(f.lineIndex,f.charIndex,h[0],c),c=c&&c.slice(h[0]+1)),d&&this.insertNewlineStyleObject(f.lineIndex,f.charIndex+h[0],d);for(var p=1;p<d;p++)h[p]>0?this.insertCharStyleObject(f.lineIndex+p,0,h[p],c):c&&this.styles[f.lineIndex+p]&&c[0]&&(this.styles[f.lineIndex+p][0]=c[0]),c=c&&c.slice(h[p]+1);h[p]>0&&this.insertCharStyleObject(f.lineIndex+p,0,h[p],c)},setSelectionStartEndWithShift:function(u,l,c){c<=u?(l===u?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=u),this.selectionStart=c):c>u&&c<l?this._selectionDirection==="right"?this.selectionEnd=c:this.selectionStart=c:(l===u?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=l),this.selectionEnd=c)},setSelectionInBoundaries:function(){var u=this.text.length;this.selectionStart>u?this.selectionStart=u:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>u?this.selectionEnd=u:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(a){if(this.canvas){this.__newClickTime=+new Date;var u=a.pointer;this.isTripleClick(u)&&(this.fire("tripleclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=u,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(a){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(a.e))},tripleClickHandler:function(a){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(a.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(a.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(a){if(this.__isMousedown=!1,!(!this.editable||this.group||a.transform&&a.transform.actionPerformed||a.e.button&&a.e.button!==1)){if(this.canvas){var u=this.canvas._activeObject;if(u&&u!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(a){var u=this.getSelectionStartFromPointer(a),l=this.selectionStart,c=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(l,c,u):(this.selectionStart=u,this.selectionEnd=u),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(a){for(var u=this.getLocalPointer(a),l=0,c=0,f=0,h=0,d=0,p,m,g=0,y=this._textLines.length;g<y&&f<=u.y;g++)f+=this.getHeightOfLine(g)*this.scaleY,d=g,g>0&&(h+=this._textLines[g-1].length+this.missingNewlineOffset(g-1));p=this._getLineLeftOffset(d),c=p*this.scaleX,m=this._textLines[d],this.direction==="rtl"&&(u.x=this.width*this.scaleX-u.x+c);for(var b=0,x=m.length;b<x&&(l=c,c+=this.__charBounds[d][b].kernedWidth*this.scaleX,c<=u.x);b++)h++;return this._getNewSelectionStartFromOffset(u,l,c,h,x)},_getNewSelectionStartFromOffset:function(a,u,l,c,f){var h=a.x-u,d=l-a.x,p=d>h||d<0?0:1,m=c+p;return this.flipX&&(m=f-m),m>this._text.length&&(m=this._text.length),m}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+a.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){var u=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(a.keyCode in u)this[u[a.keyCode]](a);else if(a.keyCode in this.ctrlKeysMapDown&&(a.ctrlKey||a.metaKey))this[this.ctrlKeysMapDown[a.keyCode]](a);else return;a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(a){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(a.keyCode in this.ctrlKeysMapUp&&(a.ctrlKey||a.metaKey))this[this.ctrlKeysMapUp[a.keyCode]](a);else return;a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(a){var u=this.fromPaste;if(this.fromPaste=!1,a&&a.stopPropagation(),!!this.isEditing){var l=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,c=this._text.length,f=l.length,h,d,p=f-c,m=this.selectionStart,g=this.selectionEnd,y=m!==g,b,x,v;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var w=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=m>w.selectionStart;y?(h=this._text.slice(m,g),p+=g-m):f<c&&(C?h=this._text.slice(g+p,g):h=this._text.slice(m,m-p)),d=l.slice(w.selectionEnd-p,w.selectionEnd),h&&h.length&&(d.length&&(b=this.getSelectionStyles(m,m+1,!1),b=d.map(function(){return b[0]})),y?(x=m,v=g):C?(x=g-h.length,v=g):(x=g,v=g+h.length),this.removeStyleFromTo(x,v)),d.length&&(u&&d.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(b=t.copiedTextStyle),this.insertNewStyleBlock(d,m,b)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(a){this.compositionStart=a.target.selectionStart,this.compositionEnd=a.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(a){return a&&a.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(a,u){var l=this._getLineLeftOffset(a),c;return u>0&&(c=this.__charBounds[a][u-1],l+=c.left+c.width),l},getDownCursorOffset:function(a,u){var l=this._getSelectionForOffset(a,u),c=this.get2DCursorLocation(l),f=c.lineIndex;if(f===this._textLines.length-1||a.metaKey||a.keyCode===34)return this._text.length-l;var h=c.charIndex,d=this._getWidthBeforeCursor(f,h),p=this._getIndexOnLine(f+1,d),m=this._textLines[f].slice(h);return m.length+p+1+this.missingNewlineOffset(f)},_getSelectionForOffset:function(a,u){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&u?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(a,u){var l=this._getSelectionForOffset(a,u),c=this.get2DCursorLocation(l),f=c.lineIndex;if(f===0||a.metaKey||a.keyCode===33)return-l;var h=c.charIndex,d=this._getWidthBeforeCursor(f,h),p=this._getIndexOnLine(f-1,d),m=this._textLines[f].slice(0,h),g=this.missingNewlineOffset(f-1);return-this._textLines[f-1].length+p-m.length+(1-g)},_getIndexOnLine:function(a,u){for(var l=this._textLines[a],c=this._getLineLeftOffset(a),f=c,h=0,d,p,m=0,g=l.length;m<g;m++)if(d=this.__charBounds[a][m].width,f+=d,f>u){p=!0;var y=f-d,b=f,x=Math.abs(y-u),v=Math.abs(b-u);h=v<x?m:m-1;break}return p||(h=l.length-1),h},moveCursorDown:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(a,u){var l="get"+a+"CursorOffset",c=this[l](u,this._selectionDirection==="right");u.shiftKey?this.moveCursorWithShift(c):this.moveCursorWithoutShift(c),c!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(a){var u=this._selectionDirection==="left"?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,u),a!==0},moveCursorWithoutShift:function(a){return a<0?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),a!==0},moveCursorLeft:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",a)},_move:function(a,u,l){var c;if(a.altKey)c=this["findWordBoundary"+l](this[u]);else if(a.metaKey||a.keyCode===35||a.keyCode===36)c=this["findLineBoundary"+l](this[u]);else return this[u]+=l==="Left"?-1:1,!0;if(typeof c<"u"&&this[u]!==c)return this[u]=c,!0},_moveLeft:function(a,u){return this._move(a,u,"Left")},_moveRight:function(a,u){return this._move(a,u,"Right")},moveCursorLeftWithoutShift:function(a){var u=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(u=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,u},moveCursorLeftWithShift:function(a){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(a,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(a,"selectionStart")},moveCursorRight:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(a,u){var l="moveCursor"+a+"With";this._currentCursorOpacity=1,u.shiftKey?l+="Shift":l+="outShift",this[l](u)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(a){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(a,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(a,"selectionEnd")},moveCursorRightWithoutShift:function(a){var u=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(u=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,u},removeChars:function(a,u){typeof u>"u"&&(u=a+1),this.removeStyleFromTo(a,u),this._text.splice(a,u-a),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(a,u,l,c){typeof c>"u"&&(c=l),c>l&&this.removeStyleFromTo(l,c);var f=t.util.string.graphemeSplit(a);this.insertNewStyleBlock(f,l,u),this._text=[].concat(this._text.slice(0,l),f,this._text.slice(c)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var a=t.util.toFixed,u=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),c=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(c)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var c=!0,f=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",f?'text-decoration="'+f+'" ':"",'style="',this.getSvgStyles(c),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,c){var f=[],h=[],d=l,p;this._setSVGBg(h);for(var m=0,g=this._textLines.length;m<g;m++)p=this._getLineLeftOffset(m),(this.textBackgroundColor||this.styleHas("textBackgroundColor",m))&&this._setSVGTextLineBg(h,m,c+p,d),this._setSVGTextLineText(f,m,c+p,d),d+=this.getHeightOfLine(m);return{textSpans:f,textBgRects:h}},_createTextCharSpan:function(l,c,f,h){var d=l!==l.trim()||l.match(u),p=this.getSvgSpanStyles(c,d),m=p?'style="'+p+'"':"",g=c.deltaY,y="",b=t.Object.NUM_FRACTION_DIGITS;return g&&(y=' dy="'+a(g,b)+'" '),['<tspan x="',a(f,b),'" y="',a(h,b),'" ',y,m,">",t.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,c,f,h){var d=this.getHeightOfLine(c),p=this.textAlign.indexOf("justify")!==-1,m,g,y="",b,x,v=0,w=this._textLines[c],C;h+=d*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,_=w.length-1;S<=_;S++)C=S===_||this.charSpacing,y+=w[S],b=this.__charBounds[c][S],v===0?(f+=b.kernedWidth-b.width,v+=b.width):v+=b.kernedWidth,p&&!C&&this._reSpaceAndTab.test(w[S])&&(C=!0),C||(m=m||this.getCompleteStyleDeclaration(c,S),g=this.getCompleteStyleDeclaration(c,S+1),C=t.util.hasStyleChanged(m,g,!0)),C&&(x=this._getStyleDeclaration(c,S)||{},l.push(this._createTextCharSpan(y,x,f,h)),y="",m=g,f+=v,v=0)},_pushTextBgRect:function(l,c,f,h,d,p){var m=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(c),' x="',a(f,m),'" y="',a(h,m),'" width="',a(d,m),'" height="',a(p,m),`"></rect>
`)},_setSVGTextLineBg:function(l,c,f,h){for(var d=this._textLines[c],p=this.getHeightOfLine(c)/this.lineHeight,m=0,g=0,y,b,x=this.getValueOfPropertyAt(c,0,"textBackgroundColor"),v=0,w=d.length;v<w;v++)y=this.__charBounds[c][v],b=this.getValueOfPropertyAt(c,v,"textBackgroundColor"),b!==x?(x&&this._pushTextBgRect(l,x,f+g,h,m,p),g=y.left,m=y.width,x=b):m+=y.kernedWidth;b&&this._pushTextBgRect(l,b,f+g,h,m,p)},_getFillAttributes:function(l){var c=l&&typeof l=="string"?new t.Color(l):"";return!c||!c.getSource()||c.getAlpha()===1?'fill="'+l+'"':'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var c=0,f=0,h=0;h<l;h++)c+=this.getHeightOfLine(h);return f=this.getHeightOfLine(h),{lineTop:c,offset:(this._fontSizeMult-this._fontSizeFraction)*f/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var c=t.Object.prototype.getSvgStyles.call(this,l);return c+" white-space: pre;"}})}(),function(a){var u=a.fabric||(a.fabric={});u.Textbox=u.util.createClass(u.IText,u.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:u.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var c=0,f=0,h=0,d={},p=0;p<l.graphemeLines.length;p++)l.graphemeText[h]===`
`&&p>0?(f=0,h++,c++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[h])&&p>0&&(f++,h++),d[p]={line:c,offset:f},h+=l.graphemeLines[p].length,f+=l.graphemeLines[p].length;return d},styleHas:function(l,c){if(this._styleMap&&!this.isWrapping){var f=this._styleMap[c];f&&(c=f.line)}return u.Text.prototype.styleHas.call(this,l,c)},isEmptyStyles:function(l){if(!this.styles)return!0;var c=0,f=l+1,h,d,p=!1,m=this._styleMap[l],g=this._styleMap[l+1];m&&(l=m.line,c=m.offset),g&&(f=g.line,p=f===l,h=g.offset),d=typeof l>"u"?this.styles:{line:this.styles[l]};for(var y in d)for(var b in d[y])if(b>=c&&(!p||b<h))for(var x in d[y][b])return!1;return!0},_getStyleDeclaration:function(l,c){if(this._styleMap&&!this.isWrapping){var f=this._styleMap[l];if(!f)return null;l=f.line,c=f.offset+c}return this.callSuper("_getStyleDeclaration",l,c)},_setStyleDeclaration:function(l,c,f){var h=this._styleMap[l];l=h.line,c=h.offset+c,this.styles[l][c]=f},_deleteStyleDeclaration:function(l,c){var f=this._styleMap[l];l=f.line,c=f.offset+c,delete this.styles[l][c]},_getLineStyle:function(l){var c=this._styleMap[l];return!!this.styles[c.line]},_setLineStyle:function(l){var c=this._styleMap[l];this.styles[c.line]={}},_wrapText:function(l,c){var f=[],h;for(this.isWrapping=!0,h=0;h<l.length;h++)f=f.concat(this._wrapLine(l[h],h,c));return this.isWrapping=!1,f},_measureWord:function(l,c,f){var h=0,d,p=!0;f=f||0;for(var m=0,g=l.length;m<g;m++){var y=this._getGraphemeBox(l[m],c,m+f,d,p);h+=y.kernedWidth,d=l[m]}return h},_wrapLine:function(l,c,f,k){var d=0,p=this.splitByGrapheme,m=[],g=[],y=p?u.util.string.graphemeSplit(l):l.split(this._wordJoiners),b="",x=0,v=p?"":" ",w=0,C=0,S=0,_=!0,$=this._getWidthOfCharSpacing(),k=k||0;y.length===0&&y.push([]),f-=k;for(var E=0;E<y.length;E++)b=p?y[E]:u.util.string.graphemeSplit(y[E]),w=this._measureWord(b,c,x),x+=b.length,d+=C+w-$,d>f&&!_?(m.push(g),g=[],d=w,_=!0):d+=$,!_&&!p&&g.push(v),g=g.concat(b),C=p?0:this._measureWord([v],c,x),x++,_=!1,w>S&&(S=w);return E&&m.push(g),S+k>this.dynamicMinWidth&&(this.dynamicMinWidth=S-$+k),m},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var c=u.Text.prototype._splitTextIntoLines.call(this,l),f=this._wrapText(c.lines,this.width),h=new Array(f.length),d=0;d<f.length;d++)h[d]=f[d].join("");return c.lines=h,c.graphemeLines=f,c},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var c in this._styleMap)this._textLines[c]&&(l[this._styleMap[c].line]=1);for(var c in this.styles)l[c]||delete this.styles[c]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),u.Textbox.fromObject=function(l,c){var f=u.util.stylesFromArray(l.styles,l.text),h=Object.assign({},l,{styles:f});return u.Object._fromObject("Textbox",h,c,"text")}}(e),function(){var a=t.controlsUtils,u=a.scaleSkewCursorStyleHandler,l=a.scaleCursorStyleHandler,c=a.scalingEqually,f=a.scalingYOrSkewingX,h=a.scalingXOrSkewingY,d=a.scaleOrSkewActionName,p=t.Object.prototype.controls;if(p.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:u,actionHandler:h,getActionName:d}),p.mr=new t.Control({x:.5,y:0,cursorStyleHandler:u,actionHandler:h,getActionName:d}),p.mb=new t.Control({x:0,y:.5,cursorStyleHandler:u,actionHandler:f,getActionName:d}),p.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:u,actionHandler:f,getActionName:d}),p.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:c}),p.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:c}),p.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:c}),p.br=new t.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:c}),p.mtr=new t.Control({x:0,y:-.5,actionHandler:a.rotationWithSnapping,cursorStyleHandler:a.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var m=t.Textbox.prototype.controls={};m.mtr=p.mtr,m.tr=p.tr,m.br=p.br,m.tl=p.tl,m.bl=p.bl,m.mt=p.mt,m.mb=p.mb,m.mr=new t.Control({x:.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:u,actionName:"resizing"}),m.ml=new t.Control({x:-.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:u,actionName:"resizing"})}}()})(tae);function fGe(e){let t,n,r,i,s,o,a,u,l,c;return{c(){t=gd("div"),n=gd("div"),r=gd("canvas"),i=m$(),s=gd("button"),o=VQ("Effacer"),a=m$(),u=gd("canvas"),this.h()},l(f){t=md(f,"DIV",{class:!0});var h=yd(t);n=md(h,"DIV",{class:!0});var d=yd(n);r=md(d,"CANVAS",{class:!0,id:!0,width:!0,height:!0}),yd(r).forEach(go),d.forEach(go),i=y$(h),s=md(h,"BUTTON",{id:!0});var p=yd(s);o=GQ(p,"Effacer"),p.forEach(go),a=y$(h),u=md(h,"CANVAS",{id:!0,style:!0,width:!0,height:!0}),yd(u).forEach(go),h.forEach(go),this.h()},h(){Jo(r,"class","drawcanvas"),Jo(r,"id","canvas"),Jo(r,"width","140"),Jo(r,"height","140"),Jo(n,"class","input-canvas-wrapper svelte-1na61ny"),Jo(s,"id","clear-canvas"),Jo(u,"id","scaled-canvas"),w2e(u,"display","none"),Jo(u,"width","28"),Jo(u,"height","28"),Jo(t,"class","numbers with-normalizer svelte-1na61ny")},m(f,h){gb(f,t,h),Nc(t,n),Nc(n,r),Nc(t,i),Nc(t,s),Nc(s,o),Nc(t,a),Nc(t,u),l||(c=C2e(s,"click",e[0]),l=!0)},p:jO,i:jO,o:jO,d(f){f&&go(t),l=!1,c()}}}const hGe=50;function dGe(e){const t=e.getContext(),n=document.getElementById("scaled-canvas").getContext("2d",{willReadFrequently:!0});n.save(),n.clearRect(0,0,n.canvas.height,n.canvas.width),n.scale(n.canvas.width/t.canvas.width,n.canvas.height/t.canvas.height),n.drawImage(document.getElementById("canvas"),0,0);const r=n.getImageData(0,0,n.canvas.width,n.canvas.height);return n.restore(),r}function pGe(e){let t=Number.MAX_VALUE,n=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=-Number.MAX_VALUE;for(const s of e.getObjects())t=Math.min(t,s.left),n=Math.min(n,s.top),r=Math.max(r,s.left+s.width),i=Math.max(i,s.top+s.height);return t=Math.max(0,t),n=Math.max(0,n),r=Math.min(r,e.width),i=Math.min(i,e.height),{x:t,y:n,width:r-t,height:i-n}}function gGe(e){const t=S2e();let n,r=0,i=!1;_2e(()=>{n=new tae.fabric.Canvas("canvas"),n.isDrawingMode=!0,n.freeDrawingBrush.width=15,n.freeDrawingBrush.color="#000000",n.backgroundColor="#ffffff",n.renderAll(),n.on("mouse:up",()=>{i=!1,a()}),n.on("mouse:down",()=>{i=!0}),n.on("mouse:move",s)});function s(){i&&r++>hGe&&(n.freeDrawingBrush._finalizeAndAddPath(),a(),r=0)}function o(){n.clear(),n.backgroundColor="#ffffff",n.renderAll()}function a(){console.log("predict"),console.log(pGe(n));const u=dGe(n);t("imageData",{image:u})}return[o]}class mGe extends jQ{constructor(t){super(),UQ(this,t,gGe,fGe,WQ,{})}}var nae={};const rae=Kp(GTe);var iz={};/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var yGe=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),bGe=Object.prototype.hasOwnProperty;function aR(e,t){return bGe.call(e,t)}function uR(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)aR(e,i)&&r.push(i);return r}function Hs(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function lR(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function cd(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function iae(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function cR(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(cR(e[t]))return!0}else if(typeof e=="object"){for(var r=uR(e),i=r.length,s=0;s<i;s++)if(cR(e[r[s]]))return!0}}return!1}function kG(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var sae=function(e){yGe(t,e);function t(n,r,i,s,o){var a=this.constructor,u=e.call(this,kG(n,{name:r,index:i,operation:s,tree:o}))||this;return u.name=r,u.index=i,u.operation=s,u.tree=o,Object.setPrototypeOf(u,a.prototype),u.message=kG(n,{name:r,index:i,operation:s,tree:o}),u}return t}(Error),Mn=sae,vGe=Hs,lm={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=K$(n,this.path);r&&(r=Hs(r));var i=Xd(n,{op:"remove",path:this.from}).removed;return Xd(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=K$(n,this.from);return Xd(n,{op:"add",path:this.path,value:Hs(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Hv(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},xGe={add:function(e,t,n){return lR(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:lm.move,copy:lm.copy,test:lm.test,_get:lm._get};function K$(e,t){if(t=="")return e;var n={op:"_get",path:t};return Xd(e,n),n.value}function Xd(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Z$(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=K$(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Hv(e,t.value),o.test===!1)throw new Mn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Mn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Hs(e));var a=t.path||"",u=a.split("/"),l=e,c=1,f=u.length,h=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=Z$;;){if(d=u[c],d&&d.indexOf("~")!=-1&&(d=iae(d)),i&&(d=="__proto__"||d=="prototype"&&c>0&&u[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&h===void 0&&(l[d]===void 0?h=u.slice(0,c).join("/"):c==f-1&&(h=t.path),h!==void 0&&p(t,0,e,h)),c++,Array.isArray(l)){if(d==="-")d=l.length;else{if(n&&!lR(d))throw new Mn("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);lR(d)&&(d=~~d)}if(c>=f){if(n&&t.op==="add"&&d>l.length)throw new Mn("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=xGe[t.op].call(t,l,d,e);if(o.test===!1)throw new Mn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(c>=f){var o=lm[t.op].call(t,l,d,e);if(o.test===!1)throw new Mn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[d],n&&c<f&&(!l||typeof l!="object"))throw new Mn("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function $D(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Mn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Hs(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Xd(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function wGe(e,t,n){var r=Xd(e,t);if(r.test===!1)throw new Mn("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Z$(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Mn("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(lm[e.op]){if(typeof e.path!="string")throw new Mn("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Mn('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Mn("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Mn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&cR(e.value))throw new Mn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Mn("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Mn("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=oae([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Mn("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Mn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function oae(e,t,n){try{if(!Array.isArray(e))throw new Mn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)$D(Hs(t),Hs(e),n||!0);else{n=n||Z$;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Mn)return i;throw i}}function Hv(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Hv(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Hv(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}const CGe=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:Mn,_areEquals:Hv,applyOperation:Xd,applyPatch:$D,applyReducer:wGe,deepClone:vGe,getValueByPointer:K$,validate:oae,validator:Z$},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var sz=new WeakMap,SGe=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),_Ge=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function $Ge(e){return sz.get(e)}function kGe(e,t){return e.observers.get(t)}function EGe(e,t){e.observers.delete(t.callback)}function AGe(e,t){t.unobserve()}function TGe(e,t){var n=[],r,i=$Ge(e);if(!i)i=new SGe(e),sz.set(e,i);else{var s=kGe(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Hs(e),t){r.callback=t,r.next=null;var o=function(){fR(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){fR(r),clearTimeout(r.next),EGe(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new _Ge(t,r)),r}function fR(e,t){t===void 0&&(t=!1);var n=sz.get(e.object);oz(n.value,e.object,e.patches,"",t),e.patches.length&&$D(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function oz(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=uR(t),o=uR(e),a=!1,u=o.length-1;u>=0;u--){var l=o[u],c=e[l];if(aR(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null&&Array.isArray(c)===Array.isArray(f)?oz(c,f,n,r+"/"+cd(l),i):c!==f&&(i&&n.push({op:"test",path:r+"/"+cd(l),value:Hs(c)}),n.push({op:"replace",path:r+"/"+cd(l),value:Hs(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+cd(l),value:Hs(c)}),n.push({op:"remove",path:r+"/"+cd(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var u=0;u<s.length;u++){var l=s[u];!aR(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+cd(l),value:Hs(t[l])})}}}function DGe(e,t,n){n===void 0&&(n=!1);var r=[];return oz(e,t,r,"",n),r}const IGe=Object.freeze(Object.defineProperty({__proto__:null,compare:DGe,generate:fR,observe:TGe,unobserve:AGe},Symbol.toStringTag,{value:"Module"}));Object.assign({},CGe,IGe,{JsonPatchError:sae,deepClone:Hs,escapePathComponent:cd,unescapePathComponent:iae});var FGe=/("(?:[^\\"]|\\.)*")|[:,]/g,OGe=function(t,n){var r,i,s;return n=n||{},r=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),i=r===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,u,l){var c,f,h,d,p,m,g,y,b,x,v,w;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),v=JSON.stringify(a,s),v===void 0)return v;if(g=i-u.length-l,v.length<=g&&(b=v.replace(FGe,function(C,S){return S||C+" "}),b.length<=g))return b;if(s!=null&&(a=JSON.parse(v),s=void 0),typeof a=="object"&&a!==null){if(y=u+r,h=[],f=0,Array.isArray(a))for(x="[",c="]",g=a.length;f<g;f++)h.push(o(a[f],y,f===g-1?0:1)||"null");else for(x="{",c="}",m=Object.keys(a),g=m.length;f<g;f++)d=m[f],p=JSON.stringify(d)+": ",w=o(a[d],y,p.length+(f===g-1?0:1)),w!==void 0&&h.push(p+w);if(h.length>0)return[x,r+h.join(`,
`+y),c].join(`
`+u)}return v}(t,"",0)};const oN=mw(OGe);var hR={exports:{}};const NGe="2.0.0",MGe=256,RGe=Number.MAX_SAFE_INTEGER||9007199254740991,PGe=16,LGe=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var kD={MAX_LENGTH:MGe,MAX_SAFE_COMPONENT_LENGTH:PGe,MAX_SAFE_INTEGER:RGe,RELEASE_TYPES:LGe,SEMVER_SPEC_VERSION:NGe,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const BGe=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var ED=BGe;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=kD,r=ED;t=e.exports={};const i=t.re=[],s=t.src=[],o=t.t={};let a=0;const u=(l,c,f)=>{const h=a++;r(l,h,c),o[l]=h,s[h]=c,i[h]=new RegExp(c,f?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION",`(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})`),u("MAINVERSIONLOOSE",`(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})`),u("PRERELEASEIDENTIFIER",`(?:${s[o.NUMERICIDENTIFIER]}|${s[o.NONNUMERICIDENTIFIER]})`),u("PRERELEASEIDENTIFIERLOOSE",`(?:${s[o.NUMERICIDENTIFIERLOOSE]}|${s[o.NONNUMERICIDENTIFIER]})`),u("PRERELEASE",`(?:-(${s[o.PRERELEASEIDENTIFIER]}(?:\\.${s[o.PRERELEASEIDENTIFIER]})*))`),u("PRERELEASELOOSE",`(?:-?(${s[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${s[o.PRERELEASEIDENTIFIERLOOSE]})*))`),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD",`(?:\\+(${s[o.BUILDIDENTIFIER]}(?:\\.${s[o.BUILDIDENTIFIER]})*))`),u("FULLPLAIN",`v?${s[o.MAINVERSION]}${s[o.PRERELEASE]}?${s[o.BUILD]}?`),u("FULL",`^${s[o.FULLPLAIN]}$`),u("LOOSEPLAIN",`[v=\\s]*${s[o.MAINVERSIONLOOSE]}${s[o.PRERELEASELOOSE]}?${s[o.BUILD]}?`),u("LOOSE",`^${s[o.LOOSEPLAIN]}$`),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE",`${s[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),u("XRANGEIDENTIFIER",`${s[o.NUMERICIDENTIFIER]}|x|X|\\*`),u("XRANGEPLAIN",`[v=\\s]*(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:${s[o.PRERELEASE]})?${s[o.BUILD]}?)?)?`),u("XRANGEPLAINLOOSE",`[v=\\s]*(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:${s[o.PRERELEASELOOSE]})?${s[o.BUILD]}?)?)?`),u("XRANGE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAIN]}$`),u("XRANGELOOSE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAINLOOSE]}$`),u("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),u("COERCERTL",s[o.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM",`(\\s*)${s[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",u("TILDE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAIN]}$`),u("TILDELOOSE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAINLOOSE]}$`),u("LONECARET","(?:\\^)"),u("CARETTRIM",`(\\s*)${s[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",u("CARET",`^${s[o.LONECARET]}${s[o.XRANGEPLAIN]}$`),u("CARETLOOSE",`^${s[o.LONECARET]}${s[o.XRANGEPLAINLOOSE]}$`),u("COMPARATORLOOSE",`^${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]})$|^$`),u("COMPARATOR",`^${s[o.GTLT]}\\s*(${s[o.FULLPLAIN]})$|^$`),u("COMPARATORTRIM",`(\\s*)${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]}|${s[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE",`^\\s*(${s[o.XRANGEPLAIN]})\\s+-\\s+(${s[o.XRANGEPLAIN]})\\s*$`),u("HYPHENRANGELOOSE",`^\\s*(${s[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${s[o.XRANGEPLAINLOOSE]})\\s*$`),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(hR,hR.exports);var Ww=hR.exports;const zGe=Object.freeze({loose:!0}),jGe=Object.freeze({}),UGe=e=>e?typeof e!="object"?zGe:e:jGe;var az=UGe;const EG=/^[0-9]+$/,aae=(e,t)=>{const n=EG.test(e),r=EG.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1},WGe=(e,t)=>aae(t,e);var uae={compareIdentifiers:aae,rcompareIdentifiers:WGe};const kS=ED,{MAX_LENGTH:AG,MAX_SAFE_INTEGER:ES}=kD,{re:TG,t:DG}=Ww,VGe=az,{compareIdentifiers:Vg}=uae;let GGe=class Za{constructor(t,n){if(n=VGe(n),t instanceof Za){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>AG)throw new TypeError(`version is longer than ${AG} characters`);kS("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=t.trim().match(n.loose?TG[DG.LOOSE]:TG[DG.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>ES||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ES||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ES||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const s=+i;if(s>=0&&s<ES)return s}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(kS("SemVer.compare",this.version,this.options,t),!(t instanceof Za)){if(typeof t=="string"&&t===this.version)return 0;t=new Za(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof Za||(t=new Za(t,this.options)),Vg(this.major,t.major)||Vg(this.minor,t.minor)||Vg(this.patch,t.patch)}comparePre(t){if(t instanceof Za||(t=new Za(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const r=this.prerelease[n],i=t.prerelease[n];if(kS("prerelease compare",n,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Vg(r,i)}while(++n)}compareBuild(t){t instanceof Za||(t=new Za(t,this.options));let n=0;do{const r=this.build[n],i=t.build[n];if(kS("prerelease compare",n,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Vg(r,i)}while(++n)}inc(t,n,r){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(r)?1:0;if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(n){let s=[n,i];r===!1&&(s=[n]),Vg(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}};var ts=GGe;const IG=ts,HGe=(e,t,n=!1)=>{if(e instanceof IG)return e;try{return new IG(e,t)}catch(r){if(!n)return null;throw r}};var W1=HGe;const qGe=W1,XGe=(e,t)=>{const n=qGe(e,t);return n?n.version:null};var YGe=XGe;const KGe=W1,ZGe=(e,t)=>{const n=KGe(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var JGe=ZGe;const FG=ts,QGe=(e,t,n,r,i)=>{typeof n=="string"&&(i=r,r=n,n=void 0);try{return new FG(e instanceof FG?e.version:e,n).inc(t,r,i).version}catch{return null}};var eHe=QGe;const OG=W1,tHe=(e,t)=>{const n=OG(e,null,!0),r=OG(t,null,!0),i=n.compare(r);if(i===0)return null;const s=i>0,o=s?n:r,a=s?r:n,u=!!o.prerelease.length,l=u?"pre":"";return n.major!==r.major?l+"major":n.minor!==r.minor?l+"minor":n.patch!==r.patch?l+"patch":u?"prerelease":a.patch?"patch":a.minor?"minor":"major"};var nHe=tHe;const rHe=ts,iHe=(e,t)=>new rHe(e,t).major;var sHe=iHe;const oHe=ts,aHe=(e,t)=>new oHe(e,t).minor;var uHe=aHe;const lHe=ts,cHe=(e,t)=>new lHe(e,t).patch;var fHe=cHe;const hHe=W1,dHe=(e,t)=>{const n=hHe(e,t);return n&&n.prerelease.length?n.prerelease:null};var pHe=dHe;const NG=ts,gHe=(e,t,n)=>new NG(e,n).compare(new NG(t,n));var Ma=gHe;const mHe=Ma,yHe=(e,t,n)=>mHe(t,e,n);var bHe=yHe;const vHe=Ma,xHe=(e,t)=>vHe(e,t,!0);var wHe=xHe;const MG=ts,CHe=(e,t,n)=>{const r=new MG(e,n),i=new MG(t,n);return r.compare(i)||r.compareBuild(i)};var uz=CHe;const SHe=uz,_He=(e,t)=>e.sort((n,r)=>SHe(n,r,t));var $He=_He;const kHe=uz,EHe=(e,t)=>e.sort((n,r)=>kHe(r,n,t));var AHe=EHe;const THe=Ma,DHe=(e,t,n)=>THe(e,t,n)>0;var AD=DHe;const IHe=Ma,FHe=(e,t,n)=>IHe(e,t,n)<0;var lz=FHe;const OHe=Ma,NHe=(e,t,n)=>OHe(e,t,n)===0;var lae=NHe;const MHe=Ma,RHe=(e,t,n)=>MHe(e,t,n)!==0;var cae=RHe;const PHe=Ma,LHe=(e,t,n)=>PHe(e,t,n)>=0;var cz=LHe;const BHe=Ma,zHe=(e,t,n)=>BHe(e,t,n)<=0;var fz=zHe;const jHe=lae,UHe=cae,WHe=AD,VHe=cz,GHe=lz,HHe=fz,qHe=(e,t,n,r)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return jHe(e,n,r);case"!=":return UHe(e,n,r);case">":return WHe(e,n,r);case">=":return VHe(e,n,r);case"<":return GHe(e,n,r);case"<=":return HHe(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};var fae=qHe;const XHe=ts,YHe=W1,{re:AS,t:TS}=Ww,KHe=(e,t)=>{if(e instanceof XHe)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(AS[TS.COERCE]);else{let r;for(;(r=AS[TS.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||r.index+r[0].length!==n.index+n[0].length)&&(n=r),AS[TS.COERCERTL].lastIndex=r.index+r[1].length+r[2].length;AS[TS.COERCERTL].lastIndex=-1}return n===null?null:YHe(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var ZHe=KHe,aN,RG;function JHe(){return RG||(RG=1,aN=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),aN}var uN,PG;function QHe(){if(PG)return uN;PG=1,uN=e,e.Node=i,e.create=e;function e(s){var o=this;if(o instanceof e||(o=new e),o.tail=null,o.head=null,o.length=0,s&&typeof s.forEach=="function")s.forEach(function(l){o.push(l)});else if(arguments.length>0)for(var a=0,u=arguments.length;a<u;a++)o.push(arguments[a]);return o}e.prototype.removeNode=function(s){if(s.list!==this)throw new Error("removing node which does not belong to this list");var o=s.next,a=s.prev;return o&&(o.prev=a),a&&(a.next=o),s===this.head&&(this.head=o),s===this.tail&&(this.tail=a),s.list.length--,s.next=null,s.prev=null,s.list=null,o},e.prototype.unshiftNode=function(s){if(s!==this.head){s.list&&s.list.removeNode(s);var o=this.head;s.list=this,s.next=o,o&&(o.prev=s),this.head=s,this.tail||(this.tail=s),this.length++}},e.prototype.pushNode=function(s){if(s!==this.tail){s.list&&s.list.removeNode(s);var o=this.tail;s.list=this,s.prev=o,o&&(o.next=s),this.tail=s,this.head||(this.head=s),this.length++}},e.prototype.push=function(){for(var s=0,o=arguments.length;s<o;s++)n(this,arguments[s]);return this.length},e.prototype.unshift=function(){for(var s=0,o=arguments.length;s<o;s++)r(this,arguments[s]);return this.length},e.prototype.pop=function(){if(this.tail){var s=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,s}},e.prototype.shift=function(){if(this.head){var s=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,s}},e.prototype.forEach=function(s,o){o=o||this;for(var a=this.head,u=0;a!==null;u++)s.call(o,a.value,u,this),a=a.next},e.prototype.forEachReverse=function(s,o){o=o||this;for(var a=this.tail,u=this.length-1;a!==null;u--)s.call(o,a.value,u,this),a=a.prev},e.prototype.get=function(s){for(var o=0,a=this.head;a!==null&&o<s;o++)a=a.next;if(o===s&&a!==null)return a.value},e.prototype.getReverse=function(s){for(var o=0,a=this.tail;a!==null&&o<s;o++)a=a.prev;if(o===s&&a!==null)return a.value},e.prototype.map=function(s,o){o=o||this;for(var a=new e,u=this.head;u!==null;)a.push(s.call(o,u.value,this)),u=u.next;return a},e.prototype.mapReverse=function(s,o){o=o||this;for(var a=new e,u=this.tail;u!==null;)a.push(s.call(o,u.value,this)),u=u.prev;return a},e.prototype.reduce=function(s,o){var a,u=this.head;if(arguments.length>1)a=o;else if(this.head)u=this.head.next,a=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var l=0;u!==null;l++)a=s(a,u.value,l),u=u.next;return a},e.prototype.reduceReverse=function(s,o){var a,u=this.tail;if(arguments.length>1)a=o;else if(this.tail)u=this.tail.prev,a=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var l=this.length-1;u!==null;l--)a=s(a,u.value,l),u=u.prev;return a},e.prototype.toArray=function(){for(var s=new Array(this.length),o=0,a=this.head;a!==null;o++)s[o]=a.value,a=a.next;return s},e.prototype.toArrayReverse=function(){for(var s=new Array(this.length),o=0,a=this.tail;a!==null;o++)s[o]=a.value,a=a.prev;return s},e.prototype.slice=function(s,o){o=o||this.length,o<0&&(o+=this.length),s=s||0,s<0&&(s+=this.length);var a=new e;if(o<s||o<0)return a;s<0&&(s=0),o>this.length&&(o=this.length);for(var u=0,l=this.head;l!==null&&u<s;u++)l=l.next;for(;l!==null&&u<o;u++,l=l.next)a.push(l.value);return a},e.prototype.sliceReverse=function(s,o){o=o||this.length,o<0&&(o+=this.length),s=s||0,s<0&&(s+=this.length);var a=new e;if(o<s||o<0)return a;s<0&&(s=0),o>this.length&&(o=this.length);for(var u=this.length,l=this.tail;l!==null&&u>o;u--)l=l.prev;for(;l!==null&&u>s;u--,l=l.prev)a.push(l.value);return a},e.prototype.splice=function(s,o,...a){s>this.length&&(s=this.length-1),s<0&&(s=this.length+s);for(var u=0,l=this.head;l!==null&&u<s;u++)l=l.next;for(var c=[],u=0;l&&u<o;u++)c.push(l.value),l=this.removeNode(l);l===null&&(l=this.tail),l!==this.head&&l!==this.tail&&(l=l.prev);for(var u=0;u<a.length;u++)l=t(this,l,a[u]);return c},e.prototype.reverse=function(){for(var s=this.head,o=this.tail,a=s;a!==null;a=a.prev){var u=a.prev;a.prev=a.next,a.next=u}return this.head=o,this.tail=s,this};function t(s,o,a){var u=o===s.head?new i(a,null,o,s):new i(a,o,o.next,s);return u.next===null&&(s.tail=u),u.prev===null&&(s.head=u),s.length++,u}function n(s,o){s.tail=new i(o,s.tail,null,s),s.head||(s.head=s.tail),s.length++}function r(s,o){s.head=new i(o,null,s.head,s),s.tail||(s.tail=s.head),s.length++}function i(s,o,a,u){if(!(this instanceof i))return new i(s,o,a,u);this.list=u,this.value=s,o?(o.next=this,this.prev=o):this.prev=null,a?(a.prev=this,this.next=a):this.next=null}try{JHe()(e)}catch{}return uN}var lN,LG;function eqe(){if(LG)return lN;LG=1;const e=QHe(),t=Symbol("max"),n=Symbol("length"),r=Symbol("lengthCalculator"),i=Symbol("allowStale"),s=Symbol("maxAge"),o=Symbol("dispose"),a=Symbol("noDisposeOnSet"),u=Symbol("lruList"),l=Symbol("cache"),c=Symbol("updateAgeOnGet"),f=()=>1;class h{constructor(v){if(typeof v=="number"&&(v={max:v}),v||(v={}),v.max&&(typeof v.max!="number"||v.max<0))throw new TypeError("max must be a non-negative number");this[t]=v.max||1/0;const w=v.length||f;if(this[r]=typeof w!="function"?f:w,this[i]=v.stale||!1,v.maxAge&&typeof v.maxAge!="number")throw new TypeError("maxAge must be a number");this[s]=v.maxAge||0,this[o]=v.dispose,this[a]=v.noDisposeOnSet||!1,this[c]=v.updateAgeOnGet||!1,this.reset()}set max(v){if(typeof v!="number"||v<0)throw new TypeError("max must be a non-negative number");this[t]=v||1/0,m(this)}get max(){return this[t]}set allowStale(v){this[i]=!!v}get allowStale(){return this[i]}set maxAge(v){if(typeof v!="number")throw new TypeError("maxAge must be a non-negative number");this[s]=v,m(this)}get maxAge(){return this[s]}set lengthCalculator(v){typeof v!="function"&&(v=f),v!==this[r]&&(this[r]=v,this[n]=0,this[u].forEach(w=>{w.length=this[r](w.value,w.key),this[n]+=w.length})),m(this)}get lengthCalculator(){return this[r]}get length(){return this[n]}get itemCount(){return this[u].length}rforEach(v,w){w=w||this;for(let C=this[u].tail;C!==null;){const S=C.prev;b(this,v,C,w),C=S}}forEach(v,w){w=w||this;for(let C=this[u].head;C!==null;){const S=C.next;b(this,v,C,w),C=S}}keys(){return this[u].toArray().map(v=>v.key)}values(){return this[u].toArray().map(v=>v.value)}reset(){this[o]&&this[u]&&this[u].length&&this[u].forEach(v=>this[o](v.key,v.value)),this[l]=new Map,this[u]=new e,this[n]=0}dump(){return this[u].map(v=>p(this,v)?!1:{k:v.key,v:v.value,e:v.now+(v.maxAge||0)}).toArray().filter(v=>v)}dumpLru(){return this[u]}set(v,w,C){if(C=C||this[s],C&&typeof C!="number")throw new TypeError("maxAge must be a number");const S=C?Date.now():0,_=this[r](w,v);if(this[l].has(v)){if(_>this[t])return g(this,this[l].get(v)),!1;const E=this[l].get(v).value;return this[o]&&(this[a]||this[o](v,E.value)),E.now=S,E.maxAge=C,E.value=w,this[n]+=_-E.length,E.length=_,this.get(v),m(this),!0}const $=new y(v,w,_,S,C);return $.length>this[t]?(this[o]&&this[o](v,w),!1):(this[n]+=$.length,this[u].unshift($),this[l].set(v,this[u].head),m(this),!0)}has(v){if(!this[l].has(v))return!1;const w=this[l].get(v).value;return!p(this,w)}get(v){return d(this,v,!0)}peek(v){return d(this,v,!1)}pop(){const v=this[u].tail;return v?(g(this,v),v.value):null}del(v){g(this,this[l].get(v))}load(v){this.reset();const w=Date.now();for(let C=v.length-1;C>=0;C--){const S=v[C],_=S.e||0;if(_===0)this.set(S.k,S.v);else{const $=_-w;$>0&&this.set(S.k,S.v,$)}}}prune(){this[l].forEach((v,w)=>d(this,w,!1))}}const d=(x,v,w)=>{const C=x[l].get(v);if(C){const S=C.value;if(p(x,S)){if(g(x,C),!x[i])return}else w&&(x[c]&&(C.value.now=Date.now()),x[u].unshiftNode(C));return S.value}},p=(x,v)=>{if(!v||!v.maxAge&&!x[s])return!1;const w=Date.now()-v.now;return v.maxAge?w>v.maxAge:x[s]&&w>x[s]},m=x=>{if(x[n]>x[t])for(let v=x[u].tail;x[n]>x[t]&&v!==null;){const w=v.prev;g(x,v),v=w}},g=(x,v)=>{if(v){const w=v.value;x[o]&&x[o](w.key,w.value),x[n]-=w.length,x[l].delete(w.key),x[u].removeNode(v)}};class y{constructor(v,w,C,S,_){this.key=v,this.value=w,this.length=C,this.now=S,this.maxAge=_||0}}const b=(x,v,w,C)=>{let S=w.value;p(x,S)&&(g(x,w),x[i]||(S=void 0)),S&&v.call(C,S.value,S.key,x)};return lN=h,lN}var cN,BG;function Ra(){if(BG)return cN;BG=1;class e{constructor(I,D){if(D=r(D),I instanceof e)return I.loose===!!D.loose&&I.includePrerelease===!!D.includePrerelease?I:new e(I.raw,D);if(I instanceof i)return this.raw=I.value,this.set=[[I]],this.format(),this;if(this.options=D,this.loose=!!D.loose,this.includePrerelease=!!D.includePrerelease,this.raw=I,this.set=I.split("||").map(N=>this.parseRange(N.trim())).filter(N=>N.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${I}`);if(this.set.length>1){const N=this.set[0];if(this.set=this.set.filter(V=>!p(V[0])),this.set.length===0)this.set=[N];else if(this.set.length>1){for(const V of this.set)if(V.length===1&&m(V[0])){this.set=[V];break}}}this.format()}format(){return this.range=this.set.map(I=>I.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(I){I=I.trim();const N=((this.options.includePrerelease&&h)|(this.options.loose&&d))+":"+I,V=n.get(N);if(V)return V;const U=this.options.loose,A=U?a[u.HYPHENRANGELOOSE]:a[u.HYPHENRANGE];I=I.replace(A,E(this.options.includePrerelease)),s("hyphen replace",I),I=I.replace(a[u.COMPARATORTRIM],l),s("comparator trim",I),I=I.replace(a[u.TILDETRIM],c),I=I.replace(a[u.CARETTRIM],f),I=I.split(/\s+/).join(" ");let M=I.split(" ").map(B=>y(B,this.options)).join(" ").split(/\s+/).map(B=>k(B,this.options));U&&(M=M.filter(B=>(s("loose invalid filter",B,this.options),!!B.match(a[u.COMPARATORLOOSE])))),s("range list",M);const P=new Map,j=M.map(B=>new i(B,this.options));for(const B of j){if(p(B))return[B];P.set(B.value,B)}P.size>1&&P.has("")&&P.delete("");const q=[...P.values()];return n.set(N,q),q}intersects(I,D){if(!(I instanceof e))throw new TypeError("a Range is required");return this.set.some(N=>g(N,D)&&I.set.some(V=>g(V,D)&&N.every(U=>V.every(A=>U.intersects(A,D)))))}test(I){if(!I)return!1;if(typeof I=="string")try{I=new o(I,this.options)}catch{return!1}for(let D=0;D<this.set.length;D++)if(F(this.set[D],I,this.options))return!0;return!1}}cN=e;const t=eqe(),n=new t({max:1e3}),r=az,i=TD(),s=ED,o=ts,{re:a,t:u,comparatorTrimReplace:l,tildeTrimReplace:c,caretTrimReplace:f}=Ww,{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:d}=kD,p=T=>T.value==="<0.0.0-0",m=T=>T.value==="",g=(T,I)=>{let D=!0;const N=T.slice();let V=N.pop();for(;D&&N.length;)D=N.every(U=>V.intersects(U,I)),V=N.pop();return D},y=(T,I)=>(s("comp",T,I),T=w(T,I),s("caret",T),T=x(T,I),s("tildes",T),T=S(T,I),s("xrange",T),T=$(T,I),s("stars",T),T),b=T=>!T||T.toLowerCase()==="x"||T==="*",x=(T,I)=>T.trim().split(/\s+/).map(D=>v(D,I)).join(" "),v=(T,I)=>{const D=I.loose?a[u.TILDELOOSE]:a[u.TILDE];return T.replace(D,(N,V,U,A,M)=>{s("tilde",T,N,V,U,A,M);let P;return b(V)?P="":b(U)?P=`>=${V}.0.0 <${+V+1}.0.0-0`:b(A)?P=`>=${V}.${U}.0 <${V}.${+U+1}.0-0`:M?(s("replaceTilde pr",M),P=`>=${V}.${U}.${A}-${M} <${V}.${+U+1}.0-0`):P=`>=${V}.${U}.${A} <${V}.${+U+1}.0-0`,s("tilde return",P),P})},w=(T,I)=>T.trim().split(/\s+/).map(D=>C(D,I)).join(" "),C=(T,I)=>{s("caret",T,I);const D=I.loose?a[u.CARETLOOSE]:a[u.CARET],N=I.includePrerelease?"-0":"";return T.replace(D,(V,U,A,M,P)=>{s("caret",T,V,U,A,M,P);let j;return b(U)?j="":b(A)?j=`>=${U}.0.0${N} <${+U+1}.0.0-0`:b(M)?U==="0"?j=`>=${U}.${A}.0${N} <${U}.${+A+1}.0-0`:j=`>=${U}.${A}.0${N} <${+U+1}.0.0-0`:P?(s("replaceCaret pr",P),U==="0"?A==="0"?j=`>=${U}.${A}.${M}-${P} <${U}.${A}.${+M+1}-0`:j=`>=${U}.${A}.${M}-${P} <${U}.${+A+1}.0-0`:j=`>=${U}.${A}.${M}-${P} <${+U+1}.0.0-0`):(s("no pr"),U==="0"?A==="0"?j=`>=${U}.${A}.${M}${N} <${U}.${A}.${+M+1}-0`:j=`>=${U}.${A}.${M}${N} <${U}.${+A+1}.0-0`:j=`>=${U}.${A}.${M} <${+U+1}.0.0-0`),s("caret return",j),j})},S=(T,I)=>(s("replaceXRanges",T,I),T.split(/\s+/).map(D=>_(D,I)).join(" ")),_=(T,I)=>{T=T.trim();const D=I.loose?a[u.XRANGELOOSE]:a[u.XRANGE];return T.replace(D,(N,V,U,A,M,P)=>{s("xRange",T,N,V,U,A,M,P);const j=b(U),q=j||b(A),B=q||b(M),O=B;return V==="="&&O&&(V=""),P=I.includePrerelease?"-0":"",j?V===">"||V==="<"?N="<0.0.0-0":N="*":V&&O?(q&&(A=0),M=0,V===">"?(V=">=",q?(U=+U+1,A=0,M=0):(A=+A+1,M=0)):V==="<="&&(V="<",q?U=+U+1:A=+A+1),V==="<"&&(P="-0"),N=`${V+U}.${A}.${M}${P}`):q?N=`>=${U}.0.0${P} <${+U+1}.0.0-0`:B&&(N=`>=${U}.${A}.0${P} <${U}.${+A+1}.0-0`),s("xRange return",N),N})},$=(T,I)=>(s("replaceStars",T,I),T.trim().replace(a[u.STAR],"")),k=(T,I)=>(s("replaceGTE0",T,I),T.trim().replace(a[I.includePrerelease?u.GTE0PRE:u.GTE0],"")),E=T=>(I,D,N,V,U,A,M,P,j,q,B,O,G)=>(b(N)?D="":b(V)?D=`>=${N}.0.0${T?"-0":""}`:b(U)?D=`>=${N}.${V}.0${T?"-0":""}`:A?D=`>=${D}`:D=`>=${D}${T?"-0":""}`,b(j)?P="":b(q)?P=`<${+j+1}.0.0-0`:b(B)?P=`<${j}.${+q+1}.0-0`:O?P=`<=${j}.${q}.${B}-${O}`:T?P=`<${j}.${q}.${+B+1}-0`:P=`<=${P}`,`${D} ${P}`.trim()),F=(T,I,D)=>{for(let N=0;N<T.length;N++)if(!T[N].test(I))return!1;if(I.prerelease.length&&!D.includePrerelease){for(let N=0;N<T.length;N++)if(s(T[N].semver),T[N].semver!==i.ANY&&T[N].semver.prerelease.length>0){const V=T[N].semver;if(V.major===I.major&&V.minor===I.minor&&V.patch===I.patch)return!0}return!1}return!0};return cN}var fN,zG;function TD(){if(zG)return fN;zG=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(c,f){if(f=n(f),c instanceof t){if(c.loose===!!f.loose)return c;c=c.value}o("comparator",c,f),this.options=f,this.loose=!!f.loose,this.parse(c),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(c){const f=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],h=c.match(f);if(!h)throw new TypeError(`Invalid comparator: ${c}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new a(h[2],this.options.loose):this.semver=e}toString(){return this.value}test(c){if(o("Comparator.test",c,this.options.loose),this.semver===e||c===e)return!0;if(typeof c=="string")try{c=new a(c,this.options)}catch{return!1}return s(c,this.operator,this.semver,this.options)}intersects(c,f){if(!(c instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(c.value,f).test(this.value):c.operator===""?c.value===""?!0:new u(this.value,f).test(c.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||s(this.semver,"<",c.semver,f)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||s(this.semver,">",c.semver,f)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}fN=t;const n=az,{re:r,t:i}=Ww,s=fae,o=ED,a=ts,u=Ra();return fN}const tqe=Ra(),nqe=(e,t,n)=>{try{t=new tqe(t,n)}catch{return!1}return t.test(e)};var DD=nqe;const rqe=Ra(),iqe=(e,t)=>new rqe(e,t).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));var sqe=iqe;const oqe=ts,aqe=Ra(),uqe=(e,t,n)=>{let r=null,i=null,s=null;try{s=new aqe(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!r||i.compare(o)===-1)&&(r=o,i=new oqe(r,n))}),r};var lqe=uqe;const cqe=ts,fqe=Ra(),hqe=(e,t,n)=>{let r=null,i=null,s=null;try{s=new fqe(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!r||i.compare(o)===1)&&(r=o,i=new cqe(r,n))}),r};var dqe=hqe;const hN=ts,pqe=Ra(),jG=AD,gqe=(e,t)=>{e=new pqe(e,t);let n=new hN("0.0.0");if(e.test(n)||(n=new hN("0.0.0-0"),e.test(n)))return n;n=null;for(let r=0;r<e.set.length;++r){const i=e.set[r];let s=null;i.forEach(o=>{const a=new hN(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||jG(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!n||jG(n,s))&&(n=s)}return n&&e.test(n)?n:null};var mqe=gqe;const yqe=Ra(),bqe=(e,t)=>{try{return new yqe(e,t).range||"*"}catch{return null}};var vqe=bqe;const xqe=ts,hae=TD(),{ANY:wqe}=hae,Cqe=Ra(),Sqe=DD,UG=AD,WG=lz,_qe=fz,$qe=cz,kqe=(e,t,n,r)=>{e=new xqe(e,r),t=new Cqe(t,r);let i,s,o,a,u;switch(n){case">":i=UG,s=_qe,o=WG,a=">",u=">=";break;case"<":i=WG,s=$qe,o=UG,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Sqe(e,t,r))return!1;for(let l=0;l<t.set.length;++l){const c=t.set[l];let f=null,h=null;if(c.forEach(d=>{d.semver===wqe&&(d=new hae(">=0.0.0")),f=f||d,h=h||d,i(d.semver,f.semver,r)?f=d:o(d.semver,h.semver,r)&&(h=d)}),f.operator===a||f.operator===u||(!h.operator||h.operator===a)&&s(e,h.semver))return!1;if(h.operator===u&&o(e,h.semver))return!1}return!0};var hz=kqe;const Eqe=hz,Aqe=(e,t,n)=>Eqe(e,t,">",n);var Tqe=Aqe;const Dqe=hz,Iqe=(e,t,n)=>Dqe(e,t,"<",n);var Fqe=Iqe;const VG=Ra(),Oqe=(e,t,n)=>(e=new VG(e,n),t=new VG(t,n),e.intersects(t,n));var Nqe=Oqe;const Mqe=DD,Rqe=Ma;var Pqe=(e,t,n)=>{const r=[];let i=null,s=null;const o=e.sort((c,f)=>Rqe(c,f,n));for(const c of o)Mqe(c,t,n)?(s=c,i||(i=c)):(s&&r.push([i,s]),s=null,i=null);i&&r.push([i,null]);const a=[];for(const[c,f]of r)c===f?a.push(c):!f&&c===o[0]?a.push("*"):f?c===o[0]?a.push(`<=${f}`):a.push(`${c} - ${f}`):a.push(`>=${c}`);const u=a.join(" || "),l=typeof t.raw=="string"?t.raw:String(t);return u.length<l.length?u:t};const GG=Ra(),dz=TD(),{ANY:dN}=dz,Oy=DD,pz=Ma,Lqe=(e,t,n={})=>{if(e===t)return!0;e=new GG(e,n),t=new GG(t,n);let r=!1;e:for(const i of e.set){for(const s of t.set){const o=zqe(i,s,n);if(r=r||o!==null,o)continue e}if(r)return!1}return!0},Bqe=[new dz(">=0.0.0-0")],HG=[new dz(">=0.0.0")],zqe=(e,t,n)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===dN){if(t.length===1&&t[0].semver===dN)return!0;n.includePrerelease?e=Bqe:e=HG}if(t.length===1&&t[0].semver===dN){if(n.includePrerelease)return!0;t=HG}const r=new Set;let i,s;for(const d of e)d.operator===">"||d.operator===">="?i=qG(i,d,n):d.operator==="<"||d.operator==="<="?s=XG(s,d,n):r.add(d.semver);if(r.size>1)return null;let o;if(i&&s){if(o=pz(i.semver,s.semver,n),o>0)return null;if(o===0&&(i.operator!==">="||s.operator!=="<="))return null}for(const d of r){if(i&&!Oy(d,String(i),n)||s&&!Oy(d,String(s),n))return null;for(const p of t)if(!Oy(d,String(p),n))return!1;return!0}let a,u,l,c,f=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1,h=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const d of t){if(c=c||d.operator===">"||d.operator===">=",l=l||d.operator==="<"||d.operator==="<=",i){if(h&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===h.major&&d.semver.minor===h.minor&&d.semver.patch===h.patch&&(h=!1),d.operator===">"||d.operator===">="){if(a=qG(i,d,n),a===d&&a!==i)return!1}else if(i.operator===">="&&!Oy(i.semver,String(d),n))return!1}if(s){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator==="<"||d.operator==="<="){if(u=XG(s,d,n),u===d&&u!==s)return!1}else if(s.operator==="<="&&!Oy(s.semver,String(d),n))return!1}if(!d.operator&&(s||i)&&o!==0)return!1}return!(i&&l&&!s&&o!==0||s&&c&&!i&&o!==0||h||f)},qG=(e,t,n)=>{if(!e)return t;const r=pz(e.semver,t.semver,n);return r>0?e:r<0||t.operator===">"&&e.operator===">="?t:e},XG=(e,t,n)=>{if(!e)return t;const r=pz(e.semver,t.semver,n);return r<0?e:r>0||t.operator==="<"&&e.operator==="<="?t:e};var jqe=Lqe;const pN=Ww,YG=kD,Uqe=ts,KG=uae,Wqe=W1,Vqe=YGe,Gqe=JGe,Hqe=eHe,qqe=nHe,Xqe=sHe,Yqe=uHe,Kqe=fHe,Zqe=pHe,Jqe=Ma,Qqe=bHe,eXe=wHe,tXe=uz,nXe=$He,rXe=AHe,iXe=AD,sXe=lz,oXe=lae,aXe=cae,uXe=cz,lXe=fz,cXe=fae,fXe=ZHe,hXe=TD(),dXe=Ra(),pXe=DD,gXe=sqe,mXe=lqe,yXe=dqe,bXe=mqe,vXe=vqe,xXe=hz,wXe=Tqe,CXe=Fqe,SXe=Nqe,_Xe=Pqe,$Xe=jqe;var dae={parse:Wqe,valid:Vqe,clean:Gqe,inc:Hqe,diff:qqe,major:Xqe,minor:Yqe,patch:Kqe,prerelease:Zqe,compare:Jqe,rcompare:Qqe,compareLoose:eXe,compareBuild:tXe,sort:nXe,rsort:rXe,gt:iXe,lt:sXe,eq:oXe,neq:aXe,gte:uXe,lte:lXe,cmp:cXe,coerce:fXe,Comparator:hXe,Range:dXe,satisfies:pXe,toComparators:gXe,maxSatisfying:mXe,minSatisfying:yXe,minVersion:bXe,validRange:vXe,outside:xXe,gtr:wXe,ltr:CXe,intersects:SXe,simplifyRange:_Xe,subset:$Xe,SemVer:Uqe,re:pN.re,src:pN.src,tokens:pN.t,SEMVER_SPEC_VERSION:YG.SEMVER_SPEC_VERSION,RELEASE_TYPES:YG.RELEASE_TYPES,compareIdentifiers:KG.compareIdentifiers,rcompareIdentifiers:KG.rcompareIdentifiers};function Vo(e,t,n){return e.fields=t||[],e.fname=n,e}function Ln(e){return e==null?null:e.fname}function vi(e){return e==null?null:e.fields}function pae(e){return e.length===1?kXe(e[0]):EXe(e)}const kXe=e=>function(t){return t[e]},EXe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function ye(e){throw Error(e)}function ID(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a),s+=e.substring(++a,++a),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||ye("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&ye("Access path missing closing bracket: "+e),r&&ye("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Rf(e,t,n){const r=ID(e);return e=r.length===1?r[0]:e,Vo((n&&n.get||pae)(r),[e],t||e)}const AXe=Rf("id"),Oo=Vo(e=>e,[],"identity"),Vc=Vo(()=>0,[],"zero"),V1=Vo(()=>1,[],"one"),G1=Vo(()=>!0,[],"true"),Mc=Vo(()=>!1,[],"false");function DS(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const gae=0,mae=1,yae=2,bae=3,vae=4;function TXe(e,t){let n=e||gae;return{level(r){return arguments.length?(n=+r,this):n},error(){return n>=mae&&DS(t||"error","ERROR",arguments),this},warn(){return n>=yae&&DS(t||"warn","WARN",arguments),this},info(){return n>=bae&&DS(t||"log","INFO",arguments),this},debug(){return n>=vae&&DS(t||"log","DEBUG",arguments),this}}}var ht=Array.isArray;function wt(e){return e===Object(e)}const ZG=e=>e!=="__proto__";function FD(...e){return e.reduce((t,n)=>{for(const r in n)if(r==="signals")t.signals=DXe(t.signals,n.signals);else{const i=r==="legend"?{layout:1}:r==="style"?!0:null;OD(t,r,n[r],i)}return t},{})}function OD(e,t,n,r){if(!ZG(t))return;let i,s;if(wt(n)&&!ht(n)){s=wt(e[t])?e[t]:e[t]={};for(i in n)r&&(r===!0||r[i])?OD(s,i,n[i]):ZG(i)&&(s[i]=n[i])}else e[t]=n}function DXe(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}function en(e){return e[e.length-1]}function Pf(e){return e==null||e===""?null:+e}const xae=e=>t=>e*Math.exp(t),wae=e=>t=>Math.log(e*t),Cae=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Sae=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,J$=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function ND(e,t,n,r){const i=n(e[0]),s=n(en(e)),o=(s-i)*t;return[r(i-o),r(s-o)]}function IXe(e,t){return ND(e,t,Pf,Oo)}function FXe(e,t){var n=Math.sign(e[0]);return ND(e,t,wae(n),xae(n))}function OXe(e,t,n){return ND(e,t,J$(n),J$(1/n))}function NXe(e,t,n){return ND(e,t,Cae(n),Sae(n))}function MD(e,t,n,r,i){const s=r(e[0]),o=r(en(e)),a=t!=null?r(t):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function _ae(e,t,n){return MD(e,t,n,Pf,Oo)}function $ae(e,t,n){const r=Math.sign(e[0]);return MD(e,t,n,wae(r),xae(r))}function dR(e,t,n,r){return MD(e,t,n,J$(r),J$(1/r))}function kae(e,t,n,r){return MD(e,t,n,Cae(r),Sae(r))}function MXe(e){return 1+~~(new Date(e).getMonth()/3)}function RXe(e){return 1+~~(new Date(e).getUTCMonth()/3)}function at(e){return e!=null?ht(e)?e:[e]:[]}function PXe(e,t,n){let r=e[0],i=e[1],s;return i<r&&(s=i,i=r,r=s),s=i-r,s>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-s),r+s]}function Ht(e){return typeof e=="function"}const LXe="descending";function Eae(e,t,n){n=n||{},t=at(t)||[];const r=[],i=[],s={},o=n.comparator||BXe;return at(e).forEach((a,u)=>{a!=null&&(r.push(t[u]===LXe?-1:1),i.push(a=Ht(a)?a:Rf(a,null,n)),(vi(a)||[]).forEach(l=>s[l]=1))}),i.length===0?null:Vo(o(i,r),Object.keys(s))}const RD=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),BXe=(e,t)=>e.length===1?zXe(e[0],t[0]):jXe(e,t,e.length),zXe=(e,t)=>function(n,r){return RD(e(n),e(r))*t},jXe=(e,t,n)=>(t.push(0),function(r,i){let s,o=0,a=-1;for(;o===0&&++a<n;)s=e[a],o=RD(s(r),s(i));return o*t[a]});function No(e){return Ht(e)?e:()=>e}function Aae(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function St(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function Lf(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}function Tae(e,t){const n=e.length;let r=-1,i,s,o,a,u;if(t==null){for(;++r<n;)if(s=e[r],s!=null&&s>=s){i=o=s;break}if(r===n)return[-1,-1];for(a=u=r;++r<n;)s=e[r],s!=null&&(i>s&&(i=s,a=r),o<s&&(o=s,u=r))}else{for(;++r<n;)if(s=t(e[r],r,e),s!=null&&s>=s){i=o=s;break}if(r===n)return[-1,-1];for(a=u=r;++r<n;)s=t(e[r],r,e),s!=null&&(i>s&&(i=s,a=r),o<s&&(o=s,u=r))}return[a,u]}const UXe=Object.prototype.hasOwnProperty;function lt(e,t){return UXe.call(e,t)}const IS={};function H1(e){let t={},n;function r(s){return lt(t,s)&&t[s]!==IS}const i={size:0,empty:0,object:t,has:r,get(s){return r(s)?t[s]:void 0},set(s,o){return r(s)||(++i.size,t[s]===IS&&--i.empty),t[s]=o,this},delete(s){return r(s)&&(--i.size,++i.empty,t[s]=IS),this},clear(){i.size=i.empty=0,i.object=t={}},test(s){return arguments.length?(n=s,i):n},clean(){const s={};let o=0;for(const a in t){const u=t[a];u!==IS&&(!n||!n(u))&&(s[a]=u,++o)}i.size=o,i.empty=0,i.object=t=s}};return e&&Object.keys(e).forEach(s=>{i.set(s,e[s])}),i}function WXe(e,t,n,r,i,s){if(!n&&n!==0)return s;const o=+n;let a=e[0],u=en(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=o?r:c<=o?i:s}function $e(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),St(r,n)}function VXe(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function Dae(e){return typeof e=="boolean"}function PD(e){return Object.prototype.toString.call(e)==="[object Date]"}function Iae(e){return e&&Ht(e[Symbol.iterator])}function bp(e){return typeof e=="number"}function GXe(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function wn(e){return typeof e=="string"}function Fae(e,t,n){e&&(e=t?at(e).map(a=>a.replace(/\\(.)/g,"$1")):at(e));const r=e&&e.length,i=n&&n.get||pae,s=a=>i(t?[a]:ID(a));let o;if(!r)o=function(){return""};else if(r===1){const a=s(e[0]);o=function(u){return""+a(u)}}else{const a=e.map(s);o=function(u){let l=""+a[0](u),c=0;for(;++c<r;)l+="|"+a[c](u);return l}}return Vo(o,e,"key")}function HXe(e,t){const n=e[0],r=en(e),i=+t;return i?i===1?r:n+i*(r-n):n}const qXe=1e4;function Oae(e){e=+e||qXe;let t,n,r;const i=()=>{t={},n={},r=0},s=(o,a)=>(++r>e&&(n=t,t={},r=1),t[o]=a);return i(),{clear:i,has:o=>lt(t,o)||lt(n,o),get:o=>lt(t,o)?t[o]:lt(n,o)?s(o,n[o]):void 0,set:(o,a)=>lt(t,o)?t[o]=a:s(o,a)}}function Nae(e,t,n,r){const i=t.length,s=n.length;if(!s)return t;if(!i)return n;const o=r||new t.constructor(i+s);let a=0,u=0,l=0;for(;a<i&&u<s;++l)o[l]=e(t[a],n[u])>0?n[u++]:t[a++];for(;a<i;++a,++l)o[l]=t[a];for(;u<s;++u,++l)o[l]=n[u];return o}function Cb(e,t){let n="";for(;--t>=0;)n+=e;return n}function XXe(e,t,n,r){const i=n||" ",s=e+"",o=t-s.length;return o<=0?s:r==="left"?Cb(i,o)+s:r==="center"?Cb(i,~~(o/2))+s+Cb(i,Math.ceil(o/2)):s+Cb(i,o)}function LD(e){return e&&en(e)-e[0]||0}function Qe(e){return ht(e)?"["+e.map(Qe)+"]":wt(e)||wn(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Mae(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const YXe=e=>bp(e)||PD(e)?e:Date.parse(e);function Rae(e,t){return t=t||YXe,e==null||e===""?null:t(e)}function Pae(e){return e==null||e===""?null:e+""}function nc(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function KXe(e,t,n,r){const i=r??"",s=e+"",o=s.length,a=Math.max(0,t-i.length);return o<=t?s:n==="left"?i+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+i+s.slice(o-~~(a/2)):s.slice(0,a)+i}function ZXe(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const s=t(e[i]);s&&n(s,i,e)}}else e.forEach(n)}function q1(e,t,n){return e.fields=t||[],e.fname=n,e}function JXe(e){return e.length===1?QXe(e[0]):eYe(e)}const QXe=e=>function(t){return t[e]},eYe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function xi(e){throw Error(e)}function tYe(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||xi("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&xi("Access path missing closing bracket: "+e),r&&xi("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Lae(e,t,n){const r=tYe(e);return e=r.length===1?r[0]:e,q1((n&&n.get||JXe)(r),[e],t||e)}const BD=Lae("id"),zD=q1(e=>e,[],"identity");q1(()=>0,[],"zero");q1(()=>1,[],"one");const pR=q1(()=>!0,[],"true");q1(()=>!1,[],"false");function nYe(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const rYe=0,Bae=1,iYe=2,sYe=3,oYe=4;function aYe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:nYe,r=e||rYe;return{level(i){return arguments.length?(r=+i,this):r},error(){return r>=Bae&&n(t||"error","ERROR",arguments),this},warn(){return r>=iYe&&n(t||"warn","WARN",arguments),this},info(){return r>=sYe&&n(t||"log","INFO",arguments),this},debug(){return r>=oYe&&n(t||"log","DEBUG",arguments),this}}}var Nu=Array.isArray;function gz(e){return e===Object(e)}function JG(e){return e==null||e===""?null:+e}function Q$(e){return e!=null?Nu(e)?e:[e]:[]}function wa(e){return typeof e=="function"}function mz(e){return wa(e)?e:()=>e}function uYe(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function X1(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const lYe=Object.prototype.hasOwnProperty;function yz(e,t){return lYe.call(e,t)}function zae(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),X1(r,n)}function cYe(e){return Object.prototype.toString.call(e)==="[object Date]"}function fYe(e){return e&&wa(e[Symbol.iterator])}function hYe(e){return typeof e=="number"}function gR(e){return typeof e=="string"}function bz(e){return Nu(e)?"["+e.map(bz)+"]":gz(e)||gR(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function dYe(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const pYe=e=>hYe(e)||cYe(e)?e:Date.parse(e);function gYe(e,t){return t=t||pYe,e==null||e===""?null:t(e)}function mYe(e){return e==null||e===""?null:e+""}function fd(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const s=t(e[i]);s&&n(s,i,e)}}else e.forEach(n)}var QG={},gN={},mN=34,Ny=10,yN=13;function jae(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function yYe(e,t){var n=jae(e);return function(r,i){return t(n(r),i,e)}}function eH(e){var t=Object.create(null),n=[];return e.forEach(function(r){for(var i in r)i in t||n.push(t[i]=i)}),n}function os(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function bYe(e){return e<0?"-"+os(-e,6):e>9999?"+"+os(e,6):os(e,4)}function vYe(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":bYe(e.getUTCFullYear())+"-"+os(e.getUTCMonth()+1,2)+"-"+os(e.getUTCDate(),2)+(i?"T"+os(t,2)+":"+os(n,2)+":"+os(r,2)+"."+os(i,3)+"Z":r?"T"+os(t,2)+":"+os(n,2)+":"+os(r,2)+"Z":n||t?"T"+os(t,2)+":"+os(n,2)+"Z":"")}function xYe(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function r(f,h){var d,p,m=i(f,function(g,y){if(d)return d(g,y-1);p=g,d=h?yYe(g,h):jae(g)});return m.columns=p||[],m}function i(f,h){var d=[],p=f.length,m=0,g=0,y,b=p<=0,x=!1;f.charCodeAt(p-1)===Ny&&--p,f.charCodeAt(p-1)===yN&&--p;function v(){if(b)return gN;if(x)return x=!1,QG;var C,S=m,_;if(f.charCodeAt(S)===mN){for(;m++<p&&f.charCodeAt(m)!==mN||f.charCodeAt(++m)===mN;);return(C=m)>=p?b=!0:(_=f.charCodeAt(m++))===Ny?x=!0:_===yN&&(x=!0,f.charCodeAt(m)===Ny&&++m),f.slice(S+1,C-1).replace(/""/g,'"')}for(;m<p;){if((_=f.charCodeAt(C=m++))===Ny)x=!0;else if(_===yN)x=!0,f.charCodeAt(m)===Ny&&++m;else if(_!==n)continue;return f.slice(S,C)}return b=!0,f.slice(S,p)}for(;(y=v())!==gN;){for(var w=[];y!==QG&&y!==gN;)w.push(y),y=v();h&&(w=h(w,g++))==null||d.push(w)}return d}function s(f,h){return f.map(function(d){return h.map(function(p){return c(d[p])}).join(e)})}function o(f,h){return h==null&&(h=eH(f)),[h.map(c).join(e)].concat(s(f,h)).join(`
`)}function a(f,h){return h==null&&(h=eH(f)),s(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?vYe(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function wYe(e){return e}function CYe(e){if(e==null)return wYe;var t,n,r=e.scale[0],i=e.scale[1],s=e.translate[0],o=e.translate[1];return function(a,u){u||(t=n=0);var l=2,c=a.length,f=new Array(c);for(f[0]=(t+=a[0])*r+s,f[1]=(n+=a[1])*i+o;l<c;)f[l]=a[l],++l;return f}}function SYe(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}function Uae(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return tH(e,n)})}:tH(e,t)}function tH(e,t){var n=t.id,r=t.bbox,i=t.properties==null?{}:t.properties,s=Wae(e,t);return n==null&&r==null?{type:"Feature",properties:i,geometry:s}:r==null?{type:"Feature",id:n,properties:i,geometry:s}:{type:"Feature",id:n,bbox:r,properties:i,geometry:s}}function Wae(e,t){var n=CYe(e.transform),r=e.arcs;function i(c,f){f.length&&f.pop();for(var h=r[c<0?~c:c],d=0,p=h.length;d<p;++d)f.push(n(h[d],d));c<0&&SYe(f,p)}function s(c){return n(c)}function o(c){for(var f=[],h=0,d=c.length;h<d;++h)i(c[h],f);return f.length<2&&f.push(f[0]),f}function a(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function u(c){return c.map(a)}function l(c){var f=c.type,h;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(l)};case"Point":h=s(c.coordinates);break;case"MultiPoint":h=c.coordinates.map(s);break;case"LineString":h=o(c.arcs);break;case"MultiLineString":h=c.arcs.map(o);break;case"Polygon":h=u(c.arcs);break;case"MultiPolygon":h=c.arcs.map(u);break;default:return null}return{type:f,coordinates:h}}return l(t)}function _Ye(e,t){var n={},r={},i={},s=[],o=-1;t.forEach(function(l,c){var f=e.arcs[l<0?~l:l],h;f.length<3&&!f[1][0]&&!f[1][1]&&(h=t[++o],t[o]=l,t[c]=h)}),t.forEach(function(l){var c=a(l),f=c[0],h=c[1],d,p;if(d=i[f])if(delete i[d.end],d.push(l),d.end=h,p=r[h]){delete r[p.start];var m=p===d?d:d.concat(p);r[m.start=d.start]=i[m.end=p.end]=m}else r[d.start]=i[d.end]=d;else if(d=r[h])if(delete r[d.start],d.unshift(l),d.start=f,p=i[f]){delete i[p.end];var g=p===d?d:p.concat(d);r[g.start=p.start]=i[g.end=d.end]=g}else r[d.start]=i[d.end]=d;else d=[l],r[d.start=f]=i[d.end=h]=d});function a(l){var c=e.arcs[l<0?~l:l],f=c[0],h;return e.transform?(h=[0,0],c.forEach(function(d){h[0]+=d[0],h[1]+=d[1]})):h=c[c.length-1],l<0?[h,f]:[f,h]}function u(l,c){for(var f in l){var h=l[f];delete c[h.start],delete h.start,delete h.end,h.forEach(function(d){n[d<0?~d:d]=1}),s.push(h)}}return u(i,r),u(r,i),t.forEach(function(l){n[l<0?~l:l]||s.push([l])}),s}function Vae(e){return Wae(e,$Ye.apply(this,arguments))}function $Ye(e,t,n){var r,i,s;if(arguments.length>1)r=kYe(e,t,n);else for(i=0,r=new Array(s=e.arcs.length);i<s;++i)r[i]=i;return{type:"MultiLineString",arcs:_Ye(e,r)}}function kYe(e,t,n){var r=[],i=[],s;function o(f){var h=f<0?~f:f;(i[h]||(i[h]=[])).push({i:f,g:s})}function a(f){f.forEach(o)}function u(f){f.forEach(a)}function l(f){f.forEach(u)}function c(f){switch(s=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":a(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":l(f.arcs);break}}return c(t),i.forEach(n==null?function(f){r.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&r.push(f[0].i)}),r}class ek extends Map{constructor(t,n=qae){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[r,i]of t)this.set(r,i)}get(t){return super.get(mR(this,t))}has(t){return super.has(mR(this,t))}set(t,n){return super.set(Gae(this,t),n)}delete(t){return super.delete(Hae(this,t))}}class tk extends Set{constructor(t,n=qae){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const r of t)this.add(r)}has(t){return super.has(mR(this,t))}add(t){return super.add(Gae(this,t))}delete(t){return super.delete(Hae(this,t))}}function mR({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function Gae({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}function Hae({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(n),e.delete(r)),n}function qae(e){return e!==null&&typeof e=="object"?e.valueOf():e}const EYe=Math.sqrt(50),AYe=Math.sqrt(10),TYe=Math.sqrt(2);function Xae(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=EYe?10:s>=AYe?5:s>=TYe?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?Xae(e,t,n*2):[a,u,l]}function nH(e,t,n){return t=+t,e=+e,n=+n,Xae(e,t,n)[2]}function DYe(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?nH(t,e,n):nH(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function IYe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function nk(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Gm(e){return e=nk(Math.abs(e)),e?e[1]:NaN}function FYe(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function OYe(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var NYe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function qv(e){if(!(t=NYe.exec(e)))throw new Error("invalid format: "+e);var t;return new vz({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}qv.prototype=vz.prototype;function vz(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}vz.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function MYe(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Yae;function RYe(e,t){var n=nk(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Yae=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+nk(e,Math.max(0,t+s-1))[0]}function rH(e,t){var n=nk(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const iH={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:IYe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>rH(e*100,t),r:rH,s:RYe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function sH(e){return e}var oH=Array.prototype.map,aH=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Kae(e){var t=e.grouping===void 0||e.thousands===void 0?sH:FYe(oH.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?sH:OYe(oH.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=qv(f);var h=f.fill,d=f.align,p=f.sign,m=f.symbol,g=f.zero,y=f.width,b=f.comma,x=f.precision,v=f.trim,w=f.type;w==="n"?(b=!0,w="g"):iH[w]||(x===void 0&&(x=12),v=!0,w="g"),(g||h==="0"&&d==="=")&&(g=!0,h="0",d="=");var C=m==="$"?n:m==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",S=m==="$"?r:/[%p]/.test(w)?o:"",_=iH[w],$=/[defgprs%]/.test(w);x=x===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function k(E){var F=C,T=S,I,D,N;if(w==="c")T=_(E)+T,E="";else{E=+E;var V=E<0||1/E<0;if(E=isNaN(E)?u:_(Math.abs(E),x),v&&(E=MYe(E)),V&&+E==0&&p!=="+"&&(V=!1),F=(V?p==="("?p:a:p==="-"||p==="("?"":p)+F,T=(w==="s"?aH[8+Yae/3]:"")+T+(V&&p==="("?")":""),$){for(I=-1,D=E.length;++I<D;)if(N=E.charCodeAt(I),48>N||N>57){T=(N===46?i+E.slice(I+1):E.slice(I))+T,E=E.slice(0,I);break}}}b&&!g&&(E=t(E,1/0));var U=F.length+E.length+T.length,A=U<y?new Array(y-U+1).join(h):"";switch(b&&g&&(E=t(A+E,A.length?y-T.length:1/0),A=""),d){case"<":E=F+E+T+A;break;case"=":E=F+A+E+T;break;case"^":E=A.slice(0,U=A.length>>1)+F+E+T+A.slice(U);break;default:E=A+F+E+T;break}return s(E)}return k.toString=function(){return f+""},k}function c(f,h){var d=l((f=qv(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Gm(h)/3)))*3,m=Math.pow(10,-p),g=aH[8+p/3];return function(y){return d(m*y)+g}}return{format:l,formatPrefix:c}}var FS,Zae,Jae;PYe({thousands:",",grouping:[3],currency:["$",""]});function PYe(e){return FS=Kae(e),Zae=FS.format,Jae=FS.formatPrefix,FS}function LYe(e){return Math.max(0,-Gm(Math.abs(e)))}function BYe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Gm(t)/3)))*3-Gm(Math.abs(e)))}function zYe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Gm(t)-Gm(e))+1}const bN=new Date,vN=new Date;function br(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>br(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>(bN.setTime(+s),vN.setTime(+o),e(bN),e(vN),Math.floor(n(bN,vN))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const Xv=br(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Xv.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?br(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):Xv);Xv.range;const Yv=1e3,Bf=Yv*60,Kv=Bf*60,Zv=Kv*24,Qae=Zv*7,xz=br(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Yv)},(e,t)=>(t-e)/Yv,e=>e.getUTCSeconds());xz.range;const eue=br(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Yv)},(e,t)=>{e.setTime(+e+t*Bf)},(e,t)=>(t-e)/Bf,e=>e.getMinutes());eue.range;const tue=br(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Bf)},(e,t)=>(t-e)/Bf,e=>e.getUTCMinutes());tue.range;const nue=br(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Yv-e.getMinutes()*Bf)},(e,t)=>{e.setTime(+e+t*Kv)},(e,t)=>(t-e)/Kv,e=>e.getHours());nue.range;const rue=br(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Kv)},(e,t)=>(t-e)/Kv,e=>e.getUTCHours());rue.range;const wm=br(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Bf)/Zv,e=>e.getDate()-1);wm.range;const Cm=br(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Zv,e=>e.getUTCDate()-1);Cm.range;const jYe=br(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Zv,e=>Math.floor(e/Zv));jYe.range;function ug(e){return br(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Bf)/Qae)}const wz=ug(0),rk=ug(1),UYe=ug(2),WYe=ug(3),Hm=ug(4),VYe=ug(5),GYe=ug(6);wz.range;rk.range;UYe.range;WYe.range;Hm.range;VYe.range;GYe.range;function lg(e){return br(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/Qae)}const Cz=lg(0),ik=lg(1),HYe=lg(2),qYe=lg(3),qm=lg(4),XYe=lg(5),YYe=lg(6);Cz.range;ik.range;HYe.range;qYe.range;qm.range;XYe.range;YYe.range;const yR=br(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());yR.range;const bR=br(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());bR.range;const zf=br(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());zf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:br(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});zf.range;const jf=br(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());jf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:br(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});jf.range;const Jv="year",Qv="quarter",ex="month",tx="week",nx="date",jD="day",Sz="dayofyear",rx="hours",ix="minutes",sx="seconds",UD="milliseconds",KYe=[Jv,Qv,ex,tx,nx,jD,Sz,rx,ix,sx,UD];KYe.reduce((e,t,n)=>(e[t]=1+n,e),{});const ZYe={[Jv]:zf,[Qv]:yR.every(3),[ex]:yR,[tx]:wz,[nx]:wm,[jD]:wm,[Sz]:wm,[rx]:nue,[ix]:eue,[sx]:xz,[UD]:Xv},JYe={[Jv]:jf,[Qv]:bR.every(3),[ex]:bR,[tx]:Cz,[nx]:Cm,[jD]:Cm,[Sz]:Cm,[rx]:rue,[ix]:tue,[sx]:xz,[UD]:Xv};function QYe(e){return ZYe[e]}function eKe(e){return JYe[e]}function xN(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function wN(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function My(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function iue(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=Ry(i),c=Py(i),f=Ry(s),h=Py(s),d=Ry(o),p=Py(o),m=Ry(a),g=Py(a),y=Ry(u),b=Py(u),x={a:V,A:U,b:A,B:M,c:null,d:dH,e:dH,f:SKe,g:OKe,G:MKe,H:xKe,I:wKe,j:CKe,L:sue,m:_Ke,M:$Ke,p:P,q:j,Q:mH,s:yH,S:kKe,u:EKe,U:AKe,V:TKe,w:DKe,W:IKe,x:null,X:null,y:FKe,Y:NKe,Z:RKe,"%":gH},v={a:q,A:B,b:O,B:G,c:null,d:pH,e:pH,f:zKe,g:KKe,G:JKe,H:PKe,I:LKe,j:BKe,L:aue,m:jKe,M:UKe,p:Z,q:re,Q:mH,s:yH,S:WKe,u:VKe,U:GKe,V:HKe,w:qKe,W:XKe,x:null,X:null,y:YKe,Y:ZKe,Z:QKe,"%":gH},w={a:k,A:E,b:F,B:T,c:I,d:fH,e:fH,f:mKe,g:cH,G:lH,H:hH,I:hH,j:hKe,L:gKe,m:fKe,M:dKe,p:$,q:cKe,Q:bKe,s:vKe,S:pKe,u:sKe,U:oKe,V:aKe,w:iKe,W:uKe,x:D,X:N,y:cH,Y:lH,Z:lKe,"%":yKe};x.x=C(n,x),x.X=C(r,x),x.c=C(t,x),v.x=C(n,v),v.X=C(r,v),v.c=C(t,v);function C(R,H){return function(Y){var L=[],te=-1,X=0,ie=R.length,se,oe,le;for(Y instanceof Date||(Y=new Date(+Y));++te<ie;)R.charCodeAt(te)===37&&(L.push(R.slice(X,te)),(oe=uH[se=R.charAt(++te)])!=null?se=R.charAt(++te):oe=se==="e"?" ":"0",(le=H[se])&&(se=le(Y,oe)),L.push(se),X=te+1);return L.push(R.slice(X,te)),L.join("")}}function S(R,H){return function(Y){var L=My(1900,void 0,1),te=_(L,R,Y+="",0),X,ie;if(te!=Y.length)return null;if("Q"in L)return new Date(L.Q);if("s"in L)return new Date(L.s*1e3+("L"in L?L.L:0));if(H&&!("Z"in L)&&(L.Z=0),"p"in L&&(L.H=L.H%12+L.p*12),L.m===void 0&&(L.m="q"in L?L.q:0),"V"in L){if(L.V<1||L.V>53)return null;"w"in L||(L.w=1),"Z"in L?(X=wN(My(L.y,0,1)),ie=X.getUTCDay(),X=ie>4||ie===0?ik.ceil(X):ik(X),X=Cm.offset(X,(L.V-1)*7),L.y=X.getUTCFullYear(),L.m=X.getUTCMonth(),L.d=X.getUTCDate()+(L.w+6)%7):(X=xN(My(L.y,0,1)),ie=X.getDay(),X=ie>4||ie===0?rk.ceil(X):rk(X),X=wm.offset(X,(L.V-1)*7),L.y=X.getFullYear(),L.m=X.getMonth(),L.d=X.getDate()+(L.w+6)%7)}else("W"in L||"U"in L)&&("w"in L||(L.w="u"in L?L.u%7:"W"in L?1:0),ie="Z"in L?wN(My(L.y,0,1)).getUTCDay():xN(My(L.y,0,1)).getDay(),L.m=0,L.d="W"in L?(L.w+6)%7+L.W*7-(ie+5)%7:L.w+L.U*7-(ie+6)%7);return"Z"in L?(L.H+=L.Z/100|0,L.M+=L.Z%100,wN(L)):xN(L)}}function _(R,H,Y,L){for(var te=0,X=H.length,ie=Y.length,se,oe;te<X;){if(L>=ie)return-1;if(se=H.charCodeAt(te++),se===37){if(se=H.charAt(te++),oe=w[se in uH?H.charAt(te++):se],!oe||(L=oe(R,Y,L))<0)return-1}else if(se!=Y.charCodeAt(L++))return-1}return L}function $(R,H,Y){var L=l.exec(H.slice(Y));return L?(R.p=c.get(L[0].toLowerCase()),Y+L[0].length):-1}function k(R,H,Y){var L=d.exec(H.slice(Y));return L?(R.w=p.get(L[0].toLowerCase()),Y+L[0].length):-1}function E(R,H,Y){var L=f.exec(H.slice(Y));return L?(R.w=h.get(L[0].toLowerCase()),Y+L[0].length):-1}function F(R,H,Y){var L=y.exec(H.slice(Y));return L?(R.m=b.get(L[0].toLowerCase()),Y+L[0].length):-1}function T(R,H,Y){var L=m.exec(H.slice(Y));return L?(R.m=g.get(L[0].toLowerCase()),Y+L[0].length):-1}function I(R,H,Y){return _(R,t,H,Y)}function D(R,H,Y){return _(R,n,H,Y)}function N(R,H,Y){return _(R,r,H,Y)}function V(R){return o[R.getDay()]}function U(R){return s[R.getDay()]}function A(R){return u[R.getMonth()]}function M(R){return a[R.getMonth()]}function P(R){return i[+(R.getHours()>=12)]}function j(R){return 1+~~(R.getMonth()/3)}function q(R){return o[R.getUTCDay()]}function B(R){return s[R.getUTCDay()]}function O(R){return u[R.getUTCMonth()]}function G(R){return a[R.getUTCMonth()]}function Z(R){return i[+(R.getUTCHours()>=12)]}function re(R){return 1+~~(R.getUTCMonth()/3)}return{format:function(R){var H=C(R+="",x);return H.toString=function(){return R},H},parse:function(R){var H=S(R+="",!1);return H.toString=function(){return R},H},utcFormat:function(R){var H=C(R+="",v);return H.toString=function(){return R},H},utcParse:function(R){var H=S(R+="",!0);return H.toString=function(){return R},H}}}var uH={"-":"",_:" ",0:"0"},Lr=/^\s*\d+/,tKe=/^%/,nKe=/[\\^$*+?|[\]().{}]/g;function Rt(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function rKe(e){return e.replace(nKe,"\\$&")}function Ry(e){return new RegExp("^(?:"+e.map(rKe).join("|")+")","i")}function Py(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function iKe(e,t,n){var r=Lr.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function sKe(e,t,n){var r=Lr.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function oKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function aKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function uKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function lH(e,t,n){var r=Lr.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function cH(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function lKe(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function cKe(e,t,n){var r=Lr.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function fKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function fH(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function hKe(e,t,n){var r=Lr.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function hH(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function dKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function pKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function gKe(e,t,n){var r=Lr.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function mKe(e,t,n){var r=Lr.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function yKe(e,t,n){var r=tKe.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function bKe(e,t,n){var r=Lr.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function vKe(e,t,n){var r=Lr.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function dH(e,t){return Rt(e.getDate(),t,2)}function xKe(e,t){return Rt(e.getHours(),t,2)}function wKe(e,t){return Rt(e.getHours()%12||12,t,2)}function CKe(e,t){return Rt(1+wm.count(zf(e),e),t,3)}function sue(e,t){return Rt(e.getMilliseconds(),t,3)}function SKe(e,t){return sue(e,t)+"000"}function _Ke(e,t){return Rt(e.getMonth()+1,t,2)}function $Ke(e,t){return Rt(e.getMinutes(),t,2)}function kKe(e,t){return Rt(e.getSeconds(),t,2)}function EKe(e){var t=e.getDay();return t===0?7:t}function AKe(e,t){return Rt(wz.count(zf(e)-1,e),t,2)}function oue(e){var t=e.getDay();return t>=4||t===0?Hm(e):Hm.ceil(e)}function TKe(e,t){return e=oue(e),Rt(Hm.count(zf(e),e)+(zf(e).getDay()===4),t,2)}function DKe(e){return e.getDay()}function IKe(e,t){return Rt(rk.count(zf(e)-1,e),t,2)}function FKe(e,t){return Rt(e.getFullYear()%100,t,2)}function OKe(e,t){return e=oue(e),Rt(e.getFullYear()%100,t,2)}function NKe(e,t){return Rt(e.getFullYear()%1e4,t,4)}function MKe(e,t){var n=e.getDay();return e=n>=4||n===0?Hm(e):Hm.ceil(e),Rt(e.getFullYear()%1e4,t,4)}function RKe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Rt(t/60|0,"0",2)+Rt(t%60,"0",2)}function pH(e,t){return Rt(e.getUTCDate(),t,2)}function PKe(e,t){return Rt(e.getUTCHours(),t,2)}function LKe(e,t){return Rt(e.getUTCHours()%12||12,t,2)}function BKe(e,t){return Rt(1+Cm.count(jf(e),e),t,3)}function aue(e,t){return Rt(e.getUTCMilliseconds(),t,3)}function zKe(e,t){return aue(e,t)+"000"}function jKe(e,t){return Rt(e.getUTCMonth()+1,t,2)}function UKe(e,t){return Rt(e.getUTCMinutes(),t,2)}function WKe(e,t){return Rt(e.getUTCSeconds(),t,2)}function VKe(e){var t=e.getUTCDay();return t===0?7:t}function GKe(e,t){return Rt(Cz.count(jf(e)-1,e),t,2)}function uue(e){var t=e.getUTCDay();return t>=4||t===0?qm(e):qm.ceil(e)}function HKe(e,t){return e=uue(e),Rt(qm.count(jf(e),e)+(jf(e).getUTCDay()===4),t,2)}function qKe(e){return e.getUTCDay()}function XKe(e,t){return Rt(ik.count(jf(e)-1,e),t,2)}function YKe(e,t){return Rt(e.getUTCFullYear()%100,t,2)}function KKe(e,t){return e=uue(e),Rt(e.getUTCFullYear()%100,t,2)}function ZKe(e,t){return Rt(e.getUTCFullYear()%1e4,t,4)}function JKe(e,t){var n=e.getUTCDay();return e=n>=4||n===0?qm(e):qm.ceil(e),Rt(e.getUTCFullYear()%1e4,t,4)}function QKe(){return"+0000"}function gH(){return"%"}function mH(e){return+e}function yH(e){return Math.floor(+e/1e3)}var Gg,lue,cue,fue,hue;eZe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function eZe(e){return Gg=iue(e),lue=Gg.format,cue=Gg.parse,fue=Gg.utcFormat,hue=Gg.utcParse,Gg}function Sb(e){const t={};return n=>t[n]||(t[n]=e(n))}function tZe(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=nZe(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function nZe(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function due(e){const t=Sb(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=qv(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return tZe(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=qv(o??",f");const a=DYe(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=BYe(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=zYe(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=LYe(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}let vR;rZe();function rZe(){return vR=due({format:Zae,formatPrefix:Jae})}function iZe(e){return due(Kae(e))}function bH(e){return arguments.length?vR=iZe(e):vR}function vH(e,t,n){n=n||{},gz(n)||xi(`Invalid time multi-format specifier: ${n}`);const r=t(sx),i=t(ix),s=t(rx),o=t(nx),a=t(tx),u=t(ex),l=t(Qv),c=t(Jv),f=e(n[UD]||".%L"),h=e(n[sx]||":%S"),d=e(n[ix]||"%I:%M"),p=e(n[rx]||"%I %p"),m=e(n[nx]||n[jD]||"%a %d"),g=e(n[tx]||"%b %d"),y=e(n[ex]||"%B"),b=e(n[Qv]||"%B"),x=e(n[Jv]||"%Y");return v=>(r(v)<v?f:i(v)<v?h:s(v)<v?d:o(v)<v?p:u(v)<v?a(v)<v?m:g:c(v)<v?l(v)<v?y:b:x)(v)}function pue(e){const t=Sb(e.format),n=Sb(e.utcFormat);return{timeFormat:r=>gR(r)?t(r):vH(t,QYe,r),utcFormat:r=>gR(r)?n(r):vH(n,eKe,r),timeParse:Sb(e.parse),utcParse:Sb(e.utcParse)}}let xR;sZe();function sZe(){return xR=pue({format:lue,parse:cue,utcFormat:fue,utcParse:hue})}function oZe(e){return pue(iue(e))}function wR(e){return arguments.length?xR=oZe(e):xR}const xH=(e,t)=>X1({},e,t);function aZe(e,t){const n=arguments.length;return n&&n!==2&&xi("defaultLocale expects either zero or two arguments."),n?xH(bH(e),wR(t)):xH(bH(),wR())}const uZe=/^(data:|([A-Za-z]+:)?\/\/)/,lZe=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,cZe=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,wH="file://";function fZe(e,t){return n=>({options:n||{},sanitize:dZe,load:hZe,fileAccess:!!t,file:pZe(t),http:mZe(e)})}async function hZe(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function dZe(e,t){t=X1({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=lZe.test(e.replace(cZe,""));(e==null||typeof e!="string"||!a)&&xi("Sanitize failure, invalid URI: "+bz(e));const u=uZe.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith(wH))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice(wH.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function pZe(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):gZe}async function gZe(){xi("No file system access.")}function mZe(e){return e?async function(t,n){const r=X1({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?wa(s[i])?s[i]():s.text():xi(s.status+""+s.statusText)}:yZe}async function yZe(){xi("No HTTP fetch method available.")}const bZe=e=>e!=null&&e===e,vZe=e=>e==="true"||e==="false"||e===!0||e===!1,xZe=e=>!Number.isNaN(Date.parse(e)),gue=e=>!Number.isNaN(+e)&&!(e instanceof Date),wZe=e=>gue(e)&&Number.isInteger(+e),CH={boolean:dYe,integer:JG,number:JG,date:gYe,string:mYe,unknown:zD},OS=[vZe,wZe,gue,xZe],CZe=["boolean","integer","number","date"];function SZe(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=OS.length,i=OS.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&bZe(u)&&!OS[a](u)&&(i[a]=0,++o,o===OS.length))return"string";return CZe[i.reduce((s,o)=>s===0?o:s,0)-1]}function _Ze(e,t){return t.reduce((n,r)=>(n[r]=SZe(e,r),n),{})}function SH(e){const t=function(n,r){const i={delimiter:e};return _z(n,r?X1(r,i):i)};return t.responseType="text",t}function _z(e,t){return t.header&&(e=t.header.map(bz).join(t.delimiter)+`
`+e),xYe(t.delimiter).parse(e+"")}_z.responseType="text";function $Ze(e){return typeof Buffer=="function"&&wa(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function $z(e,t){const n=t&&t.property?Lae(t.property):zD;return gz(e)&&!$Ze(e)?kZe(n(e),t):n(JSON.parse(e))}$z.responseType="json";function kZe(e,t){return!Nu(e)&&fYe(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const EZe={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function mue(e,t){let n,r,i,s;return e=$z(e,t),t&&t.feature?(n=Uae,i=t.feature):t&&t.mesh?(n=Vae,i=t.mesh,s=EZe[t.filter]):xi("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,s):xi("Invalid TopoJSON object: "+i),r&&r.features||[r]}mue.responseType="json";const CN={dsv:_z,csv:SH(","),tsv:SH("	"),json:$z,topojson:mue};function yue(e,t){return arguments.length>1?(CN[e]=t,this):yz(CN,e)?CN[e]:null}function AZe(e){const t=yue(e);return t&&t.responseType||"text"}function TZe(e,t,n,r){t=t||{};const i=yue(t.type||"json");return i||xi("Unknown data format type: "+t.type),e=i(e,t),t.parse&&DZe(e,t.parse,n,r),yz(e,"columns")&&delete e.columns,e}function DZe(e,t,n,r){if(!e.length)return;const i=wR();n=n||i.timeParse,r=r||i.utcParse;let s=e.columns||Object.keys(e[0]),o,a,u,l,c,f;t==="auto"&&(t=_Ze(e,s)),s=Object.keys(t);const h=s.map(d=>{const p=t[d];let m,g;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return m=p.split(/:(.+)?/,2),g=m[1],(g[0]==="'"&&g[g.length-1]==="'"||g[0]==='"'&&g[g.length-1]==='"')&&(g=g.slice(1,-1)),(m[0]==="utc"?r:n)(g);if(!CH[p])throw Error("Illegal format pattern: "+d+":"+p);return CH[p]});for(u=0,c=e.length,f=s.length;u<c;++u)for(o=e[u],l=0;l<f;++l)a=s[l],o[a]=h[l](o[a])}const IZe=fZe(typeof fetch<"u"&&fetch,null);function WD(e){const t=e||zD,n=[],r={};return n.add=i=>{const s=t(i);return r[s]||(r[s]=1,n.push(i)),n},n.remove=i=>{const s=t(i);if(r[s]){r[s]=0;const o=n.indexOf(i);o>=0&&n.splice(o,1)}return n},n}async function N_(e,t){try{await t(e)}catch(n){e.error(n)}}const bue=Symbol("vega_id");let FZe=1;function VD(e){return!!(e&&Ve(e))}function Ve(e){return e[bue]}function vue(e,t){return e[bue]=t,e}function zt(e){const t=e===Object(e)?e:{data:e};return Ve(t)?t:vue(t,FZe++)}function kz(e){return GD(e,zt({}))}function GD(e,t){for(const n in e)t[n]=e[n];return t}function xue(e,t){return vue(t,Ve(e))}function cg(e,t){return e?t?(n,r)=>e(n,r)||Ve(t(n))-Ve(t(r)):(n,r)=>e(n,r)||Ve(n)-Ve(r):null}function wue(e){return e&&e.constructor===fg}function fg(){const e=[],t=[],n=[],r=[],i=[];let s=null,o=!1;return{constructor:fg,insert(a){const u=Q$(a),l=u.length;for(let c=0;c<l;++c)e.push(u[c]);return this},remove(a){const u=wa(a)?r:t,l=Q$(a),c=l.length;for(let f=0;f<c;++f)u.push(l[f]);return this},modify(a,u,l){const c={field:u,value:mz(l)};return wa(a)?(c.filter=a,i.push(c)):(c.tuple=a,n.push(c)),this},encode(a,u){return wa(a)?i.push({filter:a,field:u}):n.push({tuple:a,field:u}),this},clean(a){return s=a,this},reflow(){return o=!0,this},pulse(a,u){const l={},c={};let f,h,d,p,m,g;for(f=0,h=u.length;f<h;++f)l[Ve(u[f])]=1;for(f=0,h=t.length;f<h;++f)m=t[f],l[Ve(m)]=-1;for(f=0,h=r.length;f<h;++f)p=r[f],u.forEach(b=>{p(b)&&(l[Ve(b)]=-1)});for(f=0,h=e.length;f<h;++f)m=e[f],g=Ve(m),l[g]?l[g]=1:a.add.push(zt(e[f]));for(f=0,h=u.length;f<h;++f)m=u[f],l[Ve(m)]<0&&a.rem.push(m);function y(b,x,v){v?b[x]=v(b):a.encode=x,o||(c[Ve(b)]=b)}for(f=0,h=n.length;f<h;++f)d=n[f],m=d.tuple,p=d.field,g=l[Ve(m)],g>0&&(y(m,p,d.value),a.modifies(p));for(f=0,h=i.length;f<h;++f)d=i[f],p=d.filter,u.forEach(b=>{p(b)&&l[Ve(b)]>0&&y(b,d.field,d.value)}),a.modifies(d.field);if(o)a.mod=t.length||r.length?u.filter(b=>l[Ve(b)]>0):u.slice();else for(g in c)a.mod.push(c[g]);return(s||s==null&&(t.length||r.length))&&a.clean(!0),a}}}const M_="_:mod:_";function HD(){Object.defineProperty(this,M_,{writable:!0,value:{}})}HD.prototype={set(e,t,n,r){const i=this,s=i[e],o=i[M_];return t!=null&&t>=0?(s[t]!==n||r)&&(s[t]=n,o[t+":"+e]=-1,o[e]=-1):(s!==n||r)&&(i[e]=n,o[e]=Nu(n)?1+n.length:-1),i},modified(e,t){const n=this[M_];if(arguments.length){if(Nu(e)){for(let r=0;r<e.length;++r)if(n[e[r]])return!0;return!1}}else{for(const r in n)if(n[r])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[M_]={},this}};let OZe=0;const NZe="pulse",MZe=new HD,RZe=1,PZe=2;function sn(e,t,n,r){this.id=++OZe,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function _H(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}sn.prototype={targets(){return this._targets||(this._targets=WD(BD))},set(e){return this.value!==e?(this.value=e,1):0},skip:_H(RZe),modified:_H(PZe),parameters(e,t,n){t=t!==!1;const r=this._argval=this._argval||new HD,i=this._argops=this._argops||[],s=[];let o,a,u,l;const c=(f,h,d)=>{d instanceof sn?(d!==this&&(t&&d.targets().add(this),s.push(d)),i.push({op:d,name:f,index:h})):r.set(f,h,d)};for(o in e)if(a=e[o],o===NZe)Q$(a).forEach(f=>{f instanceof sn?f!==this&&(f.targets().add(this),s.push(f)):xi("Pulse parameters must be operator instances.")}),this.source=a;else if(Nu(a))for(r.set(o,-1,Array(u=a.length)),l=0;l<u;++l)c(o,l,a[l]);else c(o,-1,a);return this.marshall().clear(),n&&(i.initonly=!0),s},marshall(e){const t=this._argval||MZe,n=this._argops;let r,i,s,o;if(n){const a=n.length;for(i=0;i<a;++i)r=n[i],s=r.op,o=s.modified()&&s.stamp===e,t.set(r.name,r.index,s.value,o);if(n.initonly){for(i=0;i<a;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function LZe(e,t,n,r){let i=1,s;return e instanceof sn?s=e:e&&e.prototype instanceof sn?s=new e:wa(e)?s=new sn(null,e):(i=0,s=new sn(e,t)),this.rank(s),i&&(r=n,n=t),n&&this.connect(s,s.parameters(n,r)),this.touch(s),s}function BZe(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank){this.rerank(e);return}}let zZe=0;function qD(e,t,n){this.id=++zZe,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Rc(e,t,n){return new qD(e,t,n)}qD.prototype={_filter:pR,_apply:zD,targets(){return this._targets||(this._targets=WD(BD))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Rc(e);return this.targets().add(t),t},apply(e){const t=Rc(null,e);return this.targets().add(t),t},merge(){const e=Rc();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=Rc();return this.targets().add(Rc(null,null,uYe(e,n=>{const r=n.dataflow;t.receive(n),r&&r.run&&r.run()}))),t},between(e,t){let n=!1;return e.targets().add(Rc(null,null,()=>n=!0)),t.targets().add(Rc(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=pR,this._targets=null}};function jZe(e,t,n,r){const i=this,s=Rc(n,r),o=function(l){l.dataflow=i;try{s.receive(l)}catch(c){i.error(c)}finally{i.run()}};let a;typeof e=="string"&&typeof document<"u"?a=document.querySelectorAll(e):a=Q$(e);const u=a.length;for(let l=0;l<u;++l)a[l].addEventListener(t,o);return s}function UZe(e,t){const n=this.locale();return TZe(e,t,n.timeParse,n.utcParse)}function WZe(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function VZe(e,t){const n=this;let r=0,i;try{i=await n.loader().load(e,{context:"dataflow",response:AZe(t&&t.type)});try{i=n.parse(i,t)}catch(s){r=-2,n.warn("Data ingestion failed",e,s)}}catch(s){r=-1,n.warn("Loading failed",e,s)}return{data:i,status:r}}async function GZe(e,t,n){const r=this,i=r._pending||HZe(r);i.requests+=1;const s=await r.request(t,n);return r.pulse(e,r.changeset().remove(pR).insert(s.data||[])),i.done(),s}function HZe(e){let t;const n=new Promise(r=>t=r);return n.requests=0,n.done=()=>{--n.requests===0&&(e._pending=null,t(e))},e._pending=n}const qZe={skip:!0};function XZe(e,t,n,r,i){return(e instanceof sn?KZe:YZe)(this,e,t,n,r,i),this}function YZe(e,t,n,r,i,s){const o=X1({},s,qZe);let a,u;wa(n)||(n=mz(n)),r===void 0?a=l=>e.touch(n(l)):wa(r)?(u=new sn(null,r,i,!1),a=l=>{u.evaluate(l);const c=n(l),f=u.value;wue(f)?e.pulse(c,f,s):e.update(c,f,o)}):a=l=>e.update(n(l),r,o),t.apply(a)}function KZe(e,t,n,r,i,s){if(r===void 0)t.targets().add(n);else{const o=s||{},a=new sn(null,ZZe(n,r),i,!1);a.modified(o.force),a.rank=t.rank,t.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),e.connect(n,[a]))}}function ZZe(e,t){return t=wa(t)?t:mz(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}function JZe(e){e.rank=++this._rank}function QZe(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&xi("Cycle detected in dataflow graph.")}const sk={},Qa=1,Bc=2,Cl=4,eJe=Qa|Bc,$H=Qa|Cl,Hg=Qa|Bc|Cl,kH=8,Ly=16,EH=32,AH=64;function mf(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function SN(e,t){const n=[];return fd(e,t,r=>n.push(r)),n}function TH(e,t){const n={};return e.visit(t,r=>{n[Ve(r)]=1}),r=>n[Ve(r)]?null:r}function NS(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}mf.prototype={StopPropagation:sk,ADD:Qa,REM:Bc,MOD:Cl,ADD_REM:eJe,ADD_MOD:$H,ALL:Hg,REFLOW:kH,SOURCE:Ly,NO_SOURCE:EH,NO_FIELDS:AH,fork(e){return new mf(this.dataflow).init(this,e)},clone(){const e=this.fork(Hg);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(Hg|Ly)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new mf(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&AH)&&(n.fields=e.fields),t&Qa?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&Bc?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&Cl?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&EH?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||Hg;return t&Qa&&this.add.length||t&Bc&&this.rem.length||t&Cl&&this.mod.length},reflow(e){if(e)return this.fork(Hg).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(Cl,TH(this,Qa))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Nu(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?Nu(e)?e.some(r=>n[r]):n[e]:!!n:!1},filter(e,t){const n=this;return e&Qa&&(n.addF=NS(n.addF,t)),e&Bc&&(n.remF=NS(n.remF,t)),e&Cl&&(n.modF=NS(n.modF,t)),e&Ly&&(n.srcF=NS(n.srcF,t)),n},materialize(e){e=e||Hg;const t=this;return e&Qa&&t.addF&&(t.add=SN(t.add,t.addF),t.addF=null),e&Bc&&t.remF&&(t.rem=SN(t.rem,t.remF),t.remF=null),e&Cl&&t.modF&&(t.mod=SN(t.mod,t.modF),t.modF=null),e&Ly&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(e&Ly)return fd(n.source,n.srcF,r),n;e&Qa&&fd(n.add,n.addF,r),e&Bc&&fd(n.rem,n.remF,r),e&Cl&&fd(n.mod,n.modF,r);const i=n.source;if(e&kH&&i){const s=n.add.length+n.mod.length;s===i.length||(s?fd(i,TH(n,$H),r):fd(i,n.srcF,r))}return n}};function Ez(e,t,n,r){const i=this;let s=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(const o of n)if(o.stamp===t){if(o.fields){const a=i.fields||(i.fields={});for(const u in o.fields)a[u]=1}o.changed(i.ADD)&&(s|=i.ADD),o.changed(i.REM)&&(s|=i.REM),o.changed(i.MOD)&&(s|=i.MOD)}this.changes=s}zae(Ez,mf,{fork(e){const t=new mf(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Nu(e)?e.some(r=>n[r]):n[e]:0},filter(){xi("MultiPulse does not support filtering.")},materialize(){xi("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let s=0;if(e&n.SOURCE)for(;s<i;++s)r[s].visit(e,t);else for(;s<i;++s)r[s].stamp===n.stamp&&r[s].visit(e,t);return n}});async function tJe(e,t,n){const r=this,i=[];if(r._pulse)return Cue(r);if(r._pending&&await r._pending,t&&await N_(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const s=++r._clock;r._pulse=new mf(r,s,e),r._touched.forEach(c=>r._enqueue(c,!0)),r._touched=WD(BD);let o=0,a,u,l;try{for(;r._heap.size()>0;){if(a=r._heap.pop(),a.rank!==a.qrank){r._enqueue(a,!0);continue}u=a.run(r._getPulse(a,e)),u.then?u=await u:u.async&&(i.push(u.async),u=sk),u!==sk&&a._targets&&a._targets.forEach(c=>r._enqueue(c)),++o}}catch(c){r._heap.clear(),l=c}if(r._input={},r._pulse=null,r.debug(`Pulse ${s}: ${o} operators`),l&&(r._postrun=[],r.error(l)),r._postrun.length){const c=r._postrun.sort((f,h)=>h.priority-f.priority);r._postrun=[];for(let f=0;f<c.length;++f)await N_(r,c[f].callback)}return n&&await N_(r,n),i.length&&Promise.all(i).then(c=>r.runAsync(null,()=>{c.forEach(f=>{try{f(r)}catch(h){r.error(h)}})})),r}async function nJe(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running}function rJe(e,t,n){return this._pulse?Cue(this):(this.evaluate(e,t,n),this)}function iJe(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(r){this.error(r)}}function Cue(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function sJe(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function oJe(e,t){const n=e.source,r=this._clock;return n&&Nu(n)?new Ez(this,r,n.map(i=>i.pulse),t):this._input[e.id]||aJe(this._pulse,n&&n.pulse)}function aJe(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==sk&&(e.source=t.source),e)}const Az={skip:!1,force:!1};function uJe(e,t){const n=t||Az;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function lJe(e,t,n){const r=n||Az;return(e.set(t)||r.force)&&this.touch(e,r),this}function cJe(e,t,n){this.touch(e,n||Az);const r=new mf(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this}function fJe(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Sue(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,hJe(t,0,e)):r=n,r}}}function Sue(e,t,n,r){let i,s;const o=e[n];for(;n>t;){if(s=n-1>>1,i=e[s],r(o,i)<0){e[n]=i,n=s;continue}break}return e[n]=o}function hJe(e,t,n){const r=t,i=e.length,s=e[t];let o=(t<<1)+1,a;for(;o<i;)a=o+1,a<i&&n(e[o],e[a])>=0&&(o=a),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=s,Sue(e,r,t,n)}function Sm(){this.logger(aYe()),this.logLevel(Bae),this._clock=0,this._rank=0,this._locale=aZe();try{this._loader=IZe()}catch{}this._touched=WD(BD),this._input={},this._pulse=null,this._heap=fJe((e,t)=>e.qrank-t.qrank),this._postrun=[]}function By(e){return function(){return this._log[e].apply(this,arguments)}}Sm.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:By("error"),warn:By("warn"),info:By("info"),debug:By("debug"),logLevel:By("level"),cleanThreshold:1e4,add:LZe,connect:BZe,rank:JZe,rerank:QZe,pulse:cJe,touch:uJe,update:lJe,changeset:fg,ingest:WZe,parse:UZe,preload:GZe,request:VZe,events:jZe,on:XZe,evaluate:tJe,run:rJe,runAsync:nJe,runAfter:iJe,_enqueue:sJe,_getPulse:oJe};function he(e,t){sn.call(this,e,null,t)}zae(he,sn,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const Xm={};function _ue(e){const t=$ue(e);return t&&t.Definition||null}function $ue(e){return e=e&&e.toLowerCase(),yz(Xm,e)?Xm[e]:null}function Y1(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Vw(e){let t=e,n=e;e.length===1&&(t=(o,a)=>e(o)-a,n=dJe(e));function r(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)<0?u=c+1:l=c}return u}function i(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)>0?l=c:u=c+1}return u}function s(o,a,u,l){u==null&&(u=0),l==null&&(l=o.length);const c=r(o,a,u,l-1);return c>u&&t(o[c-1],a)>-t(o[c],a)?c-1:c}return{left:r,center:s,right:i}}function dJe(e){return(t,n)=>Y1(e(t),n)}function kue(e){return e===null?NaN:+e}function*pJe(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&(r=+r)>=r&&(yield r)}}const Eue=Vw(Y1),ok=Eue.right,gJe=Eue.left;Vw(kue).center;const Gw=ok;function mJe(e,t){let n=0,r,i=0,s=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(r=o-i,i+=r/++n,s+=r*(o-i));else{let o=-1;for(let a of e)(a=t(a,++o,e))!=null&&(a=+a)>=a&&(r=a-i,i+=r/++n,s+=r*(a-i))}if(n>1)return s/(n-1)}function yJe(e,t){const n=mJe(e,t);return n&&Math.sqrt(n)}class Vi{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[r++]=a),t=o}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n=this._n,r,i,s,o=0;if(n>0){for(o=t[--n];n>0&&(r=o,i=t[--n],o=r+i,s=i-(o-r),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}function bJe(e,t){return Array.from(t,n=>e[n])}var CR=Math.sqrt(50),SR=Math.sqrt(10),_R=Math.sqrt(2);function $R(e,t,n){var r,i=-1,s,o,a;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((r=t<e)&&(s=e,e=t,t=s),(a=Aue(e,t,n))===0||!isFinite(a))return[];if(a>0){let u=Math.round(e/a),l=Math.round(t/a);for(u*a<e&&++u,l*a>t&&--l,o=new Array(s=l-u+1);++i<s;)o[i]=(u+i)*a}else{a=-a;let u=Math.round(e*a),l=Math.round(t*a);for(u/a<e&&++u,l/a>t&&--l,o=new Array(s=l-u+1);++i<s;)o[i]=(u+i)/a}return r&&o.reverse(),o}function Aue(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,i);return i>=0?(s>=CR?10:s>=SR?5:s>=_R?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(s>=CR?10:s>=SR?5:s>=_R?2:1)}function Uf(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),s=r/i;return s>=CR?i*=10:s>=SR?i*=5:s>=_R&&(i*=2),t<e?-i:i}function Yd(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function kR(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function Tue(e,t,n=0,r=e.length-1,i=Y1){for(;r>n;){if(r-n>600){const u=r-n+1,l=t-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),d=Math.max(n,Math.floor(t-l*f/u+h)),p=Math.min(r,Math.floor(t+(u-l)*f/u+h));Tue(e,t,d,p,i)}const s=e[t];let o=n,a=r;for(zy(e,n,t),i(e[r],s)>0&&zy(e,n,r);o<a;){for(zy(e,o,a),++o,--a;i(e[o],s)<0;)++o;for(;i(e[a],s)>0;)--a}i(e[n],s)===0?zy(e,n,a):(++a,zy(e,a,r)),a<=t&&(n=a+1),t<=a&&(r=a-1)}return e}function zy(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function ER(e,t,n){if(e=Float64Array.from(pJe(e,n)),!!(r=e.length)){if((t=+t)<=0||r<2)return kR(e);if(t>=1)return Yd(e);var r,i=(r-1)*t,s=Math.floor(i),o=Yd(Tue(e,s).subarray(0,s+1)),a=kR(e.subarray(s+1));return o+(a-o)*(i-s)}}function Due(e,t,n=kue){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function vJe(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n}function Iue(e,t){return ER(e,.5,t)}function*xJe(e){for(const t of e)yield*t}function Fue(e){return Array.from(xJe(e))}function qs(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function Oue(e,t){let n=0;if(t===void 0)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function*Nue(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)r=t(r,++n,e),r!=null&&r!==""&&(r=+r)>=r&&(yield r)}}function Tz(e,t,n){const r=Float64Array.from(Nue(e,n));return r.sort(Y1),t.map(i=>Due(r,i))}function Dz(e,t){return Tz(e,[.25,.5,.75],t)}function Iz(e,t){const n=e.length,r=yJe(e,t),i=Dz(e,t),s=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,s)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function Mue(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let s=e.extent[0],o=e.extent[1],a,u,l,c,f,h;const d=e.span||o-s||Math.abs(s)||1;if(e.step)a=e.step;else if(e.steps){for(c=d/t,f=0,h=e.steps.length;f<h&&e.steps[f]<c;++f);a=e.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(t)/r),l=e.minstep||0,a=Math.max(l,Math.pow(n,Math.round(Math.log(d)/r)-u));Math.ceil(d/a)>t;)a*=n;for(f=0,h=i.length;f<h;++f)c=a/i[f],c>=l&&d/c<=t&&(a=c)}c=Math.log(a);const p=c>=0?0:~~(-c/r)+1,m=Math.pow(n,-p-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(s/a+m)*a,s=s<c?c-a:c,o=Math.ceil(o/a)*a),{start:s,stop:o===s?s+a:o,step:a}}var Da=Math.random;function wJe(e){Da=e}function Rue(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(Nue(e,r)),s=i.length,o=t;let a,u,l,c;for(l=0,c=Array(o);l<o;++l){for(a=0,u=0;u<s;++u)a+=i[~~(Da()*s)];c[l]=a/s}return c.sort(Y1),[ER(c,n/2),ER(c,1-n/2)]}function Pue(e,t,n,r){r=r||(h=>h);const i=e.length,s=new Float64Array(i);let o=0,a=1,u=r(e[0]),l=u,c=u+t,f;for(;a<i;++a){if(f=r(e[a]),f>=c){for(l=(u+l)/2;o<a;++o)s[o]=l;c=f+t,u=f}l=f}for(l=(u+l)/2;o<a;++o)s[o]=l;return n?CJe(s,t+t/4):s}function CJe(e,t){const n=e.length;let r=0,i=1,s,o;for(;e[r]===e[i];)++i;for(;i<n;){for(s=i+1;e[i]===e[s];)++s;if(e[i]-e[i-1]<t){for(o=i+(r+s-i-i>>1);o<i;)e[o++]=e[i];for(;o>i;)e[o--]=e[r]}r=i,i=s}return e}function SJe(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function _Je(e,t){t==null&&(t=e,e=0);let n,r,i;const s={min(o){return arguments.length?(n=o||0,i=r-n,s):n},max(o){return arguments.length?(r=o||0,i=r-n,s):r},sample(){return n+Math.floor(i*Da())},pdf(o){return o===Math.floor(o)&&o>=n&&o<r?1/i:0},cdf(o){const a=Math.floor(o);return a<n?0:a>=r?1:(a-n+1)/i},icdf(o){return o>=0&&o<=1?n-1+Math.floor(o*i):NaN}};return s.min(e).max(t)}const Lue=Math.sqrt(2*Math.PI),$Je=Math.SQRT2;let jy=NaN;function XD(e,t){e=e||0,t=t??1;let n=0,r=0,i,s;if(jy===jy)n=jy,jy=NaN;else{do n=Da()*2-1,r=Da()*2-1,i=n*n+r*r;while(i===0||i>1);s=Math.sqrt(-2*Math.log(i)/i),n*=s,jy=r*s}return e+n*t}function Fz(e,t,n){n=n??1;const r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*Lue)}function YD(e,t,n){t=t||0,n=n??1;const r=(e-t)/n,i=Math.abs(r);let s;if(i>37)s=0;else{const o=Math.exp(-i*i/2);let a;i<7.07106781186547?(a=.0352624965998911*i+.700383064443688,a=a*i+6.37396220353165,a=a*i+33.912866078383,a=a*i+112.079291497871,a=a*i+221.213596169931,a=a*i+220.206867912376,s=o*a,a=.0883883476483184*i+1.75566716318264,a=a*i+16.064177579207,a=a*i+86.7807322029461,a=a*i+296.564248779674,a=a*i+637.333633378831,a=a*i+793.826512519948,a=a*i+440.413735824752,s=s/a):(a=i+.65,a=i+4/a,a=i+3/a,a=i+2/a,a=i+1/a,s=o/a/2.506628274631)}return r>0?1-s:s}function KD(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*$Je*kJe(2*e-1)}function kJe(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}function Oz(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>XD(n,r),pdf:s=>Fz(s,n,r),cdf:s=>YD(s,n,r),icdf:s=>KD(s,n,r)};return i.mean(e).stdev(t)}function Nz(e,t){const n=Oz();let r=0;const i={data(s){return arguments.length?(e=s,r=s?s.length:0,i.bandwidth(t)):e},bandwidth(s){return arguments.length?(t=s,!t&&e&&(t=Iz(e)),i):t},sample(){return e[~~(Da()*r)]+t*n.sample()},pdf(s){let o=0,a=0;for(;a<r;++a)o+=n.pdf((s-e[a])/t);return o/t/r},cdf(s){let o=0,a=0;for(;a<r;++a)o+=n.cdf((s-e[a])/t);return o/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Mz(e,t){return e=e||0,t=t??1,Math.exp(e+XD()*t)}function Rz(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*Lue*e)}function Pz(e,t,n){return YD(Math.log(e),t,n)}function Lz(e,t,n){return Math.exp(KD(e,t,n))}function Bue(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>Mz(n,r),pdf:s=>Rz(s,n,r),cdf:s=>Pz(s,n,r),icdf:s=>Lz(s,n,r)};return i.mean(e).stdev(t)}function zue(e,t){let n=0,r;function i(o){const a=[];let u=0,l;for(l=0;l<n;++l)u+=a[l]=o[l]==null?1:+o[l];for(l=0;l<n;++l)a[l]/=u;return a}const s={weights(o){return arguments.length?(r=i(t=o||[]),s):t},distributions(o){return arguments.length?(o?(n=o.length,e=o):(n=0,e=[]),s.weights(t)):e},sample(){const o=Da();let a=e[n-1],u=r[0],l=0;for(;l<n-1;u+=r[++l])if(o<u){a=e[l];break}return a.sample()},pdf(o){let a=0,u=0;for(;u<n;++u)a+=r[u]*e[u].pdf(o);return a},cdf(o){let a=0,u=0;for(;u<n;++u)a+=r[u]*e[u].cdf(o);return a},icdf(){throw Error("Mixture icdf not supported.")}};return s.distributions(e).weights(t)}function Bz(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Da()}function zz(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function jz(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function Uz(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function jue(e,t){let n,r;const i={min(s){return arguments.length?(n=s||0,i):n},max(s){return arguments.length?(r=s??1,i):r},sample:()=>Bz(n,r),pdf:s=>zz(s,n,r),cdf:s=>jz(s,n,r),icdf:s=>Uz(s,n,r)};return t==null&&(t=e??1,e=0),i.min(e).max(t)}function Hw(e,t,n,r){const i=r-e*e,s=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-s*e,s]}function ZD(e,t,n,r){e=e.filter(d=>{let p=t(d),m=n(d);return p!=null&&(p=+p)>=p&&m!=null&&(m=+m)>=m}),r&&e.sort((d,p)=>t(d)-t(p));const i=e.length,s=new Float64Array(i),o=new Float64Array(i);let a=0,u=0,l=0,c,f,h;for(h of e)s[a]=c=+t(h),o[a]=f=+n(h),++a,u+=(c-u)/a,l+=(f-l)/a;for(a=0;a<i;++a)s[a]-=u,o[a]-=l;return[s,o,u,l]}function qw(e,t,n,r){let i=-1,s,o;for(const a of e)s=t(a),o=n(a),s!=null&&(s=+s)>=s&&o!=null&&(o=+o)>=o&&r(s,o,++i)}function K1(e,t,n,r,i){let s=0,o=0;return qw(e,t,n,(a,u)=>{const l=u-i(a),c=u-r;s+=l*l,o+=c*c}),1-s/o}function Wz(e,t,n){let r=0,i=0,s=0,o=0,a=0;qw(e,t,n,(c,f)=>{++a,r+=(c-r)/a,i+=(f-i)/a,s+=(c*f-s)/a,o+=(c*c-o)/a});const u=Hw(r,i,s,o),l=c=>u[0]+u[1]*c;return{coef:u,predict:l,rSquared:K1(e,t,n,i,l)}}function Uue(e,t,n){let r=0,i=0,s=0,o=0,a=0;qw(e,t,n,(c,f)=>{++a,c=Math.log(c),r+=(c-r)/a,i+=(f-i)/a,s+=(c*f-s)/a,o+=(c*c-o)/a});const u=Hw(r,i,s,o),l=c=>u[0]+u[1]*Math.log(c);return{coef:u,predict:l,rSquared:K1(e,t,n,i,l)}}function Wue(e,t,n){const[r,i,s,o]=ZD(e,t,n);let a=0,u=0,l=0,c=0,f=0,h,d,p;qw(e,t,n,(b,x)=>{h=r[f++],d=Math.log(x),p=h*x,a+=(x*d-a)/f,u+=(p-u)/f,l+=(p*d-l)/f,c+=(h*p-c)/f});const[m,g]=Hw(u/o,a/o,l/o,c/o),y=b=>Math.exp(m+g*(b-s));return{coef:[Math.exp(m-g*s),g],predict:y,rSquared:K1(e,t,n,o,y)}}function Vue(e,t,n){let r=0,i=0,s=0,o=0,a=0,u=0;qw(e,t,n,(f,h)=>{const d=Math.log(f),p=Math.log(h);++u,r+=(d-r)/u,i+=(p-i)/u,s+=(d*p-s)/u,o+=(d*d-o)/u,a+=(h-a)/u});const l=Hw(r,i,s,o),c=f=>l[0]*Math.pow(f,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:K1(e,t,n,a,c)}}function Vz(e,t,n){const[r,i,s,o]=ZD(e,t,n),a=r.length;let u=0,l=0,c=0,f=0,h=0,d,p,m,g;for(d=0;d<a;)p=r[d],m=i[d++],g=p*p,u+=(g-u)/d,l+=(g*p-l)/d,c+=(g*g-c)/d,f+=(p*m-f)/d,h+=(g*m-h)/d;const y=c-u*u,b=u*y-l*l,x=(h*u-f*l)/b,v=(f*y-h*l)/b,w=-x*u,C=S=>(S=S-s,x*S*S+v*S+w+o);return{coef:[w-v*s+x*s*s+o,v-2*x*s,x],predict:C,rSquared:K1(e,t,n,o,C)}}function Gue(e,t,n,r){if(r===1)return Wz(e,t,n);if(r===2)return Vz(e,t,n);const[i,s,o,a]=ZD(e,t,n),u=i.length,l=[],c=[],f=r+1;let h,d,p,m,g;for(h=0;h<f;++h){for(p=0,m=0;p<u;++p)m+=Math.pow(i[p],h)*s[p];for(l.push(m),g=new Float64Array(f),d=0;d<f;++d){for(p=0,m=0;p<u;++p)m+=Math.pow(i[p],h+d);g[d]=m}c.push(g)}c.push(l);const y=AJe(c),b=x=>{x-=o;let v=a+y[0]+y[1]*x+y[2]*x*x;for(h=3;h<f;++h)v+=y[h]*Math.pow(x,h);return v};return{coef:EJe(f,y,-o,a),predict:b,rSquared:K1(e,t,n,a,b)}}function EJe(e,t,n,r){const i=Array(e);let s,o,a,u;for(s=0;s<e;++s)i[s]=0;for(s=e-1;s>=0;--s)for(a=t[s],u=1,i[s]+=a,o=1;o<=s;++o)u*=(s+1-o)/o,i[s-o]+=a*Math.pow(n,o)*u;return i[0]+=r,i}function AJe(e){const t=e.length-1,n=[];let r,i,s,o,a;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(s=r;s<t+1;++s)a=e[s][r],e[s][r]=e[s][o],e[s][o]=a;for(i=r+1;i<t;++i)for(s=t;s>=r;s--)e[s][i]-=e[s][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(a=0,s=i+1;s<t;++s)a+=e[s][i]*n[s];n[i]=(e[t][i]-a)/e[i][i]}return n}const DH=2,IH=1e-12;function Hue(e,t,n,r){const[i,s,o,a]=ZD(e,t,n,!0),u=i.length,l=Math.max(2,~~(r*u)),c=new Float64Array(u),f=new Float64Array(u),h=new Float64Array(u).fill(1);for(let d=-1;++d<=DH;){const p=[0,l-1];for(let g=0;g<u;++g){const y=i[g],b=p[0],x=p[1],v=y-i[b]>i[x]-y?b:x;let w=0,C=0,S=0,_=0,$=0;const k=1/Math.abs(i[v]-y||1);for(let T=b;T<=x;++T){const I=i[T],D=s[T],N=TJe(Math.abs(y-I)*k)*h[T],V=I*N;w+=N,C+=V,S+=D*N,_+=D*V,$+=I*V}const[E,F]=Hw(C/w,S/w,_/w,$/w);c[g]=E+F*y,f[g]=Math.abs(s[g]-c[g]),DJe(i,g+1,p)}if(d===DH)break;const m=Iue(f);if(Math.abs(m)<IH)break;for(let g=0,y,b;g<u;++g)y=f[g]/(6*m),h[g]=y>=1?IH:(b=1-y*y)*b}return IJe(i,c,o,a)}function TJe(e){return(e=1-e*e*e)*e*e}function DJe(e,t,n){const r=e[t];let i=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>i&&e[s]-r<=r-e[i];)n[0]=++i,n[1]=s,++s}function IJe(e,t,n,r){const i=e.length,s=[];let o=0,a=0,u=[],l;for(;o<i;++o)l=e[o]+n,u[0]===l?u[1]+=(t[o]-u[1])/++a:(a=0,u[1]+=r,u=[l,t[o]],s.push(u));return u[1]+=r,s}const FJe=.5*Math.PI/180;function JD(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=m=>[m,e(m)],s=t[0],o=t[1],a=o-s,u=a/r,l=[i(s)],c=[];if(n===r){for(let m=1;m<r;++m)l.push(i(s+m/n*a));return l.push(i(o)),l}else{c.push(i(o));for(let m=n;--m>0;)c.push(i(s+m/n*a))}let f=l[0],h=c[c.length-1];const d=1/a,p=OJe(f[1],c);for(;h;){const m=i((f[0]+h[0])/2);m[0]-f[0]>=u&&NJe(f,m,h,d,p)>FJe?c.push(m):(f=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function OJe(e,t){let n=e,r=e;const i=t.length;for(let s=0;s<i;++s){const o=t[s][1];o<n&&(n=o),o>r&&(r=o)}return 1/(r-n)}function NJe(e,t,n,r,i){const s=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),o=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(s-o)}var _N=new Date,$N=new Date;function Br(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=function(s){return e(s=new Date(+s)),s},i.ceil=function(s){return e(s=new Date(s-1)),t(s,1),e(s),s},i.round=function(s){var o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=function(s,o){return t(s=new Date(+s),o==null?1:Math.floor(o)),s},i.range=function(s,o,a){var u=[],l;if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=function(s){return Br(function(o){if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},function(o,a){if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););})},n&&(i.count=function(s,o){return _N.setTime(+s),$N.setTime(+o),e(_N),e($N),Math.floor(n(_N,$N))},i.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?function(o){return r(o)%s===0}:function(o){return i.count(0,o)%s===0}):i}),i}var ak=Br(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});ak.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Br(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):ak};const Gz=ak;ak.range;const Ol=1e3,Co=Ol*60,Nl=Co*60,vp=Nl*24,Hz=vp*7,FH=vp*30,kN=vp*365;var que=Br(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*Ol)},function(e,t){return(t-e)/Ol},function(e){return e.getUTCSeconds()});const Kc=que;que.range;var Xue=Br(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ol)},function(e,t){e.setTime(+e+t*Co)},function(e,t){return(t-e)/Co},function(e){return e.getMinutes()});const qz=Xue;Xue.range;var Yue=Br(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ol-e.getMinutes()*Co)},function(e,t){e.setTime(+e+t*Nl)},function(e,t){return(t-e)/Nl},function(e){return e.getHours()});const Xz=Yue;Yue.range;var Kue=Br(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Co)/vp,e=>e.getDate()-1);const yf=Kue;Kue.range;function hg(e){return Br(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Co)/Hz})}var Z1=hg(0),uk=hg(1),MJe=hg(2),RJe=hg(3),Ym=hg(4),PJe=hg(5),LJe=hg(6);Z1.range;uk.range;MJe.range;RJe.range;Ym.range;PJe.range;LJe.range;var Zue=Br(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()});const lk=Zue;Zue.range;var Yz=Br(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Yz.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Br(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};const Wf=Yz;Yz.range;var Jue=Br(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*Co)},function(e,t){return(t-e)/Co},function(e){return e.getUTCMinutes()});const Kz=Jue;Jue.range;var Que=Br(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*Nl)},function(e,t){return(t-e)/Nl},function(e){return e.getUTCHours()});const Zz=Que;Que.range;var ele=Br(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/vp},function(e){return e.getUTCDate()-1});const bf=ele;ele.range;function dg(e){return Br(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/Hz})}var J1=dg(0),ck=dg(1),BJe=dg(2),zJe=dg(3),Km=dg(4),jJe=dg(5),UJe=dg(6);J1.range;ck.range;BJe.range;zJe.range;Km.range;jJe.range;UJe.range;var tle=Br(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()});const fk=tle;tle.range;var Jz=Br(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Jz.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Br(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};const Vf=Jz;Jz.range;function nle(e,t,n,r,i,s){const o=[[Kc,1,Ol],[Kc,5,5*Ol],[Kc,15,15*Ol],[Kc,30,30*Ol],[s,1,Co],[s,5,5*Co],[s,15,15*Co],[s,30,30*Co],[i,1,Nl],[i,3,3*Nl],[i,6,6*Nl],[i,12,12*Nl],[r,1,vp],[r,2,2*vp],[n,1,Hz],[t,1,FH],[t,3,3*FH],[e,1,kN]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=Vw(([,,g])=>g).right(o,h);if(d===o.length)return e.every(Uf(l/kN,c/kN,f));if(d===0)return Gz.every(Math.max(Uf(l,c,f),1));const[p,m]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(m)}return[a,u]}const[WJe,VJe]=nle(Vf,fk,J1,bf,Zz,Kz),[GJe,HJe]=nle(Wf,lk,Z1,yf,Xz,qz),Kr="year",ks="quarter",wi="month",cr="week",Es="date",pi="day",Mu="dayofyear",eo="hours",to="minutes",Mo="seconds",Ia="milliseconds",Qz=[Kr,ks,wi,cr,Es,pi,Mu,eo,to,Mo,Ia],EN=Qz.reduce((e,t,n)=>(e[t]=1+n,e),{});function e6(e){const t=at(e).slice(),n={};return t.length||ye("Missing time unit."),t.forEach(i=>{lt(EN,i)?n[i]=1:ye("Invalid time unit: ".concat(i,"."))}),(n[cr]||n[pi]?1:0)+(n[ks]||n[wi]||n[Es]?1:0)+(n[Mu]?1:0)>1&&ye("Incompatible time units: ".concat(e)),t.sort((i,s)=>EN[i]-EN[s]),t}const qJe={[Kr]:"%Y ",[ks]:"Q%q ",[wi]:"%b ",[Es]:"%d ",[cr]:"W%U ",[pi]:"%a ",[Mu]:"%j ",[eo]:"%H:00",[to]:"00:%M",[Mo]:":%S",[Ia]:".%L",["".concat(Kr,"-").concat(wi)]:"%Y-%m ",["".concat(Kr,"-").concat(wi,"-").concat(Es)]:"%Y-%m-%d ",["".concat(eo,"-").concat(to)]:"%H:%M"};function rle(e,t){const n=St({},qJe,t),r=e6(e),i=r.length;let s="",o=0,a,u;for(o=0;o<i;)for(a=r.length;a>o;--a)if(u=r.slice(o,a).join("-"),n[u]!=null){s+=n[u],o=a;break}return s.trim()}const wd=new Date;function t6(e){return wd.setFullYear(e),wd.setMonth(0),wd.setDate(1),wd.setHours(0,0,0,0),wd}function ile(e){return ole(new Date(e))}function sle(e){return AR(new Date(e))}function ole(e){return yf.count(t6(e.getFullYear())-1,e)}function AR(e){return Z1.count(t6(e.getFullYear())-1,e)}function TR(e){return t6(e).getDay()}function XJe(e,t,n,r,i,s,o){if(0<=e&&e<100){const a=new Date(-1,t,n,r,i,s,o);return a.setFullYear(e),a}return new Date(e,t,n,r,i,s,o)}function ale(e){return lle(new Date(e))}function ule(e){return DR(new Date(e))}function lle(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return bf.count(t-1,e)}function DR(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return J1.count(t-1,e)}function IR(e){return wd.setTime(Date.UTC(e,0,1)),wd.getUTCDay()}function YJe(e,t,n,r,i,s,o){if(0<=e&&e<100){const a=new Date(Date.UTC(-1,t,n,r,i,s,o));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(e,t,n,r,i,s,o))}function cle(e,t,n,r,i){const s=t||1,o=en(e),a=(y,b,x)=>(x=x||y,KJe(n[x],r[x],y===o&&s,b)),u=new Date,l=nc(e),c=l[Kr]?a(Kr):No(2012),f=l[wi]?a(wi):l[ks]?a(ks):Vc,h=l[cr]&&l[pi]?a(pi,1,cr+pi):l[cr]?a(cr,1):l[pi]?a(pi,1):l[Es]?a(Es,1):l[Mu]?a(Mu,1):V1,d=l[eo]?a(eo):Vc,p=l[to]?a(to):Vc,m=l[Mo]?a(Mo):Vc,g=l[Ia]?a(Ia):Vc;return function(y){u.setTime(+y);const b=c(u);return i(b,f(u),h(u,b),d(u),p(u),m(u),g(u))}}function KJe(e,t,n,r){const i=n<=1?e:r?(s,o)=>r+n*Math.floor((e(s,o)-r)/n):(s,o)=>n*Math.floor(e(s,o)/n);return t?(s,o)=>t(i(s,o),o):i}function Zm(e,t,n){return t+e*7-(n+6)%7}const ZJe={[Kr]:e=>e.getFullYear(),[ks]:e=>Math.floor(e.getMonth()/3),[wi]:e=>e.getMonth(),[Es]:e=>e.getDate(),[eo]:e=>e.getHours(),[to]:e=>e.getMinutes(),[Mo]:e=>e.getSeconds(),[Ia]:e=>e.getMilliseconds(),[Mu]:e=>ole(e),[cr]:e=>AR(e),[cr+pi]:(e,t)=>Zm(AR(e),e.getDay(),TR(t)),[pi]:(e,t)=>Zm(1,e.getDay(),TR(t))},JJe={[ks]:e=>3*e,[cr]:(e,t)=>Zm(e,0,TR(t))};function fle(e,t){return cle(e,t||1,ZJe,JJe,XJe)}const QJe={[Kr]:e=>e.getUTCFullYear(),[ks]:e=>Math.floor(e.getUTCMonth()/3),[wi]:e=>e.getUTCMonth(),[Es]:e=>e.getUTCDate(),[eo]:e=>e.getUTCHours(),[to]:e=>e.getUTCMinutes(),[Mo]:e=>e.getUTCSeconds(),[Ia]:e=>e.getUTCMilliseconds(),[Mu]:e=>lle(e),[cr]:e=>DR(e),[pi]:(e,t)=>Zm(1,e.getUTCDay(),IR(t)),[cr+pi]:(e,t)=>Zm(DR(e),e.getUTCDay(),IR(t))},eQe={[ks]:e=>3*e,[cr]:(e,t)=>Zm(e,0,IR(t))};function hle(e,t){return cle(e,t||1,QJe,eQe,YJe)}const tQe={[Kr]:Wf,[ks]:lk.every(3),[wi]:lk,[cr]:Z1,[Es]:yf,[pi]:yf,[Mu]:yf,[eo]:Xz,[to]:qz,[Mo]:Kc,[Ia]:Gz},nQe={[Kr]:Vf,[ks]:fk.every(3),[wi]:fk,[cr]:J1,[Es]:bf,[pi]:bf,[Mu]:bf,[eo]:Zz,[to]:Kz,[Mo]:Kc,[Ia]:Gz};function Q1(e){return tQe[e]}function ey(e){return nQe[e]}function dle(e,t,n){return e?e.offset(t,n):void 0}function ple(e,t,n){return dle(Q1(e),t,n)}function gle(e,t,n){return dle(ey(e),t,n)}function mle(e,t,n,r){return e?e.range(t,n,r):void 0}function yle(e,t,n,r){return mle(Q1(e),t,n,r)}function ble(e,t,n,r){return mle(ey(e),t,n,r)}const _b=1e3,$b=_b*60,kb=$b*60,QD=kb*24,rQe=QD*7,OH=QD*30,FR=QD*365,vle=[Kr,wi,Es,eo,to,Mo,Ia],Eb=vle.slice(0,-1),Ab=Eb.slice(0,-1),Tb=Ab.slice(0,-1),iQe=Tb.slice(0,-1),sQe=[Kr,cr],NH=[Kr,wi],xle=[Kr],Uy=[[Eb,1,_b],[Eb,5,5*_b],[Eb,15,15*_b],[Eb,30,30*_b],[Ab,1,$b],[Ab,5,5*$b],[Ab,15,15*$b],[Ab,30,30*$b],[Tb,1,kb],[Tb,3,3*kb],[Tb,6,6*kb],[Tb,12,12*kb],[iQe,1,QD],[sQe,1,rQe],[NH,1,OH],[NH,3,3*OH],[xle,1,FR]];function wle(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(LD(t))/n;let i=Vw(a=>a[2]).right(Uy,r),s,o;return i===Uy.length?(s=xle,o=Uf(t[0]/FR,t[1]/FR,n)):i?(i=Uy[r/Uy[i-1][2]<Uy[i][2]/r?i-1:i],s=i[0],o=i[1]):(s=vle,o=Math.max(Uf(t[0],t[1],n),1)),{units:s,step:o}}function oQe(e){return t=>{const n=e.length;let r=1,i=String(e[0](t));for(;r<n;++r)i+="|"+e[r](t);return i}}function OR(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:oQe(e)}function Cle(e,t,n){return n||e+(t?"_"+t:"")}const AN=()=>{},aQe={init:AN,add:AN,rem:AN,idx:0},ox={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Xw=Object.keys(ox);function uQe(e,t){return n=>St({name:e,out:n||e},aQe,t)}Xw.forEach(e=>{ox[e]=uQe(e,ox[e])});function Sle(e,t){return ox[e](t)}function _le(e,t){return e.idx-t.idx}function lQe(e){const t={};e.forEach(r=>t[r.name]=r);const n=r=>{r.req&&r.req.forEach(i=>{t[i]||n(t[i]=ox[i]())})};return e.forEach(n),Object.values(t).sort(_le)}function cQe(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function fQe(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t)))}function hQe(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t)))}function dQe(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function $le(e,t){const n=t||Oo,r=lQe(e),i=e.slice().sort(_le);function s(o){this._ops=r,this._out=i,this.cell=o,this.init()}return s.prototype.init=cQe,s.prototype.add=fQe,s.prototype.rem=hQe,s.prototype.set=dQe,s.prototype.get=n,s.fields=e.map(o=>o.out),s}function n6(e){this._key=e?Rf(e):Ve,this.reset()}const ei=n6.prototype;ei.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};ei.add=function(e){this._add.push(e)};ei.rem=function(e){this._rem.push(e)};ei.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,s=Array(r-i),o={};let a,u,l;for(a=0;a<i;++a)o[n(t[a])]=1;for(a=0,u=0;a<r;++a)o[n(l=e[a])]?o[n(l)]=0:s[u++]=l;return this._rem=[],this._add=s};ei.distinct=function(e){const t=this.values(),n={};let r=t.length,i=0,s;for(;--r>=0;)s=e(t[r])+"",lt(n,s)||(n[s]=1,++i);return i};ei.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Tae(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext};ei.argmin=function(e){return this.extent(e)[0]||{}};ei.argmax=function(e){return this.extent(e)[1]||{}};ei.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0};ei.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0};ei.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=Dz(this.values(),e),this._get=e),this._q};ei.q1=function(e){return this.quartile(e)[0]};ei.q2=function(e){return this.quartile(e)[1]};ei.q3=function(e){return this.quartile(e)[2]};ei.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=Rue(this.values(),1e3,.05,e),this._get=e),this._ci};ei.ci0=function(e){return this.ci(e)[0]};ei.ci1=function(e){return this.ci(e)[1]};function Gf(e){he.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Gf.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Xw},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};$e(Gf,he,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),r.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function s(a){let u,l,c,f;for(u in a)for(c=a[u].tuple,l=0;l<i;++l)r[l][f=c[n[l]]]=f}s(e._prev),s(t);function o(a,u,l){const c=n[l],f=r[l++];for(const h in f){const d=a?a+"|"+h:h;u[c]=f[h],l<i?o(d,u,l):t[d]||e.cell(d,u)}}o("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(g){const y=at(vi(g)),b=y.length;let x=0,v;for(;x<b;++x)r[v=y[x]]||(r[v]=1,t.push(v))}this._dims=at(e.groupby),this._dnames=this._dims.map(g=>{const y=Ln(g);return i(g),n.push(y),y}),this.cellkey=e.key?e.key:OR(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],o=e.ops||["count"],a=e.as||[],u=s.length,l={};let c,f,h,d,p,m;for(u!==o.length&&ye("Unmatched number of fields and aggregate ops."),m=0;m<u;++m){if(c=s[m],f=o[m],c==null&&f!=="count"&&ye("Null aggregate field specified."),d=Ln(c),p=Cle(f,d,a[m]),n.push(p),f==="count"){this._counts.push(p);continue}h=l[d],h||(i(c),h=l[d]=[],h.field=c,this._measures.push(h)),f!=="count"&&(this._countOnly=!1),h.push(Sle(f,p))}return this._measures=this._measures.map(g=>$le(g,g.field)),{}},cellkey:OR(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const r=this._measures,i=r.length;n.agg=Array(i);for(let s=0;s<i;++s)n.agg[s]=new r[s](n)}return n.store&&(n.data=new n6),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,s={};for(let o=0;o<i;++o)s[n[o]]=r[o](e);return t?xue(t.tuple,s):zt(s)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const r=e.agg;for(let i=0,s=r.length;i<s;++i)r[i].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,s=e.add,o=e.rem,a=e.mod;let u,l,c,f;if(r)for(l in r)u=r[l],(!i||u.num)&&o.push(u.tuple);for(c=0,f=this._alen;c<f;++c)s.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(u.num===0&&i?o:a).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const pQe=1e-14;function r6(e){he.call(this,null,e)}r6.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};$e(r6,he,{transform(e,t){const n=e.interval!==!1,r=this._bins(e),i=r.start,s=r.step,o=e.as||["bin0","bin1"],a=o[0],u=o[1];let l;return e.modified()?(t=t.reflow(!0),l=t.SOURCE):l=t.modified(vi(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?c=>{const f=r(c);c[a]=f,c[u]=f==null?null:i+s*(1+(f-i)/s)}:c=>c[a]=r(c)),t.modifies(n?o:a)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Mue(e),r=n.step;let i=n.start,s=i+Math.ceil((n.stop-i)/r)*r,o,a;(o=e.anchor)!=null&&(a=o-(i+r*Math.floor((o-i)/r)),i+=a,s+=a);const u=function(l){let c=Pf(t(l));return c==null?null:c<i?-1/0:c>s?1/0:(c=Math.max(i,Math.min(c,s-r)),i+r*Math.floor(pQe+(c-i)/r))};return u.start=i,u.stop=n.stop,u.step=r,this.value=Vo(u,vi(t),e.name||"bin_"+Ln(t))}});function kle(e,t,n){const r=e;let i=t||[],s=n||[],o={},a=0;return{add:u=>s.push(u),remove:u=>o[r(u)]=++a,size:()=>i.length,data:(u,l)=>(a&&(i=i.filter(c=>!o[r(c)]),o={},a=0),l&&u&&i.sort(u),s.length&&(i=u?Nae(u,i,s.sort(u)):i.concat(s),s=[]),i)}}function i6(e){he.call(this,[],e)}i6.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};$e(i6,he,{transform(e,t){const n=t.fork(t.ALL),r=kle(Ve,this.value,n.materialize(n.ADD).add),i=e.sort,s=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(s),this.value=n.source=r.data(cg(i),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function Ele(e){sn.call(this,null,gQe,e)}$e(Ele,sn);function gQe(e){return this.value&&!e.modified()?this.value:Eae(e.fields,e.orders)}function s6(e){he.call(this,null,e)}s6.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function mQe(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}$e(s6,he,{transform(e,t){const n=f=>h=>{for(var d=mQe(a(h),e.case,s)||[],p,m=0,g=d.length;m<g;++m)o.test(p=d[m])||f(p)},r=this._parameterCheck(e,t),i=this._counts,s=this._match,o=this._stop,a=e.field,u=e.as||["text","count"],l=n(f=>i[f]=1+(i[f]||0)),c=n(f=>i[f]-=1);return r?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],s=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let a,u,l;for(a in n)u=r[a],l=n[a]||0,!u&&l?(r[a]=u=zt({}),u[i]=a,u[s]=l,o.add.push(u)):l===0?(u&&o.rem.push(u),n[a]=null,r[a]=null):u[s]!==l&&(u[s]=l,o.mod.push(u));return o.modifies(t)}});function o6(e){he.call(this,null,e)}o6.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};$e(o6,he,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],s=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let a=this.value;return o?(a&&(n.rem=a),a=t.materialize(t.SOURCE).source,n.add=this.value=yQe(a,i,s,e.filter||G1)):n.mod=a,n.source=this.value,n.modifies(r)}});function yQe(e,t,n,r){for(var i=[],s={},o=e.length,a=0,u,l;a<o;++a)for(s[t]=l=e[a],u=0;u<o;++u)s[n]=e[u],r(s)&&(i.push(zt(s)),s={},s[t]=l);return i}const MH={kde:Nz,mixture:zue,normal:Oz,lognormal:Bue,uniform:jue},bQe="distributions",RH="function",vQe="field";function Ale(e,t){const n=e[RH];lt(MH,n)||ye("Unknown distribution function: "+n);const r=MH[n]();for(const i in e)i===vQe?r.data((e.from||t()).map(e[i])):i===bQe?r[i](e[i].map(s=>Ale(s,t))):typeof r[i]===RH&&r[i](e[i]);return r}function a6(e){he.call(this,null,e)}const Tle=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],xQe={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Tle},{name:"weights",type:"number",array:!0}]};a6.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Tle.concat(xQe)},{name:"as",type:"string",array:!0,default:["value","density"]}]};$e(a6,he,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Ale(e.distribution,wQe(t)),i=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&ye("Invalid density method: "+o),!e.extent&&!r.data&&ye("Missing density extent parameter."),o=r[o];const a=e.as||["value","density"],u=e.extent||Lf(r.data()),l=JD(o,u,i,s).map(c=>{const f={};return f[a[0]]=c[0],f[a[1]]=c[1],zt(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function wQe(e){return()=>e.materialize(e.SOURCE).source}function Dle(e,t){return e?e.map((n,r)=>t[r]||Ln(n)):null}function u6(e,t,n){const r=[],i=f=>f(u);let s,o,a,u,l,c;if(t==null)r.push(e.map(n));else for(s={},o=0,a=e.length;o<a;++o)u=e[o],l=t.map(i),c=s[l],c||(s[l]=c=[],c.dims=l,r.push(c)),c.push(n(u));return r}const Ile="bin";function l6(e){he.call(this,null,e)}l6.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:Ile}]};const CQe=(e,t)=>LD(Lf(e,t))/30;$e(l6,he,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,r=u6(t.source,e.groupby,Oo),i=e.smooth||!1,s=e.field,o=e.step||CQe(n,s),a=cg((p,m)=>s(p)-s(m)),u=e.as||Ile,l=r.length;let c=1/0,f=-1/0,h=0,d;for(;h<l;++h){const p=r[h].sort(a);d=-1;for(const m of Pue(p,o,i,s))m<c&&(c=m),m>f&&(f=m),p[++d][u]=m}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(u)}});function Fle(e){sn.call(this,null,SQe,e),this.modified(!0)}$e(Fle,sn);function SQe(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Vo(n=>t(n,e),vi(t),Ln(t))}function c6(e){he.call(this,[void 0,void 0],e)}c6.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};$e(c6,he,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let s=n[0],o=n[1];if((i||s==null)&&(s=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,a=>{const u=Pf(r(a));u!=null&&(u<s&&(s=u),u>o&&(o=u))}),!Number.isFinite(s)||!Number.isFinite(o)){let a=Ln(r);a&&(a=` for field "${a}"`),t.dataflow.warn(`Infinite extent${a}: [${s}, ${o}]`),s=o=void 0}this.value=[s,o]}});function f6(e,t){sn.call(this,e),this.parent=t,this.count=0}$e(f6,sn,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function eI(e){he.call(this,{},e),this._keys=H1();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let r=0,i=t.active;r<i;++r)n(t[r],r,t)}}$e(eI,he,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let s=lt(i,e)&&i[e],o,a;return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=r||(a=this._group[e])&&a.tuple,o=n.dataflow,s=new f6(n.fork(n.NO_SOURCE),this),o.add(s).connect(t(o,e,a)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const n=this._targets.filter(r=>r&&r.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&t[i]!=null;++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,s=this._keys,o=e.modified("key"),a=u=>this.subflow(u,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,u=>{const l=Ve(u),c=s.get(l);c!==void 0&&(s.delete(l),a(c).rem(u))}),t.visit(t.ADD,u=>{const l=r(u);s.set(Ve(u),l),a(l).add(u)}),o||t.modified(r.fields)?t.visit(t.MOD,u=>{const l=Ve(u),c=s.get(l),f=r(u);c===f?a(f).mod(u):(s.set(l,f),a(c).rem(u),a(f).add(u))}):t.changed(t.MOD)&&t.visit(t.MOD,u=>{a(s.get(Ve(u))).mod(u)}),o&&t.visit(t.REFLOW,u=>{const l=Ve(u),c=s.get(l),f=r(u);c!==f&&(s.set(l,f),a(c).rem(u),a(f).add(u))}),t.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}});function Ole(e){sn.call(this,null,_Qe,e)}$e(Ole,sn);function _Qe(e){return this.value&&!e.modified()?this.value:ht(e.name)?at(e.name).map(t=>Rf(t)):Rf(e.name,e.as)}function h6(e){he.call(this,H1(),e)}h6.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};$e(h6,he,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),s=i.add,o=i.rem,a=i.mod,u=e.expr;let l=!0;t.visit(t.REM,f=>{const h=Ve(f);r.has(h)?r.delete(h):o.push(f)}),t.visit(t.ADD,f=>{u(f,e)?s.push(f):r.set(Ve(f),1)});function c(f){const h=Ve(f),d=u(f,e),p=r.get(h);d&&p?(r.delete(h),s.push(f)):!d&&!p?(r.set(h,1),o.push(f)):l&&d&&!p&&a.push(f)}return t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}});function d6(e){he.call(this,[],e)}d6.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};$e(d6,he,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Dle(r,e.as||[]),s=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,a=>{const u=r.map(p=>p(a)),l=u.reduce((p,m)=>Math.max(p,m.length),0);let c=0,f,h,d;for(;c<l;++c){for(h=kz(a),f=0;f<o;++f)h[i[f]]=(d=u[f][c])==null?null:d;s&&(h[s]=c),n.add.push(h)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(i)}});function p6(e){he.call(this,[],e)}p6.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};$e(p6,he,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(Ln),s=e.as||["key","value"],o=s[0],a=s[1],u=r.length;return n.rem=this.value,t.visit(t.SOURCE,l=>{for(let c=0,f;c<u;++c)f=kz(l),f[o]=i[c],f[a]=r[c](l),n.add.push(f)}),this.value=n.source=n.add,n.modifies(s)}});function g6(e){he.call(this,null,e)}g6.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};$e(g6,he,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),s=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(s,o=>o[r]=n(o,e))}});function Nle(e){he.call(this,[],e)}$e(Nle,he,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i=this.value,s=e.size-i.length,o,a,u;if(s>0){for(o=[];--s>=0;)o.push(u=zt(r(e))),i.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else a=i.slice(0,-s),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,i=i.slice(-s);return n.source=this.value=i,n}});const MS={value:"value",median:Iue,mean:vJe,min:kR,max:Yd},$Qe=[];function m6(e){he.call(this,[],e)}m6.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function kQe(e){var t=e.method||MS.value,n;if(MS[t]==null)ye("Unrecognized imputation method: "+t);else return t===MS.value?(n=e.value!==void 0?e.value:0,()=>n):MS[t]}function EQe(e){const t=e.field;return n=>n?t(n):NaN}$e(m6,he,{transform(e,t){var n=t.fork(t.ALL),r=kQe(e),i=EQe(e),s=Ln(e.field),o=Ln(e.key),a=(e.groupby||[]).map(Ln),u=AQe(t.source,e.groupby,e.key,e.keyvals),l=[],c=this.value,f=u.domain.length,h,d,p,m,g,y,b,x,v,w;for(g=0,x=u.length;g<x;++g)for(h=u[g],p=h.values,d=NaN,b=0;b<f;++b)if(h[b]==null){for(m=u.domain[b],w={_impute:!0},y=0,v=p.length;y<v;++y)w[a[y]]=p[y];w[o]=m,w[s]=Number.isNaN(d)?d=r(h,i):d,l.push(zt(w))}return l.length&&(n.add=n.materialize(n.ADD).add.concat(l)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=l,n}});function AQe(e,t,n,r){var i=y=>y(g),s=[],o=r?r.slice():[],a={},u={},l,c,f,h,d,p,m,g;for(o.forEach((y,b)=>a[y]=b+1),h=0,m=e.length;h<m;++h)g=e[h],p=n(g),d=a[p]||(a[p]=o.push(p)),c=(l=t?t.map(i):$Qe)+"",(f=u[c])||(f=u[c]=[],s.push(f),f.values=l),f[d-1]=g;return s.domain=o,s}function y6(e){Gf.call(this,e)}y6.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Xw},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};$e(y6,Gf,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(i=n.value=n.value||this.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),n.changes(),t.visit(t.SOURCE,s=>{St(s,i[n.cellkey(s)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function b6(e){he.call(this,null,e)}b6.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};$e(b6,he,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=u6(r,e.groupby,e.field),s=(e.groupby||[]).map(Ln),o=e.bandwidth,a=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,f=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;a!=="pdf"&&a!=="cdf"&&ye("Invalid density method: "+a),e.resolve==="shared"&&(c||(c=Lf(r,e.field)),f=h=e.steps||h),i.forEach(d=>{const p=Nz(d,o)[a],m=e.counts?d.length:1,g=c||Lf(d);JD(p,g,f,h).forEach(y=>{const b={};for(let x=0;x<s.length;++x)b[s[x]]=d.dims[x];b[u[0]]=y[0],b[u[1]]=y[1]*m,l.push(zt(b))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function Mle(e){sn.call(this,null,TQe,e)}$e(Mle,sn);function TQe(e){return this.value&&!e.modified()?this.value:Fae(e.fields,e.flat)}function Rle(e){he.call(this,[],e),this._pending=null}$e(Rle,he,{transform(e,t){const n=t.dataflow;return this._pending?TN(this,t,this._pending):DQe(e)?t.StopPropagation:e.values?TN(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(i=>(this._pending=at(i.data),s=>s.touch(this)))}:n.request(e.url,e.format).then(r=>TN(this,t,at(r.data)))}});function DQe(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function TN(e,t,n){n.forEach(zt);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function v6(e){he.call(this,{},e)}v6.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};$e(v6,he,{transform(e,t){const n=e.fields,r=e.index,i=e.values,s=e.default==null?null:e.default,o=e.modified(),a=n.length;let u=o?t.SOURCE:t.ADD,l=t,c=e.as,f,h,d;return i?(h=i.length,a>1&&!c&&ye('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==a*h&&ye('The "as" parameter has too few output field names.'),c=c||i.map(Ln),f=function(p){for(var m=0,g=0,y,b;m<a;++m)if(b=r.get(n[m](p)),b==null)for(y=0;y<h;++y,++g)p[c[g]]=s;else for(y=0;y<h;++y,++g)p[c[g]]=i[y](b)}):(c||ye("Missing output field names."),f=function(p){for(var m=0,g;m<a;++m)g=r.get(n[m](p)),p[c[m]]=g??s}),o?l=t.reflow(!0):(d=n.some(p=>t.modified(p.fields)),u|=d?t.MOD:0),t.visit(u,f),l.modifies(c)}});function Ple(e){sn.call(this,null,IQe,e)}$e(Ple,sn);function IQe(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r=1/0,i=-1/0,s,o;for(s=0;s<n;++s)o=t[s],o[0]<r&&(r=o[0]),o[1]>i&&(i=o[1]);return[r,i]}function Lle(e){sn.call(this,null,FQe,e)}$e(Lle,sn);function FQe(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function Ble(e){he.call(this,null,e)}$e(Ble,he,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function x6(e){Gf.call(this,e)}x6.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Xw,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};$e(x6,Gf,{_transform:Gf.prototype.transform,transform(e,t){return this._transform(OQe(e,t),t)}});function OQe(e,t){const n=e.field,r=e.value,i=(e.op==="count"?"__count__":e.op)||"sum",s=vi(n).concat(vi(r)),o=MQe(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(()=>i),fields:o.map(a=>NQe(a,n,r,s)),as:o.map(a=>a+""),modified:e.modified.bind(e)}}function NQe(e,t,n,r){return Vo(i=>t(i)===e?n(i):NaN,r,e+"")}function MQe(e,t,n){const r={},i=[];return n.visit(n.SOURCE,s=>{const o=e(s);r[o]||(r[o]=1,i.push(o))}),i.sort(RD),t?i.slice(0,t):i}function zle(e){eI.call(this,e)}$e(zle,eI,{transform(e,t){const n=e.subflow,r=e.field,i=s=>this.subflow(Ve(s),n,t,s);return(e.modified("field")||r&&t.modified(vi(r)))&&ye("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,s=>{const o=i(s);r(s).forEach(a=>o.mod(a))}),t.visit(t.ADD,s=>{const o=i(s);r(s).forEach(a=>o.add(zt(a)))}),t.visit(t.REM,s=>{const o=i(s);r(s).forEach(a=>o.rem(a))})):(t.visit(t.MOD,s=>i(s).mod(s)),t.visit(t.ADD,s=>i(s).add(s)),t.visit(t.REM,s=>i(s).rem(s))),t.clean()&&t.runAfter(()=>this.clean()),t}});function w6(e){he.call(this,null,e)}w6.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};$e(w6,he,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Dle(e.fields,e.as||[]),s=r?(a,u)=>RQe(a,u,r,i):GD;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,a=>{const u=Ve(a);n.rem.push(o[u]),o[u]=null}),t.visit(t.ADD,a=>{const u=s(a,zt({}));o[Ve(a)]=u,n.add.push(u)}),t.visit(t.MOD,a=>{n.mod.push(s(a,o[Ve(a)]))}),n}});function RQe(e,t,n,r){for(let i=0,s=n.length;i<s;++i)t[r[i]]=n[i](e);return t}function jle(e){he.call(this,null,e)}$e(jle,he,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function C6(e){he.call(this,null,e)}C6.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const PQe=1e-14;$e(C6,he,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=t.materialize(t.SOURCE).source,s=u6(i,e.groupby,e.field),o=(e.groupby||[]).map(Ln),a=[],u=e.step||.01,l=e.probs||qs(u/2,1-PQe,u),c=l.length;return s.forEach(f=>{const h=Tz(f,l);for(let d=0;d<c;++d){const p={};for(let m=0;m<o.length;++m)p[o[m]]=f.dims[m];p[r[0]]=l[d],p[r[1]]=h[d],a.push(zt(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}});function Ule(e){he.call(this,null,e)}$e(Ule,he,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,i=>{const s=Ve(i);n.rem.push(r[s]),r[s]=null}),t.visit(t.ADD,i=>{const s=kz(i);r[Ve(i)]=s,n.add.push(s)}),t.visit(t.MOD,i=>{const s=r[Ve(i)];for(const o in i)s[o]=i[o],n.modifies(o);n.mod.push(s)})),n}});function S6(e){he.call(this,[],e),this.count=0}S6.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};$e(S6,he,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,s=this.value.reduce((c,f)=>(c[Ve(f)]=1,c),{});let o=this.value,a=this.count,u=0;function l(c){let f,h;o.length<i?o.push(c):(h=~~((a+1)*Da()),h<o.length&&h>=u&&(f=o[h],s[Ve(f)]&&n.rem.push(f),o[h]=c)),++a}if(t.rem.length&&(t.visit(t.REM,c=>{const f=Ve(c);s[f]&&(s[f]=-1,n.rem.push(c)),--a}),o=o.filter(c=>s[Ve(c)]!==-1)),(t.rem.length||r)&&o.length<i&&t.source&&(u=a=o.length,t.visit(t.SOURCE,c=>{s[Ve(c)]||l(c)}),u=-1),r&&o.length>i){const c=o.length-i;for(let f=0;f<c;++f)s[Ve(o[f])]=-1,n.rem.push(o[f]);o=o.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{s[Ve(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=o.filter(c=>!s[Ve(c)])),this.count=a,this.value=n.source=o,n}});function _6(e){he.call(this,null,e)}_6.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};$e(_6,he,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=qs(e.start,e.stop,e.step||1).map(i=>{const s={};return s[r]=i,zt(s)}),n.add=t.add.concat(this.value),n}});function Wle(e){he.call(this,null,e),this.modified(!0)}$e(Wle,he,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function $6(e){he.call(this,null,e)}const Vle=["unit0","unit1"];$6.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:Qz,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Vle}]};$e($6,he,{transform(e,t){const n=e.field,r=e.interval!==!1,i=e.timezone==="utc",s=this._floor(e,t),o=(i?ey:Q1)(s.unit).offset,a=e.as||Vle,u=a[0],l=a[1],c=s.step;let f=s.start||1/0,h=s.stop||-1/0,d=t.ADD;return(e.modified()||t.modified(vi(n)))&&(t=t.reflow(!0),d=t.SOURCE,f=1/0,h=-1/0),t.visit(d,p=>{const m=n(p);let g,y;m==null?(p[u]=null,r&&(p[l]=null)):(p[u]=g=y=s(m),r&&(p[l]=y=o(g,c)),g<f&&(f=g),y>h&&(h=y))}),s.start=f,s.stop=h,t.modifies(r?a:u)},_floor(e,t){const n=e.timezone==="utc",{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:wle({extent:e.extent||Lf(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=e6(r),o=this.value||{},a=(n?hle:fle)(s,i);return a.unit=en(s),a.units=s,a.step=i,a.start=o.start,a.stop=o.stop,this.value=a}});function Gle(e){he.call(this,H1(),e)}$e(Gle,he,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,s=a=>i.set(r(a),a);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,a=>i.delete(r(a))),t.visit(t.ADD,s)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}});function Hle(e){he.call(this,null,e)}$e(Hle,he,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(cg(e.sort)):t.source).map(e.field))}});function LQe(e,t,n,r){const i=ax[e](t,n);return{init:i.init||Vc,update:function(s,o){o[r]=i.next(s)}}}const ax={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=ax.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||ye("ntile num must be greater than zero.");const n=ax.cume_dist(),r=n.next;return{init:n.init,next:i=>Math.ceil(t*r(i))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||ye("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=BQe(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};function BQe(e,t,n){for(let r=t.length;n<r;++n)if(e(t[n])!=null)return n;return-1}const zQe=Object.keys(ax);function qle(e){const t=at(e.ops),n=at(e.fields),r=at(e.params),i=at(e.as),s=this.outputs=[],o=this.windows=[],a={},u={},l=[],c=[];let f=!0;function h(d){at(vi(d)).forEach(p=>a[p]=1)}h(e.sort),t.forEach((d,p)=>{const m=n[p],g=Ln(m),y=Cle(d,g,i[p]);if(h(m),s.push(y),lt(ax,d))o.push(LQe(d,n[p],r[p],y));else{if(m==null&&d!=="count"&&ye("Null aggregate field specified."),d==="count"){l.push(y);return}f=!1;let b=u[g];b||(b=u[g]=[],b.field=m,c.push(b)),b.push(Sle(d,y))}}),(l.length||c.length)&&(this.cell=jQe(c,l,f)),this.inputs=Object.keys(a)}const Xle=qle.prototype;Xle.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()};Xle.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,s=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<s;++o)r[o].update(e,t)};function jQe(e,t,n){e=e.map(u=>$le(u,u.field));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,s=r.agg=Array(i),o=0;o<i;++o)s[o]=new e[o](r);if(r.store)var a=r.data=new n6;return r.add=function(u){if(r.num+=1,!n){a&&a.add(u);for(let l=0;l<i;++l)s[l].add(s[l].get(u),u)}},r.rem=function(u){if(r.num-=1,!n){a&&a.rem(u);for(let l=0;l<i;++l)s[l].rem(s[l].get(u),u)}},r.set=function(u){let l,c;for(a&&a.values(),l=0,c=t.length;l<c;++l)u[t[l]]=r.num;if(!n)for(l=0,c=s.length;l<c;++l)s[l].set(u)},r.init=function(){r.num=0,a&&a.reset();for(let u=0;u<i;++u)s[u].init()},r}function k6(e){he.call(this,{},e),this._mlen=0,this._mods=[]}k6.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:zQe.concat(Xw)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};$e(k6,he,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=cg(e.sort),i=OR(e.groupby),s=a=>this.group(i(a));let o=this.state;(!o||n)&&(o=this.state=new qle(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,a=>s(a).add(a))):(t.visit(t.REM,a=>s(a).remove(a)),t.visit(t.ADD,a=>s(a).add(a)));for(let a=0,u=this._mlen;a<u;++a)UQe(this._mods[a],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=kle(Ve),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function UQe(e,t,n,r){const i=r.sort,s=i&&!r.ignorePeers,o=r.frame||[null,0],a=e.data(n),u=a.length,l=s?Vw(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:i||No(-1)};t.init();for(let f=0;f<u;++f)WQe(c,o,f,u),s&&VQe(c,l),t.update(c,a[f])}function WQe(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function VQe(e,t){const n=e.i0,r=e.i1-1,i=e.compare,s=e.data,o=s.length-1;n>0&&!i(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),r<o&&!i(s[r],s[r+1])&&(e.i1=t.right(s,s[r]))}const GQe=Object.freeze(Object.defineProperty({__proto__:null,aggregate:Gf,bin:r6,collect:i6,compare:Ele,countpattern:s6,cross:o6,density:a6,dotbin:l6,expression:Fle,extent:c6,facet:eI,field:Ole,filter:h6,flatten:d6,fold:p6,formula:g6,generate:Nle,impute:m6,joinaggregate:y6,kde:b6,key:Mle,load:Rle,lookup:v6,multiextent:Ple,multivalues:Lle,params:Ble,pivot:x6,prefacet:zle,project:w6,proxy:jle,quantile:C6,relay:Ule,sample:S6,sequence:_6,sieve:Wle,subflow:f6,timeunit:$6,tupleindex:Gle,values:Hle,window:k6},Symbol.toStringTag,{value:"Module"}));function ty(e,t,n){return e.fields=t||[],e.fname=n,e}function HQe(e){return e.length===1?qQe(e[0]):XQe(e)}const qQe=e=>function(t){return t[e]},XQe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function Hl(e){throw Error(e)}function YQe(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||Hl("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&Hl("Access path missing closing bracket: "+e),r&&Hl("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function KQe(e,t,n){const r=YQe(e);return e=r.length===1?r[0]:e,ty((n&&n.get||HQe)(r),[e],t||e)}KQe("id");ty(e=>e,[],"identity");ty(()=>0,[],"zero");ty(()=>1,[],"one");const Yle=ty(()=>!0,[],"true");ty(()=>!1,[],"false");var Yu=Array.isArray;function E6(e){return e===Object(e)}function wu(e){return e[e.length-1]}function ZQe(e){return e==null||e===""?null:+e}function A6(e){return e!=null?Yu(e)?e:[e]:[]}function tI(e){return typeof e=="function"}function nI(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const JQe=Object.prototype.hasOwnProperty;function Il(e,t){return JQe.call(e,t)}function Go(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),nI(r,n)}function hk(e){return typeof e=="string"}const QQe=1e4;function eet(e){e=+e||QQe;let t,n,r;const i=()=>{t={},n={},r=0},s=(o,a)=>(++r>e&&(n=t,t={},r=1),t[o]=a);return i(),{clear:i,has:o=>Il(t,o)||Il(n,o),get:o=>Il(t,o)?t[o]:Il(n,o)?s(o,n[o]):void 0,set:(o,a)=>Il(t,o)?t[o]=a:s(o,a)}}function Kle(e){return Yu(e)?"["+e.map(Kle)+"]":E6(e)||hk(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Zle(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Ut(e){return function(){return e}}const PH=Math.abs,ti=Math.atan2,Yh=Math.cos,tet=Math.max,DN=Math.min,qa=Math.sin,Nd=Math.sqrt,ri=1e-12,Jm=Math.PI,dk=Jm/2,Jle=2*Jm;function net(e){return e>1?0:e<-1?Jm:Math.acos(e)}function LH(e){return e>=1?dk:e<=-1?-dk:Math.asin(e)}const NR=Math.PI,MR=2*NR,hd=1e-6,ret=MR-hd;function Qle(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function iet(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Qle;const n=10**t;return function(r){this._+=r[0];for(let i=1,s=r.length;i<s;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}let T6=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Qle:iet(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,r,i){this._append`Q${+t},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(t,n,r,i,s,o){this._append`C${+t},${+n},${+r},${+i},${this._x1=+s},${this._y1=+o}`}arcTo(t,n,r,i,s){if(t=+t,n=+n,r=+r,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,u=r-t,l=i-n,c=o-t,f=a-n,h=c*c+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>hd)if(!(Math.abs(f*u-l*c)>hd)||!s)this._append`L${this._x1=t},${this._y1=n}`;else{let d=r-o,p=i-a,m=u*u+l*l,g=d*d+p*p,y=Math.sqrt(m),b=Math.sqrt(h),x=s*Math.tan((NR-Math.acos((m+h-g)/(2*y*b)))/2),v=x/b,w=x/y;Math.abs(v-1)>hd&&this._append`L${t+v*c},${n+v*f}`,this._append`A${s},${s},0,0,${+(f*d>c*p)},${this._x1=t+w*u},${this._y1=n+w*l}`}}arc(t,n,r,i,s,o){if(t=+t,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),u=r*Math.sin(i),l=t+a,c=n+u,f=1^o,h=o?i-s:s-i;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>hd||Math.abs(this._y1-c)>hd)&&this._append`L${l},${c}`,r&&(h<0&&(h=h%MR+MR),h>ret?this._append`A${r},${r},0,1,${f},${t-a},${n-u}A${r},${r},0,1,${f},${this._x1=l},${this._y1=c}`:h>hd&&this._append`A${r},${r},0,${+(h>=NR)},${f},${this._x1=t+r*Math.cos(s)},${this._y1=n+r*Math.sin(s)}`)}rect(t,n,r,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}};function D6(){return new T6}D6.prototype=T6.prototype;function rI(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);t=r}return e},()=>new T6(t)}function set(e){return e.innerRadius}function oet(e){return e.outerRadius}function aet(e){return e.startAngle}function uet(e){return e.endAngle}function cet(e){return e&&e.padAngle}function fet(e,t,n,r,i,s,o,a){var u=n-e,l=r-t,c=o-i,f=a-s,h=f*u-c*l;if(!(h*h<ri))return h=(c*(t-s)-f*(e-i))/h,[e+h*u,t+h*l]}function RS(e,t,n,r,i,s,o){var a=e-n,u=t-r,l=(o?s:-s)/Nd(a*a+u*u),c=l*u,f=-l*a,h=e+c,d=t+f,p=n+c,m=r+f,g=(h+p)/2,y=(d+m)/2,b=p-h,x=m-d,v=b*b+x*x,w=i-s,C=h*m-p*d,S=(x<0?-1:1)*Nd(tet(0,w*w*v-C*C)),_=(C*x-b*S)/v,$=(-C*b-x*S)/v,k=(C*x+b*S)/v,E=(-C*b+x*S)/v,F=_-g,T=$-y,I=k-g,D=E-y;return F*F+T*T>I*I+D*D&&(_=k,$=E),{cx:_,cy:$,x01:-c,y01:-f,x11:_*(i/w-1),y11:$*(i/w-1)}}function het(){var e=set,t=oet,n=Ut(0),r=null,i=aet,s=uet,o=cet,a=null,u=rI(l);function l(){var c,f,h=+e.apply(this,arguments),d=+t.apply(this,arguments),p=i.apply(this,arguments)-dk,m=s.apply(this,arguments)-dk,g=PH(m-p),y=m>p;if(a||(a=c=u()),d<h&&(f=d,d=h,h=f),!(d>ri))a.moveTo(0,0);else if(g>Jle-ri)a.moveTo(d*Yh(p),d*qa(p)),a.arc(0,0,d,p,m,!y),h>ri&&(a.moveTo(h*Yh(m),h*qa(m)),a.arc(0,0,h,m,p,y));else{var b=p,x=m,v=p,w=m,C=g,S=g,_=o.apply(this,arguments)/2,$=_>ri&&(r?+r.apply(this,arguments):Nd(h*h+d*d)),k=DN(PH(d-h)/2,+n.apply(this,arguments)),E=k,F=k,T,I;if($>ri){var D=LH($/h*qa(_)),N=LH($/d*qa(_));(C-=D*2)>ri?(D*=y?1:-1,v+=D,w-=D):(C=0,v=w=(p+m)/2),(S-=N*2)>ri?(N*=y?1:-1,b+=N,x-=N):(S=0,b=x=(p+m)/2)}var V=d*Yh(b),U=d*qa(b),A=h*Yh(w),M=h*qa(w);if(k>ri){var P=d*Yh(x),j=d*qa(x),q=h*Yh(v),B=h*qa(v),O;if(g<Jm)if(O=fet(V,U,q,B,P,j,A,M)){var G=V-O[0],Z=U-O[1],re=P-O[0],R=j-O[1],H=1/qa(net((G*re+Z*R)/(Nd(G*G+Z*Z)*Nd(re*re+R*R)))/2),Y=Nd(O[0]*O[0]+O[1]*O[1]);E=DN(k,(h-Y)/(H-1)),F=DN(k,(d-Y)/(H+1))}else E=F=0}S>ri?F>ri?(T=RS(q,B,V,U,d,F,y),I=RS(P,j,A,M,d,F,y),a.moveTo(T.cx+T.x01,T.cy+T.y01),F<k?a.arc(T.cx,T.cy,F,ti(T.y01,T.x01),ti(I.y01,I.x01),!y):(a.arc(T.cx,T.cy,F,ti(T.y01,T.x01),ti(T.y11,T.x11),!y),a.arc(0,0,d,ti(T.cy+T.y11,T.cx+T.x11),ti(I.cy+I.y11,I.cx+I.x11),!y),a.arc(I.cx,I.cy,F,ti(I.y11,I.x11),ti(I.y01,I.x01),!y))):(a.moveTo(V,U),a.arc(0,0,d,b,x,!y)):a.moveTo(V,U),!(h>ri)||!(C>ri)?a.lineTo(A,M):E>ri?(T=RS(A,M,P,j,h,-E,y),I=RS(V,U,q,B,h,-E,y),a.lineTo(T.cx+T.x01,T.cy+T.y01),E<k?a.arc(T.cx,T.cy,E,ti(T.y01,T.x01),ti(I.y01,I.x01),!y):(a.arc(T.cx,T.cy,E,ti(T.y01,T.x01),ti(T.y11,T.x11),!y),a.arc(0,0,h,ti(T.cy+T.y11,T.cx+T.x11),ti(I.cy+I.y11,I.cx+I.x11),y),a.arc(I.cx,I.cy,E,ti(I.y11,I.x11),ti(I.y01,I.x01),!y))):a.arc(0,0,h,w,v,y)}if(a.closePath(),c)return a=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-Jm/2;return[Yh(f)*c,qa(f)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:Ut(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:Ut(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:Ut(+c),l):n},l.padRadius=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:Ut(+c),l):r},l.startAngle=function(c){return arguments.length?(i=typeof c=="function"?c:Ut(+c),l):i},l.endAngle=function(c){return arguments.length?(s=typeof c=="function"?c:Ut(+c),l):s},l.padAngle=function(c){return arguments.length?(o=typeof c=="function"?c:Ut(+c),l):o},l.context=function(c){return arguments.length?(a=c??null,l):a},l}function ece(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function tce(e){this._context=e}tce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function I6(e){return new tce(e)}function nce(e){return e[0]}function rce(e){return e[1]}function ice(e,t){var n=Ut(!0),r=null,i=I6,s=null,o=rI(a);e=typeof e=="function"?e:e===void 0?nce:Ut(e),t=typeof t=="function"?t:t===void 0?rce:Ut(t);function a(u){var l,c=(u=ece(u)).length,f,h=!1,d;for(r==null&&(s=i(d=o())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+e(f,l,u),+t(f,l,u));if(d)return s=null,d+""||null}return a.x=function(u){return arguments.length?(e=typeof u=="function"?u:Ut(+u),a):e},a.y=function(u){return arguments.length?(t=typeof u=="function"?u:Ut(+u),a):t},a.defined=function(u){return arguments.length?(n=typeof u=="function"?u:Ut(!!u),a):n},a.curve=function(u){return arguments.length?(i=u,r!=null&&(s=i(r)),a):i},a.context=function(u){return arguments.length?(u==null?r=s=null:s=i(r=u),a):r},a}function sce(e,t,n){var r=null,i=Ut(!0),s=null,o=I6,a=null,u=rI(l);e=typeof e=="function"?e:e===void 0?nce:Ut(+e),t=typeof t=="function"?t:Ut(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?rce:Ut(+n);function l(f){var h,d,p,m=(f=ece(f)).length,g,y=!1,b,x=new Array(m),v=new Array(m);for(s==null&&(a=o(b=u())),h=0;h<=m;++h){if(!(h<m&&i(g=f[h],h,f))===y)if(y=!y)d=h,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),p=h-1;p>=d;--p)a.point(x[p],v[p]);a.lineEnd(),a.areaEnd()}y&&(x[h]=+e(g,h,f),v[h]=+t(g,h,f),a.point(r?+r(g,h,f):x[h],n?+n(g,h,f):v[h]))}if(b)return a=null,b+""||null}function c(){return ice().defined(i).curve(o).context(s)}return l.x=function(f){return arguments.length?(e=typeof f=="function"?f:Ut(+f),r=null,l):e},l.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Ut(+f),l):e},l.x1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Ut(+f),l):r},l.y=function(f){return arguments.length?(t=typeof f=="function"?f:Ut(+f),n=null,l):t},l.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Ut(+f),l):t},l.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Ut(+f),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(r).y(t)},l.defined=function(f){return arguments.length?(i=typeof f=="function"?f:Ut(!!f),l):i},l.curve=function(f){return arguments.length?(o=f,s!=null&&(a=o(s)),l):o},l.context=function(f){return arguments.length?(f==null?s=a=null:a=o(s=f),l):s},l}const det={draw(e,t){const n=Nd(t/Jm);e.moveTo(n,0),e.arc(0,0,n,0,Jle)}};function pet(e,t){let n=null,r=rI(i);e=typeof e=="function"?e:Ut(e||det),t=typeof t=="function"?t:Ut(t===void 0?64:+t);function i(){let s;if(n||(n=s=r()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),s)return n=null,s+""||null}return i.type=function(s){return arguments.length?(e=typeof s=="function"?s:Ut(s),i):e},i.size=function(s){return arguments.length?(t=typeof s=="function"?s:Ut(+s),i):t},i.context=function(s){return arguments.length?(n=s??null,i):n},i}function Hf(){}function pk(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function iI(e){this._context=e}iI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:pk(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:pk(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function get(e){return new iI(e)}function oce(e){this._context=e}oce.prototype={areaStart:Hf,areaEnd:Hf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:pk(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function met(e){return new oce(e)}function ace(e){this._context=e}ace.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:pk(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function yet(e){return new ace(e)}function uce(e,t){this._basis=new iI(e),this._beta=t}uce.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r=e[0],i=t[0],s=e[n]-r,o=t[n]-i,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(r+u*s),this._beta*t[a]+(1-this._beta)*(i+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const bet=function e(t){function n(r){return t===1?new iI(r):new uce(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function gk(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function F6(e,t){this._context=e,this._k=(1-t)/6}F6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:gk(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:gk(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const vet=function e(t){function n(r){return new F6(r,t)}return n.tension=function(r){return e(+r)},n}(0);function O6(e,t){this._context=e,this._k=(1-t)/6}O6.prototype={areaStart:Hf,areaEnd:Hf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:gk(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const xet=function e(t){function n(r){return new O6(r,t)}return n.tension=function(r){return e(+r)},n}(0);function N6(e,t){this._context=e,this._k=(1-t)/6}N6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:gk(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const wet=function e(t){function n(r){return new N6(r,t)}return n.tension=function(r){return e(+r)},n}(0);function M6(e,t,n){var r=e._x1,i=e._y1,s=e._x2,o=e._y2;if(e._l01_a>ri){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>ri){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,s,o,e._x2,e._y2)}function lce(e,t){this._context=e,this._alpha=t}lce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:M6(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Cet=function e(t){function n(r){return t?new lce(r,t):new F6(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function cce(e,t){this._context=e,this._alpha=t}cce.prototype={areaStart:Hf,areaEnd:Hf,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:M6(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const _et=function e(t){function n(r){return t?new cce(r,t):new O6(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function fce(e,t){this._context=e,this._alpha=t}fce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:M6(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const $et=function e(t){function n(r){return t?new fce(r,t):new N6(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function hce(e){this._context=e}hce.prototype={areaStart:Hf,areaEnd:Hf,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function ket(e){return new hce(e)}function BH(e){return e<0?-1:1}function zH(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(BH(s)+BH(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function jH(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function IN(e,t,n){var r=e._x0,i=e._y0,s=e._x1,o=e._y1,a=(s-r)/3;e._context.bezierCurveTo(r+a,i+a*t,s-a,o-a*n,s,o)}function mk(e){this._context=e}mk.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:IN(this,this._t0,jH(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,IN(this,jH(this,n=zH(this,e,t)),n);break;default:IN(this,this._t0,n=zH(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function dce(e){this._context=new pce(e)}(dce.prototype=Object.create(mk.prototype)).point=function(e,t){mk.prototype.point.call(this,t,e)};function pce(e){this._context=e}pce.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}};function Eet(e){return new mk(e)}function Aet(e){return new dce(e)}function gce(e){this._context=e}gce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=UH(e),i=UH(t),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function UH(e){var t,n=e.length-1,r,i=new Array(n),s=new Array(n),o=new Array(n);for(i[0]=0,s[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,s[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,s[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/s[t-1],s[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/s[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/s[t];for(s[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}function Tet(e){return new gce(e)}function sI(e,t){this._context=e,this._t=t}sI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function Det(e){return new sI(e,.5)}function Iet(e){return new sI(e,0)}function Fet(e){return new sI(e,1)}function bc(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const mce=()=>typeof Image<"u"?Image:null;function Zb(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Oet(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function R6(e){let t,n,r;e.length!==2?(t=Zb,n=(a,u)=>Zb(e(a),u),r=(a,u)=>e(a)-u):(t=e===Zb||e===Oet?e:Net,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function Net(){return 0}function yce(e){return e===null?NaN:+e}const Met=R6(Zb),RR=Met.right;R6(yce).center;const Yw=RR,Ret=Math.sqrt(50),Pet=Math.sqrt(10),Let=Math.sqrt(2);function yk(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=Ret?10:s>=Pet?5:s>=Let?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?yk(e,t,n*2):[a,u,l]}function PR(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const r=t<e,[i,s,o]=r?yk(t,e,n):yk(e,t,n);if(!(s>=i))return[];const a=s-i+1,u=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)u[l]=(s-l)/-o;else for(let l=0;l<a;++l)u[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)u[l]=(i+l)/-o;else for(let l=0;l<a;++l)u[l]=(i+l)*o;return u}function LR(e,t,n){return t=+t,e=+e,n=+n,yk(e,t,n)[2]}function bk(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?LR(t,e,n):LR(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function Bet(e,t,n=yce){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function zet(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function jet(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function vk(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Qm(e){return e=vk(Math.abs(e)),e?e[1]:NaN}function Uet(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function Wet(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Vet=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function xp(e){if(!(t=Vet.exec(e)))throw new Error("invalid format: "+e);var t;return new P6({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}xp.prototype=P6.prototype;function P6(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}P6.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Get(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var bce;function Het(e,t){var n=vk(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(bce=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+vk(e,Math.max(0,t+s-1))[0]}function WH(e,t){var n=vk(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const VH={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:jet,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>WH(e*100,t),r:WH,s:Het,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function GH(e){return e}var HH=Array.prototype.map,qH=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function qet(e){var t=e.grouping===void 0||e.thousands===void 0?GH:Uet(HH.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?GH:Wet(HH.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=xp(f);var h=f.fill,d=f.align,p=f.sign,m=f.symbol,g=f.zero,y=f.width,b=f.comma,x=f.precision,v=f.trim,w=f.type;w==="n"?(b=!0,w="g"):VH[w]||(x===void 0&&(x=12),v=!0,w="g"),(g||h==="0"&&d==="=")&&(g=!0,h="0",d="=");var C=m==="$"?n:m==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",S=m==="$"?r:/[%p]/.test(w)?o:"",_=VH[w],$=/[defgprs%]/.test(w);x=x===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function k(E){var F=C,T=S,I,D,N;if(w==="c")T=_(E)+T,E="";else{E=+E;var V=E<0||1/E<0;if(E=isNaN(E)?u:_(Math.abs(E),x),v&&(E=Get(E)),V&&+E==0&&p!=="+"&&(V=!1),F=(V?p==="("?p:a:p==="-"||p==="("?"":p)+F,T=(w==="s"?qH[8+bce/3]:"")+T+(V&&p==="("?")":""),$){for(I=-1,D=E.length;++I<D;)if(N=E.charCodeAt(I),48>N||N>57){T=(N===46?i+E.slice(I+1):E.slice(I))+T,E=E.slice(0,I);break}}}b&&!g&&(E=t(E,1/0));var U=F.length+E.length+T.length,A=U<y?new Array(y-U+1).join(h):"";switch(b&&g&&(E=t(A+E,A.length?y-T.length:1/0),A=""),d){case"<":E=F+E+T+A;break;case"=":E=F+A+E+T;break;case"^":E=A.slice(0,U=A.length>>1)+F+E+T+A.slice(U);break;default:E=A+F+E+T;break}return s(E)}return k.toString=function(){return f+""},k}function c(f,h){var d=l((f=xp(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Qm(h)/3)))*3,m=Math.pow(10,-p),g=qH[8+p/3];return function(y){return d(m*y)+g}}return{format:l,formatPrefix:c}}var PS,oI,L6;Xet({thousands:",",grouping:[3],currency:["$",""]});function Xet(e){return PS=qet(e),oI=PS.format,L6=PS.formatPrefix,PS}function vce(e){return Math.max(0,-Qm(Math.abs(e)))}function xce(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qm(t)/3)))*3-Qm(Math.abs(e)))}function wce(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Qm(t)-Qm(e))+1}const FN=new Date,ON=new Date;function vr(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>vr(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>(FN.setTime(+s),ON.setTime(+o),e(FN),e(ON),Math.floor(n(FN,ON))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const e0=vr(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);e0.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?vr(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):e0);e0.range;const Ml=1e3,So=Ml*60,Rl=So*60,rc=Rl*24,B6=rc*7,XH=rc*30,NN=rc*365,Pl=vr(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Ml)},(e,t)=>(t-e)/Ml,e=>e.getUTCSeconds());Pl.range;const aI=vr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ml)},(e,t)=>{e.setTime(+e+t*So)},(e,t)=>(t-e)/So,e=>e.getMinutes());aI.range;const uI=vr(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*So)},(e,t)=>(t-e)/So,e=>e.getUTCMinutes());uI.range;const lI=vr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ml-e.getMinutes()*So)},(e,t)=>{e.setTime(+e+t*Rl)},(e,t)=>(t-e)/Rl,e=>e.getHours());lI.range;const cI=vr(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Rl)},(e,t)=>(t-e)/Rl,e=>e.getUTCHours());cI.range;const vf=vr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*So)/rc,e=>e.getDate()-1);vf.range;const Kd=vr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/rc,e=>e.getUTCDate()-1);Kd.range;const Cce=vr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/rc,e=>Math.floor(e/rc));Cce.range;function pg(e){return vr(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*So)/B6)}const Kw=pg(0),xk=pg(1),Yet=pg(2),Ket=pg(3),t0=pg(4),Zet=pg(5),Jet=pg(6);Kw.range;xk.range;Yet.range;Ket.range;t0.range;Zet.range;Jet.range;function gg(e){return vr(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/B6)}const Zw=gg(0),wk=gg(1),Qet=gg(2),ett=gg(3),n0=gg(4),ttt=gg(5),ntt=gg(6);Zw.range;wk.range;Qet.range;ett.range;n0.range;ttt.range;ntt.range;const ux=vr(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());ux.range;const lx=vr(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());lx.range;const Ru=vr(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Ru.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:vr(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Ru.range;const Pu=vr(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Pu.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:vr(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Pu.range;function Sce(e,t,n,r,i,s){const o=[[Pl,1,Ml],[Pl,5,5*Ml],[Pl,15,15*Ml],[Pl,30,30*Ml],[s,1,So],[s,5,5*So],[s,15,15*So],[s,30,30*So],[i,1,Rl],[i,3,3*Rl],[i,6,6*Rl],[i,12,12*Rl],[r,1,rc],[r,2,2*rc],[n,1,B6],[t,1,XH],[t,3,3*XH],[e,1,NN]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=R6(([,,g])=>g).right(o,h);if(d===o.length)return e.every(bk(l/NN,c/NN,f));if(d===0)return e0.every(Math.max(bk(l,c,f),1));const[p,m]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(m)}return[a,u]}const[rtt,itt]=Sce(Pu,lx,Zw,Cce,cI,uI),[stt,ott]=Sce(Ru,ux,Kw,vf,lI,aI),cx="year",fx="quarter",hx="month",dx="week",px="date",fI="day",z6="dayofyear",gx="hours",mx="minutes",yx="seconds",hI="milliseconds",att=[cx,fx,hx,dx,px,fI,z6,gx,mx,yx,hI];att.reduce((e,t,n)=>(e[t]=1+n,e),{});const utt={[cx]:Ru,[fx]:ux.every(3),[hx]:ux,[dx]:Kw,[px]:vf,[fI]:vf,[z6]:vf,[gx]:lI,[mx]:aI,[yx]:Pl,[hI]:e0},ltt={[cx]:Pu,[fx]:lx.every(3),[hx]:lx,[dx]:Zw,[px]:Kd,[fI]:Kd,[z6]:Kd,[gx]:cI,[mx]:uI,[yx]:Pl,[hI]:e0};function ctt(e){return utt[e]}function ftt(e){return ltt[e]}function MN(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function RN(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Wy(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function htt(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=Vy(i),c=Gy(i),f=Vy(s),h=Gy(s),d=Vy(o),p=Gy(o),m=Vy(a),g=Gy(a),y=Vy(u),b=Gy(u),x={a:V,A:U,b:A,B:M,c:null,d:eq,e:eq,f:Mtt,g:Gtt,G:qtt,H:Ftt,I:Ott,j:Ntt,L:_ce,m:Rtt,M:Ptt,p:P,q:j,Q:rq,s:iq,S:Ltt,u:Btt,U:ztt,V:jtt,w:Utt,W:Wtt,x:null,X:null,y:Vtt,Y:Htt,Z:Xtt,"%":nq},v={a:q,A:B,b:O,B:G,c:null,d:tq,e:tq,f:Jtt,g:unt,G:cnt,H:Ytt,I:Ktt,j:Ztt,L:kce,m:Qtt,M:ent,p:Z,q:re,Q:rq,s:iq,S:tnt,u:nnt,U:rnt,V:int,w:snt,W:ont,x:null,X:null,y:ant,Y:lnt,Z:fnt,"%":nq},w={a:k,A:E,b:F,B:T,c:I,d:JH,e:JH,f:Att,g:ZH,G:KH,H:QH,I:QH,j:_tt,L:Ett,m:Stt,M:$tt,p:$,q:Ctt,Q:Dtt,s:Itt,S:ktt,u:ytt,U:btt,V:vtt,w:mtt,W:xtt,x:D,X:N,y:ZH,Y:KH,Z:wtt,"%":Ttt};x.x=C(n,x),x.X=C(r,x),x.c=C(t,x),v.x=C(n,v),v.X=C(r,v),v.c=C(t,v);function C(R,H){return function(Y){var L=[],te=-1,X=0,ie=R.length,se,oe,le;for(Y instanceof Date||(Y=new Date(+Y));++te<ie;)R.charCodeAt(te)===37&&(L.push(R.slice(X,te)),(oe=YH[se=R.charAt(++te)])!=null?se=R.charAt(++te):oe=se==="e"?" ":"0",(le=H[se])&&(se=le(Y,oe)),L.push(se),X=te+1);return L.push(R.slice(X,te)),L.join("")}}function S(R,H){return function(Y){var L=Wy(1900,void 0,1),te=_(L,R,Y+="",0),X,ie;if(te!=Y.length)return null;if("Q"in L)return new Date(L.Q);if("s"in L)return new Date(L.s*1e3+("L"in L?L.L:0));if(H&&!("Z"in L)&&(L.Z=0),"p"in L&&(L.H=L.H%12+L.p*12),L.m===void 0&&(L.m="q"in L?L.q:0),"V"in L){if(L.V<1||L.V>53)return null;"w"in L||(L.w=1),"Z"in L?(X=RN(Wy(L.y,0,1)),ie=X.getUTCDay(),X=ie>4||ie===0?wk.ceil(X):wk(X),X=Kd.offset(X,(L.V-1)*7),L.y=X.getUTCFullYear(),L.m=X.getUTCMonth(),L.d=X.getUTCDate()+(L.w+6)%7):(X=MN(Wy(L.y,0,1)),ie=X.getDay(),X=ie>4||ie===0?xk.ceil(X):xk(X),X=vf.offset(X,(L.V-1)*7),L.y=X.getFullYear(),L.m=X.getMonth(),L.d=X.getDate()+(L.w+6)%7)}else("W"in L||"U"in L)&&("w"in L||(L.w="u"in L?L.u%7:"W"in L?1:0),ie="Z"in L?RN(Wy(L.y,0,1)).getUTCDay():MN(Wy(L.y,0,1)).getDay(),L.m=0,L.d="W"in L?(L.w+6)%7+L.W*7-(ie+5)%7:L.w+L.U*7-(ie+6)%7);return"Z"in L?(L.H+=L.Z/100|0,L.M+=L.Z%100,RN(L)):MN(L)}}function _(R,H,Y,L){for(var te=0,X=H.length,ie=Y.length,se,oe;te<X;){if(L>=ie)return-1;if(se=H.charCodeAt(te++),se===37){if(se=H.charAt(te++),oe=w[se in YH?H.charAt(te++):se],!oe||(L=oe(R,Y,L))<0)return-1}else if(se!=Y.charCodeAt(L++))return-1}return L}function $(R,H,Y){var L=l.exec(H.slice(Y));return L?(R.p=c.get(L[0].toLowerCase()),Y+L[0].length):-1}function k(R,H,Y){var L=d.exec(H.slice(Y));return L?(R.w=p.get(L[0].toLowerCase()),Y+L[0].length):-1}function E(R,H,Y){var L=f.exec(H.slice(Y));return L?(R.w=h.get(L[0].toLowerCase()),Y+L[0].length):-1}function F(R,H,Y){var L=y.exec(H.slice(Y));return L?(R.m=b.get(L[0].toLowerCase()),Y+L[0].length):-1}function T(R,H,Y){var L=m.exec(H.slice(Y));return L?(R.m=g.get(L[0].toLowerCase()),Y+L[0].length):-1}function I(R,H,Y){return _(R,t,H,Y)}function D(R,H,Y){return _(R,n,H,Y)}function N(R,H,Y){return _(R,r,H,Y)}function V(R){return o[R.getDay()]}function U(R){return s[R.getDay()]}function A(R){return u[R.getMonth()]}function M(R){return a[R.getMonth()]}function P(R){return i[+(R.getHours()>=12)]}function j(R){return 1+~~(R.getMonth()/3)}function q(R){return o[R.getUTCDay()]}function B(R){return s[R.getUTCDay()]}function O(R){return u[R.getUTCMonth()]}function G(R){return a[R.getUTCMonth()]}function Z(R){return i[+(R.getUTCHours()>=12)]}function re(R){return 1+~~(R.getUTCMonth()/3)}return{format:function(R){var H=C(R+="",x);return H.toString=function(){return R},H},parse:function(R){var H=S(R+="",!1);return H.toString=function(){return R},H},utcFormat:function(R){var H=C(R+="",v);return H.toString=function(){return R},H},utcParse:function(R){var H=S(R+="",!0);return H.toString=function(){return R},H}}}var YH={"-":"",_:" ",0:"0"},zr=/^\s*\d+/,dtt=/^%/,ptt=/[\\^$*+?|[\]().{}]/g;function Pt(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function gtt(e){return e.replace(ptt,"\\$&")}function Vy(e){return new RegExp("^(?:"+e.map(gtt).join("|")+")","i")}function Gy(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function mtt(e,t,n){var r=zr.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function ytt(e,t,n){var r=zr.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function btt(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function vtt(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function xtt(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function KH(e,t,n){var r=zr.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function ZH(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function wtt(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Ctt(e,t,n){var r=zr.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function Stt(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function JH(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function _tt(e,t,n){var r=zr.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function QH(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function $tt(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function ktt(e,t,n){var r=zr.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Ett(e,t,n){var r=zr.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Att(e,t,n){var r=zr.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Ttt(e,t,n){var r=dtt.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Dtt(e,t,n){var r=zr.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Itt(e,t,n){var r=zr.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function eq(e,t){return Pt(e.getDate(),t,2)}function Ftt(e,t){return Pt(e.getHours(),t,2)}function Ott(e,t){return Pt(e.getHours()%12||12,t,2)}function Ntt(e,t){return Pt(1+vf.count(Ru(e),e),t,3)}function _ce(e,t){return Pt(e.getMilliseconds(),t,3)}function Mtt(e,t){return _ce(e,t)+"000"}function Rtt(e,t){return Pt(e.getMonth()+1,t,2)}function Ptt(e,t){return Pt(e.getMinutes(),t,2)}function Ltt(e,t){return Pt(e.getSeconds(),t,2)}function Btt(e){var t=e.getDay();return t===0?7:t}function ztt(e,t){return Pt(Kw.count(Ru(e)-1,e),t,2)}function $ce(e){var t=e.getDay();return t>=4||t===0?t0(e):t0.ceil(e)}function jtt(e,t){return e=$ce(e),Pt(t0.count(Ru(e),e)+(Ru(e).getDay()===4),t,2)}function Utt(e){return e.getDay()}function Wtt(e,t){return Pt(xk.count(Ru(e)-1,e),t,2)}function Vtt(e,t){return Pt(e.getFullYear()%100,t,2)}function Gtt(e,t){return e=$ce(e),Pt(e.getFullYear()%100,t,2)}function Htt(e,t){return Pt(e.getFullYear()%1e4,t,4)}function qtt(e,t){var n=e.getDay();return e=n>=4||n===0?t0(e):t0.ceil(e),Pt(e.getFullYear()%1e4,t,4)}function Xtt(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Pt(t/60|0,"0",2)+Pt(t%60,"0",2)}function tq(e,t){return Pt(e.getUTCDate(),t,2)}function Ytt(e,t){return Pt(e.getUTCHours(),t,2)}function Ktt(e,t){return Pt(e.getUTCHours()%12||12,t,2)}function Ztt(e,t){return Pt(1+Kd.count(Pu(e),e),t,3)}function kce(e,t){return Pt(e.getUTCMilliseconds(),t,3)}function Jtt(e,t){return kce(e,t)+"000"}function Qtt(e,t){return Pt(e.getUTCMonth()+1,t,2)}function ent(e,t){return Pt(e.getUTCMinutes(),t,2)}function tnt(e,t){return Pt(e.getUTCSeconds(),t,2)}function nnt(e){var t=e.getUTCDay();return t===0?7:t}function rnt(e,t){return Pt(Zw.count(Pu(e)-1,e),t,2)}function Ece(e){var t=e.getUTCDay();return t>=4||t===0?n0(e):n0.ceil(e)}function int(e,t){return e=Ece(e),Pt(n0.count(Pu(e),e)+(Pu(e).getUTCDay()===4),t,2)}function snt(e){return e.getUTCDay()}function ont(e,t){return Pt(wk.count(Pu(e)-1,e),t,2)}function ant(e,t){return Pt(e.getUTCFullYear()%100,t,2)}function unt(e,t){return e=Ece(e),Pt(e.getUTCFullYear()%100,t,2)}function lnt(e,t){return Pt(e.getUTCFullYear()%1e4,t,4)}function cnt(e,t){var n=e.getUTCDay();return e=n>=4||n===0?n0(e):n0.ceil(e),Pt(e.getUTCFullYear()%1e4,t,4)}function fnt(){return"+0000"}function nq(){return"%"}function rq(e){return+e}function iq(e){return Math.floor(+e/1e3)}var qg,j6,Ace,U6,Tce;hnt({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function hnt(e){return qg=htt(e),j6=qg.format,Ace=qg.parse,U6=qg.utcFormat,Tce=qg.utcParse,qg}function Db(e){const t={};return n=>t[n]||(t[n]=e(n))}function dnt(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=pnt(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function pnt(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function gnt(e){const t=Db(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=xp(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return dnt(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=xp(o??",f");const a=bk(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=xce(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=wce(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=vce(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}mnt();function mnt(){return gnt({format:oI,formatPrefix:L6})}function sq(e,t,n){n=n||{},E6(n)||Hl(`Invalid time multi-format specifier: ${n}`);const r=t(yx),i=t(mx),s=t(gx),o=t(px),a=t(dx),u=t(hx),l=t(fx),c=t(cx),f=e(n[hI]||".%L"),h=e(n[yx]||":%S"),d=e(n[mx]||"%I:%M"),p=e(n[gx]||"%I %p"),m=e(n[px]||n[fI]||"%a %d"),g=e(n[dx]||"%b %d"),y=e(n[hx]||"%B"),b=e(n[fx]||"%B"),x=e(n[cx]||"%Y");return v=>(r(v)<v?f:i(v)<v?h:s(v)<v?d:o(v)<v?p:u(v)<v?a(v)<v?m:g:c(v)<v?l(v)<v?y:b:x)(v)}function ynt(e){const t=Db(e.format),n=Db(e.utcFormat);return{timeFormat:r=>hk(r)?t(r):sq(t,ctt,r),utcFormat:r=>hk(r)?n(r):sq(n,ftt,r),timeParse:Db(e.parse),utcParse:Db(e.utcParse)}}bnt();function bnt(){return ynt({format:j6,parse:Ace,utcFormat:U6,utcParse:Tce})}const vnt=/^(data:|([A-Za-z]+:)?\/\/)/,xnt=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,wnt=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,oq="file://";function Cnt(e,t){return n=>({options:n||{},sanitize:_nt,load:Snt,fileAccess:!!t,file:$nt(t),http:Ent(e)})}async function Snt(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function _nt(e,t){t=nI({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=xnt.test(e.replace(wnt,""));(e==null||typeof e!="string"||!a)&&Hl("Sanitize failure, invalid URI: "+Kle(e));const u=vnt.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith(oq))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice(oq.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function $nt(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):knt}async function knt(){Hl("No file system access.")}function Ent(e){return e?async function(t,n){const r=nI({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?tI(s[i])?s[i]():s.text():Hl(s.status+""+s.statusText)}:Ant}async function Ant(){Hl("No HTTP fetch method available.")}const Dce=Cnt(typeof fetch<"u"&&fetch,null);function Ku(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function $h(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const aq=Symbol("implicit");function W6(){var e=new ek,t=[],n=[],r=aq;function i(s){let o=e.get(s);if(o===void 0){if(r!==aq)return r;e.set(s,o=t.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new ek;for(const o of s)e.has(o)||e.set(o,t.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return W6(t,n).unknown(r)},Ku.apply(i,arguments),i}function ny(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Jw(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function kh(){}var wp=.7,r0=1/wp,_m="\\s*([+-]?\\d+)\\s*",bx="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Cu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Tnt=/^#([0-9a-f]{3,8})$/,Dnt=new RegExp("^rgb\\("+[_m,_m,_m]+"\\)$"),Int=new RegExp("^rgb\\("+[Cu,Cu,Cu]+"\\)$"),Fnt=new RegExp("^rgba\\("+[_m,_m,_m,bx]+"\\)$"),Ont=new RegExp("^rgba\\("+[Cu,Cu,Cu,bx]+"\\)$"),Nnt=new RegExp("^hsl\\("+[bx,Cu,Cu]+"\\)$"),Mnt=new RegExp("^hsla\\("+[bx,Cu,Cu,bx]+"\\)$"),uq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ny(kh,ic,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:lq,formatHex:lq,formatHsl:Rnt,formatRgb:cq,toString:cq});function lq(){return this.rgb().formatHex()}function Rnt(){return Ice(this).formatHsl()}function cq(){return this.rgb().formatRgb()}function ic(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Tnt.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?fq(t):n===3?new Vr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?LS(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?LS(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Dnt.exec(e))?new Vr(t[1],t[2],t[3],1):(t=Int.exec(e))?new Vr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Fnt.exec(e))?LS(t[1],t[2],t[3],t[4]):(t=Ont.exec(e))?LS(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Nnt.exec(e))?pq(t[1],t[2]/100,t[3]/100,1):(t=Mnt.exec(e))?pq(t[1],t[2]/100,t[3]/100,t[4]):uq.hasOwnProperty(e)?fq(uq[e]):e==="transparent"?new Vr(NaN,NaN,NaN,0):null}function fq(e){return new Vr(e>>16&255,e>>8&255,e&255,1)}function LS(e,t,n,r){return r<=0&&(e=t=n=NaN),new Vr(e,t,n,r)}function V6(e){return e instanceof kh||(e=ic(e)),e?(e=e.rgb(),new Vr(e.r,e.g,e.b,e.opacity)):new Vr}function As(e,t,n,r){return arguments.length===1?V6(e):new Vr(e,t,n,r??1)}function Vr(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}ny(Vr,As,Jw(kh,{brighter:function(e){return e=e==null?r0:Math.pow(r0,e),new Vr(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?wp:Math.pow(wp,e),new Vr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:hq,formatHex:hq,formatRgb:dq,toString:dq}));function hq(){return"#"+PN(this.r)+PN(this.g)+PN(this.b)}function dq(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function PN(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function pq(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new iu(e,t,n,r)}function Ice(e){if(e instanceof iu)return new iu(e.h,e.s,e.l,e.opacity);if(e instanceof kh||(e=ic(e)),!e)return new iu;if(e instanceof iu)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,a=s-i,u=(s+i)/2;return a?(t===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-t)/a+2:o=(t-n)/a+4,a/=u<.5?s+i:2-s-i,o*=60):a=u>0&&u<1?0:o,new iu(o,a,u,e.opacity)}function qf(e,t,n,r){return arguments.length===1?Ice(e):new iu(e,t,n,r??1)}function iu(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}ny(iu,qf,Jw(kh,{brighter:function(e){return e=e==null?r0:Math.pow(r0,e),new iu(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?wp:Math.pow(wp,e),new iu(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Vr(LN(e>=240?e-240:e+120,i,r),LN(e,i,r),LN(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function LN(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Fce=Math.PI/180,Oce=180/Math.PI,Ck=18,Nce=.96422,Mce=1,Rce=.82521,Pce=4/29,$m=6/29,Lce=3*$m*$m,Pnt=$m*$m*$m;function Bce(e){if(e instanceof Su)return new Su(e.l,e.a,e.b,e.opacity);if(e instanceof Ll)return zce(e);e instanceof Vr||(e=V6(e));var t=UN(e.r),n=UN(e.g),r=UN(e.b),i=BN((.2225045*t+.7168786*n+.0606169*r)/Mce),s,o;return t===n&&n===r?s=o=i:(s=BN((.4360747*t+.3850649*n+.1430804*r)/Nce),o=BN((.0139322*t+.0971045*n+.7141733*r)/Rce)),new Su(116*i-16,500*(s-i),200*(i-o),e.opacity)}function Xf(e,t,n,r){return arguments.length===1?Bce(e):new Su(e,t,n,r??1)}function Su(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}ny(Su,Xf,Jw(kh,{brighter:function(e){return new Su(this.l+Ck*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Su(this.l-Ck*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=Nce*zN(t),e=Mce*zN(e),n=Rce*zN(n),new Vr(jN(3.1338561*t-1.6168667*e-.4906146*n),jN(-.9787684*t+1.9161415*e+.033454*n),jN(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function BN(e){return e>Pnt?Math.pow(e,1/3):e/Lce+Pce}function zN(e){return e>$m?e*e*e:Lce*(e-Pce)}function jN(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function UN(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Lnt(e){if(e instanceof Ll)return new Ll(e.h,e.c,e.l,e.opacity);if(e instanceof Su||(e=Bce(e)),e.a===0&&e.b===0)return new Ll(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Oce;return new Ll(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Yf(e,t,n,r){return arguments.length===1?Lnt(e):new Ll(e,t,n,r??1)}function Ll(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function zce(e){if(isNaN(e.h))return new Su(e.l,0,0,e.opacity);var t=e.h*Fce;return new Su(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}ny(Ll,Yf,Jw(kh,{brighter:function(e){return new Ll(this.h,this.c,this.l+Ck*(e??1),this.opacity)},darker:function(e){return new Ll(this.h,this.c,this.l-Ck*(e??1),this.opacity)},rgb:function(){return zce(this).rgb()}}));var jce=-.14861,G6=1.78277,H6=-.29227,dI=-.90649,vx=1.97294,gq=vx*dI,mq=vx*G6,yq=G6*H6-dI*jce;function Bnt(e){if(e instanceof Zd)return new Zd(e.h,e.s,e.l,e.opacity);e instanceof Vr||(e=V6(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(yq*r+gq*t-mq*n)/(yq+gq-mq),s=r-i,o=(vx*(n-i)-H6*s)/dI,a=Math.sqrt(o*o+s*s)/(vx*i*(1-i)),u=a?Math.atan2(o,s)*Oce-120:NaN;return new Zd(u<0?u+360:u,a,i,e.opacity)}function Cp(e,t,n,r){return arguments.length===1?Bnt(e):new Zd(e,t,n,r??1)}function Zd(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}ny(Zd,Cp,Jw(kh,{brighter:function(e){return e=e==null?r0:Math.pow(r0,e),new Zd(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?wp:Math.pow(wp,e),new Zd(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Fce,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Vr(255*(t+n*(jce*r+G6*i)),255*(t+n*(H6*r+dI*i)),255*(t+n*(vx*r)),this.opacity)}}));function Uce(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function Wce(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return Uce((n-r/t)*t,o,i,s,a)}}function Vce(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return Uce((n-r/t)*t,i,s,o,a)}}const pI=e=>()=>e;function Gce(e,t){return function(n){return e+n*t}}function znt(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function gI(e,t){var n=t-e;return n?Gce(e,n>180||n<-180?n-360*Math.round(n/360):n):pI(isNaN(e)?t:e)}function jnt(e){return(e=+e)==1?_r:function(t,n){return n-t?znt(t,n,e):pI(isNaN(t)?n:t)}}function _r(e,t){var n=t-e;return n?Gce(e,n):pI(isNaN(e)?t:e)}const BR=function e(t){var n=jnt(t);function r(i,s){var o=n((i=As(i)).r,(s=As(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=_r(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function Hce(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=As(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var Unt=Hce(Wce),Wnt=Hce(Vce);function q6(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function qce(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Vnt(e,t){return(qce(t)?q6:Xce)(e,t)}function Xce(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=mg(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function Yce(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function ua(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Kce(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=mg(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var zR=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,WN=new RegExp(zR.source,"g");function Gnt(e){return function(){return e}}function Hnt(e){return function(t){return e(t)+""}}function Zce(e,t){var n=zR.lastIndex=WN.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=zR.exec(e))&&(i=WN.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:ua(r,i)})),n=WN.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?Hnt(u[0].x):Gnt(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function mg(e,t){var n=typeof t,r;return t==null||n==="boolean"?pI(t):(n==="number"?ua:n==="string"?(r=ic(t))?(t=r,BR):Zce:t instanceof ic?BR:t instanceof Date?Yce:qce(t)?q6:Array.isArray(t)?Xce:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Kce:ua)(e,t)}function qnt(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function Xnt(e,t){var n=gI(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function mI(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var bq=180/Math.PI,jR={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Jce(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*bq,skewX:Math.atan(u)*bq,scaleX:o,scaleY:a}}var BS;function Ynt(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?jR:Jce(t.a,t.b,t.c,t.d,t.e,t.f)}function Knt(e){return e==null||(BS||(BS=document.createElementNS("http://www.w3.org/2000/svg","g")),BS.setAttribute("transform",e),!(e=BS.transform.baseVal.consolidate()))?jR:(e=e.matrix,Jce(e.a,e.b,e.c,e.d,e.e,e.f))}function Qce(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var m=d.push("translate(",null,t,null,n);p.push({i:m-4,x:ua(l,f)},{i:m-2,x:ua(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:ua(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:ua(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var m=d.push(i(d)+"scale(",null,",",null,")");p.push({i:m-4,x:ua(l,f)},{i:m-2,x:ua(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,m=h.length,g;++p<m;)f[(g=h[p]).i]=g.x(d);return f.join("")}}}var Znt=Qce(Ynt,"px, ","px)","deg)"),Jnt=Qce(Knt,", ",")",")"),Qnt=1e-12;function vq(e){return((e=Math.exp(e))+1/e)/2}function ert(e){return((e=Math.exp(e))-1/e)/2}function trt(e){return((e=Math.exp(2*e))-1)/(e+1)}const nrt=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,m=d*d+p*p,g,y;if(m<Qnt)y=Math.log(h/l)/t,g=function(S){return[a+S*d,u+S*p,l*Math.exp(t*S*y)]};else{var b=Math.sqrt(m),x=(h*h-l*l+r*m)/(2*l*n*b),v=(h*h-l*l-r*m)/(2*h*n*b),w=Math.log(Math.sqrt(x*x+1)-x),C=Math.log(Math.sqrt(v*v+1)-v);y=(C-w)/t,g=function(S){var _=S*y,$=vq(w),k=l/(n*b)*($*trt(t*_+w)-ert(w));return[a+k*d,u+k*p,l*$/vq(t*_+w)]}}return g.duration=y*1e3*t/Math.SQRT2,g}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function efe(e){return function(t,n){var r=e((t=qf(t)).h,(n=qf(n)).h),i=_r(t.s,n.s),s=_r(t.l,n.l),o=_r(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const rrt=efe(gI);var irt=efe(_r);function srt(e,t){var n=_r((e=Xf(e)).l,(t=Xf(t)).l),r=_r(e.a,t.a),i=_r(e.b,t.b),s=_r(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function tfe(e){return function(t,n){var r=e((t=Yf(t)).h,(n=Yf(n)).h),i=_r(t.c,n.c),s=_r(t.l,n.l),o=_r(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const ort=tfe(gI);var art=tfe(_r);function nfe(e){return function t(n){n=+n;function r(i,s){var o=e((i=Cp(i)).h,(s=Cp(s)).h),a=_r(i.s,s.s),u=_r(i.l,s.l),l=_r(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const urt=nfe(gI);var lrt=nfe(_r);function X6(e,t){t===void 0&&(t=e,e=mg);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function crt(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const frt=Object.freeze(Object.defineProperty({__proto__:null,interpolate:mg,interpolateArray:Vnt,interpolateBasis:Wce,interpolateBasisClosed:Vce,interpolateCubehelix:urt,interpolateCubehelixLong:lrt,interpolateDate:Yce,interpolateDiscrete:qnt,interpolateHcl:ort,interpolateHclLong:art,interpolateHsl:rrt,interpolateHslLong:irt,interpolateHue:Xnt,interpolateLab:srt,interpolateNumber:ua,interpolateNumberArray:q6,interpolateObject:Kce,interpolateRgb:BR,interpolateRgbBasis:Unt,interpolateRgbBasisClosed:Wnt,interpolateRound:mI,interpolateString:Zce,interpolateTransformCss:Znt,interpolateTransformSvg:Jnt,interpolateZoom:nrt,piecewise:X6,quantize:crt},Symbol.toStringTag,{value:"Module"}));function hrt(e){return function(){return e}}function UR(e){return+e}var xq=[0,1];function bs(e){return e}function WR(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:hrt(isNaN(t)?NaN:.5)}function drt(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function prt(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=WR(i,r),s=n(o,s)):(r=WR(r,i),s=n(s,o)),function(a){return s(r(a))}}function grt(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=WR(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=Yw(e,a,1,r)-1;return s[u](i[u](a))}}function Qw(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yI(){var e=xq,t=xq,n=mg,r,i,s,o=bs,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==bs&&(o=drt(e[0],e[h-1])),a=h>2?grt:prt,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),ua)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,UR),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=mI,c()},f.clamp=function(h){return arguments.length?(o=h?!0:bs,c()):o!==bs},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function rfe(){return yI()(bs,bs)}function ife(e,t,n,r){var i=bk(e,t,n),s;switch(r=xp(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=xce(i,o))&&(r.precision=s),L6(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=wce(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=vce(i))&&(r.precision=s-(r.type==="%")*2);break}}return oI(r)}function yg(e){var t=e.domain;return e.ticks=function(n){var r=t();return PR(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return ife(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=LR(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function sfe(){var e=rfe();return e.copy=function(){return Qw(e,sfe())},Ku.apply(e,arguments),yg(e)}function ofe(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,UR),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return ofe(e).unknown(t)},e=arguments.length?Array.from(e,UR):[0,1],yg(n)}function afe(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function wq(e){return Math.log(e)}function Cq(e){return Math.exp(e)}function mrt(e){return-Math.log(-e)}function yrt(e){return-Math.exp(-e)}function brt(e){return isFinite(e)?+("1e"+e):e<0?0:e}function vrt(e){return e===10?brt:e===Math.E?Math.exp:t=>Math.pow(e,t)}function xrt(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function Sq(e){return(t,n)=>-e(-t,n)}function Y6(e){const t=e(wq,Cq),n=t.domain;let r=10,i,s;function o(){return i=xrt(r),s=vrt(r),n()[0]<0?(i=Sq(i),s=Sq(s),e(mrt,yrt)):e(wq,Cq),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=a=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let h=i(l),d=i(c),p,m;const g=a==null?10:+a;let y=[];if(!(r%1)&&d-h<g){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(p=1;p<r;++p)if(m=h<0?p/s(-h):p*s(h),!(m<l)){if(m>c)break;y.push(m)}}else for(;h<=d;++h)for(p=r-1;p>=1;--p)if(m=h>0?p/s(-h):p*s(h),!(m<l)){if(m>c)break;y.push(m)}y.length*2<g&&(y=PR(l,c,g))}else y=PR(h,d,Math.min(d-h,g)).map(s);return f?y.reverse():y},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=r===10?"s":","),typeof u!="function"&&(!(r%1)&&(u=xp(u)).precision==null&&(u.trim=!0),u=oI(u)),a===1/0)return u;const l=Math.max(1,r*a/t.ticks().length);return c=>{let f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=()=>n(afe(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),t}function ufe(){const e=Y6(yI()).domain([1,10]);return e.copy=()=>Qw(e,ufe()).base(e.base()),Ku.apply(e,arguments),e}function _q(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function $q(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function K6(e){var t=1,n=e(_q(t),$q(t));return n.constant=function(r){return arguments.length?e(_q(t=+r),$q(t)):t},yg(n)}function lfe(){var e=K6(yI());return e.copy=function(){return Qw(e,lfe()).constant(e.constant())},Ku.apply(e,arguments)}function kq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function wrt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Crt(e){return e<0?-e*e:e*e}function Z6(e){var t=e(bs,bs),n=1;function r(){return n===1?e(bs,bs):n===.5?e(wrt,Crt):e(kq(n),kq(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},yg(t)}function J6(){var e=Z6(yI());return e.copy=function(){return Qw(e,J6()).exponent(e.exponent())},Ku.apply(e,arguments),e}function Srt(){return J6.apply(null,arguments).exponent(.5)}function cfe(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=Bet(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[Yw(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Zb),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return cfe().domain(e).range(t).unknown(r)},Ku.apply(s,arguments)}function ffe(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[Yw(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return ffe().domain([e,t]).range(i).unknown(s)},Ku.apply(yg(o),arguments)}function hfe(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[Yw(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return hfe().domain(e).range(t).unknown(n)},Ku.apply(i,arguments)}function _rt(e){return new Date(e)}function $rt(e){return e instanceof Date?+e:+new Date(+e)}function Q6(e,t,n,r,i,s,o,a,u,l){var c=rfe(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),m=l("%I:%M"),g=l("%I %p"),y=l("%a %d"),b=l("%b %d"),x=l("%B"),v=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?m:s(C)<C?g:r(C)<C?i(C)<C?y:b:n(C)<C?x:v)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,$rt)):h().map(_rt)},c.ticks=function(C){var S=h();return e(S[0],S[S.length-1],C??10)},c.tickFormat=function(C,S){return S==null?w:l(S)},c.nice=function(C){var S=h();return(!C||typeof C.range!="function")&&(C=t(S[0],S[S.length-1],C??10)),C?h(afe(S,C)):c},c.copy=function(){return Qw(c,Q6(e,t,n,r,i,s,o,a,u,l))},c}function krt(){return Ku.apply(Q6(stt,ott,Ru,ux,Kw,vf,lI,aI,Pl,j6).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Ert(){return Ku.apply(Q6(rtt,itt,Pu,lx,Zw,Kd,cI,uI,Pl,U6).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function bI(){var e=0,t=1,n,r,i,s,o=bs,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(mg),l.rangeRound=c(mI),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Eh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function e8(){var e=yg(bI()(bs));return e.copy=function(){return Eh(e,e8())},$h.apply(e,arguments)}function dfe(){var e=Y6(bI()).domain([1,10]);return e.copy=function(){return Eh(e,dfe()).base(e.base())},$h.apply(e,arguments)}function pfe(){var e=K6(bI());return e.copy=function(){return Eh(e,pfe()).constant(e.constant())},$h.apply(e,arguments)}function t8(){var e=Z6(bI());return e.copy=function(){return Eh(e,t8()).exponent(e.exponent())},$h.apply(e,arguments)}function Art(){return t8.apply(null,arguments).exponent(.5)}function vI(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=bs,c,f=!1,h;function d(m){return isNaN(m=+m)?h:(m=.5+((m=+c(m))-s)*(r*m<r*s?a:u),l(f?Math.max(0,Math.min(1,m)):m))}d.domain=function(m){return arguments.length?([e,t,n]=m,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(m){return arguments.length?(f=!!m,d):f},d.interpolator=function(m){return arguments.length?(l=m,d):l};function p(m){return function(g){var y,b,x;return arguments.length?([y,b,x]=g,l=X6(m,[y,b,x]),d):[l(0),l(.5),l(1)]}}return d.range=p(mg),d.rangeRound=p(mI),d.unknown=function(m){return arguments.length?(h=m,d):h},function(m){return c=m,i=m(e),s=m(t),o=m(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function gfe(){var e=yg(vI()(bs));return e.copy=function(){return Eh(e,gfe())},$h.apply(e,arguments)}function mfe(){var e=Y6(vI()).domain([.1,1,10]);return e.copy=function(){return Eh(e,mfe()).base(e.base())},$h.apply(e,arguments)}function yfe(){var e=K6(vI());return e.copy=function(){return Eh(e,yfe()).constant(e.constant())},$h.apply(e,arguments)}function n8(){var e=Z6(vI());return e.copy=function(){return Eh(e,n8()).exponent(e.exponent())},$h.apply(e,arguments)}function Trt(){return n8.apply(null,arguments).exponent(.5)}function Drt(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const Irt="identity",r8="linear",Kf="log",i8="pow",s8="sqrt",o8="symlog",xx="time",wx="utc",ry="sequential",eC="diverging",Sk="quantile",a8="quantize",bfe="threshold",Frt="ordinal",Ort="point",Nrt="band",Mrt="bin-ordinal",jr="continuous",tC="discrete",nC="discretizing",Pa="interpolating",u8="temporal";function Rrt(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function Prt(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function l8(){const e=W6().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=Drt(f,a,u);let m=r[h-0];i=(d-m)/(p||1),o&&(i=Math.floor(i)),m+=(d-m-i*(f-a))*l,s=i*(1-a),o&&(m=Math.round(m),s=Math.round(s));const g=zet(f).map(y=>m+i*y);return n(h?g.reverse():g)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let m=+f[0],g=+f[1],y,b,x;if(!(m!==m||g!==g)&&(g<m&&(x=m,m=g,g=x),!(g<d[0]||m>r[1-h])))return y=Math.max(0,RR(d,m)-1),b=m===g?y:RR(d,g)-1,m-d[y]>s+1e-10&&++y,h&&(x=y,y=p-b,b=p-x),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return l8().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function vfe(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return vfe(t())},e}function Lrt(){return vfe(l8().paddingInner(1))}var Brt=Array.prototype.map;function zrt(e){return Brt.call(e,ZQe)}const jrt=Array.prototype.slice;function xfe(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(Yw(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=zrt(r),n):e.slice()},n.range=function(r){return arguments.length?(t=jrt.call(r),n):t.slice()},n.tickFormat=function(r,i){return ife(e[0],wu(e),r??10,i)},n.copy=function(){return xfe().domain(n.domain()).range(n.range())},n}const _k=new Map,Urt=Symbol("vega_scale");function Wrt(e){return e[Urt]=!0,e}function Vrt(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?Rrt(s):s.invertExtent?Prt(s):void 0),s.type=e,Wrt(s)};return r.metadata=Zle(A6(n)),r}function gn(e,t,n){return arguments.length>1?(_k.set(e,Vrt(e,t,n)),this):Grt(e)?_k.get(e):void 0}gn(Irt,ofe);gn(r8,sfe,jr);gn(Kf,ufe,[jr,Kf]);gn(i8,J6,jr);gn(s8,Srt,jr);gn(o8,lfe,jr);gn(xx,krt,[jr,u8]);gn(wx,Ert,[jr,u8]);gn(ry,e8,[jr,Pa]);gn(`${ry}-${r8}`,e8,[jr,Pa]);gn(`${ry}-${Kf}`,dfe,[jr,Pa,Kf]);gn(`${ry}-${i8}`,t8,[jr,Pa]);gn(`${ry}-${s8}`,Art,[jr,Pa]);gn(`${ry}-${o8}`,pfe,[jr,Pa]);gn(`${eC}-${r8}`,gfe,[jr,Pa]);gn(`${eC}-${Kf}`,mfe,[jr,Pa,Kf]);gn(`${eC}-${i8}`,n8,[jr,Pa]);gn(`${eC}-${s8}`,Trt,[jr,Pa]);gn(`${eC}-${o8}`,yfe,[jr,Pa]);gn(Sk,cfe,[nC,Sk]);gn(a8,ffe,nC);gn(bfe,hfe,nC);gn(Mrt,xfe,[tC,nC]);gn(Frt,W6,tC);gn(Nrt,l8,tC);gn(Ort,Lrt,tC);function Grt(e){return _k.has(e)}function xI(e,t){const n=_k.get(e);return n&&n.metadata[t]}function wfe(e){return xI(e,tC)}function Hrt(e){return xI(e,nC)}function qrt(e){return xI(e,Kf)}function Xrt(e){return xI(e,u8)}function Yrt(e,t,n){return X6(Krt(t||"rgb",n),e)}function Krt(e,t){const n=frt[Zrt(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function Zrt(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const Jrt={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},Qrt={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function Cfe(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function Sfe(e,t){for(const n in e)eit(n,t(e[n]))}const Eq={};Sfe(Qrt,Cfe);Sfe(Jrt,e=>Yrt(Cfe(e)));function eit(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(Eq[e]=t,this):Eq[e]}const tit="symbol",nit="discrete",rit=e=>Yu(e)?e.map(t=>String(t)):String(e),iit=(e,t)=>e[1]-t[1],sit=(e,t)=>t[1]-e[1];function oit(e,t,n){let r=e.range(),i=r[0],s=wu(r),o=iit;if(i>s&&(r=s,s=i,i=r,o=sit),i=Math.floor(i),s=Math.ceil(s),t=t.map(a=>[a,e(a)]).filter(a=>i<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],wu(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function _fe(e,t){return e.bins?oit(e,e.bins):e.ticks?e.ticks(t):e.domain()}function ait(e,t,n,r,i,s){const o=t.type;let a=rit;if(o===xx||i===xx)a=e.timeFormat(r);else if(o===wx||i===wx)a=e.utcFormat(r);else if(qrt(o)){const u=e.formatFloat(r);if(s||t.bins)a=u;else{const l=$fe(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,r)}else r&&(a=e.format(r));return a}function $fe(e,t,n){const r=_fe(e,t),i=e.base(),s=Math.log(i),o=Math.max(1,i*t/r.length),a=u=>{let l=u/Math.pow(i,Math.round(Math.log(u)/s));return l*i<i-.5&&(l*=i),l<=o};return n?r.filter(a):a}const VR={[Sk]:"quantiles",[a8]:"thresholds",[bfe]:"domain"},kfe={[Sk]:"quantiles",[a8]:"domain"};function uit(e,t){return e.bins?fit(e.bins):e.type===Kf?$fe(e,t,!0):VR[e.type]?cit(e[VR[e.type]]()):_fe(e,t)}function lit(e,t,n){const r=t[kfe[t.type]](),i=r.length;let s=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o)s=Math.min(s,r[o]-r[o-1]);return e.formatSpan(0,s,3*10,n)}function cit(e){const t=[-1/0].concat(e);return t.max=1/0,t}function fit(e){const t=e.slice(0,-1);return t.max=wu(e),t}const hit=e=>VR[e.type]||e.bins;function dit(e,t,n,r,i,s,o){const a=kfe[t.type]&&s!==xx&&s!==wx?lit(e,t,i):ait(e,t,n,i,s,o);return r===tit&&hit(t)?pit(a):r===nit?git(a):mit(a)}const pit=e=>(t,n,r)=>{const i=Aq(r[n+1],Aq(r.max,1/0)),s=Tq(t,e),o=Tq(i,e);return s&&o?s+"  "+o:o?"< "+o:" "+s},Aq=(e,t)=>e??t,git=e=>(t,n)=>n?e(t):null,mit=e=>t=>e(t),Tq=(e,t)=>Number.isFinite(e)?t(e):null;function yit(e,t,n,r){const i=r||t.type;return hk(n)&&Xrt(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&i===xx?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===wx?e.utcFormat("%A, %d %B %Y, %X UTC"):dit(e,t,5,null,n,r,!0)}function Efe(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=yit(e,t,n.format,n.formatType);if(Hrt(t.type)){const s=uit(t).slice(1).map(i),o=s.length;return`${o} boundar${o===1?"y":"ies"}: ${s.join(", ")}`}else if(wfe(t.type)){const s=t.domain(),o=s.length,a=o>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return`${o} value${o===1?"":"s"}: ${a}`}else{const s=t.domain();return`values from ${i(s[0])} to ${i(wu(s))}`}}let bit=0;const $k="p_";function c8(e){return e&&e.gradient}function Afe(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?$k:"";return i||(i=e.id="gradient_"+bit++,r==="radial"?(e.x1=Xa(e.x1,.5),e.y1=Xa(e.y1,.5),e.r1=Xa(e.r1,0),e.x2=Xa(e.x2,.5),e.y2=Xa(e.y2,.5),e.r2=Xa(e.r2,.5),s=$k):(e.x1=Xa(e.x1,0),e.y1=Xa(e.y1,0),e.x2=Xa(e.x2,1),e.y2=Xa(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function Xa(e,t){return e??t}const Dq={basis:{curve:get},"basis-closed":{curve:met},"basis-open":{curve:yet},bundle:{curve:bet,tension:"beta",value:.85},cardinal:{curve:vet,tension:"tension",value:0},"cardinal-open":{curve:wet,tension:"tension",value:0},"cardinal-closed":{curve:xet,tension:"tension",value:0},"catmull-rom":{curve:Cet,tension:"alpha",value:.5},"catmull-rom-closed":{curve:_et,tension:"alpha",value:.5},"catmull-rom-open":{curve:$et,tension:"alpha",value:.5},linear:{curve:I6},"linear-closed":{curve:ket},monotone:{horizontal:Aet,vertical:Eet},natural:{curve:Tet},step:{curve:Det},"step-after":{curve:Fet},"step-before":{curve:Iet}};function Tfe(e,t,n){var r=Il(Dq,e)&&Dq[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const vit={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},xit=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,wit=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,Cit=/^((\s+,?\s*)|(,\s*))/,Sit=/^[01]/;function Dfe(e){const t=[];return(e.match(xit)||[]).forEach(r=>{let i=r[0];const s=i.toLowerCase(),o=vit[s],a=_it(s,o,r.slice(1).trim()),u=a.length;if(u<o||u&&u%o!==0)throw Error("Invalid SVG path, incorrect parameter count");if(t.push([i,...a.slice(0,o)]),u!==o){s==="m"&&(i=i==="M"?"L":"l");for(let l=o;l<u;l+=o)t.push([i,...a.slice(l,l+o)])}}),t}function _it(e,t,n){const r=[];for(let i=0;t&&i<n.length;)for(let s=0;s<t;++s){const o=e==="a"&&(s===3||s===4)?Sit:wit,a=n.slice(i).match(o);if(a===null)throw Error("Invalid SVG path, incorrect parameter type");i+=a[0].length,r.push(+a[0]);const u=n.slice(i).match(Cit);u!==null&&(i+=u[0].length)}return r}const Zf=Math.PI/180,$it=1e-14,Cd=Math.PI/2,su=Math.PI*2,Xg=Math.sqrt(3)/2;var VN={},GN={},Ife=[].join;function kit(e,t,n,r,i,s,o,a,u){const l=Ife.call(arguments);if(VN[l])return VN[l];const c=o*Zf,f=Math.sin(c),h=Math.cos(c);n=Math.abs(n),r=Math.abs(r);const d=h*(a-e)*.5+f*(u-t)*.5,p=h*(u-t)*.5-f*(a-e)*.5;let m=d*d/(n*n)+p*p/(r*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=h/n,y=f/n,b=-f/r,x=h/r,v=g*a+y*u,w=b*a+x*u,C=g*e+y*t,S=b*e+x*t;let $=1/((C-v)*(C-v)+(S-w)*(S-w))-.25;$<0&&($=0);let k=Math.sqrt($);s==i&&(k=-k);const E=.5*(v+C)-k*(S-w),F=.5*(w+S)+k*(C-v),T=Math.atan2(w-F,v-E);let D=Math.atan2(S-F,C-E)-T;D<0&&s===1?D+=su:D>0&&s===0&&(D-=su);const N=Math.ceil(Math.abs(D/(Cd+.001))),V=[];for(let U=0;U<N;++U){const A=T+U*D/N,M=T+(U+1)*D/N;V[U]=[E,F,A,M,n,r,f,h]}return VN[l]=V}function Eit(e){const t=Ife.call(e);if(GN[t])return GN[t];var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7];const c=l*o,f=-u*a,h=u*o,d=l*a,p=Math.cos(i),m=Math.sin(i),g=Math.cos(s),y=Math.sin(s),b=.5*(s-i),x=Math.sin(b*.5),v=8/3*x*x/Math.sin(b),w=n+p-v*m,C=r+m+v*p,S=n+g,_=r+y,$=S+v*y,k=_-v*g;return GN[t]=[c*w+f*C,h*w+d*C,c*$+f*k,h*$+d*k,c*S+f*_,h*S+d*_]}const co=["l",0,0,0,0,0,0,0];function Ait(e,t,n){const r=co[0]=e[0];if(r==="a"||r==="A")co[1]=t*e[1],co[2]=n*e[2],co[3]=e[3],co[4]=e[4],co[5]=e[5],co[6]=t*e[6],co[7]=n*e[7];else if(r==="h"||r==="H")co[1]=t*e[1];else if(r==="v"||r==="V")co[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)co[i]=(i%2==1?t:n)*e[i];return co}function GR(e,t,n,r,i,s){var o,a=null,u=0,l=0,c=0,f=0,h,d,p,m,g=0,y=0;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var b=0,x=t.length;b<x;++b){switch(o=t[b],(i!==1||s!==1)&&(o=Ait(o,i,s)),o[0]){case"l":u+=o[1],l+=o[2],e.lineTo(u+n,l+r);break;case"L":u=o[1],l=o[2],e.lineTo(u+n,l+r);break;case"h":u+=o[1],e.lineTo(u+n,l+r);break;case"H":u=o[1],e.lineTo(u+n,l+r);break;case"v":l+=o[1],e.lineTo(u+n,l+r);break;case"V":l=o[1],e.lineTo(u+n,l+r);break;case"m":u+=o[1],l+=o[2],g=u,y=l,e.moveTo(u+n,l+r);break;case"M":u=o[1],l=o[2],g=u,y=l,e.moveTo(u+n,l+r);break;case"c":h=u+o[5],d=l+o[6],c=u+o[3],f=l+o[4],e.bezierCurveTo(u+o[1]+n,l+o[2]+r,c+n,f+r,h+n,d+r),u=h,l=d;break;case"C":u=o[5],l=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,c+n,f+r,u+n,l+r);break;case"s":h=u+o[3],d=l+o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,u+o[1]+n,l+o[2]+r,h+n,d+r),c=u+o[1],f=l+o[2],u=h,l=d;break;case"S":h=o[3],d=o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"q":h=u+o[3],d=l+o[4],c=u+o[1],f=l+o[2],e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"Q":h=o[3],d=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"t":h=u+o[1],d=l+o[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-p,f=2*l-m):a[0]==="q"&&(c=2*u-c,f=2*l-f),p=c,m=f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d,c=u+o[1],f=l+o[2];break;case"T":h=o[1],d=o[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"a":Iq(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+l+r]),u+=o[6],l+=o[7];break;case"A":Iq(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),u=o[6],l=o[7];break;case"z":case"Z":u=g,l=y,e.closePath();break}a=o}}function Iq(e,t,n,r){const i=kit(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const o=Eit(i[s]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const Fq=.5773502691896257,Oq={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,su)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xg*n,i=r-n*Fq,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xg*n,i=r-n*Fq;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xg*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xg*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xg*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Xg*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Tit(e){return Il(Oq,e)?Oq[e]:Dit(e)}var HN={};function Dit(e){if(!Il(HN,e)){const t=Dfe(e);HN[e]={draw:function(n,r){GR(n,t,0,0,Math.sqrt(r)/2)}}}return HN[e]}const Ic=.448084975506;function Iit(e){return e.x}function Fit(e){return e.y}function Oit(e){return e.width}function Nit(e){return e.height}function yl(e){return typeof e=="function"?e:()=>+e}function zS(e,t,n){return Math.max(t,Math.min(e,n))}function Mit(){var e=Iit,t=Fit,n=Oit,r=Nit,i=yl(0),s=i,o=i,a=i,u=null;function l(c,f,h){var d,p=f??+e.call(this,c),m=h??+t.call(this,c),g=+n.call(this,c),y=+r.call(this,c),b=Math.min(g,y)/2,x=zS(+i.call(this,c),0,b),v=zS(+s.call(this,c),0,b),w=zS(+o.call(this,c),0,b),C=zS(+a.call(this,c),0,b);if(u||(u=d=D6()),x<=0&&v<=0&&w<=0&&C<=0)u.rect(p,m,g,y);else{var S=p+g,_=m+y;u.moveTo(p+x,m),u.lineTo(S-v,m),u.bezierCurveTo(S-Ic*v,m,S,m+Ic*v,S,m+v),u.lineTo(S,_-C),u.bezierCurveTo(S,_-Ic*C,S-Ic*C,_,S-C,_),u.lineTo(p+w,_),u.bezierCurveTo(p+Ic*w,_,p,_-Ic*w,p,_-w),u.lineTo(p,m+x),u.bezierCurveTo(p,m+Ic*x,p+Ic*x,m,p+x,m),u.closePath()}if(d)return u=null,d+""||null}return l.x=function(c){return arguments.length?(e=yl(c),l):e},l.y=function(c){return arguments.length?(t=yl(c),l):t},l.width=function(c){return arguments.length?(n=yl(c),l):n},l.height=function(c){return arguments.length?(r=yl(c),l):r},l.cornerRadius=function(c,f,h,d){return arguments.length?(i=yl(c),s=f!=null?yl(f):i,a=h!=null?yl(h):i,o=d!=null?yl(d):s,l):i},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function Rit(){var e,t,n,r,i=null,s,o,a,u;function l(f,h,d){const p=d/2;if(s){var m=a-h,g=f-o;if(m||g){var y=Math.sqrt(m*m+g*g),b=(m/=y)*u,x=(g/=y)*u,v=Math.atan2(g,m);i.moveTo(o-b,a-x),i.lineTo(f-m*p,h-g*p),i.arc(f,h,p,v-Math.PI,v),i.lineTo(o+b,a+x),i.arc(o,a,u,v,v+Math.PI)}else i.arc(f,h,p,0,su);i.closePath()}else s=1;o=f,a=h,u=p}function c(f){var h,d=f.length,p,m=!1,g;for(i==null&&(i=g=D6()),h=0;h<=d;++h)!(h<d&&r(p=f[h],h,f))===m&&(m=!m)&&(s=0),m&&l(+e(p,h,f),+t(p,h,f),+n(p,h,f));if(g)return i=null,g+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(r=f,c):r},c.context=function(f){return arguments.length?(f==null?i=null:i=f,c):i},c}function rC(e,t){return e??t}const iC=e=>e.x||0,sC=e=>e.y||0,Pit=e=>e.width||0,Lit=e=>e.height||0,Bit=e=>(e.x||0)+(e.width||0),zit=e=>(e.y||0)+(e.height||0),jit=e=>e.startAngle||0,Uit=e=>e.endAngle||0,Wit=e=>e.padAngle||0,Vit=e=>e.innerRadius||0,Git=e=>e.outerRadius||0,Hit=e=>e.cornerRadius||0,qit=e=>rC(e.cornerRadiusTopLeft,e.cornerRadius)||0,Xit=e=>rC(e.cornerRadiusTopRight,e.cornerRadius)||0,Yit=e=>rC(e.cornerRadiusBottomRight,e.cornerRadius)||0,Kit=e=>rC(e.cornerRadiusBottomLeft,e.cornerRadius)||0,Zit=e=>rC(e.size,64),Jit=e=>e.size||1,wI=e=>e.defined!==!1,Qit=e=>Tit(e.shape||"circle"),est=het().startAngle(jit).endAngle(Uit).padAngle(Wit).innerRadius(Vit).outerRadius(Git).cornerRadius(Hit),tst=sce().x(iC).y1(sC).y0(zit).defined(wI),nst=sce().y(sC).x1(iC).x0(Bit).defined(wI),rst=ice().x(iC).y(sC).defined(wI),ist=Mit().x(iC).y(sC).width(Pit).height(Lit).cornerRadius(qit,Xit,Yit,Kit),sst=pet().type(Qit).size(Zit),ost=Rit().x(iC).y(sC).defined(wI).size(Jit);function f8(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function ast(e,t){return est.context(e)(t)}function ust(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?nst:tst).curve(Tfe(r,n.orient,n.tension)).context(e)(t)}function lst(e,t){const n=t[0],r=n.interpolate||"linear";return rst.curve(Tfe(r,n.orient,n.tension)).context(e)(t)}function iy(e,t,n,r){return ist.context(e)(t,n,r)}function cst(e,t){return(t.mark.shape||t.shape).context(e)(t)}function fst(e,t){return sst.context(e)(t)}function hst(e,t){return ost.context(e)(t)}var dst=1;function h8(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+dst++),o=i.clipping[s]||(i.clipping[s]={id:s});return tI(r)?o.path=r(null):f8(n)?o.path=iy(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function no(e){this.clear(),e&&this.union(e)}no.prototype={clone(){return new no(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:o}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*r-u*i+l,u*r+a*i+c,a*r-u*o+l,u*r+a*o+c,a*s-u*i+l,u*s+a*i+c,a*s-u*o+l,u*s+a*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function d8(e){this.mark=e,this.bounds=this.bounds||new no}function Ffe(e){d8.call(this,e),this.items=this.items||[]}Go(Ffe,d8);function Ofe(e){this._pending=0,this._loader=e||Dce()}function Nq(e){e._pending+=1}function Hy(e){e._pending-=1}Ofe.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return Nq(t),t._loader.sanitize(e,{context:"href"}).then(n=>(Hy(t),n)).catch(()=>(Hy(t),null))},loadImage(e){const t=this,n=mce();return Nq(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,o=Il(r,"crossOrigin")?r.crossOrigin:"anonymous";return o!=null&&(s.crossOrigin=o),s.onload=()=>Hy(t),s.onerror=()=>Hy(t),s.src=i,s}).catch(r=>(Hy(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}n(!1)})}};function Ah(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?pst(t,r):0))}return e}function pst(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const gst=su-1e-8;let CI,R_,P_,Md,HR,L_,qR,XR;const Zc=(e,t)=>CI.add(e,t),B_=(e,t)=>Zc(R_=e,P_=t),Mq=e=>Zc(e,CI.y1),Rq=e=>Zc(CI.x1,e),Sd=(e,t)=>HR*e+qR*t,_d=(e,t)=>L_*e+XR*t,qN=(e,t)=>Zc(Sd(e,t),_d(e,t)),XN=(e,t)=>B_(Sd(e,t),_d(e,t));function SI(e,t){return CI=e,t?(Md=t*Zf,HR=XR=Math.cos(Md),L_=Math.sin(Md),qR=-L_):(HR=XR=1,Md=L_=qR=0),mst}const mst={beginPath(){},closePath(){},moveTo:XN,lineTo:XN,rect(e,t,n,r){Md?(qN(e+n,t),qN(e+n,t+r),qN(e,t+r),XN(e,t)):(Zc(e+n,t+r),B_(e,t))},quadraticCurveTo(e,t,n,r){const i=Sd(e,t),s=_d(e,t),o=Sd(n,r),a=_d(n,r);Pq(R_,i,o,Mq),Pq(P_,s,a,Rq),B_(o,a)},bezierCurveTo(e,t,n,r,i,s){const o=Sd(e,t),a=_d(e,t),u=Sd(n,r),l=_d(n,r),c=Sd(i,s),f=_d(i,s);Lq(R_,o,u,c,Mq),Lq(P_,a,l,f,Rq),B_(c,f)},arc(e,t,n,r,i,s){if(r+=Md,i+=Md,R_=n*Math.cos(i)+e,P_=n*Math.sin(i)+t,Math.abs(i-r)>gst)Zc(e-n,t-n),Zc(e+n,t+n);else{const o=l=>Zc(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(o(r),o(i),i!==r)if(r=r%su,r<0&&(r+=su),i=i%su,i<0&&(i+=su),i<r&&(s=!s,a=r,r=i,i=a),s)for(i-=su,a=r-r%Cd,u=0;u<4&&a>i;++u,a-=Cd)o(a);else for(a=r-r%Cd+Cd,u=0;u<4&&a<i;++u,a=a+Cd)o(a)}}};function Pq(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function Lq(e,t,n,r,i){const s=r-e+3*t-3*n,o=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(s)>$it?(c=o*o+a*s,c>=0&&(c=Math.sqrt(c),u=(-o+c)/s,l=(-o-c)/s)):u=.5*a/o,0<u&&u<1&&i(Bq(u,e,t,n,r)),0<l&&l<1&&i(Bq(l,e,t,n,r))}function Bq(e,t,n,r,i){const s=1-e,o=s*s,a=e*e;return o*s*t+3*o*e*n+3*s*a*r+a*e*i}var xf=(xf=bc(1,1))?xf.getContext("2d"):null;const YR=new no;function Nfe(e){return function(t,n){if(!xf)return!0;e(xf,t),YR.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:o}=YR;for(let a=i;a<=o;++a)for(let u=r;u<=s;++u)if(xf.isPointInPath(u,a))return!0;return!1}}function Mfe(e,t){return t.contains(e.x||0,e.y||0)}function Rfe(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(YR.set(n,r,n+i,r+s))}function yst(e,t){const n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,s=e.y2!=null?e.y2:r;return Ib(t,n,r,i,s)}function Ib(e,t,n,r,i){const{x1:s,y1:o,x2:a,y2:u}=e,l=r-t,c=i-n;let f=0,h=1,d,p,m,g;for(g=0;g<4;++g){if(g===0&&(d=-l,p=-(s-t)),g===1&&(d=l,p=a-t),g===2&&(d=-c,p=-(o-n)),g===3&&(d=c,p=u-n),Math.abs(d)<1e-10&&p<0)return!1;if(m=p/d,d<0){if(m>h)return!1;m>f&&(f=m)}else if(d>0){if(m<f)return!1;m<h&&(h=m)}}return!0}function i0(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Qo(e,t){return e??t}function zq(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function bst(e,t,n){const r=n.width(),i=n.height();let s;if(t.gradient==="radial")s=e.createRadialGradient(n.x1+Qo(t.x1,.5)*r,n.y1+Qo(t.y1,.5)*i,Math.max(r,i)*Qo(t.r1,0),n.x1+Qo(t.x2,.5)*r,n.y1+Qo(t.y2,.5)*i,Math.max(r,i)*Qo(t.r2,.5));else{const o=Qo(t.x1,0),a=Qo(t.y1,0),u=Qo(t.x2,1),l=Qo(t.y2,0);if(o===u||a===l||r===i)s=e.createLinearGradient(n.x1+o*r,n.y1+a*i,n.x1+u*r,n.y1+l*i);else{const c=bc(Math.ceil(r),Math.ceil(i)),f=c.getContext("2d");return f.scale(r,i),f.fillStyle=zq(f.createLinearGradient(o,a,u,l),t.stops),f.fillRect(0,0,r,i),e.createPattern(c,"no-repeat")}}return zq(s,t.stops)}function Pfe(e,t,n){return c8(n)?bst(e,n,t.bounds):n}function kk(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=Pfe(e,t,t.fill),!0):!1}var vst=[];function s0(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return r<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=Pfe(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||vst),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function xst(e,t){return e.zindex-t.zindex||e.index-t.index}function Lfe(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,s;for(i=0,s=t.length;i<s;++i)r=t[i],r.index=i,r.zindex&&n.push(r);return e.zdirty=!1,e.zitems=n.sort(xst)}function Lu(e,t){var n=e.items,r,i;if(!n||!n.length)return;const s=Lfe(e);if(s&&s.length){for(r=0,i=n.length;r<i;++r)n[r].zindex||t(n[r]);n=s}for(r=0,i=n.length;r<i;++r)t(n[r])}function KR(e,t){var n=e.items,r,i;if(!n||!n.length)return null;const s=Lfe(e);for(s&&s.length&&(n=s),i=n.length;--i>=0;)if(r=t(n[i]))return r;if(n===s){for(n=e.items,i=n.length;--i>=0;)if(!n[i].zindex&&(r=t(n[i])))return r}return null}function p8(e){return function(t,n,r){Lu(n,i=>{(!r||r.intersects(i.bounds))&&Bfe(e,t,i,i)})}}function wst(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.bounds))&&Bfe(e,t,n.items[0],n.items)}}function Bfe(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(i0(t,n),n.fill&&kk(t,n,i)&&t.fill(),n.stroke&&s0(t,n,i)&&t.stroke()))}function _I(e){return e=e||Yle,function(t,n,r,i,s,o){return r*=t.pixelRatio,i*=t.pixelRatio,KR(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&e(t,a,r,i,s,o))return a})}}function oC(e,t){return function(n,r,i,s){var o=Array.isArray(r)?r[0]:r,a=t??o.fill,u=o.stroke&&n.isPointInStroke,l,c;return u&&(l=o.strokeWidth,c=o.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,r)?!1:a&&n.isPointInPath(i,s)||u&&n.isPointInStroke(i,s)}}function g8(e){return _I(oC(e))}function Jd(e,t){return"translate("+e+","+t+")"}function m8(e){return"rotate("+e+")"}function Cst(e,t){return"scale("+e+","+t+")"}function zfe(e){return Jd(e.x||0,e.y||0)}function Sst(e){return Jd(e.x||0,e.y||0)+(e.angle?" "+m8(e.angle):"")}function _st(e){return Jd(e.x||0,e.y||0)+(e.angle?" "+m8(e.angle):"")+(e.scaleX||e.scaleY?" "+Cst(e.scaleX||1,e.scaleY||1):"")}function y8(e,t,n){function r(o,a){o("transform",Sst(a)),o("d",t(null,a))}function i(o,a){return t(SI(o,a.angle),a),Ah(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,l=a.y||0,c=a.angle||0;o.translate(u,l),c&&o.rotate(c*=Zf),o.beginPath(),t(o,a),c&&o.rotate(-c),o.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:r,bound:i,draw:p8(s),pick:g8(s),isect:n||Nfe(s)}}var $st=y8("arc",ast);function kst(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,s=1/0,o,a;--i>=0;)e[i].defined!==!1&&(a=Math.abs(e[i][r]-n),a<s&&(s=a,o=e[i]));return o}function Est(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,s,o;--r>=0;)if(e[r].defined!==!1&&(i=e[r].x-t[0],s=e[r].y-t[1],o=i*i+s*s,o<n))return e[r];return null}function Ast(e,t){for(var n=e.length,r,i,s;--n>=0;)if(e[n].defined!==!1&&(r=e[n].x-t[0],i=e[n].y-t[1],s=r*r+i*i,r=e[n].size||1,s<r*r))return e[n];return null}function b8(e,t,n){function r(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function i(u,l){var c=l.items;return c.length===0?u:(t(SI(u),c),Ah(u,c[0]))}function s(u,l){u.beginPath(),t(u,l)}const o=oC(s);function a(u,l,c,f,h,d){var p=l.items,m=l.bounds;return!p||!p.length||m&&!m.contains(h,d)?null:(c*=u.pixelRatio,f*=u.pixelRatio,o(u,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:r,bound:i,draw:wst(s),pick:a,isect:Mfe,tip:n}}var Tst=b8("area",ust,kst);function Dst(e,t){var n=t.clip;e.save(),tI(n)?(e.beginPath(),n(e),e.clip()):jfe(e,t.group)}function jfe(e,t){e.beginPath(),f8(t)?iy(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Ufe(e){const t=Qo(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Ist(e,t){e("transform",zfe(t))}function Wfe(e,t){const n=Ufe(t);e("d",iy(null,t,n,n))}function Fst(e,t){e("class","background"),e("aria-hidden",!0),Wfe(e,t)}function Ost(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Wfe(e,t):e("d","")}function Nst(e,t,n){const r=t.clip?h8(n,t,t):null;e("clip-path",r)}function Mst(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Ah(e,t),e.translate(t.x||0,t.y||0)}function Cx(e,t,n,r){const i=Ufe(t);e.beginPath(),iy(e,t,(n||0)+i,(r||0)+i)}const Rst=oC(Cx),Pst=oC(Cx,!1),Lst=oC(Cx,!0);function Bst(e,t,n){Lu(t,r=>{const i=r.x||0,s=r.y||0,o=r.strokeForeground,a=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&a&&(Cx(e,r,i,s),i0(e,r),r.fill&&kk(e,r,a)&&e.fill(),r.stroke&&!o&&s0(e,r,a)&&e.stroke()),e.save(),e.translate(i,s),r.clip&&jfe(e,r),n&&n.translate(-i,-s),Lu(r,u=>{this.draw(e,u,n)}),n&&n.translate(i,s),e.restore(),o&&r.stroke&&a&&(Cx(e,r,i,s),i0(e,r),s0(e,r,a)&&e.stroke())})}function zst(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const o=n*e.pixelRatio,a=r*e.pixelRatio;return KR(t,u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(i,s))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),m=u.clip;if(m&&(i<c||i>d||s<f||s>p))return;if(e.save(),e.translate(c,f),c=i-c,f=s-f,m&&f8(u)&&!Lst(e,u,o,a))return e.restore(),null;const g=u.strokeForeground,y=t.interactive!==!1;return y&&g&&u.stroke&&Pst(e,u,o,a)?(e.restore(),u):(l=KR(u,b=>jst(b,c,f)?this.pick(b,n,r,c,f):null),!l&&y&&(u.fill||!g&&u.stroke)&&Rst(e,u,o,a)&&(l=u),e.restore(),l||null)})}function jst(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var Ust={type:"group",tag:"g",nested:!1,attr:Ist,bound:Mst,draw:Bst,pick:zst,isect:Rfe,content:Nst,background:Fst,foreground:Ost},Sx={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function v8(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function x8(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function w8(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function $I(e,t){return e==="center"?t/2:e==="right"?t:0}function kI(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function Wst(e,t,n){const r=v8(t,n),i=x8(t,r),s=w8(t,r),o=(t.x||0)-$I(t.align,i),a=(t.y||0)-kI(t.baseline,s),u=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",u,Sx["xmlns:xlink"],"xlink:href"),e("transform",Jd(o,a)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function Vst(e,t){const n=t.image,r=x8(t,n),i=w8(t,n),s=(t.x||0)-$I(t.align,r),o=(t.y||0)-kI(t.baseline,i);return e.set(s,o,s+r,o+i)}function Gst(e,t,n){Lu(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=v8(r,this);let s=x8(r,i),o=w8(r,i);if(s===0||o===0)return;let a=(r.x||0)-$I(r.align,s),u=(r.y||0)-kI(r.baseline,o),l,c,f,h;r.aspect!==!1&&(c=i.width/i.height,f=r.width/r.height,c===c&&f===f&&c!==f&&(f<c?(h=s/c,u+=(o-h)/2,o=h):(h=o*c,a+=(s-h)/2,s=h))),(i.complete||i.toDataURL)&&(i0(e,r),e.globalAlpha=(l=r.opacity)!=null?l:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,a,u,s,o))})}var Hst={type:"image",tag:"image",nested:!1,attr:Wst,bound:Vst,draw:Gst,pick:_I(),isect:Yle,get:v8,xOffset:$I,yOffset:kI},qst=b8("line",lst,Est);function Xst(e,t){var n=t.scaleX||1,r=t.scaleY||1;(n!==1||r!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",_st(t)),e("d",t.path)}function z_(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,o=t.scaleY||1,a=(t.angle||0)*Zf,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=Dfe(n)).path=n),a&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(a),GR(e,u,0,0,s,o),e.rotate(-a),e.translate(-r,-i)):GR(e,u,r,i,s,o)}function Yst(e,t){return z_(SI(e,t.angle),t)?e.set(0,0,0,0):Ah(e,t,!0)}var Kst={type:"path",tag:"path",nested:!1,attr:Xst,bound:Yst,draw:p8(z_),pick:g8(z_),isect:Nfe(z_)};function Zst(e,t){e("d",iy(null,t))}function Jst(e,t){var n,r;return Ah(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function jq(e,t){e.beginPath(),iy(e,t)}var Qst={type:"rect",tag:"path",nested:!1,attr:Zst,bound:Jst,draw:p8(jq),pick:g8(jq),isect:Rfe};function eot(e,t){e("transform",zfe(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function tot(e,t){var n,r;return Ah(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function Vfe(e,t,n){var r,i,s,o;return t.stroke&&s0(e,t,n)?(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,o),!0):!1}function not(e,t,n){Lu(t,r=>{if(!(n&&!n.intersects(r.bounds))){var i=r.opacity==null?1:r.opacity;i&&Vfe(e,r,i)&&(i0(e,r),e.stroke())}})}function rot(e,t,n,r){return e.isPointInStroke?Vfe(e,t,1)&&e.isPointInStroke(n,r):!1}var iot={type:"rule",tag:"line",nested:!1,attr:eot,bound:tot,draw:not,pick:_I(rot),isect:yst},sot=y8("shape",cst),oot=y8("symbol",fst,Mfe);const Uq=eet();var Jb={height:vc,measureWidth:C8,estimateWidth:ZR,width:ZR,canvas:Gfe};Gfe(!0);function Gfe(e){Jb.width=e&&xf?C8:ZR}function ZR(e,t){return Hfe(Jf(e,t),vc(e))}function Hfe(e,t){return~~(.8*e.length*t)}function C8(e,t){return vc(e)<=0||!(t=Jf(e,t))?0:qfe(t,S8(e))}function qfe(e,t){const n=`(${t}) ${e}`;let r=Uq.get(n);return r===void 0&&(xf.font=t,r=xf.measureText(e).width,Uq.set(n,r)),r}function vc(e){return e.fontSize!=null?+e.fontSize||0:11}function Sp(e){return e.lineHeight!=null?e.lineHeight:vc(e)+2}function aot(e){return Yu(e)?e.length>1?e:e[0]:e}function aC(e){return aot(e.lineBreak&&e.text&&!Yu(e.text)?e.text.split(e.lineBreak):e.text)}function Xfe(e){const t=aC(e);return(Yu(t)?t.length-1:0)*Sp(e)}function Jf(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?lot(e,n):n}function uot(e){if(Jb.width===C8){const t=S8(e);return n=>qfe(n,t)}else{const t=vc(e);return n=>Hfe(n,t)}}function lot(e,t){var n=+e.limit,r=uot(e);if(r(t)<n)return t;var i=e.ellipsis||"",s=e.dir==="rtl",o=0,a=t.length,u;if(n-=r(i),s){for(;o<a;)u=o+a>>>1,r(t.slice(u))>n?o=u+1:a=u;return i+t.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),r(t.slice(0,u))<n?o=u:a=u-1;return t.slice(0,o)+i}}function EI(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function S8(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+vc(e)+"px "+EI(e,t)}function _8(e){var t=e.baseline,n=vc(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Sp(e):t==="line-bottom"?.29*n-.5*Sp(e):0)}const cot={left:"start",center:"middle",right:"end"},Qb=new no;function AI(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;return r&&(i=(e.theta||0)-Cd,t+=r*Math.cos(i),n+=r*Math.sin(i)),Qb.x1=t,Qb.y1=n,Qb}function fot(e,t){var n=t.dx||0,r=(t.dy||0)+_8(t),i=AI(t),s=i.x1,o=i.y1,a=t.angle||0,u;e("text-anchor",cot[t.align]||"start"),a?(u=Jd(s,o)+" "+m8(a),(n||r)&&(u+=" "+Jd(n,r))):u=Jd(s+n,o+r),e("transform",u)}function $8(e,t,n){var r=Jb.height(t),i=t.align,s=AI(t),o=s.x1,a=s.y1,u=t.dx||0,l=(t.dy||0)+_8(t)-Math.round(.8*r),c=aC(t),f;if(Yu(c)?(r+=Sp(t)*(c.length-1),f=c.reduce((h,d)=>Math.max(h,Jb.width(t,d)),0)):f=Jb.width(t,c),i==="center"?u-=f/2:i==="right"&&(u-=f),e.set(u+=o,l+=a,u+f,l+r),t.angle&&!n)e.rotate(t.angle*Zf,o,a);else if(n===2)return e.rotatedPoints(t.angle*Zf,o,a);return e}function hot(e,t,n){Lu(t,r=>{var i=r.opacity==null?1:r.opacity,s,o,a,u,l,c,f;if(!(n&&!n.intersects(r.bounds)||i===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=S8(r),e.textAlign=r.align||"left",s=AI(r),o=s.x1,a=s.y1,r.angle&&(e.save(),e.translate(o,a),e.rotate(r.angle*Zf),o=a=0),o+=r.dx||0,a+=(r.dy||0)+_8(r),c=aC(r),i0(e,r),Yu(c))for(l=Sp(r),u=0;u<c.length;++u)f=Jf(r,c[u]),r.fill&&kk(e,r,i)&&e.fillText(f,o,a),r.stroke&&s0(e,r,i)&&e.strokeText(f,o,a),a+=l;else f=Jf(r,c),r.fill&&kk(e,r,i)&&e.fillText(f,o,a),r.stroke&&s0(e,r,i)&&e.strokeText(f,o,a);r.angle&&e.restore()}})}function dot(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=AI(t),a=o.x1,u=o.y1,l=$8(Qb,t,1),c=-t.angle*Zf,f=Math.cos(c),h=Math.sin(c),d=f*i-h*s+(a-f*a+h*u),p=h*i+f*s+(u-h*a-f*u);return l.contains(d,p)}function pot(e,t){const n=$8(Qb,e,2);return Ib(t,n[0],n[1],n[2],n[3])||Ib(t,n[0],n[1],n[4],n[5])||Ib(t,n[4],n[5],n[6],n[7])||Ib(t,n[2],n[3],n[6],n[7])}var got={type:"text",tag:"text",nested:!1,attr:fot,bound:$8,draw:hot,pick:_I(dot),isect:pot},mot=b8("trail",hst,Ast),_p={arc:$st,area:Tst,group:Ust,image:Hst,line:qst,path:Kst,rect:Qst,rule:iot,shape:sot,symbol:oot,text:got,trail:mot};function Rd(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Yfe(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function Ws(e,t,n,r){var i=e.childNodes[t],s;return(!i||i.tagName.toLowerCase()!==n.toLowerCase())&&(s=i||null,i=Rd(e.ownerDocument,n,r),e.insertBefore(i,s)),i}function ou(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function Kfe(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function Zfe(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function yot(e,t,n,r){var i=e&&e.mark,s,o;if(i&&(s=_p[i.marktype]).tip){for(o=Zfe(t,n),o[0]-=r[0],o[1]-=r[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=s.tip(i.items,o)}return e}function $p(e,t){this._active=null,this._handlers={},this._loader=e||Dce(),this._tooltip=t||bot}function bot(e,t,n,r){e.element().setAttribute("title",r||"")}$p.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=Rd(null,"a");for(const o in r)s.setAttribute(o,r[o]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=yot(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),o=i.height();let a=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}};function xc(e){this._el=null,this._bgcolor=null,this._loader=new Ofe(e)}xc.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const vot="keydown",xot="keypress",wot="keyup",Jfe="dragenter",j_="dragleave",Qfe="dragover",JR="mousedown",Cot="mouseup",Ek="mousemove",ev="mouseout",ehe="mouseover",Ak="click",Sot="dblclick",_ot="wheel",the="mousewheel",Tk="touchstart",Dk="touchmove",Ik="touchend",$ot=[vot,xot,wot,Jfe,j_,Qfe,JR,Cot,Ek,ev,ehe,Ak,Sot,_ot,the,Tk,Dk,Ik],QR=Ek,_x=ev,eP=Ak;function kot(e,t){$p.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const Eot=e=>e===Tk||e===Dk||e===Ik?[Tk,Dk,Ik]:[e];function Wq(e,t){Eot(t).forEach(n=>Aot(e,n))}function Aot(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?r=>e[t](r):r=>e.fire(t,r)))}function Vq(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?this.fire(e,r):((!i||!i.exit)&&this.fire(n,r),this._active=s,this.fire(t,r),this.fire(e,r))}}function Gq(e){return function(t){this.fire(e,t),this._active=null}}Go(kot,$p,{initialize(e,t,n){return this._canvas=e&&Yfe(e,"canvas"),[Ak,JR,Ek,ev,j_].forEach(r=>Wq(this,r)),$p.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:$ot,DOMMouseScroll(e){this.fire(the,e)},mousemove:Vq(Ek,ehe,ev),dragover:Vq(Qfe,Jfe,j_),mouseout:Gq(ev),dragleave:Gq(j_),mousedown(e){this._down=this._active,this.fire(JR,e)},click(e){this._down===this._active&&(this.fire(Ak,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Tk,e,!0)},touchmove(e){this.fire(Dk,e,!0)},touchend(e){this.fire(Ik,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===eP&&r&&r.href?this.handleHref(t,r,r.href):(e===QR||e===_x)&&this.handleTooltip(t,r,e!==_x),i)for(let s=0,o=i.length;s<o;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(Wq(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=Zfe(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return _p[e.marktype].pick.call(this,s,e,t,n,r,i)}});function Tot(){return typeof window<"u"&&window.devicePixelRatio||1}var Dot=Tot();function Iot(e,t,n,r,i,s){const o=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=o?Dot:i;e.width=t*u,e.height=n*u;for(const l in s)a[l]=s[l];return o&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*r[0],u*r[1]),e}function Fot(e){xc.call(this,e),this._options={},this._redraw=!1,this._dirty=new no,this._tempb=new no}const Hq=xc.prototype,Oot=(e,t,n)=>new no().set(0,0,t,n).translate(-e[0],-e[1]);function Not(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}Go(Fot,xc,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:bc(1,1,this._options.type),e&&this._canvas&&(ou(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),Hq.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(Hq.resize.call(this,e,t,n,r),this._canvas)Iot(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||Hl("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,o=Oot(n,r,i);t.save();const a=this._redraw||s.empty()?(this._redraw=!1,o.expand(1)):Not(t,o.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,a),t.restore(),s.clear(),this},draw(e,t,n){const r=_p[t.marktype];t.clip&&Dst(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type!=="pdf"&&!i.externalContext&&s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});function Mot(e,t){$p.call(this,e,t);const n=this;n._hrefHandler=tP(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=tP(n,(r,i)=>{n.handleTooltip(r,i,r.type!==_x)})}const tP=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};Go(Mot,$p,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(eP,this._hrefHandler),r.removeEventListener(QR,this._tooltipHandler),r.removeEventListener(_x,this._tooltipHandler)),this._svg=r=e&&Yfe(e,"svg"),r&&(r.addEventListener(eP,this._hrefHandler),r.addEventListener(QR,this._tooltipHandler),r.addEventListener(_x,this._tooltipHandler)),$p.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const s={type:e,handler:t,listener:tP(this,t)};(r[n]||(r[n]=[])).push(s),this._svg&&this._svg.addEventListener(n,s.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const nhe="aria-hidden",k8="aria-label",E8="role",A8="aria-roledescription",rhe="graphics-object",T8="graphics-symbol",ihe=(e,t,n)=>({[E8]:e,[A8]:t,[k8]:n||void 0}),Rot=Zle(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),qq={axis:{desc:"axis",caption:Bot},legend:{desc:"legend",caption:zot},"title-text":{desc:"title",caption:e=>`Title text '${Yq(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${Yq(e)}'`}},Xq={ariaRole:E8,ariaRoleDescription:A8,description:k8};function she(e,t){const n=t.aria===!1;if(e(nhe,n||void 0),n||t.description==null)for(const r in Xq)e(Xq[r],void 0);else{const r=t.mark.marktype;e(k8,t.description),e(E8,t.ariaRole||(r==="group"?rhe:T8)),e(A8,t.ariaRoleDescription||`${r} mark`)}}function ohe(e){return e.aria===!1?{[nhe]:!0}:Rot[e.role]?null:qq[e.role]?Lot(e,qq[e.role]):Pot(e)}function Pot(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(r=>r.description!=null&&r.aria!==!1);return ihe(n?rhe:T8,`${t} mark container`,e.description)}function Lot(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return ihe(t.role||T8,t.desc,n.description||r(n))}catch{return null}}function Yq(e){return A6(e.text).join(" ")}function Bot(e){const t=e.datum,n=e.orient,r=t.title?ahe(e):null,i=e.context,s=i.scales[t.scale].value,o=i.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${wfe(a)?"discrete":a} scale with ${Efe(o,s,e)}`}function zot(e){const t=e.datum,n=t.title?ahe(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),o=e.context,a=o.scales[i[s[0]]].value,u=o.dataflow.locale();return Uot(r)+(n?` titled '${n}'`:"")+` for ${jot(s)} with ${Efe(u,a,e)}`}function ahe(e){try{return A6(wu(e.items).items[0].text).join(" ")}catch{return null}}function jot(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+wu(e)}function Uot(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const uhe=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Wot=e=>uhe(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function lhe(){let e="",t="",n="";const r=[],i=()=>t=n="",s=u=>{t&&(e+=`${t}>${n}`,i()),r.push(u)},o=(u,l)=>(l!=null&&(t+=` ${u}="${Wot(l)}"`),a),a={open(u){s(u),t="<"+u;for(var l=arguments.length,c=new Array(l>1?l-1:0),f=1;f<l;f++)c[f-1]=arguments[f];for(const h of c)for(const d in h)o(d,h[d]);return a},close(){const u=r.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,i(),a},attr:o,text:u=>(n+=uhe(u),a),toString:()=>e};return a}const Vot=e=>che(lhe(),e)+"";function che(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let i=0;i<r;++i)e.attr(n[i].name,n[i].value)}if(t.hasChildNodes()){const n=t.childNodes;for(const r of n)r.nodeType===3?e.text(r.nodeValue):che(e,r)}return e.close()}const Fk={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},Ok={blend:"mix-blend-mode"},fhe={fill:"none","stroke-miterlimit":10},qy=0,Kq="http://www.w3.org/2000/xmlns/",ar=Sx.xmlns;function Got(e){xc.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const YN=xc.prototype;Go(Got,xc,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=Ws(e,0,"svg",ar),this._svg.setAttributeNS(Kq,"xmlns",ar),this._svg.setAttributeNS(Kq,"xmlns:xlink",Sx["xmlns:xlink"]),this._svg.setAttribute("version",Sx.version),this._svg.setAttribute("class","marks"),ou(e,1),this._root=Ws(this._svg,qy,"g",ar),Jc(this._root,fhe),ou(this._svg,qy+1)),this.background(this._bgcolor),YN.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),YN.background.apply(this,arguments)},resize(e,t,n,r){return YN.resize.call(this,e,t,n,r),this._svg&&(Jc(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=Ws(e,qy,"rect",ar),Jc(n,{width:this._width,height:this._height,fill:t}));const r=Vot(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),ou(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||!e._svg.ownerSVGElement||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,o,a,u;for(o=0,a=e.length;o<a;++o)if(n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,s=_p[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,Zq(n,t),r.items.forEach(l=>{l.dirty=t})),!r.zdirty){if(n.exit){s.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=s.nested?r.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,Zq(n,t)):this._update(s,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=_p[t.marktype],s=t.interactive===!1?"none":null,o=i.tag==="g",a=Jq(t,e,n,"g",r);a.setAttribute("class",Kfe(t));const u=ohe(t);for(const h in u)Fi(a,h,u[h]);o||Fi(a,"pointer-events",s),Fi(a,"clip-path",t.clip?h8(this,t,t.group):null);let l=null,c=0;const f=h=>{const d=this.isDirty(h),p=Jq(h,a,l,i.tag,r);d&&(this._update(i,p,h),o&&Xot(this,p,h)),l=p,++c};return i.nested?t.items.length&&f(t.items[0]):Lu(t,f),ou(a,c),a},_update(e,t,n){Bl=t,oi=t.__values__,she(tv,n),e.attr(tv,n,this);const r=Kot[e.type];r&&r.call(this,e,t,n),Bl&&this.style(Bl,n)},style(e,t){if(t!=null){for(const n in Fk){let r=n==="font"?EI(t):t[n];if(r===oi[n])continue;const i=Fk[n];r==null?e.removeAttribute(i):(c8(r)&&(r=Afe(r,this._defs.gradient,hhe())),e.setAttribute(i,r+"")),oi[n]=r}for(const n in Ok)U_(e,Ok[n],t[n])}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=Ws(e,qy+1,"defs",ar)),r=Hot(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=Ws(e,qy+1,"defs",ar)),r=qot(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):ou(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function Zq(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function Hot(e,t,n){let r,i,s;if(t.gradient==="radial"){let o=Ws(e,n++,"pattern",ar);Jc(o,{id:$k+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=Ws(o,0,"rect",ar),Jc(o,{width:1,height:1,fill:`url(${hhe()}#${t.id})`}),e=Ws(e,n++,"radialGradient",ar),Jc(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=Ws(e,n++,"linearGradient",ar),Jc(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)s=Ws(e,r,"stop",ar),s.setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return ou(e,r),n}function qot(e,t,n){let r;return e=Ws(e,n,"clipPath",ar),e.setAttribute("id",t.id),t.path?(r=Ws(e,0,"path",ar),r.setAttribute("d",t.path)):(r=Ws(e,0,"rect",ar),Jc(r,{x:0,y:0,width:t.width,height:t.height})),ou(e,1),n+1}function Xot(e,t,n){t=t.lastChild.previousSibling;let r,i=0;Lu(n,s=>{r=e.mark(t,s,r),++i}),ou(t,1+i)}function Jq(e,t,n,r,i){let s=e._svg,o;if(!s&&(o=t.ownerDocument,s=Rd(o,r,ar),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},r==="g"))){const a=Rd(o,"path",ar);s.appendChild(a),a.__data__=e;const u=Rd(o,"g",ar);s.appendChild(u),u.__data__=e;const l=Rd(o,"path",ar);s.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(s.ownerSVGElement!==i||Yot(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}function Yot(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Bl=null,oi=null;const Kot={group(e,t,n){const r=Bl=t.childNodes[2];oi=r.__values__,e.foreground(tv,n,this),oi=t.__values__,Bl=t.childNodes[1],e.content(tv,n,this);const i=Bl=t.childNodes[0];e.background(tv,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==oi.events&&(Fi(r,"pointer-events",s),Fi(i,"pointer-events",s),oi.events=s),n.strokeForeground&&n.stroke){const o=n.fill;Fi(r,"display",null),this.style(i,n),Fi(i,"stroke",null),o&&(n.fill=null),oi=r.__values__,this.style(r,n),o&&(n.fill=o),Bl=null}else Fi(r,"display","none")},image(e,t,n){n.smooth===!1?(U_(t,"image-rendering","optimizeSpeed"),U_(t,"image-rendering","pixelated")):U_(t,"image-rendering",null)},text(e,t,n){const r=aC(n);let i,s,o,a;Yu(r)?(s=r.map(u=>Jf(n,u)),i=s.join(`
`),i!==oi.text&&(ou(t,0),o=t.ownerDocument,a=Sp(n),s.forEach((u,l)=>{const c=Rd(o,"tspan",ar);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),oi.text=i)):(s=Jf(n,r),s!==oi.text&&(t.textContent=s,oi.text=s)),Fi(t,"font-family",EI(n)),Fi(t,"font-size",vc(n)+"px"),Fi(t,"font-style",n.fontStyle),Fi(t,"font-variant",n.fontVariant),Fi(t,"font-weight",n.fontWeight)}};function tv(e,t,n){t!==oi[e]&&(n?Zot(Bl,e,t,n):Fi(Bl,e,t),oi[e]=t)}function U_(e,t,n){n!==oi[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),oi[t]=n)}function Jc(e,t){for(const n in t)Fi(e,n,t[n])}function Fi(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function Zot(e,t,n,r){n!=null?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}function hhe(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Jot(e){xc.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Go(Jot,xc,{svg(){return this._text},_render(e){const t=lhe();t.open("svg",nI({},Sx,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",fhe,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=_p[t.marktype],r=n.tag,i=[she,n.attr];e.open("g",{class:Kfe(t),"clip-path":t.clip?h8(this,t,t.group):null},ohe(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=o=>{const a=this.href(o);if(a&&e.open("a",a),e.open(r,this.attr(t,o,i,r!=="g"?r:null)),r==="text"){const u=aC(o);if(Yu(u)){const l={x:0,dy:Sp(o)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(Jf(o,u[c])).close()}else e.text(Jf(o,u))}else if(r==="g"){const u=o.strokeForeground,l=o.fill,c=o.stroke;u&&c&&(o.stroke=null),e.open("path",this.attr(t,o,n.background,"bgrect")).close(),e.open("g",this.attr(t,o,n.content)),Lu(o,f=>this.mark(e,f)),e.close(),u&&c?(l&&(o.fill=null),o.stroke=c,e.open("path",this.attr(t,o,n.foreground,"bgrect")).close(),l&&(o.fill=l)):e.open("path",this.attr(t,o,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):Lu(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(o,a,u,l)=>{i[l||o]=a};return Array.isArray(n)?n.forEach(o=>o(s,t,this)):n(s,t,this),r&&Qot(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const i in t){const s=t[i],o=s.stops;s.gradient==="radial"?(e.open("pattern",{id:$k+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close(),e.close(),e.open("radialGradient",{id:i,fx:s.x1,fy:s.y1,fr:s.r1,cx:s.x2,cy:s.y2,r:s.r2})):e.open("linearGradient",{id:i,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2});for(let a=0;a<o.length;++a)e.open("stop",{offset:o[a].offset,"stop-color":o[a].color}).close();e.close()}for(const i in n){const s=n[i];e.open("clipPath",{id:i}),s.path?e.open("path",{d:s.path}).close():e.open("rect",{x:0,y:0,width:s.width,height:s.height}).close(),e.close()}e.close()}}});function Qot(e,t,n,r,i){let s;if(t==null||(r==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),r==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;r==="image"&&t.smooth===!1&&(s=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),r==="text"&&(e["font-family"]=EI(t),e["font-size"]=vc(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const o in Fk){let a=t[o];const u=Fk[o];a==="transparent"&&(u==="fill"||u==="stroke")||a!=null&&(c8(a)&&(a=Afe(a,i.gradient,"")),e[u]=a)}for(const o in Ok){const a=t[o];a!=null&&(s=s||[],s.push(`${Ok[o]}: ${a};`))}return s&&(e.style=s.join(" ")),e}const KN=new no;function eat(e){const t=e.clip;if(tI(t))t(SI(KN.clear()));else if(t)KN.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(KN)}const o0="top",ha="left",ga="right",Qf="bottom",tat="top-left",nat="top-right",rat="bottom-left",iat="bottom-right",D8="start",nP="middle",Ni="end",sat="x",oat="y",TI="group",I8="axis",F8="title",aat="frame",uat="scope",O8="legend",dhe="row-header",phe="row-footer",ghe="row-title",mhe="column-header",yhe="column-footer",bhe="column-title",lat="padding",cat="symbol",vhe="fit",xhe="fit-x",whe="fit-y",fat="pad",N8="none",jS="all",rP="each",M8="flush",Qc="column",ef="row";function Che(e){he.call(this,null,e)}Go(Che,he,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,s=_p[i],o=s.bound;let a=r.bounds,u;if(s.nested)r.items.length&&n.dirty(r.items[0]),a=US(r,o),r.items.forEach(l=>{l.bounds.clear().union(a)});else if(i===TI||e.modified())switch(t.visit(t.MOD,l=>n.dirty(l)),a.clear(),r.items.forEach(l=>a.union(US(l,o))),r.role){case I8:case O8:case F8:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,l=>{a.union(US(l,o))}),t.visit(t.MOD,l=>{u=u||a.alignsWith(l.bounds),n.dirty(l),a.union(US(l,o))}),u&&(a.clear(),r.items.forEach(l=>a.union(l.bounds)));return eat(r),t.modifies("bounds")}});function US(e,t,n){return t(e.bounds.clear(),e,n)}const Qq=":vega_identifier:";function R8(e){he.call(this,0,e)}R8.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};Go(R8,he,{transform(e,t){const n=hat(t.dataflow),r=e.as;let i=n.value;return t.visit(t.ADD,s=>s[r]=s[r]||++i),n.set(this.value=i),t}});function hat(e){return e._signals[Qq]||(e._signals[Qq]=e.add(0))}function She(e){he.call(this,null,e)}Go(She,he,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,dat(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===TI?Ffe:d8;return t.visit(t.ADD,i=>r.call(i,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function dat(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function _he(e){he.call(this,null,e)}const eX={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((r,i)=>!i||!$he(n.bounds,r.bounds,t)?(n=r,1):r.opacity=0)}},$he=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),tX=(e,t)=>{for(var n=1,r=e.length,i=e[0].bounds,s;n<r;i=s,++n)if($he(i,s=e[n].bounds,t))return!0},pat=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},gat=(e,t,n)=>{var r=e.range(),i=new no;return t===o0||t===Qf?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),s=>i.encloses(s.bounds)},nX=e=>(e.forEach(t=>t.opacity=1),e),rX=(e,t)=>e.reflow(t.modified()).modifies("opacity");Go(_he,he,{transform(e,t){const n=eX[e.method]||eX.parity,r=e.separation||0;let i=t.materialize(t.SOURCE).source,s,o;if(!i||!i.length)return;if(!e.method)return e.modified("method")&&(nX(i),t=rX(t,e)),t;if(i=i.filter(pat),!i.length)return;if(e.sort&&(i=i.slice().sort(e.sort)),s=nX(i),t=rX(t,e),s.length>=3&&tX(s,r)){do s=n(s,r);while(s.length>=3&&tX(s,r));s.length<3&&!wu(i).opacity&&(s.length>1&&(wu(s).opacity=0),wu(i).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(o=gat(e.boundScale,e.boundOrient,+e.boundTolerance),i.forEach(u=>{o(u)||(u.opacity=0)}));const a=s[0].mark.bounds.clear();return i.forEach(u=>{u.opacity&&a.union(u.bounds)}),t}});function khe(e){he.call(this,null,e)}Go(khe,he,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const ii=new no;function cm(e,t,n){return e[t]===n?0:(e[t]=n,1)}function mat(e){var t=e.items[0].orient;return t===ha||t===ga}function yat(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function bat(e,t,n,r){var i=t.items[0],s=i.datum,o=i.translate!=null?i.translate:.5,a=i.orient,u=yat(s),l=i.range,c=i.offset,f=i.position,h=i.minExtent,d=i.maxExtent,p=s.title&&i.items[u[2]].items[0],m=i.titlePadding,g=i.bounds,y=p&&Xfe(p),b=0,x=0,v,w;switch(ii.clear().union(g),g.clear(),(v=u[0])>-1&&g.union(i.items[v].bounds),(v=u[1])>-1&&g.union(i.items[v].bounds),a){case o0:b=f||0,x=-c,w=Math.max(h,Math.min(d,-g.y1)),g.add(0,-w).add(l,0),p&&WS(e,p,w,m,y,0,-1,g);break;case ha:b=-c,x=f||0,w=Math.max(h,Math.min(d,-g.x1)),g.add(-w,0).add(0,l),p&&WS(e,p,w,m,y,1,-1,g);break;case ga:b=n+c,x=f||0,w=Math.max(h,Math.min(d,g.x2)),g.add(0,0).add(w,l),p&&WS(e,p,w,m,y,1,1,g);break;case Qf:b=f||0,x=r+c,w=Math.max(h,Math.min(d,g.y2)),g.add(0,0).add(l,w),p&&WS(e,p,w,m,0,0,1,g);break;default:b=i.x,x=i.y}return Ah(g.translate(b,x),i),cm(i,"x",b+o)|cm(i,"y",x+o)&&(i.bounds=ii,e.dirty(i),i.bounds=g,e.dirty(i)),i.mark.bounds.clear().union(g)}function WS(e,t,n,r,i,s,o,a){const u=t.bounds;if(t.auto){const l=o*(n+i+r);let c=0,f=0;e.dirty(t),s?c=(t.x||0)-(t.x=l):f=(t.y||0)-(t.y=l),t.mark.bounds.clear().union(u.translate(-c,-f)),e.dirty(t)}a.union(u)}const iX=(e,t)=>Math.floor(Math.min(e,t)),sX=(e,t)=>Math.ceil(Math.max(e,t));function vat(e){var t=e.items,n=t.length,r=0,i,s;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<n;++r)if(i=t[r],s=i.items,i.marktype===TI)switch(i.role){case I8:case O8:case F8:break;case dhe:o.rowheaders.push(...s);break;case phe:o.rowfooters.push(...s);break;case mhe:o.colheaders.push(...s);break;case yhe:o.colfooters.push(...s);break;case ghe:o.rowtitle=s[0];break;case bhe:o.coltitle=s[0];break;default:o.marks.push(...s)}return o}function xat(e){return new no().set(0,0,e.width||0,e.height||0)}function wat(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Sn(e,t,n){const r=E6(e)?e[t]:e;return r??(n!==void 0?n:0)}function oX(e){return e<0?Math.ceil(-e):0}function Ehe(e,t,n){var r=!n.nodirty,i=n.bounds===M8?xat:wat,s=ii.set(0,0,0,0),o=Sn(n.align,Qc),a=Sn(n.align,ef),u=Sn(n.padding,Qc),l=Sn(n.padding,ef),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),h=t.length,d=Array(h),p=Array(c),m=0,g=Array(h),y=Array(f),b=0,x=Array(h),v=Array(h),w=Array(h),C,S,_,$,k,E,F,T,I,D,N;for(S=0;S<c;++S)p[S]=0;for(S=0;S<f;++S)y[S]=0;for(S=0;S<h;++S)E=t[S],k=w[S]=i(E),E.x=E.x||0,x[S]=0,E.y=E.y||0,v[S]=0,_=S%c,$=~~(S/c),m=Math.max(m,F=Math.ceil(k.x2)),b=Math.max(b,T=Math.ceil(k.y2)),p[_]=Math.max(p[_],F),y[$]=Math.max(y[$],T),d[S]=u+oX(k.x1),g[S]=l+oX(k.y1),r&&e.dirty(t[S]);for(S=0;S<h;++S)S%c===0&&(d[S]=0),S<c&&(g[S]=0);if(o===rP)for(_=1;_<c;++_){for(N=0,S=_;S<h;S+=c)N<d[S]&&(N=d[S]);for(S=_;S<h;S+=c)d[S]=N+p[_-1]}else if(o===jS){for(N=0,S=0;S<h;++S)S%c&&N<d[S]&&(N=d[S]);for(S=0;S<h;++S)S%c&&(d[S]=N+m)}else for(o=!1,_=1;_<c;++_)for(S=_;S<h;S+=c)d[S]+=p[_-1];if(a===rP)for($=1;$<f;++$){for(N=0,S=$*c,C=S+c;S<C;++S)N<g[S]&&(N=g[S]);for(S=$*c;S<C;++S)g[S]=N+y[$-1]}else if(a===jS){for(N=0,S=c;S<h;++S)N<g[S]&&(N=g[S]);for(S=c;S<h;++S)g[S]=N+b}else for(a=!1,$=1;$<f;++$)for(S=$*c,C=S+c;S<C;++S)g[S]+=y[$-1];for(I=0,S=0;S<h;++S)I=d[S]+(S%c?I:0),x[S]+=I-t[S].x;for(_=0;_<c;++_)for(D=0,S=_;S<h;S+=c)D+=g[S],v[S]+=D-t[S].y;if(o&&Sn(n.center,Qc)&&f>1)for(S=0;S<h;++S)k=o===jS?m:p[S%c],I=k-w[S].x2-t[S].x-x[S],I>0&&(x[S]+=I/2);if(a&&Sn(n.center,ef)&&c!==1)for(S=0;S<h;++S)k=a===jS?b:y[~~(S/c)],D=k-w[S].y2-t[S].y-v[S],D>0&&(v[S]+=D/2);for(S=0;S<h;++S)s.union(w[S].translate(x[S],v[S]));switch(I=Sn(n.anchor,sat),D=Sn(n.anchor,oat),Sn(n.anchor,Qc)){case Ni:I-=s.width();break;case nP:I-=s.width()/2}switch(Sn(n.anchor,ef)){case Ni:D-=s.height();break;case nP:D-=s.height()/2}for(I=Math.round(I),D=Math.round(D),s.clear(),S=0;S<h;++S)t[S].mark.bounds.clear();for(S=0;S<h;++S)E=t[S],E.x+=x[S]+=I,E.y+=v[S]+=D,s.union(E.mark.bounds.union(E.bounds.translate(x[S],v[S]))),r&&e.dirty(E);return s}function Cat(e,t,n){var r=vat(t),i=r.marks,s=n.bounds===M8?Sat:_at,o=n.offset,a=n.columns||i.length,u=a<=0?1:Math.ceil(i.length/a),l=u*a,c,f,h,d,p,m,g;const y=Ehe(e,i,n);y.empty()&&y.set(0,0,0,0),r.rowheaders&&(m=Sn(n.headerBand,ef,null),c=VS(e,r.rowheaders,i,a,u,-Sn(o,"rowHeader"),iX,0,s,"x1",0,a,1,m)),r.colheaders&&(m=Sn(n.headerBand,Qc,null),f=VS(e,r.colheaders,i,a,a,-Sn(o,"columnHeader"),iX,1,s,"y1",0,1,a,m)),r.rowfooters&&(m=Sn(n.footerBand,ef,null),h=VS(e,r.rowfooters,i,a,u,Sn(o,"rowFooter"),sX,0,s,"x2",a-1,a,1,m)),r.colfooters&&(m=Sn(n.footerBand,Qc,null),d=VS(e,r.colfooters,i,a,a,Sn(o,"columnFooter"),sX,1,s,"y2",l-a,1,a,m)),r.rowtitle&&(p=Sn(n.titleAnchor,ef),g=Sn(o,"rowTitle"),g=p===Ni?h+g:c-g,m=Sn(n.titleBand,ef,.5),aX(e,r.rowtitle,g,0,y,m)),r.coltitle&&(p=Sn(n.titleAnchor,Qc),g=Sn(o,"columnTitle"),g=p===Ni?d+g:f-g,m=Sn(n.titleBand,Qc,.5),aX(e,r.coltitle,g,1,y,m))}function Sat(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function _at(e,t){return e.bounds[t]}function VS(e,t,n,r,i,s,o,a,u,l,c,f,h,d){var p=n.length,m=0,g=0,y,b,x,v,w,C,S,_,$;if(!p)return m;for(y=c;y<p;y+=f)n[y]&&(m=o(m,u(n[y],l)));if(!t.length)return m;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),m+=s,b=0,v=t.length;b<v;++b)e.dirty(t[b]),t[b].mark.bounds.clear();for(y=c,b=0,v=t.length;b<v;++b,y+=f){for(C=t[b],w=C.mark.bounds,x=y;x>=0&&(S=n[x])==null;x-=h);a?(_=d==null?S.x:Math.round(S.bounds.x1+d*S.bounds.width()),$=m):(_=m,$=d==null?S.y:Math.round(S.bounds.y1+d*S.bounds.height())),w.union(C.bounds.translate(_-(C.x||0),$-(C.y||0))),C.x=_,C.y=$,e.dirty(C),g=o(g,w[l])}return g}function aX(e,t,n,r,i,s){if(t){e.dirty(t);var o=n,a=n;r?o=Math.round(i.x1+s*i.width()):a=Math.round(i.y1+s*i.height()),t.bounds.translate(o-(t.x||0),a-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=a,e.dirty(t)}}function $at(e,t){const n=e[t]||{};return(r,i)=>n[r]!=null?n[r]:e[r]!=null?e[r]:i}function kat(e,t){let n=-1/0;return e.forEach(r=>{r.offset!=null&&(n=Math.max(n,r.offset))}),n>-1/0?n:t}function Eat(e,t,n,r,i,s,o){const a=$at(n,t),u=kat(e,a("offset",0)),l=a("anchor",D8),c=l===Ni?1:l===nP?.5:0,f={align:rP,bounds:a("bounds",M8),columns:a("direction")==="vertical"?1:e.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(t){case ha:f.anchor={x:Math.floor(r.x1)-u,column:Ni,y:c*(o||r.height()+2*r.y1),row:l};break;case ga:f.anchor={x:Math.ceil(r.x2)+u,y:c*(o||r.height()+2*r.y1),row:l};break;case o0:f.anchor={y:Math.floor(i.y1)-u,row:Ni,x:c*(s||i.width()+2*i.x1),column:l};break;case Qf:f.anchor={y:Math.ceil(i.y2)+u,x:c*(s||i.width()+2*i.x1),column:l};break;case tat:f.anchor={x:u,y:u};break;case nat:f.anchor={x:s-u,y:u,column:Ni};break;case rat:f.anchor={x:u,y:o-u,row:Ni};break;case iat:f.anchor={x:s-u,y:o-u,column:Ni,row:Ni};break}return f}function Aat(e,t){var n=t.items[0],r=n.datum,i=n.orient,s=n.bounds,o=n.x,a=n.y,u,l;return n._bounds?n._bounds.clear().union(s):n._bounds=s.clone(),s.clear(),Dat(e,n,n.items[0].items[0]),s=Tat(n,s),u=2*n.padding,l=2*n.padding,s.empty()||(u=Math.ceil(s.width()+u),l=Math.ceil(s.height()+l)),r.type===cat&&Iat(n.items[0].items[0].items[0].items),i!==N8&&(n.x=o=0,n.y=a=0),n.width=u,n.height=l,Ah(s.set(o,a,o+u,a+l),n),n.mark.bounds.clear().union(s),n}function Tat(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function Dat(e,t,n){var r=t.padding,i=r-n.x,s=r-n.y;if(!t.datum.title)(i||s)&&Xy(e,n,i,s);else{var o=t.items[1].items[0],a=o.anchor,u=t.titlePadding||0,l=r-o.x,c=r-o.y;switch(o.orient){case ha:i+=Math.ceil(o.bounds.width())+u;break;case ga:case Qf:break;default:s+=o.bounds.height()+u}switch((i||s)&&Xy(e,n,i,s),o.orient){case ha:c+=Yg(t,n,o,a,1,1);break;case ga:l+=Yg(t,n,o,Ni,0,0)+u,c+=Yg(t,n,o,a,1,1);break;case Qf:l+=Yg(t,n,o,a,0,0),c+=Yg(t,n,o,Ni,-1,0,1)+u;break;default:l+=Yg(t,n,o,a,0,0)}(l||c)&&Xy(e,o,l,c),(l=Math.round(o.bounds.x1-r))<0&&(Xy(e,n,-l,0),Xy(e,o,-l,0))}}function Yg(e,t,n,r,i,s,o){const a=e.datum.type!=="symbol",u=n.datum.vgrad,l=a&&(s||!u)&&!o?t.items[0]:t,c=l.bounds[i?"y2":"x2"]-e.padding,f=u&&s?c:0,h=u&&s?0:c,d=i<=0?0:Xfe(n);return Math.round(r===D8?f:r===Ni?h-d:.5*(c-d))}function Xy(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function Iat(e){const t=e.reduce((n,r)=>(n[r.column]=Math.max(r.bounds.x2-r.x,n[r.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function Fat(e,t,n,r,i){var s=t.items[0],o=s.frame,a=s.orient,u=s.anchor,l=s.offset,c=s.padding,f=s.items[0].items[0],h=s.items[1]&&s.items[1].items[0],d=a===ha||a===ga?r:n,p=0,m=0,g=0,y=0,b=0,x;if(o!==TI?a===ha?(p=i.y2,d=i.y1):a===ga?(p=i.y1,d=i.y2):(p=i.x1,d=i.x2):a===ha&&(p=r,d=0),x=u===D8?p:u===Ni?d:(p+d)/2,h&&h.text){switch(a){case o0:case Qf:b=f.bounds.height()+c;break;case ha:y=f.bounds.width()+c;break;case ga:y=-f.bounds.width()-c;break}ii.clear().union(h.bounds),ii.translate(y-(h.x||0),b-(h.y||0)),cm(h,"x",y)|cm(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(ii),h.mark.bounds.clear().union(ii),e.dirty(h)),ii.clear().union(h.bounds)}else ii.clear();switch(ii.union(f.bounds),a){case o0:m=x,g=i.y1-ii.height()-l;break;case ha:m=i.x1-ii.width()-l,g=x;break;case ga:m=i.x2+ii.width()+l,g=x;break;case Qf:m=x,g=i.y2+l;break;default:m=s.x,g=s.y}return cm(s,"x",m)|cm(s,"y",g)&&(ii.translate(m,g),e.dirty(s),s.bounds.clear().union(ii),t.bounds.clear().union(ii),e.dirty(s)),s.bounds}function Ahe(e){he.call(this,null,e)}Go(Ahe,he,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(r=>{e.layout&&Cat(n,r,e.layout),Nat(n,r,e)}),Oat(e.mark.group)?t.reflow():t}});function Oat(e){return e&&e.mark.role!=="legend-entry"}function Nat(e,t,n){var r=t.items,i=Math.max(0,t.width||0),s=Math.max(0,t.height||0),o=new no().set(0,0,i,s),a=o.clone(),u=o.clone(),l=[],c,f,h,d,p,m;for(p=0,m=r.length;p<m;++p)switch(f=r[p],f.role){case I8:d=mat(f)?a:u,d.union(bat(e,f,i,s));break;case F8:c=f;break;case O8:l.push(Aat(e,f));break;case aat:case uat:case dhe:case phe:case ghe:case mhe:case yhe:case bhe:a.union(f.bounds),u.union(f.bounds);break;default:o.union(f.bounds)}if(l.length){const g={};l.forEach(y=>{h=y.orient||ga,h!==N8&&(g[h]||(g[h]=[])).push(y)});for(const y in g){const b=g[y];Ehe(e,b,Eat(b,y,n.legends,a,u,i,s))}l.forEach(y=>{const b=y.bounds;if(b.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=b,e.dirty(y)),n.autosize&&(n.autosize.type===vhe||n.autosize.type===xhe||n.autosize.type===whe))switch(y.orient){case ha:case ga:o.add(b.x1,0).add(b.x2,0);break;case o0:case Qf:o.add(0,b.y1).add(0,b.y2)}else o.union(b)})}o.union(a).union(u),c&&o.union(Fat(e,c,i,s,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),Mat(e,t,o,n)}function Mat(e,t,n,r){const i=r.autosize||{},s=i.type;if(e._autosize<1||!s)return;let o=e._width,a=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),d=Math.max(0,Math.ceil(n.y2-c));if(i.contains===lat){const p=e.padding();o-=p.left+p.right,a-=p.top+p.bottom}s===N8?(l=0,f=0,u=o,c=a):s===vhe?(u=Math.max(0,o-l-h),c=Math.max(0,a-f-d)):s===xhe?(u=Math.max(0,o-l-h),a=c+f+d):s===whe?(o=u+l+h,c=Math.max(0,a-f-d)):s===fat&&(o=u+l+h,a=c+f+d),e._resizeView(o,a,u,c,[l,f],i.resize)}const Rat=Object.freeze(Object.defineProperty({__proto__:null,bound:Che,identifier:R8,mark:She,overlap:_he,render:khe,viewlayout:Ahe},Symbol.toStringTag,{value:"Module"}));function Zu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Th(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const iP=Symbol("implicit");function P8(){var e=new Map,t=[],n=[],r=iP;function i(s){var o=s+"",a=e.get(o);if(!a){if(r!==iP)return r;e.set(o,a=t.push(s))}return n[(a-1)%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Map;for(const o of s){const a=o+"";e.has(a)||e.set(a,t.push(o))}return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return P8(t,n).unknown(r)},Zu.apply(i,arguments),i}function The(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function Dhe(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return The((n-r/t)*t,o,i,s,a)}}function Ihe(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return The((n-r/t)*t,i,s,o,a)}}const DI=e=>()=>e;function Fhe(e,t){return function(n){return e+n*t}}function Pat(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function II(e,t){var n=t-e;return n?Fhe(e,n>180||n<-180?n-360*Math.round(n/360):n):DI(isNaN(e)?t:e)}function Lat(e){return(e=+e)==1?$r:function(t,n){return n-t?Pat(t,n,e):DI(isNaN(t)?n:t)}}function $r(e,t){var n=t-e;return n?Fhe(e,n):DI(isNaN(e)?t:e)}const sP=function e(t){var n=Lat(t);function r(i,s){var o=n((i=As(i)).r,(s=As(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=$r(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function Ohe(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=As(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var Bat=Ohe(Dhe),zat=Ohe(Ihe);function L8(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function Nhe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function jat(e,t){return(Nhe(t)?L8:Mhe)(e,t)}function Mhe(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Dh(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function Rhe(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function la(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Phe(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Dh(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var oP=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ZN=new RegExp(oP.source,"g");function Uat(e){return function(){return e}}function Wat(e){return function(t){return e(t)+""}}function Lhe(e,t){var n=oP.lastIndex=ZN.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=oP.exec(e))&&(i=ZN.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:la(r,i)})),n=ZN.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?Wat(u[0].x):Uat(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Dh(e,t){var n=typeof t,r;return t==null||n==="boolean"?DI(t):(n==="number"?la:n==="string"?(r=ic(t))?(t=r,sP):Lhe:t instanceof ic?sP:t instanceof Date?Rhe:Nhe(t)?L8:Array.isArray(t)?Mhe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Phe:la)(e,t)}function Vat(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function Gat(e,t){var n=II(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function uC(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var uX=180/Math.PI,aP={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Bhe(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*uX,skewX:Math.atan(u)*uX,scaleX:o,scaleY:a}}var GS;function Hat(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?aP:Bhe(t.a,t.b,t.c,t.d,t.e,t.f)}function qat(e){return e==null||(GS||(GS=document.createElementNS("http://www.w3.org/2000/svg","g")),GS.setAttribute("transform",e),!(e=GS.transform.baseVal.consolidate()))?aP:(e=e.matrix,Bhe(e.a,e.b,e.c,e.d,e.e,e.f))}function zhe(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var m=d.push("translate(",null,t,null,n);p.push({i:m-4,x:la(l,f)},{i:m-2,x:la(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:la(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:la(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var m=d.push(i(d)+"scale(",null,",",null,")");p.push({i:m-4,x:la(l,f)},{i:m-2,x:la(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,m=h.length,g;++p<m;)f[(g=h[p]).i]=g.x(d);return f.join("")}}}var Xat=zhe(Hat,"px, ","px)","deg)"),Yat=zhe(qat,", ",")",")"),Kat=1e-12;function lX(e){return((e=Math.exp(e))+1/e)/2}function Zat(e){return((e=Math.exp(e))-1/e)/2}function Jat(e){return((e=Math.exp(2*e))-1)/(e+1)}const Qat=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,m=d*d+p*p,g,y;if(m<Kat)y=Math.log(h/l)/t,g=function(S){return[a+S*d,u+S*p,l*Math.exp(t*S*y)]};else{var b=Math.sqrt(m),x=(h*h-l*l+r*m)/(2*l*n*b),v=(h*h-l*l-r*m)/(2*h*n*b),w=Math.log(Math.sqrt(x*x+1)-x),C=Math.log(Math.sqrt(v*v+1)-v);y=(C-w)/t,g=function(S){var _=S*y,$=lX(w),k=l/(n*b)*($*Jat(t*_+w)-Zat(w));return[a+k*d,u+k*p,l*$/lX(t*_+w)]}}return g.duration=y*1e3*t/Math.SQRT2,g}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function jhe(e){return function(t,n){var r=e((t=qf(t)).h,(n=qf(n)).h),i=$r(t.s,n.s),s=$r(t.l,n.l),o=$r(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const eut=jhe(II);var tut=jhe($r);function nut(e,t){var n=$r((e=Xf(e)).l,(t=Xf(t)).l),r=$r(e.a,t.a),i=$r(e.b,t.b),s=$r(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function Uhe(e){return function(t,n){var r=e((t=Yf(t)).h,(n=Yf(n)).h),i=$r(t.c,n.c),s=$r(t.l,n.l),o=$r(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const rut=Uhe(II);var iut=Uhe($r);function Whe(e){return function t(n){n=+n;function r(i,s){var o=e((i=Cp(i)).h,(s=Cp(s)).h),a=$r(i.s,s.s),u=$r(i.l,s.l),l=$r(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const sut=Whe(II);var out=Whe($r);function B8(e,t){t===void 0&&(t=e,e=Dh);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function aut(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const uut=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Dh,interpolateArray:jat,interpolateBasis:Dhe,interpolateBasisClosed:Ihe,interpolateCubehelix:sut,interpolateCubehelixLong:out,interpolateDate:Rhe,interpolateDiscrete:Vat,interpolateHcl:rut,interpolateHclLong:iut,interpolateHsl:eut,interpolateHslLong:tut,interpolateHue:Gat,interpolateLab:nut,interpolateNumber:la,interpolateNumberArray:L8,interpolateObject:Phe,interpolateRgb:sP,interpolateRgbBasis:Bat,interpolateRgbBasisClosed:zat,interpolateRound:uC,interpolateString:Lhe,interpolateTransformCss:Xat,interpolateTransformSvg:Yat,interpolateZoom:Qat,piecewise:B8,quantize:aut},Symbol.toStringTag,{value:"Module"}));function lut(e){return function(){return e}}function uP(e){return+e}var cX=[0,1];function vs(e){return e}function lP(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:lut(isNaN(t)?NaN:.5)}function cut(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function fut(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=lP(i,r),s=n(o,s)):(r=lP(r,i),s=n(s,o)),function(a){return s(r(a))}}function hut(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=lP(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=Gw(e,a,1,r)-1;return s[u](i[u](a))}}function lC(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function FI(){var e=cX,t=cX,n=Dh,r,i,s,o=vs,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==vs&&(o=cut(e[0],e[h-1])),a=h>2?hut:fut,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),la)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,uP),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=uC,c()},f.clamp=function(h){return arguments.length?(o=h?!0:vs,c()):o!==vs},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function Vhe(){return FI()(vs,vs)}function Nk(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function a0(e){return e=Nk(Math.abs(e)),e?e[1]:NaN}function dut(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function put(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var gut=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function kp(e){return new z8(e)}kp.prototype=z8.prototype;function z8(e){if(!(t=gut.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}z8.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function mut(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(r>0){if(!+e[n])break e;r=0}break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Ghe;function yut(e,t){var n=Nk(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Ghe=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Nk(e,Math.max(0,t+s-1))[0]}function fX(e,t){var n=Nk(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const hX={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return fX(e*100,t)},r:fX,s:yut,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function dX(e){return e}var pX=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Hhe(e){var t=e.grouping&&e.thousands?dut(e.grouping,e.thousands):dX,n=e.currency,r=e.decimal,i=e.numerals?put(e.numerals):dX,s=e.percent||"%";function o(u){u=kp(u);var l=u.fill,c=u.align,f=u.sign,h=u.symbol,d=u.zero,p=u.width,m=u.comma,g=u.precision,y=u.trim,b=u.type;b==="n"?(m=!0,b="g"):hX[b]||(g==null&&(g=12),y=!0,b="g"),(d||l==="0"&&c==="=")&&(d=!0,l="0",c="=");var x=h==="$"?n[0]:h==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",v=h==="$"?n[1]:/[%p]/.test(b)?s:"",w=hX[b],C=/[defgprs%]/.test(b);g=g==null?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g));function S(_){var $=x,k=v,E,F,T;if(b==="c")k=w(_)+k,_="";else{_=+_;var I=_<0;if(_=w(Math.abs(_),g),y&&(_=mut(_)),I&&+_==0&&(I=!1),$=(I?f==="("?f:"-":f==="-"||f==="("?"":f)+$,k=(b==="s"?pX[8+Ghe/3]:"")+k+(I&&f==="("?")":""),C){for(E=-1,F=_.length;++E<F;)if(T=_.charCodeAt(E),48>T||T>57){k=(T===46?r+_.slice(E+1):_.slice(E))+k,_=_.slice(0,E);break}}}m&&!d&&(_=t(_,1/0));var D=$.length+_.length+k.length,N=D<p?new Array(p-D+1).join(l):"";switch(m&&d&&(_=t(N+_,N.length?p-k.length:1/0),N=""),c){case"<":_=$+_+k+N;break;case"=":_=$+N+_+k;break;case"^":_=N.slice(0,D=N.length>>1)+$+_+k+N.slice(D);break;default:_=N+$+_+k;break}return i(_)}return S.toString=function(){return u+""},S}function a(u,l){var c=o((u=kp(u),u.type="f",u)),f=Math.max(-8,Math.min(8,Math.floor(a0(l)/3)))*3,h=Math.pow(10,-f),d=pX[8+f/3];return function(p){return c(h*p)+d}}return{format:o,formatPrefix:a}}var HS,sy,OI;qhe({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function qhe(e){return HS=Hhe(e),sy=HS.format,OI=HS.formatPrefix,HS}function j8(e){return Math.max(0,-a0(Math.abs(e)))}function U8(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(a0(t)/3)))*3-a0(Math.abs(e)))}function W8(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,a0(t)-a0(e))+1}const but=Object.freeze(Object.defineProperty({__proto__:null,get format(){return sy},formatDefaultLocale:qhe,formatLocale:Hhe,get formatPrefix(){return OI},formatSpecifier:kp,precisionFixed:j8,precisionPrefix:U8,precisionRound:W8},Symbol.toStringTag,{value:"Module"}));function Xhe(e,t,n,r){var i=Uf(e,t,n),s;switch(r=kp(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=U8(i,o))&&(r.precision=s),OI(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=W8(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=j8(i))&&(r.precision=s-(r.type==="%")*2);break}}return sy(r)}function bg(e){var t=e.domain;return e.ticks=function(n){var r=t();return $R(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return Xhe(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=Aue(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function Yhe(){var e=Vhe();return e.copy=function(){return lC(e,Yhe())},Zu.apply(e,arguments),bg(e)}function Khe(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,uP),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return Khe(e).unknown(t)},e=arguments.length?Array.from(e,uP):[0,1],bg(n)}function Zhe(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function gX(e){return Math.log(e)}function mX(e){return Math.exp(e)}function vut(e){return-Math.log(-e)}function xut(e){return-Math.exp(-e)}function wut(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Cut(e){return e===10?wut:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function Sut(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function yX(e){return function(t){return-e(-t)}}function V8(e){var t=e(gX,mX),n=t.domain,r=10,i,s;function o(){return i=Sut(r),s=Cut(r),n()[0]<0?(i=yX(i),s=yX(s),e(vut,xut)):e(gX,mX),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=function(a){var u=n(),l=u[0],c=u[u.length-1],f;(f=c<l)&&(h=l,l=c,c=h);var h=i(l),d=i(c),p,m,g,y=a==null?10:+a,b=[];if(!(r%1)&&d-h<y){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(m=1,p=s(h);m<r;++m)if(g=p*m,!(g<l)){if(g>c)break;b.push(g)}}else for(;h<=d;++h)for(m=r-1,p=s(h);m>=1;--m)if(g=p*m,!(g<l)){if(g>c)break;b.push(g)}b.length*2<y&&(b=$R(l,c,y))}else b=$R(h,d,Math.min(d-h,y)).map(s);return f?b.reverse():b},t.tickFormat=function(a,u){if(u==null&&(u=r===10?".0e":","),typeof u!="function"&&(u=sy(u)),a===1/0)return u;a==null&&(a=10);var l=Math.max(1,r*a/t.ticks().length);return function(c){var f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=function(){return n(Zhe(n(),{floor:function(a){return s(Math.floor(i(a)))},ceil:function(a){return s(Math.ceil(i(a)))}}))},t}function Jhe(){var e=V8(FI()).domain([1,10]);return e.copy=function(){return lC(e,Jhe()).base(e.base())},Zu.apply(e,arguments),e}function bX(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function vX(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function G8(e){var t=1,n=e(bX(t),vX(t));return n.constant=function(r){return arguments.length?e(bX(t=+r),vX(t)):t},bg(n)}function Qhe(){var e=G8(FI());return e.copy=function(){return lC(e,Qhe()).constant(e.constant())},Zu.apply(e,arguments)}function xX(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function _ut(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function $ut(e){return e<0?-e*e:e*e}function H8(e){var t=e(vs,vs),n=1;function r(){return n===1?e(vs,vs):n===.5?e(_ut,$ut):e(xX(n),xX(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},bg(t)}function q8(){var e=H8(FI());return e.copy=function(){return lC(e,q8()).exponent(e.exponent())},Zu.apply(e,arguments),e}function kut(){return q8.apply(null,arguments).exponent(.5)}function ede(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=Due(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[Gw(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Y1),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return ede().domain(e).range(t).unknown(r)},Zu.apply(s,arguments)}function tde(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[Gw(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return tde().domain([e,t]).range(i).unknown(s)},Zu.apply(bg(o),arguments)}function nde(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[Gw(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return nde().domain(e).range(t).unknown(n)},Zu.apply(i,arguments)}function JN(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function QN(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Yy(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function rde(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=Ky(i),c=Zy(i),f=Ky(s),h=Zy(s),d=Ky(o),p=Zy(o),m=Ky(a),g=Zy(a),y=Ky(u),b=Zy(u),x={a:V,A:U,b:A,B:M,c:null,d:kX,e:kX,f:Yut,g:slt,G:alt,H:Hut,I:qut,j:Xut,L:ide,m:Kut,M:Zut,p:P,q:j,Q:TX,s:DX,S:Jut,u:Qut,U:elt,V:tlt,w:nlt,W:rlt,x:null,X:null,y:ilt,Y:olt,Z:ult,"%":AX},v={a:q,A:B,b:O,B:G,c:null,d:EX,e:EX,f:hlt,g:Clt,G:_lt,H:llt,I:clt,j:flt,L:ode,m:dlt,M:plt,p:Z,q:re,Q:TX,s:DX,S:glt,u:mlt,U:ylt,V:blt,w:vlt,W:xlt,x:null,X:null,y:wlt,Y:Slt,Z:$lt,"%":AX},w={a:k,A:E,b:F,B:T,c:I,d:_X,e:_X,f:Uut,g:SX,G:CX,H:$X,I:$X,j:Lut,L:jut,m:Put,M:But,p:$,q:Rut,Q:Vut,s:Gut,S:zut,u:Iut,U:Fut,V:Out,w:Dut,W:Nut,x:D,X:N,y:SX,Y:CX,Z:Mut,"%":Wut};x.x=C(n,x),x.X=C(r,x),x.c=C(t,x),v.x=C(n,v),v.X=C(r,v),v.c=C(t,v);function C(R,H){return function(Y){var L=[],te=-1,X=0,ie=R.length,se,oe,le;for(Y instanceof Date||(Y=new Date(+Y));++te<ie;)R.charCodeAt(te)===37&&(L.push(R.slice(X,te)),(oe=wX[se=R.charAt(++te)])!=null?se=R.charAt(++te):oe=se==="e"?" ":"0",(le=H[se])&&(se=le(Y,oe)),L.push(se),X=te+1);return L.push(R.slice(X,te)),L.join("")}}function S(R,H){return function(Y){var L=Yy(1900,void 0,1),te=_(L,R,Y+="",0),X,ie;if(te!=Y.length)return null;if("Q"in L)return new Date(L.Q);if("s"in L)return new Date(L.s*1e3+("L"in L?L.L:0));if(H&&!("Z"in L)&&(L.Z=0),"p"in L&&(L.H=L.H%12+L.p*12),L.m===void 0&&(L.m="q"in L?L.q:0),"V"in L){if(L.V<1||L.V>53)return null;"w"in L||(L.w=1),"Z"in L?(X=QN(Yy(L.y,0,1)),ie=X.getUTCDay(),X=ie>4||ie===0?ck.ceil(X):ck(X),X=bf.offset(X,(L.V-1)*7),L.y=X.getUTCFullYear(),L.m=X.getUTCMonth(),L.d=X.getUTCDate()+(L.w+6)%7):(X=JN(Yy(L.y,0,1)),ie=X.getDay(),X=ie>4||ie===0?uk.ceil(X):uk(X),X=yf.offset(X,(L.V-1)*7),L.y=X.getFullYear(),L.m=X.getMonth(),L.d=X.getDate()+(L.w+6)%7)}else("W"in L||"U"in L)&&("w"in L||(L.w="u"in L?L.u%7:"W"in L?1:0),ie="Z"in L?QN(Yy(L.y,0,1)).getUTCDay():JN(Yy(L.y,0,1)).getDay(),L.m=0,L.d="W"in L?(L.w+6)%7+L.W*7-(ie+5)%7:L.w+L.U*7-(ie+6)%7);return"Z"in L?(L.H+=L.Z/100|0,L.M+=L.Z%100,QN(L)):JN(L)}}function _(R,H,Y,L){for(var te=0,X=H.length,ie=Y.length,se,oe;te<X;){if(L>=ie)return-1;if(se=H.charCodeAt(te++),se===37){if(se=H.charAt(te++),oe=w[se in wX?H.charAt(te++):se],!oe||(L=oe(R,Y,L))<0)return-1}else if(se!=Y.charCodeAt(L++))return-1}return L}function $(R,H,Y){var L=l.exec(H.slice(Y));return L?(R.p=c.get(L[0].toLowerCase()),Y+L[0].length):-1}function k(R,H,Y){var L=d.exec(H.slice(Y));return L?(R.w=p.get(L[0].toLowerCase()),Y+L[0].length):-1}function E(R,H,Y){var L=f.exec(H.slice(Y));return L?(R.w=h.get(L[0].toLowerCase()),Y+L[0].length):-1}function F(R,H,Y){var L=y.exec(H.slice(Y));return L?(R.m=b.get(L[0].toLowerCase()),Y+L[0].length):-1}function T(R,H,Y){var L=m.exec(H.slice(Y));return L?(R.m=g.get(L[0].toLowerCase()),Y+L[0].length):-1}function I(R,H,Y){return _(R,t,H,Y)}function D(R,H,Y){return _(R,n,H,Y)}function N(R,H,Y){return _(R,r,H,Y)}function V(R){return o[R.getDay()]}function U(R){return s[R.getDay()]}function A(R){return u[R.getMonth()]}function M(R){return a[R.getMonth()]}function P(R){return i[+(R.getHours()>=12)]}function j(R){return 1+~~(R.getMonth()/3)}function q(R){return o[R.getUTCDay()]}function B(R){return s[R.getUTCDay()]}function O(R){return u[R.getUTCMonth()]}function G(R){return a[R.getUTCMonth()]}function Z(R){return i[+(R.getUTCHours()>=12)]}function re(R){return 1+~~(R.getUTCMonth()/3)}return{format:function(R){var H=C(R+="",x);return H.toString=function(){return R},H},parse:function(R){var H=S(R+="",!1);return H.toString=function(){return R},H},utcFormat:function(R){var H=C(R+="",v);return H.toString=function(){return R},H},utcParse:function(R){var H=S(R+="",!0);return H.toString=function(){return R},H}}}var wX={"-":"",_:" ",0:"0"},Ur=/^\s*\d+/,Eut=/^%/,Aut=/[\\^$*+?|[\]().{}]/g;function Lt(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function Tut(e){return e.replace(Aut,"\\$&")}function Ky(e){return new RegExp("^(?:"+e.map(Tut).join("|")+")","i")}function Zy(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function Dut(e,t,n){var r=Ur.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Iut(e,t,n){var r=Ur.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Fut(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Out(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Nut(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function CX(e,t,n){var r=Ur.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function SX(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Mut(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Rut(e,t,n){var r=Ur.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function Put(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function _X(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Lut(e,t,n){var r=Ur.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function $X(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function But(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function zut(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function jut(e,t,n){var r=Ur.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Uut(e,t,n){var r=Ur.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Wut(e,t,n){var r=Eut.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Vut(e,t,n){var r=Ur.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Gut(e,t,n){var r=Ur.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function kX(e,t){return Lt(e.getDate(),t,2)}function Hut(e,t){return Lt(e.getHours(),t,2)}function qut(e,t){return Lt(e.getHours()%12||12,t,2)}function Xut(e,t){return Lt(1+yf.count(Wf(e),e),t,3)}function ide(e,t){return Lt(e.getMilliseconds(),t,3)}function Yut(e,t){return ide(e,t)+"000"}function Kut(e,t){return Lt(e.getMonth()+1,t,2)}function Zut(e,t){return Lt(e.getMinutes(),t,2)}function Jut(e,t){return Lt(e.getSeconds(),t,2)}function Qut(e){var t=e.getDay();return t===0?7:t}function elt(e,t){return Lt(Z1.count(Wf(e)-1,e),t,2)}function sde(e){var t=e.getDay();return t>=4||t===0?Ym(e):Ym.ceil(e)}function tlt(e,t){return e=sde(e),Lt(Ym.count(Wf(e),e)+(Wf(e).getDay()===4),t,2)}function nlt(e){return e.getDay()}function rlt(e,t){return Lt(uk.count(Wf(e)-1,e),t,2)}function ilt(e,t){return Lt(e.getFullYear()%100,t,2)}function slt(e,t){return e=sde(e),Lt(e.getFullYear()%100,t,2)}function olt(e,t){return Lt(e.getFullYear()%1e4,t,4)}function alt(e,t){var n=e.getDay();return e=n>=4||n===0?Ym(e):Ym.ceil(e),Lt(e.getFullYear()%1e4,t,4)}function ult(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Lt(t/60|0,"0",2)+Lt(t%60,"0",2)}function EX(e,t){return Lt(e.getUTCDate(),t,2)}function llt(e,t){return Lt(e.getUTCHours(),t,2)}function clt(e,t){return Lt(e.getUTCHours()%12||12,t,2)}function flt(e,t){return Lt(1+bf.count(Vf(e),e),t,3)}function ode(e,t){return Lt(e.getUTCMilliseconds(),t,3)}function hlt(e,t){return ode(e,t)+"000"}function dlt(e,t){return Lt(e.getUTCMonth()+1,t,2)}function plt(e,t){return Lt(e.getUTCMinutes(),t,2)}function glt(e,t){return Lt(e.getUTCSeconds(),t,2)}function mlt(e){var t=e.getUTCDay();return t===0?7:t}function ylt(e,t){return Lt(J1.count(Vf(e)-1,e),t,2)}function ade(e){var t=e.getUTCDay();return t>=4||t===0?Km(e):Km.ceil(e)}function blt(e,t){return e=ade(e),Lt(Km.count(Vf(e),e)+(Vf(e).getUTCDay()===4),t,2)}function vlt(e){return e.getUTCDay()}function xlt(e,t){return Lt(ck.count(Vf(e)-1,e),t,2)}function wlt(e,t){return Lt(e.getUTCFullYear()%100,t,2)}function Clt(e,t){return e=ade(e),Lt(e.getUTCFullYear()%100,t,2)}function Slt(e,t){return Lt(e.getUTCFullYear()%1e4,t,4)}function _lt(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Km(e):Km.ceil(e),Lt(e.getUTCFullYear()%1e4,t,4)}function $lt(){return"+0000"}function AX(){return"%"}function TX(e){return+e}function DX(e){return Math.floor(+e/1e3)}var Kg,NI,ude,MI,lde;klt({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function klt(e){return Kg=rde(e),NI=Kg.format,ude=Kg.parse,MI=Kg.utcFormat,lde=Kg.utcParse,Kg}function Elt(e){return new Date(e)}function Alt(e){return e instanceof Date?+e:+new Date(+e)}function X8(e,t,n,r,i,s,o,a,u,l){var c=Vhe(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),m=l("%I:%M"),g=l("%I %p"),y=l("%a %d"),b=l("%b %d"),x=l("%B"),v=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?m:s(C)<C?g:r(C)<C?i(C)<C?y:b:n(C)<C?x:v)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,Alt)):h().map(Elt)},c.ticks=function(C){var S=h();return e(S[0],S[S.length-1],C??10)},c.tickFormat=function(C,S){return S==null?w:l(S)},c.nice=function(C){var S=h();return(!C||typeof C.range!="function")&&(C=t(S[0],S[S.length-1],C??10)),C?h(Zhe(S,C)):c},c.copy=function(){return lC(c,X8(e,t,n,r,i,s,o,a,u,l))},c}function Tlt(){return Zu.apply(X8(GJe,HJe,Wf,lk,Z1,yf,Xz,qz,Kc,NI).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Dlt(){return Zu.apply(X8(WJe,VJe,Vf,fk,J1,bf,Zz,Kz,Kc,MI).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function RI(){var e=0,t=1,n,r,i,s,o=vs,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(Dh),l.rangeRound=c(uC),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Ih(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Y8(){var e=bg(RI()(vs));return e.copy=function(){return Ih(e,Y8())},Th.apply(e,arguments)}function cde(){var e=V8(RI()).domain([1,10]);return e.copy=function(){return Ih(e,cde()).base(e.base())},Th.apply(e,arguments)}function fde(){var e=G8(RI());return e.copy=function(){return Ih(e,fde()).constant(e.constant())},Th.apply(e,arguments)}function K8(){var e=H8(RI());return e.copy=function(){return Ih(e,K8()).exponent(e.exponent())},Th.apply(e,arguments)}function Ilt(){return K8.apply(null,arguments).exponent(.5)}function PI(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=vs,c,f=!1,h;function d(m){return isNaN(m=+m)?h:(m=.5+((m=+c(m))-s)*(r*m<r*s?a:u),l(f?Math.max(0,Math.min(1,m)):m))}d.domain=function(m){return arguments.length?([e,t,n]=m,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(m){return arguments.length?(f=!!m,d):f},d.interpolator=function(m){return arguments.length?(l=m,d):l};function p(m){return function(g){var y,b,x;return arguments.length?([y,b,x]=g,l=B8(m,[y,b,x]),d):[l(0),l(.5),l(1)]}}return d.range=p(Dh),d.rangeRound=p(uC),d.unknown=function(m){return arguments.length?(h=m,d):h},function(m){return c=m,i=m(e),s=m(t),o=m(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function hde(){var e=bg(PI()(vs));return e.copy=function(){return Ih(e,hde())},Th.apply(e,arguments)}function dde(){var e=V8(PI()).domain([.1,1,10]);return e.copy=function(){return Ih(e,dde()).base(e.base())},Th.apply(e,arguments)}function pde(){var e=G8(PI());return e.copy=function(){return Ih(e,pde()).constant(e.constant())},Th.apply(e,arguments)}function Z8(){var e=H8(PI());return e.copy=function(){return Ih(e,Z8()).exponent(e.exponent())},Th.apply(e,arguments)}function Flt(){return Z8.apply(null,arguments).exponent(.5)}function J8(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const Olt="identity",u0="linear",sc="log",cC="pow",fC="sqrt",LI="symlog",Ep="time",Ap="utc",_u="sequential",oy="diverging",l0="quantile",BI="quantize",zI="threshold",Q8="ordinal",cP="point",gde="band",e7="bin-ordinal",xr="continuous",hC="discrete",dC="discretizing",Ho="interpolating",t7="temporal";function Nlt(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function Mlt(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function n7(){const e=P8().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=J8(f,a,u);let m=r[h-0];i=(d-m)/(p||1),o&&(i=Math.floor(i)),m+=(d-m-i*(f-a))*l,s=i*(1-a),o&&(m=Math.round(m),s=Math.round(s));const g=qs(f).map(y=>m+i*y);return n(h?g.reverse():g)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let m=+f[0],g=+f[1],y,b,x;if(!(m!==m||g!==g)&&(g<m&&(x=m,m=g,g=x),!(g<d[0]||m>r[1-h])))return y=Math.max(0,ok(d,m)-1),b=m===g?y:ok(d,g)-1,m-d[y]>s+1e-10&&++y,h&&(x=y,y=p-b,b=p-x),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return n7().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function mde(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return mde(t())},e}function Rlt(){return mde(n7().paddingInner(1))}var Plt=Array.prototype.map;function Llt(e){return Plt.call(e,Pf)}const Blt=Array.prototype.slice;function yde(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(Gw(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=Llt(r),n):e.slice()},n.range=function(r){return arguments.length?(t=Blt.call(r),n):t.slice()},n.tickFormat=function(r,i){return Xhe(e[0],en(e),r??10,i)},n.copy=function(){return yde().domain(n.domain()).range(n.range())},n}const Mk={};function zlt(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?Nlt(s):s.invertExtent?Mlt(s):void 0),s.type=e,s};return r.metadata=nc(at(n)),r}function jt(e,t,n){return arguments.length>1?(Mk[e]=zlt(e,t,n),this):bde(e)?Mk[e]:void 0}jt(Olt,Khe);jt(u0,Yhe,xr);jt(sc,Jhe,[xr,sc]);jt(cC,q8,xr);jt(fC,kut,xr);jt(LI,Qhe,xr);jt(Ep,Tlt,[xr,t7]);jt(Ap,Dlt,[xr,t7]);jt(_u,Y8,[xr,Ho]);jt("".concat(_u,"-").concat(u0),Y8,[xr,Ho]);jt("".concat(_u,"-").concat(sc),cde,[xr,Ho,sc]);jt("".concat(_u,"-").concat(cC),K8,[xr,Ho]);jt("".concat(_u,"-").concat(fC),Ilt,[xr,Ho]);jt("".concat(_u,"-").concat(LI),fde,[xr,Ho]);jt("".concat(oy,"-").concat(u0),hde,[xr,Ho]);jt("".concat(oy,"-").concat(sc),dde,[xr,Ho,sc]);jt("".concat(oy,"-").concat(cC),Z8,[xr,Ho]);jt("".concat(oy,"-").concat(fC),Flt,[xr,Ho]);jt("".concat(oy,"-").concat(LI),pde,[xr,Ho]);jt(l0,ede,[dC,l0]);jt(BI,tde,dC);jt(zI,nde,dC);jt(e7,yde,[hC,dC]);jt(Q8,P8,hC);jt(gde,n7,hC);jt(cP,Rlt,hC);function bde(e){return lt(Mk,e)}function vg(e,t){const n=Mk[e];return n&&n.metadata[t]}function r7(e){return vg(e,xr)}function c0(e){return vg(e,hC)}function fP(e){return vg(e,dC)}function vde(e){return vg(e,sc)}function jlt(e){return vg(e,t7)}function xde(e){return vg(e,Ho)}function wde(e){return vg(e,l0)}const Ult=["clamp","base","constant","exponent"];function Cde(e,t){const n=t[0],r=en(t)-n;return function(i){return e(n+i*r)}}function jI(e,t,n){return B8(i7(t||"rgb",n),e)}function Sde(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function _de(e,t,n){const r=n-t;let i,s,o;return!r||!Number.isFinite(r)?No(.5):(i=(s=e.type).indexOf("-"),s=i<0?s:s.slice(i+1),o=jt(s)().domain([t,n]).range([0,1]),Ult.forEach(a=>e[a]?o[a](e[a]()):0),o)}function i7(e,t){const n=uut[Wlt(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function Wlt(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const Vlt={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},Glt={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function $de(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function kde(e,t){for(const n in e)s7(n,t(e[n]))}const IX={};kde(Glt,$de);kde(Vlt,e=>jI($de(e)));function s7(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(IX[e]=t,this):IX[e]}const W_="symbol",Hlt="discrete",qlt="gradient",Xlt=e=>ht(e)?e.map(t=>String(t)):String(e),Ylt=(e,t)=>e[1]-t[1],Klt=(e,t)=>t[1]-e[1];function o7(e,t,n){let r;return bp(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(LD(e.domain())/n||1)))),wt(t)&&(r=t.step,t=t.interval),wn(t)&&(t=e.type===Ep?Q1(t):e.type==Ap?ey(t):ye("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function Ede(e,t,n){let r=e.range(),i=r[0],s=en(r),o=Ylt;if(i>s&&(r=s,s=i,i=r,o=Klt),i=Math.floor(i),s=Math.ceil(s),t=t.map(a=>[a,e(a)]).filter(a=>i<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],en(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function a7(e,t){return e.bins?Ede(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Ade(e,t,n,r,i,s){const o=t.type;let a=Xlt;if(o===Ep||i===Ep)a=e.timeFormat(r);else if(o===Ap||i===Ap)a=e.utcFormat(r);else if(vde(o)){const u=e.formatFloat(r);if(s||t.bins)a=u;else{const l=Tde(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,r)}else r&&(a=e.format(r));return a}function Tde(e,t,n){const r=a7(e,t),i=e.base(),s=Math.log(i),o=Math.max(1,i*t/r.length),a=u=>{let l=u/Math.pow(i,Math.round(Math.log(u)/s));return l*i<i-.5&&(l*=i),l<=o};return n?r.filter(a):a}const hP={[l0]:"quantiles",[BI]:"thresholds",[zI]:"domain"},Dde={[l0]:"quantiles",[BI]:"domain"};function Ide(e,t){return e.bins?Qlt(e.bins):e.type===sc?Tde(e,t,!0):hP[e.type]?Jlt(e[hP[e.type]]()):a7(e,t)}function Zlt(e,t,n){const r=t[Dde[t.type]](),i=r.length;let s=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o)s=Math.min(s,r[o]-r[o-1]);return e.formatSpan(0,s,3*10,n)}function Jlt(e){const t=[-1/0].concat(e);return t.max=1/0,t}function Qlt(e){const t=e.slice(0,-1);return t.max=en(e),t}const ect=e=>hP[e.type]||e.bins;function Fde(e,t,n,r,i,s,o){const a=Dde[t.type]&&s!==Ep&&s!==Ap?Zlt(e,t,i):Ade(e,t,n,i,s,o);return r===W_&&ect(t)?tct(a):r===Hlt?nct(a):rct(a)}const tct=e=>(t,n,r)=>{const i=FX(r[n+1],FX(r.max,1/0)),s=OX(t,e),o=OX(i,e);return s&&o?s+"  "+o:o?"< "+o:" "+s},FX=(e,t)=>e??t,nct=e=>(t,n)=>n?e(t):null,rct=e=>t=>e(t),OX=(e,t)=>Number.isFinite(e)?t(e):null;function ict(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+en(t),s=i-r;if(e.type===zI){const o=n?s/n:.1;r-=o,i+=o,s=i-r}return o=>(o-r)/s}function sct(e,t,n,r){const i=r||t.type;return wn(n)&&jlt(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&i===Ep?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===Ap?e.utcFormat("%A, %d %B %Y, %X UTC"):Fde(e,t,5,null,n,r,!0)}function Ode(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=sct(e,t,n.format,n.formatType);if(fP(t.type)){const s=Ide(t).slice(1).map(i),o=s.length;return"".concat(o," boundar").concat(o===1?"y":"ies",": ").concat(s.join(", "))}else if(c0(t.type)){const s=t.domain(),o=s.length,a=o>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return"".concat(o," value").concat(o===1?"":"s",": ").concat(a)}else{const s=t.domain();return"values from ".concat(i(s[0])," to ").concat(i(en(s)))}}function Nde(e){he.call(this,null,e)}$e(Nde,he,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,a=o7(s,o,e.minstep),u=e.format||Ade(n,s,a,e.formatSpecifier,e.formatType,!!e.values),l=e.values?Ede(s,e.values,a):a7(s,a);return i&&(r.rem=i),i=l.map((c,f)=>zt({index:f/(l.length-1||1),value:c,label:u(c)})),e.extra&&i.length&&i.push(zt({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}});function Mde(e){he.call(this,null,e)}function oct(){return zt({})}function act(e){const t=H1().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}$e(Mde,he,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||oct,s=e.key||Ve,o=this.value;return ht(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(s))&&ye("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=act(s)),t.visit(t.ADD,a=>{const u=s(a);let l=o.get(u);l?l.exit?(o.empty--,r.add.push(l)):r.mod.push(l):(l=i(a),o.set(u,l),r.add.push(l)),l.datum=a,l.exit=!1}),t.visit(t.MOD,a=>{const u=s(a),l=o.get(u);l&&(l.datum=a,r.mod.push(l))}),t.visit(t.REM,a=>{const u=s(a),l=o.get(u);a===l.datum&&!l.exit&&(r.rem.push(l),l.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}});function Rde(e){he.call(this,null,e)}$e(Rde,he,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,s=t.encode;if(ht(s))if(n.changed()||s.every(f=>i[f]))s=s[0],n.encode=null;else return t.StopPropagation;var o=s==="enter",a=i.update||Mc,u=i.enter||Mc,l=i.exit||Mc,c=(s&&!o?i[s]:a)||Mc;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{u(f,e),a(f,e)}),n.modifies(u.output),n.modifies(a.output),c!==Mc&&c!==a&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&l!==Mc&&(t.visit(t.REM,f=>{l(f,e)}),n.modifies(l.output)),o||c!==Mc){const f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,h=>{const d=u(h,e)||r;(c(h,e)||d)&&n.mod.push(h)}),n.mod.length&&n.modifies(u.output)):t.visit(f,h=>{(c(h,e)||r)&&n.mod.push(h)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function Pde(e){he.call(this,[],e)}$e(Pde,he,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.type||W_,o=e.scale,a=+e.limit,u=o7(o,e.count==null?5:e.count,e.minstep),l=!!e.values||s===W_,c=e.format||Fde(n,o,u,s,e.formatSpecifier,e.formatType,l),f=e.values||Ide(o,u),h,d,p,m,g;return i&&(r.rem=i),s===W_?(a&&f.length>a?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),i=f.slice(0,a-1),g=!0):i=f,Ht(p=e.size)?(!e.values&&o(i[0])===0&&(i=i.slice(1)),m=i.reduce((y,b)=>Math.max(y,p(b,e)),0)):p=No(m=p||8),i=i.map((y,b)=>zt({index:b,label:c(y,b,i),value:y,offset:m,size:p(y,e)})),g&&(g=f[i.length],i.push(zt({index:i.length,label:"".concat(f.length-i.length," entries"),value:g,offset:m,size:p(g,e)})))):s===qlt?(h=o.domain(),d=_de(o,h[0],en(h)),f.length<3&&!e.values&&h[0]!==en(h)&&(f=[h[0],en(h)]),i=f.map((y,b)=>zt({index:b,label:c(y,b,f),value:y,perc:d(y)}))):(p=f.length-1,d=ict(o),i=f.map((y,b)=>zt({index:b,label:c(y,b,f),value:y,perc:b?d(y):0,perc2:b===p?1:d(f[b+1])}))),r.source=i,r.add=i,this.value=i,r}});const uct=e=>e.source.x,lct=e=>e.source.y,cct=e=>e.target.x,fct=e=>e.target.y;function u7(e){he.call(this,{},e)}u7.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};$e(u7,he,{transform(e,t){var n=e.sourceX||uct,r=e.sourceY||lct,i=e.targetX||cct,s=e.targetY||fct,o=e.as||"path",a=e.orient||"vertical",u=e.shape||"line",l=NX.get(u+"-"+a)||NX.get(u);return l||ye("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[o]=l(n(c),r(c),i(c),s(c))}),t.reflow(e.modified()).modifies(o)}});const Lde=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,hct=(e,t,n,r)=>Lde(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),Bde=(e,t,n,r)=>{var i=n-e,s=r-t,o=Math.sqrt(i*i+s*s)/2,a=180*Math.atan2(s,i)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+a+" 0 1 "+n+","+r},dct=(e,t,n,r)=>Bde(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),zde=(e,t,n,r)=>{const i=n-e,s=r-t,o=.2*(i+s),a=.2*(s-i);return"M"+e+","+t+"C"+(e+o)+","+(t+a)+" "+(n+a)+","+(r-o)+" "+n+","+r},pct=(e,t,n,r)=>zde(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),gct=(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,mct=(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,yct=(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),o=Math.cos(n),a=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*i+","+t*s+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*o+","+t*a+"L"+r*o+","+r*a},bct=(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},vct=(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},xct=(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),o=Math.cos(n),a=Math.sin(n),u=(t+r)/2;return"M"+t*i+","+t*s+"C"+u*i+","+u*s+" "+u*o+","+u*a+" "+r*o+","+r*a},NX=H1({line:Lde,"line-radial":hct,arc:Bde,"arc-radial":dct,curve:zde,"curve-radial":pct,"orthogonal-horizontal":gct,"orthogonal-vertical":mct,"orthogonal-radial":yct,"diagonal-horizontal":bct,"diagonal-vertical":vct,"diagonal-radial":xct});function l7(e){he.call(this,null,e)}l7.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};$e(l7,he,{transform(e,t){var n=e.as||["startAngle","endAngle"],r=n[0],i=n[1],s=e.field||V1,o=e.startAngle||0,a=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(s),c=l.length,f=o,h=(a-o)/Oue(l),d=qs(c),p,m,g;for(e.sort&&d.sort((y,b)=>l[y]-l[b]),p=0;p<c;++p)g=l[d[p]],m=u[d[p]],m[r]=f,m[i]=f+=g*h;return this.value=l,t.reflow(e.modified()).modifies(n)}});const wct=5;function Cct(e){const t=e.type;return!e.bins&&(t===u0||t===cC||t===fC)}function jde(e){return r7(e)&&e!==_u}const Sct=nc(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Ude(e){he.call(this,null,e),this.modified(!0)}$e(Ude,he,{transform(e,t){var n=t.dataflow,r=this.value,i=_ct(e);(!r||i!==r.type)&&(this.value=r=jt(i)());for(i in e)if(!Sct[i]){if(i==="padding"&&jde(r.type))continue;Ht(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return Dct(r,e,Tct(r,e,kct(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function _ct(e){var t=e.type,n="",r;return t===_u?_u+"-"+u0:($ct(e)&&(r=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=r===2?_u+"-":r===3?oy+"-":""),(n+t||u0).toLowerCase())}function $ct(e){const t=e.type;return r7(t)&&t!==Ep&&t!==Ap&&(e.scheme||e.range&&e.range.length&&e.range.every(wn))}function kct(e,t,n){const r=Ect(e,t.domainRaw,n);if(r>-1)return r;var i=t.domain,s=e.type,o=t.zero||t.zero===void 0&&Cct(e),a,u;if(!i)return 0;if(jde(s)&&t.padding&&i[0]!==en(i)&&(i=Act(s,i,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(a=(i=i.slice()).length-1||1,o&&(i[0]>0&&(i[0]=0),i[a]<0&&(i[a]=0)),t.domainMin!=null&&(i[0]=t.domainMin),t.domainMax!=null&&(i[a]=t.domainMax),t.domainMid!=null)){u=t.domainMid;const l=u>i[a]?a+1:u<i[0]?0:a;l!==a&&n.warn("Scale domainMid exceeds domain min or max.",u),i.splice(l,0,u)}return e.domain(Wde(s,i,n)),s===Q8&&e.unknown(t.domainImplicit?iP:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&o7(e,t.nice)||null),i.length}function Ect(e,t,n){return t?(e.domain(Wde(e.type,t,n)),t.length):-1}function Act(e,t,n,r,i,s){var o=Math.abs(en(n)-n[0]),a=o/(o-2*r),u=e===sc?$ae(t,null,a):e===fC?dR(t,null,a,.5):e===cC?dR(t,null,a,i||1):e===LI?kae(t,null,a,s||1):_ae(t,null,a);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function Wde(e,t,n){if(vde(e)){var r=Math.abs(t.reduce((i,s)=>i+(s<0?-1:s>0?1:0),0));r!==t.length&&n.warn("Log scale domain includes zero: "+Qe(t))}return t}function Tct(e,t,n){let r=t.bins;if(r&&!ht(r)){const i=e.domain(),s=i[0],o=en(i),a=r.step;let u=r.start==null?s:r.start,l=r.stop==null?o:r.stop;a||ye("Scale bins parameter missing step property."),u<s&&(u=a*Math.ceil(s/a)),l>o&&(l=a*Math.floor(o/a)),r=qs(u,l+a/2,a)}return r?e.bins=r:e.bins&&delete e.bins,e.type===e7&&(r?!t.domain&&!t.domainRaw&&(e.domain(r),n=r.length):e.bins=e.domain()),n}function Dct(e,t,n){var r=e.type,i=t.round||!1,s=t.range;if(t.rangeStep!=null)s=Ict(r,t,n);else if(t.scheme&&(s=Fct(r,t,n),Ht(s))){if(e.interpolator)return e.interpolator(s);ye("Scale type ".concat(r," does not support interpolating color schemes."))}if(s&&xde(r))return e.interpolator(jI(dP(s,t.reverse),t.interpolate,t.interpolateGamma));s&&t.interpolate&&e.interpolate?e.interpolate(i7(t.interpolate,t.interpolateGamma)):Ht(e.round)?e.round(i):Ht(e.rangeRound)&&e.interpolate(i?uC:Dh),s&&e.range(dP(s,t.reverse))}function Ict(e,t,n){e!==gde&&e!==cP&&ye("Only band and point scales support rangeStep.");var r=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,i=e===cP?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*J8(n,i,r)]}function Fct(e,t,n){var r=t.schemeExtent,i,s;return ht(t.scheme)?s=jI(t.scheme,t.interpolate,t.interpolateGamma):(i=t.scheme.toLowerCase(),s=s7(i),s||ye("Unrecognized scheme name: ".concat(t.scheme))),n=e===zI?n+1:e===e7?n-1:e===l0||e===BI?+t.schemeCount||wct:n,xde(e)?MX(s,r,t.reverse):Ht(s)?Sde(MX(s,r),n):e===Q8?s:s.slice(0,n)}function MX(e,t,n){return Ht(e)&&(t||n)?Cde(e,dP(t||[0,1],n)):e}function dP(e,t){return t?e.slice().reverse():e}function Vde(e){he.call(this,null,e)}$e(Vde,he,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(cg(e.sort)),this.modified(n),t}});const RX="zero",Gde="center",Hde="normalize",qde=["y0","y1"];function c7(e){he.call(this,null,e)}c7.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:RX,values:[RX,Gde,Hde]},{name:"as",type:"string",array:!0,length:2,default:qde}]};$e(c7,he,{transform(e,t){var n=e.as||qde,r=n[0],i=n[1],s=cg(e.sort),o=e.field||V1,a=e.offset===Gde?Oct:e.offset===Hde?Nct:Mct,u,l,c,f;for(u=Rct(t.source,e.groupby,s,o),l=0,c=u.length,f=u.max;l<c;++l)a(u[l],f,o,r,i);return t.reflow(e.modified()).modifies(n)}});function Oct(e,t,n,r,i){for(var s=(t-e.sum)/2,o=e.length,a=0,u;a<o;++a)u=e[a],u[r]=s,u[i]=s+=Math.abs(n(u))}function Nct(e,t,n,r,i){for(var s=1/e.sum,o=0,a=e.length,u=0,l=0,c;u<a;++u)c=e[u],c[r]=o,c[i]=o=s*(l+=Math.abs(n(c)))}function Mct(e,t,n,r,i){for(var s=0,o=0,a=e.length,u=0,l,c;u<a;++u)c=e[u],l=+n(c),l<0?(c[r]=o,c[i]=o+=l):(c[r]=s,c[i]=s+=l)}function Rct(e,t,n,r){var i=[],s=m=>m(c),o,a,u,l,c,f,h,d,p;if(t==null)i.push(e.slice());else for(o={},a=0,u=e.length;a<u;++a)c=e[a],f=t.map(s),h=o[f],h||(o[f]=h=[],i.push(h)),h.push(c);for(f=0,p=0,l=i.length;f<l;++f){for(h=i[f],a=0,d=0,u=h.length;a<u;++a)d+=Math.abs(r(h[a]));h.sum=d,d>p&&(p=d),n&&h.sort(n)}return i.max=p,i}const Pct=Object.freeze(Object.defineProperty({__proto__:null,axisticks:Nde,datajoin:Mde,encode:Rde,legendentries:Pde,linkpath:u7,pie:l7,scale:Ude,sortitems:Vde,stack:c7},Symbol.toStringTag,{value:"Module"}));var Xe=1e-6,Rk=1e-12,mt=Math.PI,Pn=mt/2,Pk=mt/4,Yi=mt*2,Wn=180/mt,yt=mt/180,Dt=Math.abs,ay=Math.atan,Ro=Math.atan2,Ke=Math.cos,qS=Math.ceil,Xde=Math.exp,pP=Math.hypot,Lk=Math.log,e3=Math.pow,He=Math.sin,_o=Math.sign||function(e){return e>0?1:e<0?-1:0},Ki=Math.sqrt,f7=Math.tan;function Yde(e){return e>1?0:e<-1?mt:Math.acos(e)}function Ts(e){return e>1?Pn:e<-1?-Pn:Math.asin(e)}function Gr(){}function Bk(e,t){e&&LX.hasOwnProperty(e.type)&&LX[e.type](e,t)}var PX={Feature:function(e,t){Bk(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Bk(n[r].geometry,t)}},LX={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){gP(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)gP(n[r],t,0)},Polygon:function(e,t){BX(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)BX(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Bk(n[r],t)}};function gP(e,t,n){var r=-1,i=e.length-n,s;for(t.lineStart();++r<i;)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function BX(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)gP(e[n],t,1);t.polygonEnd()}function Fl(e,t){e&&PX.hasOwnProperty(e.type)?PX[e.type](e,t):Bk(e,t)}var zk=new Vi,jk=new Vi,Kde,Zde,mP,yP,bP,Bu={point:Gr,lineStart:Gr,lineEnd:Gr,polygonStart:function(){zk=new Vi,Bu.lineStart=Lct,Bu.lineEnd=Bct},polygonEnd:function(){var e=+zk;jk.add(e<0?Yi+e:e),this.lineStart=this.lineEnd=this.point=Gr},sphere:function(){jk.add(Yi)}};function Lct(){Bu.point=zct}function Bct(){Jde(Kde,Zde)}function zct(e,t){Bu.point=Jde,Kde=e,Zde=t,e*=yt,t*=yt,mP=e,yP=Ke(t=t/2+Pk),bP=He(t)}function Jde(e,t){e*=yt,t*=yt,t=t/2+Pk;var n=e-mP,r=n>=0?1:-1,i=r*n,s=Ke(t),o=He(t),a=bP*o,u=yP*s+a*Ke(i),l=a*r*He(i);zk.add(Ro(l,u)),mP=e,yP=s,bP=o}function jct(e){return jk=new Vi,Fl(e,Bu),jk*2}function Uk(e){return[Ro(e[1],e[0]),Ts(e[2])]}function Tp(e){var t=e[0],n=e[1],r=Ke(n);return[r*Ke(t),r*He(t),He(n)]}function XS(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function f0(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function t3(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function YS(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Wk(e){var t=Ki(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Dn,fs,Nn,zs,dd,Qde,epe,km,nv,zc,oc,_l={point:vP,lineStart:zX,lineEnd:jX,polygonStart:function(){_l.point=npe,_l.lineStart=Uct,_l.lineEnd=Wct,nv=new Vi,Bu.polygonStart()},polygonEnd:function(){Bu.polygonEnd(),_l.point=vP,_l.lineStart=zX,_l.lineEnd=jX,zk<0?(Dn=-(Nn=180),fs=-(zs=90)):nv>Xe?zs=90:nv<-Xe&&(fs=-90),oc[0]=Dn,oc[1]=Nn},sphere:function(){Dn=-(Nn=180),fs=-(zs=90)}};function vP(e,t){zc.push(oc=[Dn=e,Nn=e]),t<fs&&(fs=t),t>zs&&(zs=t)}function tpe(e,t){var n=Tp([e*yt,t*yt]);if(km){var r=f0(km,n),i=[r[1],-r[0],0],s=f0(i,r);Wk(s),s=Uk(s);var o=e-dd,a=o>0?1:-1,u=s[0]*Wn*a,l,c=Dt(o)>180;c^(a*dd<u&&u<a*e)?(l=s[1]*Wn,l>zs&&(zs=l)):(u=(u+360)%360-180,c^(a*dd<u&&u<a*e)?(l=-s[1]*Wn,l<fs&&(fs=l)):(t<fs&&(fs=t),t>zs&&(zs=t))),c?e<dd?Bs(Dn,e)>Bs(Dn,Nn)&&(Nn=e):Bs(e,Nn)>Bs(Dn,Nn)&&(Dn=e):Nn>=Dn?(e<Dn&&(Dn=e),e>Nn&&(Nn=e)):e>dd?Bs(Dn,e)>Bs(Dn,Nn)&&(Nn=e):Bs(e,Nn)>Bs(Dn,Nn)&&(Dn=e)}else zc.push(oc=[Dn=e,Nn=e]);t<fs&&(fs=t),t>zs&&(zs=t),km=n,dd=e}function zX(){_l.point=tpe}function jX(){oc[0]=Dn,oc[1]=Nn,_l.point=vP,km=null}function npe(e,t){if(km){var n=e-dd;nv.add(Dt(n)>180?n+(n>0?360:-360):n)}else Qde=e,epe=t;Bu.point(e,t),tpe(e,t)}function Uct(){Bu.lineStart()}function Wct(){npe(Qde,epe),Bu.lineEnd(),Dt(nv)>Xe&&(Dn=-(Nn=180)),oc[0]=Dn,oc[1]=Nn,km=null}function Bs(e,t){return(t-=e)<0?t+360:t}function Vct(e,t){return e[0]-t[0]}function UX(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function Gct(e){var t,n,r,i,s,o,a;if(zs=Nn=-(Dn=fs=1/0),zc=[],Fl(e,_l),n=zc.length){for(zc.sort(Vct),t=1,r=zc[0],s=[r];t<n;++t)i=zc[t],UX(r,i[0])||UX(r,i[1])?(Bs(r[0],i[1])>Bs(r[0],r[1])&&(r[1]=i[1]),Bs(i[0],r[1])>Bs(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,n=s.length-1,t=0,r=s[n];t<=n;r=i,++t)i=s[t],(a=Bs(r[1],i[0]))>o&&(o=a,Dn=i[0],Nn=r[1])}return zc=oc=null,Dn===1/0||fs===1/0?[[NaN,NaN],[NaN,NaN]]:[[Dn,fs],[Nn,zs]]}var Fb,Vk,Gk,Hk,qk,Xk,Yk,Kk,xP,wP,CP,rpe,ipe,Pi,Li,Bi,ma={sphere:Gr,point:h7,lineStart:WX,lineEnd:VX,polygonStart:function(){ma.lineStart=Xct,ma.lineEnd=Yct},polygonEnd:function(){ma.lineStart=WX,ma.lineEnd=VX}};function h7(e,t){e*=yt,t*=yt;var n=Ke(t);pC(n*Ke(e),n*He(e),He(t))}function pC(e,t,n){++Fb,Gk+=(e-Gk)/Fb,Hk+=(t-Hk)/Fb,qk+=(n-qk)/Fb}function WX(){ma.point=Hct}function Hct(e,t){e*=yt,t*=yt;var n=Ke(t);Pi=n*Ke(e),Li=n*He(e),Bi=He(t),ma.point=qct,pC(Pi,Li,Bi)}function qct(e,t){e*=yt,t*=yt;var n=Ke(t),r=n*Ke(e),i=n*He(e),s=He(t),o=Ro(Ki((o=Li*s-Bi*i)*o+(o=Bi*r-Pi*s)*o+(o=Pi*i-Li*r)*o),Pi*r+Li*i+Bi*s);Vk+=o,Xk+=o*(Pi+(Pi=r)),Yk+=o*(Li+(Li=i)),Kk+=o*(Bi+(Bi=s)),pC(Pi,Li,Bi)}function VX(){ma.point=h7}function Xct(){ma.point=Kct}function Yct(){spe(rpe,ipe),ma.point=h7}function Kct(e,t){rpe=e,ipe=t,e*=yt,t*=yt,ma.point=spe;var n=Ke(t);Pi=n*Ke(e),Li=n*He(e),Bi=He(t),pC(Pi,Li,Bi)}function spe(e,t){e*=yt,t*=yt;var n=Ke(t),r=n*Ke(e),i=n*He(e),s=He(t),o=Li*s-Bi*i,a=Bi*r-Pi*s,u=Pi*i-Li*r,l=pP(o,a,u),c=Ts(l),f=l&&-c/l;xP.add(f*o),wP.add(f*a),CP.add(f*u),Vk+=c,Xk+=c*(Pi+(Pi=r)),Yk+=c*(Li+(Li=i)),Kk+=c*(Bi+(Bi=s)),pC(Pi,Li,Bi)}function Zct(e){Fb=Vk=Gk=Hk=qk=Xk=Yk=Kk=0,xP=new Vi,wP=new Vi,CP=new Vi,Fl(e,ma);var t=+xP,n=+wP,r=+CP,i=pP(t,n,r);return i<Rk&&(t=Xk,n=Yk,r=Kk,Vk<Xe&&(t=Gk,n=Hk,r=qk),i=pP(t,n,r),i<Rk)?[NaN,NaN]:[Ro(n,t)*Wn,Ts(r/i)*Wn]}function SP(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function _P(e,t){return[Dt(e)>mt?e+Math.round(-e/Yi)*Yi:e,t]}_P.invert=_P;function ope(e,t,n){return(e%=Yi)?t||n?SP(HX(e),qX(t,n)):HX(e):t||n?qX(t,n):_P}function GX(e){return function(t,n){return t+=e,[t>mt?t-Yi:t<-mt?t+Yi:t,n]}}function HX(e){var t=GX(e);return t.invert=GX(-e),t}function qX(e,t){var n=Ke(e),r=He(e),i=Ke(t),s=He(t);function o(a,u){var l=Ke(u),c=Ke(a)*l,f=He(a)*l,h=He(u),d=h*n+c*r;return[Ro(f*i-d*s,c*n-h*r),Ts(d*i+f*s)]}return o.invert=function(a,u){var l=Ke(u),c=Ke(a)*l,f=He(a)*l,h=He(u),d=h*i-f*s;return[Ro(f*i+h*s,c*n+d*r),Ts(d*n-c*r)]},o}function Jct(e){e=ope(e[0]*yt,e[1]*yt,e.length>2?e[2]*yt:0);function t(n){return n=e(n[0]*yt,n[1]*yt),n[0]*=Wn,n[1]*=Wn,n}return t.invert=function(n){return n=e.invert(n[0]*yt,n[1]*yt),n[0]*=Wn,n[1]*=Wn,n},t}function Qct(e,t,n,r,i,s){if(n){var o=Ke(t),a=He(t),u=r*n;i==null?(i=t+r*Yi,s=t-u/2):(i=XX(o,i),s=XX(o,s),(r>0?i<s:i>s)&&(i+=r*Yi));for(var l,c=i;r>0?c>s:c<s;c-=u)l=Uk([o,-a*Ke(c),-a*He(c)]),e.point(l[0],l[1])}}function XX(e,t){t=Tp(t),t[0]-=e,Wk(t);var n=Yde(-t[1]);return((-t[2]<0?-n:n)+Yi-Xe)%Yi}function ape(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:Gr,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function V_(e,t){return Dt(e[0]-t[0])<Xe&&Dt(e[1]-t[1])<Xe}function KS(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function upe(e,t,n,r,i){var s=[],o=[],a,u;if(e.forEach(function(p){if(!((m=p.length-1)<=0)){var m,g=p[0],y=p[m],b;if(V_(g,y)){if(!g[2]&&!y[2]){for(i.lineStart(),a=0;a<m;++a)i.point((g=p[a])[0],g[1]);i.lineEnd();return}y[0]+=2*Xe}s.push(b=new KS(g,p,null,!0)),o.push(b.o=new KS(g,null,b,!1)),s.push(b=new KS(y,p,null,!1)),o.push(b.o=new KS(y,null,b,!0))}}),!!s.length){for(o.sort(t),YX(s),YX(o),a=0,u=o.length;a<u;++a)o[a].e=n=!n;for(var l=s[0],c,f;;){for(var h=l,d=!0;h.v;)if((h=h.n)===l)return;c=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,u=c.length;a<u;++a)i.point((f=c[a])[0],f[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(d)for(c=h.p.z,a=c.length-1;a>=0;--a)i.point((f=c[a])[0],f[1]);else r(h.x,h.p.x,-1,i);h=h.p}h=h.o,c=h.z,d=!d}while(!h.v);i.lineEnd()}}}function YX(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function n3(e){return Dt(e[0])<=mt?e[0]:_o(e[0])*((Dt(e[0])+mt)%Yi-mt)}function eft(e,t){var n=n3(t),r=t[1],i=He(r),s=[He(n),-Ke(n),0],o=0,a=0,u=new Vi;i===1?r=Pn+Xe:i===-1&&(r=-Pn-Xe);for(var l=0,c=e.length;l<c;++l)if(h=(f=e[l]).length)for(var f,h,d=f[h-1],p=n3(d),m=d[1]/2+Pk,g=He(m),y=Ke(m),b=0;b<h;++b,p=v,g=C,y=S,d=x){var x=f[b],v=n3(x),w=x[1]/2+Pk,C=He(w),S=Ke(w),_=v-p,$=_>=0?1:-1,k=$*_,E=k>mt,F=g*C;if(u.add(Ro(F*$*He(k),y*S+F*Ke(k))),o+=E?_+$*Yi:_,E^p>=n^v>=n){var T=f0(Tp(d),Tp(x));Wk(T);var I=f0(s,T);Wk(I);var D=(E^_>=0?-1:1)*Ts(I[2]);(r>D||r===D&&(T[0]||T[1]))&&(a+=E^_>=0?1:-1)}}return(o<-Xe||o<Xe&&u<-Rk)^a&1}function lpe(e,t,n,r){return function(i){var s=t(i),o=ape(),a=t(o),u=!1,l,c,f,h={point:d,lineStart:m,lineEnd:g,polygonStart:function(){h.point=y,h.lineStart=b,h.lineEnd=x,c=[],l=[]},polygonEnd:function(){h.point=d,h.lineStart=m,h.lineEnd=g,c=Fue(c);var v=eft(l,r);c.length?(u||(i.polygonStart(),u=!0),upe(c,nft,v,n,i)):v&&(u||(i.polygonStart(),u=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),u&&(i.polygonEnd(),u=!1),c=l=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(v,w){e(v,w)&&i.point(v,w)}function p(v,w){s.point(v,w)}function m(){h.point=p,s.lineStart()}function g(){h.point=d,s.lineEnd()}function y(v,w){f.push([v,w]),a.point(v,w)}function b(){a.lineStart(),f=[]}function x(){y(f[0][0],f[0][1]),a.lineEnd();var v=a.clean(),w=o.result(),C,S=w.length,_,$,k;if(f.pop(),l.push(f),f=null,!!S){if(v&1){if($=w[0],(_=$.length-1)>0){for(u||(i.polygonStart(),u=!0),i.lineStart(),C=0;C<_;++C)i.point((k=$[C])[0],k[1]);i.lineEnd()}return}S>1&&v&2&&w.push(w.pop().concat(w.shift())),c.push(w.filter(tft))}}return h}}function tft(e){return e.length>1}function nft(e,t){return((e=e.x)[0]<0?e[1]-Pn-Xe:Pn-e[1])-((t=t.x)[0]<0?t[1]-Pn-Xe:Pn-t[1])}const KX=lpe(function(){return!0},rft,sft,[-mt,-Pn]);function rft(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var a=s>0?mt:-mt,u=Dt(s-t);Dt(u-mt)<Xe?(e.point(t,n=(n+o)/2>0?Pn:-Pn),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),i=0):r!==a&&u>=mt&&(Dt(t-r)<Xe&&(t-=r*Xe),Dt(s-a)<Xe&&(s-=a*Xe),n=ift(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),i=0),e.point(t=s,n=o),r=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function ift(e,t,n,r){var i,s,o=He(e-n);return Dt(o)>Xe?ay((He(t)*(s=Ke(r))*He(n)-He(r)*(i=Ke(t))*He(e))/(i*s*o)):(t+r)/2}function sft(e,t,n,r){var i;if(e==null)i=n*Pn,r.point(-mt,i),r.point(0,i),r.point(mt,i),r.point(mt,0),r.point(mt,-i),r.point(0,-i),r.point(-mt,-i),r.point(-mt,0),r.point(-mt,i);else if(Dt(e[0]-t[0])>Xe){var s=e[0]<t[0]?mt:-mt;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function oft(e){var t=Ke(e),n=6*yt,r=t>0,i=Dt(t)>Xe;function s(c,f,h,d){Qct(d,e,n,h,c,f)}function o(c,f){return Ke(c)*Ke(f)>t}function a(c){var f,h,d,p,m;return{lineStart:function(){p=d=!1,m=1},point:function(g,y){var b=[g,y],x,v=o(g,y),w=r?v?0:l(g,y):v?l(g+(g<0?mt:-mt),y):0;if(!f&&(p=d=v)&&c.lineStart(),v!==d&&(x=u(f,b),(!x||V_(f,x)||V_(b,x))&&(b[2]=1)),v!==d)m=0,v?(c.lineStart(),x=u(b,f),c.point(x[0],x[1])):(x=u(f,b),c.point(x[0],x[1],2),c.lineEnd()),f=x;else if(i&&f&&r^v){var C;!(w&h)&&(C=u(b,f,!0))&&(m=0,r?(c.lineStart(),c.point(C[0][0],C[0][1]),c.point(C[1][0],C[1][1]),c.lineEnd()):(c.point(C[1][0],C[1][1]),c.lineEnd(),c.lineStart(),c.point(C[0][0],C[0][1],3)))}v&&(!f||!V_(f,b))&&c.point(b[0],b[1]),f=b,d=v,h=w},lineEnd:function(){d&&c.lineEnd(),f=null},clean:function(){return m|(p&&d)<<1}}}function u(c,f,h){var d=Tp(c),p=Tp(f),m=[1,0,0],g=f0(d,p),y=XS(g,g),b=g[0],x=y-b*b;if(!x)return!h&&c;var v=t*y/x,w=-t*b/x,C=f0(m,g),S=YS(m,v),_=YS(g,w);t3(S,_);var $=C,k=XS(S,$),E=XS($,$),F=k*k-E*(XS(S,S)-1);if(!(F<0)){var T=Ki(F),I=YS($,(-k-T)/E);if(t3(I,S),I=Uk(I),!h)return I;var D=c[0],N=f[0],V=c[1],U=f[1],A;N<D&&(A=D,D=N,N=A);var M=N-D,P=Dt(M-mt)<Xe,j=P||M<Xe;if(!P&&U<V&&(A=V,V=U,U=A),j?P?V+U>0^I[1]<(Dt(I[0]-D)<Xe?V:U):V<=I[1]&&I[1]<=U:M>mt^(D<=I[0]&&I[0]<=N)){var q=YS($,(-k+T)/E);return t3(q,S),[I,Uk(q)]}}}function l(c,f){var h=r?e:mt-e,d=0;return c<-h?d|=1:c>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return lpe(o,a,s,r?[0,-e]:[-mt,e-mt])}function aft(e,t,n,r,i,s){var o=e[0],a=e[1],u=t[0],l=t[1],c=0,f=1,h=u-o,d=l-a,p;if(p=n-o,!(!h&&p>0)){if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=i-o,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}if(p=r-a,!(!d&&p>0)){if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=s-a,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*h,e[1]=a+c*d),f<1&&(t[0]=o+f*h,t[1]=a+f*d),!0}}}}}var Ob=1e9,ZS=-Ob;function cpe(e,t,n,r){function i(l,c){return e<=l&&l<=n&&t<=c&&c<=r}function s(l,c,f,h){var d=0,p=0;if(l==null||(d=o(l,f))!==(p=o(c,f))||u(l,c)<0^f>0)do h.point(d===0||d===3?e:n,d>1?r:t);while((d=(d+f+4)%4)!==p);else h.point(c[0],c[1])}function o(l,c){return Dt(l[0]-e)<Xe?c>0?0:3:Dt(l[0]-n)<Xe?c>0?2:1:Dt(l[1]-t)<Xe?c>0?1:0:c>0?3:2}function a(l,c){return u(l.x,c.x)}function u(l,c){var f=o(l,1),h=o(c,1);return f!==h?f-h:f===0?c[1]-l[1]:f===1?l[0]-c[0]:f===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,f=ape(),h,d,p,m,g,y,b,x,v,w,C,S={point:_,lineStart:F,lineEnd:T,polygonStart:k,polygonEnd:E};function _(D,N){i(D,N)&&c.point(D,N)}function $(){for(var D=0,N=0,V=d.length;N<V;++N)for(var U=d[N],A=1,M=U.length,P=U[0],j,q,B=P[0],O=P[1];A<M;++A)j=B,q=O,P=U[A],B=P[0],O=P[1],q<=r?O>r&&(B-j)*(r-q)>(O-q)*(e-j)&&++D:O<=r&&(B-j)*(r-q)<(O-q)*(e-j)&&--D;return D}function k(){c=f,h=[],d=[],C=!0}function E(){var D=$(),N=C&&D,V=(h=Fue(h)).length;(N||V)&&(l.polygonStart(),N&&(l.lineStart(),s(null,null,1,l),l.lineEnd()),V&&upe(h,a,D,s,l),l.polygonEnd()),c=l,h=d=p=null}function F(){S.point=I,d&&d.push(p=[]),w=!0,v=!1,b=x=NaN}function T(){h&&(I(m,g),y&&v&&f.rejoin(),h.push(f.result())),S.point=_,v&&c.lineEnd()}function I(D,N){var V=i(D,N);if(d&&p.push([D,N]),w)m=D,g=N,y=V,w=!1,V&&(c.lineStart(),c.point(D,N));else if(V&&v)c.point(D,N);else{var U=[b=Math.max(ZS,Math.min(Ob,b)),x=Math.max(ZS,Math.min(Ob,x))],A=[D=Math.max(ZS,Math.min(Ob,D)),N=Math.max(ZS,Math.min(Ob,N))];aft(U,A,e,t,n,r)?(v||(c.lineStart(),c.point(U[0],U[1])),c.point(A[0],A[1]),V||c.lineEnd(),C=!1):V&&(c.lineStart(),c.point(D,N),C=!1)}b=D,x=N,v=V}return S}}function ZX(e,t,n){var r=qs(e,t-Xe,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function JX(e,t,n){var r=qs(e,t-Xe,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function uft(){var e,t,n,r,i,s,o,a,u=10,l=u,c=90,f=360,h,d,p,m,g=2.5;function y(){return{type:"MultiLineString",coordinates:b()}}function b(){return qs(qS(r/c)*c,n,c).map(p).concat(qs(qS(a/f)*f,o,f).map(m)).concat(qs(qS(t/u)*u,e,u).filter(function(x){return Dt(x%c)>Xe}).map(h)).concat(qs(qS(s/l)*l,i,l).filter(function(x){return Dt(x%f)>Xe}).map(d))}return y.lines=function(){return b().map(function(x){return{type:"LineString",coordinates:x}})},y.outline=function(){return{type:"Polygon",coordinates:[p(r).concat(m(o).slice(1),p(n).reverse().slice(1),m(a).reverse().slice(1))]}},y.extent=function(x){return arguments.length?y.extentMajor(x).extentMinor(x):y.extentMinor()},y.extentMajor=function(x){return arguments.length?(r=+x[0][0],n=+x[1][0],a=+x[0][1],o=+x[1][1],r>n&&(x=r,r=n,n=x),a>o&&(x=a,a=o,o=x),y.precision(g)):[[r,a],[n,o]]},y.extentMinor=function(x){return arguments.length?(t=+x[0][0],e=+x[1][0],s=+x[0][1],i=+x[1][1],t>e&&(x=t,t=e,e=x),s>i&&(x=s,s=i,i=x),y.precision(g)):[[t,s],[e,i]]},y.step=function(x){return arguments.length?y.stepMajor(x).stepMinor(x):y.stepMinor()},y.stepMajor=function(x){return arguments.length?(c=+x[0],f=+x[1],y):[c,f]},y.stepMinor=function(x){return arguments.length?(u=+x[0],l=+x[1],y):[u,l]},y.precision=function(x){return arguments.length?(g=+x,h=ZX(s,i,90),d=JX(t,e,g),p=ZX(a,o,90),m=JX(r,n,g),y):g},y.extentMajor([[-180,-90+Xe],[180,90-Xe]]).extentMinor([[-180,-80-Xe],[180,80+Xe]])}const $x=e=>e;var r3=new Vi,$P=new Vi,fpe,hpe,kP,EP,Gc={point:Gr,lineStart:Gr,lineEnd:Gr,polygonStart:function(){Gc.lineStart=lft,Gc.lineEnd=fft},polygonEnd:function(){Gc.lineStart=Gc.lineEnd=Gc.point=Gr,r3.add(Dt($P)),$P=new Vi},result:function(){var e=r3/2;return r3=new Vi,e}};function lft(){Gc.point=cft}function cft(e,t){Gc.point=dpe,fpe=kP=e,hpe=EP=t}function dpe(e,t){$P.add(EP*e-kP*t),kP=e,EP=t}function fft(){dpe(fpe,hpe)}const QX=Gc;var h0=1/0,Zk=h0,kx=-h0,Jk=kx,hft={point:dft,lineStart:Gr,lineEnd:Gr,polygonStart:Gr,polygonEnd:Gr,result:function(){var e=[[h0,Zk],[kx,Jk]];return kx=Jk=-(Zk=h0=1/0),e}};function dft(e,t){e<h0&&(h0=e),e>kx&&(kx=e),t<Zk&&(Zk=t),t>Jk&&(Jk=t)}const Qk=hft;var AP=0,TP=0,Nb=0,eE=0,tE=0,fm=0,DP=0,IP=0,Mb=0,ppe,gpe,au,uu,da={point:Dp,lineStart:eY,lineEnd:tY,polygonStart:function(){da.lineStart=mft,da.lineEnd=yft},polygonEnd:function(){da.point=Dp,da.lineStart=eY,da.lineEnd=tY},result:function(){var e=Mb?[DP/Mb,IP/Mb]:fm?[eE/fm,tE/fm]:Nb?[AP/Nb,TP/Nb]:[NaN,NaN];return AP=TP=Nb=eE=tE=fm=DP=IP=Mb=0,e}};function Dp(e,t){AP+=e,TP+=t,++Nb}function eY(){da.point=pft}function pft(e,t){da.point=gft,Dp(au=e,uu=t)}function gft(e,t){var n=e-au,r=t-uu,i=Ki(n*n+r*r);eE+=i*(au+e)/2,tE+=i*(uu+t)/2,fm+=i,Dp(au=e,uu=t)}function tY(){da.point=Dp}function mft(){da.point=bft}function yft(){mpe(ppe,gpe)}function bft(e,t){da.point=mpe,Dp(ppe=au=e,gpe=uu=t)}function mpe(e,t){var n=e-au,r=t-uu,i=Ki(n*n+r*r);eE+=i*(au+e)/2,tE+=i*(uu+t)/2,fm+=i,i=uu*e-au*t,DP+=i*(au+e),IP+=i*(uu+t),Mb+=i*3,Dp(au=e,uu=t)}const nY=da;function ype(e){this._context=e}ype.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Yi);break}}},result:Gr};var FP=new Vi,i3,bpe,vpe,Rb,Pb,nE={point:Gr,lineStart:function(){nE.point=vft},lineEnd:function(){i3&&xpe(bpe,vpe),nE.point=Gr},polygonStart:function(){i3=!0},polygonEnd:function(){i3=null},result:function(){var e=+FP;return FP=new Vi,e}};function vft(e,t){nE.point=xpe,bpe=Rb=e,vpe=Pb=t}function xpe(e,t){Rb-=e,Pb-=t,FP.add(Ki(Rb*Rb+Pb*Pb)),Rb=e,Pb=t}const rY=nE;function wpe(){this._string=[]}wpe.prototype={_radius:4.5,_circle:iY(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=iY(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function iY(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Cpe(e,t){var n=4.5,r,i;function s(o){return o&&(typeof n=="function"&&i.pointRadius(+n.apply(this,arguments)),Fl(o,r(i))),i.result()}return s.area=function(o){return Fl(o,r(QX)),QX.result()},s.measure=function(o){return Fl(o,r(rY)),rY.result()},s.bounds=function(o){return Fl(o,r(Qk)),Qk.result()},s.centroid=function(o){return Fl(o,r(nY)),nY.result()},s.projection=function(o){return arguments.length?(r=o==null?(e=null,$x):(e=o).stream,s):e},s.context=function(o){return arguments.length?(i=o==null?(t=null,new wpe):new ype(t=o),typeof n!="function"&&i.pointRadius(n),s):t},s.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(i.pointRadius(+o),+o),s):n},s.projection(e).context(t)}function UI(e){return function(t){var n=new OP;for(var r in e)n[r]=e[r];return n.stream=t,n}}function OP(){}OP.prototype={constructor:OP,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function d7(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),Fl(n,e.stream(Qk)),t(Qk.result()),r!=null&&e.clipExtent(r),e}function WI(e,t,n){return d7(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,u=+t[0][1]+(s-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([a,u])},n)}function p7(e,t,n){return WI(e,[[0,0],t],n)}function g7(e,t,n){return d7(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];e.scale(150*s).translate([o,a])},n)}function m7(e,t,n){return d7(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var sY=16,xft=Ke(30*yt);function oY(e,t){return+t?Cft(e,t):wft(e)}function wft(e){return UI({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Cft(e,t){function n(r,i,s,o,a,u,l,c,f,h,d,p,m,g){var y=l-r,b=c-i,x=y*y+b*b;if(x>4*t&&m--){var v=o+h,w=a+d,C=u+p,S=Ki(v*v+w*w+C*C),_=Ts(C/=S),$=Dt(Dt(C)-1)<Xe||Dt(s-f)<Xe?(s+f)/2:Ro(w,v),k=e($,_),E=k[0],F=k[1],T=E-r,I=F-i,D=b*T-y*I;(D*D/x>t||Dt((y*T+b*I)/x-.5)>.3||o*h+a*d+u*p<xft)&&(n(r,i,s,o,a,u,E,F,$,v/=S,w/=S,C,m,g),g.point(E,F),n(E,F,$,v,w,C,l,c,f,h,d,p,m,g))}}return function(r){var i,s,o,a,u,l,c,f,h,d,p,m,g={point:y,lineStart:b,lineEnd:v,polygonStart:function(){r.polygonStart(),g.lineStart=w},polygonEnd:function(){r.polygonEnd(),g.lineStart=b}};function y(_,$){_=e(_,$),r.point(_[0],_[1])}function b(){f=NaN,g.point=x,r.lineStart()}function x(_,$){var k=Tp([_,$]),E=e(_,$);n(f,h,c,d,p,m,f=E[0],h=E[1],c=_,d=k[0],p=k[1],m=k[2],sY,r),r.point(f,h)}function v(){g.point=y,r.lineEnd()}function w(){b(),g.point=C,g.lineEnd=S}function C(_,$){x(i=_,$),s=f,o=h,a=d,u=p,l=m,g.point=x}function S(){n(f,h,c,d,p,m,s,o,i,a,u,l,sY,r),g.lineEnd=v,v()}return g}}var Sft=UI({point:function(e,t){this.stream.point(e*yt,t*yt)}});function _ft(e){return UI({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function $ft(e,t,n,r,i){function s(o,a){return o*=r,a*=i,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*r,(n-a)/e*i]},s}function aY(e,t,n,r,i,s){if(!s)return $ft(e,t,n,r,i);var o=Ke(s),a=He(s),u=o*e,l=a*e,c=o/e,f=a/e,h=(a*n-o*t)/e,d=(a*t+o*n)/e;function p(m,g){return m*=r,g*=i,[u*m-l*g+t,n-l*m-u*g]}return p.invert=function(m,g){return[r*(c*m-f*g+h),i*(d-f*m-c*g)]},p}function Ju(e){return Spe(function(){return e})()}function Spe(e){var t,n=150,r=480,i=250,s=0,o=0,a=0,u=0,l=0,c,f=0,h=1,d=1,p=null,m=KX,g=null,y,b,x,v=$x,w=.5,C,S,_,$,k;function E(D){return _(D[0]*yt,D[1]*yt)}function F(D){return D=_.invert(D[0],D[1]),D&&[D[0]*Wn,D[1]*Wn]}E.stream=function(D){return $&&k===D?$:$=Sft(_ft(c)(m(C(v(k=D)))))},E.preclip=function(D){return arguments.length?(m=D,p=void 0,I()):m},E.postclip=function(D){return arguments.length?(v=D,g=y=b=x=null,I()):v},E.clipAngle=function(D){return arguments.length?(m=+D?oft(p=D*yt):(p=null,KX),I()):p*Wn},E.clipExtent=function(D){return arguments.length?(v=D==null?(g=y=b=x=null,$x):cpe(g=+D[0][0],y=+D[0][1],b=+D[1][0],x=+D[1][1]),I()):g==null?null:[[g,y],[b,x]]},E.scale=function(D){return arguments.length?(n=+D,T()):n},E.translate=function(D){return arguments.length?(r=+D[0],i=+D[1],T()):[r,i]},E.center=function(D){return arguments.length?(s=D[0]%360*yt,o=D[1]%360*yt,T()):[s*Wn,o*Wn]},E.rotate=function(D){return arguments.length?(a=D[0]%360*yt,u=D[1]%360*yt,l=D.length>2?D[2]%360*yt:0,T()):[a*Wn,u*Wn,l*Wn]},E.angle=function(D){return arguments.length?(f=D%360*yt,T()):f*Wn},E.reflectX=function(D){return arguments.length?(h=D?-1:1,T()):h<0},E.reflectY=function(D){return arguments.length?(d=D?-1:1,T()):d<0},E.precision=function(D){return arguments.length?(C=oY(S,w=D*D),I()):Ki(w)},E.fitExtent=function(D,N){return WI(E,D,N)},E.fitSize=function(D,N){return p7(E,D,N)},E.fitWidth=function(D,N){return g7(E,D,N)},E.fitHeight=function(D,N){return m7(E,D,N)};function T(){var D=aY(n,0,0,h,d,f).apply(null,t(s,o)),N=aY(n,r-D[0],i-D[1],h,d,f);return c=ope(a,u,l),S=SP(t,N),_=SP(c,S),C=oY(S,w),I()}function I(){return $=k=null,E}return function(){return t=e.apply(this,arguments),E.invert=t.invert&&F,T()}}function y7(e){var t=0,n=mt/3,r=Spe(e),i=r(t,n);return i.parallels=function(s){return arguments.length?r(t=s[0]*yt,n=s[1]*yt):[t*Wn,n*Wn]},i}function kft(e){var t=Ke(e);function n(r,i){return[r*t,He(i)/t]}return n.invert=function(r,i){return[r/t,Ts(i*t)]},n}function Eft(e,t){var n=He(e),r=(n+He(t))/2;if(Dt(r)<Xe)return kft(e);var i=1+n*(2*r-n),s=Ki(i)/r;function o(a,u){var l=Ki(i-2*r*He(u))/r;return[l*He(a*=r),s-l*Ke(a)]}return o.invert=function(a,u){var l=s-u,c=Ro(a,Dt(l))*_o(l);return l*r<0&&(c-=mt*_o(a)*_o(l)),[c/r,Ts((i-(a*a+l*l)*r*r)/(2*r))]},o}function rE(){return y7(Eft).scale(155.424).center([0,33.6442])}function _pe(){return rE().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Aft(e){var t=e.length;return{point:function(n,r){for(var i=-1;++i<t;)e[i].point(n,r)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function Tft(){var e,t,n=_pe(),r,i=rE().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,o=rE().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,l={point:function(h,d){u=[h,d]}};function c(h){var d=h[0],p=h[1];return u=null,r.point(d,p),u||(s.point(d,p),u)||(a.point(d,p),u)}c.invert=function(h){var d=n.scale(),p=n.translate(),m=(h[0]-p[0])/d,g=(h[1]-p[1])/d;return(g>=.12&&g<.234&&m>=-.425&&m<-.214?i:g>=.166&&g<.234&&m>=-.214&&m<-.115?o:n).invert(h)},c.stream=function(h){return e&&t===h?e:e=Aft([n.stream(t=h),i.stream(h),o.stream(h)])},c.precision=function(h){return arguments.length?(n.precision(h),i.precision(h),o.precision(h),f()):n.precision()},c.scale=function(h){return arguments.length?(n.scale(h),i.scale(h*.35),o.scale(h),c.translate(n.translate())):n.scale()},c.translate=function(h){if(!arguments.length)return n.translate();var d=n.scale(),p=+h[0],m=+h[1];return r=n.translate(h).clipExtent([[p-.455*d,m-.238*d],[p+.455*d,m+.238*d]]).stream(l),s=i.translate([p-.307*d,m+.201*d]).clipExtent([[p-.425*d+Xe,m+.12*d+Xe],[p-.214*d-Xe,m+.234*d-Xe]]).stream(l),a=o.translate([p-.205*d,m+.212*d]).clipExtent([[p-.214*d+Xe,m+.166*d+Xe],[p-.115*d-Xe,m+.234*d-Xe]]).stream(l),f()},c.fitExtent=function(h,d){return WI(c,h,d)},c.fitSize=function(h,d){return p7(c,h,d)},c.fitWidth=function(h,d){return g7(c,h,d)},c.fitHeight=function(h,d){return m7(c,h,d)};function f(){return e=t=null,c}return c.scale(1070)}function $pe(e){return function(t,n){var r=Ke(t),i=Ke(n),s=e(r*i);return s===1/0?[2,0]:[s*i*He(t),s*He(n)]}}function gC(e){return function(t,n){var r=Ki(t*t+n*n),i=e(r),s=He(i),o=Ke(i);return[Ro(t*s,r*o),Ts(r&&n*s/r)]}}var kpe=$pe(function(e){return Ki(2/(1+e))});kpe.invert=gC(function(e){return 2*Ts(e/2)});function Dft(){return Ju(kpe).scale(124.75).clipAngle(180-.001)}var Epe=$pe(function(e){return(e=Yde(e))&&e/He(e)});Epe.invert=gC(function(e){return e});function Ift(){return Ju(Epe).scale(79.4188).clipAngle(180-.001)}function VI(e,t){return[e,Lk(f7((Pn+t)/2))]}VI.invert=function(e,t){return[e,2*ay(Xde(t))-Pn]};function Fft(){return Ape(VI).scale(961/Yi)}function Ape(e){var t=Ju(e),n=t.center,r=t.scale,i=t.translate,s=t.clipExtent,o=null,a,u,l;t.scale=function(f){return arguments.length?(r(f),c()):r()},t.translate=function(f){return arguments.length?(i(f),c()):i()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=a=u=l=null:(o=+f[0][0],a=+f[0][1],u=+f[1][0],l=+f[1][1]),c()):o==null?null:[[o,a],[u,l]]};function c(){var f=mt*r(),h=t(Jct(t.rotate()).invert([0,0]));return s(o==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===VI?[[Math.max(h[0]-f,o),a],[Math.min(h[0]+f,u),l]]:[[o,Math.max(h[1]-f,a)],[u,Math.min(h[1]+f,l)]])}return c()}function JS(e){return f7((Pn+e)/2)}function Oft(e,t){var n=Ke(e),r=e===t?He(e):Lk(n/Ke(t))/Lk(JS(t)/JS(e)),i=n*e3(JS(e),r)/r;if(!r)return VI;function s(o,a){i>0?a<-Pn+Xe&&(a=-Pn+Xe):a>Pn-Xe&&(a=Pn-Xe);var u=i/e3(JS(a),r);return[u*He(r*o),i-u*Ke(r*o)]}return s.invert=function(o,a){var u=i-a,l=_o(r)*Ki(o*o+u*u),c=Ro(o,Dt(u))*_o(u);return u*r<0&&(c-=mt*_o(o)*_o(u)),[c/r,2*ay(e3(i/l,1/r))-Pn]},s}function Nft(){return y7(Oft).scale(109.5).parallels([30,30])}function iE(e,t){return[e,t]}iE.invert=iE;function Mft(){return Ju(iE).scale(152.63)}function Rft(e,t){var n=Ke(e),r=e===t?He(e):(n-Ke(t))/(t-e),i=n/r+e;if(Dt(r)<Xe)return iE;function s(o,a){var u=i-a,l=r*o;return[u*He(l),i-u*Ke(l)]}return s.invert=function(o,a){var u=i-a,l=Ro(o,Dt(u))*_o(u);return u*r<0&&(l-=mt*_o(o)*_o(u)),[l/r,i-_o(r)*Ki(o*o+u*u)]},s}function Pft(){return y7(Rft).scale(131.154).center([0,13.9389])}var rv=1.340264,iv=-.081106,sv=893e-6,ov=.003796,sE=Ki(3)/2,Lft=12;function Tpe(e,t){var n=Ts(sE*He(t)),r=n*n,i=r*r*r;return[e*Ke(n)/(sE*(rv+3*iv*r+i*(7*sv+9*ov*r))),n*(rv+iv*r+i*(sv+ov*r))]}Tpe.invert=function(e,t){for(var n=t,r=n*n,i=r*r*r,s=0,o,a,u;s<Lft&&(a=n*(rv+iv*r+i*(sv+ov*r))-t,u=rv+3*iv*r+i*(7*sv+9*ov*r),n-=o=a/u,r=n*n,i=r*r*r,!(Dt(o)<Rk));++s);return[sE*e*(rv+3*iv*r+i*(7*sv+9*ov*r))/Ke(n),Ts(He(n)/sE)]};function Bft(){return Ju(Tpe).scale(177.158)}function Dpe(e,t){var n=Ke(t),r=Ke(e)*n;return[n*He(e)/r,He(t)/r]}Dpe.invert=gC(ay);function zft(){return Ju(Dpe).scale(144.049).clipAngle(60)}function jft(){var e=1,t=0,n=0,r=1,i=1,s=0,o,a,u=null,l,c,f,h=1,d=1,p=UI({point:function(v,w){var C=x([v,w]);this.stream.point(C[0],C[1])}}),m=$x,g,y;function b(){return h=e*r,d=e*i,g=y=null,x}function x(v){var w=v[0]*h,C=v[1]*d;if(s){var S=C*o-w*a;w=w*o+C*a,C=S}return[w+t,C+n]}return x.invert=function(v){var w=v[0]-t,C=v[1]-n;if(s){var S=C*o+w*a;w=w*o-C*a,C=S}return[w/h,C/d]},x.stream=function(v){return g&&y===v?g:g=p(m(y=v))},x.postclip=function(v){return arguments.length?(m=v,u=l=c=f=null,b()):m},x.clipExtent=function(v){return arguments.length?(m=v==null?(u=l=c=f=null,$x):cpe(u=+v[0][0],l=+v[0][1],c=+v[1][0],f=+v[1][1]),b()):u==null?null:[[u,l],[c,f]]},x.scale=function(v){return arguments.length?(e=+v,b()):e},x.translate=function(v){return arguments.length?(t=+v[0],n=+v[1],b()):[t,n]},x.angle=function(v){return arguments.length?(s=v%360*yt,a=He(s),o=Ke(s),b()):s*Wn},x.reflectX=function(v){return arguments.length?(r=v?-1:1,b()):r<0},x.reflectY=function(v){return arguments.length?(i=v?-1:1,b()):i<0},x.fitExtent=function(v,w){return WI(x,v,w)},x.fitSize=function(v,w){return p7(x,v,w)},x.fitWidth=function(v,w){return g7(x,v,w)},x.fitHeight=function(v,w){return m7(x,v,w)},x}function Ipe(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(-.013791+r*(.003971*n-.001529*r))),t*(1.007226+n*(.015085+r*(-.044475+.028874*n-.005916*r)))]}Ipe.invert=function(e,t){var n=t,r=25,i;do{var s=n*n,o=s*s;n-=i=(n*(1.007226+s*(.015085+o*(-.044475+.028874*s-.005916*o)))-t)/(1.007226+s*(.015085*3+o*(-.044475*7+.028874*9*s-.005916*11*o)))}while(Dt(i)>Xe&&--r>0);return[e/(.8707+(s=n*n)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),n]};function Uft(){return Ju(Ipe).scale(175.295)}function Fpe(e,t){return[Ke(t)*He(e),He(t)]}Fpe.invert=gC(Ts);function Wft(){return Ju(Fpe).scale(249.5).clipAngle(90+Xe)}function Ope(e,t){var n=Ke(t),r=1+Ke(e)*n;return[n*He(e)/r,He(t)/r]}Ope.invert=gC(function(e){return 2*ay(e)});function Vft(){return Ju(Ope).scale(250).clipAngle(142)}function Npe(e,t){return[Lk(f7((Pn+t)/2)),-e]}Npe.invert=function(e,t){return[-t,2*ay(Xde(e))-Pn]};function Gft(){var e=Ape(Npe),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}var Hft=Math.abs,NP=Math.cos,oE=Math.sin,qft=1e-6,Mpe=Math.PI,MP=Mpe/2,uY=Xft(2);function lY(e){return e>1?MP:e<-1?-MP:Math.asin(e)}function Xft(e){return e>0?Math.sqrt(e):0}function Yft(e,t){var n=e*oE(t),r=30,i;do t-=i=(t+oE(t)-n)/(1+NP(t));while(Hft(i)>qft&&--r>0);return t/2}function Kft(e,t,n){function r(i,s){return[e*i*NP(s=Yft(n,s)),t*oE(s)]}return r.invert=function(i,s){return s=lY(s/t),[i/(e*NP(s)),lY((2*s+oE(2*s))/n)]},r}var Zft=Kft(uY/MP,uY,Mpe);function Jft(){return Ju(Zft).scale(169.529)}const Qft=Cpe(),RP=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function eht(e,t){return function n(){const r=t();return r.type=e,r.path=Cpe().projection(r),r.copy=r.copy||function(){const i=n();return RP.forEach(s=>{r[s]&&i[s](r[s]())}),i.path.pointRadius(r.path.pointRadius()),i},r}}function b7(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(aE[e]=eht(e,t),this):aE[e]||null}function Rpe(e){return e&&e.path||Qft}const aE={albers:_pe,albersusa:Tft,azimuthalequalarea:Dft,azimuthalequidistant:Ift,conicconformal:Nft,conicequalarea:rE,conicequidistant:Pft,equalEarth:Bft,equirectangular:Mft,gnomonic:zft,identity:jft,mercator:Fft,mollweide:Jft,naturalEarth1:Uft,orthographic:Wft,stereographic:Vft,transversemercator:Gft};for(const e in aE)b7(e,aE[e]);function tht(){}const bl=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Ppe(){var e=1,t=1,n=a;function r(u,l){return l.map(c=>i(u,c))}function i(u,l){var c=[],f=[];return s(u,l,h=>{n(h,u,l),nht(h)>0?c.push([h]):f.push(h)}),f.forEach(h=>{for(var d=0,p=c.length,m;d<p;++d)if(rht((m=c[d])[0],h)!==-1){m.push(h);return}}),{type:"MultiPolygon",value:l,coordinates:c}}function s(u,l,c){var f=new Array,h=new Array,d,p,m,g,y,b;for(d=p=-1,g=u[0]>=l,bl[g<<1].forEach(x);++d<e-1;)m=g,g=u[d+1]>=l,bl[m|g<<1].forEach(x);for(bl[g<<0].forEach(x);++p<t-1;){for(d=-1,g=u[p*e+e]>=l,y=u[p*e]>=l,bl[g<<1|y<<2].forEach(x);++d<e-1;)m=g,g=u[p*e+e+d+1]>=l,b=y,y=u[p*e+d+1]>=l,bl[m|g<<1|y<<2|b<<3].forEach(x);bl[g|y<<3].forEach(x)}for(d=-1,y=u[p*e]>=l,bl[y<<2].forEach(x);++d<e-1;)b=y,y=u[p*e+d+1]>=l,bl[y<<2|b<<3].forEach(x);bl[y<<3].forEach(x);function x(v){var w=[v[0][0]+d,v[0][1]+p],C=[v[1][0]+d,v[1][1]+p],S=o(w),_=o(C),$,k;($=h[S])?(k=f[_])?(delete h[$.end],delete f[k.start],$===k?($.ring.push(C),c($.ring)):f[$.start]=h[k.end]={start:$.start,end:k.end,ring:$.ring.concat(k.ring)}):(delete h[$.end],$.ring.push(C),h[$.end=_]=$):($=f[_])?(k=h[S])?(delete f[$.start],delete h[k.end],$===k?($.ring.push(C),c($.ring)):f[k.start]=h[$.end]={start:k.start,end:$.end,ring:k.ring.concat($.ring)}):(delete f[$.start],$.ring.unshift(w),f[$.start=S]=$):f[S]=h[_]={start:S,end:_,ring:[w,C]}}}function o(u){return u[0]*2+u[1]*(e+1)*4}function a(u,l,c){u.forEach(f=>{var h=f[0],d=f[1],p=h|0,m=d|0,g,y=l[m*e+p];h>0&&h<e&&p===h&&(g=l[m*e+p-1],f[0]=h+(c-g)/(y-g)-.5),d>0&&d<t&&m===d&&(g=l[(m-1)*e+p],f[1]=d+(c-g)/(y-g)-.5)})}return r.contour=i,r.size=function(u){if(!arguments.length)return[e,t];var l=Math.floor(u[0]),c=Math.floor(u[1]);return l>=0&&c>=0||ye("invalid size"),e=l,t=c,r},r.smooth=function(u){return arguments.length?(n=u?a:tht,r):n===a},r}function nht(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}function rht(e,t){for(var n=-1,r=t.length,i;++n<r;)if(i=iht(e,t[n]))return i;return 0}function iht(e,t){for(var n=t[0],r=t[1],i=-1,s=0,o=e.length,a=o-1;s<o;a=s++){var u=e[s],l=u[0],c=u[1],f=e[a],h=f[0],d=f[1];if(sht(u,f,t))return 0;c>r!=d>r&&n<(h-l)*(r-c)/(d-c)+l&&(i=-i)}return i}function sht(e,t,n){var r;return oht(e,t,n)&&aht(e[r=+(e[0]===t[0])],n[r],t[r])}function oht(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function aht(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function Lpe(e,t,n){return function(r){var i=Lf(r),s=n?Math.min(i[0],0):i[0],o=i[1],a=o-s,u=t?Uf(s,o,e):a/(e+1);return qs(s+u,o,u)}}function v7(e){he.call(this,null,e)}v7.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};$e(v7,he,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||Oo,s=Ppe().smooth(e.smooth!==!1),o=e.thresholds||uht(r,i,e),a=e.as===null?null:e.as||"contour",u=[];return r.forEach(l=>{const c=i(l),f=s.size([c.width,c.height])(c.values,ht(o)?o:o(c.values));lht(f,c,l,e),f.forEach(h=>{u.push(GD(l,zt(a!=null?{[a]:h}:h)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function uht(e,t,n){const r=Lpe(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?r:r(e.map(i=>Yd(t(i).values)))}function lht(e,t,n,r){let i=r.scale||t.scale,s=r.translate||t.translate;if(Ht(i)&&(i=i(n,r)),Ht(s)&&(s=s(n,r)),(i===1||i==null)&&!s)return;const o=(bp(i)?i:i[0])||1,a=(bp(i)?i:i[1])||1,u=s&&s[0]||0,l=s&&s[1]||0;e.forEach(Bpe(t,o,a,u,l))}function Bpe(e,t,n,r,i){const s=e.x1||0,o=e.y1||0,a=t*n<0;function u(f){f.forEach(l)}function l(f){a&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-s)*t+r,f[1]=(f[1]-o)*n+i}return function(f){return f.coordinates.forEach(u),f}}function cY(e,t,n){const r=e>=0?e:Iz(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function s3(e){return Ht(e)?e:No(+e)}function zpe(){var e=u=>u[0],t=u=>u[1],n=V1,r=[-1,-1],i=960,s=500,o=2;function a(u,l){const c=cY(r[0],u,e)>>o,f=cY(r[1],u,t)>>o,h=c?c+2:0,d=f?f+2:0,p=2*h+(i>>o),m=2*d+(s>>o),g=new Float32Array(p*m),y=new Float32Array(p*m);let b=g;u.forEach(v=>{const w=h+(+e(v)>>o),C=d+(+t(v)>>o);w>=0&&w<p&&C>=0&&C<m&&(g[w+C*p]+=+n(v))}),c>0&&f>0?(Zg(p,m,g,y,c),Jg(p,m,y,g,f),Zg(p,m,g,y,c),Jg(p,m,y,g,f),Zg(p,m,g,y,c),Jg(p,m,y,g,f)):c>0?(Zg(p,m,g,y,c),Zg(p,m,y,g,c),Zg(p,m,g,y,c),b=y):f>0&&(Jg(p,m,g,y,f),Jg(p,m,y,g,f),Jg(p,m,g,y,f),b=y);const x=l?Math.pow(2,-2*o):1/Oue(b);for(let v=0,w=p*m;v<w;++v)b[v]*=x;return{values:b,scale:1<<o,width:p,height:m,x1:h,y1:d,x2:h+(i>>o),y2:d+(s>>o)}}return a.x=function(u){return arguments.length?(e=s3(u),a):e},a.y=function(u){return arguments.length?(t=s3(u),a):t},a.weight=function(u){return arguments.length?(n=s3(u),a):n},a.size=function(u){if(!arguments.length)return[i,s];var l=+u[0],c=+u[1];return l>=0&&c>=0||ye("invalid size"),i=l,s=c,a},a.cellSize=function(u){return arguments.length?((u=+u)>=1||ye("invalid cell size"),o=Math.floor(Math.log(u)/Math.LN2),a):1<<o},a.bandwidth=function(u){return arguments.length?(u=at(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&ye("invalid bandwidth"),r=u,a):r},a}function Zg(e,t,n,r,i){const s=(i<<1)+1;for(let o=0;o<t;++o)for(let a=0,u=0;a<e+i;++a)a<e&&(u+=n[a+o*e]),a>=i&&(a>=s&&(u-=n[a-s+o*e]),r[a-i+o*e]=u/Math.min(a+1,e-1+s-a,s))}function Jg(e,t,n,r,i){const s=(i<<1)+1;for(let o=0;o<e;++o)for(let a=0,u=0;a<t+i;++a)a<t&&(u+=n[o+a*e]),a>=i&&(a>=s&&(u-=n[o+(a-s)*e]),r[o+(a-i)*e]=u/Math.min(a+1,t-1+s-a,s))}function x7(e){he.call(this,null,e)}x7.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const cht=["x","y","weight","size","cellSize","bandwidth"];function jpe(e,t){return cht.forEach(n=>t[n]!=null?e[n](t[n]):0),e}$e(x7,he,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=fht(r,e.groupby),s=(e.groupby||[]).map(Ln),o=jpe(zpe(),e),a=e.as||"grid",u=[];function l(c,f){for(let h=0;h<s.length;++h)c[s[h]]=f[h];return c}return u=i.map(c=>zt(l({[a]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function fht(e,t){var n=[],r=c=>c(a),i,s,o,a,u,l;if(t==null)n.push(e);else for(i={},s=0,o=e.length;s<o;++s)a=e[s],u=t.map(r),l=i[u],l||(i[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function w7(e){he.call(this,null,e)}w7.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};$e(w7,he,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=Ppe().smooth(e.smooth!==!1),i=e.values,s=e.thresholds||Lpe(e.count||10,e.nice,!!i),o=e.size,a,u;return i||(i=t.materialize(t.SOURCE).source,a=jpe(zpe(),e)(i,!0),u=Bpe(a,a.scale||1,a.scale||1,0,0),o=[a.width,a.height],i=a.values),s=ht(s)?s:s(i),i=r.size(o)(i,s),u&&i.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(i||[]).map(zt),n}});const PP="Feature",C7="FeatureCollection",hht="MultiPoint";function S7(e){he.call(this,null,e)}S7.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};$e(S7,he,{transform(e,t){var n=this._features,r=this._points,i=e.fields,s=i&&i[0],o=i&&i[1],a=e.geojson||!i&&Oo,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(vi(a))||s&&t.modified(vi(s))||o&&t.modified(vi(o)),(!this.value||l)&&(u=t.SOURCE,this._features=n=[],this._points=r=[]),a&&t.visit(u,c=>n.push(a(c))),s&&o&&(t.visit(u,c=>{var f=s(c),h=o(c);f!=null&&h!=null&&(f=+f)===f&&(h=+h)===h&&r.push([f,h])}),n=n.concat({type:PP,geometry:{type:hht,coordinates:r}})),this.value={type:C7,features:n}}});function _7(e){he.call(this,null,e)}_7.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};$e(_7,he,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||Oo,s=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=Rpe(e.projection),n.materialize().reflow()):o=i===Oo||t.modified(i.fields)?n.ADD_MOD:n.ADD;const a=dht(r,e.pointRadius);return n.visit(o,u=>u[s]=r(i(u))),r.pointRadius(a),n.modifies(s)}});function dht(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function $7(e){he.call(this,null,e)}$7.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};$e($7,he,{transform(e,t){var n=e.projection,r=e.fields[0],i=e.fields[1],s=e.as||["x","y"],o=s[0],a=s[1],u;function l(c){const f=n([r(c),i(c)]);f?(c[o]=f[0],c[a]=f[1]):(c[o]=void 0,c[a]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(u=t.modified(r.fields)||t.modified(i.fields),t.visit(u?t.ADD_MOD:t.ADD,l)),t.modifies(s)}});function k7(e){he.call(this,null,e)}k7.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};$e(k7,he,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",s=n.ADD;return(!r||e.modified())&&(this.value=r=pht(Rpe(e.projection),e.field||Rf("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,o=>o[i]=r),n.modifies(i)}});function pht(e,t,n){const r=n==null?i=>e(t(i)):i=>{var s=e.pointRadius(),o=e.pointRadius(n)(t(i));return e.pointRadius(s),o};return r.context=i=>(e.context(i),r),r}function E7(e){he.call(this,[],e),this.generator=uft()}E7.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};$e(E7,he,{transform(e,t){var n=this.value,r=this.generator,i;if(!n.length||e.modified())for(const s in e)Ht(r[s])&&r[s](e[s]);return i=r(),n.length?t.mod.push(xue(n[0],i)):t.add.push(zt(i)),n[0]=i,t}});function A7(e){he.call(this,null,e)}A7.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};$e(A7,he,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||Oo,s=mht(e.opacity,e),o=ght(e.color,e),a=e.as||"image",u={$x:0,$y:0,$value:0,$max:r?Yd(n.map(l=>Yd(i(l).values))):0};return n.forEach(l=>{const c=i(l),f=St({},l,u);r||(f.$max=Yd(c.values||[])),l[a]=yht(c,f,o.dep?o:No(o(f)),s.dep?s:No(s(f)))}),t.reflow(!0).modifies(a)}});function ght(e,t){let n;return Ht(e)?(n=r=>As(e(r,t)),n.dep=Upe(e)):n=No(As(e||"#888")),n}function mht(e,t){let n;return Ht(e)?(n=r=>e(r,t),n.dep=Upe(e)):e?n=No(e):(n=r=>r.$value/r.$max||0,n.dep=!0),n}function Upe(e){if(!Ht(e))return!1;const t=nc(vi(e));return t.$x||t.$y||t.$value||t.$max}function yht(e,t,n,r){const i=e.width,s=e.height,o=e.x1||0,a=e.y1||0,u=e.x2||i,l=e.y2||s,c=e.values,f=c?g=>c[g]:Vc,h=bc(u-o,l-a),d=h.getContext("2d"),p=d.getImageData(0,0,u-o,l-a),m=p.data;for(let g=a,y=0;g<l;++g){t.$y=g-a;for(let b=o,x=g*i;b<u;++b,y+=4){t.$x=b-o,t.$value=f(b+x);const v=n(t);m[y+0]=v.r,m[y+1]=v.g,m[y+2]=v.b,m[y+3]=~~(255*r(t))}}return d.putImageData(p,0,0),h}function Wpe(e){he.call(this,null,e),this.modified(!0)}$e(Wpe,he,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=vht(e.type),RP.forEach(r=>{e[r]!=null&&fY(n,r,e[r])})):RP.forEach(r=>{e.modified(r)&&fY(n,r,e[r])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&bht(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function bht(e,t){const n=xht(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function vht(e){const t=b7((e||"mercator").toLowerCase());return t||ye("Unrecognized projection type: "+e),t()}function fY(e,t,n){Ht(e[t])&&e[t](n)}function xht(e){return e=at(e),e.length===1?e[0]:{type:C7,features:e.reduce((t,n)=>t.concat(wht(n)),[])}}function wht(e){return e.type===C7?e.features:at(e).filter(t=>t!=null).map(t=>t.type===PP?t:{type:PP,geometry:t})}const Cht=Object.freeze(Object.defineProperty({__proto__:null,contour:w7,geojson:S7,geopath:_7,geopoint:$7,geoshape:k7,graticule:E7,heatmap:A7,isocontour:v7,kde2d:x7,projection:Wpe},Symbol.toStringTag,{value:"Module"}));function Sht(e,t){var n,r=1;e==null&&(e=0),t==null&&(t=0);function i(){var s,o=n.length,a,u=0,l=0;for(s=0;s<o;++s)a=n[s],u+=a.x,l+=a.y;for(u=(u/o-e)*r,l=(l/o-t)*r,s=0;s<o;++s)a=n[s],a.x-=u,a.y-=l}return i.initialize=function(s){n=s},i.x=function(s){return arguments.length?(e=+s,i):e},i.y=function(s){return arguments.length?(t=+s,i):t},i.strength=function(s){return arguments.length?(r=+s,i):r},i}function _ht(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return Vpe(this.cover(t,n),t,n,e)}function Vpe(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,s=e._root,o={data:r},a=e._x0,u=e._y0,l=e._x1,c=e._y1,f,h,d,p,m,g,y,b;if(!s)return e._root=o,e;for(;s.length;)if((m=t>=(f=(a+l)/2))?a=f:l=f,(g=n>=(h=(u+c)/2))?u=h:c=h,i=s,!(s=s[y=g<<1|m]))return i[y]=o,e;if(d=+e._x.call(null,s.data),p=+e._y.call(null,s.data),t===d&&n===p)return o.next=s,i?i[y]=o:e._root=o,e;do i=i?i[y]=new Array(4):e._root=new Array(4),(m=t>=(f=(a+l)/2))?a=f:l=f,(g=n>=(h=(u+c)/2))?u=h:c=h;while((y=g<<1|m)===(b=(p>=h)<<1|d>=f));return i[b]=s,i[y]=o,e}function $ht(e){var t,n,r=e.length,i,s,o=new Array(r),a=new Array(r),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,t=e[n]))||isNaN(s=+this._y.call(null,t))||(o[n]=i,a[n]=s,i<u&&(u=i),i>c&&(c=i),s<l&&(l=s),s>f&&(f=s));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<r;++n)Vpe(this,o[n],a[n],e[n]);return this}function kht(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,s=(r=Math.floor(t))+1;else{for(var o=i-n||1,a=this._root,u,l;n>e||e>=i||r>t||t>=s;)switch(l=(t<r)<<1|e<n,u=new Array(4),u[l]=a,a=u,o*=2,l){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function Eht(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function Aht(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function ji(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function Tht(e,t,n){var r,i=this._x0,s=this._y0,o,a,u,l,c=this._x1,f=this._y1,h=[],d=this._root,p,m;for(d&&h.push(new ji(d,i,s,c,f)),n==null?n=1/0:(i=e-n,s=t-n,c=e+n,f=t+n,n*=n);p=h.pop();)if(!(!(d=p.node)||(o=p.x0)>c||(a=p.y0)>f||(u=p.x1)<i||(l=p.y1)<s))if(d.length){var g=(o+u)/2,y=(a+l)/2;h.push(new ji(d[3],g,y,u,l),new ji(d[2],o,y,g,l),new ji(d[1],g,a,u,y),new ji(d[0],o,a,g,y)),(m=(t>=y)<<1|e>=g)&&(p=h[h.length-1],h[h.length-1]=h[h.length-1-m],h[h.length-1-m]=p)}else{var b=e-+this._x.call(null,d.data),x=t-+this._y.call(null,d.data),v=b*b+x*x;if(v<n){var w=Math.sqrt(n=v);i=e-w,s=t-w,c=e+w,f=t+w,r=d.data}}return r}function Dht(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,r,i,s,o=this._x0,a=this._y0,u=this._x1,l=this._y1,c,f,h,d,p,m,g,y;if(!n)return this;if(n.length)for(;;){if((p=c>=(h=(o+u)/2))?o=h:u=h,(m=f>=(d=(a+l)/2))?a=d:l=d,t=n,!(n=n[g=m<<1|p]))return this;if(!n.length)break;(t[g+1&3]||t[g+2&3]||t[g+3&3])&&(r=t,y=g)}for(;n.data!==e;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):t?(s?t[g]=s:delete t[g],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(r?r[y]=n:this._root=n),this):(this._root=s,this)}function Iht(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function Fht(){return this._root}function Oht(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function Nht(e){var t=[],n,r=this._root,i,s,o,a,u;for(r&&t.push(new ji(r,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(r=n.node,s=n.x0,o=n.y0,a=n.x1,u=n.y1)&&r.length){var l=(s+a)/2,c=(o+u)/2;(i=r[3])&&t.push(new ji(i,l,c,a,u)),(i=r[2])&&t.push(new ji(i,s,c,l,u)),(i=r[1])&&t.push(new ji(i,l,o,a,c)),(i=r[0])&&t.push(new ji(i,s,o,l,c))}return this}function Mht(e){var t=[],n=[],r;for(this._root&&t.push(new ji(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,u=r.x1,l=r.y1,c=(o+u)/2,f=(a+l)/2;(s=i[0])&&t.push(new ji(s,o,a,c,f)),(s=i[1])&&t.push(new ji(s,c,a,u,f)),(s=i[2])&&t.push(new ji(s,o,f,c,l)),(s=i[3])&&t.push(new ji(s,c,f,u,l))}n.push(r)}for(;r=n.pop();)e(r.node,r.x0,r.y0,r.x1,r.y1);return this}function Rht(e){return e[0]}function Pht(e){return arguments.length?(this._x=e,this):this._x}function Lht(e){return e[1]}function Bht(e){return arguments.length?(this._y=e,this):this._y}function T7(e,t,n){var r=new D7(t??Rht,n??Lht,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function D7(e,t,n,r,i,s){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function hY(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var ns=T7.prototype=D7.prototype;ns.copy=function(){var e=new D7(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,r;if(!t)return e;if(!t.length)return e._root=hY(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var i=0;i<4;++i)(r=t.source[i])&&(r.length?n.push({source:r,target:t.target[i]=new Array(4)}):t.target[i]=hY(r));return e};ns.add=_ht;ns.addAll=$ht;ns.cover=kht;ns.data=Eht;ns.extent=Aht;ns.find=Tht;ns.remove=Dht;ns.removeAll=Iht;ns.root=Fht;ns.size=Oht;ns.visit=Nht;ns.visitAfter=Mht;ns.x=Pht;ns.y=Bht;function Wi(e){return function(){return e}}function tf(e){return(e()-.5)*1e-6}function zht(e){return e.x+e.vx}function jht(e){return e.y+e.vy}function Uht(e){var t,n,r,i=1,s=1;typeof e!="function"&&(e=Wi(e==null?1:+e));function o(){for(var l,c=t.length,f,h,d,p,m,g,y=0;y<s;++y)for(f=T7(t,zht,jht).visitAfter(a),l=0;l<c;++l)h=t[l],m=n[h.index],g=m*m,d=h.x+h.vx,p=h.y+h.vy,f.visit(b);function b(x,v,w,C,S){var _=x.data,$=x.r,k=m+$;if(_){if(_.index>h.index){var E=d-_.x-_.vx,F=p-_.y-_.vy,T=E*E+F*F;T<k*k&&(E===0&&(E=tf(r),T+=E*E),F===0&&(F=tf(r),T+=F*F),T=(k-(T=Math.sqrt(T)))/T*i,h.vx+=(E*=T)*(k=($*=$)/(g+$)),h.vy+=(F*=T)*k,_.vx-=E*(k=1-k),_.vy-=F*k)}return}return v>d+k||C<d-k||w>p+k||S<p-k}}function a(l){if(l.data)return l.r=n[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function u(){if(t){var l,c=t.length,f;for(n=new Array(c),l=0;l<c;++l)f=t[l],n[f.index]=+e(f,l,t)}}return o.initialize=function(l,c){t=l,r=c,u()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(i=+l,o):i},o.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Wi(+l),u(),o):e},o}function Wht(e){return e.index}function dY(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function Vht(e){var t=Wht,n=f,r,i=Wi(30),s,o,a,u,l,c=1;e==null&&(e=[]);function f(g){return 1/Math.min(a[g.source.index],a[g.target.index])}function h(g){for(var y=0,b=e.length;y<c;++y)for(var x=0,v,w,C,S,_,$,k;x<b;++x)v=e[x],w=v.source,C=v.target,S=C.x+C.vx-w.x-w.vx||tf(l),_=C.y+C.vy-w.y-w.vy||tf(l),$=Math.sqrt(S*S+_*_),$=($-s[x])/$*g*r[x],S*=$,_*=$,C.vx-=S*(k=u[x]),C.vy-=_*k,w.vx+=S*(k=1-k),w.vy+=_*k}function d(){if(o){var g,y=o.length,b=e.length,x=new Map(o.map((w,C)=>[t(w,C,o),w])),v;for(g=0,a=new Array(y);g<b;++g)v=e[g],v.index=g,typeof v.source!="object"&&(v.source=dY(x,v.source)),typeof v.target!="object"&&(v.target=dY(x,v.target)),a[v.source.index]=(a[v.source.index]||0)+1,a[v.target.index]=(a[v.target.index]||0)+1;for(g=0,u=new Array(b);g<b;++g)v=e[g],u[g]=a[v.source.index]/(a[v.source.index]+a[v.target.index]);r=new Array(b),p(),s=new Array(b),m()}}function p(){if(o)for(var g=0,y=e.length;g<y;++g)r[g]=+n(e[g],g,e)}function m(){if(o)for(var g=0,y=e.length;g<y;++g)s[g]=+i(e[g],g,e)}return h.initialize=function(g,y){o=g,l=y,d()},h.links=function(g){return arguments.length?(e=g,d(),h):e},h.id=function(g){return arguments.length?(t=g,h):t},h.iterations=function(g){return arguments.length?(c=+g,h):c},h.strength=function(g){return arguments.length?(n=typeof g=="function"?g:Wi(+g),p(),h):n},h.distance=function(g){return arguments.length?(i=typeof g=="function"?g:Wi(+g),m(),h):i},h}var Ght={value:()=>{}};function Gpe(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new G_(n)}function G_(e){this._=e}function Hht(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}G_.prototype=Gpe.prototype={constructor:G_,on:function(e,t){var n=this._,r=Hht(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=qht(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=pY(n[i],e.name,t);else if(t==null)for(i in n)n[i]=pY(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new G_(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function qht(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function pY(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Ght,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var d0=0,Lb=0,Jy=0,Hpe=1e3,uE,Bb,lE=0,Ip=0,GI=0,Ex=typeof performance=="object"&&performance.now?performance:Date,qpe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function I7(){return Ip||(qpe(Xht),Ip=Ex.now()+GI)}function Xht(){Ip=0}function cE(){this._call=this._time=this._next=null}cE.prototype=Xpe.prototype={constructor:cE,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?I7():+n)+(t==null?0:+t),!this._next&&Bb!==this&&(Bb?Bb._next=this:uE=this,Bb=this),this._call=e,this._time=n,LP()},stop:function(){this._call&&(this._call=null,this._time=1/0,LP())}};function Xpe(e,t,n){var r=new cE;return r.restart(e,t,n),r}function Yht(){I7(),++d0;for(var e=uE,t;e;)(t=Ip-e._time)>=0&&e._call.call(null,t),e=e._next;--d0}function gY(){Ip=(lE=Ex.now())+GI,d0=Lb=0;try{Yht()}finally{d0=0,Zht(),Ip=0}}function Kht(){var e=Ex.now(),t=e-lE;t>Hpe&&(GI-=t,lE=e)}function Zht(){for(var e,t=uE,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:uE=n);Bb=e,LP(r)}function LP(e){if(!d0){Lb&&(Lb=clearTimeout(Lb));var t=e-Ip;t>24?(e<1/0&&(Lb=setTimeout(gY,e-Ex.now()-GI)),Jy&&(Jy=clearInterval(Jy))):(Jy||(lE=Ex.now(),Jy=setInterval(Kht,Hpe)),d0=1,qpe(gY))}}function Jht(e,t,n){var r=new cE,i=t;return t==null?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(s,o,a){o=+o,a=a==null?I7():+a,r._restart(function u(l){l+=i,r._restart(u,i+=o,a),s(l)},o,a)},r.restart(e,t,n),r)}const Qht=1664525,edt=1013904223,mY=4294967296;function tdt(){let e=1;return()=>(e=(Qht*e+edt)%mY)/mY}function ndt(e){return e.x}function rdt(e){return e.y}var idt=10,sdt=Math.PI*(3-Math.sqrt(5));function odt(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,a=new Map,u=Xpe(f),l=Gpe("tick","end"),c=tdt();e==null&&(e=[]);function f(){h(),l.call("tick",t),n<r&&(u.stop(),l.call("end",t))}function h(m){var g,y=e.length,b;m===void 0&&(m=1);for(var x=0;x<m;++x)for(n+=(s-n)*i,a.forEach(function(v){v(n)}),g=0;g<y;++g)b=e[g],b.fx==null?b.x+=b.vx*=o:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=o:(b.y=b.fy,b.vy=0);return t}function d(){for(var m=0,g=e.length,y;m<g;++m){if(y=e[m],y.index=m,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var b=idt*Math.sqrt(.5+m),x=m*sdt;y.x=b*Math.cos(x),y.y=b*Math.sin(x)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(m){return m.initialize&&m.initialize(e,c),m}return d(),t={tick:h,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(m){return arguments.length?(e=m,d(),a.forEach(p),t):e},alpha:function(m){return arguments.length?(n=+m,t):n},alphaMin:function(m){return arguments.length?(r=+m,t):r},alphaDecay:function(m){return arguments.length?(i=+m,t):+i},alphaTarget:function(m){return arguments.length?(s=+m,t):s},velocityDecay:function(m){return arguments.length?(o=1-m,t):1-o},randomSource:function(m){return arguments.length?(c=m,a.forEach(p),t):c},force:function(m,g){return arguments.length>1?(g==null?a.delete(m):a.set(m,p(g)),t):a.get(m)},find:function(m,g,y){var b=0,x=e.length,v,w,C,S,_;for(y==null?y=1/0:y*=y,b=0;b<x;++b)S=e[b],v=m-S.x,w=g-S.y,C=v*v+w*w,C<y&&(_=S,y=C);return _},on:function(m,g){return arguments.length>1?(l.on(m,g),t):l.on(m)}}}function adt(){var e,t,n,r,i=Wi(-30),s,o=1,a=1/0,u=.81;function l(d){var p,m=e.length,g=T7(e,ndt,rdt).visitAfter(f);for(r=d,p=0;p<m;++p)t=e[p],g.visit(h)}function c(){if(e){var d,p=e.length,m;for(s=new Array(p),d=0;d<p;++d)m=e[d],s[m.index]=+i(m,d,e)}}function f(d){var p=0,m,g,y=0,b,x,v;if(d.length){for(b=x=v=0;v<4;++v)(m=d[v])&&(g=Math.abs(m.value))&&(p+=m.value,y+=g,b+=g*m.x,x+=g*m.y);d.x=b/y,d.y=x/y}else{m=d,m.x=m.data.x,m.y=m.data.y;do p+=s[m.data.index];while(m=m.next)}d.value=p}function h(d,p,m,g){if(!d.value)return!0;var y=d.x-t.x,b=d.y-t.y,x=g-p,v=y*y+b*b;if(x*x/u<v)return v<a&&(y===0&&(y=tf(n),v+=y*y),b===0&&(b=tf(n),v+=b*b),v<o&&(v=Math.sqrt(o*v)),t.vx+=y*d.value*r/v,t.vy+=b*d.value*r/v),!0;if(d.length||v>=a)return;(d.data!==t||d.next)&&(y===0&&(y=tf(n),v+=y*y),b===0&&(b=tf(n),v+=b*b),v<o&&(v=Math.sqrt(o*v)));do d.data!==t&&(x=s[d.data.index]*r/v,t.vx+=y*x,t.vy+=b*x);while(d=d.next)}return l.initialize=function(d,p){e=d,n=p,c()},l.strength=function(d){return arguments.length?(i=typeof d=="function"?d:Wi(+d),c(),l):i},l.distanceMin=function(d){return arguments.length?(o=d*d,l):Math.sqrt(o)},l.distanceMax=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.theta=function(d){return arguments.length?(u=d*d,l):Math.sqrt(u)},l}function udt(e){var t=Wi(.1),n,r,i;typeof e!="function"&&(e=Wi(e==null?0:+e));function s(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vx+=(i[u]-c.x)*r[u]*a}function o(){if(n){var a,u=n.length;for(r=new Array(u),i=new Array(u),a=0;a<u;++a)r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Wi(+a),o(),s):t},s.x=function(a){return arguments.length?(e=typeof a=="function"?a:Wi(+a),o(),s):e},s}function ldt(e){var t=Wi(.1),n,r,i;typeof e!="function"&&(e=Wi(e==null?0:+e));function s(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vy+=(i[u]-c.y)*r[u]*a}function o(){if(n){var a,u=n.length;for(r=new Array(u),i=new Array(u),a=0;a<u;++a)r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Wi(+a),o(),s):t},s.y=function(a){return arguments.length?(e=typeof a=="function"?a:Wi(+a),o(),s):e},s}const yY={center:Sht,collide:Uht,nbody:adt,link:Vht,x:udt,y:ldt},zb="forces",BP=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],cdt=["static","iterations"],Ype=["x","y","vx","vy"];function F7(e){he.call(this,null,e)}F7.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Ype}]};$e(F7,he,{transform(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(BP),s=e.iterations||300;if(n?(r&&(t.modifies("index"),n.nodes(t.source)),(i||t.changed(t.MOD))&&Kpe(n,e,0,t)):(this.value=n=hdt(t.source,e),n.on("tick",fdt(t.dataflow,this)),e.static||(r=!0,n.tick()),t.modifies("index")),i||r||e.modified(cdt)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),e.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let a=this._argops,u=0,l=a.length,c;u<l;++u)if(c=a[u],!(c.name!==zb||c.op._argval.force!=="link")){for(var r=c.op._argops,i=0,s=r.length,o;i<s;++i)if(r[i].name==="links"&&(o=r[i].op.source)){n.pulse(o,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(Ype)}});function fdt(e,t){return()=>e.touch(t).run()}function hdt(e,t){const n=odt(e),r=n.stop,i=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,i()),n.stop=()=>(s=!0,r()),Kpe(n,t,!0).on("end",()=>s=!0)}function Kpe(e,t,n,r){var i=at(t.forces),s,o,a,u;for(s=0,o=BP.length;s<o;++s)a=BP[s],a!==zb&&t.modified(a)&&e[a](t[a]);for(s=0,o=i.length;s<o;++s)u=zb+s,a=n||t.modified(zb,s)?pdt(i[s]):r&&ddt(i[s],r)?e.force(u):null,a&&e.force(u,a);for(o=e.numForces||0;s<o;++s)e.force(zb+s,null);return e.numForces=i.length,e}function ddt(e,t){var n,r;for(n in e)if(Ht(r=e[n])&&t.modified(vi(r)))return 1;return 0}function pdt(e){var t,n;lt(yY,e.force)||ye("Unrecognized force: "+e.force),t=yY[e.force]();for(n in e)Ht(t[n])&&gdt(t[n],e[n],e);return t}function gdt(e,t,n){e(Ht(t)?r=>t(r,n):t)}const mdt=Object.freeze(Object.defineProperty({__proto__:null,force:F7},Symbol.toStringTag,{value:"Module"}));function ydt(e,t){return e.parent===t.parent?1:2}function bdt(e){return e.reduce(vdt,0)/e.length}function vdt(e,t){return e+t.x}function xdt(e){return 1+e.reduce(wdt,0)}function wdt(e,t){return Math.max(e,t.y)}function Cdt(e){for(var t;t=e.children;)e=t[0];return e}function Sdt(e){for(var t;t=e.children;)e=t[t.length-1];return e}function _dt(){var e=ydt,t=1,n=1,r=!1;function i(s){var o,a=0;s.eachAfter(function(h){var d=h.children;d?(h.x=bdt(d),h.y=xdt(d)):(h.x=o?a+=e(h,o):0,h.y=0,o=h)});var u=Cdt(s),l=Sdt(s),c=u.x-e(u,l)/2,f=l.x+e(l,u)/2;return s.eachAfter(r?function(h){h.x=(h.x-s.x)*t,h.y=(s.y-h.y)*n}:function(h){h.x=(h.x-c)/(f-c)*t,h.y=(1-(s.y?h.y/s.y:1))*n})}return i.separation=function(s){return arguments.length?(e=s,i):e},i.size=function(s){return arguments.length?(r=!1,t=+s[0],n=+s[1],i):r?null:[t,n]},i.nodeSize=function(s){return arguments.length?(r=!0,t=+s[0],n=+s[1],i):r?[t,n]:null},i}function $dt(e){var t=0,n=e.children,r=n&&n.length;if(!r)t=1;else for(;--r>=0;)t+=n[r].value;e.value=t}function kdt(){return this.eachAfter($dt)}function Edt(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this}function Adt(e,t){for(var n=this,r=[n],i,s,o=-1;n=r.pop();)if(e.call(t,n,++o,this),i=n.children)for(s=i.length-1;s>=0;--s)r.push(i[s]);return this}function Tdt(e,t){for(var n=this,r=[n],i=[],s,o,a,u=-1;n=r.pop();)if(i.push(n),s=n.children)for(o=0,a=s.length;o<a;++o)r.push(s[o]);for(;n=i.pop();)e.call(t,n,++u,this);return this}function Ddt(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r}function Idt(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n})}function Fdt(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function Odt(e){for(var t=this,n=Ndt(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r}function Ndt(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}function Mdt(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function Rdt(){return Array.from(this)}function Pdt(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function Ldt(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*Bdt(){var e=this,t,n=[e],r,i,s;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,r=e.children)for(i=0,s=r.length;i<s;++i)n.push(r[i]);while(n.length)}function O7(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=Udt)):t===void 0&&(t=jdt);for(var n=new p0(e),r,i=[n],s,o,a,u;r=i.pop();)if((o=t(r.data))&&(u=(o=Array.from(o)).length))for(r.children=o,a=u-1;a>=0;--a)i.push(s=o[a]=new p0(o[a])),s.parent=r,s.depth=r.depth+1;return n.eachBefore(Zpe)}function zdt(){return O7(this).eachBefore(Wdt)}function jdt(e){return e.children}function Udt(e){return Array.isArray(e)?e[1]:null}function Wdt(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function Zpe(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function p0(e){this.data=e,this.depth=this.height=0,this.parent=null}p0.prototype=O7.prototype={constructor:p0,count:kdt,each:Edt,eachAfter:Tdt,eachBefore:Adt,find:Ddt,sum:Idt,sort:Fdt,path:Odt,ancestors:Mdt,descendants:Rdt,leaves:Pdt,links:Ldt,copy:zdt,[Symbol.iterator]:Bdt};function Vdt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Gdt(e){for(var t=e.length,n,r;t;)r=Math.random()*t--|0,n=e[t],e[t]=e[r],e[r]=n;return e}function Hdt(e){for(var t=0,n=(e=Gdt(Array.from(e))).length,r=[],i,s;t<n;)i=e[t],s&&Jpe(s,i)?++t:(s=Xdt(r=qdt(r,i)),t=0);return s}function qdt(e,t){var n,r;if(o3(t,e))return[t];for(n=0;n<e.length;++n)if(QS(t,e[n])&&o3(jb(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(QS(jb(e[n],e[r]),t)&&QS(jb(e[n],t),e[r])&&QS(jb(e[r],t),e[n])&&o3(Qpe(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function QS(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function Jpe(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function o3(e,t){for(var n=0;n<t.length;++n)if(!Jpe(e,t[n]))return!1;return!0}function Xdt(e){switch(e.length){case 1:return Ydt(e[0]);case 2:return jb(e[0],e[1]);case 3:return Qpe(e[0],e[1],e[2])}}function Ydt(e){return{x:e.x,y:e.y,r:e.r}}function jb(e,t){var n=e.x,r=e.y,i=e.r,s=t.x,o=t.y,a=t.r,u=s-n,l=o-r,c=a-i,f=Math.sqrt(u*u+l*l);return{x:(n+s+u/f*c)/2,y:(r+o+l/f*c)/2,r:(f+i+a)/2}}function Qpe(e,t,n){var r=e.x,i=e.y,s=e.r,o=t.x,a=t.y,u=t.r,l=n.x,c=n.y,f=n.r,h=r-o,d=r-l,p=i-a,m=i-c,g=u-s,y=f-s,b=r*r+i*i-s*s,x=b-o*o-a*a+u*u,v=b-l*l-c*c+f*f,w=d*p-h*m,C=(p*v-m*x)/(w*2)-r,S=(m*g-p*y)/w,_=(d*x-h*v)/(w*2)-i,$=(h*y-d*g)/w,k=S*S+$*$-1,E=2*(s+C*S+_*$),F=C*C+_*_-s*s,T=-(k?(E+Math.sqrt(E*E-4*k*F))/(2*k):F/E);return{x:r+C+S*T,y:i+_+$*T,r:T}}function bY(e,t,n){var r=e.x-t.x,i,s,o=e.y-t.y,a,u,l=r*r+o*o;l?(s=t.r+n.r,s*=s,u=e.r+n.r,u*=u,s>u?(i=(l+u-s)/(2*l),a=Math.sqrt(Math.max(0,u/l-i*i)),n.x=e.x-i*r-a*o,n.y=e.y-i*o+a*r):(i=(l+s-u)/(2*l),a=Math.sqrt(Math.max(0,s/l-i*i)),n.x=t.x+i*r-a*o,n.y=t.y+i*o+a*r)):(n.x=t.x+n.r,n.y=t.y)}function vY(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function xY(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,s=(t.y*n.r+n.y*t.r)/r;return i*i+s*s}function e_(e){this._=e,this.next=null,this.previous=null}function Kdt(e){if(!(i=(e=Vdt(e)).length))return 0;var t,n,r,i,s,o,a,u,l,c,f;if(t=e[0],t.x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;bY(n,t,r=e[2]),t=new e_(t),n=new e_(n),r=new e_(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(a=3;a<i;++a){bY(t._,n._,r=e[a]),r=new e_(r),u=n.next,l=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(vY(u._,r._)){n=u,t.next=n,n.previous=t,--a;continue e}c+=u._.r,u=u.next}else{if(vY(l._,r._)){t=l,t.next=n,n.previous=t,--a;continue e}f+=l._.r,l=l.previous}while(u!==l.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,s=xY(t);(r=r.next)!==n;)(o=xY(r))<s&&(t=r,s=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=Hdt(t),a=0;a<i;++a)t=e[a],t.x-=r.x,t.y-=r.y;return r.r}function Zdt(e){return e==null?null:fE(e)}function fE(e){if(typeof e!="function")throw new Error;return e}function $d(){return 0}function om(e){return function(){return e}}function Jdt(e){return Math.sqrt(e.value)}function Qdt(){var e=null,t=1,n=1,r=$d;function i(s){return s.x=t/2,s.y=n/2,e?s.eachBefore(wY(e)).eachAfter(a3(r,.5)).eachBefore(CY(1)):s.eachBefore(wY(Jdt)).eachAfter(a3($d,1)).eachAfter(a3(r,s.r/Math.min(t,n))).eachBefore(CY(Math.min(t,n)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(e=Zdt(s),i):e},i.size=function(s){return arguments.length?(t=+s[0],n=+s[1],i):[t,n]},i.padding=function(s){return arguments.length?(r=typeof s=="function"?s:om(+s),i):r},i}function wY(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function a3(e,t){return function(n){if(r=n.children){var r,i,s=r.length,o=e(n)*t||0,a;if(o)for(i=0;i<s;++i)r[i].r+=o;if(a=Kdt(r),o)for(i=0;i<s;++i)r[i].r-=o;n.r=a+o}}}function CY(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function ege(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function mC(e,t,n,r,i){for(var s=e.children,o,a=-1,u=s.length,l=e.value&&(r-t)/e.value;++a<u;)o=s[a],o.y0=n,o.y1=i,o.x0=t,o.x1=t+=o.value*l}function ept(){var e=1,t=1,n=0,r=!1;function i(o){var a=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/a,o.eachBefore(s(t,a)),r&&o.eachBefore(ege),o}function s(o,a){return function(u){u.children&&mC(u,u.x0,o*(u.depth+1)/a,u.x1,o*(u.depth+2)/a);var l=u.x0,c=u.y0,f=u.x1-n,h=u.y1-n;f<l&&(l=f=(l+f)/2),h<c&&(c=h=(c+h)/2),u.x0=l,u.y0=c,u.x1=f,u.y1=h}}return i.round=function(o){return arguments.length?(r=!!o,i):r},i.size=function(o){return arguments.length?(e=+o[0],t=+o[1],i):[e,t]},i.padding=function(o){return arguments.length?(n=+o,i):n},i}var tpt={depth:-1},SY={};function npt(e){return e.id}function rpt(e){return e.parentId}function _Y(){var e=npt,t=rpt;function n(r){var i=Array.from(r),s=i.length,o,a,u,l,c,f,h,d=new Map;for(a=0;a<s;++a)o=i[a],c=i[a]=new p0(o),(f=e(o,a,r))!=null&&(f+="")&&(h=c.id=f,d.set(h,d.has(h)?SY:c)),(f=t(o,a,r))!=null&&(f+="")&&(c.parent=f);for(a=0;a<s;++a)if(c=i[a],f=c.parent){if(l=d.get(f),!l)throw new Error("missing: "+f);if(l===SY)throw new Error("ambiguous: "+f);l.children?l.children.push(c):l.children=[c],c.parent=l}else{if(u)throw new Error("multiple roots");u=c}if(!u)throw new Error("no root");if(u.parent=tpt,u.eachBefore(function(p){p.depth=p.parent.depth+1,--s}).eachBefore(Zpe),u.parent=null,s>0)throw new Error("cycle");return u}return n.id=function(r){return arguments.length?(e=fE(r),n):e},n.parentId=function(r){return arguments.length?(t=fE(r),n):t},n}function ipt(e,t){return e.parent===t.parent?1:2}function u3(e){var t=e.children;return t?t[0]:e.t}function l3(e){var t=e.children;return t?t[t.length-1]:e.t}function spt(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function opt(e){for(var t=0,n=0,r=e.children,i=r.length,s;--i>=0;)s=r[i],s.z+=t,s.m+=t,t+=s.s+(n+=s.c)}function apt(e,t,n){return e.a.parent===t.parent?e.a:n}function H_(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}H_.prototype=Object.create(p0.prototype);function upt(e){for(var t=new H_(e,0),n,r=[t],i,s,o,a;n=r.pop();)if(s=n._.children)for(n.children=new Array(a=s.length),o=a-1;o>=0;--o)r.push(i=n.children[o]=new H_(s[o],o)),i.parent=n;return(t.parent=new H_(null,0)).children=[t],t}function lpt(){var e=ipt,t=1,n=1,r=null;function i(l){var c=upt(l);if(c.eachAfter(s),c.parent.m=-c.z,c.eachBefore(o),r)l.eachBefore(u);else{var f=l,h=l,d=l;l.eachBefore(function(b){b.x<f.x&&(f=b),b.x>h.x&&(h=b),b.depth>d.depth&&(d=b)});var p=f===h?1:e(f,h)/2,m=p-f.x,g=t/(h.x+p+m),y=n/(d.depth||1);l.eachBefore(function(b){b.x=(b.x+m)*g,b.y=b.depth*y})}return l}function s(l){var c=l.children,f=l.parent.children,h=l.i?f[l.i-1]:null;if(c){opt(l);var d=(c[0].z+c[c.length-1].z)/2;h?(l.z=h.z+e(l._,h._),l.m=l.z-d):l.z=d}else h&&(l.z=h.z+e(l._,h._));l.parent.A=a(l,h,l.parent.A||f[0])}function o(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function a(l,c,f){if(c){for(var h=l,d=l,p=c,m=h.parent.children[0],g=h.m,y=d.m,b=p.m,x=m.m,v;p=l3(p),h=u3(h),p&&h;)m=u3(m),d=l3(d),d.a=l,v=p.z+b-h.z-g+e(p._,h._),v>0&&(spt(apt(p,l,f),l,v),g+=v,y+=v),b+=p.m,g+=h.m,x+=m.m,y+=d.m;p&&!l3(d)&&(d.t=p,d.m+=b-y),h&&!u3(m)&&(m.t=h,m.m+=g-x,f=l)}return f}function u(l){l.x*=t,l.y=l.depth*n}return i.separation=function(l){return arguments.length?(e=l,i):e},i.size=function(l){return arguments.length?(r=!1,t=+l[0],n=+l[1],i):r?null:[t,n]},i.nodeSize=function(l){return arguments.length?(r=!0,t=+l[0],n=+l[1],i):r?[t,n]:null},i}function HI(e,t,n,r,i){for(var s=e.children,o,a=-1,u=s.length,l=e.value&&(i-n)/e.value;++a<u;)o=s[a],o.x0=t,o.x1=r,o.y0=n,o.y1=n+=o.value*l}var tge=(1+Math.sqrt(5))/2;function nge(e,t,n,r,i,s){for(var o=[],a=t.children,u,l,c=0,f=0,h=a.length,d,p,m=t.value,g,y,b,x,v,w,C;c<h;){d=i-n,p=s-r;do g=a[f++].value;while(!g&&f<h);for(y=b=g,w=Math.max(p/d,d/p)/(m*e),C=g*g*w,v=Math.max(b/C,C/y);f<h;++f){if(g+=l=a[f].value,l<y&&(y=l),l>b&&(b=l),C=g*g*w,x=Math.max(b/C,C/y),x>v){g-=l;break}v=x}o.push(u={value:g,dice:d<p,children:a.slice(c,f)}),u.dice?mC(u,n,r,i,m?r+=p*g/m:s):HI(u,n,r,m?n+=d*g/m:i,s),m-=g,c=f}return o}const rge=function e(t){function n(r,i,s,o,a){nge(t,r,i,s,o,a)}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(tge);function cpt(){var e=rge,t=!1,n=1,r=1,i=[0],s=$d,o=$d,a=$d,u=$d,l=$d;function c(h){return h.x0=h.y0=0,h.x1=n,h.y1=r,h.eachBefore(f),i=[0],t&&h.eachBefore(ege),h}function f(h){var d=i[h.depth],p=h.x0+d,m=h.y0+d,g=h.x1-d,y=h.y1-d;g<p&&(p=g=(p+g)/2),y<m&&(m=y=(m+y)/2),h.x0=p,h.y0=m,h.x1=g,h.y1=y,h.children&&(d=i[h.depth+1]=s(h)/2,p+=l(h)-d,m+=o(h)-d,g-=a(h)-d,y-=u(h)-d,g<p&&(p=g=(p+g)/2),y<m&&(m=y=(m+y)/2),e(h,p,m,g,y))}return c.round=function(h){return arguments.length?(t=!!h,c):t},c.size=function(h){return arguments.length?(n=+h[0],r=+h[1],c):[n,r]},c.tile=function(h){return arguments.length?(e=fE(h),c):e},c.padding=function(h){return arguments.length?c.paddingInner(h).paddingOuter(h):c.paddingInner()},c.paddingInner=function(h){return arguments.length?(s=typeof h=="function"?h:om(+h),c):s},c.paddingOuter=function(h){return arguments.length?c.paddingTop(h).paddingRight(h).paddingBottom(h).paddingLeft(h):c.paddingTop()},c.paddingTop=function(h){return arguments.length?(o=typeof h=="function"?h:om(+h),c):o},c.paddingRight=function(h){return arguments.length?(a=typeof h=="function"?h:om(+h),c):a},c.paddingBottom=function(h){return arguments.length?(u=typeof h=="function"?h:om(+h),c):u},c.paddingLeft=function(h){return arguments.length?(l=typeof h=="function"?h:om(+h),c):l},c}function fpt(e,t,n,r,i){var s=e.children,o,a=s.length,u,l=new Array(a+1);for(l[0]=u=o=0;o<a;++o)l[o+1]=u+=s[o].value;c(0,a,e.value,t,n,r,i);function c(f,h,d,p,m,g,y){if(f>=h-1){var b=s[f];b.x0=p,b.y0=m,b.x1=g,b.y1=y;return}for(var x=l[f],v=d/2+x,w=f+1,C=h-1;w<C;){var S=w+C>>>1;l[S]<v?w=S+1:C=S}v-l[w-1]<l[w]-v&&f+1<w&&--w;var _=l[w]-x,$=d-_;if(g-p>y-m){var k=d?(p*$+g*_)/d:g;c(f,w,_,p,m,k,y),c(w,h,$,k,m,g,y)}else{var E=d?(m*$+y*_)/d:y;c(f,w,_,p,m,g,E),c(w,h,$,p,E,g,y)}}}function hpt(e,t,n,r,i){(e.depth&1?HI:mC)(e,t,n,r,i)}const dpt=function e(t){function n(r,i,s,o,a){if((u=r._squarify)&&u.ratio===t)for(var u,l,c,f,h=-1,d,p=u.length,m=r.value;++h<p;){for(l=u[h],c=l.children,f=l.value=0,d=c.length;f<d;++f)l.value+=c[f].value;l.dice?mC(l,i,s,o,m?s+=(a-s)*l.value/m:a):HI(l,i,s,m?i+=(o-i)*l.value/m:o,a),m-=l.value}else r._squarify=u=nge(t,r,i,s,o,a),u.ratio=t}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(tge);function zP(e,t,n){const r={};return e.each(i=>{const s=i.data;n(s)&&(r[t(s)]=i)}),e.lookup=r,e}function N7(e){he.call(this,null,e)}N7.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const ppt=e=>e.values;$e(N7,he,{transform(e,t){t.source||ye("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),s=this.value;return(!s||r||t.changed())&&(s&&s.each(o=>{o.children&&VD(o.data)&&i.rem.push(o.data)}),this.value=s=O7({values:at(e.keys).reduce((o,a)=>(o.key(a),o),gpt()).entries(i.source)},ppt),n&&s.each(o=>{o.children&&(o=zt(o.data),i.add.push(o),i.source.push(o))}),zP(s,Ve,Ve)),i.source.root=s,i}});function gpt(){const e=[],t={entries:i=>r(n(i,0),0),key:i=>(e.push(i),t)};function n(i,s){if(s>=e.length)return i;const o=i.length,a=e[s++],u={},l={};let c=-1,f,h,d;for(;++c<o;)f=a(h=i[c])+"",(d=u[f])?d.push(h):u[f]=[h];for(f in u)l[f]=n(u[f],s);return l}function r(i,s){if(++s>e.length)return i;const o=[];for(const a in i)o.push({key:a,values:r(i[a],s)});return o}return t}function wc(e){he.call(this,null,e)}const mpt=(e,t)=>e.parent===t.parent?1:2;$e(wc,he,{transform(e,t){(!t.source||!t.source.root)&&ye(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,s=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(cg(e.sort,o=>o.data)),ypt(n,this.params,e),n.separation&&n.separation(e.separation!==!1?mpt:V1);try{this.value=n(i)}catch(o){ye(o)}return i.each(o=>bpt(o,r,s)),t.reflow(e.modified()).modifies(s).modifies("leaf")}});function ypt(e,t,n){for(let r,i=0,s=t.length;i<s;++i)r=t[i],r in n&&e[r](n[r])}function bpt(e,t,n){const r=e.data,i=t.length-1;for(let s=0;s<i;++s)r[n[s]]=e[t[s]];r[n[i]]=e.children?e.children.length:0}const jP=["x","y","r","depth","children"];function M7(e){wc.call(this,e)}M7.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:jP.length,default:jP}]};$e(M7,wc,{layout:Qdt,params:["radius","size","padding"],fields:jP});const UP=["x0","y0","x1","y1","depth","children"];function R7(e){wc.call(this,e)}R7.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:UP.length,default:UP}]};$e(R7,wc,{layout:ept,params:["size","round","padding"],fields:UP});function P7(e){he.call(this,null,e)}P7.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};$e(P7,he,{transform(e,t){t.source||ye("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),s=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),s&&(n=i.source.length?zP(_Y().id(e.key).parentId(e.parentKey)(i.source),e.key,G1):zP(_Y()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const $Y={tidy:lpt,cluster:_dt},WP=["x","y","depth","children"];function L7(e){wc.call(this,e)}L7.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:WP.length,default:WP}]};$e(L7,wc,{layout(e){const t=e||"tidy";if(lt($Y,t))return $Y[t]();ye("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:WP});function B7(e){he.call(this,[],e)}B7.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};$e(B7,he,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),s={};return r||ye("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,o=>s[Ve(o)]=1),r.each(o=>{const a=o.data,u=o.parent&&o.parent.data;u&&s[Ve(a)]&&s[Ve(u)]&&i.add.push(zt({source:u,target:a}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,o=>s[Ve(o)]=1),n.forEach(o=>{(s[Ve(o.source)]||s[Ve(o.target)])&&i.mod.push(o)})),i}});const kY={binary:fpt,dice:mC,slice:HI,slicedice:hpt,squarify:rge,resquarify:dpt},VP=["x0","y0","x1","y1","depth","children"];function z7(e){wc.call(this,e)}z7.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:VP.length,default:VP}]};$e(z7,wc,{layout(){const e=cpt();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{lt(kY,t)?e.tile(kY[t]):ye("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:VP});const vpt=Object.freeze(Object.defineProperty({__proto__:null,nest:N7,pack:M7,partition:R7,stratify:P7,tree:L7,treelinks:B7,treemap:z7},Symbol.toStringTag,{value:"Module"})),GP=Math.PI,HP=2*GP,pd=1e-6,xpt=HP-pd;function qP(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function xg(){return new qP}qP.prototype=xg.prototype={constructor:qP,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+s)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var s=this._x1,o=this._y1,a=n-e,u=r-t,l=s-e,c=o-t,f=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>pd)if(!(Math.abs(c*a-u*l)>pd)||!i)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var h=n-s,d=r-o,p=a*a+u*u,m=h*h+d*d,g=Math.sqrt(p),y=Math.sqrt(f),b=i*Math.tan((GP-Math.acos((p+f-m)/(2*g*y)))/2),x=b/y,v=b/g;Math.abs(x-1)>pd&&(this._+="L"+(e+x*l)+","+(t+x*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>l*d)+","+(this._x1=e+v*a)+","+(this._y1=t+v*u)}},arc:function(e,t,n,r,i,s){e=+e,t=+t,n=+n,s=!!s;var o=n*Math.cos(r),a=n*Math.sin(r),u=e+o,l=t+a,c=1^s,f=s?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+u+","+l:(Math.abs(this._x1-u)>pd||Math.abs(this._y1-l)>pd)&&(this._+="L"+u+","+l),n&&(f<0&&(f=f%HP+HP),f>xpt?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-a)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):f>pd&&(this._+="A"+n+","+n+",0,"+ +(f>=GP)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function Wt(e){return function(){return e}}var EY=Math.abs,ni=Math.atan2,Kh=Math.cos,wpt=Math.max,c3=Math.min,Ya=Math.sin,hm=Math.sqrt,si=1e-12,g0=Math.PI,hE=g0/2,ige=2*g0;function Cpt(e){return e>1?0:e<-1?g0:Math.acos(e)}function AY(e){return e>=1?hE:e<=-1?-hE:Math.asin(e)}function Spt(e){return e.innerRadius}function _pt(e){return e.outerRadius}function $pt(e){return e.startAngle}function kpt(e){return e.endAngle}function Ept(e){return e&&e.padAngle}function Apt(e,t,n,r,i,s,o,a){var u=n-e,l=r-t,c=o-i,f=a-s,h=f*u-c*l;if(!(h*h<si))return h=(c*(t-s)-f*(e-i))/h,[e+h*u,t+h*l]}function t_(e,t,n,r,i,s,o){var a=e-n,u=t-r,l=(o?s:-s)/hm(a*a+u*u),c=l*u,f=-l*a,h=e+c,d=t+f,p=n+c,m=r+f,g=(h+p)/2,y=(d+m)/2,b=p-h,x=m-d,v=b*b+x*x,w=i-s,C=h*m-p*d,S=(x<0?-1:1)*hm(wpt(0,w*w*v-C*C)),_=(C*x-b*S)/v,$=(-C*b-x*S)/v,k=(C*x+b*S)/v,E=(-C*b+x*S)/v,F=_-g,T=$-y,I=k-g,D=E-y;return F*F+T*T>I*I+D*D&&(_=k,$=E),{cx:_,cy:$,x01:-c,y01:-f,x11:_*(i/w-1),y11:$*(i/w-1)}}function Tpt(){var e=Spt,t=_pt,n=Wt(0),r=null,i=$pt,s=kpt,o=Ept,a=null;function u(){var l,c,f=+e.apply(this,arguments),h=+t.apply(this,arguments),d=i.apply(this,arguments)-hE,p=s.apply(this,arguments)-hE,m=EY(p-d),g=p>d;if(a||(a=l=xg()),h<f&&(c=h,h=f,f=c),!(h>si))a.moveTo(0,0);else if(m>ige-si)a.moveTo(h*Kh(d),h*Ya(d)),a.arc(0,0,h,d,p,!g),f>si&&(a.moveTo(f*Kh(p),f*Ya(p)),a.arc(0,0,f,p,d,g));else{var y=d,b=p,x=d,v=p,w=m,C=m,S=o.apply(this,arguments)/2,_=S>si&&(r?+r.apply(this,arguments):hm(f*f+h*h)),$=c3(EY(h-f)/2,+n.apply(this,arguments)),k=$,E=$,F,T;if(_>si){var I=AY(_/f*Ya(S)),D=AY(_/h*Ya(S));(w-=I*2)>si?(I*=g?1:-1,x+=I,v-=I):(w=0,x=v=(d+p)/2),(C-=D*2)>si?(D*=g?1:-1,y+=D,b-=D):(C=0,y=b=(d+p)/2)}var N=h*Kh(y),V=h*Ya(y),U=f*Kh(v),A=f*Ya(v);if($>si){var M=h*Kh(b),P=h*Ya(b),j=f*Kh(x),q=f*Ya(x),B;if(m<g0&&(B=Apt(N,V,j,q,M,P,U,A))){var O=N-B[0],G=V-B[1],Z=M-B[0],re=P-B[1],R=1/Ya(Cpt((O*Z+G*re)/(hm(O*O+G*G)*hm(Z*Z+re*re)))/2),H=hm(B[0]*B[0]+B[1]*B[1]);k=c3($,(f-H)/(R-1)),E=c3($,(h-H)/(R+1))}}C>si?E>si?(F=t_(j,q,N,V,h,E,g),T=t_(M,P,U,A,h,E,g),a.moveTo(F.cx+F.x01,F.cy+F.y01),E<$?a.arc(F.cx,F.cy,E,ni(F.y01,F.x01),ni(T.y01,T.x01),!g):(a.arc(F.cx,F.cy,E,ni(F.y01,F.x01),ni(F.y11,F.x11),!g),a.arc(0,0,h,ni(F.cy+F.y11,F.cx+F.x11),ni(T.cy+T.y11,T.cx+T.x11),!g),a.arc(T.cx,T.cy,E,ni(T.y11,T.x11),ni(T.y01,T.x01),!g))):(a.moveTo(N,V),a.arc(0,0,h,y,b,!g)):a.moveTo(N,V),!(f>si)||!(w>si)?a.lineTo(U,A):k>si?(F=t_(U,A,M,P,f,-k,g),T=t_(N,V,j,q,f,-k,g),a.lineTo(F.cx+F.x01,F.cy+F.y01),k<$?a.arc(F.cx,F.cy,k,ni(F.y01,F.x01),ni(T.y01,T.x01),!g):(a.arc(F.cx,F.cy,k,ni(F.y01,F.x01),ni(F.y11,F.x11),!g),a.arc(0,0,f,ni(F.cy+F.y11,F.cx+F.x11),ni(T.cy+T.y11,T.cx+T.x11),g),a.arc(T.cx,T.cy,k,ni(T.y11,T.x11),ni(T.y01,T.x01),!g))):a.arc(0,0,f,v,x,g)}if(a.closePath(),l)return a=null,l+""||null}return u.centroid=function(){var l=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-g0/2;return[Kh(c)*l,Ya(c)*l]},u.innerRadius=function(l){return arguments.length?(e=typeof l=="function"?l:Wt(+l),u):e},u.outerRadius=function(l){return arguments.length?(t=typeof l=="function"?l:Wt(+l),u):t},u.cornerRadius=function(l){return arguments.length?(n=typeof l=="function"?l:Wt(+l),u):n},u.padRadius=function(l){return arguments.length?(r=l==null?null:typeof l=="function"?l:Wt(+l),u):r},u.startAngle=function(l){return arguments.length?(i=typeof l=="function"?l:Wt(+l),u):i},u.endAngle=function(l){return arguments.length?(s=typeof l=="function"?l:Wt(+l),u):s},u.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:Wt(+l),u):o},u.context=function(l){return arguments.length?(a=l??null,u):a},u}function sge(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function oge(e){this._context=e}oge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function j7(e){return new oge(e)}function age(e){return e[0]}function uge(e){return e[1]}function lge(e,t){var n=Wt(!0),r=null,i=j7,s=null;e=typeof e=="function"?e:e===void 0?age:Wt(e),t=typeof t=="function"?t:t===void 0?uge:Wt(t);function o(a){var u,l=(a=sge(a)).length,c,f=!1,h;for(r==null&&(s=i(h=xg())),u=0;u<=l;++u)!(u<l&&n(c=a[u],u,a))===f&&((f=!f)?s.lineStart():s.lineEnd()),f&&s.point(+e(c,u,a),+t(c,u,a));if(h)return s=null,h+""||null}return o.x=function(a){return arguments.length?(e=typeof a=="function"?a:Wt(+a),o):e},o.y=function(a){return arguments.length?(t=typeof a=="function"?a:Wt(+a),o):t},o.defined=function(a){return arguments.length?(n=typeof a=="function"?a:Wt(!!a),o):n},o.curve=function(a){return arguments.length?(i=a,r!=null&&(s=i(r)),o):i},o.context=function(a){return arguments.length?(a==null?r=s=null:s=i(r=a),o):r},o}function cge(e,t,n){var r=null,i=Wt(!0),s=null,o=j7,a=null;e=typeof e=="function"?e:e===void 0?age:Wt(+e),t=typeof t=="function"?t:Wt(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?uge:Wt(+n);function u(c){var f,h,d,p=(c=sge(c)).length,m,g=!1,y,b=new Array(p),x=new Array(p);for(s==null&&(a=o(y=xg())),f=0;f<=p;++f){if(!(f<p&&i(m=c[f],f,c))===g)if(g=!g)h=f,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),d=f-1;d>=h;--d)a.point(b[d],x[d]);a.lineEnd(),a.areaEnd()}g&&(b[f]=+e(m,f,c),x[f]=+t(m,f,c),a.point(r?+r(m,f,c):b[f],n?+n(m,f,c):x[f]))}if(y)return a=null,y+""||null}function l(){return lge().defined(i).curve(o).context(s)}return u.x=function(c){return arguments.length?(e=typeof c=="function"?c:Wt(+c),r=null,u):e},u.x0=function(c){return arguments.length?(e=typeof c=="function"?c:Wt(+c),u):e},u.x1=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:Wt(+c),u):r},u.y=function(c){return arguments.length?(t=typeof c=="function"?c:Wt(+c),n=null,u):t},u.y0=function(c){return arguments.length?(t=typeof c=="function"?c:Wt(+c),u):t},u.y1=function(c){return arguments.length?(n=c==null?null:typeof c=="function"?c:Wt(+c),u):n},u.lineX0=u.lineY0=function(){return l().x(e).y(t)},u.lineY1=function(){return l().x(e).y(n)},u.lineX1=function(){return l().x(r).y(t)},u.defined=function(c){return arguments.length?(i=typeof c=="function"?c:Wt(!!c),u):i},u.curve=function(c){return arguments.length?(o=c,s!=null&&(a=o(s)),u):o},u.context=function(c){return arguments.length?(c==null?s=a=null:a=o(s=c),u):s},u}const Dpt={draw:function(e,t){var n=Math.sqrt(t/g0);e.moveTo(n,0),e.arc(0,0,n,0,ige)}};function Ipt(e,t){var n=null;e=typeof e=="function"?e:Wt(e||Dpt),t=typeof t=="function"?t:Wt(t===void 0?64:+t);function r(){var i;if(n||(n=i=xg()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return r.type=function(i){return arguments.length?(e=typeof i=="function"?i:Wt(i),r):e},r.size=function(i){return arguments.length?(t=typeof i=="function"?i:Wt(+i),r):t},r.context=function(i){return arguments.length?(n=i??null,r):n},r}function eh(){}function dE(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function qI(e){this._context=e}qI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:dE(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:dE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Fpt(e){return new qI(e)}function fge(e){this._context=e}fge.prototype={areaStart:eh,areaEnd:eh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:dE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Opt(e){return new fge(e)}function hge(e){this._context=e}hge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:dE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Npt(e){return new hge(e)}function dge(e,t){this._basis=new qI(e),this._beta=t}dge.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r=e[0],i=t[0],s=e[n]-r,o=t[n]-i,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(r+u*s),this._beta*t[a]+(1-this._beta)*(i+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const Mpt=function e(t){function n(r){return t===1?new qI(r):new dge(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function pE(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function U7(e,t){this._context=e,this._k=(1-t)/6}U7.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:pE(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:pE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Rpt=function e(t){function n(r){return new U7(r,t)}return n.tension=function(r){return e(+r)},n}(0);function W7(e,t){this._context=e,this._k=(1-t)/6}W7.prototype={areaStart:eh,areaEnd:eh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:pE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Ppt=function e(t){function n(r){return new W7(r,t)}return n.tension=function(r){return e(+r)},n}(0);function V7(e,t){this._context=e,this._k=(1-t)/6}V7.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:pE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Lpt=function e(t){function n(r){return new V7(r,t)}return n.tension=function(r){return e(+r)},n}(0);function G7(e,t,n){var r=e._x1,i=e._y1,s=e._x2,o=e._y2;if(e._l01_a>si){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>si){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,s,o,e._x2,e._y2)}function pge(e,t){this._context=e,this._alpha=t}pge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:G7(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Bpt=function e(t){function n(r){return t?new pge(r,t):new U7(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function gge(e,t){this._context=e,this._alpha=t}gge.prototype={areaStart:eh,areaEnd:eh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:G7(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const zpt=function e(t){function n(r){return t?new gge(r,t):new W7(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function mge(e,t){this._context=e,this._alpha=t}mge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:G7(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const jpt=function e(t){function n(r){return t?new mge(r,t):new V7(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function yge(e){this._context=e}yge.prototype={areaStart:eh,areaEnd:eh,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function Upt(e){return new yge(e)}function TY(e){return e<0?-1:1}function DY(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(TY(s)+TY(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function IY(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function f3(e,t,n){var r=e._x0,i=e._y0,s=e._x1,o=e._y1,a=(s-r)/3;e._context.bezierCurveTo(r+a,i+a*t,s-a,o-a*n,s,o)}function gE(e){this._context=e}gE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:f3(this,this._t0,IY(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,f3(this,IY(this,n=DY(this,e,t)),n);break;default:f3(this,this._t0,n=DY(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function bge(e){this._context=new vge(e)}(bge.prototype=Object.create(gE.prototype)).point=function(e,t){gE.prototype.point.call(this,t,e)};function vge(e){this._context=e}vge.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}};function Wpt(e){return new gE(e)}function Vpt(e){return new bge(e)}function xge(e){this._context=e}xge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=FY(e),i=FY(t),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function FY(e){var t,n=e.length-1,r,i=new Array(n),s=new Array(n),o=new Array(n);for(i[0]=0,s[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,s[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,s[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/s[t-1],s[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/s[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/s[t];for(s[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}function Gpt(e){return new xge(e)}function XI(e,t){this._context=e,this._t=t}XI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function Hpt(e){return new XI(e,.5)}function qpt(e){return new XI(e,0)}function Xpt(e){return new XI(e,1)}var OY={},h3={},d3=34,Qy=10,p3=13;function wge(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function Ypt(e,t){var n=wge(e);return function(r,i){return t(n(r),i,e)}}function NY(e){var t=Object.create(null),n=[];return e.forEach(function(r){for(var i in r)i in t||n.push(t[i]=i)}),n}function as(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Kpt(e){return e<0?"-"+as(-e,6):e>9999?"+"+as(e,6):as(e,4)}function Zpt(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Kpt(e.getUTCFullYear())+"-"+as(e.getUTCMonth()+1,2)+"-"+as(e.getUTCDate(),2)+(i?"T"+as(t,2)+":"+as(n,2)+":"+as(r,2)+"."+as(i,3)+"Z":r?"T"+as(t,2)+":"+as(n,2)+":"+as(r,2)+"Z":n||t?"T"+as(t,2)+":"+as(n,2)+"Z":"")}function Jpt(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function r(f,h){var d,p,m=i(f,function(g,y){if(d)return d(g,y-1);p=g,d=h?Ypt(g,h):wge(g)});return m.columns=p||[],m}function i(f,h){var d=[],p=f.length,m=0,g=0,y,b=p<=0,x=!1;f.charCodeAt(p-1)===Qy&&--p,f.charCodeAt(p-1)===p3&&--p;function v(){if(b)return h3;if(x)return x=!1,OY;var C,S=m,_;if(f.charCodeAt(S)===d3){for(;m++<p&&f.charCodeAt(m)!==d3||f.charCodeAt(++m)===d3;);return(C=m)>=p?b=!0:(_=f.charCodeAt(m++))===Qy?x=!0:_===p3&&(x=!0,f.charCodeAt(m)===Qy&&++m),f.slice(S+1,C-1).replace(/""/g,'"')}for(;m<p;){if((_=f.charCodeAt(C=m++))===Qy)x=!0;else if(_===p3)x=!0,f.charCodeAt(m)===Qy&&++m;else if(_!==n)continue;return f.slice(S,C)}return b=!0,f.slice(S,p)}for(;(y=v())!==h3;){for(var w=[];y!==OY&&y!==h3;)w.push(y),y=v();h&&(w=h(w,g++))==null||d.push(w)}return d}function s(f,h){return f.map(function(d){return h.map(function(p){return c(d[p])}).join(e)})}function o(f,h){return h==null&&(h=NY(f)),[h.map(c).join(e)].concat(s(f,h)).join(`
`)}function a(f,h){return h==null&&(h=NY(f)),s(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?Zpt(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function Qpt(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function mE(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function m0(e){return e=mE(Math.abs(e)),e?e[1]:NaN}function egt(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function tgt(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var ngt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ax(e){if(!(t=ngt.exec(e)))throw new Error("invalid format: "+e);var t;return new H7({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Ax.prototype=H7.prototype;function H7(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}H7.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function rgt(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Cge;function igt(e,t){var n=mE(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Cge=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+mE(e,Math.max(0,t+s-1))[0]}function MY(e,t){var n=mE(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const RY={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Qpt,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>MY(e*100,t),r:MY,s:igt,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function PY(e){return e}var LY=Array.prototype.map,BY=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Sge(e){var t=e.grouping===void 0||e.thousands===void 0?PY:egt(LY.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?PY:tgt(LY.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=Ax(f);var h=f.fill,d=f.align,p=f.sign,m=f.symbol,g=f.zero,y=f.width,b=f.comma,x=f.precision,v=f.trim,w=f.type;w==="n"?(b=!0,w="g"):RY[w]||(x===void 0&&(x=12),v=!0,w="g"),(g||h==="0"&&d==="=")&&(g=!0,h="0",d="=");var C=m==="$"?n:m==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",S=m==="$"?r:/[%p]/.test(w)?o:"",_=RY[w],$=/[defgprs%]/.test(w);x=x===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function k(E){var F=C,T=S,I,D,N;if(w==="c")T=_(E)+T,E="";else{E=+E;var V=E<0||1/E<0;if(E=isNaN(E)?u:_(Math.abs(E),x),v&&(E=rgt(E)),V&&+E==0&&p!=="+"&&(V=!1),F=(V?p==="("?p:a:p==="-"||p==="("?"":p)+F,T=(w==="s"?BY[8+Cge/3]:"")+T+(V&&p==="("?")":""),$){for(I=-1,D=E.length;++I<D;)if(N=E.charCodeAt(I),48>N||N>57){T=(N===46?i+E.slice(I+1):E.slice(I))+T,E=E.slice(0,I);break}}}b&&!g&&(E=t(E,1/0));var U=F.length+E.length+T.length,A=U<y?new Array(y-U+1).join(h):"";switch(b&&g&&(E=t(A+E,A.length?y-T.length:1/0),A=""),d){case"<":E=F+E+T+A;break;case"=":E=F+A+E+T;break;case"^":E=A.slice(0,U=A.length>>1)+F+E+T+A.slice(U);break;default:E=A+F+E+T;break}return s(E)}return k.toString=function(){return f+""},k}function c(f,h){var d=l((f=Ax(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(m0(h)/3)))*3,m=Math.pow(10,-p),g=BY[8+p/3];return function(y){return d(m*y)+g}}return{format:l,formatPrefix:c}}var n_,_ge,$ge;sgt({thousands:",",grouping:[3],currency:["$",""]});function sgt(e){return n_=Sge(e),_ge=n_.format,$ge=n_.formatPrefix,n_}function ogt(e){return Math.max(0,-m0(Math.abs(e)))}function agt(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(m0(t)/3)))*3-m0(Math.abs(e)))}function ugt(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,m0(t)-m0(e))+1}function Ub(e){const t={};return n=>t[n]||(t[n]=e(n))}function lgt(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=cgt(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function cgt(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function kge(e){const t=Ub(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=Ax(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return lgt(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=Ax(o??",f");const a=Uf(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=agt(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=ugt(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=ogt(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}let XP;Ege();function Ege(){return XP=kge({format:_ge,formatPrefix:$ge})}function Age(e){return kge(Sge(e))}function yE(e){return arguments.length?XP=Age(e):XP}function zY(e,t,n){n=n||{},wt(n)||ye("Invalid time multi-format specifier: ".concat(n));const r=t(Mo),i=t(to),s=t(eo),o=t(Es),a=t(cr),u=t(wi),l=t(ks),c=t(Kr),f=e(n[Ia]||".%L"),h=e(n[Mo]||":%S"),d=e(n[to]||"%I:%M"),p=e(n[eo]||"%I %p"),m=e(n[Es]||n[pi]||"%a %d"),g=e(n[cr]||"%b %d"),y=e(n[wi]||"%B"),b=e(n[ks]||"%B"),x=e(n[Kr]||"%Y");return v=>(r(v)<v?f:i(v)<v?h:s(v)<v?d:o(v)<v?p:u(v)<v?a(v)<v?m:g:c(v)<v?l(v)<v?y:b:x)(v)}function Tge(e){const t=Ub(e.format),n=Ub(e.utcFormat);return{timeFormat:r=>wn(r)?t(r):zY(t,Q1,r),utcFormat:r=>wn(r)?n(r):zY(n,ey,r),timeParse:Ub(e.parse),utcParse:Ub(e.utcParse)}}let YP;Dge();function Dge(){return YP=Tge({format:NI,parse:ude,utcFormat:MI,utcParse:lde})}function Ige(e){return Tge(rde(e))}function Tx(e){return arguments.length?YP=Ige(e):YP}const KP=(e,t)=>St({},e,t);function Fge(e,t){const n=e?Age(e):yE(),r=t?Ige(t):Tx();return KP(n,r)}function Oge(e,t){const n=arguments.length;return n&&n!==2&&ye("defaultLocale expects either zero or two arguments."),n?KP(yE(e),Tx(t)):KP(yE(),Tx())}function fgt(){return Ege(),Dge(),Oge()}const hgt=/^(data:|([A-Za-z]+:)?\/\/)/,dgt=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,pgt=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,jY="file://";function ggt(e,t){return n=>({options:n||{},sanitize:ygt,load:mgt,fileAccess:!!t,file:bgt(t),http:xgt(e)})}async function mgt(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function ygt(e,t){t=St({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=dgt.test(e.replace(pgt,""));(e==null||typeof e!="string"||!a)&&ye("Sanitize failure, invalid URI: "+Qe(e));const u=hgt.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith(jY))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice(jY.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function bgt(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):vgt}async function vgt(){ye("No file system access.")}function xgt(e){return e?async function(t,n){const r=St({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?Ht(s[i])?s[i]():s.text():ye(s.status+""+s.statusText)}:wgt}async function wgt(){ye("No HTTP fetch method available.")}const Cgt=e=>e!=null&&e===e,Sgt=e=>e==="true"||e==="false"||e===!0||e===!1,_gt=e=>!Number.isNaN(Date.parse(e)),Nge=e=>!Number.isNaN(+e)&&!(e instanceof Date),$gt=e=>Nge(e)&&Number.isInteger(+e),ZP={boolean:Mae,integer:Pf,number:Pf,date:Rae,string:Pae,unknown:Oo},r_=[Sgt,$gt,Nge,_gt],kgt=["boolean","integer","number","date"];function Mge(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=r_.length,i=r_.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&Cgt(u)&&!r_[a](u)&&(i[a]=0,++o,o===r_.length))return"string";return kgt[i.reduce((s,o)=>s===0?o:s,0)-1]}function Rge(e,t){return t.reduce((n,r)=>(n[r]=Mge(e,r),n),{})}function UY(e){const t=function(n,r){const i={delimiter:e};return q7(n,r?St(r,i):i)};return t.responseType="text",t}function q7(e,t){return t.header&&(e=t.header.map(Qe).join(t.delimiter)+`
`+e),Jpt(t.delimiter).parse(e+"")}q7.responseType="text";function Egt(e){return typeof Buffer=="function"&&Ht(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function X7(e,t){const n=t&&t.property?Rf(t.property):Oo;return wt(e)&&!Egt(e)?Agt(n(e),t):n(JSON.parse(e))}X7.responseType="json";function Agt(e,t){return!ht(e)&&Iae(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const Tgt={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Pge(e,t){let n,r,i,s;return e=X7(e,t),t&&t.feature?(n=Uae,i=t.feature):t&&t.mesh?(n=Vae,i=t.mesh,s=Tgt[t.filter]):ye("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,s):ye("Invalid TopoJSON object: "+i),r&&r.features||[r]}Pge.responseType="json";const q_={dsv:q7,csv:UY(","),tsv:UY("	"),json:X7,topojson:Pge};function Y7(e,t){return arguments.length>1?(q_[e]=t,this):lt(q_,e)?q_[e]:null}function Dgt(e){const t=Y7(e);return t&&t.responseType||"text"}function Igt(e,t,n,r){t=t||{};const i=Y7(t.type||"json");return i||ye("Unknown data format type: "+t.type),e=i(e,t),t.parse&&Fgt(e,t.parse,n,r),lt(e,"columns")&&delete e.columns,e}function Fgt(e,t,n,r){if(!e.length)return;const i=Tx();n=n||i.timeParse,r=r||i.utcParse;let s=e.columns||Object.keys(e[0]),o,a,u,l,c,f;t==="auto"&&(t=Rge(e,s)),s=Object.keys(t);const h=s.map(d=>{const p=t[d];let m,g;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return m=p.split(/:(.+)?/,2),g=m[1],(g[0]==="'"&&g[g.length-1]==="'"||g[0]==='"'&&g[g.length-1]==='"')&&(g=g.slice(1,-1)),(m[0]==="utc"?r:n)(g);if(!ZP[p])throw Error("Illegal format pattern: "+d+":"+p);return ZP[p]});for(u=0,c=e.length,f=s.length;u<c;++u)for(o=e[u],l=0;l<f;++l)a=s[l],o[a]=h[l](o[a])}const K7=ggt(typeof fetch<"u"&&fetch,null);let Lge=0;function Ogt(){Lge=0}const bE="p_";function Z7(e){return e&&e.gradient}function Bge(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?bE:"";return i||(i=e.id="gradient_"+Lge++,r==="radial"?(e.x1=Ka(e.x1,.5),e.y1=Ka(e.y1,.5),e.r1=Ka(e.r1,0),e.x2=Ka(e.x2,.5),e.y2=Ka(e.y2,.5),e.r2=Ka(e.r2,.5),s=bE):(e.x1=Ka(e.x1,0),e.y1=Ka(e.y1,0),e.x2=Ka(e.x2,1),e.y2=Ka(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function Ka(e,t){return e??t}function zge(e,t){var n=[],r;return r={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(i,s){return n.push({offset:i,color:s}),r}}}const WY={basis:{curve:Fpt},"basis-closed":{curve:Opt},"basis-open":{curve:Npt},bundle:{curve:Mpt,tension:"beta",value:.85},cardinal:{curve:Rpt,tension:"tension",value:0},"cardinal-open":{curve:Lpt,tension:"tension",value:0},"cardinal-closed":{curve:Ppt,tension:"tension",value:0},"catmull-rom":{curve:Bpt,tension:"alpha",value:.5},"catmull-rom-closed":{curve:zpt,tension:"alpha",value:.5},"catmull-rom-open":{curve:jpt,tension:"alpha",value:.5},linear:{curve:j7},"linear-closed":{curve:Upt},monotone:{horizontal:Vpt,vertical:Wpt},natural:{curve:Gpt},step:{curve:Hpt},"step-after":{curve:Xpt},"step-before":{curve:qpt}};function J7(e,t,n){var r=lt(WY,e)&&WY[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const Ngt={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},eb=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function y0(e){const t=[];let n,r,i,s,o,a,u,l,c,f;const h=e.slice().replace(eb[0],"###$1").split(eb[1]).slice(1);for(u=0,c=h.length;u<c;++u){for(n=h[u],r=n.slice(1).trim().replace(eb[2],"$1###$2").replace(eb[3],"$1###$2").split(eb[4]),o=n.charAt(0),i=[o],l=0,f=r.length;l<f;++l)(s=+r[l])===s&&i.push(s);if(a=Ngt[o.toLowerCase()],i.length-1>a){const d=i.length;for(l=1,t.push([o].concat(i.slice(l,l+=a))),o=o==="M"?"L":o==="m"?"l":o;l<d;l+=a)t.push([o].concat(i.slice(l,l+a)))}else t.push(i)}return t}const th=Math.PI/180,Mgt=1e-14,kd=Math.PI/2,lu=Math.PI*2,Qg=Math.sqrt(3)/2;var g3={},m3={},jge=[].join;function Rgt(e,t,n,r,i,s,o,a,u){const l=jge.call(arguments);if(g3[l])return g3[l];const c=o*th,f=Math.sin(c),h=Math.cos(c);n=Math.abs(n),r=Math.abs(r);const d=h*(a-e)*.5+f*(u-t)*.5,p=h*(u-t)*.5-f*(a-e)*.5;let m=d*d/(n*n)+p*p/(r*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=h/n,y=f/n,b=-f/r,x=h/r,v=g*a+y*u,w=b*a+x*u,C=g*e+y*t,S=b*e+x*t;let $=1/((C-v)*(C-v)+(S-w)*(S-w))-.25;$<0&&($=0);let k=Math.sqrt($);s==i&&(k=-k);const E=.5*(v+C)-k*(S-w),F=.5*(w+S)+k*(C-v),T=Math.atan2(w-F,v-E);let D=Math.atan2(S-F,C-E)-T;D<0&&s===1?D+=lu:D>0&&s===0&&(D-=lu);const N=Math.ceil(Math.abs(D/(kd+.001))),V=[];for(let U=0;U<N;++U){const A=T+U*D/N,M=T+(U+1)*D/N;V[U]=[E,F,A,M,n,r,f,h]}return g3[l]=V}function Pgt(e){const t=jge.call(e);if(m3[t])return m3[t];var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7];const c=l*o,f=-u*a,h=u*o,d=l*a,p=Math.cos(i),m=Math.sin(i),g=Math.cos(s),y=Math.sin(s),b=.5*(s-i),x=Math.sin(b*.5),v=8/3*x*x/Math.sin(b),w=n+p-v*m,C=r+m+v*p,S=n+g,_=r+y,$=S+v*y,k=_-v*g;return m3[t]=[c*w+f*C,h*w+d*C,c*$+f*k,h*$+d*k,c*S+f*_,h*S+d*_]}const fo=["l",0,0,0,0,0,0,0];function Lgt(e,t,n){const r=fo[0]=e[0];if(r==="a"||r==="A")fo[1]=t*e[1],fo[2]=n*e[2],fo[3]=e[3],fo[4]=e[4],fo[5]=e[5],fo[6]=t*e[6],fo[7]=n*e[7];else if(r==="h"||r==="H")fo[1]=t*e[1];else if(r==="v"||r==="V")fo[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)fo[i]=(i%2==1?t:n)*e[i];return fo}function Dx(e,t,n,r,i,s){var o,a=null,u=0,l=0,c=0,f=0,h,d,p,m;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var g=0,y=t.length;g<y;++g){switch(o=t[g],(i!==1||s!==1)&&(o=Lgt(o,i,s)),o[0]){case"l":u+=o[1],l+=o[2],e.lineTo(u+n,l+r);break;case"L":u=o[1],l=o[2],e.lineTo(u+n,l+r);break;case"h":u+=o[1],e.lineTo(u+n,l+r);break;case"H":u=o[1],e.lineTo(u+n,l+r);break;case"v":l+=o[1],e.lineTo(u+n,l+r);break;case"V":l=o[1],e.lineTo(u+n,l+r);break;case"m":u+=o[1],l+=o[2],e.moveTo(u+n,l+r);break;case"M":u=o[1],l=o[2],e.moveTo(u+n,l+r);break;case"c":h=u+o[5],d=l+o[6],c=u+o[3],f=l+o[4],e.bezierCurveTo(u+o[1]+n,l+o[2]+r,c+n,f+r,h+n,d+r),u=h,l=d;break;case"C":u=o[5],l=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,c+n,f+r,u+n,l+r);break;case"s":h=u+o[3],d=l+o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,u+o[1]+n,l+o[2]+r,h+n,d+r),c=u+o[1],f=l+o[2],u=h,l=d;break;case"S":h=o[3],d=o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"q":h=u+o[3],d=l+o[4],c=u+o[1],f=l+o[2],e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"Q":h=o[3],d=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"t":h=u+o[1],d=l+o[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-p,f=2*l-m):a[0]==="q"&&(c=2*u-c,f=2*l-f),p=c,m=f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d,c=u+o[1],f=l+o[2];break;case"T":h=o[1],d=o[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"a":VY(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+l+r]),u+=o[6],l+=o[7];break;case"A":VY(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),u=o[6],l=o[7];break;case"z":case"Z":e.closePath();break}a=o}}function VY(e,t,n,r){const i=Rgt(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const o=Pgt(i[s]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const GY=.5773502691896257,HY={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,lu)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Qg*n,i=r-n*GY,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Qg*n,i=r-n*GY;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Qg*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Qg*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Qg*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Qg*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Uge(e){return lt(HY,e)?HY[e]:Bgt(e)}var y3={};function Bgt(e){if(!lt(y3,e)){const t=y0(e);y3[e]={draw:function(n,r){Dx(n,t,0,0,Math.sqrt(r)/2)}}}return y3[e]}const Fc=.448084975506;function zgt(e){return e.x}function jgt(e){return e.y}function Ugt(e){return e.width}function Wgt(e){return e.height}function vl(e){return typeof e=="function"?e:()=>+e}function i_(e,t,n){return Math.max(t,Math.min(e,n))}function Wge(){var e=zgt,t=jgt,n=Ugt,r=Wgt,i=vl(0),s=i,o=i,a=i,u=null;function l(c,f,h){var d,p=f??+e.call(this,c),m=h??+t.call(this,c),g=+n.call(this,c),y=+r.call(this,c),b=Math.min(g,y)/2,x=i_(+i.call(this,c),0,b),v=i_(+s.call(this,c),0,b),w=i_(+o.call(this,c),0,b),C=i_(+a.call(this,c),0,b);if(u||(u=d=xg()),x<=0&&v<=0&&w<=0&&C<=0)u.rect(p,m,g,y);else{var S=p+g,_=m+y;u.moveTo(p+x,m),u.lineTo(S-v,m),u.bezierCurveTo(S-Fc*v,m,S,m+Fc*v,S,m+v),u.lineTo(S,_-C),u.bezierCurveTo(S,_-Fc*C,S-Fc*C,_,S-C,_),u.lineTo(p+w,_),u.bezierCurveTo(p+Fc*w,_,p,_-Fc*w,p,_-w),u.lineTo(p,m+x),u.bezierCurveTo(p,m+Fc*x,p+Fc*x,m,p+x,m),u.closePath()}if(d)return u=null,d+""||null}return l.x=function(c){return arguments.length?(e=vl(c),l):e},l.y=function(c){return arguments.length?(t=vl(c),l):t},l.width=function(c){return arguments.length?(n=vl(c),l):n},l.height=function(c){return arguments.length?(r=vl(c),l):r},l.cornerRadius=function(c,f,h,d){return arguments.length?(i=vl(c),s=f!=null?vl(f):i,a=h!=null?vl(h):i,o=d!=null?vl(d):s,l):i},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function Vge(){var e,t,n,r,i=null,s,o,a,u;function l(f,h,d){const p=d/2;if(s){var m=a-h,g=f-o;if(m||g){var y=Math.sqrt(m*m+g*g),b=(m/=y)*u,x=(g/=y)*u,v=Math.atan2(g,m);i.moveTo(o-b,a-x),i.lineTo(f-m*p,h-g*p),i.arc(f,h,p,v-Math.PI,v),i.lineTo(o+b,a+x),i.arc(o,a,u,v,v+Math.PI)}else i.arc(f,h,p,0,lu);i.closePath()}else s=1;o=f,a=h,u=p}function c(f){var h,d=f.length,p,m=!1,g;for(i==null&&(i=g=xg()),h=0;h<=d;++h)!(h<d&&r(p=f[h],h,f))===m&&(m=!m)&&(s=0),m&&l(+e(p,h,f),+t(p,h,f),+n(p,h,f));if(g)return i=null,g+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(r=f,c):r},c.context=function(f){return arguments.length?(f==null?i=null:i=f,c):i},c}function yC(e,t){return e??t}const bC=e=>e.x||0,vC=e=>e.y||0,Vgt=e=>e.width||0,Ggt=e=>e.height||0,Hgt=e=>(e.x||0)+(e.width||0),qgt=e=>(e.y||0)+(e.height||0),Xgt=e=>e.startAngle||0,Ygt=e=>e.endAngle||0,Kgt=e=>e.padAngle||0,Zgt=e=>e.innerRadius||0,Jgt=e=>e.outerRadius||0,Qgt=e=>e.cornerRadius||0,emt=e=>yC(e.cornerRadiusTopLeft,e.cornerRadius)||0,tmt=e=>yC(e.cornerRadiusTopRight,e.cornerRadius)||0,nmt=e=>yC(e.cornerRadiusBottomRight,e.cornerRadius)||0,rmt=e=>yC(e.cornerRadiusBottomLeft,e.cornerRadius)||0,imt=e=>yC(e.size,64),smt=e=>e.size||1,YI=e=>e.defined!==!1,omt=e=>Uge(e.shape||"circle"),amt=Tpt().startAngle(Xgt).endAngle(Ygt).padAngle(Kgt).innerRadius(Zgt).outerRadius(Jgt).cornerRadius(Qgt),umt=cge().x(bC).y1(vC).y0(qgt).defined(YI),lmt=cge().y(vC).x1(bC).x0(Hgt).defined(YI),cmt=lge().x(bC).y(vC).defined(YI),fmt=Wge().x(bC).y(vC).width(Vgt).height(Ggt).cornerRadius(emt,tmt,nmt,rmt),hmt=Ipt().type(omt).size(imt),dmt=Vge().x(bC).y(vC).defined(YI).size(smt);function Q7(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function pmt(e,t){return amt.context(e)(t)}function gmt(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?lmt:umt).curve(J7(r,n.orient,n.tension)).context(e)(t)}function mmt(e,t){const n=t[0],r=n.interpolate||"linear";return cmt.curve(J7(r,n.orient,n.tension)).context(e)(t)}function uy(e,t,n,r){return fmt.context(e)(t,n,r)}function ymt(e,t){return(t.mark.shape||t.shape).context(e)(t)}function bmt(e,t){return hmt.context(e)(t)}function vmt(e,t){return dmt.context(e)(t)}var Gge=1;function Hge(){Gge=1}function e9(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+Gge++),o=i.clipping[s]||(i.clipping[s]={id:s});return Ht(r)?o.path=r(null):Q7(n)?o.path=uy(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function Zi(e){this.clear(),e&&this.union(e)}Zi.prototype={clone(){return new Zi(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:o}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*r-u*i+l,u*r+a*i+c,a*r-u*o+l,u*r+a*o+c,a*s-u*i+l,u*s+a*i+c,a*s-u*o+l,u*s+a*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function t9(e){this.mark=e,this.bounds=this.bounds||new Zi}function n9(e){t9.call(this,e),this.items=this.items||[]}$e(n9,t9);function r9(e){this._pending=0,this._loader=e||K7()}function qY(e){e._pending+=1}function tb(e){e._pending-=1}r9.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return qY(t),t._loader.sanitize(e,{context:"href"}).then(n=>(tb(t),n)).catch(()=>(tb(t),null))},loadImage(e){const t=this,n=mce();return qY(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,o=lt(r,"crossOrigin")?r.crossOrigin:"anonymous";return o!=null&&(s.crossOrigin=o),s.onload=()=>tb(t),s.onerror=()=>tb(t),s.src=i,s}).catch(r=>(tb(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}n(!1)})}};function wg(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?xmt(t,r):0))}return e}function xmt(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const wmt=lu-1e-8;let KI,X_,Y_,Pd,JP,K_,QP,eL;const nf=(e,t)=>KI.add(e,t),Z_=(e,t)=>nf(X_=e,Y_=t),XY=e=>nf(e,KI.y1),YY=e=>nf(KI.x1,e),Ed=(e,t)=>JP*e+QP*t,Ad=(e,t)=>K_*e+eL*t,b3=(e,t)=>nf(Ed(e,t),Ad(e,t)),v3=(e,t)=>Z_(Ed(e,t),Ad(e,t));function xC(e,t){return KI=e,t?(Pd=t*th,JP=eL=Math.cos(Pd),K_=Math.sin(Pd),QP=-K_):(JP=eL=1,Pd=K_=QP=0),Cmt}const Cmt={beginPath(){},closePath(){},moveTo:v3,lineTo:v3,rect(e,t,n,r){Pd?(b3(e+n,t),b3(e+n,t+r),b3(e,t+r),v3(e,t)):(nf(e+n,t+r),Z_(e,t))},quadraticCurveTo(e,t,n,r){const i=Ed(e,t),s=Ad(e,t),o=Ed(n,r),a=Ad(n,r);KY(X_,i,o,XY),KY(Y_,s,a,YY),Z_(o,a)},bezierCurveTo(e,t,n,r,i,s){const o=Ed(e,t),a=Ad(e,t),u=Ed(n,r),l=Ad(n,r),c=Ed(i,s),f=Ad(i,s);ZY(X_,o,u,c,XY),ZY(Y_,a,l,f,YY),Z_(c,f)},arc(e,t,n,r,i,s){if(r+=Pd,i+=Pd,X_=n*Math.cos(i)+e,Y_=n*Math.sin(i)+t,Math.abs(i-r)>wmt)nf(e-n,t-n),nf(e+n,t+n);else{const o=l=>nf(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(o(r),o(i),i!==r)if(r=r%lu,r<0&&(r+=lu),i=i%lu,i<0&&(i+=lu),i<r&&(s=!s,a=r,r=i,i=a),s)for(i-=lu,a=r-r%kd,u=0;u<4&&a>i;++u,a-=kd)o(a);else for(a=r-r%kd+kd,u=0;u<4&&a<i;++u,a=a+kd)o(a)}}};function KY(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function ZY(e,t,n,r,i){const s=r-e+3*t-3*n,o=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(s)>Mgt?(c=o*o+a*s,c>=0&&(c=Math.sqrt(c),u=(-o+c)/s,l=(-o-c)/s)):u=.5*a/o,0<u&&u<1&&i(JY(u,e,t,n,r)),0<l&&l<1&&i(JY(l,e,t,n,r))}function JY(e,t,n,r,i){const s=1-e,o=s*s,a=e*e;return o*s*t+3*o*e*n+3*s*a*r+a*e*i}var wf=(wf=bc(1,1))?wf.getContext("2d"):null;const tL=new Zi;function i9(e){return function(t,n){if(!wf)return!0;e(wf,t),tL.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:o}=tL;for(let a=i;a<=o;++a)for(let u=r;u<=s;++u)if(wf.isPointInPath(u,a))return!0;return!1}}function s9(e,t){return t.contains(e.x||0,e.y||0)}function qge(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(tL.set(n,r,n+i,r+s))}function Xge(e,t){const n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,s=e.y2!=null?e.y2:r;return dm(t,n,r,i,s)}function dm(e,t,n,r,i){const{x1:s,y1:o,x2:a,y2:u}=e,l=r-t,c=i-n;let f=0,h=1,d,p,m,g;for(g=0;g<4;++g){if(g===0&&(d=-l,p=-(s-t)),g===1&&(d=l,p=a-t),g===2&&(d=-c,p=-(o-n)),g===3&&(d=c,p=u-n),Math.abs(d)<1e-10&&p<0)return!1;if(m=p/d,d<0){if(m>h)return!1;m>f&&(f=m)}else if(d>0){if(m<f)return!1;m<h&&(h=m)}}return!0}function b0(e,t){e.globalCompositeOperation=t.blend||"source-over"}function ea(e,t){return e??t}function QY(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function Smt(e,t,n){const r=n.width(),i=n.height();let s;if(t.gradient==="radial")s=e.createRadialGradient(n.x1+ea(t.x1,.5)*r,n.y1+ea(t.y1,.5)*i,Math.max(r,i)*ea(t.r1,0),n.x1+ea(t.x2,.5)*r,n.y1+ea(t.y2,.5)*i,Math.max(r,i)*ea(t.r2,.5));else{const o=ea(t.x1,0),a=ea(t.y1,0),u=ea(t.x2,1),l=ea(t.y2,0);if(o===u||a===l||r===i)s=e.createLinearGradient(n.x1+o*r,n.y1+a*i,n.x1+u*r,n.y1+l*i);else{const c=bc(Math.ceil(r),Math.ceil(i)),f=c.getContext("2d");return f.scale(r,i),f.fillStyle=QY(f.createLinearGradient(o,a,u,l),t.stops),f.fillRect(0,0,r,i),e.createPattern(c,"no-repeat")}}return QY(s,t.stops)}function Yge(e,t,n){return Z7(n)?Smt(e,n,t.bounds):n}function vE(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=Yge(e,t,t.fill),!0):!1}var _mt=[];function v0(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return r<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=Yge(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||_mt),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function $mt(e,t){return e.zindex-t.zindex||e.index-t.index}function o9(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,s;for(i=0,s=t.length;i<s;++i)r=t[i],r.index=i,r.zindex&&n.push(r);return e.zdirty=!1,e.zitems=n.sort($mt)}function Fa(e,t){var n=e.items,r,i;if(!n||!n.length)return;const s=o9(e);if(s&&s.length){for(r=0,i=n.length;r<i;++r)n[r].zindex||t(n[r]);n=s}for(r=0,i=n.length;r<i;++r)t(n[r])}function xE(e,t){var n=e.items,r,i;if(!n||!n.length)return null;const s=o9(e);for(s&&s.length&&(n=s),i=n.length;--i>=0;)if(r=t(n[i]))return r;if(n===s){for(n=e.items,i=n.length;--i>=0;)if(!n[i].zindex&&(r=t(n[i])))return r}return null}function a9(e){return function(t,n,r){Fa(n,i=>{(!r||r.intersects(i.bounds))&&Kge(e,t,i,i)})}}function kmt(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.bounds))&&Kge(e,t,n.items[0],n.items)}}function Kge(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(b0(t,n),n.fill&&vE(t,n,i)&&t.fill(),n.stroke&&v0(t,n,i)&&t.stroke()))}function ZI(e){return e=e||G1,function(t,n,r,i,s,o){return r*=t.pixelRatio,i*=t.pixelRatio,xE(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&e(t,a,r,i,s,o))return a})}}function wC(e,t){return function(n,r,i,s){var o=Array.isArray(r)?r[0]:r,a=t??o.fill,u=o.stroke&&n.isPointInStroke,l,c;return u&&(l=o.strokeWidth,c=o.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,r)?!1:a&&n.isPointInPath(i,s)||u&&n.isPointInStroke(i,s)}}function u9(e){return ZI(wC(e))}function Qd(e,t){return"translate("+e+","+t+")"}function l9(e){return"rotate("+e+")"}function Emt(e,t){return"scale("+e+","+t+")"}function Zge(e){return Qd(e.x||0,e.y||0)}function Amt(e){return Qd(e.x||0,e.y||0)+(e.angle?" "+l9(e.angle):"")}function Tmt(e){return Qd(e.x||0,e.y||0)+(e.angle?" "+l9(e.angle):"")+(e.scaleX||e.scaleY?" "+Emt(e.scaleX||1,e.scaleY||1):"")}function c9(e,t,n){function r(o,a){o("transform",Amt(a)),o("d",t(null,a))}function i(o,a){return t(xC(o,a.angle),a),wg(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,l=a.y||0,c=a.angle||0;o.translate(u,l),c&&o.rotate(c*=th),o.beginPath(),t(o,a),c&&o.rotate(-c),o.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:r,bound:i,draw:a9(s),pick:u9(s),isect:n||i9(s)}}var Dmt=c9("arc",pmt);function Imt(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,s=1/0,o,a;--i>=0;)e[i].defined!==!1&&(a=Math.abs(e[i][r]-n),a<s&&(s=a,o=e[i]));return o}function Fmt(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,s,o;--r>=0;)if(e[r].defined!==!1&&(i=e[r].x-t[0],s=e[r].y-t[1],o=i*i+s*s,o<n))return e[r];return null}function Omt(e,t){for(var n=e.length,r,i,s;--n>=0;)if(e[n].defined!==!1&&(r=e[n].x-t[0],i=e[n].y-t[1],s=r*r+i*i,r=e[n].size||1,s<r*r))return e[n];return null}function f9(e,t,n){function r(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function i(u,l){var c=l.items;return c.length===0?u:(t(xC(u),c),wg(u,c[0]))}function s(u,l){u.beginPath(),t(u,l)}const o=wC(s);function a(u,l,c,f,h,d){var p=l.items,m=l.bounds;return!p||!p.length||m&&!m.contains(h,d)?null:(c*=u.pixelRatio,f*=u.pixelRatio,o(u,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:r,bound:i,draw:kmt(s),pick:a,isect:s9,tip:n}}var Nmt=f9("area",gmt,Imt);function Mmt(e,t){var n=t.clip;e.save(),Ht(n)?(e.beginPath(),n(e),e.clip()):Jge(e,t.group)}function Jge(e,t){e.beginPath(),Q7(t)?uy(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Qge(e){const t=ea(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Rmt(e,t){e("transform",Zge(t))}function eme(e,t){const n=Qge(t);e("d",uy(null,t,n,n))}function Pmt(e,t){e("class","background"),e("aria-hidden",!0),eme(e,t)}function Lmt(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?eme(e,t):e("d","")}function Bmt(e,t,n){const r=t.clip?e9(n,t,t):null;e("clip-path",r)}function zmt(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),wg(e,t),e.translate(t.x||0,t.y||0)}function Ix(e,t,n,r){const i=Qge(t);e.beginPath(),uy(e,t,(n||0)+i,(r||0)+i)}const jmt=wC(Ix),Umt=wC(Ix,!1),Wmt=wC(Ix,!0);function Vmt(e,t,n){Fa(t,r=>{const i=r.x||0,s=r.y||0,o=r.strokeForeground,a=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&a&&(Ix(e,r,i,s),b0(e,r),r.fill&&vE(e,r,a)&&e.fill(),r.stroke&&!o&&v0(e,r,a)&&e.stroke()),e.save(),e.translate(i,s),r.clip&&Jge(e,r),n&&n.translate(-i,-s),Fa(r,u=>{this.draw(e,u,n)}),n&&n.translate(i,s),e.restore(),o&&r.stroke&&a&&(Ix(e,r,i,s),b0(e,r),v0(e,r,a)&&e.stroke())})}function Gmt(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const o=n*e.pixelRatio,a=r*e.pixelRatio;return xE(t,u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(i,s))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),m=u.clip;if(m&&(i<c||i>d||s<f||s>p))return;if(e.save(),e.translate(c,f),c=i-c,f=s-f,m&&Q7(u)&&!Wmt(e,u,o,a))return e.restore(),null;const g=u.strokeForeground,y=t.interactive!==!1;return y&&g&&u.stroke&&Umt(e,u,o,a)?(e.restore(),u):(l=xE(u,b=>Hmt(b,c,f)?this.pick(b,n,r,c,f):null),!l&&y&&(u.fill||!g&&u.stroke)&&jmt(e,u,o,a)&&(l=u),e.restore(),l||null)})}function Hmt(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var qmt={type:"group",tag:"g",nested:!1,attr:Rmt,bound:zmt,draw:Vmt,pick:Gmt,isect:qge,content:Bmt,background:Pmt,foreground:Lmt},Fx={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function h9(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function d9(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function p9(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function JI(e,t){return e==="center"?t/2:e==="right"?t:0}function QI(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function Xmt(e,t,n){const r=h9(t,n),i=d9(t,r),s=p9(t,r),o=(t.x||0)-JI(t.align,i),a=(t.y||0)-QI(t.baseline,s),u=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",u,Fx["xmlns:xlink"],"xlink:href"),e("transform",Qd(o,a)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function Ymt(e,t){const n=t.image,r=d9(t,n),i=p9(t,n),s=(t.x||0)-JI(t.align,r),o=(t.y||0)-QI(t.baseline,i);return e.set(s,o,s+r,o+i)}function Kmt(e,t,n){Fa(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=h9(r,this);let s=d9(r,i),o=p9(r,i);if(s===0||o===0)return;let a=(r.x||0)-JI(r.align,s),u=(r.y||0)-QI(r.baseline,o),l,c,f,h;r.aspect!==!1&&(c=i.width/i.height,f=r.width/r.height,c===c&&f===f&&c!==f&&(f<c?(h=s/c,u+=(o-h)/2,o=h):(h=o*c,a+=(s-h)/2,s=h))),(i.complete||i.toDataURL)&&(b0(e,r),e.globalAlpha=(l=r.opacity)!=null?l:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,a,u,s,o))})}var Zmt={type:"image",tag:"image",nested:!1,attr:Xmt,bound:Ymt,draw:Kmt,pick:ZI(),isect:G1,get:h9,xOffset:JI,yOffset:QI},Jmt=f9("line",mmt,Fmt);function Qmt(e,t){var n=t.scaleX||1,r=t.scaleY||1;(n!==1||r!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",Tmt(t)),e("d",t.path)}function J_(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,o=t.scaleY||1,a=(t.angle||0)*th,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=y0(n)).path=n),a&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(a),Dx(e,u,0,0,s,o),e.rotate(-a),e.translate(-r,-i)):Dx(e,u,r,i,s,o)}function e0t(e,t){return J_(xC(e,t.angle),t)?e.set(0,0,0,0):wg(e,t,!0)}var t0t={type:"path",tag:"path",nested:!1,attr:Qmt,bound:e0t,draw:a9(J_),pick:u9(J_),isect:i9(J_)};function n0t(e,t){e("d",uy(null,t))}function r0t(e,t){var n,r;return wg(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function eK(e,t){e.beginPath(),uy(e,t)}var i0t={type:"rect",tag:"path",nested:!1,attr:n0t,bound:r0t,draw:a9(eK),pick:u9(eK),isect:qge};function s0t(e,t){e("transform",Zge(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function o0t(e,t){var n,r;return wg(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function tme(e,t,n){var r,i,s,o;return t.stroke&&v0(e,t,n)?(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,o),!0):!1}function a0t(e,t,n){Fa(t,r=>{if(!(n&&!n.intersects(r.bounds))){var i=r.opacity==null?1:r.opacity;i&&tme(e,r,i)&&(b0(e,r),e.stroke())}})}function u0t(e,t,n,r){return e.isPointInStroke?tme(e,t,1)&&e.isPointInStroke(n,r):!1}var l0t={type:"rule",tag:"line",nested:!1,attr:s0t,bound:o0t,draw:a0t,pick:ZI(u0t),isect:Xge},c0t=c9("shape",ymt),f0t=c9("symbol",bmt,s9);const tK=Oae();var $u={height:Qu,measureWidth:g9,estimateWidth:nL,width:nL,canvas:nme};nme(!0);function nme(e){$u.width=e&&wf?g9:nL}function nL(e,t){return rme(rh(e,t),Qu(e))}function rme(e,t){return~~(.8*e.length*t)}function g9(e,t){return Qu(e)<=0||!(t=rh(e,t))?0:ime(t,eF(e))}function ime(e,t){const n=`(${t}) ${e}`;let r=tK.get(n);return r===void 0&&(wf.font=t,r=wf.measureText(e).width,tK.set(n,r)),r}function Qu(e){return e.fontSize!=null?+e.fontSize||0:11}function nh(e){return e.lineHeight!=null?e.lineHeight:Qu(e)+2}function h0t(e){return ht(e)?e.length>1?e:e[0]:e}function CC(e){return h0t(e.lineBreak&&e.text&&!ht(e.text)?e.text.split(e.lineBreak):e.text)}function d0t(e){const t=CC(e);return(ht(t)?t.length-1:0)*nh(e)}function rh(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?g0t(e,n):n}function p0t(e){if($u.width===g9){const t=eF(e);return n=>ime(n,t)}else{const t=Qu(e);return n=>rme(n,t)}}function g0t(e,t){var n=+e.limit,r=p0t(e);if(r(t)<n)return t;var i=e.ellipsis||"",s=e.dir==="rtl",o=0,a=t.length,u;if(n-=r(i),s){for(;o<a;)u=o+a>>>1,r(t.slice(u))>n?o=u+1:a=u;return i+t.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),r(t.slice(0,u))<n?o=u:a=u-1;return t.slice(0,o)+i}}function SC(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function eF(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Qu(e)+"px "+SC(e,t)}function m9(e){var t=e.baseline,n=Qu(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*nh(e):t==="line-bottom"?.29*n-.5*nh(e):0)}const m0t={left:"start",center:"middle",right:"end"},av=new Zi;function tF(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;return r&&(i=(e.theta||0)-kd,t+=r*Math.cos(i),n+=r*Math.sin(i)),av.x1=t,av.y1=n,av}function y0t(e,t){var n=t.dx||0,r=(t.dy||0)+m9(t),i=tF(t),s=i.x1,o=i.y1,a=t.angle||0,u;e("text-anchor",m0t[t.align]||"start"),a?(u=Qd(s,o)+" "+l9(a),(n||r)&&(u+=" "+Qd(n,r))):u=Qd(s+n,o+r),e("transform",u)}function y9(e,t,n){var r=$u.height(t),i=t.align,s=tF(t),o=s.x1,a=s.y1,u=t.dx||0,l=(t.dy||0)+m9(t)-Math.round(.8*r),c=CC(t),f;if(ht(c)?(r+=nh(t)*(c.length-1),f=c.reduce((h,d)=>Math.max(h,$u.width(t,d)),0)):f=$u.width(t,c),i==="center"?u-=f/2:i==="right"&&(u-=f),e.set(u+=o,l+=a,u+f,l+r),t.angle&&!n)e.rotate(t.angle*th,o,a);else if(n===2)return e.rotatedPoints(t.angle*th,o,a);return e}function b0t(e,t,n){Fa(t,r=>{var i=r.opacity==null?1:r.opacity,s,o,a,u,l,c,f;if(!(n&&!n.intersects(r.bounds)||i===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=eF(r),e.textAlign=r.align||"left",s=tF(r),o=s.x1,a=s.y1,r.angle&&(e.save(),e.translate(o,a),e.rotate(r.angle*th),o=a=0),o+=r.dx||0,a+=(r.dy||0)+m9(r),c=CC(r),b0(e,r),ht(c))for(l=nh(r),u=0;u<c.length;++u)f=rh(r,c[u]),r.fill&&vE(e,r,i)&&e.fillText(f,o,a),r.stroke&&v0(e,r,i)&&e.strokeText(f,o,a),a+=l;else f=rh(r,c),r.fill&&vE(e,r,i)&&e.fillText(f,o,a),r.stroke&&v0(e,r,i)&&e.strokeText(f,o,a);r.angle&&e.restore()}})}function v0t(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=tF(t),a=o.x1,u=o.y1,l=y9(av,t,1),c=-t.angle*th,f=Math.cos(c),h=Math.sin(c),d=f*i-h*s+(a-f*a+h*u),p=h*i+f*s+(u-h*a-f*u);return l.contains(d,p)}function x0t(e,t){const n=y9(av,e,2);return dm(t,n[0],n[1],n[2],n[3])||dm(t,n[0],n[1],n[4],n[5])||dm(t,n[4],n[5],n[6],n[7])||dm(t,n[2],n[3],n[6],n[7])}var w0t={type:"text",tag:"text",nested:!1,attr:y0t,bound:y9,draw:b0t,pick:ZI(v0t),isect:x0t},C0t=f9("trail",vmt,Omt),Po={arc:Dmt,area:Nmt,group:qmt,image:Zmt,line:Jmt,path:t0t,rect:i0t,rule:l0t,shape:c0t,symbol:f0t,text:w0t,trail:C0t};function rL(e,t,n){var r=Po[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new Zi),e,n)}var nK={mark:null};function sme(e,t,n){var r=Po[e.marktype],i=r.bound,s=e.items,o=s&&s.length,a,u,l,c;if(r.nested)return o?l=s[0]:(nK.mark=e,l=nK),c=rL(l,i,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new Zi,o)for(a=0,u=s.length;a<u;++a)t.union(rL(s[a],i,n));return e.bounds=t}const S0t=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function ome(e,t){return JSON.stringify(e,S0t,t)}function ame(e){const t=typeof e=="string"?JSON.parse(e):e;return ume(t)}function ume(e){var t=e.marktype,n=e.items,r,i,s;if(n)for(i=0,s=n.length;i<s;++i)r=t?"mark":"group",n[i][r]=e,n[i].zindex&&(n[i][r].zdirty=!0),(t||r)==="group"&&ume(n[i]);return t&&sme(e),e}function b9(e){arguments.length?this.root=ame(e):(this.root=lme({marktype:"group",name:"root",role:"frame"}),this.root.items=[new n9(this.root)])}b9.prototype={toJSON(e){return ome(this.root,e||0)},mark(e,t,n){t=t||this.root.items[0];const r=lme(e,t);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}};function lme(e,t){const n={bounds:new Zi,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function rf(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function v9(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function ds(e,t,n,r){var i=e.childNodes[t],s;return(!i||i.tagName.toLowerCase()!==n.toLowerCase())&&(s=i||null,i=rf(e.ownerDocument,n,r),e.insertBefore(i,s)),i}function pa(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function cme(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function nF(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function _0t(e,t,n,r){var i=e&&e.mark,s,o;if(i&&(s=Po[i.marktype]).tip){for(o=nF(t,n),o[0]-=r[0],o[1]-=r[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=s.tip(i.items,o)}return e}function ih(e,t){this._active=null,this._handlers={},this._loader=e||K7(),this._tooltip=t||$0t}function $0t(e,t,n,r){e.element().setAttribute("title",r||"")}ih.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=rf(null,"a");for(const o in r)s.setAttribute(o,r[o]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=_0t(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),o=i.height();let a=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}};function el(e){this._el=null,this._bgcolor=null,this._loader=new r9(e)}el.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const k0t="keydown",E0t="keypress",A0t="keyup",fme="dragenter",Q_="dragleave",hme="dragover",iL="mousedown",T0t="mouseup",wE="mousemove",uv="mouseout",dme="mouseover",CE="click",D0t="dblclick",I0t="wheel",pme="mousewheel",SE="touchstart",_E="touchmove",$E="touchend",F0t=[k0t,E0t,A0t,fme,Q_,hme,iL,T0t,wE,uv,dme,CE,D0t,I0t,pme,SE,_E,$E],sL=wE,Ox=uv,oL=CE;function _C(e,t){ih.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const O0t=e=>e===SE||e===_E||e===$E?[SE,_E,$E]:[e];function rK(e,t){O0t(t).forEach(n=>N0t(e,n))}function N0t(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?r=>e[t](r):r=>e.fire(t,r)))}function iK(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?this.fire(e,r):((!i||!i.exit)&&this.fire(n,r),this._active=s,this.fire(t,r),this.fire(e,r))}}function sK(e){return function(t){this.fire(e,t),this._active=null}}$e(_C,ih,{initialize(e,t,n){return this._canvas=e&&v9(e,"canvas"),[CE,iL,wE,uv,Q_].forEach(r=>rK(this,r)),ih.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:F0t,DOMMouseScroll(e){this.fire(pme,e)},mousemove:iK(wE,dme,uv),dragover:iK(hme,fme,Q_),mouseout:sK(uv),dragleave:sK(Q_),mousedown(e){this._down=this._active,this.fire(iL,e)},click(e){this._down===this._active&&(this.fire(CE,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(SE,e,!0)},touchmove(e){this.fire(_E,e,!0)},touchend(e){this.fire($E,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===oL&&r&&r.href?this.handleHref(t,r,r.href):(e===sL||e===Ox)&&this.handleTooltip(t,r,e!==Ox),i)for(let s=0,o=i.length;s<o;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(rK(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=nF(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return Po[e.marktype].pick.call(this,s,e,t,n,r,i)}});function M0t(){return typeof window<"u"&&window.devicePixelRatio||1}var R0t=M0t();function P0t(e,t,n,r,i,s){const o=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=o?R0t:i;e.width=t*u,e.height=n*u;for(const l in s)a[l]=s[l];return o&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*r[0],u*r[1]),e}function kE(e){el.call(this,e),this._options={},this._redraw=!1,this._dirty=new Zi,this._tempb=new Zi}const oK=el.prototype,L0t=(e,t,n)=>new Zi().set(0,0,t,n).translate(-e[0],-e[1]);function B0t(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}$e(kE,el,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:bc(1,1,this._options.type),e&&this._canvas&&(pa(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),oK.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(oK.resize.call(this,e,t,n,r),this._canvas)P0t(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||ye("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,o=L0t(n,r,i);t.save();const a=this._redraw||s.empty()?(this._redraw=!1,o.expand(1)):B0t(t,o.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,a),t.restore(),s.clear(),this},draw(e,t,n){const r=Po[t.marktype];t.clip&&Mmt(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type!=="pdf"&&!i.externalContext&&s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});function x9(e,t){ih.call(this,e,t);const n=this;n._hrefHandler=aL(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=aL(n,(r,i)=>{n.handleTooltip(r,i,r.type!==Ox)})}const aL=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};$e(x9,ih,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(oL,this._hrefHandler),r.removeEventListener(sL,this._tooltipHandler),r.removeEventListener(Ox,this._tooltipHandler)),this._svg=r=e&&v9(e,"svg"),r&&(r.addEventListener(oL,this._hrefHandler),r.addEventListener(sL,this._tooltipHandler),r.addEventListener(Ox,this._tooltipHandler)),ih.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const s={type:e,handler:t,listener:aL(this,t)};(r[n]||(r[n]=[])).push(s),this._svg&&this._svg.addEventListener(n,s.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const gme="aria-hidden",w9="aria-label",C9="role",S9="aria-roledescription",mme="graphics-object",_9="graphics-symbol",yme=(e,t,n)=>({[C9]:e,[S9]:t,[w9]:n||void 0}),z0t=nc(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),aK={axis:{desc:"axis",caption:W0t},legend:{desc:"legend",caption:V0t},"title-text":{desc:"title",caption:e=>`Title text '${lK(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${lK(e)}'`}},uK={ariaRole:C9,ariaRoleDescription:S9,description:w9};function bme(e,t){const n=t.aria===!1;if(e(gme,n||void 0),n||t.description==null)for(const r in uK)e(uK[r],void 0);else{const r=t.mark.marktype;e(w9,t.description),e(C9,t.ariaRole||(r==="group"?mme:_9)),e(S9,t.ariaRoleDescription||`${r} mark`)}}function vme(e){return e.aria===!1?{[gme]:!0}:z0t[e.role]?null:aK[e.role]?U0t(e,aK[e.role]):j0t(e)}function j0t(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(r=>r.description!=null&&r.aria!==!1);return yme(n?mme:_9,`${t} mark container`,e.description)}function U0t(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return yme(t.role||_9,t.desc,n.description||r(n))}catch{return null}}function lK(e){return at(e.text).join(" ")}function W0t(e){const t=e.datum,n=e.orient,r=t.title?xme(e):null,i=e.context,s=i.scales[t.scale].value,o=i.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${c0(a)?"discrete":a} scale with ${Ode(o,s,e)}`}function V0t(e){const t=e.datum,n=t.title?xme(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),o=e.context,a=o.scales[i[s[0]]].value,u=o.dataflow.locale();return H0t(r)+(n?` titled '${n}'`:"")+` for ${G0t(s)} with ${Ode(u,a,e)}`}function xme(e){try{return at(en(e.items).items[0].text).join(" ")}catch{return null}}function G0t(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+en(e)}function H0t(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const wme=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),q0t=e=>wme(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function $9(){let e="",t="",n="";const r=[],i=()=>t=n="",s=u=>{t&&(e+=`${t}>${n}`,i()),r.push(u)},o=(u,l)=>(l!=null&&(t+=` ${u}="${q0t(l)}"`),a),a={open(u,...l){s(u),t="<"+u;for(const c of l)for(const f in c)o(f,c[f]);return a},close(){const u=r.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,i(),a},attr:o,text:u=>(n+=wme(u),a),toString:()=>e};return a}const Cme=e=>Sme($9(),e)+"";function Sme(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let i=0;i<r;++i)e.attr(n[i].name,n[i].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let i=0;i<r;i++){const s=n[i];s.nodeType===3?e.text(s.nodeValue):Sme(e,s)}}return e.close()}const EE={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},_me={fill:"none","stroke-miterlimit":10},nb=0,cK="http://www.w3.org/2000/xmlns/",ur=Fx.xmlns;function k9(e){el.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const x3=el.prototype;$e(k9,el,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=ds(e,0,"svg",ur),this._svg.setAttributeNS(cK,"xmlns",ur),this._svg.setAttributeNS(cK,"xmlns:xlink",Fx["xmlns:xlink"]),this._svg.setAttribute("version",Fx.version),this._svg.setAttribute("class","marks"),pa(e,1),this._root=ds(this._svg,nb,"g",ur),sf(this._root,_me),pa(this._svg,nb+1)),this.background(this._bgcolor),x3.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),x3.background.apply(this,arguments)},resize(e,t,n,r){return x3.resize.call(this,e,t,n,r),this._svg&&(sf(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=ds(e,nb,"rect",ur),sf(n,{width:this._width,height:this._height,fill:t}));const r=Cme(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),pa(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,o,a,u;for(o=0,a=e.length;o<a;++o)if(n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,s=Po[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,fK(n,t),r.items.forEach(l=>{l.dirty=t})),!r.zdirty){if(n.exit){s.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=s.nested?r.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,fK(n,t)):this._update(s,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=Po[t.marktype],s=t.interactive===!1?"none":null,o=i.tag==="g";let a=null,u=0;const l=hK(t,e,n,"g",r);l.setAttribute("class",cme(t));const c=vme(t);for(const h in c)Oi(l,h,c[h]);o||Oi(l,"pointer-events",s),Oi(l,"clip-path",t.clip?e9(this,t,t.group):null);const f=h=>{const d=this.isDirty(h),p=hK(h,l,a,i.tag,r);d&&(this._update(i,p,h),o&&K0t(this,p,h)),a=p,++u};return i.nested?t.items.length&&f(t.items[0]):Fa(t,f),pa(l,u),l},_update(e,t,n){zl=t,ai=t.__values__,bme(lv,n),e.attr(lv,n,this);const r=J0t[e.type];r&&r.call(this,e,t,n),zl&&this.style(zl,n)},style(e,t){if(t!=null)for(const n in EE){let r=n==="font"?SC(t):t[n];if(r===ai[n])continue;const i=EE[n];r==null?e.removeAttribute(i):(Z7(r)&&(r=Bge(r,this._defs.gradient,$me())),e.setAttribute(i,r+"")),ai[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=ds(e,nb+1,"defs",ur)),r=X0t(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=ds(e,nb+1,"defs",ur)),r=Y0t(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):pa(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function fK(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function X0t(e,t,n){let r,i,s;if(t.gradient==="radial"){let o=ds(e,n++,"pattern",ur);sf(o,{id:bE+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=ds(o,0,"rect",ur),sf(o,{width:1,height:1,fill:`url(${$me()}#${t.id})`}),e=ds(e,n++,"radialGradient",ur),sf(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=ds(e,n++,"linearGradient",ur),sf(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)s=ds(e,r,"stop",ur),s.setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return pa(e,r),n}function Y0t(e,t,n){let r;return e=ds(e,n,"clipPath",ur),e.setAttribute("id",t.id),t.path?(r=ds(e,0,"path",ur),r.setAttribute("d",t.path)):(r=ds(e,0,"rect",ur),sf(r,{x:0,y:0,width:t.width,height:t.height})),pa(e,1),n+1}function K0t(e,t,n){t=t.lastChild.previousSibling;let r,i=0;Fa(n,s=>{r=e.mark(t,s,r),++i}),pa(t,1+i)}function hK(e,t,n,r,i){let s=e._svg,o;if(!s&&(o=t.ownerDocument,s=rf(o,r,ur),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},r==="g"))){const a=rf(o,"path",ur);s.appendChild(a),a.__data__=e;const u=rf(o,"g",ur);s.appendChild(u),u.__data__=e;const l=rf(o,"path",ur);s.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(s.ownerSVGElement!==i||Z0t(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}function Z0t(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let zl=null,ai=null;const J0t={group(e,t,n){const r=zl=t.childNodes[2];ai=r.__values__,e.foreground(lv,n,this),ai=t.__values__,zl=t.childNodes[1],e.content(lv,n,this);const i=zl=t.childNodes[0];e.background(lv,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==ai.events&&(Oi(r,"pointer-events",s),Oi(i,"pointer-events",s),ai.events=s),n.strokeForeground&&n.stroke){const o=n.fill;Oi(r,"display",null),this.style(i,n),Oi(i,"stroke",null),o&&(n.fill=null),ai=r.__values__,this.style(r,n),o&&(n.fill=o),zl=null}else Oi(r,"display","none")},image(e,t,n){n.smooth===!1?(w3(t,"image-rendering","optimizeSpeed"),w3(t,"image-rendering","pixelated")):w3(t,"image-rendering",null)},text(e,t,n){const r=CC(n);let i,s,o,a;ht(r)?(s=r.map(u=>rh(n,u)),i=s.join(`
`),i!==ai.text&&(pa(t,0),o=t.ownerDocument,a=nh(n),s.forEach((u,l)=>{const c=rf(o,"tspan",ur);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),ai.text=i)):(s=rh(n,r),s!==ai.text&&(t.textContent=s,ai.text=s)),Oi(t,"font-family",SC(n)),Oi(t,"font-size",Qu(n)+"px"),Oi(t,"font-style",n.fontStyle),Oi(t,"font-variant",n.fontVariant),Oi(t,"font-weight",n.fontWeight)}};function lv(e,t,n){t!==ai[e]&&(n?Q0t(zl,e,t,n):Oi(zl,e,t),ai[e]=t)}function w3(e,t,n){n!==ai[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),ai[t]=n)}function sf(e,t){for(const n in t)Oi(e,n,t[n])}function Oi(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function Q0t(e,t,n,r){n!=null?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}function $me(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function E9(e){el.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}$e(E9,el,{svg(){return this._text},_render(e){const t=$9();t.open("svg",St({},Fx,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",_me,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Po[t.marktype],r=n.tag,i=[bme,n.attr];e.open("g",{class:cme(t),"clip-path":t.clip?e9(this,t,t.group):null},vme(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=o=>{const a=this.href(o);if(a&&e.open("a",a),e.open(r,this.attr(t,o,i,r!=="g"?r:null)),r==="text"){const u=CC(o);if(ht(u)){const l={x:0,dy:nh(o)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(rh(o,u[c])).close()}else e.text(rh(o,u))}else if(r==="g"){const u=o.strokeForeground,l=o.fill,c=o.stroke;u&&c&&(o.stroke=null),e.open("path",this.attr(t,o,n.background,"bgrect")).close(),e.open("g",this.attr(t,o,n.content)),Fa(o,f=>this.mark(e,f)),e.close(),u&&c?(l&&(o.fill=null),o.stroke=c,e.open("path",this.attr(t,o,n.foreground,"bgrect")).close(),l&&(o.fill=l)):e.open("path",this.attr(t,o,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):Fa(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(o,a,u,l)=>{i[l||o]=a};return Array.isArray(n)?n.forEach(o=>o(s,t,this)):n(s,t,this),r&&e1t(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const i in t){const s=t[i],o=s.stops;s.gradient==="radial"?(e.open("pattern",{id:bE+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close(),e.close(),e.open("radialGradient",{id:i,fx:s.x1,fy:s.y1,fr:s.r1,cx:s.x2,cy:s.y2,r:s.r2})):e.open("linearGradient",{id:i,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2});for(let a=0;a<o.length;++a)e.open("stop",{offset:o[a].offset,"stop-color":o[a].color}).close();e.close()}for(const i in n){const s=n[i];e.open("clipPath",{id:i}),s.path?e.open("path",{d:s.path}).close():e.open("rect",{x:0,y:0,width:s.width,height:s.height}).close(),e.close()}e.close()}}});function e1t(e,t,n,r,i){if(t==null||(r==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),r==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;r==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),r==="text"&&(e["font-family"]=SC(t),e["font-size"]=Qu(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const s in EE){let o=t[s];const a=EE[s];o==="transparent"&&(a==="fill"||a==="stroke")||o!=null&&(Z7(o)&&(o=Bge(o,i.gradient,"")),e[a]=o)}return e}const kme="canvas",Eme="png",Ame="svg",Tme="none",of={Canvas:kme,PNG:Eme,SVG:Ame,None:Tme},x0={};x0[kme]=x0[Eme]={renderer:kE,headless:kE,handler:_C};x0[Ame]={renderer:k9,headless:E9,handler:x9};x0[Tme]={};function rF(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(x0[e]=t,this):x0[e]}function Dme(e,t,n){const r=[],i=new Zi().union(t),s=e.marktype;return s?Ime(e,i,n,r):s==="group"?Fme(e,i,n,r):ye("Intersect scene must be mark node or group item.")}function Ime(e,t,n,r){if(t1t(e,t,n)){const i=e.items,s=e.marktype,o=i.length;let a=0;if(s==="group")for(;a<o;++a)Fme(i[a],t,n,r);else for(const u=Po[s].isect;a<o;++a){const l=i[a];Ome(l,t,u)&&r.push(l)}}return r}function t1t(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function Fme(e,t,n,r){n&&n(e.mark)&&Ome(e,t,Po.group.isect)&&r.push(e);const i=e.items,s=i&&i.length;if(s){const o=e.x||0,a=e.y||0;t.translate(-o,-a);for(let u=0;u<s;++u)Ime(i[u],t,n,r);t.translate(o,a)}return r}function Ome(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}const C3=new Zi;function n1t(e){const t=e.clip;if(Ht(t))t(xC(C3.clear()));else if(t)C3.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(C3)}const r1t=1e-9;function A9(e,t,n){return e===t?!0:n==="path"?Nme(e,t):e instanceof Date&&t instanceof Date?+e==+t:bp(e)&&bp(t)?Math.abs(e-t)<=r1t:!e||!t||!wt(e)&&!wt(t)?e==t:i1t(e,t)}function Nme(e,t){return A9(y0(e),y0(t))}function i1t(e,t){var n=Object.keys(e),r=Object.keys(t),i,s;if(n.length!==r.length)return!1;for(n.sort(),r.sort(),s=n.length-1;s>=0;s--)if(n[s]!=r[s])return!1;for(s=n.length-1;s>=0;s--)if(i=n[s],!A9(e[i],t[i],i))return!1;return typeof e==typeof t}function s1t(){Hge(),Ogt()}const o1t=4278190080,a1t=268435456,u1t=.0625;function l1t(e,t){const n=e.bitmap();return(t||[]).forEach(r=>n.set(e(r.boundary[0]),e(r.boundary[3]))),[n,void 0]}function c1t(e,t,n,r){const i=e.width,s=e.height,o=n||r,a=bc(i,s).getContext("2d");t.forEach(g=>Mme(a,g,o));const u=new Uint32Array(a.getImageData(0,0,i,s).data.buffer),l=e.bitmap(),c=o&&e.bitmap();let f,h,d,p,m;for(h=0;h<s;++h)for(f=0;f<i;++f)m=u[h*i+f]&o1t,m&&(d=e(f),p=e(h),r||l.set(d,p),o&&m^a1t&&c.set(d,p));return[l,c]}function Mme(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;r==="group"?t.forEach(i=>{i.items.forEach(s=>Mme(e,s.items,n))}):Po[r].draw(e,{items:n?t.map(f1t):t})}function f1t(e){const t=GD(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=u1t,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const xl=5,Ii=31,Nx=32,jc=new Uint32Array(Nx+1),ca=new Uint32Array(Nx+1);ca[0]=0;jc[0]=~ca[0];for(let e=1;e<=Nx;++e)ca[e]=ca[e-1]<<1|1,jc[e]=~ca[e];function h1t(e,t){const n=new Uint32Array(~~((e*t+Nx)/Nx));function r(s,o){n[s]|=o}function i(s,o){n[s]&=o}return{array:n,get:(s,o)=>{const a=o*e+s;return n[a>>>xl]&1<<(a&Ii)},set:(s,o)=>{const a=o*e+s;r(a>>>xl,1<<(a&Ii))},clear:(s,o)=>{const a=o*e+s;i(a>>>xl,~(1<<(a&Ii)))},getRange:(s,o,a,u)=>{let l=u,c,f,h,d;for(;l>=o;--l)if(c=l*e+s,f=l*e+a,h=c>>>xl,d=f>>>xl,h===d){if(n[h]&jc[c&Ii]&ca[(f&Ii)+1])return!0}else{if(n[h]&jc[c&Ii]||n[d]&ca[(f&Ii)+1])return!0;for(let p=h+1;p<d;++p)if(n[p])return!0}return!1},setRange:(s,o,a,u)=>{let l,c,f,h,d;for(;o<=u;++o)if(l=o*e+s,c=o*e+a,f=l>>>xl,h=c>>>xl,f===h)r(f,jc[l&Ii]&ca[(c&Ii)+1]);else for(r(f,jc[l&Ii]),r(h,ca[(c&Ii)+1]),d=f+1;d<h;++d)r(d,4294967295)},clearRange:(s,o,a,u)=>{let l,c,f,h,d;for(;o<=u;++o)if(l=o*e+s,c=o*e+a,f=l>>>xl,h=c>>>xl,f===h)i(f,ca[l&Ii]|jc[(c&Ii)+1]);else for(i(f,ca[l&Ii]),i(h,jc[(c&Ii)+1]),d=f+1;d<h;++d)i(d,0)},outOfBounds:(s,o,a,u)=>s<0||o<0||u>=t||a>=e}}function d1t(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),s=~~((t+2*n+r)/r),o=a=>~~((a+n)/r);return o.invert=a=>a*r-n,o.bitmap=()=>h1t(i,s),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function p1t(e,t,n,r){const i=e.width,s=e.height;return function(o){const a=o.datum.datum.items[r].items,u=a.length,l=o.datum.fontSize,c=$u.width(o.datum,o.datum.text);let f=0,h,d,p,m,g,y,b;for(let x=0;x<u;++x)h=a[x].x,p=a[x].y,d=a[x].x2===void 0?h:a[x].x2,m=a[x].y2===void 0?p:a[x].y2,g=(h+d)/2,y=(p+m)/2,b=Math.abs(d-h+m-p),b>=f&&(f=b,o.x=g,o.y=y);return g=c/2,y=l/2,h=o.x-g,d=o.x+g,p=o.y-y,m=o.y+y,o.align="center",h<0&&d<=i?o.align="left":0<=h&&i<d&&(o.align="right"),o.baseline="middle",p<0&&m<=s?o.baseline="top":0<=p&&s<m&&(o.baseline="bottom"),!0}}function AE(e,t,n,r,i,s){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>s}function af(e,t,n,r,i,s,o,a){const u=i*s/(r*2),l=e(t-u),c=e(t+u),f=e(n-(s=s/2)),h=e(n+s);return o.outOfBounds(l,f,c,h)||o.getRange(l,f,c,h)||a&&a.getRange(l,f,c,h)}function g1t(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1];function u(l,c,f,h,d){const p=e.invert(l),m=e.invert(c);let g=f,y=s,b;if(!AE(p,m,h,d,i,s)&&!af(e,p,m,d,h,g,o,a)&&!af(e,p,m,d,h,d,o,null)){for(;y-g>=1;)b=(g+y)/2,af(e,p,m,d,h,b,o,a)?y=b:g=b;if(g>f)return[p,m,g,!0]}}return function(l){const c=l.datum.datum.items[r].items,f=c.length,h=l.datum.fontSize,d=$u.width(l.datum,l.datum.text);let p=n?h:0,m=!1,g=!1,y=0,b,x,v,w,C,S,_,$,k,E,F,T,I,D,N,V,U;for(let A=0;A<f;++A){for(b=c[A].x,v=c[A].y,x=c[A].x2===void 0?b:c[A].x2,w=c[A].y2===void 0?v:c[A].y2,b>x&&(U=b,b=x,x=U),v>w&&(U=v,v=w,w=U),k=e(b),F=e(x),E=~~((k+F)/2),T=e(v),D=e(w),I=~~((T+D)/2),_=E;_>=k;--_)for($=I;$>=T;--$)V=u(_,$,p,d,h),V&&([l.x,l.y,p,m]=V);for(_=E;_<=F;++_)for($=I;$<=D;++$)V=u(_,$,p,d,h),V&&([l.x,l.y,p,m]=V);!m&&!n&&(N=Math.abs(x-b+w-v),C=(b+x)/2,S=(v+w)/2,N>=y&&!AE(C,S,d,h,i,s)&&!af(e,C,S,h,d,h,o,null)&&(y=N,l.x=C,l.y=S,g=!0))}return m||g?(C=d/2,S=h/2,o.setRange(e(l.x-C),e(l.y-S),e(l.x+C),e(l.y+S)),l.align="center",l.baseline="middle",!0):!1}}const m1t=[-1,-1,1,1],y1t=[-1,1,-1,1];function b1t(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1],u=e.bitmap();return function(l){const c=l.datum.datum.items[r].items,f=c.length,h=l.datum.fontSize,d=$u.width(l.datum,l.datum.text),p=[];let m=n?h:0,g=!1,y=!1,b=0,x,v,w,C,S,_,$,k,E,F,T,I;for(let D=0;D<f;++D){for(x=c[D].x,w=c[D].y,v=c[D].x2===void 0?x:c[D].x2,C=c[D].y2===void 0?w:c[D].y2,p.push([e((x+v)/2),e((w+C)/2)]);p.length;)if([$,k]=p.pop(),!(o.get($,k)||a.get($,k)||u.get($,k))){u.set($,k);for(let N=0;N<4;++N)S=$+m1t[N],_=k+y1t[N],u.outOfBounds(S,_,S,_)||p.push([S,_]);if(S=e.invert($),_=e.invert(k),E=m,F=s,!AE(S,_,d,h,i,s)&&!af(e,S,_,h,d,E,o,a)&&!af(e,S,_,h,d,h,o,null)){for(;F-E>=1;)T=(E+F)/2,af(e,S,_,h,d,T,o,a)?F=T:E=T;E>m&&(l.x=S,l.y=_,m=E,g=!0)}}!g&&!n&&(I=Math.abs(v-x+C-w),S=(x+v)/2,_=(w+C)/2,I>=b&&!AE(S,_,d,h,i,s)&&!af(e,S,_,h,d,h,o,null)&&(b=I,l.x=S,l.y=_,y=!0))}return g||y?(S=d/2,_=h/2,o.setRange(e(l.x-S),e(l.y-_),e(l.x+S),e(l.y+_)),l.align="center",l.baseline="middle",!0):!1}}const v1t=["right","center","left"],x1t=["bottom","middle","top"];function w1t(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1],u=r.length;return function(l){const c=l.boundary,f=l.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>i||c[3]>s)return!1;let h=0,d,p,m,g,y,b,x,v,w,C,S,_,$,k,E;for(let F=0;F<u;++F){if(d=(n[F]&3)-1,p=(n[F]>>>2&3)-1,m=d===0&&p===0||r[F]<0,g=d&&p?Math.SQRT1_2:1,y=r[F]<0?-1:1,b=c[1+d]+r[F]*d*g,S=c[4+p]+y*f*p/2+r[F]*p*g,v=S-f/2,w=S+f/2,_=e(b),k=e(v),E=e(w),!h)if(dK(_,_,k,E,o,a,b,b,v,w,c,m))h=$u.width(l.datum,l.datum.text);else continue;if(C=b+y*h*d/2,b=C-h/2,x=C+h/2,_=e(b),$=e(x),dK(_,$,k,E,o,a,b,x,v,w,c,m))return l.x=d?d*y<0?x:b:C,l.y=p?p*y<0?w:v:S,l.align=v1t[d*y+1],l.baseline=x1t[p*y+1],o.setRange(_,k,$,E),!0}return!1}}function dK(e,t,n,r,i,s,o,a,u,l,c,f){return!(i.outOfBounds(e,n,t,r)||(f&&s?s.getRange(e,n,t,r)||!C1t(o,u,a,l,c):i.getRange(e,n,t,r)))}function C1t(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}const S3=0,_3=4,$3=8,k3=0,E3=1,A3=2,S1t={"top-left":S3+k3,top:S3+E3,"top-right":S3+A3,left:_3+k3,middle:_3+E3,right:_3+A3,"bottom-left":$3+k3,bottom:$3+E3,"bottom-right":$3+A3},_1t={naive:p1t,"reduced-search":g1t,floodfill:b1t};function $1t(e,t,n,r,i,s,o,a,u,l,c){if(!e.length)return e;const f=Math.max(r.length,i.length),h=k1t(r,f),d=E1t(i,f),p=A1t(e[0].datum),m=p==="group"&&e[0].datum.items[u].marktype,g=m==="area",y=T1t(p,m,a,u),b=d1t(t[0],t[1],l),x=g&&c==="naive",v=e.map(S=>({datum:S,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(S)}));let w;if(!x){n&&v.sort((_,$)=>n(_.datum,$.datum));let S=!1;for(let _=0;_<d.length&&!S;++_)S=d[_]===5||h[_]<0;p&&(o||g)&&(s=[e.map(_=>_.datum)].concat(s)),w=s.length?c1t(b,s,S,g):l1t(b,o&&v)}const C=g?_1t[c](b,w,o,u):w1t(b,w,d,h);return v.forEach(S=>S.opacity=+C(S)),v}function k1t(e,t){const n=new Float64Array(t),r=e.length;for(let i=0;i<r;++i)n[i]=e[i]||0;for(let i=r;i<t;++i)n[i]=n[r-1];return n}function E1t(e,t){const n=new Int8Array(t),r=e.length;for(let i=0;i<r;++i)n[i]|=S1t[e[i]];for(let i=r;i<t;++i)n[i]=n[r-1];return n}function A1t(e){return e&&e.mark&&e.mark.marktype}function T1t(e,t,n,r){const i=s=>[s.x,s.x,s.x,s.y,s.y,s.y];return e?e==="line"||e==="area"?s=>i(s.datum):t==="line"?s=>{const o=s.datum.items[r].items;return i(o.length?o[n==="start"?0:o.length-1]:{x:NaN,y:NaN})}:s=>{const o=s.datum.bounds;return[o.x1,(o.x1+o.x2)/2,o.x2,o.y1,(o.y1+o.y2)/2,o.y2]}:i}const uL=["x","y","opacity","align","baseline"],Rme=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function T9(e){he.call(this,null,e)}T9.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Rme},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:uL.length,default:uL}]};$e(T9,he,{transform(e,t){function n(s){const o=e[s];return Ht(o)&&t.modified(o.fields)}const r=e.modified();if(!(r||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&ye("Size parameter should be specified as a [width, height] array.");const i=e.as||uL;return $1t(t.materialize(t.SOURCE).source,e.size,e.sort,at(e.offset||1),at(e.anchor||Rme),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(s=>{const o=s.datum;o[i[0]]=s.x,o[i[1]]=s.y,o[i[2]]=s.opacity,o[i[3]]=s.align,o[i[4]]=s.baseline}),t.reflow(r).modifies(i)}});const D1t=Object.freeze(Object.defineProperty({__proto__:null,label:T9},Symbol.toStringTag,{value:"Module"}));function Pme(e,t){var n=[],r=function(c){return c(a)},i,s,o,a,u,l;if(t==null)n.push(e);else for(i={},s=0,o=e.length;s<o;++s)a=e[s],u=t.map(r),l=i[u],l||(i[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function D9(e){he.call(this,null,e)}D9.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};$e(D9,he,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Pme(r,e.groupby),s=(e.groupby||[]).map(Ln),o=s.length,a=e.as||[Ln(e.x),Ln(e.y)],u=[];i.forEach(l=>{Hue(l,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let h=0;h<o;++h)f[s[h]]=l.dims[h];f[a[0]]=c[0],f[a[1]]=c[1],u.push(zt(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const lL={linear:Wz,log:Uue,exp:Wue,pow:Vue,quad:Vz,poly:Gue},I1t=(e,t)=>e==="poly"?t:e==="quad"?2:1;function I9(e){he.call(this,null,e)}I9.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(lL)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};$e(I9,he,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Pme(r,e.groupby),s=(e.groupby||[]).map(Ln),o=e.method||"linear",a=e.order||3,u=I1t(o,a),l=e.as||[Ln(e.x),Ln(e.y)],c=lL[o],f=[];let h=e.extent;lt(lL,o)||ye("Invalid regression method: "+o),h!=null&&o==="log"&&h[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),i.forEach(d=>{if(d.length<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const m=c(d,e.x,e.y,a);if(e.params){f.push(zt({keys:d.dims,coef:m.coef,rSquared:m.rSquared}));return}const g=h||Lf(d,e.x),y=b=>{const x={};for(let v=0;v<s.length;++v)x[s[v]]=d.dims[v];x[l[0]]=b[0],x[l[1]]=b[1],f.push(zt(x))};o==="linear"?g.forEach(b=>y([b,m.predict(b)])):JD(m.predict,g,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const F1t=Object.freeze(Object.defineProperty({__proto__:null,loess:D9,regression:I9},Symbol.toStringTag,{value:"Module"})),pK=Math.pow(2,-52),s_=new Uint32Array(512);class TE{static from(t,n=P1t,r=L1t){const i=t.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=r(a)}return new TE(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=t.length>>1;let a=1/0,u=1/0,l=-1/0,c=-1/0;for(let k=0;k<o;k++){const E=t[2*k],F=t[2*k+1];E<a&&(a=E),F<u&&(u=F),E>l&&(l=E),F>c&&(c=F),this._ids[k]=k}const f=(a+l)/2,h=(u+c)/2;let d=1/0,p,m,g;for(let k=0;k<o;k++){const E=T3(f,h,t[2*k],t[2*k+1]);E<d&&(p=k,d=E)}const y=t[2*p],b=t[2*p+1];d=1/0;for(let k=0;k<o;k++){if(k===p)continue;const E=T3(y,b,t[2*k],t[2*k+1]);E<d&&E>0&&(m=k,d=E)}let x=t[2*m],v=t[2*m+1],w=1/0;for(let k=0;k<o;k++){if(k===p||k===m)continue;const E=M1t(y,b,x,v,t[2*k],t[2*k+1]);E<w&&(g=k,w=E)}let C=t[2*g],S=t[2*g+1];if(w===1/0){for(let F=0;F<o;F++)this._dists[F]=t[2*F]-t[0]||t[2*F+1]-t[1];pm(this._ids,this._dists,0,o-1);const k=new Uint32Array(o);let E=0;for(let F=0,T=-1/0;F<o;F++){const I=this._ids[F];this._dists[I]>T&&(k[E++]=I,T=this._dists[I])}this.hull=k.subarray(0,E),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(o_(y,b,x,v,C,S)){const k=m,E=x,F=v;m=g,x=C,v=S,g=k,C=E,S=F}const _=R1t(y,b,x,v,C,S);this._cx=_.x,this._cy=_.y;for(let k=0;k<o;k++)this._dists[k]=T3(t[2*k],t[2*k+1],_.x,_.y);pm(this._ids,this._dists,0,o-1),this._hullStart=p;let $=3;r[p]=n[g]=m,r[m]=n[p]=g,r[g]=n[m]=p,i[p]=0,i[m]=1,i[g]=2,s.fill(-1),s[this._hashKey(y,b)]=p,s[this._hashKey(x,v)]=m,s[this._hashKey(C,S)]=g,this.trianglesLen=0,this._addTriangle(p,m,g,-1,-1,-1);for(let k=0,E,F;k<this._ids.length;k++){const T=this._ids[k],I=t[2*T],D=t[2*T+1];if(k>0&&Math.abs(I-E)<=pK&&Math.abs(D-F)<=pK||(E=I,F=D,T===p||T===m||T===g))continue;let N=0;for(let P=0,j=this._hashKey(I,D);P<this._hashSize&&(N=s[(j+P)%this._hashSize],!(N!==-1&&N!==r[N]));P++);N=n[N];let V=N,U;for(;U=r[V],!o_(I,D,t[2*V],t[2*V+1],t[2*U],t[2*U+1]);)if(V=U,V===N){V=-1;break}if(V===-1)continue;let A=this._addTriangle(V,T,r[V],-1,-1,i[V]);i[T]=this._legalize(A+2),i[V]=A,$++;let M=r[V];for(;U=r[M],o_(I,D,t[2*M],t[2*M+1],t[2*U],t[2*U+1]);)A=this._addTriangle(M,T,U,i[T],-1,i[M]),i[T]=this._legalize(A+2),r[M]=M,$--,M=U;if(V===N)for(;U=n[V],o_(I,D,t[2*U],t[2*U+1],t[2*V],t[2*V+1]);)A=this._addTriangle(U,T,V,-1,i[V],i[U]),this._legalize(A+2),i[U]=A,r[V]=V,$--,V=U;this._hullStart=n[T]=V,r[V]=n[M]=T,r[T]=M,s[this._hashKey(I,D)]=T,s[this._hashKey(t[2*V],t[2*V+1])]=V}this.hull=new Uint32Array($);for(let k=0,E=this._hullStart;k<$;k++)this.hull[k]=E,E=r[E];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(O1t(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[t],u=t-t%3;if(o=u+(t+2)%3,a===-1){if(s===0)break;t=s_[--s];continue}const l=a-a%3,c=u+(t+1)%3,f=l+(a+2)%3,h=n[o],d=n[t],p=n[c],m=n[f];if(N1t(i[2*h],i[2*h+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1],i[2*m],i[2*m+1])){n[t]=m,n[a]=h;const y=r[f];if(y===-1){let x=this._hullStart;do{if(this._hullTri[x]===f){this._hullTri[x]=t;break}x=this._hullPrev[x]}while(x!==this._hullStart)}this._link(t,y),this._link(a,r[o]),this._link(o,f);const b=l+(a+1)%3;s<s_.length&&(s_[s++]=b)}else{if(s===0)break;t=s_[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function O1t(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function T3(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function D3(e,t,n,r,i,s){const o=(r-t)*(i-e),a=(n-e)*(s-t);return Math.abs(o-a)>=33306690738754716e-32*Math.abs(o+a)?o-a:0}function o_(e,t,n,r,i,s){return(D3(i,s,e,t,n,r)||D3(e,t,n,r,i,s)||D3(n,r,i,s,e,t))<0}function N1t(e,t,n,r,i,s,o,a){const u=e-o,l=t-a,c=n-o,f=r-a,h=i-o,d=s-a,p=u*u+l*l,m=c*c+f*f,g=h*h+d*d;return u*(f*g-m*d)-l*(c*g-m*h)+p*(c*d-f*h)<0}function M1t(e,t,n,r,i,s){const o=n-e,a=r-t,u=i-e,l=s-t,c=o*o+a*a,f=u*u+l*l,h=.5/(o*l-a*u),d=(l*c-a*f)*h,p=(o*f-u*c)*h;return d*d+p*p}function R1t(e,t,n,r,i,s){const o=n-e,a=r-t,u=i-e,l=s-t,c=o*o+a*a,f=u*u+l*l,h=.5/(o*l-a*u),d=e+(l*c-a*f)*h,p=t+(o*f-u*c)*h;return{x:d,y:p}}function pm(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],o=t[s];let a=i-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const i=n+r>>1;let s=n+1,o=r;rb(e,i,s),t[e[n]]>t[e[r]]&&rb(e,n,r),t[e[s]]>t[e[r]]&&rb(e,s,r),t[e[n]]>t[e[s]]&&rb(e,n,s);const a=e[s],u=t[a];for(;;){do s++;while(t[e[s]]<u);do o--;while(t[e[o]]>u);if(o<s)break;rb(e,s,o)}e[n+1]=e[o],e[o]=a,r-s+1>=o-n?(pm(e,t,s,r),pm(e,t,n,o-1)):(pm(e,t,n,o-1),pm(e,t,s,r))}}function rb(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function P1t(e){return e[0]}function L1t(e){return e[1]}const gK=1e-6;class Ld{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){t=+t,n=+n,r=+r;const i=t+r,s=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>gK||Math.abs(this._y1-s)>gK)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class cL{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}let B1t=class{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this,s=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let d=0,p=0,m=r.length,g,y;d<m;d+=3,p+=2){const b=r[d]*2,x=r[d+1]*2,v=r[d+2]*2,w=t[b],C=t[b+1],S=t[x],_=t[x+1],$=t[v],k=t[v+1],E=S-w,F=_-C,T=$-w,I=k-C,D=E*E+F*F,N=T*T+I*I,V=(E*I-F*T)*2;if(!V)g=(w+$)/2-1e8*I,y=(C+k)/2+1e8*T;else if(Math.abs(V)<1e-8)g=(w+$)/2,y=(C+k)/2;else{const U=1/V;g=w+(I*D-F*N)*U,y=C+(E*N-T*D)*U}s[p]=g,s[p+1]=y}let o=n[n.length-1],a,u=o*4,l,c=t[2*o],f,h=t[2*o+1];i.fill(0);for(let d=0;d<n.length;++d)o=n[d],a=u,l=c,f=h,u=o*4,c=t[2*o],h=t[2*o+1],i[a+2]=i[u]=f-h,i[a+3]=i[u+1]=c-l}render(t){const n=t==null?t=new Ld:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let c=0,f=r.length;c<f;++c){const h=r[c];if(h<c)continue;const d=Math.floor(c/3)*2,p=Math.floor(h/3)*2,m=o[d],g=o[d+1],y=o[p],b=o[p+1];this._renderSegment(m,g,y,b,t)}let u,l=s[s.length-1];for(let c=0;c<s.length;++c){u=l,l=s[c];const f=Math.floor(i[l]/3)*2,h=o[f],d=o[f+1],p=u*4,m=this._project(h,d,a[p+2],a[p+3]);m&&this._renderSegment(h,d,m[0],m[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Ld:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new Ld:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&n.lineTo(i[o],i[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new cL;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let o;const a=this._regioncode(t,n),u=this._regioncode(r,i);a===0&&u===0?(s.moveTo(t,n),s.lineTo(r,i)):(o=this._clipSegment(t,n,r,i,a,u))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){e:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,u=i.length;a<u;a+=2)if(n[s]==i[a]&&n[s+1]==i[a+1]&&n[(s+2)%o]==i[(a+u-2)%u]&&n[(s+3)%o]==i[(a+u-1)%u]){yield r;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[t];if(o===-1)return null;const a=[];let u=o;do{const l=Math.floor(u/3);if(a.push(n[l*2],n[l*2+1]),u=u%3===2?u-2:u+1,s[u]!==t)break;u=i[u]}while(u!==o&&u!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=t*4;return r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n)}_clipFinite(t,n){const r=n.length;let i=null,s,o,a=n[r-2],u=n[r-1],l,c=this._regioncode(a,u),f,h;for(let d=0;d<r;d+=2)if(s=a,o=u,a=n[d],u=n[d+1],l=c,c=this._regioncode(a,u),l===0&&c===0)f=h,h=0,i?i.push(a,u):i=[a,u];else{let p,m,g,y,b;if(l===0){if((p=this._clipSegment(s,o,a,u,l,c))===null)continue;[m,g,y,b]=p}else{if((p=this._clipSegment(a,u,s,o,c,l))===null)continue;[y,b,m,g]=p,f=h,h=this._edgecode(m,g),f&&h&&this._edge(t,f,h,i,i.length),i?i.push(m,g):i=[m,g]}f=h,h=this._edgecode(y,b),f&&h&&this._edge(t,f,h,i,i.length),i?i.push(y,b):i=[y,b]}if(i)f=h,h=this._edgecode(i[0],i[1]),f&&h&&this._edge(t,f,h,i,i.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(t,n,r,i,s,o){for(;;){if(s===0&&o===0)return[t,n,r,i];if(s&o)return null;let a,u,l=s||o;l&8?(a=t+(r-t)*(this.ymax-n)/(i-n),u=this.ymax):l&4?(a=t+(r-t)*(this.ymin-n)/(i-n),u=this.ymin):l&2?(u=n+(i-n)*(this.xmax-t)/(r-t),a=this.xmax):(u=n+(i-n)*(this.xmin-t)/(r-t),a=this.xmin),s?(t=a,n=u,s=this._regioncode(t,n)):(r=a,i=u,o=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,o){let a=Array.from(n),u;if((u=this._project(a[0],a[1],r,i))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(u[0],u[1]),a=this._clipFinite(t,a))for(let l=0,c=a.length,f,h=this._edgecode(a[c-2],a[c-1]);l<c;l+=2)f=h,h=this._edgecode(a[l],a[l+1]),f&&h&&(l=this._edge(t,f,h,a,l),c=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,r,i,s){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(t,o,a)&&(i.splice(s,0,o,a),s+=2)}if(i.length>4)for(let o=0;o<i.length;o+=2){const a=(o+2)%i.length,u=(o+4)%i.length;(i[o]===i[a]&&i[a]===i[u]||i[o+1]===i[a+1]&&i[a+1]===i[u+1])&&(i.splice(a,2),o-=2)}return s}_project(t,n,r,i){let s=1/0,o,a,u;if(i<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/i)<s&&(u=this.ymin,a=t+(s=o)*r)}else if(i>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/i)<s&&(u=this.ymax,a=t+(s=o)*r)}if(r>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/r)<s&&(a=this.xmax,u=n+(s=o)*i)}else if(r<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/r)<s&&(a=this.xmin,u=n+(s=o)*i)}return[a,u]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}};const z1t=2*Math.PI,em=Math.pow;function j1t(e){return e[0]}function U1t(e){return e[1]}function W1t(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const i=2*t[r],s=2*t[r+1],o=2*t[r+2];if((n[o]-n[i])*(n[s+1]-n[i+1])-(n[s]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}function V1t(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class F9{static from(t,n=j1t,r=U1t,i){return new F9("length"in t?G1t(t,n,r,i):Float64Array.from(H1t(t,n,r,i)))}constructor(t){this._delaunator=new TE(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&W1t(t)){this.collinear=Int32Array.from({length:n.length/2},(h,d)=>d).sort((h,d)=>n[2*h]-n[2*d]||n[2*h+1]-n[2*d+1]);const u=this.collinear[0],l=this.collinear[this.collinear.length-1],c=[n[2*u],n[2*u+1],n[2*l],n[2*l+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let h=0,d=n.length/2;h<d;++h){const p=V1t(n[2*h],n[2*h+1],f);n[2*h]=p[0],n[2*h+1]=p[1]}this._delaunator=new TE(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,l=r.length;u<l;++u){const c=s[u%3===2?u-2:u+1];(r[u]===-1||o[c]===-1)&&(o[c]=u)}for(let u=0,l=i.length;u<l;++u)a[i[u]]=u;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],o[i[0]]=1,i.length===2&&(o[i[1]]=0))}voronoi(t){return new B1t(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const f=a.indexOf(t);f>0&&(yield a[f-1]),f<a.length-1&&(yield a[f+1]);return}const u=n[t];if(u===-1)return;let l=u,c=-1;do{if(yield c=o[l],l=l%3===2?l-2:l+1,o[l]!==t)return;if(l=s[l],l===-1){const f=r[(i[t]+1)%r.length];f!==c&&(yield f);return}}while(l!==u)}find(t,n,r=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:u,points:l}=this;if(i[t]===-1||!l.length)return(t+1)%(l.length>>1);let c=t,f=em(n-l[t*2],2)+em(r-l[t*2+1],2);const h=i[t];let d=h;do{let p=u[d];const m=em(n-l[p*2],2)+em(r-l[p*2+1],2);if(m<f&&(f=m,c=p),d=d%3===2?d-2:d+1,u[d]!==t)break;if(d=a[d],d===-1){if(d=s[(o[t]+1)%s.length],d!==p&&em(n-l[d*2],2)+em(r-l[d*2+1],2)<f)return d;break}}while(d!==h);return c}render(t){const n=t==null?t=new Ld:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const u=i[o];if(u<o)continue;const l=s[o]*2,c=s[u]*2;t.moveTo(r[l],r[l+1]),t.lineTo(r[c],r[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const r=t==null?t=new Ld:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],u=i[s+1];t.moveTo(a+n,u),t.arc(a,u,n,0,z1t)}return r&&r.value()}renderHull(t){const n=t==null?t=new Ld:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;t.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const u=2*r[a];t.lineTo(i[u],i[u+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new cL;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new Ld:void 0,{points:i,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,u=s[t+2]*2;return n.moveTo(i[o],i[o+1]),n.lineTo(i[a],i[a+1]),n.lineTo(i[u],i[u+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new cL;return this.renderTriangle(t,n),n.value()}}function G1t(e,t,n,r){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=e[o];s[o*2]=t.call(r,a,o,e),s[o*2+1]=n.call(r,a,o,e)}return s}function*H1t(e,t,n,r){let i=0;for(const s of e)yield t.call(r,s,i,e),yield n.call(r,s,i,e),++i}function O9(e){he.call(this,null,e)}O9.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const q1t=[-1e5,-1e5,1e5,1e5];$e(O9,he,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:q1t;const s=this.value=F9.from(r,e.x,e.y).voronoi(i);for(let o=0,a=r.length;o<a;++o){const u=s.cellPolygon(o);r[o][n]=u?X1t(u):null}return t.reflow(e.modified()).modifies(n)}});function X1t(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}const Y1t=Object.freeze(Object.defineProperty({__proto__:null,voronoi:O9},Symbol.toStringTag,{value:"Module"}));function ly(e,t,n){return e.fields=t||[],e.fname=n,e}function K1t(e){return e.length===1?Z1t(e[0]):J1t(e)}const Z1t=e=>function(t){return t[e]},J1t=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function e$(e){throw Error(e)}function Q1t(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||e$("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&e$("Access path missing closing bracket: "+e),r&&e$("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function eyt(e,t,n){const r=Q1t(e);return e=r.length===1?r[0]:e,ly((n&&n.get||K1t)(r),[e],t||e)}eyt("id");ly(e=>e,[],"identity");ly(()=>0,[],"zero");ly(()=>1,[],"one");ly(()=>!0,[],"true");ly(()=>!1,[],"false");var tyt=Array.isArray;function nyt(e){return e[e.length-1]}function ryt(e){return e==null||e===""?null:+e}function iyt(e){return e!=null?tyt(e)?e:[e]:[]}function fL(e){return typeof e=="function"}function syt(e){return fL(e)?e:()=>e}function oyt(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function ayt(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}function uyt(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),oyt(r,n)}function lyt(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function cv(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function cyt(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function N9(e){let t,n,r;e.length!==2?(t=cv,n=(a,u)=>cv(e(a),u),r=(a,u)=>e(a)-u):(t=e===cv||e===cyt?e:fyt,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function fyt(){return 0}function Lme(e){return e===null?NaN:+e}const hyt=N9(cv),hL=hyt.right;N9(Lme).center;const $C=hL,dyt=Math.sqrt(50),pyt=Math.sqrt(10),gyt=Math.sqrt(2);function DE(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=dyt?10:s>=pyt?5:s>=gyt?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?DE(e,t,n*2):[a,u,l]}function dL(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const r=t<e,[i,s,o]=r?DE(t,e,n):DE(e,t,n);if(!(s>=i))return[];const a=s-i+1,u=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)u[l]=(s-l)/-o;else for(let l=0;l<a;++l)u[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)u[l]=(i+l)/-o;else for(let l=0;l<a;++l)u[l]=(i+l)*o;return u}function pL(e,t,n){return t=+t,e=+e,n=+n,DE(e,t,n)[2]}function gL(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?pL(t,e,n):pL(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function myt(e,t,n=Lme){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function yyt(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function tl(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Fh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const mK=Symbol("implicit");function M9(){var e=new ek,t=[],n=[],r=mK;function i(s){let o=e.get(s);if(o===void 0){if(r!==mK)return r;e.set(s,o=t.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new ek;for(const o of s)e.has(o)||e.set(o,t.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return M9(t,n).unknown(r)},tl.apply(i,arguments),i}function Bme(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function zme(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return Bme((n-r/t)*t,o,i,s,a)}}function jme(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return Bme((n-r/t)*t,i,s,o,a)}}const iF=e=>()=>e;function Ume(e,t){return function(n){return e+n*t}}function byt(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function sF(e,t){var n=t-e;return n?Ume(e,n>180||n<-180?n-360*Math.round(n/360):n):iF(isNaN(e)?t:e)}function vyt(e){return(e=+e)==1?kr:function(t,n){return n-t?byt(t,n,e):iF(isNaN(t)?n:t)}}function kr(e,t){var n=t-e;return n?Ume(e,n):iF(isNaN(e)?t:e)}const mL=function e(t){var n=vyt(t);function r(i,s){var o=n((i=As(i)).r,(s=As(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=kr(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function Wme(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=As(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var xyt=Wme(zme),wyt=Wme(jme);function R9(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function Vme(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Cyt(e,t){return(Vme(t)?R9:Gme)(e,t)}function Gme(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Cg(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function Hme(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function fa(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function qme(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Cg(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var yL=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,I3=new RegExp(yL.source,"g");function Syt(e){return function(){return e}}function _yt(e){return function(t){return e(t)+""}}function Xme(e,t){var n=yL.lastIndex=I3.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=yL.exec(e))&&(i=I3.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:fa(r,i)})),n=I3.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?_yt(u[0].x):Syt(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Cg(e,t){var n=typeof t,r;return t==null||n==="boolean"?iF(t):(n==="number"?fa:n==="string"?(r=ic(t))?(t=r,mL):Xme:t instanceof ic?mL:t instanceof Date?Hme:Vme(t)?R9:Array.isArray(t)?Gme:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?qme:fa)(e,t)}function $yt(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function kyt(e,t){var n=sF(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function oF(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var yK=180/Math.PI,bL={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Yme(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*yK,skewX:Math.atan(u)*yK,scaleX:o,scaleY:a}}var a_;function Eyt(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?bL:Yme(t.a,t.b,t.c,t.d,t.e,t.f)}function Ayt(e){return e==null||(a_||(a_=document.createElementNS("http://www.w3.org/2000/svg","g")),a_.setAttribute("transform",e),!(e=a_.transform.baseVal.consolidate()))?bL:(e=e.matrix,Yme(e.a,e.b,e.c,e.d,e.e,e.f))}function Kme(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var m=d.push("translate(",null,t,null,n);p.push({i:m-4,x:fa(l,f)},{i:m-2,x:fa(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:fa(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:fa(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var m=d.push(i(d)+"scale(",null,",",null,")");p.push({i:m-4,x:fa(l,f)},{i:m-2,x:fa(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,m=h.length,g;++p<m;)f[(g=h[p]).i]=g.x(d);return f.join("")}}}var Tyt=Kme(Eyt,"px, ","px)","deg)"),Dyt=Kme(Ayt,", ",")",")"),Iyt=1e-12;function bK(e){return((e=Math.exp(e))+1/e)/2}function Fyt(e){return((e=Math.exp(e))-1/e)/2}function Oyt(e){return((e=Math.exp(2*e))-1)/(e+1)}const Nyt=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,m=d*d+p*p,g,y;if(m<Iyt)y=Math.log(h/l)/t,g=function(S){return[a+S*d,u+S*p,l*Math.exp(t*S*y)]};else{var b=Math.sqrt(m),x=(h*h-l*l+r*m)/(2*l*n*b),v=(h*h-l*l-r*m)/(2*h*n*b),w=Math.log(Math.sqrt(x*x+1)-x),C=Math.log(Math.sqrt(v*v+1)-v);y=(C-w)/t,g=function(S){var _=S*y,$=bK(w),k=l/(n*b)*($*Oyt(t*_+w)-Fyt(w));return[a+k*d,u+k*p,l*$/bK(t*_+w)]}}return g.duration=y*1e3*t/Math.SQRT2,g}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function Zme(e){return function(t,n){var r=e((t=qf(t)).h,(n=qf(n)).h),i=kr(t.s,n.s),s=kr(t.l,n.l),o=kr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const Myt=Zme(sF);var Ryt=Zme(kr);function Pyt(e,t){var n=kr((e=Xf(e)).l,(t=Xf(t)).l),r=kr(e.a,t.a),i=kr(e.b,t.b),s=kr(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function Jme(e){return function(t,n){var r=e((t=Yf(t)).h,(n=Yf(n)).h),i=kr(t.c,n.c),s=kr(t.l,n.l),o=kr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const Lyt=Jme(sF);var Byt=Jme(kr);function Qme(e){return function t(n){n=+n;function r(i,s){var o=e((i=Cp(i)).h,(s=Cp(s)).h),a=kr(i.s,s.s),u=kr(i.l,s.l),l=kr(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const zyt=Qme(sF);var jyt=Qme(kr);function P9(e,t){t===void 0&&(t=e,e=Cg);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function Uyt(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const Wyt=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Cg,interpolateArray:Cyt,interpolateBasis:zme,interpolateBasisClosed:jme,interpolateCubehelix:zyt,interpolateCubehelixLong:jyt,interpolateDate:Hme,interpolateDiscrete:$yt,interpolateHcl:Lyt,interpolateHclLong:Byt,interpolateHsl:Myt,interpolateHslLong:Ryt,interpolateHue:kyt,interpolateLab:Pyt,interpolateNumber:fa,interpolateNumberArray:R9,interpolateObject:qme,interpolateRgb:mL,interpolateRgbBasis:xyt,interpolateRgbBasisClosed:wyt,interpolateRound:oF,interpolateString:Xme,interpolateTransformCss:Tyt,interpolateTransformSvg:Dyt,interpolateZoom:Nyt,piecewise:P9,quantize:Uyt},Symbol.toStringTag,{value:"Module"}));function Vyt(e){return function(){return e}}function vL(e){return+e}var vK=[0,1];function xs(e){return e}function xL(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Vyt(isNaN(t)?NaN:.5)}function Gyt(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function Hyt(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=xL(i,r),s=n(o,s)):(r=xL(r,i),s=n(s,o)),function(a){return s(r(a))}}function qyt(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=xL(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=$C(e,a,1,r)-1;return s[u](i[u](a))}}function kC(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function aF(){var e=vK,t=vK,n=Cg,r,i,s,o=xs,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==xs&&(o=Gyt(e[0],e[h-1])),a=h>2?qyt:Hyt,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),fa)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,vL),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=oF,c()},f.clamp=function(h){return arguments.length?(o=h?!0:xs,c()):o!==xs},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function e0e(){return aF()(xs,xs)}function t0e(e,t,n,r){var i=gL(e,t,n),s;switch(r=kp(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=U8(i,o))&&(r.precision=s),OI(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=W8(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=j8(i))&&(r.precision=s-(r.type==="%")*2);break}}return sy(r)}function Sg(e){var t=e.domain;return e.ticks=function(n){var r=t();return dL(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return t0e(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=pL(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function n0e(){var e=e0e();return e.copy=function(){return kC(e,n0e())},tl.apply(e,arguments),Sg(e)}function r0e(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,vL),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return r0e(e).unknown(t)},e=arguments.length?Array.from(e,vL):[0,1],Sg(n)}function i0e(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function xK(e){return Math.log(e)}function wK(e){return Math.exp(e)}function Xyt(e){return-Math.log(-e)}function Yyt(e){return-Math.exp(-e)}function Kyt(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Zyt(e){return e===10?Kyt:e===Math.E?Math.exp:t=>Math.pow(e,t)}function Jyt(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function CK(e){return(t,n)=>-e(-t,n)}function L9(e){const t=e(xK,wK),n=t.domain;let r=10,i,s;function o(){return i=Jyt(r),s=Zyt(r),n()[0]<0?(i=CK(i),s=CK(s),e(Xyt,Yyt)):e(xK,wK),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=a=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let h=i(l),d=i(c),p,m;const g=a==null?10:+a;let y=[];if(!(r%1)&&d-h<g){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(p=1;p<r;++p)if(m=h<0?p/s(-h):p*s(h),!(m<l)){if(m>c)break;y.push(m)}}else for(;h<=d;++h)for(p=r-1;p>=1;--p)if(m=h>0?p/s(-h):p*s(h),!(m<l)){if(m>c)break;y.push(m)}y.length*2<g&&(y=dL(l,c,g))}else y=dL(h,d,Math.min(d-h,g)).map(s);return f?y.reverse():y},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=r===10?"s":","),typeof u!="function"&&(!(r%1)&&(u=kp(u)).precision==null&&(u.trim=!0),u=sy(u)),a===1/0)return u;const l=Math.max(1,r*a/t.ticks().length);return c=>{let f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=()=>n(i0e(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),t}function s0e(){const e=L9(aF()).domain([1,10]);return e.copy=()=>kC(e,s0e()).base(e.base()),tl.apply(e,arguments),e}function SK(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function _K(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function B9(e){var t=1,n=e(SK(t),_K(t));return n.constant=function(r){return arguments.length?e(SK(t=+r),_K(t)):t},Sg(n)}function o0e(){var e=B9(aF());return e.copy=function(){return kC(e,o0e()).constant(e.constant())},tl.apply(e,arguments)}function $K(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Qyt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ebt(e){return e<0?-e*e:e*e}function z9(e){var t=e(xs,xs),n=1;function r(){return n===1?e(xs,xs):n===.5?e(Qyt,ebt):e($K(n),$K(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},Sg(t)}function j9(){var e=z9(aF());return e.copy=function(){return kC(e,j9()).exponent(e.exponent())},tl.apply(e,arguments),e}function tbt(){return j9.apply(null,arguments).exponent(.5)}function a0e(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=myt(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[$C(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(cv),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return a0e().domain(e).range(t).unknown(r)},tl.apply(s,arguments)}function u0e(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[$C(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return u0e().domain([e,t]).range(i).unknown(s)},tl.apply(Sg(o),arguments)}function l0e(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[$C(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return l0e().domain(e).range(t).unknown(n)},tl.apply(i,arguments)}const F3=new Date,O3=new Date;function wr(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>wr(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>(F3.setTime(+s),O3.setTime(+o),e(F3),e(O3),Math.floor(n(F3,O3))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const w0=wr(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);w0.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?wr(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):w0);w0.range;const jl=1e3,$o=jl*60,Ul=$o*60,ac=Ul*24,U9=ac*7,kK=ac*30,N3=ac*365,Wl=wr(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*jl)},(e,t)=>(t-e)/jl,e=>e.getUTCSeconds());Wl.range;const uF=wr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jl)},(e,t)=>{e.setTime(+e+t*$o)},(e,t)=>(t-e)/$o,e=>e.getMinutes());uF.range;const lF=wr(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*$o)},(e,t)=>(t-e)/$o,e=>e.getUTCMinutes());lF.range;const cF=wr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jl-e.getMinutes()*$o)},(e,t)=>{e.setTime(+e+t*Ul)},(e,t)=>(t-e)/Ul,e=>e.getHours());cF.range;const fF=wr(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Ul)},(e,t)=>(t-e)/Ul,e=>e.getUTCHours());fF.range;const Em=wr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*$o)/ac,e=>e.getDate()-1);Em.range;const fv=wr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ac,e=>e.getUTCDate()-1);fv.range;const c0e=wr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ac,e=>Math.floor(e/ac));c0e.range;function _g(e){return wr(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*$o)/U9)}const hF=_g(0),nbt=_g(1),rbt=_g(2),ibt=_g(3),sbt=_g(4),obt=_g(5),abt=_g(6);hF.range;nbt.range;rbt.range;ibt.range;sbt.range;obt.range;abt.range;function $g(e){return wr(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/U9)}const dF=$g(0),ubt=$g(1),lbt=$g(2),cbt=$g(3),fbt=$g(4),hbt=$g(5),dbt=$g(6);dF.range;ubt.range;lbt.range;cbt.range;fbt.range;hbt.range;dbt.range;const Mx=wr(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());Mx.range;const Rx=wr(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Rx.range;const EC=wr(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());EC.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:wr(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});EC.range;const AC=wr(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());AC.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:wr(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});AC.range;function f0e(e,t,n,r,i,s){const o=[[Wl,1,jl],[Wl,5,5*jl],[Wl,15,15*jl],[Wl,30,30*jl],[s,1,$o],[s,5,5*$o],[s,15,15*$o],[s,30,30*$o],[i,1,Ul],[i,3,3*Ul],[i,6,6*Ul],[i,12,12*Ul],[r,1,ac],[r,2,2*ac],[n,1,U9],[t,1,kK],[t,3,3*kK],[e,1,N3]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=N9(([,,g])=>g).right(o,h);if(d===o.length)return e.every(gL(l/N3,c/N3,f));if(d===0)return w0.every(Math.max(gL(l,c,f),1));const[p,m]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(m)}return[a,u]}const[pbt,gbt]=f0e(AC,Rx,dF,c0e,fF,lF),[mbt,ybt]=f0e(EC,Mx,hF,Em,cF,uF);function bbt(e){return new Date(e)}function vbt(e){return e instanceof Date?+e:+new Date(+e)}function W9(e,t,n,r,i,s,o,a,u,l){var c=e0e(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),m=l("%I:%M"),g=l("%I %p"),y=l("%a %d"),b=l("%b %d"),x=l("%B"),v=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?m:s(C)<C?g:r(C)<C?i(C)<C?y:b:n(C)<C?x:v)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,vbt)):h().map(bbt)},c.ticks=function(C){var S=h();return e(S[0],S[S.length-1],C??10)},c.tickFormat=function(C,S){return S==null?w:l(S)},c.nice=function(C){var S=h();return(!C||typeof C.range!="function")&&(C=t(S[0],S[S.length-1],C??10)),C?h(i0e(S,C)):c},c.copy=function(){return kC(c,W9(e,t,n,r,i,s,o,a,u,l))},c}function xbt(){return tl.apply(W9(mbt,ybt,EC,Mx,hF,Em,cF,uF,Wl,NI).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function wbt(){return tl.apply(W9(pbt,gbt,AC,Rx,dF,fv,fF,lF,Wl,MI).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function pF(){var e=0,t=1,n,r,i,s,o=xs,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(Cg),l.rangeRound=c(oF),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Oh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function V9(){var e=Sg(pF()(xs));return e.copy=function(){return Oh(e,V9())},Fh.apply(e,arguments)}function h0e(){var e=L9(pF()).domain([1,10]);return e.copy=function(){return Oh(e,h0e()).base(e.base())},Fh.apply(e,arguments)}function d0e(){var e=B9(pF());return e.copy=function(){return Oh(e,d0e()).constant(e.constant())},Fh.apply(e,arguments)}function G9(){var e=z9(pF());return e.copy=function(){return Oh(e,G9()).exponent(e.exponent())},Fh.apply(e,arguments)}function Cbt(){return G9.apply(null,arguments).exponent(.5)}function gF(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=xs,c,f=!1,h;function d(m){return isNaN(m=+m)?h:(m=.5+((m=+c(m))-s)*(r*m<r*s?a:u),l(f?Math.max(0,Math.min(1,m)):m))}d.domain=function(m){return arguments.length?([e,t,n]=m,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(m){return arguments.length?(f=!!m,d):f},d.interpolator=function(m){return arguments.length?(l=m,d):l};function p(m){return function(g){var y,b,x;return arguments.length?([y,b,x]=g,l=P9(m,[y,b,x]),d):[l(0),l(.5),l(1)]}}return d.range=p(Cg),d.rangeRound=p(oF),d.unknown=function(m){return arguments.length?(h=m,d):h},function(m){return c=m,i=m(e),s=m(t),o=m(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function p0e(){var e=Sg(gF()(xs));return e.copy=function(){return Oh(e,p0e())},Fh.apply(e,arguments)}function g0e(){var e=L9(gF()).domain([.1,1,10]);return e.copy=function(){return Oh(e,g0e()).base(e.base())},Fh.apply(e,arguments)}function m0e(){var e=B9(gF());return e.copy=function(){return Oh(e,m0e()).constant(e.constant())},Fh.apply(e,arguments)}function H9(){var e=z9(gF());return e.copy=function(){return Oh(e,H9()).exponent(e.exponent())},Fh.apply(e,arguments)}function Sbt(){return H9.apply(null,arguments).exponent(.5)}const q9="year",X9="quarter",Y9="month",K9="week",Z9="date",J9="day",Q9="dayofyear",ej="hours",tj="minutes",nj="seconds",rj="milliseconds",_bt=[q9,X9,Y9,K9,Z9,J9,Q9,ej,tj,nj,rj];_bt.reduce((e,t,n)=>(e[t]=1+n,e),{});q9+"",X9+"",Mx.every(3),Y9+"",K9+"",Z9+"",J9+"",Q9+"",ej+"",tj+"",nj+"",rj+"";q9+"",X9+"",Rx.every(3),Y9+"",K9+"",Z9+"",J9+"",Q9+"",ej+"",tj+"",nj+"",rj+"";function $bt(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const kbt="identity",ij="linear",C0="log",sj="pow",oj="sqrt",aj="symlog",Ebt="time",Abt="utc",cy="sequential",TC="diverging",EK="quantile",Tbt="quantize",Dbt="threshold",Ibt="ordinal",Fbt="point",Obt="band",Nbt="bin-ordinal",Wr="continuous",mF="discrete",yF="discretizing",La="interpolating",y0e="temporal";function Mbt(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function Rbt(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function uj(){const e=M9().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=$bt(f,a,u);let m=r[h-0];i=(d-m)/(p||1),o&&(i=Math.floor(i)),m+=(d-m-i*(f-a))*l,s=i*(1-a),o&&(m=Math.round(m),s=Math.round(s));const g=yyt(f).map(y=>m+i*y);return n(h?g.reverse():g)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let m=+f[0],g=+f[1],y,b,x;if(!(m!==m||g!==g)&&(g<m&&(x=m,m=g,g=x),!(g<d[0]||m>r[1-h])))return y=Math.max(0,hL(d,m)-1),b=m===g?y:hL(d,g)-1,m-d[y]>s+1e-10&&++y,h&&(x=y,y=p-b,b=p-x),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return uj().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function b0e(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return b0e(t())},e}function Pbt(){return b0e(uj().paddingInner(1))}var Lbt=Array.prototype.map;function Bbt(e){return Lbt.call(e,ryt)}const zbt=Array.prototype.slice;function v0e(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[($C(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=Bbt(r),n):e.slice()},n.range=function(r){return arguments.length?(t=zbt.call(r),n):t.slice()},n.tickFormat=function(r,i){return t0e(e[0],nyt(e),r??10,i)},n.copy=function(){return v0e().domain(n.domain()).range(n.range())},n}const wL=new Map,jbt=Symbol("vega_scale");function Ubt(e){return e[jbt]=!0,e}function Wbt(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?Mbt(s):s.invertExtent?Rbt(s):void 0),s.type=e,Ubt(s)};return r.metadata=lyt(iyt(n)),r}function un(e,t,n){return arguments.length>1?(wL.set(e,Wbt(e,t,n)),this):Vbt(e)?wL.get(e):void 0}un(kbt,r0e);un(ij,n0e,Wr);un(C0,s0e,[Wr,C0]);un(sj,j9,Wr);un(oj,tbt,Wr);un(aj,o0e,Wr);un(Ebt,xbt,[Wr,y0e]);un(Abt,wbt,[Wr,y0e]);un(cy,V9,[Wr,La]);un(`${cy}-${ij}`,V9,[Wr,La]);un(`${cy}-${C0}`,h0e,[Wr,La,C0]);un(`${cy}-${sj}`,G9,[Wr,La]);un(`${cy}-${oj}`,Cbt,[Wr,La]);un(`${cy}-${aj}`,d0e,[Wr,La]);un(`${TC}-${ij}`,p0e,[Wr,La]);un(`${TC}-${C0}`,g0e,[Wr,La,C0]);un(`${TC}-${sj}`,H9,[Wr,La]);un(`${TC}-${oj}`,Sbt,[Wr,La]);un(`${TC}-${aj}`,m0e,[Wr,La]);un(EK,a0e,[yF,EK]);un(Tbt,u0e,yF);un(Dbt,l0e,yF);un(Nbt,v0e,[mF,yF]);un(Ibt,M9,mF);un(Obt,uj,mF);un(Fbt,Pbt,mF);function Vbt(e){return wL.has(e)}function Gbt(e,t,n){return P9(Hbt(t||"rgb",n),e)}function Hbt(e,t){const n=Wyt[qbt(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function qbt(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const Xbt={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},Ybt={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function x0e(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function w0e(e,t){for(const n in e)Kbt(n,t(e[n]))}const AK={};w0e(Ybt,x0e);w0e(Xbt,e=>Gbt(x0e(e)));function Kbt(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(AK[e]=t,this):AK[e]}var Zbt=Math.random,M3=Math.PI/180,Wb=64,t$=2048;function Jbt(){var e=[256,256],t,n,r,i,s,o,a,u=C0e,l=[],c=Math.random,f={};f.layout=function(){for(var p=h(bc()),m=ivt((e[0]>>5)*e[1]),g=null,y=l.length,b=-1,x=[],v=l.map(C=>({text:t(C),font:n(C),style:i(C),weight:s(C),rotate:o(C),size:~~(r(C)+1e-14),padding:a(C),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:C})).sort((C,S)=>S.size-C.size);++b<y;){var w=v[b];w.x=e[0]*(c()+.5)>>1,w.y=e[1]*(c()+.5)>>1,Qbt(p,w,v,b),w.hasText&&d(m,w,g)&&(x.push(w),g?tvt(g,w):g=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=e[0]>>1,w.y-=e[1]>>1)}return x};function h(p){p.width=p.height=1;var m=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(Wb<<5)/m,p.height=t$/m;var g=p.getContext("2d");return g.fillStyle=g.strokeStyle="red",g.textAlign="center",{context:g,ratio:m}}function d(p,m,g){for(var y=m.x,b=m.y,x=Math.sqrt(e[0]*e[0]+e[1]*e[1]),v=u(e),w=c()<.5?1:-1,C=-w,S,_,$;(S=v(C+=w))&&(_=~~S[0],$=~~S[1],!(Math.min(Math.abs(_),Math.abs($))>=x));)if(m.x=y+_,m.y=b+$,!(m.x+m.x0<0||m.y+m.y0<0||m.x+m.x1>e[0]||m.y+m.y1>e[1])&&(!g||!evt(m,p,e[0]))&&(!g||nvt(m,g))){for(var k=m.sprite,E=m.width>>5,F=e[0]>>5,T=m.x-(E<<4),I=T&127,D=32-I,N=m.y1-m.y0,V=(m.y+m.y0)*F+(T>>5),U,A=0;A<N;A++){U=0;for(var M=0;M<=E;M++)p[V+M]|=U<<D|(M<E?(U=k[A*E+M])>>>I:0);V+=F}return m.sprite=null,!0}return!1}return f.words=function(p){return arguments.length?(l=p,f):l},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=Zh(p),f):n},f.fontStyle=function(p){return arguments.length?(i=Zh(p),f):i},f.fontWeight=function(p){return arguments.length?(s=Zh(p),f):s},f.rotate=function(p){return arguments.length?(o=Zh(p),f):o},f.text=function(p){return arguments.length?(t=Zh(p),f):t},f.spiral=function(p){return arguments.length?(u=svt[p]||p,f):u},f.fontSize=function(p){return arguments.length?(r=Zh(p),f):r},f.padding=function(p){return arguments.length?(a=Zh(p),f):a},f.random=function(p){return arguments.length?(c=p,f):c},f}function Qbt(e,t,n,r){if(!t.sprite){var i=e.context,s=e.ratio;i.clearRect(0,0,(Wb<<5)/s,t$/s);var o=0,a=0,u=0,l=n.length,c,f,h,d,p;for(--r;++r<l;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,c=i.measureText(t.text+"m").width*s,h=t.size<<1,t.rotate){var m=Math.sin(t.rotate*M3),g=Math.cos(t.rotate*M3),y=c*g,b=c*m,x=h*g,v=h*m;c=Math.max(Math.abs(y+v),Math.abs(y-v))+31>>5<<5,h=~~Math.max(Math.abs(b+x),Math.abs(b-x))}else c=c+31>>5<<5;if(h>u&&(u=h),o+c>=Wb<<5&&(o=0,a+=u,u=0),a+h>=t$)break;i.translate((o+(c>>1))/s,(a+(h>>1))/s),t.rotate&&i.rotate(t.rotate*M3),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=c,t.height=h,t.xoff=o,t.yoff=a,t.x1=c>>1,t.y1=h>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var w=i.getImageData(0,0,(Wb<<5)/s,t$/s).data,C=[];--r>=0;)if(t=n[r],!!t.hasText){for(c=t.width,f=c>>5,h=t.y1-t.y0,d=0;d<h*f;d++)C[d]=0;if(o=t.xoff,o==null)return;a=t.yoff;var S=0,_=-1;for(p=0;p<h;p++){for(d=0;d<c;d++){var $=f*p+(d>>5),k=w[(a+p)*(Wb<<5)+(o+d)<<2]?1<<31-d%32:0;C[$]|=k,S|=k}S?_=p:(t.y0++,h--,p--,a++)}t.y1=t.y0+_,t.sprite=C.slice(0,(t.y1-t.y0)*f)}}}function evt(e,t,n){n>>=5;for(var r=e.sprite,i=e.width>>5,s=e.x-(i<<4),o=s&127,a=32-o,u=e.y1-e.y0,l=(e.y+e.y0)*n+(s>>5),c,f=0;f<u;f++){c=0;for(var h=0;h<=i;h++)if((c<<a|(h<i?(c=r[f*i+h])>>>o:0))&t[l+h])return!0;l+=n}return!1}function tvt(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function nvt(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function C0e(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function rvt(e){var t=4,n=t*e[0]/e[1],r=0,i=0;return function(s){var o=s<0?-1:1;switch(Math.sqrt(1+4*o*s)-o&3){case 0:r+=n;break;case 1:i+=t;break;case 2:r-=n;break;default:i-=t;break}return[r,i]}}function ivt(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function Zh(e){return typeof e=="function"?e:function(){return e}}var svt={archimedean:C0e,rectangular:rvt};const S0e=["x","y","font","fontSize","fontStyle","fontWeight","angle"],ovt=["text","font","rotate","fontSize","fontStyle","fontWeight"];function lj(e){he.call(this,Jbt(),e)}lj.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:S0e}]};uyt(lj,he,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&e$("Wordcloud size dimensions must be non-zero.");function n(p){const m=e[p];return fL(m)&&t.modified(m.fields)}const r=e.modified();if(!(r||t.changed(t.ADD_REM)||ovt.some(n)))return;const i=t.materialize(t.SOURCE).source,s=this.value,o=e.as||S0e;let a=e.fontSize||14,u;if(fL(a)?u=e.fontSizeRange:a=syt(a),u){const p=a,m=un("sqrt")().domain(ayt(i,p)).range(u);a=g=>m(p(g))}i.forEach(p=>{p[o[0]]=NaN,p[o[1]]=NaN,p[o[3]]=0});const l=s.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(a).random(Zbt).layout(),c=s.size(),f=c[0]>>1,h=c[1]>>1,d=l.length;for(let p=0,m,g;p<d;++p)m=l[p],g=m.datum,g[o[0]]=m.x+f,g[o[1]]=m.y+h,g[o[2]]=m.font,g[o[3]]=m.size,g[o[4]]=m.style,g[o[5]]=m.weight,g[o[6]]=m.rotate;return t.reflow(r).modifies(o)}});const avt=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:lj},Symbol.toStringTag,{value:"Module"})),uvt=e=>new Uint8Array(e),lvt=e=>new Uint16Array(e),hv=e=>new Uint32Array(e);function cvt(){let e=8,t=[],n=hv(0),r=u_(0,e),i=u_(0,e);return{data:()=>t,seen:()=>n=fvt(n,t.length),add(s){for(let o=0,a=t.length,u=s.length,l;o<u;++o)l=s[o],l._index=a++,t.push(l)},remove(s,o){const a=t.length,u=Array(a-s),l=t;let c,f,h;for(f=0;!o[f]&&f<a;++f)u[f]=t[f],l[f]=f;for(h=f;f<a;++f)c=t[f],o[f]?l[f]=-1:(l[f]=h,r[h]=r[f],i[h]=i[f],u[h]=c,c._index=h++),r[f]=0;return t=u,l},size:()=>t.length,curr:()=>r,prev:()=>i,reset:s=>i[s]=r[s],all:()=>e<257?255:e<65537?65535:4294967295,set(s,o){r[s]|=o},clear(s,o){r[s]&=~o},resize(s,o){const a=r.length;(s>a||o>e)&&(e=Math.max(o,e),r=u_(s,e,r),i=u_(s,e))}}}function fvt(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function u_(e,t,n){const r=(t<257?uvt:t<65537?lvt:hv)(e);return n&&r.set(n),r}function TK(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(i,s){const o=this,a=o.bisect(o.range,i.value),u=i.index,l=a[0],c=a[1],f=u.length;let h;for(h=0;h<l;++h)s[u[h]]|=r;for(h=c;h<f;++h)s[u[h]]|=r;return o}}}function DK(){let e=hv(0),t=[],n=0;function r(a,u,l){if(!u.length)return[];const c=n,f=u.length,h=hv(f);let d=Array(f),p,m,g;for(g=0;g<f;++g)d[g]=a(u[g]),h[g]=g;if(d=hvt(d,h),c)p=t,m=e,t=Array(c+f),e=hv(c+f),dvt(l,p,m,c,d,h,f,t,e);else{if(l>0)for(g=0;g<f;++g)h[g]+=l;t=d,e=h}return n=c+f,{index:h,value:d}}function i(a,u){const l=n;let c,f,h;for(f=0;!u[e[f]]&&f<l;++f);for(h=f;f<l;++f)u[c=e[f]]||(e[h]=c,t[h]=t[f],++h);n=l-a}function s(a){for(let u=0,l=n;u<l;++u)e[u]=a[e[u]]}function o(a,u){let l;return u?l=u.length:(u=t,l=n),[gJe(u,a[0],0,l),ok(u,a[1],0,l)]}return{insert:r,remove:i,bisect:o,reindex:s,index:()=>e,size:()=>n}}function hvt(e,t){return e.sort.call(t,(n,r)=>{const i=e[n],s=e[r];return i<s?-1:i>s?1:0}),bJe(e,t)}function dvt(e,t,n,r,i,s,o,a,u){let l=0,c=0,f;for(f=0;l<r&&c<o;++f)t[l]<i[c]?(a[f]=t[l],u[f]=n[l++]):(a[f]=i[c],u[f]=s[c++]+e);for(;l<r;++l,++f)a[f]=t[l],u[f]=n[l];for(;c<o;++c,++f)a[f]=i[c],u[f]=s[c]+e}function cj(e){he.call(this,cvt(),e),this._indices=null,this._dims=null}cj.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};$e(cj,he,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(r=>t.modified(r.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},s=this._dims=[],o=r.length;let a=0,u,l;for(;a<o;++a)u=n[a].fname,l=i[u]||(i[u]=DK()),s.push(TK(l,a,r[a]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,s=this._indices,o=this._dims,a=this.value,u=a.curr(),l=a.prev(),c=a.all(),f=n.rem=n.add,h=n.mod,d=i.length,p={};let m,g,y,b,x,v,w,C,S;if(l.set(u),t.rem.length&&(x=this.remove(e,t,n)),t.add.length&&a.add(t.add),t.mod.length)for(v={},b=t.mod,w=0,C=b.length;w<C;++w)v[b[w]._index]=1;for(w=0;w<d;++w)S=r[w],(!o[w]||e.modified("fields",w)||t.modified(S.fields))&&(y=S.fname,(m=p[y])||(s[y]=g=DK(),p[y]=m=g.insert(S,t.source,0)),o[w]=TK(g,w,i[w]).onAdd(m,u));for(w=0,C=a.data().length;w<C;++w)x[w]||(l[w]!==u[w]?f.push(w):v[w]&&u[w]!==c&&h.push(w));return a.mask=(1<<d)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,s=this._dims,o=this._indices,a=e.fields,u={},l=n.add,c=i.size()+r.length,f=s.length;let h=i.size(),d,p,m;i.resize(c,f),i.add(r);const g=i.curr(),y=i.prev(),b=i.all();for(d=0;d<f;++d)p=a[d].fname,m=u[p]||(u[p]=o[p].insert(a[d],r,h)),s[d].onAdd(m,g);for(;h<c;++h)y[h]=b,g[h]!==b&&l.push(h)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),s=r.all(),o=e.mod;let a,u,l;for(a=0,u=o.length;a<u;++a)l=o[a]._index,i[l]!==s&&n.push(l)},remove(e,t,n){const r=this._indices,i=this.value,s=i.curr(),o=i.prev(),a=i.all(),u={},l=n.rem,c=t.rem;let f,h,d,p;for(f=0,h=c.length;f<h;++f)d=c[f]._index,u[d]=1,o[d]=p=s[d],s[d]=a,p!==a&&l.push(d);for(d in r)r[d].remove(h,u);return this.reindex(t,h,u),u},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const s=i.remove(t,n);for(const o in r)r[o].reindex(s)})},update(e,t,n){const r=this._dims,i=e.query,s=t.stamp,o=r.length;let a=0,u,l;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(u=l,++a);if(a===1)a=r[u].one,this.incrementOne(r[u],i[u],n.add,n.rem);else for(l=0,a=0;l<o;++l)e.modified("query",l)&&(a|=r[l].one,this.incrementAll(r[l],i[l],s,n.add),n.rem=n.add);return a},incrementAll(e,t,n,r){const i=this.value,s=i.seen(),o=i.curr(),a=i.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],h=c[1],d=l[0],p=l[1],m=e.one;let g,y,b;if(f<d)for(g=f,y=Math.min(d,h);g<y;++g)b=u[g],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=m;else if(f>d)for(g=d,y=Math.min(f,p);g<y;++g)b=u[g],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=m;if(h>p)for(g=Math.max(f,p),y=h;g<y;++g)b=u[g],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=m;else if(h<p)for(g=Math.max(d,h),y=p;g<y;++g)b=u[g],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value,s=i.curr(),o=e.index(),a=e.bisect(e.range),u=e.bisect(t),l=u[0],c=u[1],f=a[0],h=a[1],d=e.one;let p,m,g;if(l<f)for(p=l,m=Math.min(f,c);p<m;++p)g=o[p],s[g]^=d,n.push(g);else if(l>f)for(p=f,m=Math.min(l,h);p<m;++p)g=o[p],s[g]^=d,r.push(g);if(c>h)for(p=Math.max(l,h),m=c;p<m;++p)g=o[p],s[g]^=d,n.push(g);else if(c<h)for(p=Math.max(f,c),m=h;p<m;++p)g=o[p],s[g]^=d,r.push(g);e.range=t.slice()}});function fj(e){he.call(this,null,e)}fj.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};$e(fj,he,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(!(i&n))return t.StopPropagation;const s=t.fork(t.ALL),o=r.data(),a=r.curr(),u=r.prev(),l=c=>a[c]&n?null:o[c];return s.filter(s.MOD,l),i&i-1?(s.filter(s.ADD,c=>{const f=a[c]&n;return!f&&f^u[c]&n?o[c]:null}),s.filter(s.REM,c=>{const f=a[c]&n;return f&&!(f^(f^u[c]&n))?o[c]:null})):(s.filter(s.ADD,l),s.filter(s.REM,c=>(a[c]&n)===i?o[c]:null)),s.filter(s.SOURCE,c=>l(c._index))}});const pvt=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:cj,resolvefilter:fj},Symbol.toStringTag,{value:"Module"}));function fy(e,t,n){return e.fields=t||[],e.fname=n,e}function gvt(e){return e.length===1?mvt(e[0]):yvt(e)}const mvt=e=>function(t){return t[e]},yvt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function gi(e){throw Error(e)}function bvt(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||gi("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&gi("Access path missing closing bracket: "+e),r&&gi("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function _0e(e,t,n){const r=bvt(e);return e=r.length===1?r[0]:e,fy((n&&n.get||gvt)(r),[e],t||e)}_0e("id");const hj=fy(e=>e,[],"identity");fy(()=>0,[],"zero");fy(()=>1,[],"one");const $0e=fy(()=>!0,[],"true");fy(()=>!1,[],"false");var uc=Array.isArray;function IE(e){return e===Object(e)}function sh(e){return e[e.length-1]}function dj(e){return e==null||e===""?null:+e}const k0e=e=>t=>e*Math.exp(t),E0e=e=>t=>Math.log(e*t),A0e=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),T0e=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,FE=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function bF(e,t,n,r){const i=n(e[0]),s=n(sh(e)),o=(s-i)*t;return[r(i-o),r(s-o)]}function vvt(e,t){return bF(e,t,dj,hj)}function xvt(e,t){var n=Math.sign(e[0]);return bF(e,t,E0e(n),k0e(n))}function wvt(e,t,n){return bF(e,t,FE(n),FE(1/n))}function Cvt(e,t,n){return bF(e,t,A0e(n),T0e(n))}function vF(e,t,n,r,i){const s=r(e[0]),o=r(sh(e)),a=t!=null?r(t):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function Svt(e,t,n){return vF(e,t,n,dj,hj)}function _vt(e,t,n){const r=Math.sign(e[0]);return vF(e,t,n,E0e(r),k0e(r))}function $vt(e,t,n,r){return vF(e,t,n,FE(r),FE(1/r))}function kvt(e,t,n,r){return vF(e,t,n,A0e(r),T0e(r))}function Evt(e){return 1+~~(new Date(e).getMonth()/3)}function Avt(e){return 1+~~(new Date(e).getUTCMonth()/3)}function IK(e){return e!=null?uc(e)?e:[e]:[]}function Tvt(e,t,n){let r=e[0],i=e[1],s;return i<r&&(s=i,i=r,r=s),s=i-r,s>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-s),r+s]}function OE(e){return typeof e=="function"}function pj(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function Dvt(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}const Ivt=Object.prototype.hasOwnProperty;function uf(e,t){return Ivt.call(e,t)}function Fvt(e,t,n,r,i,s){if(!n&&n!==0)return s;const o=+n;let a=e[0],u=sh(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=o?r:c<=o?i:s}function Ovt(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function Nvt(e){return typeof e=="boolean"}function D0e(e){return Object.prototype.toString.call(e)==="[object Date]"}function I0e(e){return typeof e=="number"}function Mvt(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function hy(e){return typeof e=="string"}function Rvt(e,t){const n=e[0],r=sh(e),i=+t;return i?i===1?r:n+i*(r-n):n}function l_(e,t){let n="";for(;--t>=0;)n+=e;return n}function Pvt(e,t,n,r){const i=n||" ",s=e+"",o=t-s.length;return o<=0?s:r==="left"?l_(i,o)+s:r==="center"?l_(i,~~(o/2))+s+l_(i,Math.ceil(o/2)):s+l_(i,o)}function Lvt(e){return e&&sh(e)-e[0]||0}function Px(e){return uc(e)?"["+e.map(Px)+"]":IE(e)||hy(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Bvt(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const zvt=e=>I0e(e)||D0e(e)?e:Date.parse(e);function jvt(e,t){return t=t||zvt,e==null||e===""?null:t(e)}function Uvt(e){return e==null||e===""?null:e+""}function FK(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Wvt(e,t,n,r){const i=r??"",s=e+"",o=s.length,a=Math.max(0,t-i.length);return o<=t?s:n==="left"?i+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+i+s.slice(o-~~(a/2)):s.slice(0,a)+i}const Vvt="RawCode",S0="Literal",Gvt="Property",Hvt="Identifier",qvt="ArrayExpression",Xvt="BinaryExpression",F0e="CallExpression",Yvt="ConditionalExpression",Kvt="LogicalExpression",Zvt="MemberExpression",Jvt="ObjectExpression",Qvt="UnaryExpression";function Ba(e){this.type=e}Ba.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=ext(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function ext(e){switch(e.type){case qvt:return e.elements;case Xvt:case Kvt:return[e.left,e.right];case F0e:return[e.callee].concat(e.arguments);case Yvt:return[e.test,e.consequent,e.alternate];case Zvt:return[e.object,e.property];case Jvt:return e.properties;case Gvt:return[e.key,e.value];case Qvt:return[e.argument];case Hvt:case S0:case Vvt:default:return[]}}var nl,Pe,pe,Ci,Xt,xF=1,DC=2,Fp=3,Nh=4,wF=5,kg=6,us=7,IC=8,txt=9;nl={};nl[xF]="Boolean";nl[DC]="<end>";nl[Fp]="Identifier";nl[Nh]="Keyword";nl[wF]="Null";nl[kg]="Numeric";nl[us]="Punctuator";nl[IC]="String";nl[txt]="RegularExpression";var nxt="ArrayExpression",rxt="BinaryExpression",ixt="CallExpression",sxt="ConditionalExpression",O0e="Identifier",oxt="Literal",axt="LogicalExpression",uxt="MemberExpression",lxt="ObjectExpression",cxt="Property",fxt="UnaryExpression",Er="Unexpected token %0",hxt="Unexpected number",dxt="Unexpected string",pxt="Unexpected identifier",gxt="Unexpected reserved word",mxt="Unexpected end of input",CL="Invalid regular expression",R3="Invalid regular expression: missing /",N0e="Octal literals are not allowed in strict mode.",yxt="Duplicate data property in object literal not allowed in strict mode",Hr="ILLEGAL",Lx="Disabled.",bxt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),vxt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function CF(e,t){if(!e)throw new Error("ASSERT: "+t)}function $l(e){return e>=48&&e<=57}function gj(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function dv(e){return"01234567".indexOf(e)>=0}function xxt(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Bx(e){return e===10||e===13||e===8232||e===8233}function FC(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&bxt.test(String.fromCharCode(e))}function NE(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&vxt.test(String.fromCharCode(e))}const wxt={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function M0e(){for(;pe<Ci;){const e=Pe.charCodeAt(pe);if(xxt(e)||Bx(e))++pe;else break}}function SL(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)pe<Ci&&gj(Pe[pe])?(r=Pe[pe++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):Nt({},Er,Hr);return String.fromCharCode(i)}function Cxt(){var e,t,n,r;for(e=Pe[pe],t=0,e==="}"&&Nt({},Er,Hr);pe<Ci&&(e=Pe[pe++],!!gj(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Nt({},Er,Hr),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function R0e(){var e,t;for(e=Pe.charCodeAt(pe++),t=String.fromCharCode(e),e===92&&(Pe.charCodeAt(pe)!==117&&Nt({},Er,Hr),++pe,e=SL("u"),(!e||e==="\\"||!FC(e.charCodeAt(0)))&&Nt({},Er,Hr),t=e);pe<Ci&&(e=Pe.charCodeAt(pe),!!NE(e));)++pe,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Pe.charCodeAt(pe)!==117&&Nt({},Er,Hr),++pe,e=SL("u"),(!e||e==="\\"||!NE(e.charCodeAt(0)))&&Nt({},Er,Hr),t+=e);return t}function Sxt(){var e,t;for(e=pe++;pe<Ci;){if(t=Pe.charCodeAt(pe),t===92)return pe=e,R0e();if(NE(t))++pe;else break}return Pe.slice(e,pe)}function _xt(){var e,t,n;return e=pe,t=Pe.charCodeAt(pe)===92?R0e():Sxt(),t.length===1?n=Fp:wxt.hasOwnProperty(t)?n=Nh:t==="null"?n=wF:t==="true"||t==="false"?n=xF:n=Fp,{type:n,value:t,start:e,end:pe}}function P3(){var e=pe,t=Pe.charCodeAt(pe),n,r=Pe[pe],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++pe,{type:us,value:String.fromCharCode(t),start:e,end:pe};default:if(n=Pe.charCodeAt(pe+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return pe+=2,{type:us,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:pe};case 33:case 61:return pe+=2,Pe.charCodeAt(pe)===61&&++pe,{type:us,value:Pe.slice(e,pe),start:e,end:pe}}}if(o=Pe.substr(pe,4),o===">>>=")return pe+=4,{type:us,value:o,start:e,end:pe};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return pe+=3,{type:us,value:s,start:e,end:pe};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return pe+=2,{type:us,value:i,start:e,end:pe};if(i==="//"&&Nt({},Er,Hr),"<>=!+-*%&|^/".indexOf(r)>=0)return++pe,{type:us,value:r,start:e,end:pe};Nt({},Er,Hr)}function $xt(e){let t="";for(;pe<Ci&&gj(Pe[pe]);)t+=Pe[pe++];return t.length===0&&Nt({},Er,Hr),FC(Pe.charCodeAt(pe))&&Nt({},Er,Hr),{type:kg,value:parseInt("0x"+t,16),start:e,end:pe}}function kxt(e){let t="0"+Pe[pe++];for(;pe<Ci&&dv(Pe[pe]);)t+=Pe[pe++];return(FC(Pe.charCodeAt(pe))||$l(Pe.charCodeAt(pe)))&&Nt({},Er,Hr),{type:kg,value:parseInt(t,8),octal:!0,start:e,end:pe}}function OK(){var e,t,n;if(n=Pe[pe],CF($l(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=pe,e="",n!=="."){if(e=Pe[pe++],n=Pe[pe],e==="0"){if(n==="x"||n==="X")return++pe,$xt(t);if(dv(n))return kxt(t);n&&$l(n.charCodeAt(0))&&Nt({},Er,Hr)}for(;$l(Pe.charCodeAt(pe));)e+=Pe[pe++];n=Pe[pe]}if(n==="."){for(e+=Pe[pe++];$l(Pe.charCodeAt(pe));)e+=Pe[pe++];n=Pe[pe]}if(n==="e"||n==="E")if(e+=Pe[pe++],n=Pe[pe],(n==="+"||n==="-")&&(e+=Pe[pe++]),$l(Pe.charCodeAt(pe)))for(;$l(Pe.charCodeAt(pe));)e+=Pe[pe++];else Nt({},Er,Hr);return FC(Pe.charCodeAt(pe))&&Nt({},Er,Hr),{type:kg,value:parseFloat(e),start:t,end:pe}}function Ext(){var e="",t,n,r,i,s=!1;for(t=Pe[pe],CF(t==="'"||t==='"',"String literal must starts with a quote"),n=pe,++pe;pe<Ci;)if(r=Pe[pe++],r===t){t="";break}else if(r==="\\")if(r=Pe[pe++],!r||!Bx(r.charCodeAt(0)))switch(r){case"u":case"x":Pe[pe]==="{"?(++pe,e+=Cxt()):e+=SL(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:dv(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),pe<Ci&&dv(Pe[pe])&&(s=!0,i=i*8+"01234567".indexOf(Pe[pe++]),"0123".indexOf(r)>=0&&pe<Ci&&dv(Pe[pe])&&(i=i*8+"01234567".indexOf(Pe[pe++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&Pe[pe]===`
`&&++pe;else{if(Bx(r.charCodeAt(0)))break;e+=r}return t!==""&&Nt({},Er,Hr),{type:IC,value:e,octal:s,start:n,end:pe}}function Axt(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";Nt({},CL)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{Nt({},CL)}try{return new RegExp(e,t)}catch{return null}}function Txt(){var e,t,n,r,i;for(e=Pe[pe],CF(e==="/","Regular expression literal must start with a slash"),t=Pe[pe++],n=!1,r=!1;pe<Ci;)if(e=Pe[pe++],t+=e,e==="\\")e=Pe[pe++],Bx(e.charCodeAt(0))&&Nt({},R3),t+=e;else if(Bx(e.charCodeAt(0)))Nt({},R3);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||Nt({},R3),i=t.substr(1,t.length-2),{value:i,literal:t}}function Dxt(){var e,t,n;for(t="",n="";pe<Ci&&(e=Pe[pe],!!NE(e.charCodeAt(0)));)++pe,e==="\\"&&pe<Ci?Nt({},Er,Hr):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Nt({},CL,n),{value:n,literal:t}}function Ixt(){var e,t,n,r;return Xt=null,M0e(),e=pe,t=Txt(),n=Dxt(),r=Axt(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:pe}}function Fxt(e){return e.type===Fp||e.type===Nh||e.type===xF||e.type===wF}function P0e(){if(M0e(),pe>=Ci)return{type:DC,start:pe,end:pe};const e=Pe.charCodeAt(pe);return FC(e)?_xt():e===40||e===41||e===59?P3():e===39||e===34?Ext():e===46?$l(Pe.charCodeAt(pe+1))?OK():P3():$l(e)?OK():P3()}function ps(){const e=Xt;return pe=e.end,Xt=P0e(),pe=e.end,e}function L0e(){const e=pe;Xt=P0e(),pe=e}function Oxt(e){const t=new Ba(nxt);return t.elements=e,t}function NK(e,t,n){const r=new Ba(e==="||"||e==="&&"?axt:rxt);return r.operator=e,r.left=t,r.right=n,r}function Nxt(e,t){const n=new Ba(ixt);return n.callee=e,n.arguments=t,n}function Mxt(e,t,n){const r=new Ba(sxt);return r.test=e,r.consequent=t,r.alternate=n,r}function mj(e){const t=new Ba(O0e);return t.name=e,t}function Vb(e){const t=new Ba(oxt);return t.value=e.value,t.raw=Pe.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function MK(e,t,n){const r=new Ba(uxt);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function Rxt(e){const t=new Ba(lxt);return t.properties=e,t}function RK(e,t,n){const r=new Ba(cxt);return r.key=t,r.value=n,r.kind=e,r}function Pxt(e,t){const n=new Ba(fxt);return n.operator=e,n.argument=t,n.prefix=!0,n}function Nt(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,o)=>(CF(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=pe,n.description=i,n}function SF(e){e.type===DC&&Nt(e,mxt),e.type===kg&&Nt(e,hxt),e.type===IC&&Nt(e,dxt),e.type===Fp&&Nt(e,pxt),e.type===Nh&&Nt(e,gxt),Nt(e,Er,e.value)}function Si(e){const t=ps();(t.type!==us||t.value!==e)&&SF(t)}function mn(e){return Xt.type===us&&Xt.value===e}function L3(e){return Xt.type===Nh&&Xt.value===e}function Lxt(){const e=[];for(pe=Xt.start,Si("[");!mn("]");)mn(",")?(ps(),e.push(null)):(e.push(Op()),mn("]")||Si(","));return ps(),Oxt(e)}function PK(){pe=Xt.start;const e=ps();return e.type===IC||e.type===kg?(e.octal&&Nt(e,N0e),Vb(e)):mj(e.value)}function Bxt(){var e,t,n,r;if(pe=Xt.start,e=Xt,e.type===Fp)return n=PK(),Si(":"),r=Op(),RK("init",n,r);if(e.type===DC||e.type===us)SF(e);else return t=PK(),Si(":"),r=Op(),RK("init",t,r)}function zxt(){var e=[],t,n,r,i={},s=String;for(pe=Xt.start,Si("{");!mn("}");)t=Bxt(),t.key.type===O0e?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?Nt({},yxt):i[r]=!0,e.push(t),mn("}")||Si(",");return Si("}"),Rxt(e)}function jxt(){Si("(");const e=yj();return Si(")"),e}const Uxt={if:1};function Wxt(){var e,t,n;if(mn("("))return jxt();if(mn("["))return Lxt();if(mn("{"))return zxt();if(e=Xt.type,pe=Xt.start,e===Fp||Uxt[Xt.value])n=mj(ps().value);else if(e===IC||e===kg)Xt.octal&&Nt(Xt,N0e),n=Vb(ps());else{if(e===Nh)throw new Error(Lx);e===xF?(t=ps(),t.value=t.value==="true",n=Vb(t)):e===wF?(t=ps(),t.value=null,n=Vb(t)):mn("/")||mn("/=")?(n=Vb(Ixt()),L0e()):SF(ps())}return n}function Vxt(){const e=[];if(Si("("),!mn(")"))for(;pe<Ci&&(e.push(Op()),!mn(")"));)Si(",");return Si(")"),e}function Gxt(){pe=Xt.start;const e=ps();return Fxt(e)||SF(e),mj(e.value)}function Hxt(){return Si("."),Gxt()}function qxt(){Si("[");const e=yj();return Si("]"),e}function Xxt(){var e,t,n;for(e=Wxt();;)if(mn("."))n=Hxt(),e=MK(".",e,n);else if(mn("("))t=Vxt(),e=Nxt(e,t);else if(mn("["))n=qxt(),e=MK("[",e,n);else break;return e}function LK(){const e=Xxt();if(Xt.type===us&&(mn("++")||mn("--")))throw new Error(Lx);return e}function n$(){var e,t;if(Xt.type!==us&&Xt.type!==Nh)t=LK();else{if(mn("++")||mn("--"))throw new Error(Lx);if(mn("+")||mn("-")||mn("~")||mn("!"))e=ps(),t=n$(),t=Pxt(e.value,t);else{if(L3("delete")||L3("void")||L3("typeof"))throw new Error(Lx);t=LK()}}return t}function BK(e){let t=0;if(e.type!==us&&e.type!==Nh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function Yxt(){var e,t,n,r,i,s,o,a,u,l;if(e=Xt,u=n$(),r=Xt,i=BK(r),i===0)return u;for(r.prec=i,ps(),t=[e,Xt],o=n$(),s=[u,r,o];(i=BK(Xt))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=NK(a,u,o),s.push(n);r=ps(),r.prec=i,s.push(r),t.push(Xt),n=n$(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=NK(s[l-1].value,s[l-2],n),l-=2;return n}function Op(){var e,t,n;return e=Yxt(),mn("?")&&(ps(),t=Op(),Si(":"),n=Op(),e=Mxt(e,t,n)),e}function yj(){const e=Op();if(mn(","))throw new Error(Lx);return e}function Kxt(e){Pe=e,pe=0,Ci=Pe.length,Xt=null,L0e();const t=yj();if(Xt.type!==DC)throw new Error("Unexpect token after expression.");return t}var B0e={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function z0e(e){function t(o,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(o,a,u){return l=>t(o,l,a,u)}const r="new Date",i="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&gi("Missing arguments to clamp function."),o.length>3&&gi("Too many arguments to clamp function.");const a=o.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&gi("Missing arguments to if function."),o.length>3&&gi("Too many arguments to if function.");const a=o.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function Zxt(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function Jxt(e){e=e||{};const t=e.allowed?FK(e.allowed):{},n=e.forbidden?FK(e.forbidden):{},r=e.constants||B0e,i=(e.functions||z0e)(f),s=e.globalvar,o=e.fieldvar,a=OE(s)?s:p=>`${s}["${p}"]`;let u={},l={},c=0;function f(p){if(hy(p))return p;const m=h[p.type];return m==null&&gi("Unsupported type: "+p.type),m(p)}const h={Literal:p=>p.raw,Identifier:p=>{const m=p.name;return c>0?m:uf(n,m)?gi("Illegal identifier: "+m):uf(r,m)?r[m]:uf(t,m)?m:(u[m]=1,a(m))},MemberExpression:p=>{const m=!p.computed,g=f(p.object);m&&(c+=1);const y=f(p.property);return g===o&&(l[Zxt(y)]=1),m&&(c-=1),g+(m?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&gi("Illegal callee type: "+p.callee.type);const m=p.callee.name,g=p.arguments,y=uf(i,m)&&i[m];return y||gi("Unrecognized function: "+m),OE(y)?y(g):y+"("+g.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{c+=1;const m=f(p.key);return c-=1,m+":"+f(p.value)}};function d(p){const m={code:f(p),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},m}return d.functions=i,d.constants=r,d}function B3(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Qxt(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function e2t(e){let t,n,r;e.length!==2?(t=B3,n=(a,u)=>B3(e(a),u),r=(a,u)=>e(a)-u):(t=e===B3||e===Qxt?e:t2t,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function t2t(){return 0}function n2t(e,...t){e=new tk(e),t=t.map(r2t);e:for(const n of e)for(const r of t)if(!r.has(n)){e.delete(n);continue e}return e}function r2t(e){return e instanceof tk?e:new tk(e)}function i2t(...e){const t=new tk;for(const n of e)for(const r of n)t.add(r);return t}function dy(e,t,n){return e.fields=t||[],e.fname=n,e}function s2t(e){return e.length===1?o2t(e[0]):a2t(e)}const o2t=e=>function(t){return t[e]},a2t=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function r$(e){throw Error(e)}function u2t(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||r$("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&r$("Access path missing closing bracket: "+e),r&&r$("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function zx(e,t,n){const r=u2t(e);return e=r.length===1?r[0]:e,dy((n&&n.get||s2t)(r),[e],t||e)}zx("id");dy(e=>e,[],"identity");dy(()=>0,[],"zero");dy(()=>1,[],"one");dy(()=>!0,[],"true");dy(()=>!1,[],"false");var j0e=Array.isArray;function l2t(e){return e[e.length-1]}function Bd(e){return e==null||e===""?null:+e}function zK(e){return e!=null?j0e(e)?e:[e]:[]}function c2t(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const f2t=Object.prototype.hasOwnProperty;function jK(e,t){return f2t.call(e,t)}function c_(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function z3(e){return Object.prototype.toString.call(e)==="[object Date]"}const h2t="Literal";var rl,d2t=1,p2t=2,g2t=3,m2t=4,y2t=5,b2t=6,v2t=7,x2t=8,w2t=9;rl={};rl[d2t]="Boolean";rl[p2t]="<end>";rl[g2t]="Identifier";rl[m2t]="Keyword";rl[y2t]="Null";rl[b2t]="Numeric";rl[v2t]="Punctuator";rl[x2t]="String";rl[w2t]="RegularExpression";const bj="intersect",UK="union",C2t="vlMulti",S2t="vlPoint",WK="or",_2t="and",ru="_vgsid_",jx=zx(ru),$2t="E",k2t="R",E2t="R-E",A2t="R-LE",T2t="R-RE",ME="index:unit";function VK(e,t){for(var n=t.fields,r=t.values,i=n.length,s=0,o,a;s<i;++s)if(a=n[s],a.getter=zx.getter||zx(a.field),o=a.getter(e),z3(o)&&(o=Bd(o)),z3(r[s])&&(r[s]=Bd(r[s])),z3(r[s][0])&&(r[s]=r[s].map(Bd)),a.type===$2t){if(j0e(r[s])?r[s].indexOf(o)<0:o!==r[s])return!1}else if(a.type===k2t){if(!c_(o,r[s]))return!1}else if(a.type===T2t){if(!c_(o,r[s],!0,!1))return!1}else if(a.type===E2t){if(!c_(o,r[s],!1,!1))return!1}else if(a.type===A2t&&!c_(o,r[s],!1,!0))return!1;return!0}function D2t(e,t,n){for(var r=this.context.data[e],i=r?r.values.value:[],s=r?r[ME]&&r[ME].value:void 0,o=n===bj,a=i.length,u=0,l,c,f,h,d;u<a;++u)if(l=i[u],s&&o){if(c=c||{},f=c[h=l.unit]||0,f===-1)continue;if(d=VK(t,l),c[h]=d?-1:++f,d&&s.size===1)return!0;if(!d&&f===s.get(h).count)return!1}else if(d=VK(t,l),o^d)return d;return a&&o}const U0e=e2t(jx),I2t=U0e.left,F2t=U0e.right;function O2t(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],s=r?r[ME]&&r[ME].value:void 0,o=n===bj,a=jx(t),u=I2t(i,a);if(u===i.length||jx(i[u])!==a)return!1;if(s&&o){if(s.size===1)return!0;if(F2t(i,a)-u<s.size)return!1}return!0}function N2t(e,t){return e.map(n=>c2t(t.fields?{values:t.fields.map(r=>(r.getter||(r.getter=zx(r.field)))(n.datum))}:{[ru]:jx(n.datum)},t))}function M2t(e,t,n,r){for(var i=this.context.data[e],s=i?i.values.value:[],o={},a={},u={},l,c,f,h,d,p,m,g,y,b,x=s.length,v=0,w,C;v<x;++v)if(l=s[v],h=l.unit,c=l.fields,f=l.values,c&&f){for(w=0,C=c.length;w<C;++w)d=c[w],m=o[d.field]||(o[d.field]={}),g=m[h]||(m[h]=[]),u[d.field]=y=d.type.charAt(0),b=j3[`${y}_union`],m[h]=b(g,zK(f[w]));n&&(g=a[h]||(a[h]=[]),g.push(zK(f).reduce((S,_,$)=>(S[c[$].field]=_,S),{})))}else d=ru,p=jx(l),m=o[d]||(o[d]={}),g=m[h]||(m[h]=[]),g.push(p),n&&(g=a[h]||(a[h]=[]),g.push({[ru]:p}));if(t=t||UK,o[ru]?o[ru]=j3[`${ru}_${t}`](...Object.values(o[ru])):Object.keys(o).forEach(S=>{o[S]=Object.keys(o[S]).map(_=>o[S][_]).reduce((_,$)=>_===void 0?$:j3[`${u[S]}_${t}`](_,$))}),s=Object.keys(a),n&&s.length){const S=r?S2t:C2t;o[S]=t===UK?{[WK]:s.reduce((_,$)=>(_.push(...a[$]),_),[])}:{[_2t]:s.map(_=>({[WK]:a[_]}))}}return o}var j3={[`${ru}_union`]:i2t,[`${ru}_intersect`]:n2t,E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Bd(t[0]),r=Bd(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Bd(t[0]),r=Bd(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};const R2t=":",P2t="@";function vj(e,t,n,r){t[0].type!==h2t&&r$("First argument to selection functions must be a string literal.");const i=t[0].value,s=t.length>=2&&l2t(t).value,o="unit",a=P2t+o,u=R2t+i;s===bj&&!jK(r,a)&&(r[a]=n.getData(i).indataRef(n,o)),jK(r,u)||(r[u]=n.getData(i).tuplesRef())}function W0e(e){const t=this.context.data[e];return t?t.values.value:[]}function L2t(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i&&i.count}function B2t(e,t){const n=this.context.dataflow,r=this.context.data[e],i=r.input;return n.pulse(i,n.changeset().remove($0e).insert(t)),1}function z2t(e,t,n){if(e){const r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==void 0?n:e}const OC=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},j2t=OC("format"),V0e=OC("timeFormat"),U2t=OC("utcFormat"),W2t=OC("timeParse"),V2t=OC("utcParse"),f_=new Date(2e3,0,1);function _F(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(f_.setYear(2e3),f_.setMonth(e),f_.setDate(t),V0e.call(this,f_,n))}function G2t(e){return _F.call(this,e,1,"%B")}function H2t(e){return _F.call(this,e,1,"%b")}function q2t(e){return _F.call(this,0,2+e,"%A")}function X2t(e){return _F.call(this,0,2+e,"%a")}const Y2t=":",K2t="@",_L="%",G0e="$";function xj(e,t,n,r){t[0].type!==S0&&gi("First argument to data functions must be a string literal.");const i=t[0].value,s=Y2t+i;if(!uf(s,r))try{r[s]=n.getData(i).tuplesRef()}catch{}}function Z2t(e,t,n,r){t[0].type!==S0&&gi("First argument to indata must be a string literal."),t[1].type!==S0&&gi("Second argument to indata must be a string literal.");const i=t[0].value,s=t[1].value,o=K2t+s;uf(o,r)||(r[o]=n.getData(i).indataRef(n,s))}function Cs(e,t,n,r){if(t[0].type===S0)GK(n,r,t[0].value);else for(e in n.scales)GK(n,r,e)}function GK(e,t,n){const r=_L+n;if(!uf(t,r))try{t[r]=e.scaleRef(n)}catch{}}function Cc(e,t){let n;return OE(e)?e:hy(e)?(n=t.scales[e])&&n.value:void 0}function J2t(e,t,n){t.__bandwidth=i=>i&&i.bandwidth?i.bandwidth():0,n._bandwidth=Cs,n._range=Cs,n._scale=Cs;const r=i=>"_["+(i.type===S0?Px(_L+i.value):Px(_L)+"+"+e(i))+"]";return{_bandwidth:i=>`this.__bandwidth(${r(i[0])})`,_range:i=>`${r(i[0])}.range()`,_scale:i=>`${r(i[0])}(${e(i[1])})`}}function wj(e,t){return function(n,r,i){if(n){const s=Cc(n,(i||this).context);return s&&s.path[e](r)}else return t(r)}}const Q2t=wj("area",jct),ewt=wj("bounds",Gct),twt=wj("centroid",Zct);function nwt(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function Cj(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function rwt(){return Cj(this.context.dataflow,"warn",arguments)}function iwt(){return Cj(this.context.dataflow,"info",arguments)}function swt(){return Cj(this.context.dataflow,"debug",arguments)}function U3(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $L(e){const t=As(e),n=U3(t.r),r=U3(t.g),i=U3(t.b);return .2126*n+.7152*r+.0722*i}function owt(e,t){const n=$L(e),r=$L(t),i=Math.max(n,r),s=Math.min(n,r);return(i+.05)/(s+.05)}function awt(){const e=[].slice.call(arguments);return e.unshift({}),pj(...e)}function H0e(e,t){return e===t||e!==e&&t!==t?!0:uc(e)?uc(t)&&e.length===t.length?uwt(e,t):!1:IE(e)&&IE(t)?q0e(e,t):!1}function uwt(e,t){for(let n=0,r=e.length;n<r;++n)if(!H0e(e[n],t[n]))return!1;return!0}function q0e(e,t){for(const n in e)if(!H0e(e[n],t[n]))return!1;return!0}function HK(e){return t=>q0e(e,t)}function lwt(e,t,n,r,i,s){const o=this.context.dataflow,a=this.context.data[e],u=a.input,l=o.stamp();let c=a.changes,f,h;if(o._trigger===!1||!(u.value.length||t||r))return 0;if((!c||c.stamp<l)&&(a.changes=c=o.changeset(),c.stamp=l,o.runAfter(()=>{a.modified=!0,o.pulse(u,c).run()},!0,1)),n&&(f=n===!0?$0e:uc(n)||VD(n)?n:HK(n),c.remove(f)),t&&c.insert(t),r&&(f=HK(r),u.value.some(f)?c.remove(f):c.insert(r)),i)for(h in s)c.modify(i,h,s[h]);return 1}function cwt(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)}function fwt(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const qK={};function hwt(e,t){const n=qK[t]||(qK[t]=_0e(t));return uc(e)?e.map(n):n(e)}function Sj(e){return uc(e)||ArrayBuffer.isView(e)?e:null}function _j(e){return Sj(e)||(hy(e)?e:null)}function dwt(e,...t){return Sj(e).join(...t)}function pwt(e,...t){return _j(e).indexOf(...t)}function gwt(e,...t){return _j(e).lastIndexOf(...t)}function mwt(e,...t){return _j(e).slice(...t)}function ywt(e,t,n){return OE(n)&&gi("Function argument passed to replace."),String(e).replace(t,n)}function bwt(e){return Sj(e).slice().reverse()}function vwt(e,t,n){return J8(e||0,t||0,n||0)}function xwt(e,t){const n=Cc(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function wwt(e,t){const n=Cc(e,(t||this).context);return n?n.copy():void 0}function Cwt(e,t){const n=Cc(e,(t||this).context);return n?n.domain():[]}function Swt(e,t,n){const r=Cc(e,(n||this).context);return r?uc(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}function _wt(e,t){const n=Cc(e,(t||this).context);return n&&n.range?n.range():[]}function $wt(e,t,n){const r=Cc(e,(n||this).context);return r?r(t):void 0}function kwt(e,t,n,r,i){e=Cc(e,(i||this).context);const s=zge(t,n);let o=e.domain(),a=o[0],u=sh(o),l=hj;return u-a?l=_de(e,a,u):e=(e.interpolator?jt("sequential")().interpolator(e.interpolator()):jt("linear")().interpolate(e.interpolate()).range(e.range())).domain([a=0,u=1]),e.ticks&&(o=e.ticks(+r||15),a!==o[0]&&o.unshift(a),u!==sh(o)&&o.push(u)),o.forEach(c=>s.stop(l(c),e(c))),s}function Ewt(e,t,n){const r=Cc(e,(n||this).context);return function(i){return r?r.path.context(i)(t):""}}function Awt(e){let t=null;return function(n){return n?Dx(n,t=t||y0(e)):e}}const X0e=e=>e.data;function Y0e(e,t){const n=W0e.call(t,e);return n.root&&n.root.lookup||{}}function Twt(e,t,n){const r=Y0e(e,this),i=r[t],s=r[n];return i&&s?i.path(s).map(X0e):void 0}function Dwt(e,t){const n=Y0e(e,this)[t];return n?n.ancestors().map(X0e):void 0}const K0e=()=>typeof window<"u"&&window||null;function Iwt(){const e=K0e();return e?e.screen:{}}function Fwt(){const e=K0e();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function Owt(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function Nwt(e,t,n){if(!e)return[];const[r,i]=e,s=new Zi().set(r[0],r[1],i[0],i[1]),o=n||this.context.dataflow.scenegraph().root;return Dme(o,s,Mwt(t))}function Mwt(e){let t=null;if(e){const n=IK(e.marktype),r=IK(e.markname);t=i=>(!n.length||n.some(s=>i.marktype===s))&&(!r.length||r.some(s=>i.name===s))}return t}const Ux={random(){return Da()},cumulativeNormal:YD,cumulativeLogNormal:Pz,cumulativeUniform:jz,densityNormal:Fz,densityLogNormal:Rz,densityUniform:zz,quantileNormal:KD,quantileLogNormal:Lz,quantileUniform:Uz,sampleNormal:XD,sampleLogNormal:Mz,sampleUniform:Bz,isArray:uc,isBoolean:Nvt,isDate:D0e,isDefined(e){return e!==void 0},isNumber:I0e,isObject:IE,isRegExp:Mvt,isString:hy,isTuple:VD,isValid(e){return e!=null&&e===e},toBoolean:Bvt,toDate:jvt,toNumber:dj,toString:Uvt,indexof:pwt,join:dwt,lastindexof:gwt,replace:ywt,reverse:bwt,slice:mwt,flush:Fvt,lerp:Rvt,merge:awt,pad:Pvt,peek:sh,pluck:hwt,span:Lvt,inrange:Ovt,truncate:Wvt,rgb:As,lab:Xf,hcl:Yf,hsl:qf,luminance:$L,contrast:owt,sequence:qs,format:j2t,utcFormat:U2t,utcParse:V2t,utcOffset:gle,utcSequence:ble,timeFormat:V0e,timeParse:W2t,timeOffset:ple,timeSequence:yle,timeUnitSpecifier:rle,monthFormat:G2t,monthAbbrevFormat:H2t,dayFormat:q2t,dayAbbrevFormat:X2t,quarter:Evt,utcquarter:Avt,week:sle,utcweek:ule,dayofyear:ile,utcdayofyear:ale,warn:rwt,info:iwt,debug:swt,extent:Dvt,inScope:nwt,intersect:Nwt,clampRange:Tvt,pinchDistance:cwt,pinchAngle:fwt,screen:Iwt,containerSize:Owt,windowSize:Fwt,bandspace:vwt,setdata:B2t,pathShape:Awt,panLinear:vvt,panLog:xvt,panPow:wvt,panSymlog:Cvt,zoomLinear:Svt,zoomLog:_vt,zoomPow:$vt,zoomSymlog:kvt,encode:z2t,modify:lwt},Rwt=["view","item","group","xy","x","y"],Pwt="event.vega.",Z0e="this.",$j={},J0e={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Px(G0e+e)}]`,functions:Lwt,constants:B0e,visitors:$j},kL=Jxt(J0e);function Lwt(e){const t=z0e(e);Rwt.forEach(n=>t[n]=Pwt+n);for(const n in Ux)t[n]=Z0e+n;return pj(t,J2t(e,Ux,$j)),t}function ir(e,t,n){return arguments.length===1?Ux[e]:(Ux[e]=t,n&&($j[e]=n),kL&&(kL.functions[e]=Z0e+e),this)}ir("bandwidth",xwt,Cs);ir("copy",wwt,Cs);ir("domain",Cwt,Cs);ir("range",_wt,Cs);ir("invert",Swt,Cs);ir("scale",$wt,Cs);ir("gradient",kwt,Cs);ir("geoArea",Q2t,Cs);ir("geoBounds",ewt,Cs);ir("geoCentroid",twt,Cs);ir("geoShape",Ewt,Cs);ir("indata",L2t,Z2t);ir("data",W0e,xj);ir("treePath",Twt,xj);ir("treeAncestors",Dwt,xj);ir("vlSelectionTest",D2t,vj);ir("vlSelectionIdTest",O2t,vj);ir("vlSelectionResolve",M2t,vj);ir("vlSelectionTuples",N2t);function zu(e,t){const n={};let r;try{e=hy(e)?e:Px(e)+"",r=Kxt(e)}catch{gi("Expression parse error: "+e)}r.visit(s=>{if(s.type!==F0e)return;const o=s.callee.name,a=J0e.visitors[o];a&&a(o,s.arguments,t,n)});const i=kL(r);return i.globals.forEach(s=>{const o=G0e+s;!uf(n,o)&&t.getSignal(s)&&(n[o]=t.signalRef(s))}),{$expr:pj({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}function il(e,t,n){return e.fields=t||[],e.fname=n,e}function Bwt(e){return e==null?null:e.fields}function Q0e(e){return e.length===1?zwt(e[0]):jwt(e)}const zwt=e=>function(t){return t[e]},jwt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function ep(e){throw Error(e)}function e1e(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||ep("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&ep("Access path missing closing bracket: "+e),r&&ep("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function kj(e,t,n){const r=e1e(e);return e=r.length===1?r[0]:e,il((n&&n.get||Q0e)(r),[e],t||e)}kj("id");il(e=>e,[],"identity");il(()=>0,[],"zero");il(()=>1,[],"one");const Uwt=il(()=>!0,[],"true");il(()=>!1,[],"false");var Ej=Array.isArray;function Aj(e){return e===Object(e)}function Wx(e){return e!=null?Ej(e)?e:[e]:[]}function Wwt(e){return typeof e=="function"}const Vwt="descending";function Gwt(e,t,n){n=n||{},t=Wx(t)||[];const r=[],i=[],s={},o=n.comparator||Hwt;return Wx(e).forEach((a,u)=>{a!=null&&(r.push(t[u]===Vwt?-1:1),i.push(a=Wwt(a)?a:kj(a,null,n)),(Bwt(a)||[]).forEach(l=>s[l]=1))}),i.length===0?null:il(o(i,r),Object.keys(s))}const t1e=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),Hwt=(e,t)=>e.length===1?qwt(e[0],t[0]):Xwt(e,t,e.length),qwt=(e,t)=>function(n,r){return t1e(e(n),e(r))*t},Xwt=(e,t,n)=>(t.push(0),function(r,i){let s,o=0,a=-1;for(;o===0&&++a<n;)s=e[a],o=t1e(s(r),s(i));return o*t[a]}),Ywt=Object.prototype.hasOwnProperty;function Kwt(e,t){return Ywt.call(e,t)}function Zwt(e){return typeof e=="string"}function Jwt(e,t,n){e&&(e=t?Wx(e).map(a=>a.replace(/\\(.)/g,"$1")):Wx(e));const r=e&&e.length,i=n&&n.get||Q0e,s=a=>i(t?[a]:e1e(a));let o;if(!r)o=function(){return""};else if(r===1){const a=s(e[0]);o=function(u){return""+a(u)}}else{const a=e.map(s);o=function(u){let l=""+a[0](u),c=0;for(;++c<r;)l+="|"+a[c](u);return l}}return il(o,e,"key")}function EL(e){return Ej(e)?"["+e.map(EL)+"]":Aj(e)||Zwt(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function n1e(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Qwt(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(r=>t.parseOperator(r)),n.forEach(r=>t.parseOperatorParameters(r)),(e.streams||[]).forEach(r=>t.parseStream(r)),(e.updates||[]).forEach(r=>t.parseUpdate(r)),t.resolve()}const eCt=n1e(["rule"]),XK=n1e(["group","image","rect"]);function tCt(e,t){let n="";return eCt[t]||(e.x2&&(e.x?(XK[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(XK[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function Tj(e){return(e+"").toLowerCase()}function nCt(e){return Tj(e)==="operator"}function rCt(e){return Tj(e)==="collect"}function ib(e,t,n){n.endsWith(";")||(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}function iCt(e,t,n,r){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${r}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${r} : `}var sCt={operator:(e,t)=>ib(e,["_"],t.code),parameter:(e,t)=>ib(e,["datum","_"],t.code),event:(e,t)=>ib(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return ib(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const s in r){const o="o["+EL(s)+"]";i+=`$=${r[s].code};if(${o}!==$)${o}=$,m=1;`}return i+=tCt(r,n),i+="return m;",ib(e,["item","_"],i)},codegen:{get(e){const t=`[${e.map(EL).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const r=(s,o)=>{const a=t[o];let u,l;return s.path?(u=`a${s.path}`,l=`b${s.path}`):((n=n||{})["f"+o]=s,u=`this.f${o}(a)`,l=`this.f${o}(b)`),iCt(u,l,-a,a)},i=Function("a","b","var u, v; return "+e.map(r).join("")+"0;");return n?i.bind(n):i}}};function oCt(e){const t=this;nCt(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function aCt(e){const t=this;if(e.params){const n=t.get(e.id);n||ep("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function uCt(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=Ej(i)?i.map(s=>YK(s,n,t)):YK(i,n,t)}return t}function YK(e,t,n){if(!e||!Aj(e))return e;for(let r=0,i=KK.length,s;r<i;++r)if(s=KK[r],Kwt(e,s.key))return s.parse(e,t,n);return e}var KK=[{key:"$ref",parse:lCt},{key:"$key",parse:fCt},{key:"$expr",parse:cCt},{key:"$field",parse:hCt},{key:"$encode",parse:pCt},{key:"$compare",parse:dCt},{key:"$context",parse:gCt},{key:"$subflow",parse:mCt},{key:"$tupleid",parse:yCt}];function lCt(e,t){return t.get(e.$ref)||ep("Operator not defined: "+e.$ref)}function cCt(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code;return t.fn[r]||(t.fn[r]=il(t.parameterExpression(e.$expr),e.$fields))}function fCt(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Jwt(e.$key,e.$flat,t.expr.codegen))}function hCt(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=kj(e.$field,e.$name,t.expr.codegen))}function dCt(e,t){const n="c:"+e.$compare+"_"+e.$order,r=Wx(e.$compare).map(i=>i&&i.$tupleid?Ve:i);return t.fn[n]||(t.fn[n]=Gwt(r,e.$order,t.expr.codegen))}function pCt(e,t){const n=e.$encode,r={};for(const i in n){const s=n[i];r[i]=il(t.encodeExpression(s.$expr),s.$fields),r[i].output=s.$output}return r}function gCt(e,t){return t}function mCt(e,t){const n=e.$subflow;return function(r,i,s){const o=t.fork().parse(n),a=o.get(n.operators[0].id),u=o.signals.parent;return u&&u.set(s),a.detachSubflow=()=>t.detach(o),a}}function yCt(){return Ve}function bCt(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,r=e.stream!=null?t.get(e.stream):void 0,i;e.source?r=t.events(e.source,e.type,n):e.merge&&(i=e.merge.map(s=>t.get(s)),r=i[0].merge.apply(i[0],i.slice(1))),e.between&&(i=e.between.map(s=>t.get(s)),r=r.between(i[0],i[1])),e.filter&&(r=r.filter(n)),e.throttle!=null&&(r=r.throttle(+e.throttle)),e.debounce!=null&&(r=r.debounce(+e.debounce)),r==null&&ep("Invalid stream definition: "+JSON.stringify(e)),e.consume&&r.consume(!0),t.stream(e,r)}function vCt(e){var t=this,n=Aj(n=e.source)?n.$ref:n,r=t.get(n),i=null,s=e.update,o=void 0;r||ep("Source not defined: "+e.source),i=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),s&&s.$expr&&(s.$params&&(o=t.parseParameters(s.$params)),s=t.handlerExpression(s.$expr)),t.update(e,r,i,s,o)}const xCt={skip:!0};function wCt(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(s=>{const o=t.signals[s];e.signals(s,o)&&(r[s]=o.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(s=>{const o=t.data[s];e.data(s,o)&&(i[s]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(s=>s.getState(e))),n}function CCt(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(s=>{n.update(t.signals[s],i[s],xCt)}),Object.keys(r||{}).forEach(s=>{n.pulse(t.data[s].input,n.changeset().remove(Uwt).insert(r[s]))}),(e.subcontext||[]).forEach((s,o)=>{const a=t.subcontext[o];a&&a.setState(s)})}function r1e(e,t,n,r){return new i1e(e,t,n,r)}function i1e(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||sCt,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function ZK(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}i1e.prototype=ZK.prototype={fork(){const e=new ZK(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),rCt(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let s=n.get(e.parent.$ref);s?(r.connect(s,[t]),t.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(e.parent.$ref),r.connect(s,[t]),t.targets().add(s)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const s in e.data){const o=n.data[s]||(n.data[s]={});e.data[s].forEach(a=>o[a]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Tj(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:Qwt,parseOperator:oCt,parseOperatorParameters:aCt,parseParameters:uCt,parseStream:bCt,parseUpdate:vCt,getState:wCt,setState:CCt};function SCt(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),s1e(t,e.description()))}function s1e(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function _Ct(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const W3="default";function $Ct(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:W3,item:null}));e.on(e.events("view","mousemove"),t,(n,r)=>{const i=t.value,s=i?wn(i)?i:i.user:W3,o=r.item&&r.item.cursor||null;return i&&s===i.user&&o==i.item?i:{user:s,item:o}}),e.add(null,function(n){let r=n.cursor,i=this.value;return wn(r)||(i=r.item,r=r.user),AL(e,r&&r!==W3?r:i||r),i},{cursor:t})}function AL(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function RE(e,t){var n=e._runtime.data;return lt(n,t)||ye("Unrecognized data set: "+t),n[t]}function kCt(e,t){return arguments.length<2?RE(this,e).values.value:$F.call(this,e,fg().remove(G1).insert(t))}function $F(e,t){wue(t)||ye("Second argument to changes must be a changeset.");const n=RE(this,e);return n.modified=!0,this.pulse(n.input,t)}function ECt(e,t){return $F.call(this,e,fg().insert(t))}function ACt(e,t){return $F.call(this,e,fg().remove(t))}function o1e(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function a1e(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function kF(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function TCt(e){var t=kF(e),n=o1e(e),r=a1e(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach(i=>{try{i(n,r)}catch(s){e.error(s)}})}function DCt(e,t,n){var r=e._renderer,i=r&&r.canvas(),s,o,a;return i&&(a=kF(e),o=t.changedTouches?t.changedTouches[0]:t,s=nF(o,i),s[0]-=a[0],s[1]-=a[1]),t.dataflow=e,t.item=n,t.vega=ICt(e,n,s),t}function ICt(e,t,n){const r=t?t.mark.marktype==="group"?t:t.mark.group:null;function i(o){var a=r,u;if(o){for(u=t;u;u=u.mark.group)if(u.mark.name===o){a=u;break}}return a&&a.mark&&a.mark.interactive?a:{}}function s(o){if(!o)return n;wn(o)&&(o=i(o));const a=n.slice();for(;o;)a[0]-=o.x||0,a[1]-=o.y||0,o=o.mark&&o.mark.group;return a}return{view:No(e),item:No(t||{}),group:i,xy:s,x:o=>s(o)[0],y:o=>s(o)[1]}}const JK="view",FCt="timer",OCt="window",NCt={trap:!1};function MCt(e){const t=St({defaults:{}},e),n=(r,i)=>{i.forEach(s=>{ht(r[s])&&(r[s]=nc(r[s]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function u1e(e,t,n,r){e._eventListeners.push({type:n,sources:at(t),handler:r})}function RCt(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return r===!1||i===!0?!1:r===!0||i===!1?!0:r?r[t]:i?!i[t]:e.preventDefault()}function h_(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return r===!1||wt(r)&&!r[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function PCt(e,t,n){var r=this,i=new qD(n),s=function(l,c){r.runAsync(null,()=>{e===JK&&RCt(r,t)&&l.preventDefault(),i.receive(DCt(r,l,c))})},o;if(e===FCt)h_(r,"timer",t)&&r.timer(s,t);else if(e===JK)h_(r,"view",t)&&r.addEventListener(t,s,NCt);else if(e===OCt?h_(r,"window",t)&&typeof window<"u"&&(o=[window]):typeof document<"u"&&h_(r,"selector",t)&&(o=document.querySelectorAll(e)),!o)r.warn("Can not resolve event source: "+e);else{for(var a=0,u=o.length;a<u;++a)o[a].addEventListener(t,s);u1e(r,o,t,s)}return i}function QK(e){return e.item}function eZ(e){return e.item.mark.source}function tZ(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function LCt(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",QK),eZ,tZ(e)),this.on(this.events("view","mouseout",QK),eZ,tZ(t)),this}function BCt(){var e=this._tooltip,t=this._timers,n=this._eventListeners,r,i,s;for(r=t.length;--r>=0;)t[r].stop();for(r=n.length;--r>=0;)for(s=n[r],i=s.sources.length;--i>=0;)s.sources[i].removeEventListener(s.type,s.handler);return e&&e.call(this,this._handler,null,null,null),this}function Ys(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return n!=null&&(r.textContent=n),r}const zCt="vega-bind",jCt="vega-bind-name",UCt="vega-bind-radio";function WCt(e,t,n){if(!t)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:o=>{o!=e.signal(r.signal)&&e.runAsync(null,()=>{i.source=!0,e.signal(r.signal,o)})}},r.debounce&&(i.update=Aae(r.debounce,i.update))),(r.input==null&&r.element?VCt:HCt)(i,t,r,e),i.active||(e.on(e._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(e.signal(r.signal))}),i.active=!0),i}function VCt(e,t,n,r){const i=n.event||"input",s=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,s),u1e(r,t,i,s),e.set=o=>{t.value=o,t.dispatchEvent(GCt(i))}}function GCt(e){return typeof Event<"u"?new Event(e):{type:e}}function HCt(e,t,n,r){const i=r.signal(n.signal),s=Ys("div",{class:zCt}),o=n.input==="radio"?s:s.appendChild(Ys("label"));o.appendChild(Ys("span",{class:jCt},n.name||n.signal)),t.appendChild(s);let a=qCt;switch(n.input){case"checkbox":a=XCt;break;case"select":a=YCt;break;case"radio":a=KCt;break;case"range":a=ZCt;break}a(e,o,n,i)}function qCt(e,t,n,r){const i=Ys("input");for(const s in n)s!=="signal"&&s!=="element"&&i.setAttribute(s==="input"?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=s=>i.value=s}function XCt(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=Ys("input",i);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=o=>s.checked=!!o||null}function YCt(e,t,n,r){const i=Ys("select",{name:n.signal}),s=n.labels||[];n.options.forEach((o,a)=>{const u={value:o};PE(o,r)&&(u.selected=!0),i.appendChild(Ys("option",u,(s[a]||o)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=o=>{for(let a=0,u=n.options.length;a<u;++a)if(PE(n.options[a],o)){i.selectedIndex=a;return}}}function KCt(e,t,n,r){const i=Ys("span",{class:UCt}),s=n.labels||[];t.appendChild(i),e.elements=n.options.map((o,a)=>{const u={type:"radio",name:n.signal,value:o};PE(o,r)&&(u.checked=!0);const l=Ys("input",u);l.addEventListener("change",()=>e.update(o));const c=Ys("label",{},(s[a]||o)+"");return c.prepend(l),i.appendChild(c),l}),e.set=o=>{const a=e.elements,u=a.length;for(let l=0;l<u;++l)PE(a[l].value,o)&&(a[l].checked=!0)}}function ZCt(e,t,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,o=n.step||Uf(s,i,100),a=Ys("input",{type:"range",name:n.signal,min:s,max:i,step:o});a.value=r;const u=Ys("span",{},+r);t.appendChild(a),t.appendChild(u);const l=()=>{u.textContent=a.value,e.update(+a.value)};a.addEventListener("input",l),a.addEventListener("change",l),e.elements=[a],e.set=c=>{a.value=c,u.textContent=c}}function PE(e,t){return e===t||e+""==t+""}function l1e(e,t,n,r,i,s){return t=t||new r(e.loader()),t.initialize(n,o1e(e),a1e(e),kF(e),i,s).background(e.background())}function Dj(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function JCt(e,t,n,r){const i=new r(e.loader(),Dj(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,kF(e),e);return t&&t.handlers().forEach(s=>{i.on(s.type,s.handler)}),i}function QCt(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,s=rF(r);e=n._el=e?V3(n,e,!0):null,SCt(n),s||n.error("Unrecognized renderer type: "+r);const o=s.handler||_C,a=e?s.renderer:s.headless;return n._renderer=a?l1e(n,n._renderer,e,a):null,n._handler=JCt(n,n._handler,e,o),n._redraw=!0,e&&i!=="none"&&(t=t?n._elBind=V3(n,t,!0):e.appendChild(Ys("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&i!=="container"&&(u.element=V3(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{WCt(n,u.element||t,u)})),n}function V3(e,t,n){if(typeof t=="string")if(typeof document<"u"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.innerHTML=""}catch(r){t=null,e.error(r)}return t}const sb=e=>+e||0,eSt=e=>({top:e,bottom:e,left:e,right:e});function nZ(e){return wt(e)?{top:sb(e.top),bottom:sb(e.bottom),left:sb(e.left),right:sb(e.right)}:eSt(sb(e))}async function Ij(e,t,n,r){const i=rF(t),s=i&&i.headless;return s||ye("Unrecognized renderer type: "+t),await e.runAsync(),l1e(e,null,null,s,n,r).renderAsync(e._scenegraph.root)}async function tSt(e,t){e!==of.Canvas&&e!==of.SVG&&e!==of.PNG&&ye("Unrecognized image type: "+e);const n=await Ij(this,e,t);return e===of.SVG?nSt(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function nSt(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function rSt(e,t){return(await Ij(this,of.Canvas,e,t)).canvas()}async function iSt(e){return(await Ij(this,of.SVG,e)).svg()}function sSt(e,t,n){return r1e(e,Xm,Ux,n).parse(t)}function oSt(e){var t=this._runtime.scales;return lt(t,e)||ye("Unrecognized scale or projection: "+e),t[e].value}var c1e="width",f1e="height",Fj="padding",rZ={skip:!0};function h1e(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===Fj?r.left+r.right:0)}function d1e(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===Fj?r.top+r.bottom:0)}function aSt(e){var t=e._signals,n=t[c1e],r=t[f1e],i=t[Fj];function s(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,a=>{e._width=a.size,e._viewWidth=h1e(e,a.size),s()},{size:n}),e._resizeHeight=e.add(null,a=>{e._height=a.size,e._viewHeight=d1e(e,a.size),s()},{size:r});const o=e.add(null,s,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}function uSt(e,t,n,r,i,s){this.runAfter(o=>{let a=0;o._autosize=0,o.width()!==n&&(a=1,o.signal(c1e,n,rZ),o._resizeWidth.skip(!0)),o.height()!==r&&(a=1,o.signal(f1e,r,rZ),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==i[0]||o._origin[1]!==i[1])&&(o._resize=1,o._origin=i),a&&o.run("enter"),s&&o.runAfter(u=>u.resize())},!1,1)}function lSt(e){return this._runtime.getState(e||{data:cSt,signals:fSt,recurse:!0})}function cSt(e,t){return t.modified&&ht(t.input.value)&&e.indexOf("_:vega:_")}function fSt(e,t){return!(e==="parent"||t instanceof Xm.proxy)}function hSt(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function dSt(e,t){function n(r){e({timestamp:Date.now(),elapsed:r})}this._timers.push(Jht(n,t))}function pSt(e,t,n,r){const i=e.element();i&&i.setAttribute("title",gSt(r))}function gSt(e){return e==null?"":ht(e)?p1e(e):wt(e)&&!PD(e)?mSt(e):e+""}function mSt(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(ht(n)?p1e(n):g1e(n))}).join(`
`)}function p1e(e){return"["+e.map(g1e).join(", ")+"]"}function g1e(e){return ht(e)?"[]":wt(e)&&!PD(e)?"{}":e}function m1e(e,t){const n=this;if(t=t||{},Sm.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=St({},e.locale,t.locale);n.locale(Fge(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||of.Canvas,n._scenegraph=new b9;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||pSt,n._redraw=!0,n._handler=new _C().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=MCt(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=sSt(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:St({},s)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=h1e(n,n._width),n._viewHeight=d1e(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,aSt(n),_Ct(n),$Ct(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function d_(e,t){return lt(e._signals,t)?e._signals[t]:ye("Unrecognized signal name: "+Qe(t))}function y1e(e,t){const n=(e._targets||[]).filter(r=>r._update&&r._update.handler===t);return n.length?n[0]:null}function iZ(e,t,n,r){let i=y1e(n,r);return i||(i=Dj(e,()=>r(t,n.value)),i.handler=r,e.on(n,null,i)),e}function sZ(e,t,n){const r=y1e(t,n);return r&&t._targets.remove(r),e}$e(m1e,Sm,{async evaluate(e,t,n){if(await Sm.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,TCt(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&N_(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&s1e(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=d_(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",nZ(e)):nZ(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(rF(e)||ye("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Sm.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(d_(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:uSt,addEventListener(e,t,n){let r=t;return n&&n.trap===!1||(r=Dj(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),r=n.length,i,s;--r>=0;)if(s=n[r].type,i=n[r].handler,e===s&&(t===i||t===i.raw)){this._handler.off(s,i);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return iZ(this,e,d_(this,e),t)},removeSignalListener(e,t){return sZ(this,d_(this,e),t)},addDataListener(e,t){return iZ(this,e,RE(this,e).values,t)},removeDataListener(e,t){return sZ(this,RE(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=AL(this,null);this._globalCursor=!!e,t&&AL(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:dSt,events:PCt,finalize:BCt,hover:LCt,data:kCt,change:$F,insert:ECt,remove:ACt,scale:oSt,initialize:QCt,toImageURL:tSt,toCanvas:rSt,toSVG:iSt,getState:lSt,setState:hSt});const ySt="view",LE="[",BE="]",b1e="{",v1e="}",bSt=":",x1e=",",vSt="@",xSt=">",wSt=/[[\]{}]/,CSt={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let w1e,C1e;function SSt(e,t,n){return w1e=t||ySt,C1e=n||CSt,S1e(e.trim()).map(TL)}function _St(e){return C1e[e]}function pv(e,t,n,r,i){const s=e.length;let o=0,a;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function S1e(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=pv(e,i,x1e,LE+b1e,BE+v1e),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function TL(e){return e[0]==="["?$St(e):kSt(e)}function $St(e){const t=e.length;let n=1,r;if(n=pv(e,n,BE,LE,BE),n===t)throw"Empty between selector: "+e;if(r=S1e(e.substring(1,n)),r.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==xSt)throw"Expected '>' after between selector: "+e;r=r.map(TL);const i=TL(e.slice(1).trim());return i.between?{between:r,stream:i}:(i.between=r,i)}function kSt(e){const t={source:w1e},n=[];let r=[0,0],i=0,s=0,o=e.length,a=0,u,l;if(e[o-1]===v1e){if(a=e.lastIndexOf(b1e),a>=0){try{r=ESt(e.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),o=e.length}else throw"Unmatched right brace: "+e;a=0}if(!o)throw e;if(e[0]===vSt&&(i=++a),u=pv(e,a,bSt),u<o&&(n.push(e.substring(s,u).trim()),s=a=++u),a=pv(e,a,LE),a===o)n.push(e.substring(s,o).trim());else if(n.push(e.substring(s,a).trim()),l=[],s=++a,s===o)throw"Unmatched left bracket: "+e;for(;a<o;){if(a=pv(e,a,BE),a===o)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,a).trim()),a<o-1&&e[++a]!==LE)throw"Expected left bracket: "+e;s=++a}if(!(o=n.length)||wSt.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],i?t.markname=n[0].slice(1):_St(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),r[0]&&(t.throttle=r[0]),r[1]&&(t.debounce=r[1]),t}function ESt(e){const t=e.split(x1e);if(!e.length||t.length>2)throw e;return t.map(n=>{const r=+n;if(r!==r)throw e;return r})}function ASt(e){return wt(e)?e:{type:e||"pad"}}const ob=e=>+e||0,TSt=e=>({top:e,bottom:e,left:e,right:e});function DSt(e){return wt(e)?e.signal?e:{top:ob(e.top),bottom:ob(e.bottom),left:ob(e.left),right:ob(e.right)}:TSt(ob(e))}const Ar=e=>wt(e)&&!ht(e)?St({},e):{value:e};function oZ(e,t,n,r){return n!=null?(wt(n)&&!ht(n)||ht(n)&&n.length&&wt(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function Jr(e,t,n){for(const r in t)oZ(e,r,t[r]);for(const r in n)oZ(e,r,n[r],"update")}function py(e,t,n){for(const r in t)n&&lt(n,r)||(e[r]=St(e[r]||{},t[r]));return e}function am(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const Oj="mark",Nj="frame",Mj="scope",ISt="axis",FSt="axis-domain",OSt="axis-grid",NSt="axis-label",MSt="axis-tick",RSt="axis-title",PSt="legend",LSt="legend-band",BSt="legend-entry",zSt="legend-gradient",_1e="legend-label",jSt="legend-symbol",USt="legend-title",WSt="title",VSt="title-text",GSt="title-subtitle";function HSt(e,t,n,r,i){const s={},o={};let a,u,l,c;u="lineBreak",t==="text"&&i[u]!=null&&!am(u,e)&&G3(s,u,i[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===Nj?i.group:n===Oj?St({},i.mark,i[t]):null;for(u in c)l=am(u,e)||(u==="fill"||u==="stroke")&&(am("fill",e)||am("stroke",e)),l||G3(s,u,c[u]);at(r).forEach(f=>{const h=i.style&&i.style[f];for(const d in h)am(d,e)||G3(s,d,h[d])}),e=St({},e);for(u in s)c=s[u],c.signal?(a=a||{})[u]=c:o[u]=c;return e.enter=St(o,e.enter),a&&(e.update=St(a,e.update)),e}function G3(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const $1e=e=>wn(e)?Qe(e):e.signal?`(${e.signal})`:k1e(e);function EF(e){if(e.gradient!=null)return XSt(e);let t=e.signal?`(${e.signal})`:e.color?qSt(e.color):e.field!=null?k1e(e.field):e.value!==void 0?Qe(e.value):void 0;return e.scale!=null&&(t=YSt(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${i$(e.exponent)})`),e.mult!=null&&(t+=`*${i$(e.mult)}`),e.offset!=null&&(t+=`+${i$(e.offset)}`),e.round&&(t=`round(${t})`),t}const p_=(e,t,n,r)=>`(${e}(${[t,n,r].map(EF).join(",")})+'')`;function qSt(e){return e.c?p_("hcl",e.h,e.c,e.l):e.h||e.s?p_("hsl",e.h,e.s,e.l):e.l||e.a?p_("lab",e.l,e.a,e.b):e.r||e.g||e.b?p_("rgb",e.r,e.g,e.b):null}function XSt(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:Qe(n));for(;t.length&&en(t)==null;)t.pop();return t.unshift($1e(e.gradient)),`gradient(${t.join(",")})`}function i$(e){return wt(e)?"("+EF(e)+")":e}function k1e(e){return E1e(wt(e)?e:{datum:e})}function E1e(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):ye("Invalid field reference: "+Qe(e));return e.signal||(r=wn(r)?ID(r).map(Qe).join("]["):E1e(r)),t+"["+r+"]"}function YSt(e,t){const n=$1e(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band==1?"":"*"+i$(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function KSt(e){let t="";return e.forEach(n=>{const r=EF(n);t+=n.test?`(${n.test})?${r}:`:r}),en(t)===":"&&(t+="null"),t}function A1e(e,t,n,r,i,s){const o={};s=s||{},s.encoders={$encode:o},e=HSt(e,t,n,r,i.config);for(const a in e)o[a]=ZSt(e[a],t,s,i);return s}function ZSt(e,t,n,r){const i={},s={};for(const o in e)e[o]!=null&&(i[o]=QSt(JSt(e[o]),r,n,s));return{$expr:{marktype:t,channels:i},$fields:Object.keys(s),$output:Object.keys(e)}}function JSt(e){return ht(e)?KSt(e):EF(e)}function QSt(e,t,n,r){const i=zu(e,t);return i.$fields.forEach(s=>r[s]=1),St(n,i.$params),i.$expr}const e_t="outer",t_t=["value","update","init","react","bind"];function aZ(e,t){ye(e+' for "outer" push: '+Qe(t))}function T1e(e,t){const n=e.name;if(e.push===e_t)t.signals[n]||aZ("No prior signal definition",n),t_t.forEach(r=>{e[r]!==void 0&&aZ("Invalid property ",r)});else{const r=t.addSignal(n,e.value);e.react===!1&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function DL(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function AF(e,t,n,r){return new DL(e,t,n,r)}function zE(e,t){return AF("operator",e,t)}function We(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Vx(e,t){return t?{$field:e,$name:t}:{$field:e}}const IL=Vx("key");function uZ(e,t){return{$compare:e,$order:t}}function n_t(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const r_t="ascending",i_t="descending";function s_t(e){return wt(e)?(e.order===i_t?"-":"+")+TF(e.op,e.field):""}function TF(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const Rj="scope",FL="view";function dr(e){return e&&e.signal}function o_t(e){return e&&e.expr}function s$(e){if(dr(e))return!0;if(wt(e)){for(const t in e)if(s$(e[t]))return!0}return!1}function sa(e,t){return e??t}function tp(e){return e&&e.signal||e}const lZ="timer";function Gx(e,t){return(e.merge?u_t:e.stream?l_t:e.type?c_t:ye("Invalid stream specification: "+Qe(e)))(e,t)}function a_t(e){return e===Rj?FL:e||FL}function u_t(e,t){const n=e.merge.map(i=>Gx(i,t)),r=Pj({merge:n},e,t);return t.addStream(r).id}function l_t(e,t){const n=Gx(e.stream,t),r=Pj({stream:n},e,t);return t.addStream(r).id}function c_t(e,t){let n;e.type===lZ?(n=t.event(lZ,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(a_t(e.source),e.type);const r=Pj({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function Pj(e,t,n){let r=t.between;return r&&(r.length!==2&&ye('Stream "between" parameter must have 2 entries: '+Qe(t)),e.between=[Gx(r[0],n),Gx(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(f_t(t.marktype,t.markname,t.markrole)),t.source===Rj&&r.push("inScope(event.item)"),r.length&&(e.filter=zu("("+r.join(")&&(")+")",n).$expr),(r=t.throttle)!=null&&(e.throttle=+r),(r=t.debounce)!=null&&(e.debounce=+r),t.consume&&(e.consume=!0),e}function f_t(e,t,n){const r="event.item";return r+(e&&e!=="*"?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}const h_t={code:"_.$value",ast:{type:"Identifier",value:"value"}};function d_t(e,t,n){const r=e.encode,i={target:n};let s=e.events,o=e.update,a=[];s||ye("Signal update missing events specification."),wn(s)&&(s=SSt(s,t.isSubscope()?Rj:FL)),s=at(s).filter(u=>u.signal||u.scale?(a.push(u),0):1),a.length>1&&(a=[g_t(a)]),s.length&&a.push(s.length>1?{merge:s}:s[0]),r!=null&&(o&&ye("Signal encode and update are mutually exclusive."),o="encode(item(),"+Qe(r)+")"),i.update=wn(o)?zu(o,t):o.expr!=null?zu(o.expr,t):o.value!=null?o.value:o.signal!=null?{$expr:h_t,$params:{$value:t.signalRef(o.signal)}}:ye("Invalid signal update specification."),e.force&&(i.options={force:!0}),a.forEach(u=>t.addUpdate(St(p_t(u,t),i)))}function p_t(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Gx(e,t)}}function g_t(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function m_t(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?ye("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=zu(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach(i=>d_t(i,t,n.id))}const tn=e=>(t,n,r)=>AF(e,n,t||void 0,r),D1e=tn("aggregate"),y_t=tn("axisticks"),I1e=tn("bound"),za=tn("collect"),cZ=tn("compare"),b_t=tn("datajoin"),F1e=tn("encode"),v_t=tn("expression"),x_t=tn("facet"),w_t=tn("field"),C_t=tn("key"),S_t=tn("legendentries"),__t=tn("load"),$_t=tn("mark"),k_t=tn("multiextent"),E_t=tn("multivalues"),A_t=tn("overlap"),T_t=tn("params"),O1e=tn("prefacet"),D_t=tn("projection"),I_t=tn("proxy"),F_t=tn("relay"),N1e=tn("render"),O_t=tn("scale"),Eg=tn("sieve"),N_t=tn("sortitems"),M1e=tn("viewlayout"),M_t=tn("values");let R_t=0;const R1e={min:"min",max:"max",count:"sum"};function P_t(e,t){const n=e.type||"linear";bde(n)||ye("Unrecognized scale type: "+Qe(n)),t.addScale(e.name,{type:n,domain:void 0})}function L_t(e,t){const n=t.getScale(e.name).params;let r;n.domain=P1e(e.domain,e,t),e.range!=null&&(n.range=B1e(e,t,n)),e.interpolate!=null&&X_t(e.interpolate,n),e.nice!=null&&(n.nice=q_t(e.nice)),e.bins!=null&&(n.bins=H_t(e.bins,t));for(r in e)lt(n,r)||r==="name"||(n[r]=ko(e[r],t))}function ko(e,t){return wt(e)?e.signal?t.signalRef(e.signal):ye("Unsupported object: "+Qe(e)):e}function o$(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>ko(n,t))}function DF(e){ye("Can not find data set: "+Qe(e))}function P1e(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&ye("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(ht(e)?B_t:e.fields?j_t:z_t)(e,t,n)}function B_t(e,t,n){return e.map(r=>ko(r,n))}function z_t(e,t,n){const r=n.getData(e.data);return r||DF(e.data),c0(t.type)?r.valuesRef(n,e.field,L1e(e.sort,!1)):wde(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function j_t(e,t,n){const r=e.data,i=e.fields.reduce((s,o)=>(o=wn(o)?{data:r,field:o}:ht(o)||o.signal?U_t(o,n):o,s.push(o),s),[]);return(c0(t.type)?W_t:wde(t.type)?V_t:G_t)(e,n,i)}function U_t(e,t){const n="_:vega:_"+R_t++,r=za({});if(ht(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+Qe(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,Eg({})]),{data:n,field:"data"}}function W_t(e,t,n){const r=L1e(e.sort,!0);let i,s;const o=n.map(l=>{const c=t.getData(l.data);return c||DF(l.data),c.countsRef(t,l.field,r)}),a={groupby:IL,pulse:o};r&&(i=r.op||"count",s=r.field?TF(i,r.field):"count",a.ops=[R1e[i]],a.fields=[t.fieldRef(s)],a.as=[s]),i=t.add(D1e(a));const u=t.add(za({pulse:We(i)}));return s=t.add(M_t({field:IL,sort:t.sortRef(r),pulse:We(u)})),We(s)}function L1e(e,t){return e&&(!e.field&&!e.op?wt(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?ye("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!R1e[e.op]&&ye("Multiple domain scales can not be sorted using "+e.op)),e}function V_t(e,t,n){const r=n.map(i=>{const s=t.getData(i.data);return s||DF(i.data),s.domainRef(t,i.field)});return We(t.add(E_t({values:r})))}function G_t(e,t,n){const r=n.map(i=>{const s=t.getData(i.data);return s||DF(i.data),s.extentRef(t,i.field)});return We(t.add(k_t({extents:r})))}function H_t(e,t){return e.signal||ht(e)?o$(e,t):t.objectProperty(e)}function q_t(e){return wt(e)?{interval:ko(e.interval),step:ko(e.step)}:ko(e)}function X_t(e,t){t.interpolate=ko(e.type||e),e.gamma!=null&&(t.interpolateGamma=ko(e.gamma))}function B1e(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(wn(i)){if(r&&lt(r,i))return e=St({},e,{range:r[i]}),B1e(e,t,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=c0(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:ye("Unrecognized scale range value: "+Qe(i))}else if(i.scheme){n.scheme=ht(i.scheme)?o$(i.scheme,t):ko(i.scheme,t),i.extent&&(n.schemeExtent=o$(i.extent,t)),i.count&&(n.schemeCount=ko(i.count,t));return}else if(i.step){n.rangeStep=ko(i.step,t);return}else{if(c0(e.type)&&!ht(i))return P1e(i,e,t);ht(i)||ye("Unsupported range type: "+Qe(i))}return i.map(s=>(ht(s)?o$:ko)(s,t))}function Y_t(e,t){const n=t.config.projection||{},r={};for(const i in e)i!=="name"&&(r[i]=OL(e[i],i,t));for(const i in n)r[i]==null&&(r[i]=OL(n[i],i,t));t.addProjection(e.name,r)}function OL(e,t,n){return ht(e)?e.map(r=>OL(r,t,n)):wt(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:ye("Unsupported parameter object: "+Qe(e)):e}const ja="top",gy="left",my="right",oh="bottom",z1e="center",K_t="vertical",Z_t="start",J_t="middle",Q_t="end",NL="index",Lj="label",e$t="offset",_0="perc",t$t="perc2",Do="value",NC="guide-label",Bj="guide-title",n$t="group-title",r$t="group-subtitle",fZ="symbol",a$="gradient",ML="discrete",RL="size",i$t="shape",s$t="fill",o$t="stroke",a$t="strokeWidth",u$t="strokeDash",l$t="opacity",zj=[RL,i$t,s$t,o$t,a$t,u$t,l$t],MC={name:1,style:1,interactive:1},At={value:0},Io={value:1},IF="group",j1e="rect",jj="rule",c$t="symbol",Ag="text";function Hx(e){return e.type=IF,e.interactive=e.interactive||!1,e}function Ps(e,t){const n=(r,i)=>sa(e[r],sa(t[r],i));return n.isVertical=r=>K_t===sa(e.direction,t.direction||(r?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>sa(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>sa(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>sa(e.columns,sa(t.columns,+n.isVertical(!0))),n}function U1e(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function f$t(e,t,n){const r=t.config.style[n];return r&&r[e]}function FF(e,t,n){return`item.anchor === '${Z_t}' ? ${e} : item.anchor === '${Q_t}' ? ${t} : ${n}`}const Uj=FF(Qe(gy),Qe(my),Qe(z1e));function h$t(e){const t=e("tickBand");let n=e("tickOffset"),r,i;return t?t.signal?(r={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},i={signal:`(${t.signal}) === 'extent'`},wt(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(r=1,i=!0,n=0):(r=.5,i=!1):(r=e("bandPosition"),i=e("tickExtra")),{extra:i,band:r,offset:n}}function W1e(e,t){return t?e?wt(e)?Object.assign({},e,{offset:W1e(e.offset,t)}):{value:e,offset:t}:t:e}function ro(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=py(e.encode,t,MC)):e.interactive=!1,e}function d$t(e,t,n,r){const i=Ps(e,n),s=i.isVertical(),o=i.gradientThickness(),a=i.gradientLength();let u,l,c,f,h;s?(l=[0,1],c=[0,0],f=o,h=a):(l=[0,0],c=[1,0],f=a,h=o);const d={enter:u={opacity:At,x:At,y:At,width:Ar(f),height:Ar(h)},update:St({},u,{opacity:Io,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:At}};return Jr(d,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),ro({type:j1e,role:zSt,encode:d},r)}function p$t(e,t,n,r,i){const s=Ps(e,n),o=s.isVertical(),a=s.gradientThickness(),u=s.gradientLength();let l,c,f,h,d="";o?(l="y",f="y2",c="x",h="width",d="1-"):(l="x",f="x2",c="y",h="height");const p={opacity:At,fill:{scale:t,field:Do}};p[l]={signal:d+"datum."+_0,mult:u},p[c]=At,p[f]={signal:d+"datum."+t$t,mult:u},p[h]=Ar(a);const m={enter:p,update:St({},p,{opacity:Io}),exit:{opacity:At}};return Jr(m,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),ro({type:j1e,role:LSt,key:Do,from:i,encode:m},r)}const g$t=`datum.${_0}<=0?"${gy}":datum.${_0}>=1?"${my}":"${z1e}"`,m$t=`datum.${_0}<=0?"${oh}":datum.${_0}>=1?"${ja}":"${J_t}"`;function hZ(e,t,n,r){const i=Ps(e,t),s=i.isVertical(),o=Ar(i.gradientThickness()),a=i.gradientLength();let u=i("labelOverlap"),l,c,f,h,d="";const p={enter:l={opacity:At},update:c={opacity:Io,text:{field:Lj}},exit:{opacity:At}};return Jr(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:sa(e.labelLimit,t.gradientLabelLimit)}),s?(l.align={value:"left"},l.baseline=c.baseline={signal:m$t},f="y",h="x",d="1-"):(l.align=c.align={signal:g$t},l.baseline={value:"top"},f="x",h="y"),l[f]=c[f]={signal:d+"datum."+_0,mult:a},l[h]=c[h]=o,o.offset=sa(e.labelOffset,t.gradientLabelOffset)||0,u=u?{separation:i("labelSeparation"),method:u,order:"datum."+NL}:void 0,ro({type:Ag,role:_1e,style:NC,key:Do,from:r,encode:p,overlap:u},n)}function y$t(e,t,n,r,i){const s=Ps(e,t),o=n.entries,a=!!(o&&o.interactive),u=o?o.name:void 0,l=s("clipHeight"),c=s("symbolOffset"),f={data:"value"},h=`(${i}) ? datum.${e$t} : datum.${RL}`,d=l?Ar(l):{field:RL},p=`datum.${NL}`,m=`max(1, ${i})`;let g,y,b,x,v;d.mult=.5,g={enter:y={opacity:At,x:{signal:h,mult:.5,offset:c},y:d},update:b={opacity:Io,x:y.x,y:y.y},exit:{opacity:At}};let w=null,C=null;e.fill||(w=t.symbolBaseFillColor,C=t.symbolBaseStrokeColor),Jr(g,{fill:s("symbolFillColor",w),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",C),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),zj.forEach(k=>{e[k]&&(b[k]=y[k]={scale:e[k],field:Do})});const S=ro({type:c$t,role:jSt,key:Do,from:f,clip:l?!0:void 0,encode:g},n.symbols),_=Ar(c);_.offset=s("labelOffset"),g={enter:y={opacity:At,x:{signal:h,offset:_},y:d},update:b={opacity:Io,text:{field:Lj},x:y.x,y:y.y},exit:{opacity:At}},Jr(g,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const $=ro({type:Ag,role:_1e,style:NC,key:Do,from:f,encode:g},n.labels);return g={enter:{noBound:{value:!l},width:At,height:l?Ar(l):At,opacity:At},exit:{opacity:At},update:b={opacity:Io,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(x=`ceil(item.mark.items.length / ${m})`,b.row.signal=`${p}%${x}`,b.column.signal=`floor(${p} / ${x})`,v={field:["row",p]}):(b.row.signal=`floor(${p} / ${m})`,b.column.signal=`${p} % ${m}`,v={field:p}),b.column.signal=`(${i})?${b.column.signal}:${p}`,r={facet:{data:r,name:"value",groupby:NL}},Hx({role:Mj,from:r,encode:py(g,o,MC),marks:[S,$],name:u,interactive:a,sort:v})}function b$t(e,t){const n=Ps(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const Wj='item.orient === "left"',Vj='item.orient === "right"',OF=`(${Wj} || ${Vj})`,v$t=`datum.vgrad && ${OF}`,x$t=FF('"top"','"bottom"','"middle"'),w$t=FF('"right"','"left"','"center"'),C$t=`datum.vgrad && ${Vj} ? (${w$t}) : (${OF} && !(datum.vgrad && ${Wj})) ? "left" : ${Uj}`,S$t=`item._anchor || (${OF} ? "middle" : "start")`,_$t=`${v$t} ? (${Wj} ? -90 : 90) : 0`,$$t=`${OF} ? (datum.vgrad ? (${Vj} ? "bottom" : "top") : ${x$t}) : "top"`;function k$t(e,t,n,r){const i=Ps(e,t),s={enter:{opacity:At},update:{opacity:Io,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:At}};return Jr(s,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:S$t},angle:{signal:_$t},align:{signal:C$t},baseline:{signal:$$t},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),ro({type:Ag,role:USt,style:Bj,from:r,encode:s},n)}function E$t(e,t){let n;return wt(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+dZ(e.path)+")":e.sphere&&(n="geoShape("+dZ(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function dZ(e){return wt(e)&&e.signal?e.signal:Qe(e)}function V1e(e){const t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===IF?Mj:t||Oj}function A$t(e){return{marktype:e.type,name:e.name||void 0,role:e.role||V1e(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function T$t(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function Gj(e,t){const n=_ue(e.type);n||ye("Unrecognized transform type: "+Qe(e.type));const r=AF(n.type.toLowerCase(),null,G1e(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function G1e(e,t,n){const r={},i=e.params.length;for(let s=0;s<i;++s){const o=e.params[s];r[o.name]=D$t(o,t,n)}return r}function D$t(e,t,n){const r=e.type,i=t[e.name];if(r==="index")return I$t(e,t,n);if(i===void 0){e.required&&ye("Missing required "+Qe(t.type)+" parameter: "+Qe(e.name));return}else{if(r==="param")return F$t(e,t,n);if(r==="projection")return n.projectionRef(t[e.name])}return e.array&&!dr(i)?i.map(s=>pZ(e,s,n)):pZ(e,i,n)}function pZ(e,t,n){const r=e.type;if(dr(t))return mZ(r)?ye("Expression references can not be signals."):H3(r)?n.fieldRef(t):yZ(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||H3(r);return i&&O$t(t)?n.exprRef(t.expr,t.as):i&&N$t(t)?Vx(t.field,t.as):mZ(r)?zu(t,n):M$t(r)?We(n.getData(t).values):H3(r)?Vx(t):yZ(r)?n.compareRef(t):t}}function I$t(e,t,n){return wn(t.from)||ye('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function F$t(e,t,n){const r=t[e.name];return e.array?(ht(r)||ye("Expected an array of sub-parameters. Instead: "+Qe(r)),r.map(i=>gZ(e,i,n))):gZ(e,r,n)}function gZ(e,t,n){const r=e.params.length;let i;for(let o=0;o<r;++o){i=e.params[o];for(const a in i.key)if(i.key[a]!==t[a]){i=null;break}if(i)break}i||ye("Unsupported parameter: "+Qe(t));const s=St(G1e(i,t,n),i.key);return We(n.add(T_t(s)))}const O$t=e=>e&&e.expr,N$t=e=>e&&e.field,M$t=e=>e==="data",mZ=e=>e==="expr",H3=e=>e==="field",yZ=e=>e==="compare";function R$t(e,t,n){let r,i,s,o,a;return e?(r=e.facet)&&(t||ye("Only group marks can be faceted."),r.field!=null?o=a=u$(r,n):(e.data?a=We(n.getData(e.data).aggregate):(s=Gj(St({type:"aggregate",groupby:at(r.groupby)},r.aggregate),n),s.params.key=n.keyRef(r.groupby),s.params.pulse=u$(r,n),o=a=We(n.add(s))),i=n.keyRef(r.groupby,!0))):o=We(n.add(za(null,[{}]))),o||(o=u$(e,n)),{key:i,pulse:o,parent:a}}function u$(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:We(t.getData(e.data).output)}function Np(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}Np.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let s=t[0],o=null,a=1;for(s&&s.type==="load"&&(s=t[1]),e.add(t[0]);a<n;++a)t[a].params.pulse=We(t[a-1]),e.add(t[a]),t[a].type==="aggregate"&&(o=t[a]);return new Np(e,s,i,r,o)};function H1e(e){return wn(e)?e:null}function bZ(e,t,n){const r=TF(n.op,n.field);let i;if(t.ops){for(let s=0,o=t.as.length;s<o;++s)if(t.as[s]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function ab(e,t,n,r,i,s,o){const a=t[n]||(t[n]={}),u=s_t(s);let l=H1e(i),c,f;if(l!=null&&(e=t.scope,l=l+(u?"|"+u:""),c=a[l]),!c){const h=s?{field:IL,pulse:t.countsRef(e,i,s)}:{field:e.fieldRef(i),pulse:We(t.output)};u&&(h.sort=e.sortRef(s)),f=e.add(AF(r,void 0,h)),o&&(t.index[i]=f),c=We(f),l!=null&&(a[l]=c)}return c}Np.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),s=H1e(t);let o,a,u;return s!=null&&(e=r.scope,o=i[s]),o?n&&n.field&&bZ(e,o.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:We(r.output)},n&&n.field&&bZ(e,u,n),a=e.add(D1e(u)),o=e.add(za({pulse:We(a)})),o={agg:a,ref:We(o)},s!=null&&(i[s]=o)),o.ref},tuplesRef(){return We(this.values)},extentRef(e,t){return ab(e,this,"extent","extent",t,!1)},domainRef(e,t){return ab(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return ab(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return ab(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return ab(e,this,"indata","tupleindex",t,!0,!0)}};function P$t(e,t,n){const r=e.from.facet,i=r.name,s=u$(r,t);let o;r.name||ye("Facet must have a name: "+Qe(r)),r.data||ye("Facet must reference a data set: "+Qe(r)),r.field?o=t.add(O1e({field:t.fieldRef(r.field),pulse:s})):r.groupby?o=t.add(x_t({key:t.keyRef(r.groupby),group:We(t.proxy(n.parent)),pulse:s})):ye("Facet must specify groupby or field: "+Qe(r));const a=t.fork(),u=a.add(za()),l=a.add(Eg({pulse:We(u)}));a.addData(i,new Np(a,u,u,l)),a.addSignal("parent",null),o.params.subflow={$subflow:a.parse(e).toRuntime()}}function L$t(e,t,n){const r=t.add(O1e({pulse:n.pulse})),i=t.fork();i.add(Eg()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}function q1e(e,t,n){const r=e.remove,i=e.insert,s=e.toggle,o=e.modify,a=e.values,u=t.add(zE()),l="if("+e.trigger+',modify("'+n+'",'+[i,r,s,o,a].map(f=>f??"null").join(",")+"),0)",c=zu(l,t);u.update=c.$expr,u.params=c.$params}function NF(e,t){const n=V1e(e),r=e.type===IF,i=e.from&&e.from.facet,s=e.overlap;let o=e.layout||n===Mj||n===Nj,a,u,l,c,f,h,d;const p=n===Oj||o||i,m=R$t(e.from,r,t);u=t.add(b_t({key:m.key||(e.key?Vx(e.key):void 0),pulse:m.pulse,clean:!r}));const g=We(u);u=l=t.add(za({pulse:g})),u=t.add($_t({markdef:A$t(e),interactive:T$t(e.interactive,t),clip:E$t(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:We(u)}));const y=We(u);u=c=t.add(F1e(A1e(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(C=>{const S=Gj(C,t),_=S.metadata;(_.generates||_.changes)&&ye("Mark transforms should not generate new data."),_.nomod||(c.params.mod=!0),S.params.pulse=We(u),t.add(u=S)}),e.sort&&(u=t.add(N_t({sort:t.compareRef(e.sort),pulse:We(u)})));const b=We(u);(i||o)&&(o=t.add(M1e({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),h=We(o));const x=t.add(I1e({mark:y,pulse:h||b}));d=We(x),r&&(p&&(a=t.operators,a.pop(),o&&a.pop()),t.pushState(b,h||d,g),i?P$t(e,t,m):p?L$t(e,t,m):t.parse(e),t.popState(),p&&(o&&a.push(o),a.push(x))),s&&(d=B$t(s,d,t));const v=t.add(N1e({pulse:d})),w=t.add(Eg({pulse:We(v)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new Np(t,l,v,w)),e.on&&e.on.forEach(C=>{(C.insert||C.remove||C.toggle)&&ye("Marks only support modify triggers."),q1e(C,t,f)}))}function B$t(e,t,n){const r=e.method,i=e.bound,s=e.separation,o={separation:dr(s)?n.signalRef(s.signal):s,method:dr(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),i){const a=i.tolerance;o.boundTolerance=dr(a)?n.signalRef(a.signal):+a,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return We(n.add(A_t(o)))}function z$t(e,t){const n=t.config.legend,r=e.encode||{},i=Ps(e,n),s=r.legend||{},o=s.name||void 0,a=s.interactive,u=s.style,l={};let c=0,f,h,d;zj.forEach(x=>e[x]?(l[x]=e[x],c=c||e[x]):0),c||ye("Missing valid scale for legend.");const p=j$t(e,t.scaleType(c)),m={title:e.title!=null,scales:l,type:p,vgrad:p!=="symbol"&&i.isVertical()},g=We(t.add(za(null,[m]))),y={enter:{x:{value:0},y:{value:0}}},b=We(t.add(S_t(h={type:p,scale:t.scaleRef(c),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===a$?(d=[d$t(e,c,n,r.gradient),hZ(e,n,r.labels,b)],h.count=h.count||t.signalRef(`max(2,2*floor((${tp(i.gradientLength())})/100))`)):p===ML?d=[p$t(e,c,n,r.gradient,b),hZ(e,n,r.labels,b)]:(f=b$t(e,n),d=[y$t(e,n,r,b,tp(f.columns))],h.size=V$t(e,t,d[0].marks)),d=[Hx({role:BSt,from:g,encode:y,marks:d,layout:f,interactive:a})],m.title&&d.push(k$t(e,n,r.title,g)),NF(Hx({role:PSt,from:g,encode:py(W$t(i,e,n),s,MC),marks:d,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:a,style:u}),t)}function j$t(e,t){let n=e.type||fZ;return!e.type&&U$t(e)===1&&(e.fill||e.stroke)&&(n=r7(t)?a$:fP(t)?ML:fZ),n!==a$?n:fP(t)?ML:a$}function U$t(e){return zj.reduce((t,n)=>t+(e[n]?1:0),0)}function W$t(e,t,n){const r={enter:{},update:{}};return Jr(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function V$t(e,t,n){const r=tp(vZ("size",e,n)),i=tp(vZ("strokeWidth",e,n)),s=tp(G$t(n[1].encode,t,NC));return zu(`max(ceil(sqrt(${r})+${i}),${s})`,t)}function vZ(e,t,n){return t[e]?`scale("${t[e]}",datum)`:U1e(e,n[0].encode)}function G$t(e,t,n){return U1e("fontSize",e)||f$t("fontSize",t,n)}const H$t=`item.orient==="${gy}"?-90:item.orient==="${my}"?90:0`;function q$t(e,t){e=wn(e)?{text:e}:e;const n=Ps(e,t.config.title),r=e.encode||{},i=r.group||{},s=i.name||void 0,o=i.interactive,a=i.style,u=[],l={},c=We(t.add(za(null,[l])));return u.push(K$t(e,n,X$t(e),c)),e.subtitle&&u.push(Z$t(e,n,r.subtitle,c)),NF(Hx({role:WSt,from:c,encode:Y$t(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:o,style:a}),t)}function X$t(e){const t=e.encode;return t&&t.title||St({name:e.name,interactive:e.interactive,style:e.style},t)}function Y$t(e,t){const n={enter:{},update:{}};return Jr(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:Uj},angle:{signal:H$t},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),py(n,t,MC)}function K$t(e,t,n,r){const i={value:0},s=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Jr(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),ro({type:Ag,role:VSt,style:n$t,from:r,encode:o},n)}function Z$t(e,t,n,r){const i={value:0},s=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Jr(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),ro({type:Ag,role:GSt,style:r$t,from:r,encode:o},n)}function J$t(e,t){const n=[];e.transform&&e.transform.forEach(r=>{n.push(Gj(r,t))}),e.on&&e.on.forEach(r=>{q1e(r,t,e.name)}),t.addDataPipeline(e.name,Q$t(e,t,n))}function Q$t(e,t,n){const r=[];let i=null,s=!1,o=!1,a,u,l,c,f;for(e.values?dr(e.values)||s$(e.format)?(r.push(xZ(t,e)),r.push(i=Jh())):r.push(i=Jh({$ingest:e.values,$format:e.format})):e.url?s$(e.url)||s$(e.format)?(r.push(xZ(t,e)),r.push(i=Jh())):r.push(i=Jh({$request:e.url,$format:e.format})):e.source&&(i=a=at(e.source).map(h=>We(t.getData(h).output)),r.push(null)),u=0,l=n.length;u<l;++u)c=n[u],f=c.metadata,!i&&!f.source&&r.push(i=Jh()),r.push(c),f.generates&&(o=!0),f.modifies&&!o&&(s=!0),f.source?i=c:f.changes&&(i=null);return a&&(l=a.length-1,r[0]=F_t({derive:s,pulse:l?a:a[0]}),(s||l)&&r.splice(1,0,Jh())),i||r.push(Jh()),r.push(Eg({})),r}function Jh(e){const t=za({},e);return t.metadata={source:!0},t}function xZ(e,t){return __t({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const X1e=e=>e===oh||e===ja,MF=(e,t,n)=>dr(e)?rkt(e.signal,t,n):e===gy||e===ja?t:n,Tr=(e,t,n)=>dr(e)?tkt(e.signal,t,n):X1e(e)?t:n,Ca=(e,t,n)=>dr(e)?nkt(e.signal,t,n):X1e(e)?n:t,Y1e=(e,t,n)=>dr(e)?ikt(e.signal,t,n):e===ja?{value:t}:{value:n},ekt=(e,t,n)=>dr(e)?skt(e.signal,t,n):e===my?{value:t}:{value:n},tkt=(e,t,n)=>K1e(`${e} === '${ja}' || ${e} === '${oh}'`,t,n),nkt=(e,t,n)=>K1e(`${e} !== '${ja}' && ${e} !== '${oh}'`,t,n),rkt=(e,t,n)=>Hj(`${e} === '${gy}' || ${e} === '${ja}'`,t,n),ikt=(e,t,n)=>Hj(`${e} === '${ja}'`,t,n),skt=(e,t,n)=>Hj(`${e} === '${my}'`,t,n),K1e=(e,t,n)=>(t=t!=null?Ar(t):t,n=n!=null?Ar(n):n,wZ(t)&&wZ(n)?(t=t?t.signal||Qe(t.value):null,n=n?n.signal||Qe(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[St({test:e},t)].concat(n||[])),wZ=e=>e==null||Object.keys(e).length===1,Hj=(e,t,n)=>({signal:`${e} ? (${gm(t)}) : (${gm(n)})`}),okt=(e,t,n,r,i)=>({signal:(r!=null?`${e} === '${gy}' ? (${gm(r)}) : `:"")+(n!=null?`${e} === '${oh}' ? (${gm(n)}) : `:"")+(i!=null?`${e} === '${my}' ? (${gm(i)}) : `:"")+(t!=null?`${e} === '${ja}' ? (${gm(t)}) : `:"")+"(null)"}),gm=e=>dr(e)?e.signal:e==null?null:Qe(e),akt=(e,t)=>t===0?0:dr(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Am=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function tm(e,t,n,r){let i;if(t&&lt(t,e))return t[e];if(lt(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[Bj][i]}else if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[NC][i]}return null}function CZ(e){const t={};for(const n of e)if(n)for(const r in n)t[r]=1;return Object.keys(t)}function ukt(e,t){var n=t.config,r=n.style,i=n.axis,s=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,a,u,l;if(dr(o)){const f=CZ([n.axisX,n.axisY]),h=CZ([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);a={};for(l of f)a[l]=Tr(o,tm(l,n.axisX,i,r),tm(l,n.axisY,i,r));u={};for(l of h)u[l]=okt(o.signal,tm(l,n.axisTop,i,r),tm(l,n.axisBottom,i,r),tm(l,n.axisLeft,i,r),tm(l,n.axisRight,i,r))}else a=o===ja||o===oh?n.axisX:n.axisY,u=n["axis"+o[0].toUpperCase()+o.slice(1)];return a||u||s?St({},i,a,u,s):i}function lkt(e,t,n,r){const i=Ps(e,t),s=e.orient;let o,a;const u={enter:o={opacity:At},update:a={opacity:Io},exit:{opacity:At}};Jr(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const l=SZ(e,0),c=SZ(e,1);return o.x=a.x=Tr(s,l,At),o.x2=a.x2=Tr(s,c),o.y=a.y=Ca(s,l,At),o.y2=a.y2=Ca(s,c),ro({type:jj,role:FSt,from:r,encode:u},n)}function SZ(e,t){return{scale:e.scale,range:t}}function ckt(e,t,n,r,i){const s=Ps(e,t),o=e.orient,a=e.gridScale,u=MF(o,1,-1),l=fkt(e.offset,u);let c,f,h;const d={enter:c={opacity:At},update:h={opacity:Io},exit:f={opacity:At}};Jr(d,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const p={scale:e.scale,field:Do,band:i.band,extra:i.extra,offset:i.offset,round:s("tickRound")},m=Tr(o,{signal:"height"},{signal:"width"}),g=a?{scale:a,range:0,mult:u,offset:l}:{value:0,offset:l},y=a?{scale:a,range:1,mult:u,offset:l}:St(m,{mult:u,offset:l});return c.x=h.x=Tr(o,p,g),c.y=h.y=Ca(o,p,g),c.x2=h.x2=Ca(o,y),c.y2=h.y2=Tr(o,y),f.x=Tr(o,p),f.y=Ca(o,p),ro({type:jj,role:OSt,key:Do,from:r,encode:d},n)}function fkt(e,t){if(t!==1)if(!wt(e))e=dr(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=St({},e);for(;n.mult!=null;)if(wt(n.mult))n=n.mult=St({},n.mult);else return n.mult=dr(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function hkt(e,t,n,r,i,s){const o=Ps(e,t),a=e.orient,u=MF(a,-1,1);let l,c,f;const h={enter:l={opacity:At},update:f={opacity:Io},exit:c={opacity:At}};Jr(h,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const d=Ar(i);d.mult=u;const p={scale:e.scale,field:Do,band:s.band,extra:s.extra,offset:s.offset,round:o("tickRound")};return f.y=l.y=Tr(a,At,p),f.y2=l.y2=Tr(a,d),c.x=Tr(a,p),f.x=l.x=Ca(a,At,p),f.x2=l.x2=Ca(a,d),c.y=Ca(a,p),ro({type:jj,role:MSt,key:Do,from:r,encode:h},n)}function q3(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function dkt(e,t,n,r,i,s){const o=Ps(e,t),a=e.orient,u=e.scale,l=MF(a,-1,1),c=tp(o("labelFlush")),f=tp(o("labelFlushOffset")),h=o("labelAlign"),d=o("labelBaseline");let p=c===0||!!c,m;const g=Ar(i);g.mult=l,g.offset=Ar(o("labelPadding")||0),g.offset.mult=l;const y={scale:u,field:Do,band:.5,offset:W1e(s.offset,o("labelOffset"))},b=Tr(a,p?q3(u,c,'"left"','"right"','"center"'):{value:"center"},ekt(a,"left","right")),x=Tr(a,Y1e(a,"bottom","top"),p?q3(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),v=q3(u,c,`-(${f})`,f,0);p=p&&f;const w={opacity:At,x:Tr(a,y,g),y:Ca(a,y,g)},C={enter:w,update:m={opacity:Io,text:{field:Lj},x:w.x,y:w.y,align:b,baseline:x},exit:{opacity:At,x:w.x,y:w.y}};Jr(C,{dx:!h&&p?Tr(a,v):null,dy:!d&&p?Ca(a,v):null}),Jr(C,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:d});const S=o("labelBound");let _=o("labelOverlap");return _=_||S?{separation:o("labelSeparation"),method:_,order:"datum.index",bound:S?{scale:u,orient:a,tolerance:S}:null}:void 0,m.align!==b&&(m.align=Am(m.align,b)),m.baseline!==x&&(m.baseline=Am(m.baseline,x)),ro({type:Ag,role:NSt,style:NC,key:Do,from:r,encode:C,overlap:_},n)}function pkt(e,t,n,r){const i=Ps(e,t),s=e.orient,o=MF(s,-1,1);let a,u;const l={enter:a={opacity:At,anchor:Ar(i("titleAnchor",null)),align:{signal:Uj}},update:u=St({},a,{opacity:Io,text:Ar(e.title)}),exit:{opacity:At}},c={signal:`lerp(range("${e.scale}"), ${FF(0,1,.5)})`};return u.x=Tr(s,c),u.y=Ca(s,c),a.angle=Tr(s,At,akt(o,90)),a.baseline=Tr(s,Y1e(s,oh,ja),{value:oh}),u.angle=a.angle,u.baseline=a.baseline,Jr(l,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),gkt(i,s,l,n),l.update.align=Am(l.update.align,a.align),l.update.angle=Am(l.update.angle,a.angle),l.update.baseline=Am(l.update.baseline,a.baseline),ro({type:Ag,role:RSt,style:Bj,from:r,encode:l},n)}function gkt(e,t,n,r){const i=(a,u)=>a!=null?(n.update[u]=Am(Ar(a),n.update[u]),!1):!am(u,r),s=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===s?Ar(o):Tr(t,Ar(o),Ar(s))}function mkt(e,t){const n=ukt(e,t),r=e.encode||{},i=r.axis||{},s=i.name||void 0,o=i.interactive,a=i.style,u=Ps(e,n),l=h$t(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null},f=We(t.add(za({},[c]))),h=We(t.add(y_t({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),d=[];let p;return c.grid&&d.push(ckt(e,n,r.grid,h,l)),c.ticks&&(p=u("tickSize"),d.push(hkt(e,n,r.ticks,h,p,l))),c.labels&&(p=c.ticks?p:0,d.push(dkt(e,n,r.labels,h,p,l))),c.domain&&d.push(lkt(e,n,r.domain,f)),c.title&&d.push(pkt(e,n,r.title,f)),NF(Hx({role:ISt,from:f,encode:py(ykt(u,e),i,MC),marks:d,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:o,style:a}),t)}function ykt(e,t){const n={enter:{},update:{}};return Jr(n,{orient:e("orient"),offset:e("offset")||0,position:sa(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function Z1e(e,t,n){const r=at(e.signals),i=at(e.scales);return n||r.forEach(s=>T1e(s,t)),at(e.projections).forEach(s=>Y_t(s,t)),i.forEach(s=>P_t(s,t)),at(e.data).forEach(s=>J$t(s,t)),i.forEach(s=>L_t(s,t)),(n||r).forEach(s=>m_t(s,t)),at(e.axes).forEach(s=>mkt(s,t)),at(e.marks).forEach(s=>NF(s,t)),at(e.legends).forEach(s=>z$t(s,t)),e.title&&q$t(e.title,t),t.parseLambdas(),t}const bkt=e=>py({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function vkt(e,t){const n=t.config,r=We(t.root=t.add(zE())),i=xkt(e,n);i.forEach(l=>T1e(l,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(za()),o=t.add(F1e(A1e(bkt(e.encode),IF,Nj,e.style,t,{pulse:We(s)}))),a=t.add(M1e({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:We(o)}));t.operators.pop(),t.pushState(We(o),We(a),null),Z1e(e,t,i),t.operators.push(a);let u=t.add(I1e({mark:r,pulse:We(a)}));return u=t.add(N1e({pulse:We(u)})),u=t.add(Eg({pulse:We(u)})),t.addData("root",new Np(t,s,s,u)),t}function ub(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function xkt(e,t){const n=o=>sa(e[o],t[o]),r=[ub("background",n("background")),ub("autosize",ASt(n("autosize"))),ub("padding",DSt(n("padding"))),ub("width",n("width")||0),ub("height",n("height")||0)],i=r.reduce((o,a)=>(o[a.name]=a,o),{}),s={};return at(e.signals).forEach(o=>{lt(i,o.name)?o=St(i[o.name],o):r.push(o),s[o.name]=o}),at(t.signals).forEach(o=>{!lt(s,o.name)&&!lt(i,o.name)&&r.push(o)}),r}function J1e(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function _Z(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}J1e.prototype=_Z.prototype={parse(e){return Z1e(e,this)},fork(){return new _Z(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof DL?We(e):e;return this.add(I_t({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,i,s){let o,a;r&&(o=r.data||(r.data={}),a=o[i]||(o[i]=[]),a.push(s))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(We(this.add(Eg({pulse:e})))),this._parent.push(t),this._lookup.push(n?We(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return en(this._parent)},encode(){return en(this._encode)},lookup(){return en(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(wn(e))return Vx(e,t);e.signal||ye("Unsupported field reference: "+Qe(e));const n=e.signal;let r=this.field[n];if(!r){const i={name:this.signalRef(n)};t&&(i.as=t),this.field[n]=r=We(this.add(w_t(i)))}return r},compareRef(e){let t=!1;const n=s=>dr(s)?(t=!0,this.signalRef(s.signal)):o_t(s)?(t=!0,this.exprRef(s.expr)):s,r=at(e.field).map(n),i=at(e.order).map(n);return t?We(this.add(cZ({fields:r,orders:i}))):uZ(r,i)},keyRef(e,t){let n=!1;const r=s=>dr(s)?(n=!0,We(i[s.signal])):s,i=this.signals;return e=at(e).map(r),n?We(this.add(C_t({fields:e,flat:t}))):n_t(e,t)},sortRef(e){if(!e)return e;const t=TF(e.op,e.field),n=e.order||r_t;return n.signal?We(this.add(cZ({fields:t,orders:this.signalRef(n.signal)}))):uZ(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return lt(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&ye("Duplicate signal name: "+Qe(e));const n=t instanceof DL?t:this.add(zE(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||ye("Unrecognized signal name: "+Qe(e)),this.signals[e]},signalRef(e){return this.signals[e]?We(this.signals[e]):(lt(this.lambdas,e)||(this.lambdas[e]=this.add(zE(null))),We(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const r=e[t],i=zu(r,this),s=this.lambdas[r];s.params=i.$params,s.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!wt(e)?e:this.signalRef(e.signal||qj(e))},exprRef(e,t){const n={expr:zu(e,this)};return t&&(n.expr.$name=t),We(this.add(v_t(n)))},addBinding(e,t){this.bindings||ye("Nested signals do not support binding: "+Qe(e)),this.bindings.push(St({signal:e},t))},addScaleProj(e,t){lt(this.scales,e)&&ye("Duplicate scale or projection name: "+Qe(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,O_t(t))},addProjection(e,t){this.addScaleProj(e,D_t(t))},getScale(e){return this.scales[e]||ye("Unrecognized scale name: "+Qe(e)),this.scales[e]},scaleRef(e){return We(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return lt(this.data,e)&&ye("Duplicate data set name: "+Qe(e)),this.data[e]=t},getData(e){return this.data[e]||ye("Undefined data set name: "+Qe(e)),this.data[e]},addDataPipeline(e,t){return lt(this.data,e)&&ye("Duplicate data set name: "+Qe(e)),this.addData(e,Np.fromEntries(this,t))}};function qj(e){return(ht(e)?wkt:Ckt)(e)}function wkt(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const i=e[r];n+=(r>0?",":"")+(wt(i)?i.signal||qj(i):Qe(i))}return n+"]"}function Ckt(e){let t="{",n=0,r,i;for(r in e)i=e[r],t+=(++n>1?",":"")+Qe(r)+":"+(wt(i)?i.signal||qj(i):Qe(i));return t+"}"}function Skt(){const e="sans-serif",r="#4c78a8",i="#000",s="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:r},area:{fill:r},image:null,line:{stroke:r,strokeWidth:2},path:{stroke:r},rect:{fill:r},rule:{stroke:i},shape:{stroke:r},symbol:{fill:r,size:64},text:{fill:i,font:e,fontSize:11},trail:{fill:r,size:2},style:{"guide-label":{fill:i,font:e,fontSize:10},"guide-title":{fill:i,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:i,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:i,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:s,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:s,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:s,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function _kt(e,t,n){return wt(e)||ye("Input Vega specification must be an object."),t=FD(Skt(),t,e.config),vkt(e,new J1e(t,n)).toRuntime()}const $kt="RawCode",kkt="Literal",Ekt="Property",Akt="Identifier",Tkt="ArrayExpression",Dkt="BinaryExpression",Ikt="CallExpression",Fkt="ConditionalExpression",Okt="LogicalExpression",Nkt="MemberExpression",Mkt="ObjectExpression",Rkt="UnaryExpression";function Ua(e){this.type=e}Ua.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=Pkt(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function Pkt(e){switch(e.type){case Tkt:return e.elements;case Dkt:case Okt:return[e.left,e.right];case Ikt:return[e.callee].concat(e.arguments);case Fkt:return[e.test,e.consequent,e.alternate];case Nkt:return[e.object,e.property];case Mkt:return e.properties;case Ekt:return[e.key,e.value];case Rkt:return[e.argument];case Akt:case kkt:case $kt:default:return[]}}var sl,Le,ge,_i,Yt,RF=1,RC=2,Mp=3,Mh=4,PF=5,Tg=6,ls=7,PC=8,Lkt=9;sl={};sl[RF]="Boolean";sl[RC]="<end>";sl[Mp]="Identifier";sl[Mh]="Keyword";sl[PF]="Null";sl[Tg]="Numeric";sl[ls]="Punctuator";sl[PC]="String";sl[Lkt]="RegularExpression";var Bkt="ArrayExpression",zkt="BinaryExpression",jkt="CallExpression",Ukt="ConditionalExpression",Q1e="Identifier",Wkt="Literal",Vkt="LogicalExpression",Gkt="MemberExpression",Hkt="ObjectExpression",qkt="Property",Xkt="UnaryExpression",Dr="Unexpected token %0",Ykt="Unexpected number",Kkt="Unexpected string",Zkt="Unexpected identifier",Jkt="Unexpected reserved word",Qkt="Unexpected end of input",PL="Invalid regular expression",X3="Invalid regular expression: missing /",eye="Octal literals are not allowed in strict mode.",eEt="Duplicate data property in object literal not allowed in strict mode",qr="ILLEGAL",qx="Disabled.",tEt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),nEt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function LF(e,t){if(!e)throw new Error("ASSERT: "+t)}function kl(e){return e>=48&&e<=57}function Xj(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function gv(e){return"01234567".indexOf(e)>=0}function rEt(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Xx(e){return e===10||e===13||e===8232||e===8233}function LC(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&tEt.test(String.fromCharCode(e))}function jE(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&nEt.test(String.fromCharCode(e))}const iEt={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function tye(){for(;ge<_i;){const e=Le.charCodeAt(ge);if(rEt(e)||Xx(e))++ge;else break}}function LL(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)ge<_i&&Xj(Le[ge])?(r=Le[ge++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):Mt({},Dr,qr);return String.fromCharCode(i)}function sEt(){var e,t,n,r;for(e=Le[ge],t=0,e==="}"&&Mt({},Dr,qr);ge<_i&&(e=Le[ge++],!!Xj(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Mt({},Dr,qr),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function nye(){var e,t;for(e=Le.charCodeAt(ge++),t=String.fromCharCode(e),e===92&&(Le.charCodeAt(ge)!==117&&Mt({},Dr,qr),++ge,e=LL("u"),(!e||e==="\\"||!LC(e.charCodeAt(0)))&&Mt({},Dr,qr),t=e);ge<_i&&(e=Le.charCodeAt(ge),!!jE(e));)++ge,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Le.charCodeAt(ge)!==117&&Mt({},Dr,qr),++ge,e=LL("u"),(!e||e==="\\"||!jE(e.charCodeAt(0)))&&Mt({},Dr,qr),t+=e);return t}function oEt(){var e,t;for(e=ge++;ge<_i;){if(t=Le.charCodeAt(ge),t===92)return ge=e,nye();if(jE(t))++ge;else break}return Le.slice(e,ge)}function aEt(){var e,t,n;return e=ge,t=Le.charCodeAt(ge)===92?nye():oEt(),t.length===1?n=Mp:iEt.hasOwnProperty(t)?n=Mh:t==="null"?n=PF:t==="true"||t==="false"?n=RF:n=Mp,{type:n,value:t,start:e,end:ge}}function Y3(){var e=ge,t=Le.charCodeAt(ge),n,r=Le[ge],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ge,{type:ls,value:String.fromCharCode(t),start:e,end:ge};default:if(n=Le.charCodeAt(ge+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ge+=2,{type:ls,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:ge};case 33:case 61:return ge+=2,Le.charCodeAt(ge)===61&&++ge,{type:ls,value:Le.slice(e,ge),start:e,end:ge}}}if(o=Le.substr(ge,4),o===">>>=")return ge+=4,{type:ls,value:o,start:e,end:ge};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return ge+=3,{type:ls,value:s,start:e,end:ge};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return ge+=2,{type:ls,value:i,start:e,end:ge};if(i==="//"&&Mt({},Dr,qr),"<>=!+-*%&|^/".indexOf(r)>=0)return++ge,{type:ls,value:r,start:e,end:ge};Mt({},Dr,qr)}function uEt(e){let t="";for(;ge<_i&&Xj(Le[ge]);)t+=Le[ge++];return t.length===0&&Mt({},Dr,qr),LC(Le.charCodeAt(ge))&&Mt({},Dr,qr),{type:Tg,value:parseInt("0x"+t,16),start:e,end:ge}}function lEt(e){let t="0"+Le[ge++];for(;ge<_i&&gv(Le[ge]);)t+=Le[ge++];return(LC(Le.charCodeAt(ge))||kl(Le.charCodeAt(ge)))&&Mt({},Dr,qr),{type:Tg,value:parseInt(t,8),octal:!0,start:e,end:ge}}function $Z(){var e,t,n;if(n=Le[ge],LF(kl(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=ge,e="",n!=="."){if(e=Le[ge++],n=Le[ge],e==="0"){if(n==="x"||n==="X")return++ge,uEt(t);if(gv(n))return lEt(t);n&&kl(n.charCodeAt(0))&&Mt({},Dr,qr)}for(;kl(Le.charCodeAt(ge));)e+=Le[ge++];n=Le[ge]}if(n==="."){for(e+=Le[ge++];kl(Le.charCodeAt(ge));)e+=Le[ge++];n=Le[ge]}if(n==="e"||n==="E")if(e+=Le[ge++],n=Le[ge],(n==="+"||n==="-")&&(e+=Le[ge++]),kl(Le.charCodeAt(ge)))for(;kl(Le.charCodeAt(ge));)e+=Le[ge++];else Mt({},Dr,qr);return LC(Le.charCodeAt(ge))&&Mt({},Dr,qr),{type:Tg,value:parseFloat(e),start:t,end:ge}}function cEt(){var e="",t,n,r,i,s=!1;for(t=Le[ge],LF(t==="'"||t==='"',"String literal must starts with a quote"),n=ge,++ge;ge<_i;)if(r=Le[ge++],r===t){t="";break}else if(r==="\\")if(r=Le[ge++],!r||!Xx(r.charCodeAt(0)))switch(r){case"u":case"x":Le[ge]==="{"?(++ge,e+=sEt()):e+=LL(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:gv(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),ge<_i&&gv(Le[ge])&&(s=!0,i=i*8+"01234567".indexOf(Le[ge++]),"0123".indexOf(r)>=0&&ge<_i&&gv(Le[ge])&&(i=i*8+"01234567".indexOf(Le[ge++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&Le[ge]===`
`&&++ge;else{if(Xx(r.charCodeAt(0)))break;e+=r}return t!==""&&Mt({},Dr,qr),{type:PC,value:e,octal:s,start:n,end:ge}}function fEt(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";Mt({},PL)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{Mt({},PL)}try{return new RegExp(e,t)}catch{return null}}function hEt(){var e,t,n,r,i;for(e=Le[ge],LF(e==="/","Regular expression literal must start with a slash"),t=Le[ge++],n=!1,r=!1;ge<_i;)if(e=Le[ge++],t+=e,e==="\\")e=Le[ge++],Xx(e.charCodeAt(0))&&Mt({},X3),t+=e;else if(Xx(e.charCodeAt(0)))Mt({},X3);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||Mt({},X3),i=t.substr(1,t.length-2),{value:i,literal:t}}function dEt(){var e,t,n;for(t="",n="";ge<_i&&(e=Le[ge],!!jE(e.charCodeAt(0)));)++ge,e==="\\"&&ge<_i?Mt({},Dr,qr):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Mt({},PL,n),{value:n,literal:t}}function pEt(){var e,t,n,r;return Yt=null,tye(),e=ge,t=hEt(),n=dEt(),r=fEt(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:ge}}function gEt(e){return e.type===Mp||e.type===Mh||e.type===RF||e.type===PF}function rye(){if(tye(),ge>=_i)return{type:RC,start:ge,end:ge};const e=Le.charCodeAt(ge);return LC(e)?aEt():e===40||e===41||e===59?Y3():e===39||e===34?cEt():e===46?kl(Le.charCodeAt(ge+1))?$Z():Y3():kl(e)?$Z():Y3()}function gs(){const e=Yt;return ge=e.end,Yt=rye(),ge=e.end,e}function iye(){const e=ge;Yt=rye(),ge=e}function mEt(e){const t=new Ua(Bkt);return t.elements=e,t}function kZ(e,t,n){const r=new Ua(e==="||"||e==="&&"?Vkt:zkt);return r.operator=e,r.left=t,r.right=n,r}function yEt(e,t){const n=new Ua(jkt);return n.callee=e,n.arguments=t,n}function bEt(e,t,n){const r=new Ua(Ukt);return r.test=e,r.consequent=t,r.alternate=n,r}function Yj(e){const t=new Ua(Q1e);return t.name=e,t}function Gb(e){const t=new Ua(Wkt);return t.value=e.value,t.raw=Le.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function EZ(e,t,n){const r=new Ua(Gkt);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function vEt(e){const t=new Ua(Hkt);return t.properties=e,t}function AZ(e,t,n){const r=new Ua(qkt);return r.key=t,r.value=n,r.kind=e,r}function xEt(e,t){const n=new Ua(Xkt);return n.operator=e,n.argument=t,n.prefix=!0,n}function Mt(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,o)=>(LF(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=ge,n.description=i,n}function BF(e){e.type===RC&&Mt(e,Qkt),e.type===Tg&&Mt(e,Ykt),e.type===PC&&Mt(e,Kkt),e.type===Mp&&Mt(e,Zkt),e.type===Mh&&Mt(e,Jkt),Mt(e,Dr,e.value)}function $i(e){const t=gs();(t.type!==ls||t.value!==e)&&BF(t)}function yn(e){return Yt.type===ls&&Yt.value===e}function K3(e){return Yt.type===Mh&&Yt.value===e}function wEt(){const e=[];for(ge=Yt.start,$i("[");!yn("]");)yn(",")?(gs(),e.push(null)):(e.push(Rp()),yn("]")||$i(","));return gs(),mEt(e)}function TZ(){ge=Yt.start;const e=gs();return e.type===PC||e.type===Tg?(e.octal&&Mt(e,eye),Gb(e)):Yj(e.value)}function CEt(){var e,t,n,r;if(ge=Yt.start,e=Yt,e.type===Mp)return n=TZ(),$i(":"),r=Rp(),AZ("init",n,r);if(e.type===RC||e.type===ls)BF(e);else return t=TZ(),$i(":"),r=Rp(),AZ("init",t,r)}function SEt(){var e=[],t,n,r,i={},s=String;for(ge=Yt.start,$i("{");!yn("}");)t=CEt(),t.key.type===Q1e?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?Mt({},eEt):i[r]=!0,e.push(t),yn("}")||$i(",");return $i("}"),vEt(e)}function _Et(){$i("(");const e=Kj();return $i(")"),e}const $Et={if:1};function kEt(){var e,t,n;if(yn("("))return _Et();if(yn("["))return wEt();if(yn("{"))return SEt();if(e=Yt.type,ge=Yt.start,e===Mp||$Et[Yt.value])n=Yj(gs().value);else if(e===PC||e===Tg)Yt.octal&&Mt(Yt,eye),n=Gb(gs());else{if(e===Mh)throw new Error(qx);e===RF?(t=gs(),t.value=t.value==="true",n=Gb(t)):e===PF?(t=gs(),t.value=null,n=Gb(t)):yn("/")||yn("/=")?(n=Gb(pEt()),iye()):BF(gs())}return n}function EEt(){const e=[];if($i("("),!yn(")"))for(;ge<_i&&(e.push(Rp()),!yn(")"));)$i(",");return $i(")"),e}function AEt(){ge=Yt.start;const e=gs();return gEt(e)||BF(e),Yj(e.value)}function TEt(){return $i("."),AEt()}function DEt(){$i("[");const e=Kj();return $i("]"),e}function IEt(){var e,t,n;for(e=kEt();;)if(yn("."))n=TEt(),e=EZ(".",e,n);else if(yn("("))t=EEt(),e=yEt(e,t);else if(yn("["))n=DEt(),e=EZ("[",e,n);else break;return e}function DZ(){const e=IEt();if(Yt.type===ls&&(yn("++")||yn("--")))throw new Error(qx);return e}function l$(){var e,t;if(Yt.type!==ls&&Yt.type!==Mh)t=DZ();else{if(yn("++")||yn("--"))throw new Error(qx);if(yn("+")||yn("-")||yn("~")||yn("!"))e=gs(),t=l$(),t=xEt(e.value,t);else{if(K3("delete")||K3("void")||K3("typeof"))throw new Error(qx);t=DZ()}}return t}function IZ(e){let t=0;if(e.type!==ls&&e.type!==Mh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function FEt(){var e,t,n,r,i,s,o,a,u,l;if(e=Yt,u=l$(),r=Yt,i=IZ(r),i===0)return u;for(r.prec=i,gs(),t=[e,Yt],o=l$(),s=[u,r,o];(i=IZ(Yt))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=kZ(a,u,o),s.push(n);r=gs(),r.prec=i,s.push(r),t.push(Yt),n=l$(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=kZ(s[l-1].value,s[l-2],n),l-=2;return n}function Rp(){var e,t,n;return e=FEt(),yn("?")&&(gs(),t=Rp(),$i(":"),n=Rp(),e=bEt(e,t,n)),e}function Kj(){const e=Rp();if(yn(","))throw new Error(qx);return e}function OEt(e){Le=e,ge=0,_i=Le.length,Yt=null,iye();const t=Kj();if(Yt.type!==RC)throw new Error("Unexpect token after expression.");return t}var NEt={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function MEt(e){function t(o,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(o,a,u){return l=>t(o,l,a,u)}const r="new Date",i="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&ye("Missing arguments to clamp function."),o.length>3&&ye("Too many arguments to clamp function.");const a=o.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&ye("Missing arguments to if function."),o.length>3&&ye("Too many arguments to if function.");const a=o.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function REt(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function PEt(e){e=e||{};const t=e.allowed?nc(e.allowed):{},n=e.forbidden?nc(e.forbidden):{},r=e.constants||NEt,i=(e.functions||MEt)(f),s=e.globalvar,o=e.fieldvar,a=Ht(s)?s:p=>"".concat(s,'["').concat(p,'"]');let u={},l={},c=0;function f(p){if(wn(p))return p;const m=h[p.type];return m==null&&ye("Unsupported type: "+p.type),m(p)}const h={Literal:p=>p.raw,Identifier:p=>{const m=p.name;return c>0?m:lt(n,m)?ye("Illegal identifier: "+m):lt(r,m)?r[m]:lt(t,m)?m:(u[m]=1,a(m))},MemberExpression:p=>{const m=!p.computed,g=f(p.object);m&&(c+=1);const y=f(p.property);return g===o&&(l[REt(y)]=1),m&&(c-=1),g+(m?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&ye("Illegal callee type: "+p.callee.type);const m=p.callee.name,g=p.arguments,y=lt(i,m)&&i[m];return y||ye("Unrecognized function: "+m),Ht(y)?y(g):y+"("+g.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{c+=1;const m=f(p.key);return c-=1,m+":"+f(p.value)}};function d(p){const m={code:f(p),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},m}return d.functions=i,d.constants=r,d}const LEt="view",UE="[",WE="]",sye="{",oye="}",BEt=":",aye=",",zEt="@",jEt=">",UEt=/[[\]{}]/,WEt={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let uye,lye;function Dg(e,t,n){return uye=t||LEt,lye=n||WEt,cye(e.trim()).map(BL)}function VEt(e){return lye[e]}function mv(e,t,n,r,i){const s=e.length;let o=0,a;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function cye(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=mv(e,i,aye,UE+sye,WE+oye),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function BL(e){return e[0]==="["?GEt(e):HEt(e)}function GEt(e){const t=e.length;let n=1,r;if(n=mv(e,n,WE,UE,WE),n===t)throw"Empty between selector: "+e;if(r=cye(e.substring(1,n)),r.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==jEt)throw"Expected '>' after between selector: "+e;r=r.map(BL);const i=BL(e.slice(1).trim());return i.between?{between:r,stream:i}:(i.between=r,i)}function HEt(e){const t={source:uye},n=[];let r=[0,0],i=0,s=0,o=e.length,a=0,u,l;if(e[o-1]===oye){if(a=e.lastIndexOf(sye),a>=0){try{r=qEt(e.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),o=e.length}else throw"Unmatched right brace: "+e;a=0}if(!o)throw e;if(e[0]===zEt&&(i=++a),u=mv(e,a,BEt),u<o&&(n.push(e.substring(s,u).trim()),s=a=++u),a=mv(e,a,UE),a===o)n.push(e.substring(s,o).trim());else if(n.push(e.substring(s,a).trim()),l=[],s=++a,s===o)throw"Unmatched left bracket: "+e;for(;a<o;){if(a=mv(e,a,WE),a===o)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,a).trim()),a<o-1&&e[++a]!==UE)throw"Expected left bracket: "+e;s=++a}if(!(o=n.length)||UEt.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],i?t.markname=n[0].slice(1):VEt(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),r[0]&&(t.throttle=r[0]),r[1]&&(t.debounce=r[1]),t}function qEt(e){const t=e.split(aye);if(!e.length||t.length>2)throw e;return t.map(n=>{const r=+n;if(r!==r)throw e;return r})}var XEt="vega",YEt="5.20.0",KEt="The Vega visualization grammar.",ZEt=["vega","visualization","interaction","dataflow","library","data","d3"],JEt="BSD-3-Clause",QEt="UW Interactive Data Lab (http://idl.cs.washington.edu)",eAt="build/vega-node.js",tAt="build/vega.module.js",nAt="build/vega.min.js",rAt="build/vega.min.js",iAt="index.d.ts",sAt="vega/vega",oAt={bundle:"rollup -c --config-bundle",prebuild:"rimraf build && rimraf build-es5",build:"rollup -c --config-core --config-bundle --config-ie",postbuild:"node schema-copy",pretest:"yarn build --config-test",test:"TZ=America/Los_Angeles tape 'test/**/*-test.js'",prepublishOnly:"yarn test && yarn build",postpublish:"./schema-deploy.sh"},aAt={"vega-crossfilter":"~4.0.5","vega-dataflow":"~5.7.3","vega-encode":"~4.8.3","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-force":"~4.0.7","vega-format":"~1.0.4","vega-functions":"~5.12.0","vega-geo":"~4.3.8","vega-hierarchy":"~4.0.9","vega-label":"~1.0.0","vega-loader":"~4.4.0","vega-parser":"~6.1.3","vega-projection":"~1.4.5","vega-regression":"~1.0.9","vega-runtime":"~6.1.3","vega-scale":"~7.1.1","vega-scenegraph":"~4.9.4","vega-statistics":"~1.7.9","vega-time":"~2.0.4","vega-transforms":"~4.9.3","vega-typings":"~0.20.0","vega-util":"~1.16.1","vega-view":"~5.10.0","vega-view-transforms":"~4.5.8","vega-voronoi":"~4.1.5","vega-wordcloud":"~4.1.3"},uAt={"vega-schema":"*"},lAt="f262105e75449760b0f35fda70e6b576a31d68a4",cAt={name:XEt,version:YEt,description:KEt,keywords:ZEt,license:JEt,author:QEt,main:eAt,module:tAt,unpkg:nAt,jsdelivr:rAt,types:iAt,repository:sAt,scripts:oAt,dependencies:aAt,devDependencies:uAt,gitHead:lAt};St(Xm,GQe,Rat,Pct,Cht,mdt,D1t,vpt,F1t,Y1t,avt,pvt);const fAt=cAt.version,hAt=Object.freeze(Object.defineProperty({__proto__:null,Bounds:Zi,CanvasHandler:_C,CanvasRenderer:kE,DATE:Es,DAY:pi,DAYOFYEAR:Mu,Dataflow:Sm,Debug:vae,Error:mae,EventStream:qD,Gradient:zge,GroupItem:n9,HOURS:eo,Handler:ih,Info:bae,Item:t9,MILLISECONDS:Ia,MINUTES:to,MONTH:wi,Marks:Po,MultiPulse:Ez,None:gae,Operator:sn,Parameters:HD,Pulse:mf,QUARTER:ks,RenderType:of,Renderer:el,ResourceLoader:r9,SECONDS:Mo,SVGHandler:x9,SVGRenderer:k9,SVGStringRenderer:E9,Scenegraph:b9,TIME_UNITS:Qz,Transform:he,View:m1e,WEEK:cr,Warn:yae,YEAR:Kr,accessor:Vo,accessorFields:vi,accessorName:Ln,array:at,ascending:RD,bandwidthNRD:Iz,bin:Mue,bootstrapCI:Rue,boundClip:n1t,boundContext:xC,boundItem:rL,boundMark:sme,boundStroke:wg,changeset:fg,clampRange:PXe,codegenExpression:PEt,compare:Eae,constant:No,cumulativeLogNormal:Pz,cumulativeNormal:YD,cumulativeUniform:jz,dayofyear:ile,debounce:Aae,defaultLocale:Oge,definition:_ue,densityLogNormal:Rz,densityNormal:Fz,densityUniform:zz,domChild:ds,domClear:pa,domCreate:rf,domFind:v9,dotbin:Pue,error:ye,expressionFunction:ir,extend:St,extent:Lf,extentIndex:Tae,falsy:Mc,fastmap:H1,field:Rf,flush:WXe,font:eF,fontFamily:SC,fontSize:Qu,format:q_,formatLocale:yE,formats:Y7,hasOwnProperty:lt,id:AXe,identity:Oo,inferType:Mge,inferTypes:Rge,ingest:zt,inherits:$e,inrange:VXe,interpolate:i7,interpolateColors:jI,interpolateRange:Cde,intersect:Dme,intersectBoxLine:dm,intersectPath:i9,intersectPoint:s9,intersectRule:Xge,isArray:ht,isBoolean:Dae,isDate:PD,isFunction:Ht,isIterable:Iae,isNumber:bp,isObject:wt,isRegExp:GXe,isString:wn,isTuple:VD,key:Fae,lerp:HXe,lineHeight:nh,loader:K7,locale:Fge,logger:TXe,lruCache:Oae,markup:$9,merge:Nae,mergeConfig:FD,multiLineOffset:d0t,one:V1,pad:XXe,panLinear:IXe,panLog:FXe,panPow:OXe,panSymlog:NXe,parse:_kt,parseExpression:OEt,parseSelector:Dg,pathCurves:J7,pathEqual:Nme,pathParse:y0,pathRectangle:Wge,pathRender:Dx,pathSymbols:Uge,pathTrail:Vge,peek:en,point:nF,projection:b7,quantileLogNormal:Lz,quantileNormal:KD,quantileUniform:Uz,quantiles:Tz,quantizeInterpolator:Sde,quarter:MXe,quartiles:Dz,get random(){return Da},randomInteger:_Je,randomKDE:Nz,randomLCG:SJe,randomLogNormal:Bue,randomMixture:zue,randomNormal:Oz,randomUniform:jue,read:Igt,regressionExp:Wue,regressionLinear:Wz,regressionLoess:Hue,regressionLog:Uue,regressionPoly:Gue,regressionPow:Vue,regressionQuad:Vz,renderModule:rF,repeat:Cb,resetDefaultLocale:fgt,resetSVGClipId:Hge,resetSVGDefIds:s1t,responseType:Dgt,runtimeContext:r1e,sampleCurve:JD,sampleLogNormal:Mz,sampleNormal:XD,sampleUniform:Bz,scale:jt,sceneEqual:A9,sceneFromJSON:ame,scenePickVisit:xE,sceneToJSON:ome,sceneVisit:Fa,sceneZOrder:o9,scheme:s7,serializeXML:Cme,setRandom:wJe,span:LD,splitAccessPath:ID,stringValue:Qe,textMetrics:$u,timeBin:wle,timeFloor:fle,timeFormatLocale:Tx,timeInterval:Q1,timeOffset:ple,timeSequence:yle,timeUnitSpecifier:rle,timeUnits:e6,toBoolean:Mae,toDate:Rae,toNumber:Pf,toSet:nc,toString:Pae,transform:$ue,transforms:Xm,truncate:KXe,truthy:G1,tupleid:Ve,typeParsers:ZP,utcFloor:hle,utcInterval:ey,utcOffset:gle,utcSequence:ble,utcdayofyear:ale,utcquarter:RXe,utcweek:ule,version:fAt,visitArray:ZXe,week:sle,writeConfig:OD,zero:Vc,zoomLinear:_ae,zoomLog:$ae,zoomPow:dR,zoomSymlog:kae},Symbol.toStringTag,{value:"Module"})),dAt="vega-lite",pAt='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',gAt="4.13.1",mAt=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],yAt="https://vega.github.io/vega-lite/",bAt="Vega-Lite is a concise high-level language for interactive visualization.",vAt="build/vega-lite.js",xAt="build/vega-lite.min.js",wAt="build/vega-lite.min.js",CAt="build/src/index",SAt="build/src/index.d.ts",_At={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},$At={test:"test"},kAt={changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},EAt={type:"git",url:"https://github.com/vega/vega-lite.git"},AAt="BSD-3-Clause",TAt={url:"https://github.com/vega/vega-lite/issues"},DAt={"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},IAt={"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},FAt={vega:"^5.12.1"},OAt={preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1},NAt={name:dAt,author:pAt,version:gAt,collaborators:mAt,homepage:yAt,description:bAt,main:vAt,unpkg:xAt,jsdelivr:wAt,module:CAt,types:SAt,bin:_At,directories:$At,scripts:kAt,repository:EAt,license:AAt,bugs:TAt,devDependencies:DAt,dependencies:IAt,peerDependencies:FAt,jest:OAt};function yy(e,t,n){return e.fields=t||[],e.fname=n,e}function MAt(e){return e.length===1?RAt(e[0]):PAt(e)}const RAt=e=>function(t){return t[e]},PAt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function Z3(e){throw Error(e)}function Ig(e){var t=[],n=null,r=0,i=e.length,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<i;++a)if(u=e[a],u==="\\")s+=e.substring(o,a),s+=e.substring(++a,++a),o=a;else if(u===n)l(),n=null,r=-1;else{if(n)continue;o===r&&u==='"'||o===r&&u==="'"?(o=a+1,n=u):u==="."&&!r?a>o?l():o=a+1:u==="["?(a>o&&l(),r=o=a+1):u==="]"&&(r||Z3("Access path missing open bracket: "+e),r>0&&l(),r=0,o=a+1)}return r&&Z3("Access path missing closing bracket: "+e),n&&Z3("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function LAt(e,t,n){const r=Ig(e);return e=r.length===1?r[0]:e,yy((n&&n.get||MAt)(r),[e],t||e)}var BC=[];LAt("id");var BAt=yy(function(e){return e},BC,"identity");yy(function(){return 0},BC,"zero");yy(function(){return 1},BC,"one");yy(function(){return!0},BC,"true");yy(function(){return!1},BC,"false");function g_(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var zAt=0,jAt=1,fye=2,UAt=3,WAt=4;function VAt(e,t){var n=e||zAt;return{level:function(r){return arguments.length?(n=+r,this):n},error:function(){return n>=jAt&&g_(t||"error","ERROR",arguments),this},warn:function(){return n>=fye&&g_(t||"warn","WARN",arguments),this},info:function(){return n>=UAt&&g_(t||"log","INFO",arguments),this},debug:function(){return n>=WAt&&g_(t||"log","DEBUG",arguments),this}}}const Ye=Array.isArray;function Fr(e){return e===Object(e)}const FZ=e=>e!=="__proto__";function hye(...e){return e.reduce((t,n)=>{for(var r in n)if(r==="signals")t.signals=GAt(t.signals,n.signals);else{var i=r==="legend"?{layout:1}:r==="style"?!0:null;Zj(t,r,n[r],i)}return t},{})}function Zj(e,t,n,r){if(FZ(t)){var i,s;if(Fr(n)&&!Ye(n)){s=Fr(e[t])?e[t]:e[t]={};for(i in n)r&&(r===!0||r[i])?Zj(s,i,n[i]):FZ(i)&&(s[i]=n[i])}else e[t]=n}}function GAt(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}function qn(e){return e!=null?Ye(e)?e:[e]:[]}function HAt(e){return typeof e=="function"}const qAt=Object.prototype.hasOwnProperty;function zd(e,t){return qAt.call(e,t)}function zC(e){return typeof e=="boolean"}function tr(e){return typeof e=="number"}function bt(e){return typeof e=="string"}function Tt(e){return Ye(e)?"["+e.map(Tt)+"]":Fr(e)||bt(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Fg(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Ge(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var dye={exports:{}};(function(e){var t=function(){function n(h,d){return d!=null&&h instanceof d}var r;try{r=Map}catch{r=function(){}}var i;try{i=Set}catch{i=function(){}}var s;try{s=Promise}catch{s=function(){}}function o(h,d,p,m,g){typeof d=="object"&&(p=d.depth,m=d.prototype,g=d.includeNonEnumerable,d=d.circular);var y=[],b=[],x=typeof Buffer<"u";typeof d>"u"&&(d=!0),typeof p>"u"&&(p=1/0);function v(w,C){if(w===null)return null;if(C===0)return w;var S,_;if(typeof w!="object")return w;if(n(w,r))S=new r;else if(n(w,i))S=new i;else if(n(w,s))S=new s(function(V,U){w.then(function(A){V(v(A,C-1))},function(A){U(v(A,C-1))})});else if(o.__isArray(w))S=[];else if(o.__isRegExp(w))S=new RegExp(w.source,f(w)),w.lastIndex&&(S.lastIndex=w.lastIndex);else if(o.__isDate(w))S=new Date(w.getTime());else{if(x&&Buffer.isBuffer(w))return Buffer.allocUnsafe?S=Buffer.allocUnsafe(w.length):S=new Buffer(w.length),w.copy(S),S;n(w,Error)?S=Object.create(w):typeof m>"u"?(_=Object.getPrototypeOf(w),S=Object.create(_)):(S=Object.create(m),_=m)}if(d){var $=y.indexOf(w);if($!=-1)return b[$];y.push(w),b.push(S)}n(w,r)&&w.forEach(function(V,U){var A=v(U,C-1),M=v(V,C-1);S.set(A,M)}),n(w,i)&&w.forEach(function(V){var U=v(V,C-1);S.add(U)});for(var k in w){var E;_&&(E=Object.getOwnPropertyDescriptor(_,k)),!(E&&E.set==null)&&(S[k]=v(w[k],C-1))}if(Object.getOwnPropertySymbols)for(var F=Object.getOwnPropertySymbols(w),k=0;k<F.length;k++){var T=F[k],I=Object.getOwnPropertyDescriptor(w,T);I&&!I.enumerable&&!g||(S[T]=v(w[T],C-1),I.enumerable||Object.defineProperty(S,T,{enumerable:!1}))}if(g)for(var D=Object.getOwnPropertyNames(w),k=0;k<D.length;k++){var N=D[k],I=Object.getOwnPropertyDescriptor(w,N);I&&I.enumerable||(S[N]=v(w[N],C-1),Object.defineProperty(S,N,{enumerable:!1}))}return S}return v(h,p)}o.clonePrototype=function(d){if(d===null)return null;var p=function(){};return p.prototype=d,new p};function a(h){return Object.prototype.toString.call(h)}o.__objToStr=a;function u(h){return typeof h=="object"&&a(h)==="[object Date]"}o.__isDate=u;function l(h){return typeof h=="object"&&a(h)==="[object Array]"}o.__isArray=l;function c(h){return typeof h=="object"&&a(h)==="[object RegExp]"}o.__isRegExp=c;function f(h){var d="";return h.global&&(d+="g"),h.ignoreCase&&(d+="i"),h.multiline&&(d+="m"),d}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)})(dye);var XAt=dye.exports;const YAt=mw(XAt);var KAt=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,i,s;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(s=Object.keys(t),r=s.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=r;i--!==0;){var o=s[i];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n};const ZAt=mw(KAt);var JAt=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,r=t.cmp&&function(s){return function(o){return function(a,u){var l={key:a,value:o[a]},c={key:u,value:o[u]};return s(l,c)}}}(t.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,u;if(Array.isArray(o)){for(u="[",a=0;a<o.length;a++)a&&(u+=","),u+=s(o[a])||"null";return u+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=i.push(o)-1,c=Object.keys(o).sort(r&&r(o));for(u="",a=0;a<c.length;a++){var f=c[a],h=s(o[f]);h&&(u&&(u+=","),u+=JSON.stringify(f)+":"+h)}return i.splice(l,1),"{"+u+"}"}}(e)};const Yx=mw(JAt);function Jj(e){return!!e.or}function Qj(e){return!!e.and}function eU(e){return!!e.not}function c$(e,t){if(eU(e))c$(e.not,t);else if(Qj(e))for(const n of e.and)c$(n,t);else if(Jj(e))for(const n of e.or)c$(n,t);else t(e)}function f$(e,t){return eU(e)?{not:f$(e.not,t)}:Qj(e)?{and:e.and.map(n=>f$(n,t))}:Jj(e)?{or:e.or.map(n=>f$(n,t))}:t(e)}const jC=ZAt,vt=YAt;function Kx(e,t){const n={};for(const r of t)zd(e,r)&&(n[r]=e[r]);return n}function ql(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Yx(e)).join(",")})`};const $n=Yx;function Ot(e){if(tr(e))return e;const t=bt(e)?e:Yx(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);n=(n<<5)-n+i,n=n&n}return n}function OZ(e){return e===!1||e===null}function Ze(e,t){return e.indexOf(t)>-1}function Zx(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function pye(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function QAt(e,...t){for(const n of t)eTt(e,n??{});return e}function eTt(e,t){for(const n of Se(t))Zj(e,n,t[n],!0)}function lf(e,t){const n=[],r={};let i;for(const s of e)i=t(s),!(i in r)&&(r[i]=1,n.push(s));return n}function tTt(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function gye(e,t){for(const n of e)if(t.has(n))return!0;return!1}function NZ(e){const t=new Set;for(const n of e){const i=Ig(n).map((o,a)=>a===0?o:`[${o}]`),s=i.map((o,a)=>i.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function mye(e,t){return e===void 0||t===void 0?!0:gye(NZ(e),NZ(t))}function on(e){return Se(e).length===0}const Se=Object.keys,Cf=Object.values;function yye(e){const t=[];for(const n in e)zd(e,n)&&t.push({key:n,value:e[n]});return t}function VE(e){return e===!0||e===!1}function En(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function yv(e,t){return eU(e)?"!("+yv(e.not,t)+")":Qj(e)?"("+e.and.map(n=>yv(n,t)).join(") && (")+")":Jj(e)?"("+e.or.map(n=>yv(n,t)).join(") || (")+")":t(e)}function zL(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&zL(e[n],t)&&delete e[n],on(e)}function zF(e){return e.charAt(0).toUpperCase()+e.substr(1)}function bye(e,t="datum"){const n=Ig(e),r=[];for(let i=1;i<=n.length;i++){const s=`[${n.slice(0,i).map(Tt).join("][")}]`;r.push(`${t}${s}`)}return r.join(" && ")}function nTt(e,t="datum"){return`${t}[${Tt(Ig(e).join("."))}]`}function rTt(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ah(e){return`${Ig(e).map(rTt).join("\\.")}`}function $0(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function vye(e){return`${Ig(e).join(".")}`}function Jx(e){return e?Ig(e).length:0}function nr(...e){for(const t of e)if(t!==void 0)return t}let iTt=42;function sTt(e){const t=++iTt;return e?String(e)+t:t}function oTt(e){return aTt(e)?e:`__${e}`}function aTt(e){return e.indexOf("__")===0}function GE(e){if(e!==void 0)return(e%360+360)%360}function tU(e){return tr(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const MZ={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function nU(e){return e&&e.condition}const xye=["domain","grid","labels","ticks","title"],uTt={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},wye={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},lTt=Object.assign(Object.assign({},wye),{style:1,labelExpr:1,encoding:1});function RZ(e){return!!lTt[e]}const rs={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Cye=rs.arc,jF=rs.area,UF=rs.bar,cTt=rs.image,WF=rs.line,VF=rs.point,fTt=rs.rect,HE=rs.rule,Sye=rs.text,rU=rs.tick,hTt=rs.trail,iU=rs.circle,sU=rs.square,_ye=rs.geoshape;function Og(e){return Ze(["line","area","trail"],e)}function PZ(e){return Ze(["rect","bar","image","arc"],e)}const $ye=Se(rs);function ju(e){return e.type}Fg($ye);const dTt=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],pTt=["fill","fillOpacity"],gTt=[...dTt,...pTt],mTt={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},LZ=Se(mTt),yTt={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},bTt={color:"#4c78a8",invalid:"filter",timeUnitBand:1},vTt={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},kye=5,xTt={binSpacing:1,continuousBandSize:kye,timeUnitBandPosition:.5},wTt={binSpacing:0,continuousBandSize:kye,timeUnitBandPosition:.5},CTt={thickness:1};function STt(e){return ju(e)?e.type:e}function Sc(e){return"mark"in e}class GF{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return Sc(t)?STt(t.mark)===this.name:!1}}const _Tt={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},$Tt={count:1,min:1,max:1};function uh(e){return!!e&&!!e.argmin}function Ng(e){return!!e&&!!e.argmax}function oU(e){return bt(e)&&!!_Tt[e]}const kTt=["count","valid","missing","distinct"];function Eye(e){return bt(e)&&Ze(kTt,e)}function ETt(e){return bt(e)&&Ze(["min","max"],e)}const ATt=["count","sum","distinct","valid","missing"],TTt=["mean","average","median","q1","q3","min","max"],DTt=Fg(TTt),Xl="row",Yl="column",HF="facet",On="x",pr="y",Wa="x2",ol="y2",al="radius",_c="radius2",Va="theta",$c="theta2",ul="latitude",ll="longitude",Ga="latitude2",Lo="longitude2",Ds="color",cl="fill",fl="stroke",Is="shape",kc="size",Mg="angle",Ec="opacity",Rh="fillOpacity",Ph="strokeOpacity",Lh="strokeWidth",Bh="strokeDash",UC="text",WC="order",VC="detail",qF="key",Pp="tooltip",XF="href",YF="url",KF="description",ITt={x:1,y:1,x2:1,y2:1},Aye={theta:1,theta2:1,radius:1,radius2:1};function Tye(e){return e in Aye}const aU={longitude:1,longitude2:1,latitude:1,latitude2:1};function FTt(e){switch(e){case ul:return"y";case Ga:return"y2";case ll:return"x";case Lo:return"x2"}}function OTt(e){return e in aU}const NTt=Se(aU),Dye=Object.assign(Object.assign(Object.assign(Object.assign({},ITt),Aye),aU),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Tm(e){return e===Ds||e===cl||e===fl}const Iye={row:1,column:1,facet:1},Eo=Se(Iye),uU=Object.assign(Object.assign({},Dye),Iye),Fye=Se(uU),MTt=Ge(uU,["order","detail","tooltip"]),RTt=Ge(MTt,["row","column","facet"]);function PTt(e){return!!RTt[e]}function Oye(e){return!!uU[e]}const LTt=[Wa,ol,Ga,Lo,$c,_c];function Nye(e){return Rg(e)!==e}function Rg(e){switch(e){case Wa:return On;case ol:return pr;case Ga:return ul;case Lo:return ll;case $c:return Va;case _c:return al}return e}function lh(e){if(Tye(e))switch(e){case Va:return"startAngle";case $c:return"endAngle";case al:return"outerRadius";case _c:return"innerRadius"}return e}function hl(e){switch(e){case On:return Wa;case pr:return ol;case ul:return Ga;case ll:return Lo;case Va:return $c;case al:return _c}}function dl(e){switch(e){case On:case Wa:return"width";case pr:case ol:return"height"}}function BTt(e){switch(e){case On:return"xOffset";case pr:return"yOffset";case Wa:return"x2Offset";case ol:return"y2Offset";case Va:return"thetaOffset";case al:return"radiusOffset";case $c:return"theta2Offset";case _c:return"radius2Offset"}}const lU=Ge(Dye,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),zTt=Se(lU),zh={x:1,y:1},Bo=Se(zh);function Uu(e){return e in zh}const cU={theta:1,radius:1},jTt=Se(cU);function ZF(e){return e==="width"?On:pr}const Mye=Ge(lU,["text","tooltip","href","url","description","detail","key","order"]),UTt=Se(Mye);function WTt(e){return!!lU[e]}function VTt(e){switch(e){case Ds:case cl:case fl:case kc:case Is:case Ec:case Lh:case Bh:return!0;case Rh:case Ph:case Mg:return!1}}const Rye=Object.assign(Object.assign(Object.assign({},zh),cU),Mye),JF=Se(Rye);function jh(e){return!!Rye[e]}function GTt(e,t){return qTt(e)[t]}const Pye={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},HTt=Ge(Pye,["geoshape"]);function qTt(e){switch(e){case Ds:case cl:case fl:case KF:case VC:case qF:case Pp:case XF:case WC:case Ec:case Rh:case Ph:case Lh:case HF:case Xl:case Yl:return Pye;case On:case pr:case ul:case ll:return HTt;case Wa:case ol:case Ga:case Lo:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case kc:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Bh:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Is:return{point:"always",geoshape:"always"};case UC:return{text:"always"};case Mg:return{point:"always",square:"always",text:"always"};case YF:return{image:"always"};case Va:return{text:"always",arc:"always"};case al:return{text:"always",arc:"always"};case $c:case _c:return{arc:"always"}}}function h$(e){switch(e){case On:case pr:case Va:case al:case kc:case Mg:case Lh:case Ec:case Rh:case Ph:case Wa:case ol:case $c:case _c:return;case HF:case Xl:case Yl:case Is:case Bh:case UC:case Pp:case XF:case YF:case KF:return"discrete";case Ds:case cl:case fl:return"flexible";case ul:case ll:case Ga:case Lo:case VC:case qF:case WC:return}}function Lye(e){return zC(e)&&(e=sO(e,void 0)),"bin"+Se(e).map(t=>QF(e[t])?En(`_${t}_${Object.entries(e[t])}`):En(`_${t}_${e[t]}`)).join("")}function pn(e){return e===!0||GC(e)&&!e.binned}function zi(e){return e==="binned"||GC(e)&&e.binned===!0}function GC(e){return Fr(e)}function QF(e){return e==null?void 0:e.selection}function BZ(e){switch(e){case Xl:case Yl:case kc:case Ds:case cl:case fl:case Lh:case Ec:case Rh:case Ph:case Is:return 6;case Bh:return 4;default:return 10}}function fU(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const XTt='Autosize "fit" only works for single views and layered views.';function zZ(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function jZ(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function UZ(e){return e?`Dropping "fit-${e}" because spec has discrete ${dl(e)}.`:'Dropping "fit" because spec has discrete size.'}function WZ(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function YTt(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function KTt(e){return`The "nearest" transform is not supported for ${e} marks.`}function Bye(e){return`Selection not supported for ${e} yet.`}function ZTt(e){return`Cannot find a selection named "${e}".`}const JTt="Scale bindings are currently only supported for scales with unbinned, continuous domains.",QTt="Legend bindings are only supported for selections over an individual field or encoding channel.";function eDt(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function tDt(e){return`Unknown repeated value "${e}".`}function VZ(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const nDt="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function rDt(e){return`Unrecognized parse "${e}".`}function GZ(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function iDt(e){return`Ignoring an invalid transform: ${$n(e)}.`}const sDt='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function HZ(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function oDt(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function aDt(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${$n(t)} is overridden by a child projection ${$n(n)}.`}const uDt="Arc marks uses theta channel rather than angle, replacing angle with theta.";function lDt(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${$n(n)}}.`}function zye(e){return`Invalid field type "${e}".`}function cDt(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function fDt(e){return`Invalid aggregation operator "${e}".`}function hDt(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function jye(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function jL(e,t){return`Dropping ${$n(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const dDt="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function eO(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function pDt(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function gDt(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function mDt(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function J3(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function yDt(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function bDt(e,t){return`Specified orient "${e}" overridden with "${t}".`}const vDt=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function xDt(e){return`Cannot use the scale property "${e}" with non-color channel.`}function wDt(e){return`Using unaggregated domain with raw field has no effect (${$n(e)}).`}function CDt(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function SDt(e){return`Unaggregated domain is currently unsupported for log scale (${$n(e)}).`}function _Dt(e){return`Cannot apply size to non-oriented mark "${e}".`}function $Dt(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function kDt(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Uye(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function Wye(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function EDt(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${$n(n)} and ${$n(r)}). Using ${$n(n)}.`}function ADt(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${$n(n)} and ${$n(r)}). Using the union of the two domains.`}function TDt(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function DDt(e){return`Dropping sort property ${$n(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const qZ="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",IDt="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",FDt="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",ODt="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function NDt(e){return`Cannot stack "${e}" if there is already "${e}2".`}function MDt(e){return`Cannot stack non-linear scale (${e}).`}function RDt(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function qE(e,t){return`Invalid ${e}: ${$n(t)}.`}function PDt(e){return`Dropping day from datetime ${$n(e)} as day cannot be combined with other units.`}function LDt(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function BDt(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function zDt(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function jDt(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function XZ(e){return`1D error band does not support ${e}.`}function Vye(e){return`Channel ${e} is required for "binned" bin.`}function UDt(e){return`Domain for ${e} is required for threshold scale.`}const Gye=VAt(fye);let k0=Gye;function WDt(e){return k0=e,k0}function VDt(){return k0=Gye,k0}function xe(...e){k0.warn(...e)}function GDt(...e){k0.debug(...e)}function by(e){if(e&&Fr(e)){for(const t of dU)if(t in e)return!0}return!1}const Hye=["january","february","march","april","may","june","july","august","september","october","november","december"],HDt=Hye.map(e=>e.substr(0,3)),qye=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],qDt=qye.map(e=>e.substr(0,3));function XDt(e){if(tU(e)&&(e=+e),tr(e))return e>4&&xe(qE("quarter",e)),e-1;throw new Error(qE("quarter",e))}function YDt(e){if(tU(e)&&(e=+e),tr(e))return e-1;{const t=e.toLowerCase(),n=Hye.indexOf(t);if(n!==-1)return n;const r=t.substr(0,3),i=HDt.indexOf(r);if(i!==-1)return i;throw new Error(qE("month",e))}}function KDt(e){if(tU(e)&&(e=+e),tr(e))return e%7;{const t=e.toLowerCase(),n=qye.indexOf(t);if(n!==-1)return n;const r=t.substr(0,3),i=qDt.indexOf(r);if(i!==-1)return i;throw new Error(qE("day",e))}}function hU(e,t){const n=[];if(t&&e.day!==void 0&&Se(e).length>1&&(xe(PDt(e)),e=vt(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const r=t?YDt(e.month):e.month;n.push(r)}else if(e.quarter!==void 0){const r=t?XDt(e.quarter):e.quarter;n.push(tr(r)?r*3:r+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const r=t?KDt(e.day):e.day;n.push(tr(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const i=e[r];n.push(typeof i>"u"?0:i)}return n}function Qx(e){const n=hU(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function ZDt(e){const n=hU(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function JDt(e){const t=hU(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const Xye={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},dU=Se(Xye);function QDt(e){return!!Xye[e]}function pU(e){return e.startsWith("utc")}function eIt(e){return e.substr(3)}const tIt={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function gU(e){const t=[];for(const n of dU)Yye(e,n)&&t.push(n);return t}function Yye(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function nIt(e,t,{end:n}={end:!1}){const r=bye(t),i=pU(e)?"utc":"";function s(u){return u==="quarter"?`(${i}quarter(${r})-1)`:`${i}${u}(${r})`}let o;const a={};for(const u of dU)Yye(e,u)&&(a[u]=s(u),o=u);return n&&(a[o]+="+1"),ZDt(a)}function Kye(e){if(!e)return;const t=gU(e);return`timeUnitSpecifier(${Yx(t)}, ${Yx(tIt)})`}function rIt(e,t,n){if(!e)return;const r=Kye(e);return`${n||pU(e)?"utc":"time"}Format(${t}, ${r})`}function Ji(e){if(!e)return;let t;return bt(e)?t={unit:e}:Fr(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),pU(t.unit)&&(t.utc=!0,t.unit=eIt(t.unit)),t}function iIt(e){const t=Ji(e),{utc:n}=t,r=Ge(t,["utc"]);return r.unit?(n?"utc":"")+Se(r).map(i=>En(`${i==="unit"?"":`_${i}_`}${r[i]}`)).join(""):(n?"utc":"")+"timeunit"+Se(r).map(i=>En(`_${i}_${r[i]}`)).join("")}function tt(e){return e&&!!e.signal}function Uh(e){return!!e.step}function sIt(e){return Ye(e)?!1:"fields"in e&&!("data"in e)}function oIt(e){return Ye(e)?!1:"fields"in e&&"data"in e}function cf(e){return Ye(e)?!1:"field"in e&&"data"in e}const aIt={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},uIt=Se(aIt),lIt={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Q3=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function cIt(e){return e==null?void 0:e.selection}function mU(e){return e&&!!e.field&&e.equal!==void 0}function Zye(e){return e&&!!e.field&&e.lt!==void 0}function Jye(e){return e&&!!e.field&&e.lte!==void 0}function Qye(e){return e&&!!e.field&&e.gt!==void 0}function ebe(e){return e&&!!e.field&&e.gte!==void 0}function yU(e){if(e&&e.field){if(Ye(e.range)&&e.range.length===2)return!0;if(tt(e.range))return!0}return!1}function bU(e){return e&&!!e.field&&(Ye(e.oneOf)||Ye(e.in))}function fIt(e){return e&&!!e.field&&e.valid!==void 0}function tbe(e){return bU(e)||mU(e)||yU(e)||Zye(e)||Qye(e)||Jye(e)||ebe(e)}function Ja(e,t){return OU(e,{timeUnit:t,wrapTime:!0})}function hIt(e,t){return e.map(n=>Ja(n,t))}function nbe(e,t=!0){var n;const{field:r}=e,i=(n=Ji(e.timeUnit))===null||n===void 0?void 0:n.unit,s=i?"time("+nIt(i,r)+")":_e(e,{expr:"datum"});if(mU(e))return s+"==="+Ja(e.equal,i);if(Zye(e)){const o=e.lt;return`${s}<${Ja(o,i)}`}else if(Qye(e)){const o=e.gt;return`${s}>${Ja(o,i)}`}else if(Jye(e)){const o=e.lte;return`${s}<=${Ja(o,i)}`}else if(ebe(e)){const o=e.gte;return`${s}>=${Ja(o,i)}`}else{if(bU(e))return`indexof([${hIt(e.oneOf,i).join(",")}], ${s}) !== -1`;if(fIt(e))return vU(s,e.valid);if(yU(e)){const{range:o}=e,a=tt(o)?{signal:`${o.signal}[0]`}:o[0],u=tt(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&u!==null&&t)return"inrange("+s+", ["+Ja(a,i)+", "+Ja(u,i)+"])";const l=[];return a!==null&&l.push(`${s} >= ${Ja(a,i)}`),u!==null&&l.push(`${s} <= ${Ja(u,i)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function vU(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function dIt(e){var t;return tbe(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=Ji(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const vy={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Lp=vy.quantitative,xU=vy.ordinal,E0=vy.temporal,wU=vy.nominal,xy=vy.geojson,pIt=Se(vy);function gIt(e){if(e)switch(e=e.toLowerCase(),e){case"q":case Lp:return"quantitative";case"t":case E0:return"temporal";case"o":case xU:return"ordinal";case"n":case wU:return"nominal";case xy:return"geojson"}}const Xn={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},UL={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},mIt=Se(UL);function yIt(e,t){const n=UL[e],r=UL[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}const bIt={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function YZ(e){return bIt[e]}const rbe=["linear","log","pow","sqrt","symlog","time","utc"],vIt=Fg(rbe),xIt=["linear","log","pow","sqrt","symlog"],wIt=Fg(xIt);function CIt(e){return e in wIt}const SIt=["quantile","quantize","threshold"],_It=Fg(SIt),$It=rbe.concat(["quantile","quantize","threshold","sequential","identity"]),kIt=Fg($It),EIt=["ordinal","bin-ordinal","point","band"],AIt=Fg(EIt);function Fs(e){return e in AIt}function zo(e){return e in kIt}function ya(e){return e in vIt}function XE(e){return e in _It}const TIt={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function DIt(e){return!bt(e)&&!!e.name}function ibe(e){return e==null?void 0:e.selection}function IIt(e){return e&&e.unionWith}const FIt={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},OIt=Ge(FIt,["type","domain","range","scheme"]),NIt=Se(OIt);MIt();function sbe(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!Ze(["point","band","identity"],e);case"bins":return!Ze(["point","band","identity","ordinal"],e);case"round":return ya(e)||e==="band"||e==="point";case"padding":return ya(e)||Ze(["point","band"],e);case"paddingOuter":case"align":return Ze(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return ya(e);case"nice":return ya(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return zo(e)&&!Ze(["log","time","utc","threshold","quantile"],e)}}function obe(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Tm(e)?void 0:xDt(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function abe(e,t){return Ze([xU,wU],t)?e===void 0||Fs(e):t===E0?Ze([Xn.TIME,Xn.UTC,void 0],e):t===Lp?Ze([Xn.LOG,Xn.POW,Xn.SQRT,Xn.SYMLOG,Xn.QUANTILE,Xn.QUANTIZE,Xn.THRESHOLD,Xn.LINEAR,void 0],e):!0}function ube(e,t){if(!jh(e))return!1;switch(e){case On:case pr:case Va:case al:return ya(t)||Ze(["band","point"],t);case kc:case Lh:case Ec:case Rh:case Ph:case Mg:return ya(t)||XE(t)||Ze(["band","point","ordinal"],t);case Ds:case cl:case fl:return t!=="band";case Bh:return t==="ordinal"||XE(t);case Is:return t==="ordinal"}}function MIt(){var e;const t={};for(const n of Fye)for(const r of pIt)for(const i of mIt){const s=RIt(n,r);ube(n,i)&&abe(i,r)&&(t[s]=(e=t[s])!==null&&e!==void 0?e:[],t[s].push(i))}return t}function RIt(e,t){return e+"_"+t}function CU(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:s}=e,o=cbe(e);return Te(n)&&!Eye(n.aggregate)&&i&&ya(i.get("type"))&&i.get("zero")===!1?lbe({fieldDef:n,channel:t,markDef:r,ref:o,config:s}):o}function lbe({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return Og(n.type)||Gt("invalid",n,i)===null?r:[PIt(e,t),r]}function PIt(e,t){const n=SU(e,!0),i=Rg(t)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},i)}function SU(e,t=!0){return vU(bt(e)?e:_e(e,{expr:"datum"}),!t)}function LIt(e){const{datum:t}=e;return by(t)?Qx(t):`${JSON.stringify(t)}`}function np(e,t,n,r){const i={};if(t&&(i.scale=t),Wh(e)){const{datum:s}=e;by(s)?i.signal=Qx(s):tt(s)?i.signal=s.signal:i.value=s}else i.field=_e(e,n);if(r){const{offset:s,band:o}=r;s&&(i.offset=s),o&&(i.band=o)}return i}function YE({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:s=.5}){const o=0<s&&s<1?"datum":void 0,a=_e(t,{expr:o,suffix:i}),u=n!==void 0?_e(n,{expr:o}):_e(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const c=s===0?a:u;l.field=c}else{const c=`${s} * ${a} + ${1-s} * ${u}`;l.signal=`scale("${e}", ${c})`}return r&&(l.offset=r),l}function cbe({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l,band:c}){var f;if(t){if(it(t)){if(io(t)){c=c??qC({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:a,config:i,isMidPoint:!0});const{bin:d,timeUnit:p,type:m}=t;if(pn(d)||c&&p&&m===E0)return a&&a.impute?np(t,s,{binSuffix:"mid"},{offset:u}):c?YE({scaleName:s,fieldOrDatumDef:t,band:c,offset:u}):np(t,s,XC(t,e)?{binSuffix:"range"}:{},{offset:u});if(zi(d)){if(Te(n))return YE({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:u});xe(Vye(e===On?Wa:ol))}}const h=o==null?void 0:o.get("type");return np(t,s,Fs(h)?{binSuffix:"range"}:{},{offset:u,band:h==="band"?(f=c??t.band)!==null&&f!==void 0?f:.5:void 0})}else if(lc(t)){const h=t.value,d=u?{offset:u}:{};return Object.assign(Object.assign({},bv(e,h)),d)}}return HAt(l)&&(l=l()),l&&Object.assign(Object.assign({},l),u?{offset:u}:{})}function bv(e,t){return Ze(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:Ze(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:Vn(t)}function Bp(e){return e&&e!=="number"&&e!=="time"}function fbe(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const BIt="  ";function _U({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s}){var o,a;if(Bp(n))return $U({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:s});const u=hbe(e,r,i);if(oO(e)){const l=jIt(u,Te(e)?(o=Ji(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,DU(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===Xn.UTC);return l?{signal:l}:void 0}if(t=gbe(Uc(e),t,s),Te(e)&&pn(e.bin)){const l=_e(e,{expr:r,binSuffix:"end"});return{signal:tO(u,l,t,n,s)}}else return t||Uc(e)==="quantitative"?{signal:`${mbe(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function hbe(e,t,n){return Te(e)?n?`${_e(e,{expr:t,suffix:"end"})}-${_e(e,{expr:t,suffix:"start"})}`:_e(e,{expr:t}):LIt(e)}function $U({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s,field:o}){if(o=o??hbe(e,r,i),Te(e)&&pn(e.bin)){const a=_e(e,{expr:r,binSuffix:"end"});return{signal:tO(o,a,t,n,s)}}return{signal:fbe(n,o,t)}}function dbe(e,t,n,r,i,s){var o;if(!Bp(r)){if(oO(e)){const a=Te(e)?(o=Ji(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return zIt(n,a,i,s)}return gbe(t,n,i)}}function pbe(e,t,n){if(e&&(tt(e)||e==="number"||e==="time"))return e;if(oO(t)&&n!=="time"&&n!=="utc")return"time"}function gbe(e,t,n){if(bt(t))return t;if(e===Lp)return n.numberFormat}function zIt(e,t,n,r){return e||(t?{signal:Kye(t)}:r?void 0:n.timeFormat)}function mbe(e,t){return`format(${e}, "${t||""}")`}function KZ(e,t,n,r){var i;return Bp(n)?fbe(n,e,t):mbe(e,(i=bt(t)?t:void 0)!==null&&i!==void 0?i:r.numberFormat)}function tO(e,t,n,r,i){const s=KZ(e,n,r,i),o=KZ(t,n,r,i);return`${vU(e,!1)} ? "null" : ${s} + "${BIt}" + ${o}`}function jIt(e,t,n,r,i){return!t||n?(n=bt(n)?n:r,`${i?"utc":"time"}Format(${e}, '${n}')`):rIt(t,e,i)}const nO="min",UIt={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function ZZ(e){return e in UIt}function ybe(e){return!!e&&!!e.encoding}function ku(e){return!!e&&(e.op==="count"||!!e.field)}function bbe(e){return!!e&&Ye(e)}function HC(e){return"row"in e||"column"in e}function kU(e){return!!e&&"header"in e}function rO(e){return"facet"in e}function WIt(e){return e.selection}function VIt(e){return e&&!bt(e)&&"repeat"in e}function JZ(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function vbe(e){return io(e)&&"sort"in e}function qC({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:s,isMidPoint:o}){if(it(t)&&t.band!==void 0)return t.band;if(Te(t)){const{timeUnit:a,bin:u}=t;if(a&&!n)return o?zp("timeUnitBandPosition",r,s):PZ(r.type)?zp("timeUnitBand",r,s):0;if(pn(u))return PZ(r.type)&&!o?1:.5}if((i==null?void 0:i.fieldChannel)===e&&o)return .5}function EU(e,t,n,r,i,s){return pn(t.bin)||t.timeUnit&&io(t)&&t.type==="temporal"?!!qC({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:s}):!1}function AU(e){return!!e&&"condition"in e}function iO(e){const t=e&&e.condition;return!!t&&!Ye(t)&&Te(t)}function TU(e){const t=e&&e.condition;return!!t&&!Ye(t)&&it(t)}function GIt(e){const t=e&&e.condition;return!!t&&(Ye(t)||lc(t))}function Te(e){return!!e&&(!!e.field||e.aggregate==="count")}function Uc(e){return e&&e.type}function Wh(e){return!!e&&"datum"in e}function pu(e){return io(e)&&Sbe(e)||WL(e)}function WL(e){return Wh(e)&&tr(e.datum)}function it(e){return Te(e)||Wh(e)}function io(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function lc(e){return e&&"value"in e&&"value"in e}function DU(e){return!!e&&("scale"in e||"sort"in e)}function IU(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function xbe(e){return!!e&&"legend"in e}function wbe(e){return!!e&&("format"in e||"formatType"in e)}function HIt(e){return"op"in e}function _e(e,t={}){var n,r,i;let s=e.field;const o=t.prefix;let a=t.suffix,u="";if(qIt(e))s=oTt("count");else{let l;if(!t.nofn)if(HIt(e))l=e.op;else{const{bin:c,aggregate:f,timeUnit:h}=e;pn(c)?(l=Lye(c),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((r=t.suffix)!==null&&r!==void 0?r:"")):f?Ng(f)?(u=`["${s}"]`,s=`argmax_${f.argmax}`):uh(f)?(u=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):h&&(l=iIt(h),a=(!Ze(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((i=t.suffix)!==null&&i!==void 0?i:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?vye(s):t.expr?nTt(s,t.expr)+u:ah(s)+u}function Cbe(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Te(e)&&!!e.bin;case"temporal":return!1}throw new Error(zye(e.type))}function Sbe(e){return!Cbe(e)}function qIt(e){return e.aggregate==="count"}function XIt(e,t){var n;const{field:r,bin:i,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(pn(i))return`${r} (binned)`;if(s){const a=(n=Ji(s))===null||n===void 0?void 0:n.unit;if(a)return`${r} (${gU(a).join("-")})`}else if(o)return Ng(o)?`${r} for max ${o.argmax}`:uh(o)?`${r} for min ${o.argmin}`:`${zF(o)} of ${r}`;return r}function YIt(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(Ng(t))return`${i} for argmax(${t.argmax})`;if(uh(t))return`${i} for argmin(${t.argmin})`;const s=Ji(r),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||pn(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}const _be=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return YIt(e);default:return XIt(e,t)}};let $be=_be;function kbe(e){$be=e}function KIt(){kbe(_be)}function rp(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,s;const a=((i=FU(e))!==null&&i!==void 0?i:{}).title;if(!Te(e))return a;const u=e,l=r?Ebe(u,t):void 0;return n?nr(a,u.title,l):(s=a??u.title)!==null&&s!==void 0?s:l}function FU(e){if(IU(e)&&e.axis)return e.axis;if(xbe(e)&&e.legend)return e.legend;if(kU(e)&&e.header)return e.header}function Ebe(e,t){return $be(e,t)}function KE(e){var t;if(wbe(e)){const{format:n,formatType:r}=e;return{format:n,formatType:r}}else{const n=(t=FU(e))!==null&&t!==void 0?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function ZIt(e,t){if(e.timeUnit)return"temporal";if(pn(e.bin))return"quantitative";switch(h$(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function Wu(e){if(Te(e))return e;if(iO(e))return e.condition}function fr(e){if(it(e))return e;if(TU(e))return e.condition}function VL(e,t,n){if(bt(e)||tr(e)||zC(e)){const r=bt(e)?"string":tr(e)?"number":"boolean";return xe(lDt(t,r,e)),{value:e}}return it(e)?ZE(e,t,n):TU(e)?Object.assign(Object.assign({},e),{condition:ZE(e.condition,t,n)}):e}function ZE(e,t,n){if(wbe(e)){const{format:r,formatType:i}=e,s=Ge(e,["format","formatType"]);if(Bp(i)&&!n.customFormatTypes)return xe(HZ(t)),ZE(s,t,n)}else{const r=IU(e)?"axis":xbe(e)?"legend":kU(e)?"header":null;if(r&&e[r]){const i=e[r],{format:s,formatType:o}=i,a=Ge(i,["format","formatType"]);if(Bp(o)&&!n.customFormatTypes)return xe(HZ(t)),ZE(Object.assign(Object.assign({},e),{[r]:a}),t,n)}}return Te(e)?Abe(e,t):JIt(e)}function JIt(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=tr(n)?"quantitative":bt(n)?"nominal":by(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function Abe(e,t){const{aggregate:n,timeUnit:r,bin:i,field:s}=e,o=Object.assign({},e);if(n&&!oU(n)&&!Ng(n)&&!uh(n)&&(xe(fDt(n)),delete o.aggregate),r&&(o.timeUnit=Ji(r)),s&&(o.field=`${s}`),pn(i)&&(o.bin=sO(i,t)),zi(i)&&!Uu(t)&&xe(`Channel ${t} should not be used with "binned" bin.`),io(o)){const{type:a}=o,u=gIt(a);a!==u&&(o.type=u),a!=="quantitative"&&Eye(n)&&(xe(cDt(a,n)),o.type="quantitative")}else if(!Nye(t)){const a=ZIt(o,t);xe(hDt(t,a)),o.type=a}if(io(o)){const{compatible:a,warning:u}=QIt(o,t);a||xe(u)}if(vbe(o)&&bt(o.sort)){const{sort:a}=o;if(ZZ(a))return Object.assign(Object.assign({},o),{sort:{encoding:a}});const u=a.substr(1);if(a.charAt(0)==="-"&&ZZ(u))return Object.assign(Object.assign({},o),{sort:{encoding:u,order:"descending"}})}if(kU(o)){const{header:a}=o,{orient:u}=a,l=Ge(a,["orient"]);if(u)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},l),{labelOrient:a.labelOrient||u,titleOrient:a.titleOrient||u})})}return o}function sO(e,t){return zC(e)?{maxbins:BZ(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:BZ(t)}):e}const Qh={compatible:!0};function QIt(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Xl:case Yl:case HF:return Sbe(e)?{compatible:!1,warning:gDt(t)}:Qh;case On:case pr:case Ds:case cl:case fl:case UC:case VC:case qF:case Pp:case XF:case YF:case Mg:case Va:case al:case KF:return Qh;case ll:case Lo:case ul:case Ga:return n!==Lp?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Qh;case Ec:case Rh:case Ph:case Lh:case kc:case $c:case _c:case Wa:case ol:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:Qh;case Bh:return Ze(["ordinal","nominal"],e.type)?Qh:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Is:return Ze(["ordinal","nominal","geojson"],e.type)?Qh:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case WC:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Qh}}function oO(e){const{formatType:t}=KE(e);return t==="time"||!t&&eFt(e)}function eFt(e){return e&&(e.type==="temporal"||Te(e)&&!!e.timeUnit)}function OU(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var s;const o=t&&((s=Ji(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",u;return tt(e)?u=e.signal:by(e)?(a=!0,u=Qx(e)):(bt(e)||tr(e))&&a&&(u=`datetime(${JSON.stringify(e)})`,QDt(o)&&(tr(e)&&e<1e4||bt(e)&&isNaN(Date.parse(e)))&&(u=Qx({[o]:e}))),u?r&&a?`time(${u})`:u:i?void 0:JSON.stringify(e)}function Tbe(e,t){const{type:n}=e;return t.map(r=>{const i=OU(r,{timeUnit:Te(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return i!==void 0?{signal:i}:r})}function XC(e,t){return pn(e.bin)?jh(t)&&Ze(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function Dbe(e){const{anchor:t,frame:n,offset:r,orient:i,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:h}=e,d=Ge(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},d),s?{fill:s}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),h?{subtitlePadding:h}:{}),y=Kx(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:y,nonMark:m,subtitle:g}}function Wc(e){return bt(e)||Ye(e)&&bt(e[0])}function Vn(e){return tt(e)?e:e!==void 0?{value:e}:void 0}function QZ(e){return tt(e)?e.signal:Tt(e.value)}function e2(e){return tt(e)?e.signal:e==null?null:Tt(e)}function tFt(e,t,n){for(const r of n){const i=zp(r,t.markDef,t.config);i!==void 0&&(e[r]=Vn(i))}return e}function Ibe(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Gt(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:s}=r;return i&&t[i]!==void 0?t[i]:t[e]!==void 0?t[e]:s&&(!i||i===e)?void 0:zp(e,t,n,r)}function zp(e,t,n,{vgChannel:r}={}){return nr(r?JE(e,t,n.style):void 0,JE(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function JE(e,t,n){return Fbe(e,Ibe(t),n)}function Fbe(e,t,n){t=qn(t);let r;for(const i of t){const s=n[i];s&&s[e]!==void 0&&(r=s[e])}return r}function Obe(e,t){return qn(e).reduce((n,r)=>{var i;return n.field.push(_e(r,t)),n.order.push((i=r.sort)!==null&&i!==void 0?i:"ascending"),n},{field:[],order:[]})}function Nbe(e,t){const n=[...e];return t.forEach(r=>{for(const i of n)if(jC(i,r))return;n.push(r)}),n}function Mbe(e,t){return jC(e,t)||!t?e:e?[...qn(e),...qn(t)].join(", "):t}function Rbe(e,t){const n=e.value,r=t.value;if(n==null||r===null)return{explicit:e.explicit,value:null};if((Wc(n)||tt(n))&&(Wc(r)||tt(r)))return{explicit:e.explicit,value:Mbe(n,r)};if(Wc(n)||tt(n))return{explicit:e.explicit,value:n};if(Wc(r)||tt(r))return{explicit:e.explicit,value:r};if(!Wc(n)&&!tt(n)&&!Wc(r)&&!tt(r))return{explicit:e.explicit,value:Nbe(n,r)};throw new Error("It should never reach here")}function ip(e,t){const n=e&&e[t];return n?Ye(n)?Zx(n,r=>!!r.field):Te(n)||iO(n):!1}function NU(e){return Zx(Fye,t=>{if(ip(e,t)){const n=e[t];if(Ye(n))return Zx(n,r=>!!r.aggregate);{const r=Wu(n);return r&&!!r.aggregate}}return!1})}function MU(e,t){const n=[],r=[],i=[],s=[],o={};return RU(e,(a,u)=>{if(Te(a)){const{field:l,aggregate:c,bin:f,timeUnit:h}=a,d=Ge(a,["field","aggregate","bin","timeUnit"]);if(c||h||f){const p=FU(a),m=p&&p.title;let g=_e(a,{forAs:!0});const y=Object.assign(Object.assign(Object.assign({},m?[]:{title:rp(a,t,{allowDisabling:!0})}),d),{field:g});if(c){let b;if(Ng(c)?(b="argmax",g=_e({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${g}.${l}`):uh(c)?(b="argmin",g=_e({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${g}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(b=c),b){const x={op:b,as:g};l&&(x.field=l),s.push(x)}}else if(n.push(g),io(a)&&pn(f)){if(r.push({bin:f,field:l,as:g}),n.push(_e(a,{binSuffix:"end"})),XC(a,u)&&n.push(_e(a,{binSuffix:"range"})),Uu(u)){const b={field:g+"_end"};o[u+"2"]=b}y.bin="binned",Nye(u)||(y.type=Lp)}else if(h){i.push({timeUnit:h,field:l,as:g});const b=io(a)&&a.type!==E0&&"time";b&&(u===UC||u===Pp?y.formatType=b:WTt(u)?y.legend=Object.assign({formatType:b},y.legend):Uu(u)&&(y.axis=Object.assign({formatType:b},y.axis)))}o[u]=y}else n.push(l),o[u]=e[u]}else o[u]=e[u]}),{bins:r,timeUnits:i,aggregate:s,groupby:n,encoding:o}}function nFt(e,t,n){const r=GTt(t,n);if(r){if(r==="binned"){const i=e[t===Wa?On:pr];return!!(Te(i)&&Te(e[t])&&zi(i.bin))}}else return!1;return!0}function rFt(e,t,n){const r=t.type;return Se(e).reduce((i,s)=>{if(!Oye(s))return xe(pDt(s)),i;const o=e[s];if(s==="angle"&&r==="arc"&&!e.theta&&(xe(uDt),s=Va),!nFt(e,s,r))return xe(eO(s,r)),i;if(s===kc&&r==="line"){const a=Wu(e[s]);if(a!=null&&a.aggregate)return xe(dDt),i}if(s===Ds&&(t.filled?"fill"in e:"stroke"in e))return xe(jye("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(s===VC||s===WC&&!Ye(o)&&!lc(o)||s===Pp&&Ye(o))o&&(i[s]=qn(o).reduce((a,u)=>(Te(u)?a.push(Abe(u,s)):xe(jL(u,s)),a),[]));else{if(s===Pp&&o===null)i[s]=null;else if(!Te(o)&&!Wh(o)&&!lc(o)&&!AU(o)&&!tt(o))return xe(jL(o,s)),i;i[s]=VL(o,s,n)}return i},{})}function iFt(e){const t=[];for(const n of Se(e))if(ip(e,n)){const r=e[n],i=qn(r);for(const s of i)Te(s)?t.push(s):iO(s)&&t.push(s.condition)}return t}function RU(e,t,n){if(e)for(const r of Se(e)){const i=e[r];if(Ye(i))for(const s of i)t.call(n,s,r);else t.call(n,i,r)}}function Pbe(e,t,n,r){return e?Se(e).reduce((i,s)=>{const o=e[s];return Ye(o)?o.reduce((a,u)=>t.call(r,a,u,s),i):t.call(r,i,o,s)},n):n}function Lbe(e,t){return Se(t).reduce((n,r)=>{switch(r){case On:case pr:case XF:case KF:case YF:case Wa:case ol:case Va:case $c:case al:case _c:case ul:case ll:case Ga:case Lo:case UC:case Is:case Mg:case Pp:return n;case WC:if(e==="line"||e==="trail")return n;case VC:case qF:{const i=t[r];if(Ye(i)||Te(i))for(const s of qn(i))s.aggregate||n.push(_e(s,{}));return n}case kc:if(e==="trail")return n;case Ds:case cl:case fl:case Ec:case Rh:case Ph:case Bh:case Lh:{const i=Wu(t[r]);return i&&!i.aggregate&&n.push(_e(i,{})),n}}},[])}function sFt(e){const{tooltip:t}=e,n=Ge(e,["tooltip"]);if(!t)return{filteredEncoding:e};let r,i;if(Ye(t)){for(const s of t)s.aggregate?(r||(r=[]),r.push(s)):(i||(i=[]),i.push(s));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return Ye(i)&&i.length===1&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}function GL(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:s,titlePrefix:o})=>{const a=r?` of ${t.field}`:"";return{field:s+t.field,type:t.type,title:tt(o)?{signal:o+`"${escape(a)}"`}:o+a}}),...iFt(n)]}}function Bbe(e){const{axis:t,title:n,field:r}=e;return t&&t.title!==void 0?void 0:nr(n,r)}function PU(e,t,n,r,i){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,aria:f,extraEncoding:h={}})=>{const d=Bbe(n);return zbe(e,a,i,f,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},bt(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),h)})}}function zbe(e,t,n,r,i){const{clip:s,color:o,opacity:a}=e,u=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),s?{clip:s}:{}),o?{color:o}:{}),a?{opacity:a}:{}),ju(i.mark)?i.mark:{type:i.mark}),{style:`${u}-${t}`}),zC(e[t])?{}:e[t]),r===!1?{aria:r}:{})})]:[]}function jbe(e,t,n){const{encoding:r}=e,i=t==="vertical"?"y":"x",s=r[i],o=r[i+"2"],a=r[i+"Error"],u=r[i+"Error2"];return{continuousAxisChannelDef:m_(s,n),continuousAxisChannelDef2:m_(o,n),continuousAxisChannelDefError:m_(a,n),continuousAxisChannelDefError2:m_(u,n),continuousAxis:i}}function m_(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=Ge(e,["aggregate"]);return n!==t&&xe(zDt(n,t)),r}else return e}function Ube(e,t){const{mark:n,encoding:r}=e,{x:i,y:s}=r;if(pu(i)){if(pu(s)){const o=Te(i)&&i.aggregate,a=Te(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return ju(n)&&n.orient?n.orient:"vertical"}return"horizontal"}else{if(pu(s))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}}const QE="boxplot",oFt=["box","median","outliers","rule","ticks"],aFt=new GF(QE,Vbe);function Wbe(e){return tr(e)?"tukey":e}function Vbe(e,{config:t}){var n,r;const{mark:i,encoding:s,selection:o,projection:a}=e,u=Ge(e,["mark","encoding","selection","projection"]),l=ju(i)?i:{type:i};o&&xe(Bye("boxplot"));const c=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Gt("size",l,t),h=Wbe(c),{transform:d,continuousAxisChannelDef:p,continuousAxis:m,groupby:g,aggregate:y,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:v,customTooltipWithoutAggregatedField:w}=uFt(e,c,t),{color:C,size:S}=b,_=Ge(b,["color","size"]),$=A=>PU(l,m,p,A,t.boxplot),k=$(_),E=$(b),F=$(Object.assign(Object.assign({},_),S?{size:S}:{})),T=GL([{fieldPrefix:h==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:h==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,b),I={type:"tick",color:"black",opacity:1,orient:x,invalid:null},D=h==="min-max"?T:GL([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,b),N=[...k({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:D}),...k({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:D}),...k({partName:"ticks",mark:I,positionPrefix:"lower_whisker",aria:!1,extraEncoding:D}),...k({partName:"ticks",mark:I,positionPrefix:"upper_whisker",aria:!1,extraEncoding:D})],V=[...h!=="tukey"?N:[],...E({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:v,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:T}),...F({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Fr(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:x,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:T})];let U;if(h!=="min-max"){const A=`datum["lower_box_${p.field}"]`,M=`datum["upper_box_${p.field}"]`,P=`(${M} - ${A})`,j=`${A} - ${c} * ${P}`,q=`${M} + ${c} * ${P}`,B=`datum["${p.field}"]`,O={joinaggregate:Gbe(p.field),groupby:g};let G;h==="tukey"&&(G={transform:[{filter:`(${j} <= ${B}) && (${B} <= ${q})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...y],groupby:g}],layer:N});const Z=Ge(_,["tooltip"]),{scale:re,axis:R}=p,H=Bbe(p),Y=zbe(l,"outliers",t.boxplot,!0,{transform:[{filter:`(${B} < ${j}) || (${B} > ${q})`}],mark:"point",encoding:Object.assign(Object.assign({[m]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},H!==void 0?{title:H}:{}),re!==void 0?{scale:re}:{}),R!==void 0?{axis:R}:{})},Z),w?{tooltip:w}:{})})[0];Y&&G?U={transform:[O],layer:[Y,G]}:Y?(U=Y,U.transform.unshift(O)):G&&(U=G,U.transform.unshift(O))}return U?Object.assign(Object.assign({},u),{layer:[U,{transform:d,layer:V}]}):Object.assign(Object.assign({},u),{transform:((r=u.transform)!==null&&r!==void 0?r:[]).concat(d),layer:V})}function Gbe(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function uFt(e,t,n){const r=Ube(e,QE),{continuousAxisChannelDef:i,continuousAxis:s}=jbe(e,r,QE),o=i.field,a=Wbe(t),u=[...Gbe(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=s;c[f];const h=Ge(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:d,filteredEncoding:p}=sFt(h),{bins:m,timeUnits:g,aggregate:y,groupby:b,encoding:x}=MU(p,n),v=r==="vertical"?"horizontal":"vertical",w=r;return{transform:[...m,...g,{aggregate:[...y,...u],groupby:b},...l],groupby:b,aggregate:y,continuousAxisChannelDef:i,continuousAxis:s,encodingWithoutContinuousAxis:x,ticksOrient:v,boxOrient:w,customTooltipWithoutAggregatedField:d}}const LU="errorbar",lFt=["ticks","rule"],cFt=new GF(LU,Hbe);function Hbe(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:l}=qbe(e,LU,t),c=PU(a,i,r,s,t.errorbar),f={type:"tick",orient:o},h=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),h.length>1?{layer:h}:Object.assign({},h[0]))}function fFt(e,t){const{encoding:n}=e;if(hFt(n))return{orient:Ube(e,t),inputType:"raw"};const r=dFt(n),i=pFt(n),s=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(it(a)&&it(u))throw new Error(`${t} cannot have both x2 and y2`);if(it(a)){if(pu(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(it(u)){if(pu(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(it(u)&&!it(a))throw new Error(`${t} cannot have xError2 without xError`);if(it(c)&&!it(l))throw new Error(`${t} cannot have yError2 without yError`);if(it(a)&&it(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(it(a)){if(pu(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(it(l)){if(pu(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function hFt(e){return(it(e.x)||it(e.y))&&!it(e.x2)&&!it(e.y2)&&!it(e.xError)&&!it(e.xError2)&&!it(e.yError)&&!it(e.yError2)}function dFt(e){return it(e.x2)||it(e.y2)}function pFt(e){return it(e.xError)||it(e.xError2)||it(e.yError)||it(e.yError2)}function qbe(e,t,n){var r;const{mark:i,encoding:s,selection:o,projection:a}=e,u=Ge(e,["mark","encoding","selection","projection"]),l=ju(i)?i:{type:i};o&&xe(Bye(t));const{orient:c,inputType:f}=fFt(e,t),{continuousAxisChannelDef:h,continuousAxisChannelDef2:d,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:g}=jbe(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:b,tooltipSummary:x,tooltipTitleWithFieldName:v}=gFt(l,h,d,p,m,f,t,n),w=s,C=g;w[C];const S=g==="x"?"x2":"y2";w[S];const _=g==="x"?"xError":"yError";w[_];const $=g==="x"?"xError2":"yError2";w[$];const k=Ge(w,[typeof C=="symbol"?C:C+"",typeof S=="symbol"?S:S+"",typeof _=="symbol"?_:_+"",typeof $=="symbol"?$:$+""]),{bins:E,timeUnits:F,aggregate:T,groupby:I,encoding:D}=MU(k,n),N=[...T,...y],V=f!=="raw"?[]:I,U=GL(x,h,D,v);return{transform:[...(r=u.transform)!==null&&r!==void 0?r:[],...E,...F,...N.length===0?[]:[{aggregate:N,groupby:V}],...b],groupby:V,continuousAxisChannelDef:h,continuousAxis:g,encodingWithoutContinuousAxis:D,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:U}}function gFt(e,t,n,r,i,s,o,a){let u=[],l=[];const c=t.field;let f,h=!1;if(s==="raw"){const d=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:d==="mean"?"stderr":"iqr";if(d==="median"!=(p==="iqr")&&xe(BDt(d,p,o)),p==="stderr"||p==="stdev")u=[{op:p,field:c,as:"extent_"+c},{op:d,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:zF(d)},{fieldPrefix:"upper_",titlePrefix:eJ(d,p,"+")},{fieldPrefix:"lower_",titlePrefix:eJ(d,p,"-")}],h=!0;else{e.center&&e.extent&&xe(jDt(e.extent,o));let m,g,y;p==="ci"?(m="mean",g="ci0",y="ci1"):(m="median",g="q1",y="q3"),u=[{op:g,field:c,as:"lower_"+c},{op:y,field:c,as:"upper_"+c},{op:m,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:rp({field:c,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:rp({field:c,aggregate:g,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:rp({field:c,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&xe(LDt(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?l.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const d of l)f.push({fieldPrefix:d.as.substring(0,6),titlePrefix:$0($0(d.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:h}}function eJ(e,t,n){return zF(e)+" "+n+" "+t}const BU="errorband",mFt=["band","borders"],yFt=new GF(BU,Xbe);function Xbe(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=qbe(e,BU,t),l=o,c=PU(l,i,r,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let h={type:f?"area":"rect"},d={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(h=Object.assign(Object.assign(Object.assign({},h),p),{ariaRoleDescription:"errorband"}),d=Object.assign(Object.assign({},d),p)):l.interpolate?xe(XZ("interpolate")):l.tension&&xe(XZ("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const Ybe={};function zU(e,t,n){const r=new GF(e,t);Ybe[e]={normalizer:r,parts:n}}function bFt(){return Se(Ybe)}zU(QE,Vbe,oFt);zU(LU,Hbe,lFt);zU(BU,Xbe,mFt);const vFt=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Kbe=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],xFt={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},wFt={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},CFt={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},A0="_vgsid_",SFt={single:{on:"click",fields:[A0],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[A0],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function jU(e){return!!e&&(e==="legend"||!!e.legend)}function eM(e){return jU(e)&&Fr(e)}function _Ft(e){return aO(e)||WU(e)||UU(e)}function UU(e){return"concat"in e}function aO(e){return"vconcat"in e}function WU(e){return"hconcat"in e}function Vu(e){return Fr(e)&&e.step!==void 0}function tJ(e){return e.view||e.width||e.height}const nJ=20,$Ft={align:1,bounds:1,center:1,columns:1,spacing:1},kFt=Se($Ft);function EFt(e,t,n){var r,i;const s=n[t],o={},{spacing:a,columns:u}=s;a!==void 0&&(o.spacing=a),u!==void 0&&(rO(e)&&!HC(e.facet)||UU(e))&&(o.columns=u),aO(e)&&(o.columns=1);for(const l of kFt)if(e[l]!==void 0)if(l==="spacing"){const c=e[l];o[l]=tr(c)?c:{row:(r=c.row)!==null&&r!==void 0?r:a,column:(i=c.column)!==null&&i!==void 0?i:a}}else o[l]=e[l];return o}function HL(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function eA(e,t){const n=t2(e,t);return Vu(n)?n.step:VU}function t2(e,t){var n;const r=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return nr(r,{step:e.step})}const VU=20,AFt={continuousWidth:200,continuousHeight:200,step:VU},TFt={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:AFt,mark:bTt,arc:{},area:{},bar:xTt,circle:{},geoshape:{},image:{},line:{},point:{},rect:wTt,rule:{color:"black"},square:{},text:{color:"black"},tick:CTt,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:TIt,projection:{},legend:wFt,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:SFt,style:{},title:{},facet:{spacing:nJ},concat:{spacing:nJ}},wl=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],rJ={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},iJ={blue:wl[0],orange:wl[1],red:wl[2],teal:wl[3],green:wl[4],yellow:wl[5],purple:wl[6],pink:wl[7],brown:wl[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function DFt(e={}){return{signals:[{name:"color",value:Fr(e)?Object.assign(Object.assign({},iJ),e):iJ}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function IFt(e){return{signals:[{name:"fontSize",value:Fr(e)?Object.assign(Object.assign({},rJ),e):rJ}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function FFt(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function Zbe(e={}){const{color:t,font:n,fontSize:r}=e,i=Ge(e,["color","font","fontSize"]);return hye({},TFt,n?FFt(n):{},t?DFt(t):{},r?IFt(r):{},i||{})}const OFt=["view",...$ye],NFt=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],MFt=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},yTt);function RFt(e){e=vt(e);for(const t of NFt)delete e[t];if(e.axis)for(const t in e.axis)nU(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of vFt)delete e.legend[t];if(e.mark){for(const t of LZ)delete e.mark[t];e.mark.tooltip&&Fr(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of OFt){for(const r of LZ)delete e[t][r];const n=MFt[t];if(n)for(const r of n)delete e[t][r];LFt(e,t)}for(const t of bFt())delete e[t];PFt(e);for(const t in e)Fr(e[t])&&on(e[t])&&delete e[t];return on(e)?void 0:e}function PFt(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=Dbe(e.title);on(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),on(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),on(r)?delete e.title:e.title=r}function LFt(e,t,n,r){const i=r?e[t][r]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},i),e.style[n??t]);on(s)||(e.style[n??t]=s),r||delete e[t]}function uO(e){return"layer"in e}function BFt(e){return"repeat"in e}function zFt(e){return!Ye(e.repeat)&&e.repeat.layer}class Jbe{map(t,n){return rO(t)?this.mapFacet(t,n):BFt(t)?this.mapRepeat(t,n):WU(t)?this.mapHConcat(t,n):aO(t)?this.mapVConcat(t,n):UU(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(uO(t))return this.mapLayer(t,n);if(Sc(t))return this.mapUnit(t,n);throw new Error(fU(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(r=>this.mapLayerOrUnit(r,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(r=>this.map(r,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(r=>this.map(r,n))})}mapConcat(t,n){const{concat:r}=t,i=Ge(t,["concat"]);return Object.assign(Object.assign({},i),{concat:r.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const jFt={zero:1,center:1,normalize:1};function UFt(e){return e in jFt}const WFt=new Set([Cye,UF,jF,HE,VF,iU,sU,WF,Sye,rU]),VFt=new Set([UF,jF,Cye]);function sJ(e,t){var n,r;const i=t==="x"?"y":"radius",s=e[t],o=e[i];if(Te(s)&&Te(o))if(Uc(s)==="quantitative"&&Uc(o)==="quantitative"){if(s.stack)return t;if(o.stack)return i;const a=Te(s)&&!!s.aggregate,u=Te(o)&&!!o.aggregate;if(a!==u)return a?t:i;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,c=(r=o.scale)===null||r===void 0?void 0:r.type;if(l&&l!=="linear")return i;if(c&&c!=="linear")return t}}else{if(Uc(s)==="quantitative")return t;if(Uc(o)==="quantitative")return i}else{if(Uc(s)==="quantitative")return t;if(Uc(o)==="quantitative")return i}}function GFt(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Qbe(e,t,n={}){const r=ju(e)?e.type:e;if(!WFt.has(r))return null;const i=sJ(t,"x")||sJ(t,"theta");if(!i)return null;const s=t[i],o=Te(s)?_e(s,{}):void 0;let a=GFt(i),u=t[a],l=Te(u)?_e(u,{}):void 0;l===o&&(l=void 0,u=void 0,a=void 0);const c=zTt.reduce((h,d)=>{if(d!=="tooltip"&&ip(t,d)){const p=t[d];for(const m of qn(p)){const g=Wu(m);if(g.aggregate)continue;const y=_e(g,{});(!y||y!==l)&&h.push({channel:d,fieldDef:g})}}return h},[]);let f;if(s.stack!==void 0?zC(s.stack)?f=s.stack?"zero":null:f=s.stack:c.length>0&&VFt.has(r)&&(f="zero"),!f||!UFt(f)||NU(t)&&c.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==Xn.LINEAR){if(n.disallowNonLinearStack)return null;xe(MDt(s.scale.type))}return it(t[hl(i)])?(s.stack!==void 0&&xe(NDt(i)),null):(Te(s)&&s.aggregate&&!Ze(ATt,s.aggregate)&&xe(RDt(s.aggregate)),{groupbyChannel:u?a:void 0,groupbyField:l,fieldChannel:i,impute:s.impute===null?!1:Og(r),stackBy:c,offset:f})}function HFt(e){const t=Ge(e,["point","line"]);return Se(t).length>1?t:t.type}function qFt(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:ql(e[t],["point","line"])}));return e}function tM(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?Fr(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?Fr(t.point)?t.point:{}:void 0}function oJ(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class XFt{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(Sc(t)){const{mark:r,encoding:i}=t,s=ju(r)?r:{type:r};switch(s.type){case"line":case"rule":case"trail":return!!tM(s,n[s.type],i);case"area":return!!tM(s,n[s.type],i)||!!oJ(s,n[s.type])}}return!1}run(t,n,r){const{config:i}=n,{selection:s,projection:o,encoding:a,mark:u}=t,l=Ge(t,["selection","projection","encoding","mark"]),c=ju(u)?u:{type:u},f=tM(c,i[c.type],a),h=c.type==="area"&&oJ(c,i[c.type]),d=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:HFt(Object.assign(Object.assign({},c.type==="area"&&c.opacity===void 0&&c.fillOpacity===void 0?{opacity:.7}:{}),c)),encoding:ql(a,["shape"])})],p=Qbe(c,a);let m=a;if(p){const{fieldChannel:g,offset:y}=p;m=Object.assign(Object.assign({},a),{[g]:Object.assign(Object.assign({},a[g]),y?{stack:y}:{})})}return h&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},Kx(c,["clip","interpolate","tension","tooltip"])),h),encoding:m})),f&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Kx(c,["clip","tooltip"])),f),encoding:m})),r(Object.assign(Object.assign({},l),{layer:d}),Object.assign(Object.assign({},n),{config:qFt(i)}))}}class YFt{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(Sc(t)&&t.encoding)for(const r of Bo){const i=t.encoding[r];if(i&&it(i)&&!((n=i==null?void 0:i.scale)===null||n===void 0)&&n.rangeStep)return!0}return!1}run(t){var n;const r={};let i=Object.assign({},t.encoding);for(const s of Bo){const o=dl(s),a=i[s];if(a&&it(a)&&!((n=a==null?void 0:a.scale)===null||n===void 0)&&n.rangeStep){const{scale:u}=a,l=Ge(a,["scale"]),c=u,f=Ge(c,["rangeStep"]);r[o]={step:u.rangeStep},xe(vDt),i=Object.assign(Object.assign({},i),{[s]:Object.assign(Object.assign({},l),on(f)?{}:{scale:f})})}}return Object.assign(Object.assign(Object.assign({},r),t),{encoding:i})}}function KFt(e,t){return t?HC(e)?tve(e,t):eve(e,t):e}function nM(e,t){return t?tve(e,t):e}function qL(e,t,n){const r=t[e];if(VIt(r)){if(r.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[r.repeat]});xe(tDt(r.repeat));return}return t}function eve(e,t){if(e=qL("field",e,t),e!==void 0){if(e===null)return null;if(vbe(e)&&ku(e.sort)){const n=qL("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function aJ(e,t){if(Te(e))return eve(e,t);{const n=qL("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function uJ(e,t){if(it(e)){const n=aJ(e,t);if(n)return n;if(AU(e))return{condition:e.condition}}else{if(TU(e)){const n=aJ(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):Ge(e,["condition"])}return e}}function tve(e,t){const n={};for(const r in e)if(zd(e,r)){const i=e[r];if(Ye(i))n[r]=i.map(s=>uJ(s,t)).filter(s=>s);else{const s=uJ(i,t);s!==void 0&&(n[r]=s)}}return n}class ZFt{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Sc(t)){const{encoding:n,mark:r}=t;if(r==="line")for(const i of LTt){const s=Rg(i),o=n[s];if(n[i]&&(Te(o)&&!zi(o.bin)||Wh(o)))return!0}}return!1}run(t,n,r){const{encoding:i}=t;return xe(yDt(!!i.x2,!!i.y2)),r(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}class JFt extends Jbe{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[aFt,cFt,yFt,new XFt,new ZFt,new YFt]}map(t,n){if(Sc(t)){const r=ip(t.encoding,Xl),i=ip(t.encoding,Yl),s=ip(t.encoding,HF);if(r||i||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:r,parentProjection:i}=n,s=Object.assign(Object.assign({},t),{encoding:nM(t.encoding,n.repeater)});if(r||i)return this.mapUnitWithParentEncodingOrProjection(s,n);const o=this.mapLayerOrUnit.bind(this);for(const a of this.nonFacetUnitNormalizers)if(a.hasMatchingType(s,n.config))return a.run(s,n,o);return s}mapRepeat(t,n){return zFt(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:r,spec:i}=t,s=Ge(t,["repeat","spec"]),{row:o,column:a,layer:u}=r,{repeater:l={},repeaterPrefix:c=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:u},spec:i}}),n):Object.assign(Object.assign({},s),{layer:u.map(f=>{const h=Object.assign(Object.assign({},l),{layer:f}),d=(i.name||"")+c+`child__layer_${En(f)}`,p=this.mapLayerOrUnit(i,Object.assign(Object.assign({},n),{repeater:h,repeaterPrefix:d}));return p.name=d,p})})}mapNonLayerRepeat(t,n){var r;const{repeat:i,spec:s,data:o}=t,a=Ge(t,["repeat","spec","data"]);!Ye(i)&&t.columns&&(t=ql(t,["columns"]),xe(VZ("repeat")));const u=[],{repeater:l={},repeaterPrefix:c=""}=n,f=!Ye(i)&&i.row||[l?l.row:null],h=!Ye(i)&&i.column||[l?l.column:null],d=Ye(i)&&i||[l?l.repeat:null];for(const m of d)for(const g of f)for(const y of h){const b={repeat:m,row:g,column:y,layer:l.layer},x=(s.name||"")+c+"child__"+(Ye(i)?`${En(m)}`:(i.row?`row_${En(g)}`:"")+(i.column?`column_${En(y)}`:"")),v=this.map(s,Object.assign(Object.assign({},n),{repeater:b,repeaterPrefix:x}));v.name=x,u.push(ql(v,["data"]))}const p=Ye(i)?t.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(r=s.data)!==null&&r!==void 0?r:o,align:"all"},a),{columns:p,concat:u})}mapFacet(t,n){const{facet:r}=t;return HC(r)&&t.columns&&(t=ql(t,["columns"]),xe(VZ("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:r,projection:i}=t,{parentEncoding:s,parentProjection:o,config:a}=n,u=cJ({parentProjection:o,projection:i}),l=lJ({parentEncoding:s,encoding:nM(r,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),u?{projection:u}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const r=t.encoding,{row:i,column:s,facet:o}=r,a=Ge(r,["row","column","facet"]),{mark:u,width:l,projection:c,height:f,view:h,selection:d,encoding:p}=t,m=Ge(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:y}=this.getFacetMappingAndLayout({row:i,column:s,facet:o},n),b=nM(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},m),y),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),h?{view:h}:{}),c?{projection:c}:{}),{mark:u,encoding:b}),d?{selection:d}:{})}),n)}getFacetMappingAndLayout(t,n){var r;const{row:i,column:s,facet:o}=t;if(i||s){o&&xe(mDt([...i?[Xl]:[],...s?[Yl]:[]]));const a={},u={};for(const l of[Xl,Yl]){const c=t[l];if(c){const f=Ge(c,["align","center","spacing","columns"]);a[l]=f;for(const h of["align","center","spacing"])c[h]!==void 0&&(u[h]=(r=u[h])!==null&&r!==void 0?r:{},u[h][l]=c[h])}}return{facetMapping:a,layout:u}}else{const{align:a,center:u,spacing:l,columns:c}=o,f=Ge(o,["align","center","spacing","columns"]);return{facetMapping:KFt(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),u?{center:u}:{}),l?{spacing:l}:{}),c?{columns:c}:{})}}}mapLayer(t,n){var{parentEncoding:r,parentProjection:i}=n,s=Ge(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,u=Ge(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:lJ({parentEncoding:r,encoding:o}),parentProjection:cJ({parentProjection:i,projection:a})});return super.mapLayer(u,l)}}function lJ(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const i=Se(t).reduce((s,o)=>(n[o]&&s.push(o),s),[]);i.length>0&&xe(oDt(i))}const r=Object.assign(Object.assign({},t??{}),n??{});return on(r)?void 0:r}function cJ(e){const{parentProjection:t,projection:n}=e;return t&&n&&xe(aDt({parentProjection:t,projection:n})),n??t}function nve(e,t){t===void 0&&(t=Zbe(e.config));const n=eOt(e,t),{width:r,height:i}=e,s=tOt(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const QFt=new JFt;function eOt(e,t={}){return QFt.map(e,{config:t})}function fJ(e){return bt(e)?{type:e}:e??{}}function tOt(e,t,n){let{width:r,height:i}=t;const s=Sc(e)||uO(e),o={};s?r=="container"&&i=="container"?(o.type="fit",o.contains="padding"):r=="container"?(o.type="fit-x",o.contains="padding"):i=="container"&&(o.type="fit-y",o.contains="padding"):(r=="container"&&(xe(zZ("width")),r=void 0),i=="container"&&(xe(zZ("height")),i=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?fJ(n.autosize):{}),fJ(e.autosize));if(a.type==="fit"&&!s&&(xe(XTt),a.type="pad"),r=="container"&&!(a.type=="fit"||a.type=="fit-x")&&xe(jZ("width")),i=="container"&&!(a.type=="fit"||a.type=="fit-y")&&xe(jZ("height")),!jC(a,{type:"pad"}))return a}function nOt(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function rOt(e){return e?`fit-${ZF(e)}`:"fit"}const iOt=["background","padding"];function hJ(e){return iOt.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class Ac{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new Ac(vt(this.explicit),vt(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return nr(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,r){return delete this[r?"implicit":"explicit"][t],this[r?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of Se(t.combine())){const r=t.getWithExplicit(n);this.setWithExplicit(n,r)}}}function jd(e){return{explicit:!0,value:e}}function Ls(e){return{explicit:!1,value:e}}function rve(e){return(t,n,r,i)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:lO(t,n,r,i)}}function lO(e,t,n,r){return e.explicit&&t.explicit&&xe(EDt(n,r,e.value,t.value)),e}function ch(e,t,n,r,i=lO){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:jC(e.value,t.value)?e:i(e,t,n,r)}class sOt extends Ac{constructor(t={},n={},r=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=r}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function n2(e){return"url"in e}function tA(e){return"values"in e}function ive(e){return"name"in e&&!n2(e)&&!tA(e)&&!sp(e)}function sp(e){return e&&(sve(e)||ove(e)||GU(e))}function sve(e){return"sequence"in e}function ove(e){return"sphere"in e}function GU(e){return"graticule"in e}const ci="main",nA="raw";function ave(e){return"filter"in e}function oOt(e){return(e==null?void 0:e.stop)!==void 0}function aOt(e){return"lookup"in e}function uOt(e){return"data"in e}function lOt(e){return"selection"in e}function cOt(e){return"pivot"in e}function fOt(e){return"density"in e}function hOt(e){return"quantile"in e}function dOt(e){return"regression"in e}function pOt(e){return"loess"in e}function gOt(e){return"sample"in e}function mOt(e){return"window"in e}function yOt(e){return"joinaggregate"in e}function bOt(e){return"flatten"in e}function vOt(e){return"calculate"in e}function xOt(e){return"bin"in e}function wOt(e){return"impute"in e}function COt(e){return"timeUnit"in e}function SOt(e){return"aggregate"in e}function _Ot(e){return"stack"in e}function $Ot(e){return"fold"in e}function kOt(e){return e.map(t=>ave(t)?{filter:f$(t.filter,dIt)}:t)}function YC(e,t,n,r){const i=AU(t)&&t.condition,s=r(t);if(i){const a=qn(i).map(u=>{const l=r(u),c=WIt(u)?Ove(e,u.selection):oA(e,u.test);return Object.assign({test:c},l)});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function HU(e,t="text"){const n=e.encoding[t];return YC(e,n,t,r=>cO(r,e.config))}function cO(e,t,n="datum"){if(e){if(lc(e))return Vn(e.value);if(it(e)){const{format:r,formatType:i}=KE(e);return _U({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function uve(e,t={}){const{encoding:n,markDef:r,config:i,stack:s}=e,o=n.tooltip;if(Ye(o))return{tooltip:dJ({tooltip:o},s,i,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return YC(e,o,"tooltip",u=>{const l=cO(u,i,a);if(l)return l;if(u===null)return;let c=Gt("tooltip",r,i);if(c===!0&&(c={content:"encoding"}),bt(c))return{value:c};if(Fr(c))return c.content==="encoding"?dJ(n,s,i,t):{signal:a}})}}function lve(e,t,n,{reactiveGeom:r}={}){const i={},s=r?"datum.datum":"datum",o=[];function a(l,c){const f=Rg(c),h=io(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),d=qn(rp(h,n,{allowDisabling:!1})).join(", ");let p;if(Uu(c)){const m=c==="x"?"x2":"y2",g=Wu(e[m]);if(zi(h.bin)&&g){const y=_e(h,{expr:s}),b=_e(g,{expr:s}),{format:x,formatType:v}=KE(h);p=tO(y,b,x,v,n),i[m]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:y,formatType:b}=KE(h);p=_U({fieldOrDatumDef:h,format:y,formatType:b,expr:s,config:n,normalizeStack:!0}).signal}}p=p??cO(h,n,s).signal,o.push({channel:c,key:d,value:p})}RU(e,(l,c)=>{Te(l)?a(l,c):iO(l)&&a(l.condition,c)});const u={};for(const{channel:l,key:c,value:f}of o)!i[l]&&!u[c]&&(u[Tt(c)]=f);return u}function dJ(e,t,n,{reactiveGeom:r}={}){const i=lve(e,t,n,{reactiveGeom:r}),s=yye(i).map(({key:o,value:a})=>`${o}: ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function EOt(e){const{markDef:t,config:n}=e,r=Gt("aria",t,n);return r===!1?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),AOt(e)),TOt(e))}function AOt(e){const{mark:t,markDef:n,config:r}=e;if(r.aria===!1)return{};const i=Gt("ariaRoleDescription",n,r);return i!=null?{ariaRoleDescription:{value:i}}:t in lIt?{}:{ariaRoleDescription:{value:t}}}function TOt(e){const{encoding:t,markDef:n,config:r,stack:i}=e,s=t.description;if(s)return YC(e,s,"description",u=>cO(u,e.config));const o=Gt("description",n,r);if(o!=null)return{description:Vn(o)};if(r.aria===!1)return{};const a=lve(t,i,r);if(!on(a))return{description:{signal:yye(a).map(({key:u,value:l})=>`${u} + ": " + (${l})`).join(' + "; " + ')}}}function Sr(e,t,n={}){const{markDef:r,encoding:i,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u=u??Gt(e,r,s,{vgChannel:o,ignoreVgConfig:!0}),u!==void 0&&(a=Vn(u)));const l=i[e];return YC(t,l,o??e,c=>cbe({channel:e,channelDef:c,markDef:r,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function cve(e,t={filled:void 0}){var n,r,i,s;const{markDef:o,encoding:a,config:u}=e,{type:l}=o,c=(n=t.filled)!==null&&n!==void 0?n:Gt("filled",o,u),f=Ze(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,h=(i=(r=Gt(c===!0?"color":void 0,o,u,{vgChannel:"fill"}))!==null&&r!==void 0?r:u.mark[c===!0&&"color"])!==null&&i!==void 0?i:f,d=(s=Gt(c===!1?"color":void 0,o,u,{vgChannel:"stroke"}))!==null&&s!==void 0?s:u.mark[c===!1&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},h?{fill:Vn(h)}:{}),d?{stroke:Vn(d)}:{});return o.color&&(c?o.fill:o.stroke)&&xe(jye("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),Sr("color",e,{vgChannel:p,defaultValue:c?h:d})),Sr("fill",e,{defaultValue:a.fill?h:void 0})),Sr("stroke",e,{defaultValue:a.stroke?d:void 0}))}function r2(e,t){const n=BTt(e),r=t[n];if(r)return r}function mi(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:s,markDef:o,config:a,stack:u}=t,l=s[e],c=s[hl(e)],f=t.scaleName(e),h=t.getScaleComponent(e),d=r2(e,o),p=qU({model:t,defaultPos:n,channel:e,scaleName:f,scale:h}),m=!l&&Uu(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:DOt({channel:e,channelDef:l,channel2Def:c,markDef:o,config:a,isMidPoint:i,scaleName:f,scale:h,stack:u,offset:d,defaultRef:p});return m?{[r||e]:m}:void 0}function DOt(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:s,offset:o,markDef:a,config:u}=e;if(it(n)&&s&&t===s.fieldChannel){if(Te(n)){const l=qC({channel:t,fieldDef:n,isMidPoint:r,markDef:a,stack:s,config:u});if(l!==void 0)return YE({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:l,offset:o})}return np(n,i,{suffix:"end"},{offset:o})}return CU(e)}function qU({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:s,config:o}=e;return()=>{const a=Rg(n),u=lh(n),l=Gt(n,s,o,{vgChannel:u});if(l!==void 0)return bv(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const c=i.get("type");if(!Ze([Xn.LOG,Xn.TIME,Xn.UTC],c)){if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[dl(n)];return Object.assign(Object.assign({},c),{mult:.5})}}}}const IOt={left:"x",center:"xc",right:"x2"},FOt={top:"y",middle:"yc",bottom:"y2"};function fve(e,t,n,r="middle"){if(e==="radius"||e==="theta")return lh(e);const s=Gt(e==="x"?"align":"baseline",t,n);return e==="x"?IOt[s||(r==="top"?"left":"center")]:FOt[s||r]}function rA(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?hve(e,t,{defaultPos:n,defaultPos2:r}):mi(e,t,{defaultPos:n})}function hve(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:s}=t,o=hl(e),a=dl(e),u=OOt(t,r,o),l=u[a]?fve(e,i,s):lh(e);return Object.assign(Object.assign({},mi(e,t,{defaultPos:n,vgChannel:l})),u)}function OOt(e,t,n){const{encoding:r,mark:i,markDef:s,stack:o,config:a}=e,u=Rg(n),l=dl(n),c=lh(n),f=r[u],h=e.scaleName(u),d=e.getScaleComponent(u),p=n in r||n in s?r2(n,e.markDef):r2(u,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const m=NOt({channel:n,channelDef:f,channel2Def:r[n],markDef:s,config:a,scaleName:h,scale:d,stack:o,offset:p,defaultRef:void 0});return m!==void 0?{[c]:m}:y_(n,s)||y_(n,{[n]:JE(n,s,a.style),[l]:JE(l,s,a.style)})||y_(n,a[i])||y_(n,a.mark)||{[c]:qU({model:e,defaultPos:t,channel:n,scaleName:h,scale:d})()}}function NOt({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l}){return it(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?np(t,s,{suffix:"start"},{offset:u}):CU({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:r,config:i,offset:u,defaultRef:l})}function y_(e,t){const n=dl(e),r=lh(e);if(t[r]!==void 0)return{[r]:bv(e,t[r])};if(t[e]!==void 0)return{[r]:bv(e,t[e])};if(t[n])return{[n]:bv(e,t[n])}}function fh(e,t,n){var r,i,s,o;const{config:a,encoding:u,markDef:l,stack:c}=e,f=hl(t),h=dl(t),d=u[t],p=u[f],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,y=e.scaleName(t),b=l.orient,x=(i=(r=u[h])!==null&&r!==void 0?r:u.size)!==null&&i!==void 0?i:Gt("size",l,a,{vgChannel:h}),v=n==="bar"&&(t==="x"?b==="vertical":b==="horizontal");if(Te(d)&&(pn(d.bin)||zi(d.bin)||d.timeUnit&&!p)&&!x&&!Fs(g)){const w=qC({channel:t,fieldDef:d,stack:c,markDef:l,config:a}),C=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],S=(o=C==null?void 0:C.get("translate"))!==null&&o!==void 0?o:.5;return POt({fieldDef:d,fieldDef2:p,channel:t,markDef:l,scaleName:y,band:w,axisTranslate:S,spacing:Uu(t)?Gt("binSpacing",l,a):void 0,reverse:m.get("reverse"),config:a})}else return(it(d)&&Fs(g)||v)&&!p?ROt(n,d,t,e):hve(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function MOt(e,t,n,r,i,s){if(r){const u=r.get("type");if(u==="point"||u==="band"){if(i[e].discreteBandSize!==void 0)return{value:i[e].discreteBandSize};if(u===Xn.POINT){const l=r.get("range");return Uh(l)&&tr(l.step)?{value:l.step-2}:{value:VU-2}}else return{scale:n,band:s}}else return{value:i[e].continuousBandSize}}const o=eA(i.view,t),a=nr(i[e].discreteBandSize,o-2);return a!==void 0?{value:a}:void 0}function ROt(e,t,n,r){var i;const{markDef:s,encoding:o,config:a,stack:u}=r,l=s.orient,c=r.scaleName(n),f=r.getScaleComponent(n),h=dl(n),d=hl(n),p=l==="horizontal"&&n==="y"||l==="vertical"&&n==="x",m=Gt(p?"size":h,s,a,{vgChannel:h});let g;(o.size||m!==void 0)&&(p?g=Sr("size",r,{vgChannel:h,defaultValue:m}):xe(_Dt(s.type)));const y=(i=it(t)?qC({channel:n,fieldDef:t,markDef:s,stack:u,config:a}):void 0)!==null&&i!==void 0?i:1;g=g||{[h]:MOt(e,h,c,f,a,y)};const b=(f==null?void 0:f.get("type"))!=="band"||!("band"in g[h]),x=fve(n,s,a,b?"middle":"top"),v=r2(n,s),w=CU({channel:n,channelDef:t,markDef:s,config:a,scaleName:c,scale:f,stack:u,offset:v,defaultRef:qU({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:b?.5:(1-y)/2});if(h)return Object.assign({[x]:w},g);{const C=lh(d),S=g[h],_=v?Object.assign(Object.assign({},S),{offset:v}):S;return{[x]:w,[C]:Ye(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:_})]:Object.assign(Object.assign({},w),{offset:_})}}}function lb(e,t,n,r,i){if(Tye(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(tt(n)){const o=e2(i);return{signal:`${n.signal} ? ${r-s}${o?"-"+o:""} : ${r+s}${o?"+"+o:""}`}}else{if(tt(i)){const o=r+(n?-s:s);return{signal:`${o||""}${n?" - ":o?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-s:+i+s)}}function POt({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:s,spacing:o=0,axisTranslate:a,reverse:u,config:l}){const c=hl(n),f=lh(n),h=lh(c),d=r2(n,s);if(pn(e.bin)||e.timeUnit)return{[h]:pJ({channel:n,fieldDef:e,scaleName:i,markDef:s,band:(1-r)/2,offset:lb(c,o,u,a,d),config:l}),[f]:pJ({channel:n,fieldDef:e,scaleName:i,markDef:s,band:1-(1-r)/2,offset:lb(n,o,u,a,d),config:l})};if(zi(e.bin)){const p=np(e,i,{},{offset:lb(c,o,u,a,d)});if(Te(t))return{[h]:p,[f]:np(t,i,{},{offset:lb(n,o,u,a,d)})};if(GC(e.bin)&&e.bin.step)return{[h]:p,[f]:{signal:`scale("${i}", ${_e(e,{expr:"datum"})} + ${e.bin.step})`,offset:lb(n,o,u,a,d)}}}xe(Vye(c))}function pJ({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:s,config:o}){const a=YE({scaleName:n,fieldOrDatumDef:t,band:i,offset:s});return lbe({fieldDef:t,channel:e,markDef:r,ref:a,config:o})}const LOt=new Set(["aria"]);function qo(e,t){const{fill:n=void 0,stroke:r=void 0}=t.color==="include"?cve(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},BOt(e.markDef,t)),gJ(e,"fill",n)),gJ(e,"stroke",r)),Sr("opacity",e)),Sr("fillOpacity",e)),Sr("strokeOpacity",e)),Sr("strokeWidth",e)),Sr("strokeDash",e)),uve(e)),HU(e,"href")),EOt(e))}function gJ(e,t,n){const{config:r,mark:i,markDef:s}=e;if(Gt("invalid",s,r)==="hide"&&n&&!Og(i)){const a=zOt(e,{invalid:!0,channels:JF});if(a)return{[t]:[{test:a,value:null},...qn(n)]}}return n?{[t]:n}:{}}function BOt(e,t){return uIt.reduce((n,r)=>(!LOt.has(r)&&e[r]!==void 0&&t[r]!=="ignore"&&(n[r]=Vn(e[r])),n),{})}function zOt(e,{invalid:t=!1,channels:n}){const r=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&zo(u)&&(s[l]=!0)}return s},{}),i=Se(r);if(i.length>0){const s=t?"||":"&&";return i.map(o=>SU(o,t)).join(` ${s} `)}}function XU(e){const{config:t,markDef:n}=e;if(Gt("invalid",n,t)){const i=jOt(e,{channels:Bo});if(i)return{defined:{signal:i}}}return{}}function jOt(e,{invalid:t=!1,channels:n}){const r=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&zo(u)&&(s[l]=!0)}return s},{}),i=Se(r);if(i.length>0){const s=t?"||":"&&";return i.map(o=>SU(o,t)).join(` ${s} `)}}function mJ(e,t){if(t!==void 0)return{[e]:Vn(t)}}const rM="voronoi",dve={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(rM)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,s=e.mark;if(Og(s))return xe(KTt(s)),n;const o={name:e.getName(rM),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},uve(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((l,c)=>{var f;const h=(f=l.name)!==null&&f!==void 0?f:"";h===e.component.mark[0].name?a=c:h.indexOf(rM)>=0&&(u=!0)}),u||n.splice(a+1,0,o),n}};class nn{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.indexOf(t)>-1){console.warn("Attempt to add the same child twice.");return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class Gi extends nn{constructor(t,n,r,i){super(t,n),this.type=r,this.refCounts=i,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${sTt()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class Eu extends nn{constructor(t,n){super(t),this.formula=n}clone(){return new Eu(null,vt(this.formula))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,o)=>{const{field:a,timeUnit:u}=s,l=Rn(n)?n.encoding[hl(o)]:void 0,c=Rn(n)&&EU(o,s,l,n.stack,n.markDef,n.config);if(u){const f=_e(s,{forAs:!0});i[Ot({as:f,field:a,timeUnit:u})]=Object.assign({as:f,field:a,timeUnit:u},c?{band:!0}:{})}return i},{});return on(r)?null:new Eu(t,r)}static makeFromTransform(t,n){const r=Object.assign({},n),{timeUnit:i}=r,s=Ge(r,["timeUnit"]),o=Ji(i),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Eu(t,{[Ot(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)(!this.formula[n]||t.formula[n].band)&&(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(Cf(this.formula).map(t=>t.as))}dependentFields(){return new Set(Cf(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${Ot(this.formula)}`}assemble(){const t=[];for(const n of Cf(this.formula)){const{field:r,as:i,timeUnit:s}=n,o=Ji(s),{unit:a,utc:u}=o,l=Ge(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:ah(r),type:"timeunit"},a?{units:gU(a)}:{}),u?{timezone:"utc"}:{}),l),{as:[i,`${i}_end`]}))}return t}}const KC="_tuple_fields";class UOt{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const WOt={has:()=>!0,parse:(e,t,n)=>{var r,i,s;const o=t.name,a=(r=t.project)!==null&&r!==void 0?r:t.project=new UOt,u={},l={},c=new Set,f=(h,d)=>{const p=d==="visual"?h.channel:h.field;let m=En(`${o}_${p}`);for(let g=1;c.has(m);g++)m=En(`${o}_${p}_${g}`);return c.add(m),{[d]:m}};if(!n.fields&&!n.encodings){const h=e.config.selection[n.type];if(n.init)for(const d of qn(n.init))for(const p of Se(d))PTt(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(xe('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=h.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=h.encodings,n.fields=h.fields}for(const h of(i=n.fields)!==null&&i!==void 0?i:[]){const d={type:"E",field:h};d.signals=Object.assign({},f(d,"data")),a.items.push(d),a.hasField[h]=d}for(const h of(s=n.encodings)!==null&&s!==void 0?s:[]){const d=e.fieldDef(h);if(d){let p=d.field;if(d.aggregate){xe(YTt(h,d.aggregate));continue}else if(!p){xe(WZ(h));continue}if(d.timeUnit){p=e.vgField(h);const m={timeUnit:d.timeUnit,as:p,field:d.field};l[Ot(m)]=m}if(!u[p]){let m="E";if(t.type==="interval"){const y=e.getScaleComponent(h).get("type");zo(y)&&(m="R")}else d.bin&&(m="R-RE");const g={field:p,channel:h,type:m};g.signals=Object.assign(Object.assign({},f(g,"data")),f(g,"visual")),a.items.push(u[p]=g),a.hasField[p]=a.hasChannel[h]=u[p]}}else xe(WZ(h))}if(n.init){const h=d=>a.items.map(p=>d[p.channel]!==void 0?d[p.channel]:d[p.field]);if(n.type==="interval")t.init=h(n.init);else{const d=qn(n.init);t.init=d.map(h)}}on(l)||(a.timeUnit=new Eu(null,l))},signals:(e,t,n)=>{const r=t.name+KC;return n.filter(s=>s.name===r).length>0?n:n.concat({name:r,value:t.project.items.map(s=>{const o=Ge(s,["signals","hasLegend"]);return o.field=ah(o.field),o})})}},pve={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!jU(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,s=t.bind,o=t.init&&t.init[0],a=dve.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((u,l)=>{var c,f;const h=En(`${r}_${u.field}`);n.filter(p=>p.name===h).length||n.unshift(Object.assign(Object.assign({name:h},o?{init:T0(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${Tt(u.field)}] : null`}]:[],bind:(f=(c=s[u.field])!==null&&c!==void 0?c:s[u.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.filter(l=>l.name===r+Gu)[0],o=r+KC,a=i.items.map(l=>En(`${r}_${l.field}`)),u=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},iA="_toggle",gve={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+iA,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Gu,r=t.name+iA;return`${r} ? null : ${n}, `+(t.resolve==="global"?`${r} ? null : true, `:`${r} ? null : {unit: ${Kl(e)}}, `)+`${r} ? ${n} : null`}},VOt={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=bt(n.clear)?Dg(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(pve.has(t))for(const r of t.project.items){const i=n.findIndex(s=>s.name===En(`${t.name}_${r.field}`));i!==-1&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(i,s){i!==-1&&n[i].on&&n[i].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const i of t.project.items){const s=n.findIndex(o=>o.name===i.signals.visual);if(r(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===i.signals.data);r(o,"null")}}else{let i=n.findIndex(s=>s.name===t.name+Gu);r(i,"null"),gve.has(t)&&(i=n.findIndex(s=>s.name===t.name+iA),r(i,"false"))}return n}},hh={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!jh(i))continue;const s=e.getScaleComponent(i),o=s?s.get("type"):void 0;if(!s||!zo(o)){xe(JTt);continue}const a={selection:t.name,field:r.field};s.set("selectionExtent",a,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||YL(e)||r.length===0)return n;const i=n.filter(o=>o.name===t.name)[0];let s=i.update;if(s.indexOf(_ve)>=0)i.update=`{${r.map(o=>`${Tt(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of r){const a=`${Tt(o.field)}: ${o.signals.data}`;s.indexOf(a)<0&&(s=`${s.substring(0,s.length-1)}, ${a}}`)}i.update=s}return n.concat(r.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!YL(e))for(const r of t.scales){const i=n.filter(s=>s.name===r.signals.data)[0];i.push="outer",delete i.value,delete i.update}return n}};function XL(e,t){return`domain(${Tt(e.scaleName(t))})`}function YL(e){var t;return e.parent&&$y(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:YL(e.parent.parent))}const mve={has:e=>{const t=e.resolve==="global"&&e.bind&&jU(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==A0;return t&&!n&&xe(QTt),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const u of t.events)u.filter=qn((i=u.filter)!==null&&i!==void 0?i:[]),u.filter.indexOf(a)<0&&u.filter.push(a)}const s=eM(t.bind)?t.bind.legend:"click",o=bt(s)?Dg(s,"view"):qn(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=eM(t.bind)&&t.bind.legend,s=o=>a=>{const u=vt(a);return u.markname=o,u};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${En(o.field)}_legend`,u=`${r}_${a}`;if(n.filter(c=>c.name===u).length===0){const c=i.merge.map(s(`${a}_symbols`)).concat(i.merge.map(s(`${a}_labels`))).concat(i.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:u},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.find(h=>h.name===r+Gu),o=r+KC,a=i.items.filter(h=>h.hasLegend).map(h=>En(`${r}_${En(h.field)}_legend`)),l=`${a.map(h=>`${h} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(h=>({signal:h})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const c=n.find(h=>h.name===r+iA),f=eM(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function GOt(e,t,n){var r;const i=(r=e.fieldDef(t))===null||r===void 0?void 0:r.field;Pg(e,s=>{var o,a;const u=(o=s.project.hasField[i])!==null&&o!==void 0?o:s.project.hasChannel[t];if(u&&mve.has(s)){const l=(a=n.get("selections"))!==null&&a!==void 0?a:[];l.push(s.name),n.set("selections",l,!1),u.hasLegend=!0}})}const yve="_translate_anchor",bve="_translate_delta",HOt={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const r=t.name,i=hh.has(t),s=r+yve,{x:o,y:a}=t.project.hasChannel;let u=Dg(t.translate,"scope");return i||(u=u.map(l=>(l.between[0].markname=r+vv,l))),n.push({name:s,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(i?XL(e,On):`slice(${o.signals.visual})`):"")+(a!==void 0?", extent_y: "+(i?XL(e,pr):`slice(${a.signals.visual})`):"")+"}"}]},{name:r+bve,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&yJ(e,t,o,"width",n),a!==void 0&&yJ(e,t,a,"height",n),n}};function yJ(e,t,n,r,i){var s;const o=t.name,a=o+yve,u=o+bve,l=n.channel,c=hh.has(t),f=i.filter(v=>v.name===n.signals[c?"data":"visual"])[0],h=e.getSizeSignalRef(r).signal,d=e.getScaleComponent(l),p=d.get("type"),m=c&&l===On?"-":"",g=`${a}.extent_${l}`,y=`${m}${u}.${l} / `+(c?`${h}`:`span(${g})`),x=`${c?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear"}(${g}, ${y}`+(c&&p==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";f.on.push({events:{signal:u},update:c?x:`clampRange(${x}, 0, ${h})`})}const vve="_zoom_anchor",xve="_zoom_delta",qOt={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=hh.has(t),s=r+xve,{x:o,y:a}=t.project.hasChannel,u=Tt(e.scaleName(On)),l=Tt(e.scaleName(pr));let c=Dg(t.zoom,"scope");return i||(c=c.map(f=>(f.markname=r+vv,f))),n.push({name:r+vve,on:[{events:c,update:i?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&bJ(e,t,o,"width",n),a!==void 0&&bJ(e,t,a,"height",n),n}};function bJ(e,t,n,r,i){var s;const o=t.name,a=n.channel,u=hh.has(t),l=i.filter(b=>b.name===n.signals[u?"data":"visual"])[0],c=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(a),h=f.get("type"),d=u?XL(e,a):l.name,p=o+xve,m=`${o}${vve}.${a}`,y=`${u?h==="log"?"zoomLog":h==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${d}, ${m}, ${p}`+(u&&h==="pow"?`, ${(s=f.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";l.on.push({events:{signal:p},update:u?y:`clampRange(${y}, 0, ${c})`})}const XOt=[WOt,gve,hh,mve,HOt,qOt,pve,dve,VOt];function fO(e,t){for(const n of XOt)n.has(e)&&t(n)}function T0(e,t=!0,n=BAt){if(Ye(e)){const r=e.map(i=>T0(i,t,n));return t?`[${r.join(", ")}]`:r}else if(by(e))return n(t?Qx(e):JDt(e));return t?n(JSON.stringify(e)):e}function YOt(e,t){return Pg(e,(n,r)=>{const i=n.name;let s=r.modifyExpr(e,n);t.push(...r.signals(e,n)),fO(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(s=o.modifyExpr(e,n,s))}),t.push({name:i+sNt,on:[{events:{signal:n.name+Gu},update:`modify(${Tt(n.name+jp)}, ${s})`}]})}),YU(t)}function KOt(e,t){if(e.component.selection&&Se(e.component.selection).length){const n=Tt(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Dg("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return YU(t)}function ZOt(e,t){let n=!1;return Pg(e,(r,i)=>{const s=r.name,o=Tt(s+jp);if(t.filter(u=>u.name===s).length===0){const u=r.resolve==="global"?"union":r.resolve,l=r.type==="multi"?", true)":")";t.push({name:r.name,update:`${_ve}(${o}, ${Tt(u)}${l}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),fO(r,u=>{u.topLevelSignals&&(t=u.topLevelSignals(e,r,t))})}),n&&t.filter(i=>i.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),YU(t)}function JOt(e,t){const n=[...t];return Pg(e,r=>{const i={name:r.name+jp};if(r.init){const o=r.project.items.map(u=>Ge(u,["signals"])),a=r.init.map(u=>T0(u,!1));i.values=r.type==="interval"?[{unit:Kl(e,{escape:!1}),fields:o,values:a}]:a.map(u=>({unit:Kl(e,{escape:!1}),fields:o,values:u}))}n.filter(o=>o.name===r.name+jp).length||n.push(i)}),n}function wve(e,t){return Pg(e,(n,r)=>{t=r.marks?r.marks(e,n,t):t,fO(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function QOt(e,t){for(const n of e.children)Rn(n)&&(t=wve(n,t));return t}function eNt(e,t){const n=t.selection,r=e.getSelectionComponent(n,En(n));return{signal:Nve(r,t)}}function YU(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const vv="_brush",KL="_scale_trigger",tNt={signals:(e,t)=>{const n=t.name,r=n+KC,i=hh.has(t),s=[],o=[],a=[];if(t.translate&&!i){const c=`!event.item || event.item.mark.name !== ${Tt(n+vv)}`;Cve(t,(f,h)=>{var d;const p=qn((d=h.between[0].filter)!==null&&d!==void 0?d:h.between[0].filter=[]);return p.indexOf(c)<0&&p.push(c),f})}t.project.items.forEach((c,f)=>{const h=c.channel;if(h!==On&&h!==pr){xe("Interval selections only support x and y encoding channels.");return}const d=t.init?t.init[f]:null,p=nNt(e,t,c,d),m=c.signals.data,g=c.signals.visual,y=Tt(e.scaleName(h)),b=e.getScaleComponent(h).get("type"),x=zo(b)?"+":"";s.push(...p),o.push(m),a.push({scaleName:e.scaleName(h),expr:`(!isArray(${m}) || (${x}invert(${y}, ${g})[0] === ${x}${m}[0] && ${x}invert(${y}, ${g})[1] === ${x}${m}[1]))`})}),i||s.push({name:n+KL,value:{},on:[{events:a.map(c=>({scale:c.scaleName})),update:a.map(c=>c.expr).join(" && ")+` ? ${n+KL} : {}`}]});const u=t.init,l=`unit: ${Kl(e)}, fields: ${r}, values`;return s.concat(Object.assign(Object.assign({name:n+Gu},u?{init:`{${l}: ${T0(u)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${l}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+Gu+", "+(t.resolve==="global"?"true":`{unit: ${Kl(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:s}=t.project.hasChannel,o=i&&i.signals.visual,a=s&&s.signals.visual,u=`data(${Tt(t.name+jp)})`;if(hh.has(t))return n;const l={x:i!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:i!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const g of Se(l))l[g]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${Kl(e)}`},l[g]),{value:0}];const c=t.mark,{fill:f,fillOpacity:h,cursor:d}=c,p=Ge(c,["fill","fillOpacity","cursor"]),m=Se(p).reduce((g,y)=>(g[y]=[{test:[i!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(b=>b).join(" && "),value:p[y]},{value:null}],g),{});return[{name:r+vv+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:h}},update:l}},...n,{name:r+vv,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},d?{cursor:{value:d}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function nNt(e,t,n,r){const i=n.channel,s=n.signals.visual,o=n.signals.data,a=hh.has(t),u=Tt(e.scaleName(i)),l=e.getScaleComponent(i),c=l?l.get("type"):void 0,f=m=>`scale(${u}, ${m})`,h=e.getSizeSignalRef(i===On?"width":"height").signal,d=`${i}(unit)`,p=Cve(t,(m,g)=>[...m,{events:g.between[0],update:`[${d}, ${d}]`},{events:g,update:`[${s}[0], clamp(${d}, 0, ${h})]`}]);return p.push({events:{signal:t.name+KL},update:zo(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},r?{init:T0(r,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:T0(r)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${u}, ${s})`}]})]}function Cve(e,t){return e.events.reduce((n,r)=>r.between?t(n,r):(xe(`${r} is not an ordered event stream for interval selections.`),n),[])}function Sve(e,t){const n=t.name,r=n+KC,i=t.project,s="(item().isVoronoi ? datum.datum : datum)",o=i.items.map(l=>{const c=e.fieldDef(l.channel);return c&&c.bin?`[${s}[${Tt(e.vgField(l.channel,{}))}], ${s}[${Tt(e.vgField(l.channel,{binSuffix:"end"}))}]]`:`${s}[${Tt(l.field)}]`}).join(", "),a=`unit: ${Kl(e)}, fields: ${r}, values`,u=t.events;return[{name:n+Gu,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${o}]} : null`,force:!0}]:[]}]}const rNt={signals:Sve,modifyExpr:(e,t)=>t.name+Gu+", "+(t.resolve==="global"?"null":`{unit: ${Kl(e)}}`)},iNt={signals:Sve,modifyExpr:(e,t)=>t.name+Gu+", "+(t.resolve==="global"?"true":`{unit: ${Kl(e)}}`)},jp="_store",Gu="_tuple",sNt="_modify",_ve="vlSelectionResolve",oNt={single:iNt,multi:rNt,interval:tNt};function Pg(e,t){const n=e.component.selection;if(n){for(const r of Cf(n))if(t(r,oNt[r.type])===!0)break}}function aNt(e){let t=e.parent;for(;t&&!_a(t);)t=t.parent;return t}function Kl(e,{escape:t}={escape:!0}){let n=t?Tt(e.name):e.name;const r=aNt(e);if(r){const{facet:i}=r;for(const s of Eo)i[s]&&(n+=` + '__facet_${s}_' + (facet[${Tt(r.vgField(s))}])`)}return n}function KU(e){let t=!1;return Pg(e,n=>{t=t||n.project.items.some(r=>r.field===A0)}),t}const uNt="RawCode",lNt="Literal",cNt="Property",fNt="Identifier",hNt="ArrayExpression",dNt="BinaryExpression",pNt="CallExpression",gNt="ConditionalExpression",mNt="LogicalExpression",yNt="MemberExpression",bNt="ObjectExpression",vNt="UnaryExpression";function Ha(e){this.type=e}Ha.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=xNt(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function xNt(e){switch(e.type){case hNt:return e.elements;case dNt:case mNt:return[e.left,e.right];case pNt:return[e.callee].concat(e.arguments);case gNt:return[e.test,e.consequent,e.alternate];case yNt:return[e.object,e.property];case bNt:return e.properties;case cNt:return[e.key,e.value];case vNt:return[e.argument];case fNt:case lNt:case uNt:default:return[]}}var pl,Be,me,ki,Kt,hO=1,ZC=2,Up=3,Vh=4,dO=5,Lg=6,cs=7,JC=8,wNt=9;pl={};pl[hO]="Boolean";pl[ZC]="<end>";pl[Up]="Identifier";pl[Vh]="Keyword";pl[dO]="Null";pl[Lg]="Numeric";pl[cs]="Punctuator";pl[JC]="String";pl[wNt]="RegularExpression";var CNt="ArrayExpression",SNt="BinaryExpression",_Nt="CallExpression",$Nt="ConditionalExpression",$ve="Identifier",kNt="Literal",ENt="LogicalExpression",ANt="MemberExpression",TNt="ObjectExpression",DNt="Property",INt="UnaryExpression",Xr="Unexpected token %0",FNt="Unexpected number",ONt="Unexpected string",NNt="Unexpected identifier",MNt="Unexpected reserved word",RNt="Unexpected end of input",ZL="Invalid regular expression",iM="Invalid regular expression: missing /",kve="Octal literals are not allowed in strict mode.",PNt="Duplicate data property in object literal not allowed in strict mode",yi="ILLEGAL",i2="Disabled.",LNt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),BNt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function pO(e,t){if(!e)throw new Error("ASSERT: "+t)}function El(e){return e>=48&&e<=57}function ZU(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function xv(e){return"01234567".indexOf(e)>=0}function zNt(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function s2(e){return e===10||e===13||e===8232||e===8233}function QC(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&LNt.test(String.fromCharCode(e))}function sA(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&BNt.test(String.fromCharCode(e))}var jNt={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Eve(){for(var e;me<ki&&(e=Be.charCodeAt(me),zNt(e)||s2(e));)++me}function JL(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)me<ki&&ZU(Be[me])?(r=Be[me++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):Bt({},Xr,yi);return String.fromCharCode(i)}function UNt(){var e,t,n,r;for(e=Be[me],t=0,e==="}"&&Bt({},Xr,yi);me<ki&&(e=Be[me++],!!ZU(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Bt({},Xr,yi),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function Ave(){var e,t;for(e=Be.charCodeAt(me++),t=String.fromCharCode(e),e===92&&(Be.charCodeAt(me)!==117&&Bt({},Xr,yi),++me,e=JL("u"),(!e||e==="\\"||!QC(e.charCodeAt(0)))&&Bt({},Xr,yi),t=e);me<ki&&(e=Be.charCodeAt(me),!!sA(e));)++me,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Be.charCodeAt(me)!==117&&Bt({},Xr,yi),++me,e=JL("u"),(!e||e==="\\"||!sA(e.charCodeAt(0)))&&Bt({},Xr,yi),t+=e);return t}function WNt(){var e,t;for(e=me++;me<ki;){if(t=Be.charCodeAt(me),t===92)return me=e,Ave();if(sA(t))++me;else break}return Be.slice(e,me)}function VNt(){var e,t,n;return e=me,t=Be.charCodeAt(me)===92?Ave():WNt(),t.length===1?n=Up:jNt.hasOwnProperty(t)?n=Vh:t==="null"?n=dO:t==="true"||t==="false"?n=hO:n=Up,{type:n,value:t,start:e,end:me}}function sM(){var e=me,t=Be.charCodeAt(me),n,r=Be[me],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++me,{type:cs,value:String.fromCharCode(t),start:e,end:me};default:if(n=Be.charCodeAt(me+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return me+=2,{type:cs,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:me};case 33:case 61:return me+=2,Be.charCodeAt(me)===61&&++me,{type:cs,value:Be.slice(e,me),start:e,end:me}}}if(o=Be.substr(me,4),o===">>>=")return me+=4,{type:cs,value:o,start:e,end:me};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return me+=3,{type:cs,value:s,start:e,end:me};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return me+=2,{type:cs,value:i,start:e,end:me};if("<>=!+-*%&|^/".indexOf(r)>=0)return++me,{type:cs,value:r,start:e,end:me};Bt({},Xr,yi)}function GNt(e){for(var t="";me<ki&&ZU(Be[me]);)t+=Be[me++];return t.length===0&&Bt({},Xr,yi),QC(Be.charCodeAt(me))&&Bt({},Xr,yi),{type:Lg,value:parseInt("0x"+t,16),start:e,end:me}}function HNt(e){for(var t="0"+Be[me++];me<ki&&xv(Be[me]);)t+=Be[me++];return(QC(Be.charCodeAt(me))||El(Be.charCodeAt(me)))&&Bt({},Xr,yi),{type:Lg,value:parseInt(t,8),octal:!0,start:e,end:me}}function vJ(){var e,t,n;if(n=Be[me],pO(El(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=me,e="",n!=="."){if(e=Be[me++],n=Be[me],e==="0"){if(n==="x"||n==="X")return++me,GNt(t);if(xv(n))return HNt(t);n&&El(n.charCodeAt(0))&&Bt({},Xr,yi)}for(;El(Be.charCodeAt(me));)e+=Be[me++];n=Be[me]}if(n==="."){for(e+=Be[me++];El(Be.charCodeAt(me));)e+=Be[me++];n=Be[me]}if(n==="e"||n==="E")if(e+=Be[me++],n=Be[me],(n==="+"||n==="-")&&(e+=Be[me++]),El(Be.charCodeAt(me)))for(;El(Be.charCodeAt(me));)e+=Be[me++];else Bt({},Xr,yi);return QC(Be.charCodeAt(me))&&Bt({},Xr,yi),{type:Lg,value:parseFloat(e),start:t,end:me}}function qNt(){var e="",t,n,r,i,s=!1;for(t=Be[me],pO(t==="'"||t==='"',"String literal must starts with a quote"),n=me,++me;me<ki;)if(r=Be[me++],r===t){t="";break}else if(r==="\\")if(r=Be[me++],!r||!s2(r.charCodeAt(0)))switch(r){case"u":case"x":Be[me]==="{"?(++me,e+=UNt()):e+=JL(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:xv(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),me<ki&&xv(Be[me])&&(s=!0,i=i*8+"01234567".indexOf(Be[me++]),"0123".indexOf(r)>=0&&me<ki&&xv(Be[me])&&(i=i*8+"01234567".indexOf(Be[me++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&Be[me]===`
`&&++me;else{if(s2(r.charCodeAt(0)))break;e+=r}return t!==""&&Bt({},Xr,yi),{type:JC,value:e,octal:s,start:n,end:me}}function XNt(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(r,i){if(parseInt(i,16)<=1114111)return"x";Bt({},ZL)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{Bt({},ZL)}try{return new RegExp(e,t)}catch{return null}}function YNt(){var e,t,n,r,i;for(e=Be[me],pO(e==="/","Regular expression literal must start with a slash"),t=Be[me++],n=!1,r=!1;me<ki;)if(e=Be[me++],t+=e,e==="\\")e=Be[me++],s2(e.charCodeAt(0))&&Bt({},iM),t+=e;else if(s2(e.charCodeAt(0)))Bt({},iM);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||Bt({},iM),i=t.substr(1,t.length-2),{value:i,literal:t}}function KNt(){var e,t,n;for(t="",n="";me<ki&&(e=Be[me],!!sA(e.charCodeAt(0)));)++me,e==="\\"&&me<ki?Bt({},Xr,yi):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Bt({},ZL,n),{value:n,literal:t}}function ZNt(){var e,t,n,r;return Kt=null,Eve(),e=me,t=YNt(),n=KNt(),r=XNt(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:me}}function JNt(e){return e.type===Up||e.type===Vh||e.type===hO||e.type===dO}function Tve(){var e;return Eve(),me>=ki?{type:ZC,start:me,end:me}:(e=Be.charCodeAt(me),QC(e)?VNt():e===40||e===41||e===59?sM():e===39||e===34?qNt():e===46?El(Be.charCodeAt(me+1))?vJ():sM():El(e)?vJ():sM())}function ms(){var e;return e=Kt,me=e.end,Kt=Tve(),me=e.end,e}function Dve(){var e;e=me,Kt=Tve(),me=e}function QNt(e){var t=new Ha(CNt);return t.elements=e,t}function xJ(e,t,n){var r=new Ha(e==="||"||e==="&&"?ENt:SNt);return r.operator=e,r.left=t,r.right=n,r}function e3t(e,t){var n=new Ha(_Nt);return n.callee=e,n.arguments=t,n}function t3t(e,t,n){var r=new Ha($Nt);return r.test=e,r.consequent=t,r.alternate=n,r}function JU(e){var t=new Ha($ve);return t.name=e,t}function Hb(e){var t=new Ha(kNt);return t.value=e.value,t.raw=Be.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function wJ(e,t,n){var r=new Ha(ANt);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function n3t(e){var t=new Ha(TNt);return t.properties=e,t}function CJ(e,t,n){var r=new Ha(DNt);return r.key=t,r.value=n,r.kind=e,r}function r3t(e,t){var n=new Ha(INt);return n.operator=e,n.argument=t,n.prefix=!0,n}function Bt(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(s,o){return pO(o<r.length,"Message reference must be in range"),r[o]});throw n=new Error(i),n.index=me,n.description=i,n}function gO(e){e.type===ZC&&Bt(e,RNt),e.type===Lg&&Bt(e,FNt),e.type===JC&&Bt(e,ONt),e.type===Up&&Bt(e,NNt),e.type===Vh&&Bt(e,MNt),Bt(e,Xr,e.value)}function Ei(e){var t=ms();(t.type!==cs||t.value!==e)&&gO(t)}function bn(e){return Kt.type===cs&&Kt.value===e}function oM(e){return Kt.type===Vh&&Kt.value===e}function i3t(){var e=[];for(me=Kt.start,Ei("[");!bn("]");)bn(",")?(ms(),e.push(null)):(e.push(Wp()),bn("]")||Ei(","));return ms(),QNt(e)}function SJ(){var e;return me=Kt.start,e=ms(),e.type===JC||e.type===Lg?(e.octal&&Bt(e,kve),Hb(e)):JU(e.value)}function s3t(){var e,t,n,r;if(me=Kt.start,e=Kt,e.type===Up)return n=SJ(),Ei(":"),r=Wp(),CJ("init",n,r);if(e.type===ZC||e.type===cs)gO(e);else return t=SJ(),Ei(":"),r=Wp(),CJ("init",t,r)}function o3t(){var e=[],t,n,r,i={},s=String;for(me=Kt.start,Ei("{");!bn("}");)t=s3t(),t.key.type===$ve?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?Bt({},PNt):i[r]=!0,e.push(t),bn("}")||Ei(",");return Ei("}"),n3t(e)}function a3t(){var e;return Ei("("),e=QU(),Ei(")"),e}var u3t={if:1};function l3t(){var e,t,n;if(bn("("))return a3t();if(bn("["))return i3t();if(bn("{"))return o3t();if(e=Kt.type,me=Kt.start,e===Up||u3t[Kt.value])n=JU(ms().value);else if(e===JC||e===Lg)Kt.octal&&Bt(Kt,kve),n=Hb(ms());else{if(e===Vh)throw new Error(i2);e===hO?(t=ms(),t.value=t.value==="true",n=Hb(t)):e===dO?(t=ms(),t.value=null,n=Hb(t)):bn("/")||bn("/=")?(n=Hb(ZNt()),Dve()):gO(ms())}return n}function c3t(){var e=[];if(Ei("("),!bn(")"))for(;me<ki&&(e.push(Wp()),!bn(")"));)Ei(",");return Ei(")"),e}function f3t(){var e;return me=Kt.start,e=ms(),JNt(e)||gO(e),JU(e.value)}function h3t(){return Ei("."),f3t()}function d3t(){var e;return Ei("["),e=QU(),Ei("]"),e}function p3t(){var e,t,n;for(e=l3t();;)if(bn("."))n=h3t(),e=wJ(".",e,n);else if(bn("("))t=c3t(),e=e3t(e,t);else if(bn("["))n=d3t(),e=wJ("[",e,n);else break;return e}function _J(){var e=p3t();if(Kt.type===cs&&(bn("++")||bn("--")))throw new Error(i2);return e}function d$(){var e,t;if(Kt.type!==cs&&Kt.type!==Vh)t=_J();else{if(bn("++")||bn("--"))throw new Error(i2);if(bn("+")||bn("-")||bn("~")||bn("!"))e=ms(),t=d$(),t=r3t(e.value,t);else{if(oM("delete")||oM("void")||oM("typeof"))throw new Error(i2);t=_J()}}return t}function $J(e){var t=0;if(e.type!==cs&&e.type!==Vh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function g3t(){var e,t,n,r,i,s,o,a,u,l;if(e=Kt,u=d$(),r=Kt,i=$J(r),i===0)return u;for(r.prec=i,ms(),t=[e,Kt],o=d$(),s=[u,r,o];(i=$J(Kt))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=xJ(a,u,o),s.push(n);r=ms(),r.prec=i,s.push(r),t.push(Kt),n=d$(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=xJ(s[l-1].value,s[l-2],n),l-=2;return n}function Wp(){var e,t,n;return e=g3t(),bn("?")&&(ms(),t=Wp(),Ei(":"),n=Wp(),e=t3t(e,t,n)),e}function QU(){var e=Wp();if(bn(","))throw new Error(i2);return e}function m3t(e){Be=e,me=0,ki=Be.length,Kt=null,Dve();var t=QU();if(Kt.type!==ZC)throw new Error("Unexpect token after expression.");return t}function wy(e,t,n){return e.fields=t||[],e.fname=n,e}function y3t(e){return e.length===1?b3t(e[0]):v3t(e)}const b3t=e=>function(t){return t[e]},v3t=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function aM(e){throw Error(e)}function x3t(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||aM("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&aM("Access path missing closing bracket: "+e),r&&aM("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function w3t(e,t,n){const r=x3t(e);return e=r.length===1?r[0]:e,wy((n&&n.get||y3t)(r),[e],t||e)}w3t("id");wy(e=>e,[],"identity");wy(()=>0,[],"zero");wy(()=>1,[],"one");wy(()=>!0,[],"true");wy(()=>!1,[],"false");function QL(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...QL(e.object)),t.push(...QL(e.property))),t)}function Ive(e){return e.object.type==="MemberExpression"?Ive(e.object):e.object.name==="datum"}function Fve(e){const t=m3t(e),n=new Set;return t.visit(r=>{r.type==="MemberExpression"&&Ive(r)&&n.add(QL(r).slice(1).join("."))}),n}class Cy extends nn{constructor(t,n,r){super(t),this.model=n,this.filter=r,this.expr=oA(this.model,this.filter,this),this._dependentFields=Fve(this.expr)}clone(){return new Cy(null,this.model,vt(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function C3t(e,t){var n;const r={},i=e.config.selection;for(const s of Se(t??{})){const o=vt(t[s]),a=i[o.type],u=Ge(a,["fields","encodings"]);for(const f in u)f==="encodings"&&o.fields||f==="fields"&&o.encodings||(f==="mark"&&(o[f]=Object.assign(Object.assign({},u[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=u[f])!==null&&n!==void 0?n:o[f]));const l=En(s),c=r[l]=Object.assign(Object.assign({},o),{name:l,events:bt(o.on)?Dg(o.on,"scope"):vt(o.on)});fO(c,f=>{f.has(c)&&f.parse&&f.parse(e,c,o,t[s])})}return r}function Ove(e,t,n,r="datum"){const i=[];function s(a){const u=En(a),l=e.getSelectionComponent(u,a),c=Tt(u+jp);if(l.project.timeUnit){const f=n??e.component.data.raw,h=l.project.timeUnit.clone();f.parent?h.insertAsParentOf(f):f.parent=h}return l.empty!=="none"&&i.push(c),`vlSelectionTest(${c}, ${r}`+(l.resolve==="global"?")":`, ${Tt(l.resolve)})`)}const o=yv(t,s);return(i.length?"!("+i.map(a=>`length(data(${a}))`).join(" || ")+") || ":"")+`(${o})`}function Nve(e,t){const n=t.encoding;let r=t.field;if(!n&&!r)r=e.project.items[0].field,e.project.items.length>1&&xe(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Tt(r)}.`);else if(n&&!r){const i=e.project.items.filter(s=>s.channel===n);!i.length||i.length>1?(r=e.project.items[0].field,xe((i.length?"Multiple ":"No ")+`matching ${Tt(n)} encoding found for selection ${Tt(t.selection)}. Using "field": ${Tt(r)}.`)):r=i[0].field}return`${e.name}[${Tt(r)}]`}function S3t(e,t){Pg(e,n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new Gi(new Cy(t,e,{selection:r}),i,"lookup",e.component.data.outputNodeRefCounts)})}function oA(e,t,n){return yv(t,r=>bt(r)?r:cIt(r)?Ove(e,r.selection,n):nbe(r))}function _3t(e,t){if(e)return Ye(e)&&!Wc(e)?e.map(n=>Ebe(n,t)).join(", "):e}function uM(e,t,n,r){var i,s,o;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=r}function qb(e,t,n,r={header:!1}){var i,s;const o=e.combine(),{disable:a,orient:u,scale:l,labelExpr:c,title:f,zindex:h}=o,d=Ge(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const p in d){const m=uTt[p],g=d[p];if(m&&m!==t&&m!=="both")delete d[p];else if(nU(g)){const{condition:y}=g,b=Ge(g,["condition"]),x=qn(y),v=MZ[p];if(v){const{vgProp:w,part:C}=v,S=[...x.map(_=>{const{test:$}=_,k=Ge(_,["test"]);return Object.assign({test:oA(null,$)},k)}),b];uM(d,C,w,S),delete d[p]}else if(v===null){const w={signal:x.map(C=>{const{test:S}=C,_=Ge(C,["test"]);return`${oA(null,S)} ? ${QZ(_)} : `}).join("")+QZ(b)};d[p]=w}}else if(tt(g)){const y=MZ[p];if(y){const{vgProp:b,part:x}=y;uM(d,x,b,g),delete d[p]}}}if(t==="grid"){if(!d.grid)return;if(d.encode){const{grid:p}=d.encode;d.encode=Object.assign({},p?{grid:p}:{}),on(d.encode)&&delete d.encode}return Object.assign(Object.assign({scale:l,orient:u},d),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:nr(h,0)})}else{if(!r.header&&e.mainExtracted)return;if(c!==void 0){let m=c;!((s=(i=d.encode)===null||i===void 0?void 0:i.labels)===null||s===void 0)&&s.update&&tt(d.encode.labels.update.text)&&(m=$0(c,"datum.label",d.encode.labels.update.text.signal)),uM(d,"labels","text",{signal:m})}if(d.labelAlign===null&&delete d.labelAlign,d.encode){for(const m of xye)e.hasAxisPart(m)||delete d.encode[m];on(d.encode)&&delete d.encode}const p=_3t(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},p?{title:p}:{}),d),n.aria===!1?{aria:!1}:{}),{zindex:nr(h,0)})}}}function Mve(e){const{axes:t}=e.component,n=[];for(const r of Bo)if(t[r]){for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const s=r==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function $3t(e,t){const{x:n=[],y:r=[]}=e;return[...n.map(i=>qb(i,"grid",t)),...r.map(i=>qb(i,"grid",t)),...n.map(i=>qb(i,"main",t)),...r.map(i=>qb(i,"main",t))].filter(i=>i)}const Rve={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Pve={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},k3t=Se(Rve),E3t=Se(Pve);function kJ(e,t,n,r){return Object.assign.apply(null,[{},...e.map(i=>{if(i==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...Se(o),...Se(a)]),l={};for(const c of u.values())l[c]={signal:`${r.signal} === "${s}" ? ${e2(o[c])} : ${e2(a[c])}`};return l}return t[i]})])}function A3t(e,t,n,r){const i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:CIt(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=tt(n)?"axisOrient":"axis"+zF(n),a=[...i,...i.map(l=>s+l.substr(4))],u=["axis",o,s];return{vlOnlyAxisConfig:kJ(a,r,e,n),vgAxisConfig:kJ(u,r,e,n),axisConfigStyle:T3t([...u,...a],r)}}function T3t(e,t){var n;const r=[{}];for(const i of e){let s=(n=t[i])===null||n===void 0?void 0:n.style;if(s){s=qn(s);for(const o of s)r.push(t.style[o])}}return Object.assign.apply(null,r)}function e4(e,t,n,r={}){var i;const s=Fbe(e,n,t.style);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((i=r[o])===null||i===void 0?void 0:i[e])!==void 0)return{configFrom:o,configValue:r[o][e]};return{}}const EJ={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return dbe(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return pbe(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return Te(e)&&zi(e.bin)?!1:(r=t.grid)!==null&&r!==void 0?r:D3t(n,e)},gridScale:({model:e,channel:t})=>I3t(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||Bve(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||Lve(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return(r=e.labelFlush)!==null&&r!==void 0?r:O3t(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return(r=e.labelOverlap)!==null&&r!==void 0?r:N3t(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:R3t({fieldOrDatumDef:r,scaleType:i,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const r=zve(t,n);if(r!==void 0)return r;const i=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return Nbe(i?[JZ(i)]:[],Te(o)?[JZ(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>P3t(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return(r=e.zindex)!==null&&r!==void 0?r:L3t(n,t)}};function D3t(e,t){return!Fs(e)&&Te(t)&&!pn(t==null?void 0:t.bin)}function I3t(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function F3t(e,t,n,r,i){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return tt(s)?s:GE(s);{const{configValue:o}=e4("labelAngle",e.config,t==null?void 0:t.style,i);return o!==void 0?GE(o):n===On&&Ze([wU,xU],r.type)?270:void 0}}function t4(e){return`(((${e.signal} % 360) + 360) % 360)`}function Lve(e,t,n,r){if(e!==void 0)if(n==="x"){if(tt(e)){const i=t4(e),s=tt(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${i} && ${i} < 135) || (225 < ${i} && ${i} < 315) ? "middle" :(${i} <= 45 || 315 <= ${i}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(tt(t)){const i=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${i} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(tt(e)){const i=t4(e),s=tt(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${i} <= 45 || 315 <= ${i} || (135 <= ${i} && ${i} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${i} && ${i} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(tt(t)){const i=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${i} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function Bve(e,t,n){if(e===void 0)return;const r=n==="x",i=r?0:90,s=r?"bottom":"left";if(tt(e)){const o=t4(e),a=tt(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${i?"("+o+" + 90)":o} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${o} && ${o} < ${180+i}) === ${a} ? "left" : "right"`}}if((e+i)%180===0)return r?null:"center";if(tt(t)){const o=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${o} "${s}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===s)?"left":"right"}function O3t(e,t){if(t==="x"&&Ze(["quantitative","temporal"],e))return!0}function N3t(e,t){if(e!=="nominal")return t==="log"?"greedy":!0}function M3t(e){return e==="x"?"bottom":"left"}function R3t({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!Fs(t)&&t!=="log"){if(Te(e)){if(pn(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&Ze(["month","hours","day","quarter"],(i=Ji(e.timeUnit))===null||i===void 0?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function zve(e,t){const n=t==="x"?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),s=r?r.title:void 0,o=i?i.title:void 0;if(s&&o)return Mbe(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function P3t(e,t){const n=e.values;if(Ye(n))return Tbe(t,n);if(tt(n))return n}function L3t(e,t){return e==="rect"&&Cbe(t)?1:0}class D0 extends nn{constructor(t,n){super(t),this.transform=n,this._dependentFields=Fve(this.transform.calculate)}clone(){return new D0(null,vt(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((r,i)=>{if(DU(r)&&bbe(r.sort)){const{field:s,timeUnit:o}=r,a=r.sort,u=a.map((l,c)=>`${nbe({field:s,timeUnit:o,equal:l})} ? ${c} : `).join("")+a.length;t=new D0(t,{calculate:u,as:I0(r,i,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Ot(this.transform)}`}}function I0(e,t,n){return _e(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function mO(e,t){return Ze(["top","bottom"],t)?"column":Ze(["left","right"],t)||e==="row"?"row":"column"}function F0(e,t,n,r){const i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return nr(((t==null?void 0:t.header)||{})[e],i[e],n.header[e])}function yO(e,t,n,r){const i={};for(const s of e){const o=F0(s,t,n,r);o!==void 0&&(i[s]=o)}return i}const eW=["row","column"],tW=["header","footer"];function B3t(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=yO(["titleAnchor","titleAngle","titleOrient"],i,r,t),u=mO(t,a),l=GE(o);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),Uve(l,u)),jve(u,l,s)),Wve(r,i,t,k3t,Rve))}}function jve(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=Bve(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function Uve(e,t){const n=Lve(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function z3t(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of tW)if(n[i])for(const s of n[i]){const o=U3t(e,t,i,n,s);o!=null&&r.push(o)}return r}function j3t(e,t){var n;const{sort:r}=e;return ku(r)?{field:_e(r,{expr:"datum"}),order:(n=r.order)!==null&&n!==void 0?n:"ascending"}:Ye(r)?{field:I0(e,t,{expr:"datum"}),order:"ascending"}:{field:_e(e,{expr:"datum"}),order:r??"ascending"}}function n4(e,t,n){const{format:r,formatType:i,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=yO(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),l=_U({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=mO(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?$0($0(u,"datum.label",l),"datum.value",_e(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Uve(s,c)),jve(c,s,o)),Wve(n,e,t,E3t,Pve))}function U3t(e,t,n,r,i){if(i){let s=null;const{facetFieldDef:o}=r,a=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:f}=yO(["labelOrient"],o,a,t);(t==="row"&&!Ze(["top","bottom"],f)||t==="column"&&!Ze(["left","right"],f))&&(s=n4(o,t,a))}const u=_a(e)&&!HC(e.facet),l=i.axes,c=(l==null?void 0:l.length)>0;if(s||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:j3t(o,t)}:{}),c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),i.sizeSignal?{encode:{update:{[f]:i.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const W3t={column:{start:0,end:1},row:{start:1,end:0}};function V3t(e,t){return W3t[t][e]}function G3t(e,t){const n={};for(const r of Eo){const i=e[r];if(i!=null&&i.facetFieldDef){const{titleAnchor:s,titleOrient:o}=yO(["titleAnchor","titleOrient"],i.facetFieldDef,t,r),a=mO(r,o),u=V3t(s,a);u!==void 0&&(n[a]=u)}}return on(n)?void 0:n}function Wve(e,t,n,r,i){const s={};for(const o of r){if(!i[o])continue;const a=F0(o,t,e,n);a!==void 0&&(s[i[o]]=a)}return s}function nW(e){return[...b_(e,"width"),...b_(e,"height"),...b_(e,"childWidth"),...b_(e,"childHeight")]}function b_(e,t){const n=t==="width"?"x":"y",r=e.component.layoutSize.get(t);if(!r||r==="merged")return[];const i=e.getSizeSignalRef(t).signal;if(r==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(Fs(o)&&Uh(a)){const u=e.scaleName(n);return _a(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[AJ(u,a)]:[AJ(u,a),{name:i,update:Vve(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(r=="container"){const s=i.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=HL(e.config.view,s?"width":"height"),u=`isFinite(${o}) ? ${o} : ${a}`;return[{name:i,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:i,value:r}]}function AJ(e,t){return{name:e+"_step",value:t.step}}function Vve(e,t,n){const r=t.get("type"),i=t.get("padding"),s=nr(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o=r==="band"?o!==void 0?o:i:1,`bandspace(${n}, ${o}, ${s}) * ${e}_step`}function Gve(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Hve(e,t){return Se(e).reduce((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),YC(t,i,r,s=>tt(s)?s:{value:s.value}))},{})}function H3t(e,t){if($y(t)||_a(t))return"shared";if(aW(t))return Uu(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function rW(e,t){const n=e.scale[t],r=Uu(t)?"axis":"legend";return n==="independent"?(e[r][t]==="shared"&&xe(TDt(t)),"independent"):e[r][t]||"shared"}const q3t=Object.assign(Object.assign({},CFt),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),qve=Se(q3t);class X3t extends Ac{}const TJ={symbols:Y3t,gradient:K3t,labels:Z3t,entries:J3t};function Y3t(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:s}){var o,a,u,l,c;if(s!=="symbol")return;const{markDef:f,encoding:h,config:d,mark:p}=n,m=f.filled&&p!=="trail";let g=Object.assign(Object.assign({},tFt({},n,gTt)),cve(n,{filled:m}));const y=(o=Xve(h.opacity))!==null&&o!==void 0?o:f.opacity;if(g.fill){if(r==="fill"||m&&r===Ds)delete g.fill;else if(g.fill.field)i.get("symbolFillColor")?delete g.fill:(g.fill=Vn((a=d.legend.symbolBaseFillColor)!==null&&a!==void 0?a:"black"),g.fillOpacity=Vn(y??1));else if(Ye(g.fill)){const b=(c=(l=r4((u=h.fill)!==null&&u!==void 0?u:h.color))!==null&&l!==void 0?l:f.fill)!==null&&c!==void 0?c:m&&f.color;b&&(g.fill=Vn(b))}}if(g.stroke){if(r==="stroke"||!m&&r===Ds)delete g.stroke;else if(g.stroke.field)delete g.stroke;else if(Ye(g.stroke)){const b=nr(r4(h.stroke||h.color),f.stroke,m?f.color:void 0);b&&(g.stroke={value:b})}}if(r!==Ec){const b=Te(t)&&Kve(n,i,t);b?g.opacity=[Object.assign({test:b},Vn(y??1)),Vn(d.legend.unselectedOpacity)]:y&&(g.opacity=Vn(y))}return g=Object.assign(Object.assign({},g),e),on(g)?void 0:g}function K3t(e,{model:t,legendType:n}){if(n!=="gradient")return;let r={};const i=Xve(t.encoding.opacity)||t.markDef.opacity;return i&&(r.opacity=Vn(i)),r=Object.assign(Object.assign({},r),e),on(r)?void 0:r}function Z3t(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const s=n.legend(r)||{},o=n.config,a=Te(t)?Kve(n,i,t):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=s,f=Bp(c)?$U({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:o}):void 0,h=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return on(h)?void 0:h}function J3t(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Xve(e){return Yve(e,(t,n)=>Math.max(t,n.value))}function r4(e){return Yve(e,(t,n)=>nr(t,n.value))}function Yve(e,t){if(GIt(e))return qn(e.condition).reduce(t,e.value);if(lc(e))return e.value}function Kve(e,t,n){const r=t.get("selections");if(!(r!=null&&r.length))return;const i=Tt(n.field);return r.map(s=>`(!length(data(${Tt(En(s)+jp)})) || (${s}[${i}] && indexof(${s}[${i}], datum.value) >= 0))`).join(" || ")}const DJ={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return dbe(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return pbe(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return(n=(t=r.gradientLength)!==null&&t!==void 0?t:i.gradientLength)!==null&&n!==void 0?n:sMt(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return(i=(r=e.labelOverlap)!==null&&r!==void 0?r:t.labelOverlap)!==null&&i!==void 0?i:oMt(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return(i=e.symbolType)!==null&&i!==void 0?i:eMt(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>rp(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Tm(n)&&ya(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Q3t(t,e)};function Q3t(e,t){const n=e.values;if(Ye(n))return Tbe(t,n);if(tt(n))return n}function eMt(e,t,n,r){var i;if(t!=="shape"){const s=(i=r4(n))!==null&&i!==void 0?i:r;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function tMt(e){const{legend:t}=e;return nr(t.type,nMt(e))}function nMt({channel:e,timeUnit:t,scaleType:n}){if(Tm(e)){if(Ze(["quarter","month","day"],t))return"symbol";if(ya(n))return"gradient"}return"symbol"}function rMt({legendConfig:e,legendType:t,orient:n,legend:r}){var i,s;return(s=(i=r.direction)!==null&&i!==void 0?i:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:iMt(n,t)}function iMt(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function sMt({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(ya(i))return n==="horizontal"?r==="top"||r==="bottom"?IJ(t,"width",o,s):o:IJ(t,"height",u,a)}function IJ(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function oMt(e){if(Ze(["quantile","threshold","log"],e))return"greedy"}function Zve(e){const t=Rn(e)?aMt(e):fMt(e);return e.component.legends=t,t}function aMt(e){const{encoding:t}=e,n={};for(const r of[Ds,...Kbe]){const i=fr(t[r]);!i||!e.getScaleComponent(r)||r===Is&&Te(i)&&i.type===xy||(n[r]=cMt(e,r))}return n}function uMt(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function lMt(e,t,n,r){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(r==null?void 0:r.title))return!0}return e===(n||{})[t]}function cMt(e,t){var n,r,i;let s=e.legend(t);const{markDef:o,encoding:a,config:u}=e,l=u.legend,c=new X3t({},uMt(e,t));GOt(e,t,c);const f=s!==void 0?!s:l.disable;if(c.set("disable",f,s!==void 0),f)return c;s=s||{};const h=e.getScaleComponent(t).get("type"),d=fr(a[t]),p=Te(d)?(n=Ji(d.timeUnit))===null||n===void 0?void 0:n.unit:void 0,m=s.orient||u.legend.orient||"right",g=tMt({legend:s,channel:t,timeUnit:p,scaleType:h}),y=rMt({legend:s,legendType:g,orient:m,legendConfig:l}),b={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:d,legendConfig:l,config:u,scaleType:h,orient:m,legendType:g,direction:y};for(const S of qve){const _=S in DJ?DJ[S](b):s[S];if(_!==void 0){const $=lMt(_,S,s,e.fieldDef(t));($||u.legend[S]===void 0)&&c.set(S,_,$)}}const x=(r=s==null?void 0:s.encoding)!==null&&r!==void 0?r:{},v=c.get("selections"),w={},C={fieldOrDatumDef:d,model:e,channel:t,legendCmpt:c,legendType:g};for(const S of["labels","legend","title","symbols","gradient","entries"]){const _=Hve((i=x[S])!==null&&i!==void 0?i:{},e),$=S in TJ?TJ[S](_,C):_;$!==void 0&&!on($)&&(w[S]=Object.assign(Object.assign(Object.assign({},v!=null&&v.length&&Te(d)?{name:`${En(d.field)}_legend_${S}`}:{}),v!=null&&v.length?{interactive:!!v}:{}),{update:$}))}return on(w)||c.set("encode",w,!!(s!=null&&s.encoding)),c}function fMt(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){Zve(r);for(const i of Se(r.component.legends))n.legend[i]=rW(e.component.resolve,i),n.legend[i]==="shared"&&(t[i]=Jve(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of Se(t))for(const i of e.children)i.component.legends[r]&&n.legend[r]==="shared"&&delete i.component.legends[r];return t}function Jve(e,t){var n,r,i,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let u=!1;for(const l of qve){const c=ch(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,h)=>{switch(l){case"symbolType":return hMt(f,h);case"title":return Rbe(f,h);case"type":return u=!0,Ls("symbol")}return lO(f,h,l,"legend")});e.setWithExplicit(l,c)}return u&&(!((r=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||r===void 0)&&r.gradient&&zL(e.implicit,["encode","gradient"]),!((s=(i=e.explicit)===null||i===void 0?void 0:i.encode)===null||s===void 0)&&s.gradient&&zL(e.explicit,["encode","gradient"])),e}function hMt(e,t){return t.value==="circle"?t:e}function FJ(e,t,n,r){var i,s,o;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=r}function Qve(e){const t=e.component.legends,n={};for(const i of Se(t)){const s=e.getScaleComponent(i),o=$n(s.get("domains"));if(n[o])for(const a of n[o])Jve(a,t[i])||n[o].push(t[i]);else n[o]=[t[i].clone()]}return Cf(n).flat().map(i=>dMt(i,e.config)).filter(i=>i!==void 0)}function dMt(e,t){var n,r,i;const s=e.combine(),{disable:o,labelExpr:a,selections:u}=s,l=Ge(s,["disable","labelExpr","selections"]);if(!o){if(t.aria===!1&&l.aria==null&&(l.aria=!1),!((n=l.encode)===null||n===void 0)&&n.symbols){const c=l.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!l.stroke&&(c.stroke={value:"transparent"});for(const f of Kbe)l[f]&&delete c[f]}if(l.title||delete l.title,a!==void 0){let c=a;!((i=(r=l.encode)===null||r===void 0?void 0:r.labels)===null||i===void 0)&&i.update&&tt(l.encode.labels.update.text)&&(c=$0(a,"datum.label",l.encode.labels.update.text.signal)),FJ(l,"labels","text",{signal:c})}for(const c in l){const f=l[c];if(tt(f)){const h=xFt[c];if(h){const{vgProp:d,part:p}=h;FJ(l,p,d,f),delete l[c]}}}return l}}function pMt(e){return $y(e)||aW(e)?gMt(e):exe(e)}function gMt(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),exe(e))}function exe(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const u=tt(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return Ze(o,u)||o.push(u),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const mMt=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class txe extends Ac{constructor(t,n,r,i){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=r,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function nxe(e){e.component.projection=Rn(e)?yMt(e):xMt(e)}function yMt(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(n.scale!=null||n.translate!=null)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=r?bMt(e):void 0;return new txe(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n??{}),i,s)}}function bMt(e){const t=[],{encoding:n}=e;for(const r of[[ll,ul],[Lo,Ga]])(fr(n[r[0]])||fr(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Is)&&e.typedFieldDef(Is).type===xy&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(ci)),t}function vMt(e,t){const n=pye(mMt,i=>!!(!zd(e.explicit,i)&&!zd(t.explicit,i)||zd(e.explicit,i)&&zd(t.explicit,i)&&$n(e.get(i))===$n(t.get(i))));if($n(e.size)===$n(t.size)){if(n)return e;if($n(e.explicit)===$n({}))return t;if($n(t.explicit)===$n({}))return e}return null}function xMt(e){if(e.children.length===0)return;let t;for(const r of e.children)nxe(r);const n=pye(e.children,r=>{const i=r.component.projection;if(i)if(t){const s=vMt(t,i);return s&&(t=s),!!s}else return t=i,!0;else return!0});if(t&&n){const r=e.projectionName(!0),i=new txe(r,t.specifiedProjection,t.size,vt(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&i.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),r),o.merged=!0)}return i}}function wMt(e,t,n,r){var i,s;if(XC(t,n)){const o=Rn(e)?(s=(i=e.axis(n))!==null&&i!==void 0?i:e.legend(n))!==null&&s!==void 0?s:{}:{},a=_e(t,{expr:"datum"}),u=_e(t,{expr:"datum",binSuffix:"end"});return{formulaAs:_e(t,{binSuffix:"range",forAs:!0}),formula:tO(a,u,o.format,o.formatType,r)}}return{}}function rxe(e,t){return`${Lye(e)}_${t}`}function CMt(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function iW(e,t,n){var r;const i=(r=sO(n,void 0))!==null&&r!==void 0?r:{},s=rxe(i,t);return e.getName(`${s}_bins`)}function SMt(e){return"as"in e}function OJ(e,t,n){let r,i;SMt(e)?r=bt(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:r=[_e(e,{forAs:!0}),_e(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},sO(t,void 0)),o=rxe(s,e.field),{signal:a,extentSignal:u}=CMt(n,o);if(QF(s.extent)){const c=s.extent,f=c.selection;i=Nve(n.getSelectionComponent(En(f),f),c),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[r]},a?{signal:a}:{}),u?{extentSignal:u}:{}),i?{span:i}:{});return{key:o,binComponent:l}}class Au extends nn{constructor(t,n){super(t),this.bins=n}clone(){return new Au(null,vt(this.bins))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,o)=>{if(io(s)&&pn(s.bin)){const{key:a,binComponent:u}=OJ(s,s.bin,n);i[a]=Object.assign(Object.assign(Object.assign({},u),i[a]),wMt(n,s,o,n.config))}return i},{});return on(r)?null:new Au(t,r)}static makeFromTransform(t,n,r){const{key:i,binComponent:s}=OJ(n,n.bin,r);return new Au(t,{[i]:s})}merge(t,n){for(const r of Se(t.bins))r in this.bins?(n(t.bins[r].signal,this.bins[r].signal),this.bins[r].as=lf([...this.bins[r].as,...t.bins[r].as],Ot)):this.bins[r]=t.bins[r];for(const r of t.children)t.removeChild(r),r.parent=this;t.remove()}producedFields(){return new Set(Cf(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Cf(this.bins).map(t=>t.field))}hash(){return`Bin ${Ot(this.bins)}`}assemble(){return Cf(this.bins).flatMap(t=>{const n=[],[r,...i]=t.as,s=t.bin,{extent:o}=s,a=Ge(s,["extent"]),u=Object.assign(Object.assign(Object.assign({type:"bin",field:ah(t.field),as:r,signal:t.signal},QF(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:ah(t.field),signal:t.extentSignal}),u.extent={signal:t.extentSignal}),n.push(u);for(const l of i)for(let c=0;c<2;c++)n.push({type:"formula",expr:_e({field:r[c]},{expr:"datum"}),as:l[c]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}class O0 extends nn{constructor(t){super(null),t=t??{name:"source"};let n;if(sp(t)||(n=t.format?Object.assign({},ql(t.format,["parse"])):{}),tA(t))this._data={values:t.values};else if(n2(t)){if(this._data={url:t.url},!n.type){let r=/(?:\.([^.]+))?$/.exec(t.url)[1];Ze(["json","csv","tsv","dsv","topojson"],r)||(r="json"),n.type=r}}else ove(t)?this._data={values:[{type:"Sphere"}]}:(ive(t)||sp(t))&&(this._data={});this._generator=sp(t),t.name&&(this._name=t.name),n&&!on(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function i4(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!i4(t.children))return!1}return!0}class eS extends nn{constructor(t,n){super(t),this.params=n}clone(){return new eS(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Ot(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class tS extends nn{constructor(t,n){super(t),this.params=n}clone(){return new tS(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${Ot(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function bO(e){return e instanceof O0||e instanceof eS||e instanceof tS}class ixe{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class Tc extends ixe{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:n}){t&&this.setContinue(),n&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(bO(t))return!1;const n=t.parent,{continueFlag:r}=this.run(t);return r&&this.optimizeNextFromLeaves(n),this.mutatedFlag}}class sW extends ixe{}function _Mt(e,t,n,r){const i=Rn(r)?r.encoding[hl(t)]:void 0;if(io(n)&&Rn(r)&&EU(t,n,i,r.stack,r.markDef,r.config))e.add(_e(n,{})),e.add(_e(n,{suffix:"end"})),n.bin&&XC(n,t)&&e.add(_e(n,{binSuffix:"range"}));else if(OTt(t)){const s=FTt(t);e.add(r.getName(s))}else e.add(_e(n));return e}function $Mt(e,t){var n;for(const r of Se(t)){const i=t[r];for(const s of Se(i))r in e?e[r][s]=new Set([...(n=e[r][s])!==null&&n!==void 0?n:[],...i[s]]):e[r]={[s]:i[s]}}}class Sa extends nn{constructor(t,n,r){super(t),this.dimensions=n,this.measures=r}clone(){return new Sa(null,new Set(this.dimensions),vt(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let r=!1;n.forEachFieldDef(o=>{o.aggregate&&(r=!0)});const i={},s=new Set;return!r||(n.forEachFieldDef((o,a)=>{var u,l,c,f;const{aggregate:h,field:d}=o;if(h)if(h==="count")i["*"]=(u=i["*"])!==null&&u!==void 0?u:{},i["*"].count=new Set([_e(o,{forAs:!0})]);else{if(uh(h)||Ng(h)){const p=uh(h)?"argmin":"argmax",m=h[p];i[m]=(l=i[m])!==null&&l!==void 0?l:{},i[m][p]=new Set([_e({op:p,field:m},{forAs:!0})])}else i[d]=(c=i[d])!==null&&c!==void 0?c:{},i[d][h]=new Set([_e(o,{forAs:!0})]);jh(a)&&n.scaleDomain(a)==="unaggregated"&&(i[d]=(f=i[d])!==null&&f!==void 0?f:{},i[d].min=new Set([_e({field:d,aggregate:"min"},{forAs:!0})]),i[d].max=new Set([_e({field:d,aggregate:"max"},{forAs:!0})]))}else _Mt(s,a,o,n)}),s.size+Se(i).length===0)?null:new Sa(t,s,i)}static makeFromTransform(t,n){var r,i,s;const o=new Set,a={};for(const u of n.aggregate){const{op:l,field:c,as:f}=u;l&&(l==="count"?(a["*"]=(r=a["*"])!==null&&r!==void 0?r:{},a["*"].count=new Set([f||_e(u,{forAs:!0})])):(a[c]=(i=a[c])!==null&&i!==void 0?i:{},a[c][l]=new Set([f||_e(u,{forAs:!0})])))}for(const u of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(u);return o.size+Se(a).length===0?null:new Sa(t,o,a)}merge(t){return tTt(this.dimensions,t.dimensions)?($Mt(this.measures,t.measures),!0):(GDt("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...Se(this.measures)])}producedFields(){const t=new Set;for(const n of Se(this.measures))for(const r of Se(this.measures[n])){const i=this.measures[n][r];i.size===0?t.add(`${r}_${n}`):i.forEach(t.add,t)}return t}hash(){return`Aggregate ${Ot({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],r=[];for(const s of Se(this.measures))for(const o of Se(this.measures[s]))for(const a of this.measures[s][o])r.push(a),t.push(o),n.push(s==="*"?null:ah(s));return{type:"aggregate",groupby:[...this.dimensions].map(ah),ops:t,fields:n,as:r}}}class Sy extends nn{constructor(t,n,r,i){super(t),this.model=n,this.name=r,this.data=i;for(const s of Eo){const o=n.facet[s];if(o){const{bin:a,sort:u}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[_e(o),...pn(a)?[_e(o,{binSuffix:"end"})]:[]]},ku(u)?{sortField:u}:Ye(u)?{sortIndexField:I0(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of Eo)this[n]&&(t+=` ${n.charAt(0)}:${Ot(this[n])}`);return t}get fields(){var t;const n=[];for(const r of Eo)!((t=this[r])===null||t===void 0)&&t.fields&&n.push(...this[r].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of Eo)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Bo){const r=this.childModel.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Fs(i)&&Uh(s)){const o=vO(this.childModel,n),a=oW(o);a?t[n]=a:xe(`Unknown field for ${n}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,n,r){const i={row:"y",column:"x"}[t],s=[],o=[],a=[];r&&r[i]&&(n?(s.push(`distinct_${r[i]}`),o.push("max")):(s.push(r[i]),o.push("distinct")),a.push(`distinct_${r[i]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=nO,field:f}=u;s.push(f),o.push(c),a.push(_e(u,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,r;const{columns:i}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const c of eW){for(const f of tW){const h=(n=s[c]&&s[c][f])!==null&&n!==void 0?n:[];for(const d of h)if(((r=d.axes)===null||r===void 0?void 0:r.length)>0){a[c]=!0;break}}if(a[c]){const f=`length(data("${this.facet.name}"))`,h=c==="row"?i?{signal:`ceil(${f} / ${i})`}:1:i?{signal:`min(${f}, ${i})`}:{signal:f};o.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:h}]})}}const{row:u,column:l}=a;return(u||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const r=[];let i=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:u}=this;if(o&&a&&(s.x||s.y)){i=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),c=l.map(()=>"distinct");r.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:c}]})}for(const l of[Yl,Xl])this[l]&&r.push(this.assembleRowColumnHeaderData(l,i,s));if(u){const l=this.assembleFacetHeaderData(s);l&&r.push(...l)}return r}}function NJ(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function kMt(e,t){const n=bye(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const r=NJ(t.slice(5,t.length));return`timeParse(${n},'${r}')`}else if(t.indexOf("utc:")===0){const r=NJ(t.slice(4,t.length));return`utcParse(${n},'${r}')`}else return xe(rDt(t)),null}function EMt(e){const t={};return c$(e.filter,n=>{var r;if(tbe(n)){let i=null;mU(n)?i=n.equal:yU(n)?i=n.range[0]:bU(n)&&(i=((r=n.oneOf)!==null&&r!==void 0?r:n.in)[0]),i&&(by(i)?t[n.field]="date":tr(i)?t[n.field]="number":bt(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function AMt(e){const t={};function n(r){oO(r)?t[r.field]="date":r.type==="quantitative"&&ETt(r.aggregate)?t[r.field]="number":Jx(r.field)>1?r.field in t||(t[r.field]="flatten"):DU(r)&&ku(r.sort)&&Jx(r.sort.field)>1&&(r.sort.field in t||(t[r.sort.field]="flatten"))}if((Rn(e)||_a(e))&&e.forEachFieldDef((r,i)=>{if(io(r))n(r);else{const s=Rg(i),o=e.fieldDef(s);n(Object.assign(Object.assign({},r),{type:o.type}))}}),Rn(e)){const{mark:r,markDef:i,encoding:s}=e;if(Og(r)&&!e.encoding.order){const o=i.orient==="horizontal"?"y":"x",a=s[o];Te(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function TMt(e){const t={};if(Rn(e)&&e.component.selection)for(const n of Se(e.component.selection)){const r=e.component.selection[n];for(const i of r.project.items)!i.channel&&Jx(i.field)>1&&(t[i.field]="flatten")}return t}class bi extends nn{constructor(t,n){super(t),this._parse=n}clone(){return new bi(null,vt(this._parse))}hash(){return`Parse ${Ot(this._parse)}`}static makeExplicit(t,n,r){let i={};const s=n.data;return!sp(s)&&s&&s.format&&s.format.parse&&(i=s.format.parse),this.makeWithAncestors(t,i,{},r)}static makeWithAncestors(t,n,r,i){for(const a of Se(r)){const u=i.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===r[a]||u.value==="derived"||r[a]==="flatten"?delete r[a]:xe(GZ(a,r[a],u.value)))}for(const a of Se(n)){const u=i.get(a);u!==void 0&&(u===n[a]?delete n[a]:xe(GZ(a,n[a],u)))}const s=new Ac(n,r);i.copyAll(s);const o={};for(const a of Se(s.combine())){const u=s.get(a);u!==null&&(o[a]=u)}return Se(o).length===0||i.parseNothing?null:new bi(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of Se(this._parse)){const r=this._parse[n];Jx(n)===1&&(t[n]=r)}return t}producedFields(){return new Set(Se(this._parse))}dependentFields(){return new Set(Se(this._parse))}assembleTransforms(t=!1){return Se(this._parse).filter(n=>t?Jx(n)>1:!0).map(n=>{const r=kMt(n,this._parse[n]);return r?{type:"formula",expr:r,as:vye(n)}:null}).filter(n=>n!==null)}}class dh extends nn{clone(){return new dh(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([A0])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:A0}}}class Bg extends nn{constructor(t,n){super(t),this.transform=n}clone(){return new Bg(null,vt(this.transform))}addDimensions(t){this.transform.groupby=lf(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_e(t)}hash(){return`JoinAggregateTransform ${Ot(this.transform)}`}assemble(){const t=[],n=[],r=[];for(const s of this.transform.joinaggregate)n.push(s.op),r.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},i!==void 0?{groupby:i}:{})}}function DMt(e){return e.stack.stackBy.reduce((t,n)=>{const r=n.fieldDef,i=_e(r);return i&&t.push(i),t},[])}function IMt(e){return Ye(e)&&e.every(t=>bt(t))&&e.length>1}class Zl extends nn{constructor(t,n){super(t),this._stack=n}clone(){return new Zl(null,vt(this._stack))}static makeFromTransform(t,n){const{stack:r,groupby:i,as:s,offset:o="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(nr(f.order,"ascending"));const l={field:a,order:u};let c;return IMt(s)?c=s:bt(s)?c=[s,s+"_end"]:c=[n.stack+"_start",n.stack+"_end"],new Zl(t,{stackField:r,groupby:i,offset:o,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const r=n.stack,{encoding:i}=n;if(!r)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:u}=r;let l;if(s){const d=i[s];l=Wu(d)}const c=DMt(n),f=n.encoding.order;let h;return Ye(f)||Te(f)?h=Obe(f):h=c.reduce((d,p)=>(d.field.push(p),d.order.push(o==="y"?"descending":"ascending"),d),{field:[],order:[]}),new Zl(t,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:c,sort:h,offset:a,impute:u,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Ot(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:r}=this._stack;return t?t.bin?n?[_e(t,{binSuffix:"mid"})]:[_e(t,{}),_e(t,{binSuffix:"end"})]:[_e(t)]:r??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:r,stackField:i,stackby:s,sort:o,offset:a,impute:u,as:l}=this._stack;if(u&&r){const{band:c=.5,bin:f}=r;f&&t.push({type:"formula",expr:`${c}*`+_e(r,{expr:"datum"})+`+${1-c}*`+_e(r,{expr:"datum",binSuffix:"end"}),as:_e(r,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:i,groupby:[...s,...n],key:_e(r,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:i,sort:o,as:l,offset:a}),t}}class _y extends nn{constructor(t,n){super(t),this.transform=n}clone(){return new _y(null,vt(this.transform))}addDimensions(t){this.transform.groupby=lf(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const r=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(r.add,r),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(i=>r.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(r.add,r),r}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_e(t)}hash(){return`WindowTransform ${Ot(this.transform)}`}assemble(){var t;const n=[],r=[],i=[],s=[];for(const h of this.transform.window)r.push(h.op),i.push(this.getDefaultName(h)),s.push(h.param===void 0?null:h.param),n.push(h.field===void 0?null:h.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&r.every(h=>oU(h)))return Object.assign({type:"joinaggregate",as:i,ops:r,fields:n},a!==void 0?{groupby:a}:{});const u=[],l=[];if(this.transform.sort!==void 0)for(const h of this.transform.sort)u.push(h.field),l.push((t=h.order)!==null&&t!==void 0?t:"ascending");const c={field:u,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:i,ops:r,fields:n,sort:c},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}class FMt extends Tc{run(t){const n=t.parent;if(t instanceof bi){if(bO(n))return this.flags;if(n.numChildren()>1)return this.setContinue(),this.flags;if(n instanceof bi)this.setMutated(),n.merge(t);else{if(mye(n.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class OMt extends sW{mergeNodes(t,n){const r=n.shift();for(const i of n)t.removeChild(i),i.parent=r,i.remove()}run(t){const n=t.children.map(i=>i.hash()),r={};for(let i=0;i<n.length;i++)r[n[i]]===void 0?r[n[i]]=[t.children[i]]:r[n[i]].push(t.children[i]);for(const i of Se(r))r[i].length>1&&(this.setMutated(),this.mergeNodes(t,r[i]));for(const i of t.children)this.run(i);return this.mutatedFlag}}class NMt extends Tc{run(t){return t instanceof Gi||t.numChildren()>0||t instanceof Sy?this.flags:(this.setMutated(),t.remove(),this.flags)}}class MMt extends Tc{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof Eu){const n=t.producedFields();gye(n,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...n]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class RMt extends Tc{run(t){this.setContinue();const r=t.parent.children.filter(s=>s instanceof Eu),i=r.pop();for(const s of r)this.setMutated(),i.merge(s);return this.flags}}function PMt(e){function t(n){if(!(n instanceof Sy)){const r=n.clone();if(r instanceof Gi){const i=o4+r.getSource();r.setSource(i),e.model.component.data.outputNodes[i]=r}else(r instanceof Sa||r instanceof Zl||r instanceof _y||r instanceof Bg)&&r.addDimensions(e.fields);for(const i of n.children.flatMap(t))i.parent=r;return[r]}return n.children.flatMap(t)}return t}function s4(e){if(e instanceof Sy)if(e.numChildren()===1&&!(e.children[0]instanceof Gi)){const t=e.children[0];(t instanceof Sa||t instanceof Zl||t instanceof _y||t instanceof Bg)&&t.addDimensions(e.fields),t.swapWithParent(),s4(e)}else{const t=e.model.component.data.main;sxe(t);const n=PMt(e),r=e.children.map(n).flat();for(const i of r)i.parent=t}else e.children.map(s4)}function sxe(e){if(e instanceof Gi&&e.type===ci&&e.numChildren()===1){const t=e.children[0];t instanceof Sy||(t.swapWithParent(),sxe(e))}}class LMt extends sW{constructor(){super()}run(t){t instanceof Gi&&!t.isRequired()&&(this.setMutated(),t.remove());for(const n of t.children)this.run(n);return this.mutatedFlag}}class BMt extends sW{constructor(t){super(),this.requiresSelectionId=t&&KU(t)}run(t){t instanceof dh&&(this.requiresSelectionId&&(bO(t.parent)||t.parent instanceof Sa||t.parent instanceof bi)||(this.setMutated(),t.remove()));for(const n of t.children)this.run(n);return this.mutatedFlag}}class zMt extends Tc{run(t){const n=t.parent,r=[...n.children],i=n.children.filter(s=>s instanceof bi);if(n.numChildren()>1&&i.length>=1){const s={},o=new Set;for(const a of i){const u=a.parse;for(const l of Se(u))l in s?s[l]!==u[l]&&o.add(l):s[l]=u[l]}for(const a of o)delete s[a];if(!on(s)){this.setMutated();const a=new bi(n,s);for(const u of r){if(u instanceof bi)for(const l of Se(s))delete u.parse[l];n.removeChild(u),u.parent=a,u instanceof bi&&Se(u.parse).length===0&&u.remove()}}}return this.setContinue(),this.flags}}class jMt extends Tc{run(t){const n=t.parent,r=n.children.filter(s=>s instanceof Sa),i={};for(const s of r){const o=Ot(s.groupBy);o in i||(i[o]=[]),i[o].push(s)}for(const s of Se(i)){const o=i[s];if(o.length>1){const a=o.pop();for(const u of o)a.merge(u)&&(n.removeChild(u),u.parent=a,u.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class UMt extends Tc{constructor(t){super(),this.model=t}run(t){const n=t.parent,r=!(bO(n)||n instanceof Cy||n instanceof bi||n instanceof dh),i=[],s=[];for(const o of n.children)o instanceof Au&&(r&&!mye(n.producedFields(),o.dependentFields())?i.push(o):s.push(o));if(i.length>0){const o=i.pop();for(const a of i)o.merge(a,this.model.renameSignal.bind(this.model));this.setMutated(),n instanceof Au?n.merge(o,this.model.renameSignal.bind(this.model)):o.swapWithParent()}if(s.length>1){const o=s.pop();for(const a of s)o.merge(a,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class WMt extends Tc{run(t){const n=t.parent,r=[...n.children];if(!Zx(r,a=>a instanceof Gi)||n.numChildren()<=1)return this.setContinue(),this.flags;const s=[];let o;for(const a of r)if(a instanceof Gi){let u=a;for(;u.numChildren()===1;){const l=u.children[0];if(l instanceof Gi)u=l;else break}s.push(...u.children),o?(n.removeChild(a),a.parent=o.parent,o.parent.removeChild(o),o.parent=u,this.setMutated()):o=u}else s.push(a);if(s.length){this.setMutated();for(const a of s)a.parent.removeChild(a),a.parent=o}return this.setContinue(),this.flags}}const o4="scale_",v_=5;function Oc(e){const t=[];function n(r){if(r.numChildren()===0)t.push(r);else for(const i of r.children)n(i)}for(const r of e)n(r);return t}function VMt(e){return e}function Zo(e,t){return t.map(r=>{if(e instanceof Tc){const i=e.optimizeNextFromLeaves(r);return e.reset(),i}else return e.run(r)}).some(VMt)}function MJ(e,t){let n=e.sources;const r=new Set;return r.add(Zo(new LMt,n)),r.add(Zo(new BMt(t),n)),n=n.filter(i=>i.numChildren()>0),r.add(Zo(new NMt,Oc(n))),n=n.filter(i=>i.numChildren()>0),r.add(Zo(new FMt,Oc(n))),r.add(Zo(new UMt(t),Oc(n))),r.add(Zo(new MMt,Oc(n))),r.add(Zo(new zMt,Oc(n))),r.add(Zo(new jMt,Oc(n))),r.add(Zo(new RMt,Oc(n))),r.add(Zo(new OMt,n)),r.add(Zo(new WMt,Oc(n))),e.sources=n,r.has(!0)}function GMt(e,t){i4(e.sources);let n=0,r=0;for(let i=0;i<v_&&MJ(e,t);i++)n++;e.sources.map(s4);for(let i=0;i<v_&&MJ(e,t);i++)r++;i4(e.sources),Math.max(n,r)===v_&&xe(`Maximum optimization runs(${v_}) reached.`)}class Ks{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Ks(()=>t(n))}}function oxe(e){Rn(e)?HMt(e):qMt(e)}function HMt(e){const t=e.component.scales;for(const n of Se(t)){const r=YMt(e,n);if(t[n].setWithExplicit("domains",r),ZMt(e,n),e.component.data.isFaceted){let s=e;for(;!_a(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of r.value)cf(a)&&(a.data=o4+a.data.replace(o4,""))}}}function qMt(e){for(const n of e.children)oxe(n);const t=e.component.scales;for(const n of Se(t)){let r,i=null;for(const s of e.children){const o=s.component.scales[n];if(o){r===void 0?r=o.getWithExplicit("domains"):r=ch(r,o.getWithExplicit("domains"),"domains","scale",a4);const a=o.get("selectionExtent");i&&a&&i.selection!==a.selection&&xe("The same selection must be used to override scale domains in a layered view."),i=a}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}function XMt(e,t,n,r){if(e==="unaggregated"){const{valid:i,reason:s}=RJ(t,n);if(!i){xe(s);return}}else if(e===void 0&&r.useUnaggregatedDomain){const{valid:i}=RJ(t,n);if(i)return"unaggregated"}return e}function YMt(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=XMt(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),t==="x"&&fr(r.x2)?fr(r.x)?ch(Pc(n,i,e,"x"),Pc(n,i,e,"x2"),"domain","scale",a4):Pc(n,i,e,"x2"):t==="y"&&fr(r.y2)?fr(r.y)?ch(Pc(n,i,e,"y"),Pc(n,i,e,"y2"),"domain","scale",a4):Pc(n,i,e,"y2"):Pc(n,i,e,t)}function KMt(e,t,n){return e.map(r=>({signal:`{data: ${OU(r,{timeUnit:n,type:t})}}`}))}function lM(e,t,n){var r;const i=(r=Ji(n))===null||r===void 0?void 0:r.unit;return t==="temporal"||i?KMt(e,t,i):[e]}function Pc(e,t,n,r){const{encoding:i}=n,s=fr(i[r]),{type:o}=s,a=s.timeUnit;if(IIt(t)){const f=Pc(e,void 0,n,r),h=lM(t.unionWith,o,a);return jd([...f.value,...h])}else{if(tt(t))return jd([t]);if(t&&t!=="unaggregated"&&!ibe(t))return jd(lM(t,o,a))}const u=n.stack;if(u&&r===u.fieldChannel){if(u.offset==="normalize")return Ls([[0,1]]);const f=n.requestDataName(ci);return Ls([{data:f,field:n.vgField(r,{suffix:"start"})},{data:f,field:n.vgField(r,{suffix:"end"})}])}const l=jh(r)&&Te(s)?JMt(n,r,e):void 0;if(Wh(s)){const f=lM([s.datum],o,a);return Ls(f)}const c=s;if(t==="unaggregated"){const f=n.requestDataName(ci),{field:h}=s;return Ls([{data:f,field:_e({field:h,aggregate:"min"})},{data:f,field:_e({field:h,aggregate:"max"})}])}else if(pn(c.bin)){if(Fs(e))return Ls(e==="bin-ordinal"?[]:[{data:VE(l)?n.requestDataName(ci):n.requestDataName(nA),field:n.vgField(r,XC(c,r)?{binSuffix:"range"}:{}),sort:l===!0||!Fr(l)?{field:n.vgField(r,{}),op:"min"}:l}]);{const{bin:f}=c;if(pn(f)){const h=iW(n,c.field,f);return Ls([new Ks(()=>{const d=n.getSignalName(h);return`[${d}.start, ${d}.stop]`})])}else return Ls([{data:n.requestDataName(ci),field:n.vgField(r,{})}])}}else if(c.timeUnit&&Ze(["time","utc"],e)&&EU(r,c,Rn(n)?n.encoding[hl(r)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(ci);return Ls([{data:f,field:n.vgField(r)},{data:f,field:n.vgField(r,{suffix:"end"})}])}else return Ls(l?[{data:VE(l)?n.requestDataName(ci):n.requestDataName(nA),field:n.vgField(r),sort:l}]:[{data:n.requestDataName(ci),field:n.vgField(r)}])}function cM(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:n??(t?"sum":nO)},r?{field:ah(r)}:{}),i?{order:i}:{})}function ZMt(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=ibe(i)&&i,a=GC(s)&&QF(s.extent)&&s.extent;(o||a)&&r.set("selectionExtent",o??a,!0)}function JMt(e,t,n){if(!Fs(n))return;const r=e.fieldDef(t),i=r.sort;if(bbe(i))return{op:"min",field:I0(r,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(ku(i)){const a=s&&!Ze(o,i.field);return cM(i,a)}else if(ybe(i)){const{encoding:a,order:u}=i,l=e.fieldDef(a),{aggregate:c,field:f}=l,h=s&&!Ze(o,f);if(uh(c)||Ng(c))return cM({field:_e(l),order:u},h);if(oU(c)||!c)return cM({op:c,field:f,order:u},h)}else{if(i==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(Ze(["ascending",void 0],i))return!0}}function RJ(e,t){const{aggregate:n,type:r}=e;return n?bt(n)&&!DTt[n]?{valid:!1,reason:CDt(n)}:r==="quantitative"&&t==="log"?{valid:!1,reason:SDt(e)}:{valid:!0}:{valid:!1,reason:wDt(e)}}function a4(e,t,n,r){return e.explicit&&t.explicit&&xe(ADt(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function QMt(e){const t=lf(e.map(o=>cf(o)?Ge(o,["sort"]):o),Ot),n=lf(e.map(o=>{if(cf(o)){const a=o.sort;return a!==void 0&&!VE(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),Ot);if(t.length===0)return;if(t.length===1){const o=e[0];if(cf(o)&&n.length>0){let a=n[0];if(n.length>1)xe(qZ),a=!0;else if(Fr(a)&&"field"in a){const u=a.field;o.field===u&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const r=lf(n.map(o=>VE(o)||!("op"in o)||o.op in $Tt?o:(xe(DDt(o)),!0)),Ot);let i;r.length===1?i=r[0]:r.length>1&&(xe(qZ),i=!0);const s=lf(e.map(o=>cf(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?Object.assign({data:s[0],fields:t.map(a=>a.field)},i?{sort:i}:{}):Object.assign({fields:t},i?{sort:i}:{})}function oW(e){if(cf(e)&&bt(e.field))return e.field;if(sIt(e)){let t;for(const n of e.fields)if(cf(n)&&bt(n.field)){if(!t)t=n.field;else if(t!==n.field)return xe(IDt),t}return xe(FDt),t}else if(oIt(e)){xe(ODt);const t=e.fields[0];return bt(t)?t:void 0}}function vO(e,t){const r=e.component.scales[t].get("domains").map(i=>(cf(i)&&(i.data=e.lookupDataSource(i.data)),i));return QMt(r)}function axe(e){return $y(e)||aW(e)?e.children.reduce((t,n)=>t.concat(axe(n)),PJ(e)):PJ(e)}function PJ(e){return Se(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:l,reverse:c}=i,f=Ge(i,["name","type","selectionExtent","domains","range","reverse"]),h=eRt(i.range,s,n);let d;a&&(d=eNt(e,a));const p=vO(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},p?{domain:p}:{}),d?{domainRaw:d}:{}),{range:h}),c!==void 0?{reverse:c}:{}),f)),t},[])}function eRt(e,t,n){return Uu(n)&&Uh(e)?{step:{signal:t+"_step"}}:e}class uxe extends Ac{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Zx(this.get("domains"),t=>Ye(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const tRt=["range","scheme"];function lxe(e){return e==="x"?"width":e==="y"?"height":void 0}function nRt(e){const t=e.component.scales;for(const n of JF){const r=t[n];if(!r)continue;const i=rRt(n,e);r.setWithExplicit("range",i)}}function LJ(e,t){const n=e.fieldDef(t);if(n&&n.bin&&pn(n.bin)){const r=iW(e,n.field,n.bin),i=lxe(t),s=e.getName(i);return new Ks(()=>{const o=e.getSignalName(r),a=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(s)} / (${a})`})}}function rRt(e,t){const n=t.specifiedScales[e],{size:r}=t,s=t.getScaleComponent(e).get("type");for(const o of tRt)if(n[o]!==void 0){const a=sbe(s,o),u=obe(e,o);if(!a)xe(Uye(s,o,e));else if(u)xe(u);else switch(o){case"range":return Ye(n.range)&&Uu(e)?jd(n.range.map(l=>{if(l==="width"||l==="height"){const c=t.getName(l),f=t.getSignalName.bind(t);return Ks.fromName(f,c)}return l})):jd(n.range);case"scheme":return jd(iRt(n[o]))}}if(e===On||e===pr){const o=e===On?"width":"height",a=r[o];if(Vu(a)){if(Fs(s))return jd({step:a.step});xe(Wye(o))}}return Ls(sRt(e,t))}function iRt(e){return DIt(e)?Object.assign({scheme:e.name},ql(e,["name"])):{scheme:e}}function sRt(e,t){const{size:n,config:r,mark:i,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=fr(s[e]),l=t.getScaleComponent(e).get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case On:case pr:{if(Ze(["point","band"],l)){if(e===On&&!n.width){const p=t2(r.view,"width");if(Vu(p))return p}else if(e===pr&&!n.height){const p=t2(r.view,"height");if(Vu(p))return p}}const h=lxe(e),d=t.getName(h);return e===pr&&zo(l)?[Ks.fromName(o,d),0]:[0,Ks.fromName(o,d)]}case kc:{const h=t.component.scales[e].get("zero"),d=cxe(i,h,r),p=uRt(i,n,t,r);return XE(l)?aRt(d,p,oRt(l,r,c,e)):[d,p]}case Va:return[0,Math.PI*2];case Mg:return[0,360];case al:return[0,new Ks(()=>{const h=t.getSignalName("width"),d=t.getSignalName("height");return`min(${h},${d})/2`})];case Lh:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case Bh:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Is:return"symbol";case Ds:case cl:case fl:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":i==="rect"||i==="geoshape"?"heatmap":"ramp";case Ec:case Rh:case Ph:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function oRt(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&Ye(n)?n.length+1:(xe(UDt(r)),3)}}function aRt(e,t,n){const r=()=>{const i=e2(t),s=e2(e),o=`(${i} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${i} + ${o}, ${o})`};return tt(t)?new Ks(r):{signal:r()}}function cxe(e,t,n){if(t)return tt(t)?{signal:`${t.signal} ? 0 : ${cxe(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(eO("size",e))}const BJ=.95;function uRt(e,t,n,r){const i={x:LJ(n,"x"),y:LJ(n,"y")};switch(e){case"bar":case"tick":{if(r.scale.maxBandSize!==void 0)return r.scale.maxBandSize;const s=zJ(t,i,r.view);return tr(s)?s-1:new Ks(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const s=zJ(t,i,r.view);return tr(s)?Math.pow(BJ*s,2):new Ks(()=>`pow(${BJ} * ${s.signal}, 2)`)}}throw new Error(eO("size",e))}function zJ(e,t,n){const r=Vu(e.width)?e.width.step:eA(n,"width"),i=Vu(e.height)?e.height.step:eA(n,"height");return t.x||t.y?new Ks(()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`):Math.min(r,i)}function fxe(e,t){Rn(e)?lRt(e,t):dxe(e,t)}function lRt(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:s,specifiedScales:o}=e;for(const a of Se(n)){const u=o[a],l=n[a],c=e.getScaleComponent(a),f=fr(i[a]),h=u[t],d=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=sbe(d,t),y=obe(a,t);if(h!==void 0&&(g?y&&xe(y):xe(Uye(d,t,a))),g&&y===void 0)if(h!==void 0)l.copyKeyFromObject(t,u);else{const b=t in jJ?jJ[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:d,scalePadding:p,scalePaddingInner:m,domain:u.domain,markDef:s,config:r}):r.scale[t];b!==void 0&&l.set(t,b,!1)}}}const jJ={bins:({model:e,fieldOrDatumDef:t})=>Te(t)?cRt(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>fRt(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>hRt(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>dRt(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>pRt(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:s})=>gRt(e,t,n,r.type,i,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>{const i=Te(e)?e.sort:void 0;return mRt(t,i,n,r.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>yRt(e,t,n,r,i)};function hxe(e){Rn(e)?nRt(e):dxe(e,"range")}function dxe(e,t){const n=e.component.scales;for(const r of e.children)t==="range"?hxe(r):fxe(r,t);for(const r of Se(n)){let i;for(const s of e.children){const o=s.component.scales[r];if(o){const a=o.getWithExplicit(t);i=ch(i,a,t,"scale",rve((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[r].setWithExplicit(t,i)}}function cRt(e,t){const n=t.bin;if(pn(n)){const r=iW(e,t.field,n);return new Ks(()=>e.getSignalName(r))}else if(zi(n)&&GC(n)&&n.step!==void 0)return{step:n.step}}function fRt(e,t){if(Ze([Ds,cl,fl],e)&&t!=="nominal")return"hcl"}function hRt(e,t,n){var r;if(!(!((r=Wu(n))===null||r===void 0)&&r.bin||Ze([Xn.TIME,Xn.UTC],e)))return t in zh?!0:void 0}function dRt(e,t,n,r,i,s){if(e in zh){if(ya(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=i;if(o==="bar"&&!(Te(r)&&(r.bin||r.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===Xn.POINT)return n.pointPadding}}function pRt(e,t,n,r){if(e===void 0&&t in zh){const{bandPaddingInner:i,barBandPaddingInner:s,rectBandPaddingInner:o}=r;return nr(i,n==="bar"?s:o)}}function gRt(e,t,n,r,i,s){if(e===void 0&&t in zh&&n===Xn.BAND){const{bandPaddingOuter:o}=s;return nr(o,tt(i)?{signal:`${i.signal}/2`}:i/2)}}function mRt(e,t,n,r){if(n==="x"&&r.xReverse!==void 0)return zo(e)&&t==="descending"?tt(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse;if(zo(e)&&t==="descending")return!0}function yRt(e,t,n,r,i){if(!!n&&n!=="unaggregated"&&zo(i)){if(Ye(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!XE(i))return!0;if(!(Te(t)&&t.bin)&&Ze([...Bo,...jTt],e)){const{orient:o,type:a}=r;return!(Ze(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function bRt(e,t,n,r){const i=vRt(t,n,r),{type:s}=e;return jh(t)?s!==void 0?ube(t,s)?Te(n)&&!abe(s,n.type)?(xe(kDt(s,i)),i):s:(xe($Dt(t,s,i)),i):i:null}function vRt(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(Tm(e)||h$(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&xe(J3(e,"ordinal")),"ordinal";if(e in zh){if(Ze(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in cU)return"band";return t.band!==void 0||IU(t)&&(!((r=t.axis)===null||r===void 0)&&r.tickBand)?"band":"point";case"temporal":return Tm(e)?"time":h$(e)==="discrete"?(xe(J3(e,"temporal")),"ordinal"):Te(t)&&t.timeUnit&&Ji(t.timeUnit).utc?"utc":"time";case"quantitative":return Tm(e)?Te(t)&&pn(t.bin)?"bin-ordinal":"linear":h$(e)==="discrete"?(xe(J3(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(zye(t.type))}function xRt(e,{ignoreRange:t}={}){pxe(e),oxe(e);for(const n of NIt)fxe(e,n);t||hxe(e)}function pxe(e){Rn(e)?e.component.scales=wRt(e):e.component.scales=SRt(e)}function wRt(e){const{encoding:t,mark:n}=e;return JF.reduce((r,i)=>{const s=fr(t[i]);if(s&&n===_ye&&i===Is&&s.type===xy)return r;let o=s&&s.scale;if(s&&o!==null&&o!==!1){o=o??{};const a=bRt(o,i,s,n);r[i]=new uxe(e.scaleName(i+"",!0),{value:a,explicit:o.type===a})}return r},{})}const CRt=rve((e,t)=>YZ(e)-YZ(t));function SRt(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const s of e.children){pxe(s);for(const o of Se(s.component.scales))if(i.scale[o]=(t=i.scale[o])!==null&&t!==void 0?t:H3t(o,e),i.scale[o]==="shared"){const a=r[o],u=s.component.scales[o].getWithExplicit("type");a?yIt(a.value,u.value)?r[o]=ch(a,u,"type","scale",CRt):(i.scale[o]="independent",delete r[o]):r[o]=u}}for(const s of Se(r)){const o=e.scaleName(s,!0),a=r[s];n[s]=new uxe(o,a);for(const u of e.children){const l=u.component.scales[s];l&&(u.renameScale(l.get("name"),o),l.merged=!0)}}return n}class fM{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function Rn(e){return(e==null?void 0:e.type)==="unit"}function _a(e){return(e==null?void 0:e.type)==="facet"}function aW(e){return(e==null?void 0:e.type)==="concat"}function $y(e){return(e==null?void 0:e.type)==="layer"}class uW{constructor(t,n,r,i,s,o,a){var u,l;this.type=n,this.parent=r,this.config=s,this.view=a,this.children=[],this.correctDataNames=c=>(c.from&&c.from.data&&(c.from.data=this.lookupDataSource(c.from.data)),c.from&&c.from.facet&&c.from.facet.data&&(c.from.facet.data=this.lookupDataSource(c.from.facet.data)),c),this.parent=r,this.config=s,this.name=(u=t.name)!==null&&u!==void 0?u:i,this.title=Wc(t.title)?{text:t.title}:t.title,this.scaleNameMap=r?r.scaleNameMap:new fM,this.projectionNameMap=r?r.projectionNameMap:new fM,this.signalNameMap=r?r.signalNameMap:new fM,this.data=t.data,this.description=t.description,this.transforms=kOt((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:EFt(t,n,s),this.component={data:{sources:r?r.component.data.sources:[],outputNodes:r?r.component.data.outputNodes:{},outputNodeRefCounts:r?r.component.data.outputNodeRefCounts:{},isFaceted:rO(t)||r&&r.component.data.isFaceted&&t.data===void 0},layoutSize:new Ac,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?vt(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){xRt(this)}parseProjection(){nxe(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Zve(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=Ge(t,["style"]),r={};for(const i of Se(n)){const s=n[i];s!==void 0&&(r[i]=Vn(s))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=Vn(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):on(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,r=Ge(t,["spacing"]),{component:i,config:s}=this,o=G3t(i.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),r),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const r of Eo)t[r].title&&n.push(B3t(this,r));for(const r of eW)n=n.concat(z3t(this,r));return n}assembleAxes(){return $3t(this.component.axes,this.config)}assembleLegends(){return Qve(this)}assembleProjections(){return pMt(this)}assembleTitle(){var t,n,r;const i=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=i,o=Ge(i,["encoding"]),a=Object.assign(Object.assign(Object.assign({},Dbe(this.config.title).nonMark),o),s?{encode:{update:s}}:{});if(a.text)return Ze(["unit","layer"],this.type)?Ze(["middle",void 0],a.anchor)&&(a.frame=(n=a.frame)!==null&&n!==void 0?n:"group"):a.anchor=(r=a.anchor)!==null&&r!==void 0?r:"start",on(a)?void 0:a}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const r=this.assembleLayout();r&&(n.layout=r),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||_a(this.parent)?axe(this):[];i.length>0&&(n.scales=i);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return En((this.name?this.name+"_":"")+t)}requestDataName(t){var n;const r=this.getName(t),i=this.component.data.outputNodeRefCounts;return i[r]=((n=i[r])!==null&&n!==void 0?n:0)+1,r}getSizeSignalRef(t){if(_a(this.parent)){const n=Gve(t),r=ZF(n),i=this.component.scales[r];if(i&&!i.merged){const s=i.get("type"),o=i.get("range");if(Fs(s)&&Uh(o)){const a=i.get("name"),u=vO(this,r),l=oW(u);if(l){const c=_e({aggregate:"distinct",field:l},{expr:"datum"});return{signal:Vve(a,i,c)}}else return xe(`Unknown field for ${r}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(Oye(t)&&jh(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let r=this.component.selection[t];if(!r&&this.parent&&(r=this.parent.getSelectionComponent(t,n)),!r)throw new Error(ZTt(n));return r}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(r=>r.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(r=>r.hasOrientSignalRef()))}}class gxe extends uW{vgField(t,n={}){const r=this.fieldDef(t);if(r)return _e(r,n)}reduceFieldDef(t,n){return Pbe(this.getMapping(),(r,i,s)=>{const o=Wu(i);return o?t(r,o,s):r},n)}forEachFieldDef(t,n){RU(this.getMapping(),(r,i)=>{const s=Wu(r);s&&t(s,i)},n)}}class xO extends nn{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=vt(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new xO(null,vt(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Ot(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,r=Ge(t,["density"]);return Object.assign({type:"kde",field:n},r)}}class o2 extends nn{constructor(t,n){super(t),this.filter=n}clone(){return new o2(null,Object.assign({},this.filter))}static make(t,n){const{config:r,mark:i,markDef:s}=n;if(Gt("invalid",s,r)!=="filter")return null;const a=n.reduceFieldDef((u,l,c)=>{const f=jh(c)&&n.getScaleComponent(c);if(f){const h=f.get("type");zo(h)&&l.aggregate!=="count"&&!Og(i)&&(u[l.field]=l)}return u},{});return Se(a).length?new o2(t,a):null}dependentFields(){return new Set(Se(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Ot(this.filter)}`}assemble(){const t=Se(this.filter).reduce((n,r)=>{const i=this.filter[r],s=_e(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):i.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class wO extends nn{constructor(t,n){super(t),this.transform=n,this.transform=vt(n);const{flatten:r,as:i=[]}=this.transform;this.transform.as=r.map((s,o)=>{var a;return(a=i[o])!==null&&a!==void 0?a:s})}clone(){return new wO(this.parent,vt(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Ot(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class CO extends nn{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=vt(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new CO(null,vt(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Ot(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class Dm extends nn{constructor(t,n,r,i){super(t),this.fields=n,this.geojson=r,this.signal=i}clone(){return new Dm(null,vt(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let r=0;for(const i of[[ll,ul],[Lo,Ga]]){const s=i.map(o=>{const a=fr(n.encoding[o]);return Te(a)?a.field:Wh(a)?{expr:`${a.datum}`}:lc(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new Dm(t,s,null,n.getName(`geojson_${r++}`)))}if(n.channelHasField(Is)){const i=n.typedFieldDef(Is);i.type===xy&&(t=new Dm(t,null,i.field,n.getName(`geojson_${r++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(bt);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Ot(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class a2 extends nn{constructor(t,n,r,i){super(t),this.projection=n,this.fields=r,this.as=i}clone(){return new a2(null,this.projection,vt(this.fields),vt(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const r of[[ll,ul],[Lo,Ga]]){const i=r.map(o=>{const a=fr(n.encoding[o]);return Te(a)?a.field:Wh(a)?{expr:`${a.datum}`}:lc(a)?{expr:`${a.value}`}:void 0}),s=r[0]===Lo?"2":"";(i[0]||i[1])&&(t=new a2(t,n.projectionName(),i,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter(bt))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Ot(this.fields)} ${Ot(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class op extends nn{constructor(t,n){super(t),this.transform=n}clone(){return new op(null,vt(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:r,step:i}=t;return{signal:`sequence(${[n,r,...i?[i]:[]].join(",")})`}}static makeFromTransform(t,n){return new op(t,n)}static makeFromEncoding(t,n){const r=n.encoding,i=r.x,s=r.y;if(Te(i)&&Te(s)){const o=i.impute?i:s.impute?s:void 0;if(o===void 0)return;const a=i.impute?s:s.impute?i:void 0,{method:u,value:l,frame:c,keyvals:f}=o.impute,h=Lbe(n.mark,r);return new op(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},u?{method:u}:{}),l!==void 0?{value:l}:{}),c?{frame:c}:{}),f!==void 0?{keyvals:f}:{}),h.length?{groupby:h}:{}))}return null}hash(){return`Impute ${Ot(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:r,method:i,groupby:s,value:o,frame:a=[null,null]}=this.transform,u=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},r?{keyvals:oOt(r)?this.processSequence(r):r}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!i||i==="value"?o:null});if(i&&i!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}class SO extends nn{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=vt(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new SO(null,vt(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Ot(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:r}=t,i=Ge(t,["loess","on"]);return Object.assign({type:"loess",x:r,y:n},i)}}class u2 extends nn{constructor(t,n,r){super(t),this.transform=n,this.secondary=r}clone(){return new u2(null,vt(this.transform),this.secondary)}static make(t,n,r,i){const s=n.component.data.sources,{from:o}=r;let a=null;if(uOt(o)){let u=bxe(o.data,s);u||(u=new O0(o.data),s.push(u));const l=n.getName(`lookup_${i}`);a=new Gi(u,l,"lookup",n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(lOt(o)){const u=o.selection;if(r=Object.assign({as:u},r),a=n.getSelectionComponent(En(u),u).materialized,!a)throw new Error(eDt(u))}return new u2(t,r,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?qn(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Ot({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:qn(this.transform.as)}:{});else{let n=this.transform.as;bt(n)||(xe(sDt),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class _O extends nn{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=vt(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new _O(null,vt(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Ot(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,r=Ge(t,["quantile"]);return Object.assign({type:"quantile",field:n},r)}}class $O extends nn{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=vt(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new $O(null,vt(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Ot(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:r}=t,i=Ge(t,["regression","on"]);return Object.assign({type:"regression",x:r,y:n},i)}}class kO extends nn{constructor(t,n){super(t),this.transform=n}clone(){return new kO(null,vt(this.transform))}addDimensions(t){var n;this.transform.groupby=lf(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),r=>r)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${Ot(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:r,limit:i,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},i!==void 0?{limit:i}:{}),s!==void 0?{op:s}:{}),r!==void 0?{groupby:r}:{})}}class EO extends nn{constructor(t,n){super(t),this.transform=n}clone(){return new EO(null,vt(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Ot(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function mxe(e){let t=0;function n(r,i){var s;if(r instanceof O0&&!r.isGenerator&&!n2(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof bi&&(r.parent instanceof O0&&!i.source?(i.format=Object.assign(Object.assign({},(s=i.format)!==null&&s!==void 0?s:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof Sy){i.name||(i.name=`data_${t++}`),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const o of r.assemble())e.push(o);return}switch((r instanceof eS||r instanceof tS||r instanceof o2||r instanceof Cy||r instanceof D0||r instanceof a2||r instanceof Dm||r instanceof Sa||r instanceof u2||r instanceof _y||r instanceof Bg||r instanceof CO||r instanceof wO||r instanceof xO||r instanceof SO||r instanceof _O||r instanceof $O||r instanceof dh||r instanceof EO||r instanceof kO)&&i.transform.push(r.assemble()),(r instanceof Au||r instanceof Eu||r instanceof op||r instanceof Zl)&&i.transform.push(...r.assemble()),r instanceof Gi&&(i.source&&i.transform.length===0?r.setSource(i.source):r.parent instanceof Gi?r.setSource(i.name):(i.name||(i.name=`data_${t++}`),r.setSource(i.name),r.numChildren()===1&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof Gi&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name=`data_${t++}`);let o=i.name;!i.source||i.transform.length>0?e.push(i):o=i.source;for(const a of r.children)n(a,{name:null,source:o,transform:[]});break}}}return n}function _Rt(e){const t=[],n=mxe(t);for(const r of e.children)n(r,{source:e.name,name:null,transform:[]});return t}function $Rt(e,t){var n,r;const i=[],s=mxe(i);let o=0;for(const u of e.sources){u.hasName()||(u.dataName=`source_${o++}`);const l=u.assemble();s(u,l)}for(const u of i)u.transform.length===0&&delete u.transform;let a=0;for(const[u,l]of i.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&i.splice(a++,0,i.splice(u,1)[0]);for(const u of i)for(const l of(r=u.transform)!==null&&r!==void 0?r:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const u of i)u.name in t&&(u.values=t[u.name]);return i}function kRt(e){return e==="top"||e==="left"||tt(e)?"header":"footer"}function ERt(e){for(const t of Eo)ARt(e,t);UJ(e,"x"),UJ(e,"y")}function ARt(e,t){var n;const{facet:r,config:i,child:s,component:o}=e;if(e.channelHasField(t)){const a=r[t],u=F0("title",null,i,t);let l=rp(a,i,{allowDisabling:!0,includeDefault:u===void 0||!!u});s.component.layoutHeaders[t].title&&(l=Ye(l)?l.join(", "):l,l+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const c=F0("labelOrient",a,i,t),f=(n=a.header)!==null&&n!==void 0?n:{},h=nr(f.labels,i.header.labels,!0),d=Ze(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:l,facetFieldDef:a,[d]:t==="facet"?[]:[yxe(e,t,h)]}}}function yxe(e,t,n){const r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function UJ(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:s}=e.component;if(s.axis[t]=rW(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=i[o];for(const u of r.component.axes[t]){const l=kRt(u.get("orient"));a[l]=(n=a[l])!==null&&n!==void 0?n:[yxe(e,o,!1)];const c=qb(u,"main",e.config,{header:!0});c&&a[l][0].axes.push(c),u.mainExtracted=!0}}}}function TRt(e){lW(e),aA(e,"width"),aA(e,"height")}function DRt(e){lW(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";aA(e,t),aA(e,n)}function lW(e){for(const t of e.children)t.parseLayoutSize()}function aA(e,t){const n=Gve(t),r=ZF(n),i=e.component.resolve,s=e.component.layoutSize;let o;for(const a of e.children){const u=a.component.layoutSize.getWithExplicit(n),l=i.scale[r];if(l==="independent"&&u.value==="step"){o=void 0;break}if(o){if(l==="independent"&&o.value!==u.value){o=void 0;break}o=ch(o,u,n,"")}else o=u}if(o){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,o)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function IRt(e){const{size:t,component:n}=e;for(const r of Bo){const i=dl(r);if(t[i]){const s=t[i];n.layoutSize.set(i,Vu(s)?"step":s,!0)}else{const s=FRt(e,i);n.layoutSize.set(i,s,!1)}}}function FRt(e,t){const n=t==="width"?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const s=i.get("type"),o=i.get("range");if(Fs(s)){const a=t2(r.view,t);return Uh(o)||Vu(a)?"step":a}else return HL(r.view,t)}else{if(e.hasProjection||e.mark==="arc")return HL(r.view,t);{const s=t2(r.view,t);return Vu(s)?s.step:s}}}function u4(e,t,n){return _e(t,Object.assign({suffix:`by_${_e(e)}`},n??{}))}class wv extends gxe{constructor(t,n,r,i){super(t,"facet",n,r,i,t.resolve),this.child=dW(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet,i)}initFacet(t,n){return HC(t)?Pbe(t,(r,i,s)=>Ze([Xl,Yl],s)?i.field===void 0?(xe(jL(i,s)),r):(r[s]=VL(i,s,n),r):(xe(eO(s,"facet")),r),{}):{facet:VL(t,"facet",n)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=AO(this),this.child.parseData()}parseLayoutSize(){lW(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),ERt(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,r;const i={};for(const s of Eo)for(const o of tW){const a=this.component.layoutHeaders[s],u=a[o],{facetFieldDef:l}=a;if(l){const c=F0("titleOrient",l,this.config,s);if(Ze(["right","bottom"],c)){const f=mO(s,c);i.titleAnchor=(t=i.titleAnchor)!==null&&t!==void 0?t:{},i.titleAnchor[f]="end"}}if(u!=null&&u[0]){const c=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(c)&&(i[f]=(n=i[f])!==null&&n!==void 0?n:{},i[f][s]=.5),a.title&&(i.offset=(r=i.offset)!==null&&r!==void 0?r:{},i.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:t,row:n}=this.facet,r=t?this.columnDistinctSignal():n?1:void 0;let i="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof wv))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof wv?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:_e(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],r=[];if(this.child instanceof wv){if(this.child.channelHasField("column")){const i=_e(this.child.facet.column);t.push(i),n.push("distinct"),r.push(`distinct_${i}`)}}else for(const i of Bo){const s=this.child.component.scales[i];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(Fs(o)&&Uh(a)){const u=vO(this.child,i),l=oW(u);l?(t.push(l),n.push("distinct"),r.push(`distinct_${l}`)):xe(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:t,ops:n,as:r}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:r,column:i}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const c of Eo){const f=this.facet[c];if(f){u.push(_e(f));const{bin:h,sort:d}=f;if(pn(h)&&u.push(_e(f,{binSuffix:"end"})),ku(d)){const{field:p,op:m=nO}=d,g=u4(f,d);r&&i?(s.push(g),o.push("max"),a.push(g)):(s.push(p),o.push(m),a.push(g))}else if(Ye(d)){const p=I0(f,c);s.push(p),o.push("max"),a.push(p)}}}const l=!!r&&!!i;return Object.assign({name:t,data:n,groupby:u},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,r=n[t];return r?ku(r.sort)?[u4(r,r.sort,{expr:"datum"})]:Ye(r.sort)?[I0(r,t,{expr:"datum"})]:[_e(r,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,r=n[t];if(r){const{sort:i}=r;return[(ku(i)?i.order:!Ye(i)&&i)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return n4(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of eW)if(t[i]){const s=F0("labelOrient",t[i],n,i);if(Ze(r[i],s))return n4(t[i],i,n)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,r=_Rt(n),i=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:Eo.map(u=>this.facetSortFields(u)).flat(),order:Eo.map(u=>this.facetSortOrder(u)).flat()}}),r.length>0?{data:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup(KOt(this,[])))]}getMapping(){return this.facet}}function ORt(e,t){const{row:n,column:r}=t;if(n&&r){let i=null;for(const s of[n,r])if(ku(s.sort)){const{field:o,op:a=nO}=s.sort;e=i=new Bg(e,{joinaggregate:[{op:a,field:o,as:u4(s,s.sort,{forAs:!0})}],groupby:[_e(s)]})}return i}return null}function bxe(e,t){var n,r,i,s,o,a,u,l,c,f;for(const h of t){const d=h.data;if(!(e.name&&h.hasName()&&e.name!==h.dataName)&&!(!((n=e.format)===null||n===void 0)&&n.mesh&&(!((r=d.format)===null||r===void 0)&&r.feature))&&!((!((i=e.format)===null||i===void 0)&&i.feature||!((s=d.format)===null||s===void 0)&&s.feature)&&((o=e.format)===null||o===void 0?void 0:o.feature)!==((a=d.format)===null||a===void 0?void 0:a.feature))&&!((!((u=e.format)===null||u===void 0)&&u.mesh||!((l=d.format)===null||l===void 0)&&l.mesh)&&((c=e.format)===null||c===void 0?void 0:c.mesh)!==((f=d.format)===null||f===void 0?void 0:f.mesh))){if(tA(e)&&tA(d)){if(jC(e.values,d.values))return h}else if(n2(e)&&n2(d)){if(e.url===d.url)return h}else if(ive(e)&&e.name===h.dataName)return h}}return null}function NRt(e,t){if(e.data||!e.parent){if(e.data===null){const r=new O0({values:[]});return t.push(r),r}const n=bxe(e.data,t);if(n)return sp(e.data)||(n.data.format=QAt({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const r=new O0(e.data);return t.push(r),r}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function MRt(e,t,n){var r,i;let s=0;for(const o of t.transforms){let a,u;if(vOt(o))u=e=new D0(e,o),a="derived";else if(ave(o)){const l=EMt(o);u=e=(r=bi.makeWithAncestors(e,{},l,n))!==null&&r!==void 0?r:e,e=new Cy(e,t,o.filter)}else if(xOt(o))u=e=Au.makeFromTransform(e,o,t),a="number";else if(COt(o))a="date",n.getWithExplicit(o.field).value===void 0&&(e=new bi(e,{[o.field]:a}),n.set(o.field,a,!1)),u=e=Eu.makeFromTransform(e,o);else if(SOt(o))u=e=Sa.makeFromTransform(e,o),a="number",KU(t)&&(e=new dh(e));else if(aOt(o))u=e=u2.make(e,t,o,s++),a="derived";else if(mOt(o))u=e=new _y(e,o),a="number";else if(yOt(o))u=e=new Bg(e,o),a="number";else if(_Ot(o))u=e=Zl.makeFromTransform(e,o),a="derived";else if($Ot(o))u=e=new CO(e,o),a="derived";else if(bOt(o))u=e=new wO(e,o),a="derived";else if(cOt(o))u=e=new kO(e,o),a="derived";else if(gOt(o))e=new EO(e,o);else if(wOt(o))u=e=op.makeFromTransform(e,o),a="derived";else if(fOt(o))u=e=new xO(e,o),a="derived";else if(hOt(o))u=e=new _O(e,o),a="derived";else if(dOt(o))u=e=new $O(e,o),a="derived";else if(pOt(o))u=e=new SO(e,o),a="derived";else{xe(iDt(o));continue}if(u&&a!==void 0)for(const l of(i=u.producedFields())!==null&&i!==void 0?i:[])n.set(l,a,!1)}return e}function AO(e){var t,n,r,i,s,o,a,u,l,c;let f=NRt(e,e.component.data.sources);const{outputNodes:h,outputNodeRefCounts:d}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new sOt,m=e.data;sp(m)?(sve(m)?f=new tS(f,m.sequence):GU(m)&&(f=new eS(f,m.graticule)),p.parseNothing=!0):((t=m==null?void 0:m.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=bi.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new dh(f);const g=e.parent&&$y(e.parent);(Rn(e)||_a(e))&&g&&(f=(r=Au.makeFromEncoding(f,e))!==null&&r!==void 0?r:f),e.transforms.length>0&&(f=MRt(f,e,p));const y=TMt(e),b=AMt(e);f=(i=bi.makeWithAncestors(f,{},Object.assign(Object.assign({},y),b),p))!==null&&i!==void 0?i:f,Rn(e)&&(f=Dm.parseAll(f,e),f=a2.parseAll(f,e)),(Rn(e)||_a(e))&&(g||(f=(s=Au.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Eu.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=D0.parseAllForSortIndex(f,e));const x=e.getName(nA),v=new Gi(f,x,nA,d);if(h[x]=v,f=v,Rn(e)){const _=Sa.makeFromEncoding(f,e);_&&(f=_,KU(e)&&(f=new dh(f))),f=(a=op.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(u=Zl.makeFromEncoding(f,e))!==null&&u!==void 0?u:f}Rn(e)&&(f=(l=o2.make(f,e))!==null&&l!==void 0?l:f);const w=e.getName(ci),C=new Gi(f,w,ci,d);h[w]=C,f=C,Rn(e)&&S3t(e,C);let S=null;if(_a(e)){const _=e.getName("facet");f=(c=ORt(f,e.facet))!==null&&c!==void 0?c:f,S=new Sy(f,e,_,C.getSource()),h[_]=S}return Object.assign(Object.assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:d,raw:v,main:C,facetRoot:S,ancestorParse:p})}class RRt extends uW{constructor(t,n,r,i){var s,o,a,u;super(t,"concat",n,r,i,t.resolve),(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((u=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||u===void 0?void 0:u.y)==="shared")&&xe(nDt),this.children=this.getChildren(t).map((l,c)=>dW(l,this,this.getName("concat_"+c),void 0,i))}parseData(){this.component.data=AO(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of Se(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return aO(t)?t.vconcat:WU(t)?t.hconcat:t.concat}parseLayoutSize(){DRt(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=nW(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),r=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),r?{style:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function PRt(e){return e===!1||e===null}const LRt=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},wye),{labelExpr:1,encode:1}),vxe=Se(LRt);class cW extends Ac{constructor(t={},n={},r=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=r}clone(){return new cW(vt(this.explicit),vt(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!PRt(this.get(t))}hasOrientSignalRef(){return tt(this.explicit.orient)}}function BRt(e,t,n){var r;const{encoding:i,config:s}=e,o=(r=fr(i[t]))!==null&&r!==void 0?r:fr(i[hl(t)]),a=e.axis(t)||{},{format:u,formatType:l}=a;return Bp(l)?Object.assign({text:$U({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:l,config:s})},n):n}function zRt(e){return Bo.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[qRt(n,e)]),t),{})}const jRt={bottom:"top",top:"bottom",left:"right",right:"left"};function URt(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of Se(s.component.axes))r.axis[o]=rW(e.component.resolve,o),r.axis[o]==="shared"&&(n[o]=WRt(n[o],s.component.axes[o]),n[o]||(r.axis[o]="independent",delete n[o]))}for(const s of Bo){for(const o of e.children)if(o.component.axes[s]){if(r.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:u,explicit:l}=a.getWithExplicit("orient");if(!tt(u)){if(i[u]>0&&!l){const c=jRt[u];i[u]>i[c]&&a.set("orient",c,!1)}i[u]++}}}delete o.component.axes[s]}if(r.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function WRt(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const i=e[r],s=t[r];if(!!i!=!!s)return;if(i&&s){const o=i.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[r]=VRt(i,s)}}}else return t.map(n=>n.clone());return e}function VRt(e,t){for(const n of vxe){const r=ch(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(i,s)=>{switch(n){case"title":return Rbe(i,s);case"gridScale":return{explicit:i.explicit,value:nr(i.value,s.value)}}return lO(i,s,n,"axis")});e.setWithExplicit(n,r)}return e}function GRt(e,t,n,r,i){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(tt(n.labelAngle)?n.labelAngle:GE(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===zve(r,i))return!0}return e===n[t]}const HRt=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function qRt(e,t){var n,r,i;let s=t.axis(e);const o=new cW,a=fr(t.encoding[e]),{mark:u,config:l}=t,c=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((r=l.axis)===null||r===void 0?void 0:r.orient)||M3t(e),f=t.getScaleComponent(e).get("type"),h=A3t(e,f,c,t.config),d=s!==void 0?!s:e4("disable",l,s==null?void 0:s.style,h).configValue;if(o.set("disable",d,s!==void 0),d)return o;s=s||{};const p=F3t(t,s,e,a,h),m={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:u,config:l};for(const b of vxe){const x=b in EJ?EJ[b](m):RZ(b)?s[b]:void 0,v=x!==void 0,w=GRt(x,b,s,t,e);if(v&&w)o.set(b,x,w);else{const{configValue:C=void 0,configFrom:S=void 0}=RZ(b)&&b!=="values"?e4(b,t.config,s.style,h):{},_=C!==void 0;v&&!_?o.set(b,x,w):(S!=="vgAxisConfig"||HRt.has(b)&&_||nU(C)||tt(C))&&o.set(b,C,!1)}}const g=(i=s.encoding)!==null&&i!==void 0?i:{},y=xye.reduce((b,x)=>{var v;if(!o.hasAxisPart(x))return b;const w=Hve((v=g[x])!==null&&v!==void 0?v:{},t),C=x==="labels"?BRt(t,e,w):w;return C!==void 0&&!on(C)&&(b[x]={update:C}),b},{});return on(y)||o.set("encode",y,!!s.encoding||s.labelAngle!==void 0),o}function XRt({encoding:e,size:t}){for(const n of Bo){const r=dl(n);Vu(t[r])&&pu(e[n])&&(delete t[r],xe(Wye(r)))}return t}function YRt(e,t,n,{graticule:r}){const i=ju(e)?Object.assign({},e):{type:e},s=Gt("orient",i,n);if(i.orient=QRt(i.type,t,s),s!==void 0&&s!==i.orient&&xe(bDt(i.orient,s)),i.type==="bar"&&i.orient){const l=Gt("cornerRadiusEnd",i,n);if(l!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:vTt[i.orient];for(const f of c)i[f]=l;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Gt("opacity",i,n)===void 0&&(i.opacity=ZRt(i.type,t)),i.filled===void 0&&(i.filled=r?!1:JRt(i,n)),Gt("cursor",i,n)===void 0&&(i.cursor=KRt(i,t,n)),i}function KRt(e,t,n){return t.href||e.href||Gt("href",e,n)?"pointer":e.cursor}function ZRt(e,t){if(Ze([VF,rU,iU,sU],e)&&!NU(t))return .7}function JRt(e,t){const n=zp("filled",e,t),r=e.type;return nr(n,r!==VF&&r!==WF&&r!==HE)}function QRt(e,t,n){switch(e){case VF:case iU:case sU:case Sye:case fTt:case cTt:return}const{x:r,y:i,x2:s,y2:o}=t;switch(e){case UF:if(Te(r)&&(zi(r.bin)||Te(i)&&i.aggregate&&!r.aggregate))return"vertical";if(Te(i)&&(zi(i.bin)||Te(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(Te(r)&&r.type===Lp&&!pn(r.bin)||WL(r)))return"horizontal";if(!o&&(Te(i)&&i.type===Lp&&!pn(i.bin)||WL(i)))return"vertical"}case HE:if(s&&!(Te(r)&&zi(r.bin))&&o&&!(Te(i)&&zi(i.bin)))return;case jF:if(o)return Te(i)&&zi(i.bin)?"horizontal":"vertical";if(s)return Te(r)&&zi(r.bin)?"vertical":"horizontal";if(e===HE){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case WF:case rU:{const a=pu(r),u=pu(i);if(a&&!u)return e!=="tick"?"horizontal":"vertical";if(!a&&u)return e!=="tick"?"vertical":"horizontal";if(a&&u){const l=r,c=i,f=l.type===E0,h=c.type===E0;return f&&!h?e!=="tick"?"vertical":"horizontal":!f&&h?e!=="tick"?"horizontal":"vertical":!l.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!c.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const ePt={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),mi("x",e,{defaultPos:"mid"})),mi("y",e,{defaultPos:"mid"})),fh(e,"radius","arc")),fh(e,"theta","arc"))},tPt={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),rA("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),rA("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),XU(e))},nPt={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),fh(e,"x","bar")),fh(e,"y","bar"))},rPt={vgMark:"shape",encodeEntry:e=>Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&Te(n)&&n.type===xy?{field:_e(n,{expr:"datum"})}:{})]}},iPt={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),fh(e,"x","image")),fh(e,"y","image")),HU(e,"url"))},sPt={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),mi("x",e,{defaultPos:"mid"})),mi("y",e,{defaultPos:"mid"})),Sr("size",e,{vgChannel:"strokeWidth"})),XU(e))},oPt={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),mi("x",e,{defaultPos:"mid"})),mi("y",e,{defaultPos:"mid"})),Sr("size",e)),XU(e))};function fW(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),mi("x",e,{defaultPos:"mid"})),mi("y",e,{defaultPos:"mid"})),Sr("size",e)),Sr("angle",e)),aPt(e,n,t))}function aPt(e,t,n){return n?{shape:{value:n}}:Sr("shape",e)}const uPt={vgMark:"symbol",encodeEntry:e=>fW(e)},lPt={vgMark:"symbol",encodeEntry:e=>fW(e,"circle")},cPt={vgMark:"symbol",encodeEntry:e=>fW(e,"square")},fPt={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),fh(e,"x","rect")),fh(e,"y","rect"))},hPt={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),rA("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),rA("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),Sr("size",e,{vgChannel:"strokeWidth"}))}},dPt={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),mi("x",e,{defaultPos:"mid"})),mi("y",e,{defaultPos:"mid"})),HU(e)),Sr("size",e,{vgChannel:"fontSize"})),Sr("angle",e)),mJ("align",pPt(e.markDef,n,t))),mJ("baseline",gPt(e.markDef,n,t))),mi("radius",e,{defaultPos:null,isMidPoint:!0})),mi("theta",e,{defaultPos:null,isMidPoint:!0}))}};function pPt(e,t,n){if(Gt("align",e,n)===void 0)return"center"}function gPt(e,t,n){if(Gt("baseline",e,n)===void 0)return"middle"}const mPt={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i=r==="horizontal"?"width":"height",s=r==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},qo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),mi("x",e,{defaultPos:"mid",vgChannel:"xc"})),mi("y",e,{defaultPos:"mid",vgChannel:"yc"})),Sr("size",e,{defaultValue:yPt(e),vgChannel:i})),{[s]:Vn(Gt("thickness",n,t))})}};function yPt(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,s=i==="horizontal"?"width":"height",o=e.getScaleComponent(i==="horizontal"?"x":"y"),a=(t=Gt("size",r,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const u=o?o.get("range"):void 0;return u&&Uh(u)&&tr(u.step)?u.step*3/4:eA(n.view,s)*3/4}}const x_={arc:ePt,area:tPt,bar:nPt,circle:lPt,geoshape:rPt,image:iPt,line:sPt,point:uPt,rect:fPt,rule:hPt,square:cPt,text:dPt,tick:mPt,trail:oPt};function bPt(e){return Ze([WF,jF,hTt],e.mark)?vPt(e):Ze([UF],e.mark)?xPt(e):uA(e)}const WJ="faceted_path_";function vPt(e){const t=Lbe(e.mark,e.encoding),n=uA(e,{fromPrefix:t.length>0?WJ:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:WJ+e.requestDataName(ci),data:e.requestDataName(ci),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}const VJ="stack_group_";function xPt(e){const t=Q3.some(n=>Gt(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[n]=uA(e,{fromPrefix:VJ}),r=e.scaleName(e.stack.fieldChannel),i=(f={})=>e.vgField(e.stack.fieldChannel,f),s=(f,h)=>{const d=[i({prefix:"min",suffix:"start",expr:h}),i({prefix:"max",suffix:"start",expr:h}),i({prefix:"min",suffix:"end",expr:h}),i({prefix:"max",suffix:"end",expr:h})];return`${f}(${d.map(p=>`scale('${r}',${p})`).join(",")})`};let o,a;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},Kx(n.encode.update,["y","yc","y2","height",...Q3])),{x:{signal:s("min","datum")},x2:{signal:s("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},ql(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},Kx(n.encode.update,["x","xc","x2","width"])),{y:{signal:s("min","datum")},y2:{signal:s("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},ql(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const f of Q3){const h=zp(f,e.markDef,e.config);n.encode.update[f]?(o[f]=n.encode.update[f],delete n.encode.update[f]):h&&(o[f]=Vn(h)),h&&(n.encode.update[f]={value:0})}const u=e.fieldDef(e.stack.groupbyChannel),l=_e(u)?[_e(u)]:[];return(u!=null&&u.bin||u!=null&&u.timeUnit)&&l.push(_e(u,{binSuffix:"end"})),o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((f,h)=>{if(n.encode.update[h])return Object.assign(Object.assign({},f),{[h]:n.encode.update[h]});{const d=zp(h,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},f),{[h]:Vn(d)}):f}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(ci),name:VJ+e.requestDataName(ci),groupby:l,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:a},marks:[n]}]}]}else return uA(e)}function wPt(e){const{encoding:t,stack:n,mark:r,markDef:i,config:s}=e,o=t.order;if(!(!Ye(o)&&lc(o)&&OZ(o.value)||!o&&OZ(Gt("order",i,s)))){if((Ye(o)||Te(o))&&!n)return Obe(o,{expr:"datum"});if(Og(r)){const a=i.orient==="horizontal"?"y":"x",u=t[a];if(Te(u)){const l=u.sort;if(Ye(l))return{field:_e(u,{prefix:a,suffix:"sort_index",expr:"datum"})};if(ku(l))return{field:_e({aggregate:NU(e.encoding)?l.op:void 0,field:l.field},{expr:"datum"})};if(ybe(l)){const c=e.fieldDef(l.encoding);return{field:_e(c,{expr:"datum"}),order:l.order}}else return l===null?void 0:{field:_e(u,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}}}function uA(e,t={fromPrefix:""}){const{mark:n,markDef:r,config:i}=e,s=nr(r.clip,CPt(e),SPt(e)),o=Ibe(r),a=e.encoding.key,u=wPt(e),l=_Pt(e),c=Gt("aria",r,i),f=x_[n].postEncodingTransform?x_[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:x_[n].vgMark},s?{clip:!0}:{}),o?{style:o}:{}),a?{key:a.field}:{}),u?{sort:u}:{}),l||{}),c===!1?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(ci)},encode:{update:x_[n].encodeEntry(e)}}),f?{transform:f}:{})]}function CPt(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function SPt(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function _Pt(e){if(!e.component.selection)return null;const t=Se(e.component.selection).length;let n=t,r=e.parent;for(;r&&n===0;)n=Se(r.component.selection).length,r=r.parent;return n?{interactive:t>0}:null}class xxe extends gxe{constructor(t,n,r,i={},s){var o,a;super(t,"unit",n,r,s,void 0,tJ(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const u=ju(t.mark)?t.mark.type:t.mark;this.markDef=YRt(t.mark,(o=t.encoding)!==null&&o!==void 0?o:{},s,{graticule:t.data&&GU(t.data)});const l=this.encoding=rFt((a=t.encoding)!==null&&a!==void 0?a:{},this.markDef,s);this.size=XRt({encoding:l,size:tJ(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i}),this.stack=Qbe(u,l),this.specifiedScales=this.initScales(u,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegend(l),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===_ye,r=t&&NTt.some(i=>it(t[i]));return n||r}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return JF.reduce((r,i)=>{var s;const o=fr(n[i]);return o&&(r[i]=(s=o.scale)!==null&&s!==void 0?s:{}),r},{})}initAxes(t){return Bo.reduce((n,r)=>{const i=t[r];if(it(i)||r===On&&it(t.x2)||r===pr&&it(t.y2)){const s=it(i)?i.axis:void 0;n[r]=s&&Object.assign({},s)}return n},{})}initLegend(t){return UTt.reduce((n,r)=>{const i=fr(t[r]);if(i&&VTt(r)){const s=i.legend;n[r]=s&&Object.assign({},s)}return n},{})}parseData(){this.component.data=AO(this)}parseLayoutSize(){IRt(this)}parseSelections(){this.component.selection=C3t(this,this.selection)}parseMarkGroup(){this.component.mark=bPt(this)}parseAxesAndHeaders(){this.component.axes=zRt(this)}assembleSelectionTopLevelSignals(t){return ZOt(this,t)}assembleSignals(){return[...Mve(this),...YOt(this,[])]}assembleSelectionData(t){return JOt(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return nW(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!$y(this.parent))&&(n=wve(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return ip(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Wu(n)}typedFieldDef(t){const n=this.fieldDef(t);return io(n)?n:null}}class hW extends uW{constructor(t,n,r,i,s){super(t,"layer",n,r,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,u)=>{if(uO(a))return new hW(a,this,this.getName("layer_"+u),o,s);if(Sc(a))return new xxe(a,this,this.getName("layer_"+u),o,s);throw new Error(fU(a))})}parseData(){this.component.data=AO(this);for(const t of this.children)t.parseData()}parseLayoutSize(){TRt(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of Se(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){URt(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),Mve(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),nW(this))}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return QOt(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),Qve(this))}}function dW(e,t,n,r,i){if(rO(e))return new wv(e,t,n,i);if(uO(e))return new hW(e,t,n,r,i);if(Sc(e))return new xxe(e,t,n,r,i);if(_Ft(e))return new RRt(e,t,n,i);throw new Error(fU(e))}function $Pt(e,t={}){t.logger&&WDt(t.logger),t.fieldTitle&&kbe(t.fieldTitle);try{const n=Zbe(hye(t.config,e.config)),r=nve(e,n),i=dW(r,null,"",void 0,n);return i.parse(),GMt(i.component.data,i),{spec:EPt(i,kPt(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&VDt(),t.fieldTitle&&KIt()}}function kPt(e,t,n,r){const i=r.component.layoutSize.get("width"),s=r.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):bt(t)&&(t={type:t}),i&&s&&nOt(t.type)){if(i==="step"&&s==="step")xe(UZ()),t.type="pad";else if(i==="step"||s==="step"){const o=i==="step"?"width":"height";xe(UZ(ZF(o)));const a=o==="width"?"height":"width";t.type=rOt(a)}}return Object.assign(Object.assign(Object.assign({},Se(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),hJ(n)),hJ(e))}function EPt(e,t,n={},r){const i=e.config?RFt(e.config):void 0,s=[].concat(e.assembleSelectionData([]),$Rt(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(f=>(f.name==="width"||f.name==="height")&&f.value!==void 0?(t[f.name]=+f.value,!1):!0),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),a?{title:a}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),i?{config:i}:{}),r?{usermeta:r}:{})}class APt extends Jbe{mapUnit(t,{config:n}){if(t.encoding){const{encoding:r,transform:i}=t,{bins:s,timeUnits:o,aggregate:a,groupby:u,encoding:l}=MU(r,n),c=[...i||[],...s,...o,...a.length===0?[]:[{aggregate:a,groupby:u}]];return Object.assign(Object.assign(Object.assign({},t),c.length>0?{transform:c}:{}),{encoding:l})}else return t}}const TPt=new APt;function DPt(e,t){return TPt.map(e,{config:t})}const IPt=NAt.version,FPt=Object.freeze(Object.defineProperty({__proto__:null,compile:$Pt,extractTransforms:DPt,normalize:nve,version:IPt},Symbol.toStringTag,{value:"Module"}));function wxe(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var OPt="vega-themes",NPt="2.13.0",MPt="Themes for stylized Vega and Vega-Lite visualizations.",RPt=["vega","vega-lite","themes","style"],PPt="BSD-3-Clause",LPt={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},BPt=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],zPt="build/vega-themes.js",jPt="build/vega-themes.module.js",UPt="build/vega-themes.min.js",WPt="build/vega-themes.min.js",VPt="build/vega-themes.module.d.ts",GPt={type:"git",url:"https://github.com/vega/vega-themes.git"},HPt=["src","build"],qPt={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},XPt={"@babel/core":"^7.21.4","@babel/plugin-transform-runtime":"^7.21.4","@babel/preset-env":"^7.21.4","@babel/preset-typescript":"^7.21.4","@release-it/conventional-changelog":"^5.1.1","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-terser":"^0.4.1","@typescript-eslint/eslint-plugin":"^5.59.0","@typescript-eslint/parser":"^5.59.0","browser-sync":"^2.29.1",concurrently:"^8.0.1",eslint:"^8.38.0","eslint-config-prettier":"^8.8.0","eslint-plugin-prettier":"^4.2.1","gh-pages":"^5.0.0",prettier:"^2.8.7","release-it":"^15.10.1",rollup:"^3.20.6","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",typescript:"^5.0.4",vega:"^5.24.0","vega-lite":"^5.7.1"},YPt={vega:"*","vega-lite":"*"},KPt={},ZPt={name:OPt,version:NPt,description:MPt,keywords:RPt,license:PPt,author:LPt,contributors:BPt,main:zPt,module:jPt,unpkg:UPt,jsdelivr:WPt,types:VPt,repository:GPt,files:HPt,scripts:qPt,devDependencies:XPt,peerDependencies:YPt,dependencies:KPt};const nm="#fff",GJ="#888",JPt={background:"#333",view:{stroke:GJ},title:{color:nm,subtitleColor:nm},style:{"guide-label":{fill:nm},"guide-title":{fill:nm}},axis:{domainColor:nm,gridColor:GJ,tickColor:nm}},ed="#4572a7",QPt={background:"#fff",arc:{fill:ed},area:{fill:ed},line:{stroke:ed,strokeWidth:2},path:{stroke:ed},rect:{fill:ed},shape:{stroke:ed},symbol:{fill:ed,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},td="#30a2da",hM="#cbcbcb",eLt="#999",tLt="#333",HJ="#f0f0f0",qJ="#333",nLt={arc:{fill:td},area:{fill:td},axis:{domainColor:hM,grid:!0,gridColor:hM,gridWidth:1,labelColor:eLt,labelFontSize:10,titleColor:tLt,tickColor:hM,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:HJ,group:{fill:HJ},legend:{labelColor:qJ,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:qJ,titleFontSize:14,titlePadding:10},line:{stroke:td,strokeWidth:2},path:{stroke:td,strokeWidth:.5},rect:{fill:td},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:td},bar:{binSpacing:2,fill:td,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},nd="#000",rLt={group:{fill:"#e5e5e5"},arc:{fill:nd},area:{fill:nd},line:{stroke:nd},path:{stroke:nd},rect:{fill:nd},shape:{stroke:nd},symbol:{fill:nd,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},iLt=22,sLt="normal",XJ="Benton Gothic, sans-serif",YJ=11.5,oLt="normal",rd="#82c6df",dM="Benton Gothic Bold, sans-serif",KJ="normal",ZJ=13,cb={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},aLt={background:"#ffffff",title:{anchor:"start",color:"#000000",font:dM,fontSize:iLt,fontWeight:sLt},arc:{fill:rd},area:{fill:rd},line:{stroke:rd,strokeWidth:2},path:{stroke:rd},rect:{fill:rd},shape:{stroke:rd},symbol:{fill:rd,size:30},axis:{labelFont:XJ,labelFontSize:YJ,labelFontWeight:oLt,titleFont:dM,titleFontSize:ZJ,titleFontWeight:KJ},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:XJ,labelFontSize:YJ,symbolType:"square",titleFont:dM,titleFontSize:ZJ,titleFontWeight:KJ},range:{category:cb["category-6"],diverging:cb["fireandice-6"],heatmap:cb["fire-7"],ordinal:cb["fire-7"],ramp:cb["fire-7"]}},id="#ab5787",w_="#979797",uLt={background:"#f9f9f9",arc:{fill:id},area:{fill:id},line:{stroke:id},path:{stroke:id},rect:{fill:id},shape:{stroke:id},symbol:{fill:id,size:30},axis:{domainColor:w_,domainWidth:.5,gridWidth:.2,labelColor:w_,tickColor:w_,tickWidth:.2,titleColor:w_},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},sd="#3e5c69",lLt={background:"#fff",arc:{fill:sd},area:{fill:sd},line:{stroke:sd},path:{stroke:sd},rect:{fill:sd},shape:{stroke:sd},symbol:{fill:sd},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},ho="#1696d2",JJ="#000000",cLt="#FFFFFF",C_="Lato",pM="Lato",fLt="Lato",hLt="#DEDDDD",dLt=18,fb={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},pLt={background:cLt,title:{anchor:"start",fontSize:dLt,font:C_},axisX:{domain:!0,domainColor:JJ,domainWidth:1,grid:!1,labelFontSize:12,labelFont:pM,labelAngle:0,tickColor:JJ,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:C_},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:hLt,gridWidth:1,labelFontSize:12,labelFont:pM,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:C_,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:pM,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:C_,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:fb["six-groups-cat-1"],diverging:fb["diverging-colors"],heatmap:fb["diverging-colors"],ordinal:fb["six-groups-seq"],ramp:fb["shades-blue"]},area:{fill:ho},rect:{fill:ho},line:{color:ho,stroke:ho,strokeWidth:5},trail:{color:ho,stroke:ho,strokeWidth:0,size:1},path:{stroke:ho,strokeWidth:.5},point:{filled:!0},text:{font:fLt,color:ho,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:ho,stroke:null}},arc:{fill:ho},shape:{stroke:ho},symbol:{fill:ho,size:30}},od="#3366CC",QJ="#ccc",S_="Arial, sans-serif",gLt={arc:{fill:od},area:{fill:od},path:{stroke:od},rect:{fill:od},shape:{stroke:od},symbol:{stroke:od},circle:{fill:od},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:S_,fontSize:12},"guide-title":{font:S_,fontSize:12},"group-title":{font:S_,fontSize:12}},title:{font:S_,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:QJ,tickColor:QJ,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},pW=e=>e*(1/3+1),eQ=pW(9),tQ=pW(10),nQ=pW(12),hb="Segoe UI",rQ="wf_standard-font, helvetica, arial, sans-serif",iQ="#252423",db="#605E5C",sQ="transparent",mLt="#C8C6C4",ta="#118DFF",yLt="#12239E",bLt="#E66C37",vLt="#6B007B",xLt="#E044A7",wLt="#744EC2",CLt="#D9B300",SLt="#D64550",Cxe=ta,Sxe="#DEEFFF",oQ=[Sxe,Cxe],_Lt=[Sxe,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",Cxe],$Lt={view:{stroke:sQ},background:sQ,font:hb,header:{titleFont:rQ,titleFontSize:nQ,titleColor:iQ,labelFont:hb,labelFontSize:tQ,labelColor:db},axis:{ticks:!1,grid:!1,domain:!1,labelColor:db,labelFontSize:eQ,titleFont:rQ,titleColor:iQ,titleFontSize:nQ,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:mLt,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:ta},line:{stroke:ta,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:hb,fontSize:eQ,fill:db},arc:{fill:ta},area:{fill:ta,line:!0,opacity:.6},path:{stroke:ta},rect:{fill:ta},point:{fill:ta,filled:!0,size:75},shape:{stroke:ta},symbol:{fill:ta,strokeWidth:1.5,size:50},legend:{titleFont:hb,titleFontWeight:"bold",titleColor:db,labelFont:hb,labelFontSize:tQ,labelColor:db,symbolType:"circle",symbolSize:75},range:{category:[ta,yLt,bLt,vLt,xLt,wLt,CLt,SLt],diverging:oQ,heatmap:oQ,ordinal:_Lt}},kLt=ZPt.version,ELt=Object.freeze(Object.defineProperty({__proto__:null,dark:JPt,excel:QPt,fivethirtyeight:nLt,ggplot2:rLt,googlecharts:gLt,latimes:aLt,powerbi:$Lt,quartz:uLt,urbaninstitute:pLt,version:kLt,vox:lLt},Symbol.toStringTag,{value:"Module"}));var ALt=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const _xe="vg-tooltip-element",TLt={offsetX:10,offsetY:10,id:_xe,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:DLt,maxDepth:2};function DLt(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function ILt(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return ALt.toString().replace(_xe,e)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function FLt(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function OLt(e,t,n){if(ht(e))return`[${e.map(r=>t(wn(r)?r:aQ(r,n))).join(", ")}]`;if(wt(e)){let r="";const i=e,{title:s,image:o}=i,a=FLt(i,["title","image"]);s&&(r+=`<h2>${t(s)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const u=Object.keys(a);if(u.length>0){r+="<table>";for(const l of u){let c=a[l];c!==void 0&&(wt(c)&&(c=aQ(c,n)),r+=`<tr><td class="key">${t(l)}:</td><td class="value">${t(c)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function NLt(e){const t=[];return function(n,r){if(typeof r!="object"||r===null)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}function aQ(e,t){return JSON.stringify(e,NLt(t))}function MLt(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let s=e.clientY+r;return s+t.height>window.innerHeight&&(s=+e.clientY-r-t.height),{x:i,y:s}}class RLt{constructor(t){this.options=Object.assign(Object.assign({},TLt),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const r=document.createElement("style");r.setAttribute("id",this.options.styleId),r.innerHTML=ILt(n);const i=document.head;i.childNodes.length>0?i.insertBefore(r,i.childNodes[0]):i.appendChild(r)}}tooltipHandler(t,n,r,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=OLt(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:o,y:a}=MLt(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${o}px`)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function lA(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(f){o(f)}}function u(c){try{l(r.throw(c))}catch(f){o(f)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(e,t||[])).next())})}function PLt(e,t,n){const r=e.open(t),i=1e4,s=250,{origin:o}=new URL(t);let a=~~(i/s);function u(c){c.source===r&&(a=0,e.removeEventListener("message",u,!1))}e.addEventListener("message",u,!1);function l(){a<=0||(r.postMessage(n,o),setTimeout(l,s),a-=1)}setTimeout(l,s)}var LLt=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper {
    width: 100%;
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function $xe(e,...t){for(const n of t)BLt(e,n);return e}function BLt(e,t){for(const n of Object.keys(t))OD(e,n,t[n],!0)}var gM;const Al=hAt;let N0=FPt;const __=typeof window<"u"?window:void 0;N0===void 0&&(!((gM=__==null?void 0:__.vl)===null||gM===void 0)&&gM.compile)&&(N0=__.vl);const kxe={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},zLt={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Xb={vega:"Vega","vega-lite":"Vega-Lite"},cA={vega:Al.version,"vega-lite":N0?N0.version:"not available"},jLt={vega:e=>e,"vega-lite":(e,t)=>N0.compile(e,{config:t}).spec},ULt=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,WLt="chart-wrapper";function VLt(e){return typeof e=="function"}function uQ(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+s),o.document.title=`${Xb[r]} JSON Source`}function Exe(e,t){var n;if(e.$schema){const r=wxe(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${Xb[r.library]}, but mode argument sets ${(n=Xb[t])!==null&&n!==void 0?n:t}.`);const i=r.library;return dae.satisfies(cA[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${Xb[i]} ${r.version}, but the current version of ${Xb[i]} is v${cA[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function GLt(e){return!!(e&&"load"in e)}function lQ(e){return GLt(e)?e:Al.loader(e)}function cQ(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function HLt(e,t,n={}){var r,i,s;return lA(this,void 0,void 0,function*(){let o,a;wn(t)?(a=lQ(n.loader),o=JSON.parse(yield a.load(t))):o=t;const u=cQ(o).loader;(!a||u)&&(a=lQ((r=n.loader)!==null&&r!==void 0?r:u));const l=yield fQ(cQ(o),a),c=yield fQ(n,a),f=Object.assign(Object.assign({},$xe(c,l)),{config:FD((i=c.config)!==null&&i!==void 0?i:{},(s=l.config)!==null&&s!==void 0?s:{})});return yield XLt(e,o,f,a)})}function fQ(e,t){var n;return lA(this,void 0,void 0,function*(){const r=wn(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},i=wn(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})})}function qLt(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:(t=document.head)!==null&&t!==void 0?t:document.body}}function XLt(e,t,n={},r){var i,s,o,a,u,l;return lA(this,void 0,void 0,function*(){const c=n.theme?FD(ELt[n.theme],(i=n.config)!==null&&i!==void 0?i:{}):n.config,f=Dae(n.actions)?n.actions:$xe({},kxe,(s=n.actions)!==null&&s!==void 0?s:{}),h=Object.assign(Object.assign({},zLt),n.i18n),d=(o=n.renderer)!==null&&o!==void 0?o:"canvas",p=(a=n.logLevel)!==null&&a!==void 0?a:Al.Warn,m=(u=n.downloadFileName)!==null&&u!==void 0?u:"visualization",g=typeof e=="string"?document.querySelector(e):e;if(!g)throw new Error(`${e} does not exist`);if(n.defaultStyle!==!1){const E="vega-embed-style",{root:F,rootContainer:T}=qLt(g);if(!F.getElementById(E)){const I=document.createElement("style");I.id=E,I.innerText=n.defaultStyle===void 0||n.defaultStyle===!0?LLt.toString():n.defaultStyle,T.appendChild(I)}}const y=Exe(t,n.mode);let b=jLt[y](t,c);if(y==="vega-lite"&&b.$schema){const E=wxe(b.$schema);dae.satisfies(cA.vega,`^${E.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${E.version}, but current version is v${cA.vega}.`)}g.classList.add("vega-embed"),f&&g.classList.add("has-actions"),g.innerHTML="";let x=g;if(f){const E=document.createElement("div");E.classList.add(WLt),g.appendChild(E),x=E}const v=n.patch;v&&(v instanceof Function?b=v(b):b=$D(b,v,!0,!1).newDocument),n.formatLocale&&Al.formatLocale(n.formatLocale),n.timeFormatLocale&&Al.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,C=Al.parse(b,y==="vega-lite"?{}:c,{ast:w}),S=new(n.viewClass||Al.View)(C,Object.assign({loader:r,logLevel:p,renderer:d},w?{expr:Al.expressionInterpreter}:{}));if(n.tooltip!==!1){let E;VLt(n.tooltip)?E=n.tooltip:E=new RLt(n.tooltip===!0?{}:n.tooltip).call,S.tooltip(E)}let{hover:_}=n;if(_===void 0&&(_=y==="vega"),_){const{hoverSet:E,updateSet:F}=typeof _=="boolean"?{}:_;S.hover(E,F)}n&&(n.width!=null&&S.width(n.width),n.height!=null&&S.height(n.height),n.padding!=null&&S.padding(n.padding)),yield S.initialize(x,n.bind).runAsync();let $;if(f!==!1){let E=g;if(n.defaultStyle!==!1){const T=document.createElement("details");T.title=h.CLICK_TO_VIEW_ACTIONS,g.append(T),E=T;const I=document.createElement("summary");I.innerHTML=ULt,T.append(I),$=D=>{T.contains(D.target)||T.removeAttribute("open")},document.addEventListener("click",$)}const F=document.createElement("div");if(E.append(F),F.classList.add("vega-actions"),f===!0||f.export!==!1){for(const T of["svg","png"])if(f===!0||f.export===!0||f.export[T]){const I=h[`${T.toUpperCase()}_ACTION`],D=document.createElement("a");D.text=I,D.href="#",D.target="_blank",D.download=`${m}.${T}`,D.addEventListener("mousedown",function(N){return lA(this,void 0,void 0,function*(){N.preventDefault();const V=yield S.toImageURL(T,n.scaleFactor);this.href=V})}),F.append(D)}}if(f===!0||f.source!==!1){const T=document.createElement("a");T.text=h.SOURCE_ACTION,T.href="#",T.addEventListener("click",function(I){var D,N;uQ(oN(t),(D=n.sourceHeader)!==null&&D!==void 0?D:"",(N=n.sourceFooter)!==null&&N!==void 0?N:"",y),I.preventDefault()}),F.append(T)}if(y==="vega-lite"&&(f===!0||f.compiled!==!1)){const T=document.createElement("a");T.text=h.COMPILED_ACTION,T.href="#",T.addEventListener("click",function(I){var D,N;uQ(oN(b),(D=n.sourceHeader)!==null&&D!==void 0?D:"",(N=n.sourceFooter)!==null&&N!==void 0?N:"","vega"),I.preventDefault()}),F.append(T)}if(f===!0||f.editor!==!1){const T=(l=n.editorUrl)!==null&&l!==void 0?l:"https://vega.github.io/editor/",I=document.createElement("a");I.text=h.EDITOR_ACTION,I.href="#",I.addEventListener("click",function(D){PLt(window,T,{config:c,mode:y,renderer:d,spec:oN(t)}),D.preventDefault()}),F.append(I)}}function k(){$&&document.removeEventListener("click",$),S.finalize()}return{view:S,spec:t,vgSpec:b,finalize:k}})}const YLt=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_ACTIONS:kxe,default:HLt,guessMode:Exe,vega:Al,get vegaLite(){return N0}},Symbol.toStringTag,{value:"Module"})),ky=Kp(YLt);var Xo={},we={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var hQ=Object.getOwnPropertySymbols,KLt=Object.prototype.hasOwnProperty,ZLt=Object.prototype.propertyIsEnumerable;function JLt(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function QLt(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(s){return t[s]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(s){i[s]=s}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var gW=QLt()?Object.assign:function(e,t){for(var n,r=JLt(e),i,s=1;s<arguments.length;s++){n=Object(arguments[s]);for(var o in n)KLt.call(n,o)&&(r[o]=n[o]);if(hQ){i=hQ(n);for(var a=0;a<i.length;a++)ZLt.call(n,i[a])&&(r[i[a]]=n[i[a]])}}return r},mW={};Object.defineProperty(mW,"__esModule",{value:!0});mW.StyleSheet=Axe;var e4t=gW,t4t=n4t(e4t);function n4t(e){return e&&e.__esModule?e:{default:e}}function r4t(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}else return Array.from(e)}function mM(e){return e[e.length-1]}function dQ(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}var Td=typeof window<"u",i4t=!1,s4t=function(){if(Td){var e=document.createElement("div");return e.innerHTML="<!--[if lt IE 10]><i></i><![endif]-->",e.getElementsByTagName("i").length===1}}();function pQ(){var e=document.createElement("style");return e.type="text/css",e.setAttribute("data-glamor",""),e.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}function Axe(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.speedy,n=t===void 0?!i4t:t,r=e.maxLength,i=r===void 0?Td&&s4t?4e3:65e3:r;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=i,this.ctr=0}(0,t4t.default)(Axe.prototype,{getSheet:function(){return dQ(mM(this.tags))},inject:function(){var t=this;if(this.injected)throw new Error("already injected stylesheet!");Td?this.tags[0]=pQ():this.sheet={cssRules:[],insertRule:function(r){t.sheet.cssRules.push({cssText:r})}},this.injected=!0},speedy:function(t){if(this.ctr!==0)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+t+") earlier in your app, or call flush() before speedy("+t+")");this.isSpeedy=!!t},_insert:function(t){try{var n=this.getSheet();n.insertRule(t,t.indexOf("@import")!==-1?0:n.cssRules.length)}catch{}},insert:function(t){if(Td)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(t);else if(t.indexOf("@import")!==-1){var n=mM(this.tags);n.insertBefore(document.createTextNode(t),n.firstChild)}else mM(this.tags).appendChild(document.createTextNode(t));else this.sheet.insertRule(t,t.indexOf("@import")!==-1?0:this.sheet.cssRules.length);return this.ctr++,Td&&this.ctr%this.maxLength===0&&this.tags.push(pQ()),this.ctr-1},delete:function(t){return this.replace(t,"")},flush:function(){Td?(this.tags.forEach(function(t){return t.parentNode.removeChild(t)}),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!Td)return this.sheet.cssRules;var t=[];return this.tags.forEach(function(n){return t.splice.apply(t,[t.length,0].concat(r4t(Array.from(dQ(n).cssRules))))}),t}});var Ey={},o4t=/-(.)/g;function a4t(e){return e.replace(o4t,function(t,n){return n.toUpperCase()})}var u4t=a4t,l4t=u4t,c4t=/^-ms-/;function f4t(e){return l4t(e.replace(c4t,"ms-"))}var h4t=f4t,yW={},bW={};Object.defineProperty(bW,"__esModule",{value:!0});var p$={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function d4t(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var p4t=["Webkit","ms","Moz","O"];Object.keys(p$).forEach(function(e){p4t.forEach(function(t){p$[d4t(t,e)]=p$[e]})});var g4t={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},m4t={isUnitlessNumber:p$,shorthandPropertyExpansions:g4t};bW.default=m4t;function TO(e){return function(){return e}}var zg=function(){};zg.thatReturns=TO;zg.thatReturnsFalse=TO(!1);zg.thatReturnsTrue=TO(!0);zg.thatReturnsNull=TO(null);zg.thatReturnsThis=function(){return this};zg.thatReturnsArgument=function(e){return e};var y4t=zg,b4t=y4t,v4t=b4t,Txe=v4t;Object.defineProperty(yW,"__esModule",{value:!0});var x4t=bW,w4t=Dxe(x4t),C4t=Txe;Dxe(C4t);function Dxe(e){return e&&e.__esModule?e:{default:e}}var gQ=w4t.default.isUnitlessNumber;function S4t(e,t,n){var r=t==null||typeof t=="boolean"||t==="";if(r)return"";var i=isNaN(t);return i||t===0||gQ.hasOwnProperty(e)&&gQ[e]?""+t:(typeof t=="string"&&(t=t.trim()),t+"px")}yW.default=S4t;var _4t=/([A-Z])/g;function $4t(e){return e.replace(_4t,"-$1").toLowerCase()}var k4t=$4t,E4t=k4t,A4t=/^ms-/;function T4t(e){return E4t(e).replace(A4t,"-ms-")}var D4t=T4t;function I4t(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}var F4t=I4t;Object.defineProperty(Ey,"__esModule",{value:!0});Ey.processStyleName=void 0;Ey.createMarkupForStyles=U4t;var O4t=h4t;nS(O4t);var N4t=yW,M4t=nS(N4t),R4t=D4t,P4t=nS(R4t),L4t=F4t,B4t=nS(L4t),z4t=Txe;nS(z4t);function nS(e){return e&&e.__esModule?e:{default:e}}var j4t=Ey.processStyleName=(0,B4t.default)(P4t.default);function U4t(e,t){var n="";for(var r in e){var i=r.indexOf("--")===0;if(e.hasOwnProperty(r)&&r!=="label"){var s=e[r];s!=null&&(i?n+=r+":"+s+";":(n+=j4t(r)+":",n+=(0,M4t.default)(r,s,t)+";"))}}return n||null}var vW={};Object.defineProperty(vW,"__esModule",{value:!0});var Ixe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};vW.default=xW;function W4t(e){return e==null||e===!1||(typeof e>"u"?"undefined":Ixe(e))==="object"&&Object.keys(e).length===0}function V4t(e){if(W4t(e))return null;if((typeof e>"u"?"undefined":Ixe(e))!=="object")return e;for(var t={},n=Object.keys(e),r=!1,i=0;i<n.length;i++){var s=e[n[i]],o=xW(s);(o===null||o!==s)&&(r=!0),o!==null&&(t[n[i]]=o)}return Object.keys(t).length===0?null:r?t:e}function G4t(e){var t=!1,n=[];return e.forEach(function(r){var i=xW(r);(i===null||i!==r)&&(t=!0),i!==null&&n.push(i)}),n.length==0?null:t?n:e}function xW(e){return Array.isArray(e)?G4t(e):V4t(e)}var Ay={},wW={},l4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=["Webkit"],r=["Moz"],i=["ms"],s=["Webkit","Moz"],o=["Webkit","ms"],a=["Webkit","Moz","ms"];t.default={plugins:[],prefixMap:{appearance:s,userSelect:a,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:a,breakBefore:a,breakInside:a,columnCount:s,columnFill:s,columnGap:s,columnRule:s,columnRuleColor:s,columnRuleStyle:s,columnRuleWidth:s,columns:s,columnSpan:s,columnWidth:s,writingMode:o,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:o,scrollSnapPointsX:o,scrollSnapPointsY:o,scrollSnapDestination:o,scrollSnapCoordinate:o,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:a,flowInto:o,flowFrom:o,regionFragment:o,textAlignLast:r,tabSize:r,wrapFlow:i,wrapThrough:i,wrapMargin:i,gridTemplateColumns:i,gridTemplateRows:i,gridTemplateAreas:i,gridTemplate:i,gridAutoColumns:i,gridAutoRows:i,gridAutoFlow:i,grid:i,gridRowStart:i,gridColumnStart:i,gridRowEnd:i,gridRow:i,gridColumn:i,gridColumnEnd:i,gridColumnGap:i,gridRowGap:i,gridArea:i,gridGap:i,textSizeAdjust:o,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},e.exports=t.default})(l4,l4.exports);var H4t=l4.exports,c4={exports:{}},f4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r){return r.charAt(0).toUpperCase()+r.slice(1)}e.exports=t.default})(f4,f4.exports);var Fxe=f4.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=Fxe,r=i(n);function i(o){return o&&o.__esModule?o:{default:o}}function s(o,a,u){if(o.hasOwnProperty(a))for(var l=o[a],c=0,f=l.length;c<f;++c)u[l[c]+(0,r.default)(a)]=u[a]}e.exports=t.default})(c4,c4.exports);var q4t=c4.exports,h4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r,i,s,o,a){for(var u=0,l=r.length;u<l;++u){var c=r[u](i,s,o,a);if(c)return c}}e.exports=t.default})(h4,h4.exports);var X4t=h4.exports,d4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n=["-webkit-","-moz-",""],r={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};function i(s,o){if(s==="cursor"&&r.hasOwnProperty(o))return n.map(function(a){return a+o})}e.exports=t.default})(d4,d4.exports);var Y4t=d4.exports,p4={exports:{}},g4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var n=/-webkit-|-moz-|-ms-/;function r(i){return typeof i=="string"&&n.test(i)}e.exports=t.default})(g4,g4.exports);var rS=g4.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=rS,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("cross-fade(")>-1)return s.map(function(l){return u.replace(/cross-fade\(/g,l+"cross-fade(")})}e.exports=t.default})(p4,p4.exports);var K4t=p4.exports,m4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=rS,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("filter(")>-1)return s.map(function(l){return u.replace(/filter\(/g,l+"filter(")})}e.exports=t.default})(m4,m4.exports);var Z4t=m4.exports,y4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};function r(i,s){if(i==="display"&&n.hasOwnProperty(s))return n[s]}e.exports=t.default})(y4,y4.exports);var J4t=y4.exports,b4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},r={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};function i(s,o,a){s==="flexDirection"&&typeof o=="string"&&(o.indexOf("column")>-1?a.WebkitBoxOrient="vertical":a.WebkitBoxOrient="horizontal",o.indexOf("reverse")>-1?a.WebkitBoxDirection="reverse":a.WebkitBoxDirection="normal"),r.hasOwnProperty(s)&&(a[r[s]]=n[o]||o)}e.exports=t.default})(b4,b4.exports);var Q4t=b4.exports,v4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var n=rS,r=i(n);function i(u){return u&&u.__esModule?u:{default:u}}var s=["-webkit-","-moz-",""],o=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;function a(u,l){if(typeof l=="string"&&!(0,r.default)(l)&&o.test(l))return s.map(function(c){return c+l})}e.exports=t.default})(v4,v4.exports);var eBt=v4.exports,x4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=rS,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("image-set(")>-1)return s.map(function(l){return u.replace(/image-set\(/g,l+"image-set(")})}e.exports=t.default})(x4,x4.exports);var tBt=x4.exports,w4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r,i){if(r==="position"&&i==="sticky")return["-webkit-sticky","sticky"]}e.exports=t.default})(w4,w4.exports);var nBt=w4.exports,C4={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=["-webkit-","-moz-",""],r={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},i={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};function s(o,a){if(r.hasOwnProperty(o)&&i.hasOwnProperty(a))return n.map(function(u){return u+a})}e.exports=t.default})(C4,C4.exports);var rBt=C4.exports,S4={exports:{}},_4={exports:{}},iBt=/[A-Z]/g,sBt=/^ms-/,yM={};function oBt(e){return"-"+e.toLowerCase()}function aBt(e){if(yM.hasOwnProperty(e))return yM[e];var t=e.replace(iBt,oBt);return yM[e]=sBt.test(t)?"-"+t:t}const uBt=Object.freeze(Object.defineProperty({__proto__:null,default:aBt},Symbol.toStringTag,{value:"Module"})),lBt=Kp(uBt);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=lBt,r=i(n);function i(o){return o&&o.__esModule?o:{default:o}}function s(o){return(0,r.default)(o)}e.exports=t.default})(_4,_4.exports);var cBt=_4.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=h;var n=cBt,r=u(n),i=rS,s=u(i),o=Fxe,a=u(o);function u(d){return d&&d.__esModule?d:{default:d}}var l={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},c={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};function f(d,p){if((0,s.default)(d))return d;for(var m=d.split(/,(?![^()]*(?:\([^()]*\))?\))/g),g=0,y=m.length;g<y;++g){var b=m[g],x=[b];for(var v in p){var w=(0,r.default)(v);if(b.indexOf(w)>-1&&w!=="order")for(var C=p[v],S=0,_=C.length;S<_;++S)x.unshift(b.replace(w,c[C[S]]+w))}m[g]=x.join(",")}return m.join(",")}function h(d,p,m,g){if(typeof p=="string"&&l.hasOwnProperty(d)){var y=f(p,g),b=y.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(v){return!/-moz-|-ms-/.test(v)}).join(",");if(d.indexOf("Webkit")>-1)return b;var x=y.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(v){return!/-webkit-|-ms-/.test(v)}).join(",");return d.indexOf("Moz")>-1?x:(m["Webkit"+(0,a.default)(d)]=b,m["Moz"+(0,a.default)(d)]=x,y)}}e.exports=t.default})(S4,S4.exports);var fBt=S4.exports;Object.defineProperty(wW,"__esModule",{value:!0});wW.default=BBt;var hBt=H4t,dBt=oo(hBt),pBt=q4t,gBt=oo(pBt),mBt=X4t,yBt=oo(mBt),bBt=Y4t,vBt=oo(bBt),xBt=K4t,wBt=oo(xBt),CBt=Z4t,SBt=oo(CBt),_Bt=J4t,$Bt=oo(_Bt),kBt=Q4t,EBt=oo(kBt),ABt=eBt,TBt=oo(ABt),DBt=tBt,IBt=oo(DBt),FBt=nBt,OBt=oo(FBt),NBt=rBt,MBt=oo(NBt),RBt=fBt,PBt=oo(RBt);function oo(e){return e&&e.__esModule?e:{default:e}}var LBt=[wBt.default,vBt.default,SBt.default,EBt.default,TBt.default,IBt.default,OBt.default,MBt.default,PBt.default,$Bt.default],mQ=dBt.default.prefixMap;function BBt(e){for(var t in e){var n=e[t],r=(0,yBt.default)(LBt,t,n,e,mQ);r&&(e[t]=r),(0,gBt.default)(mQ,t,e)}return e}Object.defineProperty(Ay,"__esModule",{value:!0});var $4=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};Ay.PluginSet=Nxe;Ay.fallbacks=GBt;Ay.contentWrap=qBt;Ay.prefixes=XBt;var zBt=gW,CW=Oxe(zBt),jBt=Ey,UBt=wW,WBt=Oxe(UBt);function Oxe(e){return e&&e.__esModule?e:{default:e}}var VBt=function(e){return e==="development"||!e}("production");function Nxe(e){this.fns=e||[]}(0,CW.default)(Nxe.prototype,{add:function(){for(var t=this,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach(function(s){t.fns.indexOf(s)>=0?VBt&&console.warn("adding the same plugin again, ignoring"):t.fns=[s].concat(t.fns)})},remove:function(t){this.fns=this.fns.filter(function(n){return n!==t})},clear:function(){this.fns=[]},transform:function(t){return this.fns.reduce(function(n,r){return r(n)},t)}});function GBt(e){var t=Object.keys(e.style).map(function(i){return Array.isArray(e.style[i])}).indexOf(!0)>=0;if(t){var n=e.style,r=Object.keys(n).reduce(function(i,s){return i[s]=Array.isArray(n[s])?n[s].join("; "+(0,jBt.processStyleName)(s)+": "):n[s],i},{});return(0,CW.default)({},e,{style:r})}return e}var HBt=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"];function qBt(e){if(e.style.content){var t=e.style.content;return HBt.indexOf(t)>=0||/^(attr|calc|counters?|url)\(/.test(t)||t.charAt(0)===t.charAt(t.length-1)&&(t.charAt(0)==='"'||t.charAt(0)==="'")?e:$4({},e,{style:$4({},e.style,{content:'"'+t+'"'})})}return e}function XBt(e){return(0,CW.default)({},e,{style:(0,WBt.default)($4({},e.style))})}var SW={};Object.defineProperty(SW,"__esModule",{value:!0});SW.default=YBt;function YBt(e,t){for(var n=1540483477,r=24,i=t^e.length,s=e.length,o=0;s>=4;){var a=KBt(e,o);a=ad(a,n),a^=a>>>r,a=ad(a,n),i=ad(i,n),i^=a,o+=4,s-=4}switch(s){case 3:i^=yQ(e,o),i^=e.charCodeAt(o+2)<<16,i=ad(i,n);break;case 2:i^=yQ(e,o),i=ad(i,n);break;case 1:i^=e.charCodeAt(o),i=ad(i,n);break}return i^=i>>>13,i=ad(i,n),i^=i>>>15,i>>>0}function KBt(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)+(e.charCodeAt(t++)<<16)+(e.charCodeAt(t)<<24)}function yQ(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)}function ad(e,t){e=e|0,t=t|0;var n=e&65535,r=e>>>16,i=n*t+((r*t&65535)<<16)|0;return i}Object.defineProperty(we,"__esModule",{value:!0});we.compose=we.merge=we.$=we.style=we.presets=we.keyframes=we.fontFace=we.insertGlobal=we.insertRule=we.plugins=we.styleSheet=void 0;we.speedy=r5t;we.simulations=i5t;we.simulate=s5t;we.cssLabels=o5t;we.isLikeRule=AW;we.idFor=TW;we.css=Or;we.rehydrate=x5t;we.flush=w5t;we.select=DW;we.parent=S5t;we.media=_5t;we.pseudo=nt;we.active=$5t;we.any=k5t;we.checked=E5t;we.disabled=A5t;we.empty=T5t;we.enabled=D5t;we._default=I5t;we.first=F5t;we.firstChild=O5t;we.firstOfType=N5t;we.fullscreen=M5t;we.focus=R5t;we.hover=P5t;we.indeterminate=L5t;we.inRange=B5t;we.invalid=z5t;we.lastChild=j5t;we.lastOfType=U5t;we.left=W5t;we.link=V5t;we.onlyChild=G5t;we.onlyOfType=H5t;we.optional=q5t;we.outOfRange=X5t;we.readOnly=Y5t;we.readWrite=K5t;we.required=Z5t;we.right=J5t;we.root=Q5t;we.scope=ezt;we.target=tzt;we.valid=nzt;we.visited=rzt;we.dir=izt;we.lang=szt;we.not=ozt;we.nthChild=azt;we.nthLastChild=uzt;we.nthLastOfType=lzt;we.nthOfType=czt;we.after=fzt;we.before=hzt;we.firstLetter=dzt;we.firstLine=pzt;we.selection=gzt;we.backdrop=mzt;we.placeholder=yzt;we.cssFor=bzt;we.attribsFor=vzt;var ZBt=gW,JBt=$W(ZBt),QBt=mW,_W=Ey,e5t=vW,Gh=$W(e5t),Vl=Ay,t5t=SW,n5t=$W(t5t);function $W(e){return e&&e.__esModule?e:{default:e}}function iS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xs=we.styleSheet=new QBt.StyleSheet;Xs.inject();function r5t(e){return Xs.speedy(e)}var sS=we.plugins=Xs.plugins=new Vl.PluginSet([Vl.prefixes,Vl.contentWrap,Vl.fallbacks]);sS.media=new Vl.PluginSet;sS.fontFace=new Vl.PluginSet;sS.keyframes=new Vl.PluginSet([Vl.prefixes,Vl.fallbacks]);var kW=!1,DO=typeof window<"u",EW=kW,bQ=!1,vQ=!1;function i5t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;EW=!!e}function s5t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t=(0,Gh.default)(t),t?EW?t.reduce(function(r,i){return r["data-simulate-"+fA(i)]="",r},{}):(bQ||(console.warn("can't simulate without once calling simulations(true)"),bQ=!0),vQ||(console.warn("don't use simulation outside dev"),vQ=!0),{}):{}}var oS=kW;function o5t(e){oS=!!e}function fA(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return e.toLowerCase().replace(/[^a-z0-9]/g,t)}function aS(e){var t=JSON.stringify(e),n=(0,n5t.default)(t).toString(36);return e.label&&e.label.length>0&&kW?fA(e.label.join("."),"-")+"-"+n:n}function AW(e){var t=Object.keys(e).filter(function(n){return n!=="toString"});return t.length!==1?!1:!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0])}function TW(e){var t=Object.keys(e).filter(function(i){return i!=="toString"});if(t.length!==1)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/,r=n.exec(t[0]);if(!r)throw new Error("not a rule");return r[1]}var a5t=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function k4(e){if(e.indexOf(",")===-1)return[e];for(var t=[],n=[],r=0,i;i=a5t.exec(e);)switch(i[0]){case"(":r++;break;case")":r--;break;case",":if(r)break;t.push(i.index)}for(i=t.length;i--;)n.unshift(e.slice(t[i]+1)),e=e.slice(0,t[i]);return n.unshift(e),n}function xQ(e,t){if(!e)return t.replace(/\&/g,"");if(!t)return".css-"+e+",[data-css-"+e+"]";var n=k4(t).map(function(r){return r.indexOf("&")>=0?[r.replace(/\&/mg,".css-"+e),r.replace(/\&/mg,"[data-css-"+e+"]")].join(","):".css-"+e+r+",[data-css-"+e+"]"+r}).join(",");return EW&&/^\&\:/.exec(t)&&!/\s/.exec(t)&&(n+=",.css-"+e+"[data-simulate-"+fA(t)+"],[data-css-"+e+"][data-simulate-"+fA(t)+"]"),n}function E4(e){var t=e.selector,n=e.style,r=sS.transform({selector:t,style:n});return r.selector+"{"+(0,_W.createMarkupForStyles)(r.style)+"}"}function hA(e){var t=void 0,n=void 0,r=void 0,i=void 0;return Object.keys(e).forEach(function(s){s.indexOf("&")>=0?(n=n||{},n[s]=e[s]):s.indexOf("@media")===0?(r=r||{},r[s]=hA(e[s])):s.indexOf("@supports")===0?(i=i||{},i[s]=hA(e[s])):s==="label"?e.label.length>0&&(t=t||{},t.label=oS?e.label.join("."):""):(t=t||{},t[s]=e[s])}),{plain:t,selects:n,medias:r,supports:i}}function dA(e,t){var n=[],r=t.plain,i=t.selects,s=t.medias,o=t.supports;return r&&n.push(E4({style:r,selector:xQ(e)})),i&&Object.keys(i).forEach(function(a){return n.push(E4({style:i[a],selector:xQ(e,a)}))}),s&&Object.keys(s).forEach(function(a){return n.push(a+"{"+dA(e,s[a]).join("")+"}")}),o&&Object.keys(o).forEach(function(a){return n.push(a+"{"+dA(e,o[a]).join("")+"}")}),n}var $a=Xs.inserted={};function u5t(e){if(!$a[e.id]){$a[e.id]=!0;var t=hA(e.style),n=dA(e.id,t);$a[e.id]=DO?!0:n,n.forEach(function(r){return Xs.insert(r)})}}var l2=Xs.registered={};function IO(e){l2[e.id]||(l2[e.id]=e)}function l5t(e){if(AW(e)){var t=l2[TW(e)];if(t==null)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return t}return e}var g$={};function c5t(e){if(IO(e),u5t(e),g$[e.id])return g$[e.id];var t=iS({},"data-css-"+e.id,oS&&e.label||"");return Object.defineProperty(t,"toString",{enumerable:!1,value:function(){return"css-"+e.id}}),g$[e.id]=t,t}function f5t(e){for(var t=[":",".","[",">"," "],n=!1,r=e.charAt(0),i=0;i<t.length;i++)if(r===t[i]){n=!0;break}return n||e.indexOf("&")>=0}function wQ(e,t){var n=k4(e).map(function(i){return i.indexOf("&")>=0?i:"&"+i}),r=k4(t).map(function(i){return i.indexOf("&")>=0?i:"&"+i});return r.reduce(function(i,s){return i.concat(n.map(function(o){return s.replace(/\&/g,o)}))},[]).join(",")}function h5t(e,t){return e?"@media "+e.substring(6)+" and "+t.substring(6):t}function d5t(e){return e.indexOf("@media")===0}function p5t(e){return e.indexOf("@supports")===0}function g5t(e,t){return e?"@supports "+e.substring(9)+" and "+t.substring(9):t}function Mxe(e){for(var t=[],n=0;n<e.length;n++)Array.isArray(e[n])?t=t.concat(Mxe(e[n])):t=t.concat(e[n]);return t}var CQ={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function Dd(e,t){var n=t.selector,r=n===void 0?"":n,i=t.mq,s=i===void 0?"":i,o=t.supp,a=o===void 0?"":o,u=t.src,l=u===void 0?{}:u;Array.isArray(l)||(l=[l]),l=Mxe(l),l.forEach(function(c){if(AW(c)){var f=l5t(c);if(f.type!=="css")throw new Error("cannot merge this rule");c=f.style}c=(0,Gh.default)(c),c&&c.composes&&Dd(e,{selector:r,mq:s,supp:a,src:c.composes}),Object.keys(c||{}).forEach(function(h){if(f5t(h))CQ[h]&&CQ[h].forEach(function(p){return Dd(e,{selector:wQ(r,p),mq:s,supp:a,src:c[h]})}),Dd(e,{selector:wQ(r,h),mq:s,supp:a,src:c[h]});else if(d5t(h))Dd(e,{selector:r,mq:h5t(s,h),supp:a,src:c[h]});else if(p5t(h))Dd(e,{selector:r,mq:s,supp:g5t(a,h),src:c[h]});else if(h!=="composes"){var d=e;a&&(d[a]=d[a]||{},d=d[a]),s&&(d[s]=d[s]||{},d=d[s]),r&&(d[r]=d[r]||{},d=d[r]),h==="label"?oS&&(e.label=e.label.concat(c.label)):d[h]=c[h]}})})}function SQ(e){var t={label:[]};Dd(t,{src:e});var n={id:aS(t),style:t,label:oS?t.label.join("."):"",type:"css"};return c5t(n)}var pA={};Object.defineProperty(pA,"toString",{enumerable:!1,value:function(){return"css-nil"}});var $_=typeof WeakMap<"u"?[pA,new WeakMap,new WeakMap,new WeakMap]:[pA];function m5t(e){return function(t){if($_[t.length]){for(var n=$_[t.length],r=0;r<t.length-1;)n.has(t[r])||n.set(t[r],new WeakMap),n=n.get(t[r]),r++;if(n.has(t[t.length-1])){var i=n.get(t[r]);if(l2[i.toString().substring(4)])return i}}var s=e(t);if($_[t.length]){for(var o=0,a=$_[t.length];o<t.length-1;)a=a.get(t[o]),o++;try{a.set(t[o],s)}catch{}}return s}}var y5t=typeof WeakMap<"u"?m5t(SQ):SQ;function Or(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0]&&t[0].length&&t[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return t=(0,Gh.default)(t),t?y5t(t):pA}Or.insert=function(e){var t={id:aS(e),css:e,type:"raw"};IO(t),$a[t.id]||(Xs.insert(t.css),$a[t.id]=DO?!0:[t.css])};we.insertRule=Or.insert;Or.global=function(e,t){if(t=(0,Gh.default)(t),t)return Or.insert(E4({selector:e,style:t}))};we.insertGlobal=Or.global;function b5t(e){if(!$a[e.id]){var t=Object.keys(e.keyframes).map(function(r){var i=sS.keyframes.transform({id:e.id,name:r,style:e.keyframes[r]});return i.name+"{"+(0,_W.createMarkupForStyles)(i.style)+"}"}).join(""),n=["-webkit-","-moz-","-o-",""].map(function(r){return"@"+r+"keyframes "+(e.name+"_"+e.id)+"{"+t+"}"});n.forEach(function(r){return Xs.insert(r)}),$a[e.id]=DO?!0:n}}Or.keyframes=function(e,t){t||(t=e,e="animation"),t=(0,Gh.default)(t)||{};var n={id:aS({name:e,kfs:t}),type:"keyframes",name:e,keyframes:t};return IO(n),b5t(n),e+"_"+n.id};Or.fontFace=function(e){e=(0,Gh.default)(e);var t={id:aS(e),type:"font-face",font:e};return IO(t),v5t(t),e.fontFamily};we.fontFace=Or.fontFace;we.keyframes=Or.keyframes;function v5t(e){if(!$a[e.id]){var t="@font-face{"+(0,_W.createMarkupForStyles)(e.font)+"}";Xs.insert(t),$a[e.id]=DO?!0:[t]}}function x5t(e){(0,JBt.default)($a,e.reduce(function(t,n){return t[n]=!0,t},{}))}function w5t(){$a=Xs.inserted={},l2=Xs.registered={},g$={},Xs.flush(),Xs.inject()}we.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var C5t=we.style=Or;function DW(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e?Or(iS({},e,n)):C5t(n)}we.$=DW;function S5t(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Or(iS({},e+" &",n))}we.merge=Or;we.compose=Or;function _5t(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Or(iS({},"@media "+e,n))}function nt(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Or(iS({},e,n))}function $5t(e){return nt(":active",e)}function k5t(e){return nt(":any",e)}function E5t(e){return nt(":checked",e)}function A5t(e){return nt(":disabled",e)}function T5t(e){return nt(":empty",e)}function D5t(e){return nt(":enabled",e)}function I5t(e){return nt(":default",e)}function F5t(e){return nt(":first",e)}function O5t(e){return nt(":first-child",e)}function N5t(e){return nt(":first-of-type",e)}function M5t(e){return nt(":fullscreen",e)}function R5t(e){return nt(":focus",e)}function P5t(e){return nt(":hover",e)}function L5t(e){return nt(":indeterminate",e)}function B5t(e){return nt(":in-range",e)}function z5t(e){return nt(":invalid",e)}function j5t(e){return nt(":last-child",e)}function U5t(e){return nt(":last-of-type",e)}function W5t(e){return nt(":left",e)}function V5t(e){return nt(":link",e)}function G5t(e){return nt(":only-child",e)}function H5t(e){return nt(":only-of-type",e)}function q5t(e){return nt(":optional",e)}function X5t(e){return nt(":out-of-range",e)}function Y5t(e){return nt(":read-only",e)}function K5t(e){return nt(":read-write",e)}function Z5t(e){return nt(":required",e)}function J5t(e){return nt(":right",e)}function Q5t(e){return nt(":root",e)}function ezt(e){return nt(":scope",e)}function tzt(e){return nt(":target",e)}function nzt(e){return nt(":valid",e)}function rzt(e){return nt(":visited",e)}function izt(e,t){return nt(":dir("+e+")",t)}function szt(e,t){return nt(":lang("+e+")",t)}function ozt(e,t){var n=e.split(",").map(function(r){return r.trim()}).map(function(r){return":not("+r+")"});return n.length===1?nt(":not("+e+")",t):DW(n.join(""),t)}function azt(e,t){return nt(":nth-child("+e+")",t)}function uzt(e,t){return nt(":nth-last-child("+e+")",t)}function lzt(e,t){return nt(":nth-last-of-type("+e+")",t)}function czt(e,t){return nt(":nth-of-type("+e+")",t)}function fzt(e){return nt("::after",e)}function hzt(e){return nt("::before",e)}function dzt(e){return nt("::first-letter",e)}function pzt(e){return nt("::first-line",e)}function gzt(e){return nt("::selection",e)}function mzt(e){return nt("::backdrop",e)}function yzt(e){return Or({"::placeholder":e})}function bzt(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t=(0,Gh.default)(t),t?t.map(function(r){var i={label:[]};return Dd(i,{src:r}),dA(aS(i),hA(i)).join("")}).join(""):""}function vzt(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t=(0,Gh.default)(t);var r=t?t.map(function(i){TW(i);var s=Object.keys(i)[0],o=i[s];return s+'="'+(o||"")+'"'}).join(" "):"";return r}var is={},uS={};Object.defineProperty(uS,"__esModule",{value:!0});function xzt(e){return e.name!=null}uS.isSurfaceInfo=xzt;function wzt(e){return e.drawArea instanceof HTMLElement}uS.isSurface=wzt;var lS={},IW={};function Czt(){}var Os={},rm=[],_Q=[];function c2(e,t){var n=_Q,r,i,s,o;for(o=arguments.length;o-- >2;)rm.push(arguments[o]);for(t&&t.children!=null&&(rm.length||rm.push(t.children),delete t.children);rm.length;)if((i=rm.pop())&&i.pop!==void 0)for(o=i.length;o--;)rm.push(i[o]);else typeof i=="boolean"&&(i=null),(s=typeof e!="function")&&(i==null?i="":typeof i=="number"?i=String(i):typeof i!="string"&&(s=!1)),s&&r?n[n.length-1]+=i:n===_Q?n=[i]:n.push(i),r=s;var a=new Czt;return a.nodeName=e,a.children=n,a.attributes=t??void 0,a.key=t==null?void 0:t.key,Os.vnode!==void 0&&Os.vnode(a),a}function Sf(e,t){for(var n in t)e[n]=t[n];return e}var Szt=typeof Promise=="function"?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function Rxe(e,t){return c2(e.nodeName,Sf(Sf({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var _zt=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,A4=[];function Pxe(e){!e._dirty&&(e._dirty=!0)&&A4.push(e)==1&&(Os.debounceRendering||Szt)(FW)}function FW(){var e,t=A4;for(A4=[];e=t.pop();)e._dirty&&FO(e)}function $zt(e,t,n){return typeof t=="string"||typeof t=="number"?e.splitText!==void 0:typeof t.nodeName=="string"?!e._componentConstructor&&Lxe(e,t.nodeName):n||e._componentConstructor===t.nodeName}function Lxe(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function Bxe(e){var t=Sf({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(n!==void 0)for(var r in n)t[r]===void 0&&(t[r]=n[r]);return t}function kzt(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}function OW(e){var t=e.parentNode;t&&t.removeChild(e)}function $Q(e,t,n,r,i){if(t==="className"&&(t="class"),t!=="key")if(t==="ref")n&&n(null),r&&r(e);else if(t==="class"&&!i)e.className=r||"";else if(t==="style"){if((!r||typeof r=="string"||typeof n=="string")&&(e.style.cssText=r||""),r&&typeof r=="object"){if(typeof n!="string")for(var s in n)s in r||(e.style[s]="");for(var s in r)e.style[s]=typeof r[s]=="number"&&_zt.test(s)===!1?r[s]+"px":r[s]}}else if(t==="dangerouslySetInnerHTML")r&&(e.innerHTML=r.__html||"");else if(t[0]=="o"&&t[1]=="n"){var o=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,kQ,o):e.removeEventListener(t,kQ,o),(e._listeners||(e._listeners={}))[t]=r}else if(t!=="list"&&t!=="type"&&!i&&t in e)Ezt(e,t,r??""),(r==null||r===!1)&&e.removeAttribute(t);else{var a=i&&t!==(t=t.replace(/^xlink:?/,""));r==null||r===!1?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):typeof r!="function"&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}}function Ezt(e,t,n){try{e[t]=n}catch{}}function kQ(e){return this._listeners[e.type](Os.event&&Os.event(e)||e)}var zxe=[],T4=0,Hc=!1,gA=!1;function jxe(){for(var e;e=zxe.pop();)Os.afterMount&&Os.afterMount(e),e.componentDidMount&&e.componentDidMount()}function Uxe(e,t,n,r,i,s){T4++||(Hc=i!=null&&i.ownerSVGElement!==void 0,gA=e!=null&&!("__preactattr_"in e));var o=Wxe(e,t,n,r,s);return i&&o.parentNode!==i&&i.appendChild(o),--T4||(gA=!1,s||jxe()),o}function Wxe(e,t,n,r,i){var s=e,o=Hc;if((t==null||typeof t=="boolean")&&(t=""),typeof t=="string"||typeof t=="number")return e&&e.splitText!==void 0&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(s=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(s,e),Vp(e,!0))),s.__preactattr_=!0,s;var a=t.nodeName;if(typeof a=="function")return Fzt(e,t,n,r);if(Hc=a==="svg"?!0:a==="foreignObject"?!1:Hc,a=String(a),(!e||!Lxe(e,a))&&(s=kzt(a,Hc),e)){for(;e.firstChild;)s.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(s,e),Vp(e,!0)}var u=s.firstChild,l=s.__preactattr_,c=t.children;if(l==null){l=s.__preactattr_={};for(var f=s.attributes,h=f.length;h--;)l[f[h].name]=f[h].value}return!gA&&c&&c.length===1&&typeof c[0]=="string"&&u!=null&&u.splitText!==void 0&&u.nextSibling==null?u.nodeValue!=c[0]&&(u.nodeValue=c[0]):(c&&c.length||u!=null)&&Azt(s,c,n,r,gA||l.dangerouslySetInnerHTML!=null),Tzt(s,t.attributes,l),Hc=o,s}function Azt(e,t,n,r,i){var s=e.childNodes,o=[],a={},u=0,l=0,c=s.length,f=0,h=t?t.length:0,d,p,m,g,y;if(c!==0)for(var b=0;b<c;b++){var x=s[b],v=x.__preactattr_,w=h&&v?x._component?x._component.__key:v.key:null;w!=null?(u++,a[w]=x):(v||(x.splitText!==void 0?!i||x.nodeValue.trim():i))&&(o[f++]=x)}if(h!==0)for(var b=0;b<h;b++){g=t[b],y=null;var w=g.key;if(w!=null)u&&a[w]!==void 0&&(y=a[w],a[w]=void 0,u--);else if(!y&&l<f){for(d=l;d<f;d++)if(o[d]!==void 0&&$zt(p=o[d],g,i)){y=p,o[d]=void 0,d===f-1&&f--,d===l&&l++;break}}y=Wxe(y,g,n,r),m=s[b],y&&y!==e&&y!==m&&(m==null?e.appendChild(y):y===m.nextSibling?OW(m):e.insertBefore(y,m))}if(u)for(var b in a)a[b]!==void 0&&Vp(a[b],!1);for(;l<=f;)(y=o[f--])!==void 0&&Vp(y,!1)}function Vp(e,t){var n=e._component;n?OO(n):(e.__preactattr_!=null&&e.__preactattr_.ref&&e.__preactattr_.ref(null),(t===!1||e.__preactattr_==null)&&OW(e),Vxe(e))}function Vxe(e){for(e=e.lastChild;e;){var t=e.previousSibling;Vp(e,!0),e=t}}function Tzt(e,t,n){var r;for(r in n)!(t&&t[r]!=null)&&n[r]!=null&&$Q(e,r,n[r],n[r]=void 0,Hc);for(r in t)r!=="children"&&r!=="innerHTML"&&(!(r in n)||t[r]!==(r==="value"||r==="checked"?e[r]:n[r]))&&$Q(e,r,n[r],n[r]=t[r],Hc)}var D4={};function Dzt(e){var t=e.constructor.name;(D4[t]||(D4[t]=[])).push(e)}function Gxe(e,t,n){var r=D4[e.name],i;if(e.prototype&&e.prototype.render?(i=new e(t,n),f2.call(i,t,n)):(i=new f2(t,n),i.constructor=e,i.render=Izt),r){for(var s=r.length;s--;)if(r[s].constructor===e){i.nextBase=r[s].nextBase,r.splice(s,1);break}}return i}function Izt(e,t,n){return this.constructor(e,n)}function mA(e,t,n,r,i){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||i?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,n!==0&&(n===1||Os.syncComponentUpdates!==!1||!e.base?FO(e,1,i):Pxe(e)),e.__ref&&e.__ref(e))}function FO(e,t,n,r){if(!e._disable){var i=e.props,s=e.state,o=e.context,a=e.prevProps||i,u=e.prevState||s,l=e.prevContext||o,c=e.base,f=e.nextBase,h=c||f,d=e._component,p=!1,m,g,y;if(c&&(e.props=a,e.state=u,e.context=l,t!==2&&e.shouldComponentUpdate&&e.shouldComponentUpdate(i,s,o)===!1?p=!0:e.componentWillUpdate&&e.componentWillUpdate(i,s,o),e.props=i,e.state=s,e.context=o),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!p){m=e.render(i,s,o),e.getChildContext&&(o=Sf(Sf({},o),e.getChildContext()));var b=m&&m.nodeName,x,v;if(typeof b=="function"){var w=Bxe(m);g=d,g&&g.constructor===b&&w.key==g.__key?mA(g,w,1,o,!1):(x=g,e._component=g=Gxe(b,w,o),g.nextBase=g.nextBase||f,g._parentComponent=e,mA(g,w,0,o,!1),FO(g,1,n,!0)),v=g.base}else y=h,x=d,x&&(y=e._component=null),(h||t===1)&&(y&&(y._component=null),v=Uxe(y,m,o,n||!c,h&&h.parentNode,!0));if(h&&v!==h&&g!==d){var C=h.parentNode;C&&v!==C&&(C.replaceChild(v,h),x||(h._component=null,Vp(h,!1)))}if(x&&OO(x),e.base=v,v&&!r){for(var S=e,_=e;_=_._parentComponent;)(S=_).base=v;v._component=S,v._componentConstructor=S.constructor}}if(!c||n?zxe.unshift(e):p||(e.componentDidUpdate&&e.componentDidUpdate(a,u,l),Os.afterUpdate&&Os.afterUpdate(e)),e._renderCallbacks!=null)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);!T4&&!r&&jxe()}}function Fzt(e,t,n,r){for(var i=e&&e._component,s=i,o=e,a=i&&e._componentConstructor===t.nodeName,u=a,l=Bxe(t);i&&!u&&(i=i._parentComponent);)u=i.constructor===t.nodeName;return i&&u&&(!r||i._component)?(mA(i,l,3,n,r),e=i.base):(s&&!a&&(OO(s),e=o=null),i=Gxe(t.nodeName,l,n),e&&!i.nextBase&&(i.nextBase=e,o=null),mA(i,l,1,n,r),e=i.base,o&&e!==o&&(o._component=null,Vp(o,!1))),e}function OO(e){Os.beforeUnmount&&Os.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?OO(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,OW(t),Dzt(e),Vxe(t)),e.__ref&&e.__ref(null)}function f2(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}Sf(f2.prototype,{setState:function(t,n){var r=this.state;this.prevState||(this.prevState=Sf({},r)),Sf(r,typeof t=="function"?t(r,this.props):t),n&&(this._renderCallbacks=this._renderCallbacks||[]).push(n),Pxe(this)},forceUpdate:function(t){t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),FO(this,2)},render:function(){}});function Hxe(e,t,n){return Uxe(n,e,{},!1,t,!1)}var Ozt={h:c2,createElement:c2,cloneElement:Rxe,Component:f2,render:Hxe,rerender:FW,options:Os};const Nzt=Object.freeze(Object.defineProperty({__proto__:null,Component:f2,cloneElement:Rxe,createElement:c2,default:Ozt,h:c2,options:Os,render:Hxe,rerender:FW},Symbol.toStringTag,{value:"Module"})),NW=Kp(Nzt);var MW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(MW,"__esModule",{value:!0});const k_=NW,bM=we;class Im extends k_.Component{componentDidMount(){const{name:t,tab:n}=this.props;this.props.registerSurface(t,n,this)}componentDidUpdate(){return!1}render(){const{name:t,visible:n,styles:r}=this.props,i=Object.assign({},Im.defaultStyles,r),{width:s,height:o}=i;let{maxHeight:a,maxWidth:u}=i;a=o===Im.defaultStyles.height?a:o,u=s===Im.defaultStyles.width?u:s;const l=bM.css({display:n?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:o,width:s,maxHeight:a,maxWidth:u,overflow:"auto"}),c=bM.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),f=bM.css({boxSizing:"border-box"});return k_.h("div",{className:`${l} tf-surface`,ref:h=>this.container=h,"data-visible":n},k_.h("div",{className:`${c} tf-label`,ref:h=>this.label=h},t),k_.h("div",{className:`${f} tf-draw-area`,ref:h=>this.drawArea=h}))}}Im.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"};MW.SurfaceComponent=Im;var RW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(RW,"__esModule",{value:!0});const Cv=NW,qxe=we;class Mzt extends Cv.Component{render(){const{tabNames:t,activeTab:n,handleClick:r}=this.props,i=t.length>0?t.map(o=>Cv.h(Rzt,{key:o,id:o,handleClick:r,isActive:o===n},o)):null,s=qxe.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return Cv.h("div",{className:`${s} visor-tabs`},i)}}RW.Tabs=Mzt;class Rzt extends Cv.Component{render(){const{children:t,isActive:n,handleClick:r,id:i}=this.props,s=qxe.css({borderBottomColor:n?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return Cv.h("a",{className:`${s} tf-tab`,"data-isactive":n,onClick:()=>r(i)},t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(IW,"__esModule",{value:!0});const ia=NW,Ud=we,Pzt=MW,Lzt=RW;class PW extends ia.Component{static render(t,n,r){return ia.render(ia.h(PW,Object.assign({},r)),t,n)}constructor(t){super(t),this.surfaces=new Map;const n=t.startOpen==null?!0:t.startOpen;this.state={isOpen:n,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(t,n){const r=this.surfaceId(t,n);let i;if(this.surfaces.has(r))i=this.surfaces.get(r);else throw Error(`Surface not found with id: ${r}`);return{container:i.container,label:i.label,drawArea:i.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(t,n){return t+n}setTabs(t){const n=t.map(s=>s.tab),r=this.state.tabs;let i;for(const s of n)r.has(s)||(r.add(s),i=s);i!=null&&this.setState({tabs:r,activeTab:i})}getTabs(){return this.state.tabs}registerSurface(t,n,r){const i=this.surfaceId(t,n);this.surfaces.set(i,r)}keyHandler(t){t.keyCode===192&&(t.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(t){this.setState({activeTab:t})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(t){this.setTabs(t.surfaceList)}render(){const{isOpen:t,isFullscreen:n,activeTab:r}=this.state,{surfaceList:i}=this.props,s=Array.from(this.getTabs().values()),u=n?"90vw":"550px",l=Ud.css({width:u,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),c=Ud.css({right:"0"}),f=Ud.css({right:`calc(-${u} - 10px)`}),h=t?c:f,d=Ud.css({});return ia.h("div",{className:`${l} ${h} visor`,"data-isopen":t,"data-isfullscreen":n},ia.h(Bzt,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:n}),ia.h(Lzt.Tabs,{tabNames:s,activeTab:r,handleClick:this.setActiveTab.bind(this)}),ia.h("div",{className:`${d} visor-surfaces`},i.map(p=>ia.h(Pzt.SurfaceComponent,{key:p.name+p.tab,name:p.name,tab:p.tab,styles:p.styles,registerSurface:this.registerSurface.bind(this),visible:r===p.tab}))))}}IW.VisorComponent=PW;function Bzt(e){const{isFullScreen:t,fullScreenHandler:n,closeHandler:r}=e,i=Ud.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),s=Ud.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),o=Ud.css({marginLeft:"auto"});return ia.h("div",{className:`${i} visor-controls`},ia.h("button",{className:`${s}`,onClick:n},t?"Minimize":"Maximize"),ia.h("button",{className:`${s} ${o}`,onClick:r},"Hide"))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(lS,"__esModule",{value:!0});const zzt=IW;let E_;const jzt="Visor",vM="tfjs-visor-container";function Uzt(){if(typeof document>"u")throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(vM)&&E_!=null)return E_;let e=document.getElementById(vM);e==null&&(e=document.createElement("div"),e.id=vM,document.body.appendChild(e));let t;function n(s,o){let a=null;return t=zzt.VisorComponent.render(s,t,{ref:u=>a=u,surfaceList:Array.from(o.values())}),a}const r=new Map,i=n(e,r);return E_=new Xxe(i,e,r,n),E_}lS.visor=Uzt;class Xxe{constructor(t,n,r,i){this.visorComponent=t,this.el=n,this.surfaceList=r,this.renderVisor=i}surface(t){const{name:n}=t,r=t.tab==null?jzt:t.tab;if(n==null||!(typeof n=="string"||n instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const i=Object.assign({},t,{tab:r}),s=`${n}-${r}`;return this.surfaceList.has(s)||this.surfaceList.set(s,i),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(n,r)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(t){if(!this.visorComponent.state.tabs.has(t))throw new Error(`Tab '${t}' does not exist`);this.visorComponent.setState({activeTab:t})}}lS.Visor=Xxe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Wzt=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(is,"__esModule",{value:!0});const EQ=uS,Vzt=lS;function Gzt(e){if(e instanceof HTMLElement)return e;if(EQ.isSurface(e))return e.drawArea;if(EQ.isSurfaceInfo(e))return Vzt.visor().surface({name:e.name,tab:e.tab,styles:e.styles}).drawArea;throw new Error("Not a drawable")}is.getDrawArea=Gzt;function Hzt(e,t){const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++){const s=n[i];if(e[s]!==t[s])return!1}return!0}is.shallowEquals=Hzt;function qzt(){return Wzt(this,void 0,void 0,function*(){yield new Promise(e=>requestAnimationFrame(e))})}is.nextFrame=qzt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Xo,"__esModule",{value:!0});const AQ=we,Xzt=is,Yzt={prepend:!1};function Kzt(e,t,n={}){const r=Xzt.getDrawArea(e),i=AQ.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),s=AQ.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),o=Object.assign({},Yzt,n);let a=r.querySelector(`div[data-name=${t}]`);if(!a){if(a=document.createElement("div"),a.setAttribute("class",`${i}`),a.dataset.name=t,o.title){const u=document.createElement("div");u.setAttribute("class",`subsurface-title ${s}`),u.innerText=o.title,a.appendChild(u)}o.prepend?r.insertBefore(a,r.firstChild):r.appendChild(a)}return a}Xo.subSurface=Kzt;function Zzt(e){let n=0,r=e;for(;r&&r.clientWidth===0;)r=r.parentElement,n=50;return r.clientWidth-n}Xo.getDefaultWidth=Zzt;function Jzt(e){return e.clientHeight===0?200:e.clientHeight}Xo.getDefaultHeight=Jzt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Qzt=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},e6t=st&&st.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(iz,"__esModule",{value:!0});const t6t=e6t(ky),TQ=Xo,A_=is;function n6t(e,t,n={}){return Qzt(this,void 0,void 0,function*(){const r=A_.getDrawArea(e),i=t,s=Object.assign({},r6t,n);if(xM.has(r)){const g=xM.get(r);if(A_.shallowEquals(s,g.lastOptions)){yield A_.nextFrame();const y=g.view,b=y.changeset().remove(()=>!0).insert(i);yield y.change("values",b).runAsync();return}}const{xLabel:o,yLabel:a,xType:u,yType:l}=s;let c=null;o!=null&&(c={title:o});let f=null;a!=null&&(f={title:a});const h={actions:!1,mode:"vega-lite",defaultStyle:!1};let d;s.color!=null?Array.isArray(s.color)?d={field:"index",type:"nominal",scale:{range:s.color}}:d={value:s.color}:d={value:"#4C78A0"};const p={width:s.width||TQ.getDefaultWidth(r),height:s.height||TQ.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:s.fontSize,titleFontSize:s.fontSize},text:{fontSize:s.fontSize},legend:{labelFontSize:s.fontSize,titleFontSize:s.fontSize}},data:{values:i,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:u,axis:c},y:{field:"value",type:l,axis:f},color:d}};yield A_.nextFrame();const m=yield t6t.default(r,p,h);xM.set(r,{view:m.view,lastOptions:s})})}iz.barchart=n6t;const r6t={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},xM=new Map;var LW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var i6t=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s6t=st&&st.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(LW,"__esModule",{value:!0});const o6t=s6t(ky),DQ=Xo,a6t=is;function u6t(e,t,n={}){return i6t(this,void 0,void 0,function*(){const r=Object.assign({},l6t,n),i=a6t.getDrawArea(e),s=[],o=t.values,a=t.tickLabels||[],u=a.length===0;let l=!0;for(let d=0;d<o.length;d++){const p=u?`Class ${d}`:a[d];u&&a.push(p);for(let m=0;m<o[d].length;m++){const g=u?`Class ${m}`:a[m],y=o[d][m];d===m&&!r.shadeDiagonal?s.push({label:p,prediction:g,count:y,noFill:!0}):(s.push({label:p,prediction:g,count:y,scaleCount:y}),y!==0&&(l=!1))}}if(!r.shadeDiagonal&&l)for(const d of s)d.noFill===!0&&(d.noFill=!1,d.scaleCount=d.count);const c={actions:!1,mode:"vega-lite",defaultStyle:!1},f={width:r.width||DQ.getDefaultWidth(i),height:r.height||DQ.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},data:{values:s},encoding:{x:{field:"prediction",type:"ordinal",title:r.xLabel||"prediction",scale:{domain:a}},y:{field:"label",type:"ordinal",title:r.yLabel||"label",scale:{domain:a}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:r.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};r.shadeDiagonal===!1&&f.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),r.showTextOverlay&&f.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const h=typeof r.colorMap=="string"?{scheme:r.colorMap}:r.colorMap;f.layer[0].encoding.color.scale.range=h,yield o6t.default(i,f,c)})}LW.confusionMatrix=u6t;const l6t={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]};var BW={},Dc={};Object.defineProperty(Dc,"__esModule",{value:!0});/*
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yxe(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}Dc.assert=Yxe;function c6t(e,t,n=""){Yxe(Kxe(e,t),n+` Shapes ${e} and ${t} must match`)}Dc.assertShapesMatch=c6t;function Kxe(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}Dc.arraysEqual=Kxe;Dc.DECIMAL_PLACES_TO_CHECK=4;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Zxe=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},f6t=st&&st.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},h6t=st&&st.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(BW,"__esModule",{value:!0});const Sv=f6t(rae),d6t=h6t(ky),IQ=Xo,h2=Dc,p6t=is;function g6t(e,t,n={}){return Zxe(this,void 0,void 0,function*(){const r=Object.assign({},y6t,n),i=p6t.getDrawArea(e);let s=t.values;r.rowMajor&&(s=yield m6t(t.values));const{xTickLabels:o,yTickLabels:a}=t;o!=null&&FQ(s,o,0),a!=null&&FQ(s,a,1);const u="@tfidx@",l=[];if(s instanceof Sv.Tensor){h2.assert(s.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const m=yield s.data(),[g,y]=s.shape;for(let b=0;b<g;b++){const x=o?`${o[b]}${u}${b}`:b;for(let v=0;v<y;v++){const w=a?`${a[v]}${u}${v}`:v,C=b*y+v,S=m[C];l.push({x,y:w,value:S})}}}else{const m=s;for(let g=0;g<m.length;g++){const y=o?`${o[g]}${u}${g}`:g;for(let b=0;b<m[g].length;b++){const x=a?`${a[b]}${u}${b}`:b,v=m[g][b];l.push({x:y,y:x,value:v})}}}const c={actions:!1,mode:"vega-lite",defaultStyle:!1},f={width:r.width||IQ.getDefaultWidth(i),height:r.height||IQ.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:l},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:r.xType,title:r.xLabel,sort:!1},y:{field:"y",type:r.yType,title:r.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},h=`${u}\\d+$`,d=new RegExp(h);o&&(f.encoding.x.axis={labelExpr:`replace(datum.value, regexp(/${h}/), '')`}),a&&(f.encoding.y.axis={labelExpr:`replace(datum.value, regexp(/${h}/), '')`}),(o||a)&&(c.tooltip={sanitize:m=>String(m).replace(d,"")});let p;switch(r.colorMap){case"blues":p=["#f7fbff","#4292c6"];break;case"greyscale":p=["#000000","#ffffff"];break;case"viridis":default:p="viridis";break}if(p!=="viridis"){const m=f.encoding.fill;m.scale={range:p}}if(r.domain){const m=f.encoding.fill;m.scale!=null?m.scale=Object.assign({},m.scale,{domain:r.domain}):m.scale={domain:r.domain}}yield d6t.default(i,f,c)})}BW.heatmap=g6t;function m6t(e){return Zxe(this,void 0,void 0,function*(){let t,n;e instanceof Sv.Tensor?(t=e.shape,n=e.transpose()):(t=[e.length,e[0].length],n=Sv.tidy(()=>Sv.tensor2d(e).transpose())),h2.assert(n.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const r=yield n.array();n.dispose();const i=[r.length,r[0].length];return h2.assert(t[0]===i[1]&&t[1]===i[0],`Unexpected transposed shape. Original ${t} : Transposed ${i}`),r})}function FQ(e,t,n){const r=e instanceof Sv.Tensor?e.shape:[e.length,e[0].length];n===0?h2.assert(r[0]===t.length,`Length of xTickLabels (${t.length}) must match number of rows (${r[0]})`):n===1&&h2.assert(r[1]===t.length,`Length of yTickLabels (${t.length}) must match number of columns (${r[1]})`)}const y6t={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1};var cS={};const Jxe=Kp(but);var gl={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var NO=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(gl,"__esModule",{value:!0});const Gp=rae,ff=Dc;function b6t(e){if(!Array.isArray(e))throw new Error("input must be an array");if(e.length===0)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const t=e.length;let n=-1/0,r=1/0,i=0,s=0,o=0;for(let u=0;u<t;u++){const l=e[u];l>n&&(n=l),l<r&&(r=l),l===0&&(i+=1),isNaN(l)?s+=1:isFinite(l)||(o+=1)}const a={numVals:t,numZeros:i,numNans:s,max:n,min:r,numInfs:o};return a.max===-1/0&&(a.max=NaN),a.min===1/0&&(a.min=NaN),a}gl.arrayStats=b6t;function v6t(e){return NO(this,void 0,void 0,function*(){const[t,n,r]=Gp.tidy(()=>{const i=Gp.scalar(0,e.dtype),s=e.min(),o=e.max(),a=e.equal(i).sum();return[s,o,a]});return Promise.all([e.data(),t.data(),n.data(),r.data()]).then(([i,s,o,a])=>{const u=i.length;let l=0,c=0;for(let p=0;p<u;p++){const m=i[p];isNaN(m)?l+=1:isFinite(m)||(c+=1)}let f=s[0],h=o[0];return l===u&&(f=NaN,h=NaN),{numVals:u,numZeros:a[0],numNans:l,min:f,max:h,numInfs:c}})})}gl.tensorStats=v6t;function x6t(e,t,n,r){return NO(this,void 0,void 0,function*(){ff.assert(e.rank===1,"labels must be a 1D tensor"),ff.assert(t.rank===1,"predictions must be a 1D tensor"),ff.assert(e.size===t.size,"labels and predictions must be the same length"),r!=null&&ff.assert(r.size===t.size,"labels and predictions must be the same length");const i=e.cast("int32"),s=t.cast("int32");n==null&&(n=Gp.tidy(()=>Gp.maximum(i.max(),s.max()).cast("int32").dataSync()[0]+1));let o=Promise.resolve(null);return r!=null&&(o=r.data()),Promise.all([i.data(),s.data(),o]).then(([a,u,l])=>{const c=Array(n).fill(0);for(let f=0;f<n;f++)c[f]=Array(n).fill(0);for(let f=0;f<a.length;f++){const h=a[f],d=u[f];l!=null?c[h][d]+=l[f]:c[h][d]+=1}return c})})}gl.confusionMatrix=x6t;function w6t(e,t){return NO(this,void 0,void 0,function*(){ff.assertShapesMatch(e.shape,t.shape,"Error computing accuracy.");const n=e.equal(t),r=n.mean(),i=(yield r.data())[0];return Gp.dispose([n,r]),i})}gl.accuracy=w6t;function C6t(e,t,n){return NO(this,void 0,void 0,function*(){return ff.assert(e.rank===1,"labels must be a 1D tensor"),ff.assert(t.rank===1,"predictions must be a 1D tensor"),ff.assert(e.size===t.size,"labels and predictions must be the same length"),n==null&&(n=Gp.tidy(()=>Gp.maximum(e.max(),t.max()).dataSync()[0]+1)),Promise.all([e.data(),t.data()]).then(([r,i])=>{const s=Array(n).fill(0),o=Array(n).fill(0);for(let u=0;u<r.length;u++){const l=r[u],c=i[u];s[l]+=1,l===c&&(o[l]+=1)}const a=[];for(let u=0;u<s.length;u++)a.push({count:s[u],accuracy:s[u]===0?0:o[u]/s[u]});return a})})}gl.perClassAccuracy=C6t;var Ty={},I4="http://www.w3.org/1999/xhtml";const F4={svg:"http://www.w3.org/2000/svg",xhtml:I4,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function zW(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),F4.hasOwnProperty(t)?{space:F4[t],local:e}:e}function S6t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===I4&&t.documentElement.namespaceURI===I4?t.createElement(e):t.createElementNS(n,e)}}function _6t(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function MO(e){var t=zW(e);return(t.local?_6t:S6t)(t)}function $6t(){}function jW(e){return e==null?$6t:function(){return this.querySelector(e)}}function k6t(e){typeof e!="function"&&(e=jW(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=new Array(o),u,l,c=0;c<o;++c)(u=s[c])&&(l=e.call(u,u.__data__,c,s))&&("__data__"in u&&(l.__data__=u.__data__),a[c]=l);return new Qi(r,this._parents)}function E6t(){return[]}function Qxe(e){return e==null?E6t:function(){return this.querySelectorAll(e)}}function A6t(e){typeof e!="function"&&(e=Qxe(e));for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],a=o.length,u,l=0;l<a;++l)(u=o[l])&&(r.push(e.call(u,u.__data__,l,o)),i.push(u));return new Qi(r,i)}var e2e=function(e){return function(){return this.matches(e)}};if(typeof document<"u"){var pb=document.documentElement;if(!pb.matches){var T6t=pb.webkitMatchesSelector||pb.msMatchesSelector||pb.mozMatchesSelector||pb.oMatchesSelector;e2e=function(e){return function(){return T6t.call(this,e)}}}}const t2e=e2e;function D6t(e){typeof e!="function"&&(e=t2e(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],u,l=0;l<o;++l)(u=s[l])&&e.call(u,u.__data__,l,s)&&a.push(u);return new Qi(r,this._parents)}function n2e(e){return new Array(e.length)}function I6t(){return new Qi(this._enter||this._groups.map(n2e),this._parents)}function yA(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}yA.prototype={constructor:yA,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function F6t(e){return function(){return e}}var OQ="$";function O6t(e,t,n,r,i,s){for(var o=0,a,u=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new yA(e,s[o]);for(;o<u;++o)(a=t[o])&&(i[o]=a)}function N6t(e,t,n,r,i,s,o){var a,u,l={},c=t.length,f=s.length,h=new Array(c),d;for(a=0;a<c;++a)(u=t[a])&&(h[a]=d=OQ+o.call(u,u.__data__,a,t),d in l?i[a]=u:l[d]=u);for(a=0;a<f;++a)d=OQ+o.call(e,s[a],a,s),(u=l[d])?(r[a]=u,u.__data__=s[a],l[d]=null):n[a]=new yA(e,s[a]);for(a=0;a<c;++a)(u=t[a])&&l[h[a]]===u&&(i[a]=u)}function M6t(e,t){if(!e)return d=new Array(this.size()),l=-1,this.each(function(C){d[++l]=C}),d;var n=t?N6t:O6t,r=this._parents,i=this._groups;typeof e!="function"&&(e=F6t(e));for(var s=i.length,o=new Array(s),a=new Array(s),u=new Array(s),l=0;l<s;++l){var c=r[l],f=i[l],h=f.length,d=e.call(c,c&&c.__data__,l,r),p=d.length,m=a[l]=new Array(p),g=o[l]=new Array(p),y=u[l]=new Array(h);n(c,f,m,g,y,d,t);for(var b=0,x=0,v,w;b<p;++b)if(v=m[b]){for(b>=x&&(x=b+1);!(w=g[x])&&++x<p;);v._next=w||null}}return o=new Qi(o,r),o._enter=a,o._exit=u,o}function R6t(){return new Qi(this._exit||this._groups.map(n2e),this._parents)}function P6t(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var u=t[a],l=n[a],c=u.length,f=o[a]=new Array(c),h,d=0;d<c;++d)(h=u[d]||l[d])&&(f[d]=h);for(;a<r;++a)o[a]=t[a];return new Qi(o,this._parents)}function L6t(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&s!==o.nextSibling&&s.parentNode.insertBefore(o,s),s=o);return this}function B6t(e){e||(e=z6t);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,u=i[s]=new Array(a),l,c=0;c<a;++c)(l=o[c])&&(u[c]=l);u.sort(t)}return new Qi(i,this._parents).order()}function z6t(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function j6t(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function U6t(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}function W6t(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function V6t(){var e=0;return this.each(function(){++e}),e}function G6t(){return!this.node()}function H6t(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&e.call(a,a.__data__,s,i);return this}function q6t(e){return function(){this.removeAttribute(e)}}function X6t(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Y6t(e,t){return function(){this.setAttribute(e,t)}}function K6t(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Z6t(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function J6t(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Q6t(e,t){var n=zW(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?X6t:q6t:typeof t=="function"?n.local?J6t:Z6t:n.local?K6t:Y6t)(n,t))}function UW(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function e8t(e){return function(){this.style.removeProperty(e)}}function t8t(e,t,n){return function(){this.style.setProperty(e,t,n)}}function n8t(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function r8t(e,t,n){return arguments.length>1?this.each((t==null?e8t:typeof t=="function"?n8t:t8t)(e,t,n??"")):r2e(this.node(),e)}function r2e(e,t){return e.style.getPropertyValue(t)||UW(e).getComputedStyle(e,null).getPropertyValue(t)}function i8t(e){return function(){delete this[e]}}function s8t(e,t){return function(){this[e]=t}}function o8t(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function a8t(e,t){return arguments.length>1?this.each((t==null?i8t:typeof t=="function"?o8t:s8t)(e,t)):this.node()[e]}function i2e(e){return e.trim().split(/^|\s+/)}function WW(e){return e.classList||new s2e(e)}function s2e(e){this._node=e,this._names=i2e(e.getAttribute("class")||"")}s2e.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function o2e(e,t){for(var n=WW(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function a2e(e,t){for(var n=WW(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function u8t(e){return function(){o2e(this,e)}}function l8t(e){return function(){a2e(this,e)}}function c8t(e,t){return function(){(t.apply(this,arguments)?o2e:a2e)(this,e)}}function f8t(e,t){var n=i2e(e+"");if(arguments.length<2){for(var r=WW(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?c8t:t?u8t:l8t)(n,t))}function h8t(){this.textContent=""}function d8t(e){return function(){this.textContent=e}}function p8t(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function g8t(e){return arguments.length?this.each(e==null?h8t:(typeof e=="function"?p8t:d8t)(e)):this.node().textContent}function m8t(){this.innerHTML=""}function y8t(e){return function(){this.innerHTML=e}}function b8t(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function v8t(e){return arguments.length?this.each(e==null?m8t:(typeof e=="function"?b8t:y8t)(e)):this.node().innerHTML}function x8t(){this.nextSibling&&this.parentNode.appendChild(this)}function w8t(){return this.each(x8t)}function C8t(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function S8t(){return this.each(C8t)}function _8t(e){var t=typeof e=="function"?e:MO(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function $8t(){return null}function k8t(e,t){var n=typeof e=="function"?e:MO(e),r=t==null?$8t:typeof t=="function"?t:jW(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function E8t(){var e=this.parentNode;e&&e.removeChild(this)}function A8t(){return this.each(E8t)}function T8t(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function D8t(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function I8t(e){return this.select(e?D8t:T8t)}function F8t(e){return arguments.length?this.property("__data__",e):this.node().__data__}var u2e={},Gl=null;if(typeof document<"u"){var O8t=document.documentElement;"onmouseenter"in O8t||(u2e={mouseenter:"mouseover",mouseleave:"mouseout"})}function N8t(e,t,n){return e=l2e(e,t,n),function(r){var i=r.relatedTarget;(!i||i!==this&&!(i.compareDocumentPosition(this)&8))&&e.call(this,r)}}function l2e(e,t,n){return function(r){var i=Gl;Gl=r;try{e.call(this,this.__data__,t,n)}finally{Gl=i}}}function M8t(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function R8t(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.capture):t[++r]=s;++r?t.length=r:delete this.__on}}}function P8t(e,t,n){var r=u2e.hasOwnProperty(e.type)?N8t:l2e;return function(i,s,o){var a=this.__on,u,l=r(t,s,o);if(a){for(var c=0,f=a.length;c<f;++c)if((u=a[c]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=n),u.value=t;return}}this.addEventListener(e.type,l,n),u={type:e.type,name:e.name,value:t,listener:l,capture:n},a?a.push(u):this.__on=[u]}}function L8t(e,t,n){var r=M8t(e+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var u=0,l=a.length,c;u<l;++u)for(i=0,c=a[u];i<s;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value}return}for(a=t?P8t:R8t,n==null&&(n=!1),i=0;i<s;++i)this.each(a(r[i],t,n));return this}function B8t(e,t,n,r){var i=Gl;e.sourceEvent=Gl,Gl=e;try{return t.apply(n,r)}finally{Gl=i}}function c2e(e,t,n){var r=UW(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function z8t(e,t){return function(){return c2e(this,e,t)}}function j8t(e,t){return function(){return c2e(this,e,t.apply(this,arguments))}}function U8t(e,t){return this.each((typeof t=="function"?j8t:z8t)(e,t))}var VW=[null];function Qi(e,t){this._groups=e,this._parents=t}function f2e(){return new Qi([[document.documentElement]],VW)}Qi.prototype=f2e.prototype={constructor:Qi,select:k6t,selectAll:A6t,filter:D6t,data:M6t,enter:I6t,exit:R6t,merge:P6t,order:L6t,sort:B6t,call:j6t,nodes:U6t,node:W6t,size:V6t,empty:G6t,each:H6t,attr:Q6t,style:r8t,property:a8t,classed:f8t,text:g8t,html:v8t,raise:w8t,lower:S8t,append:_8t,insert:k8t,remove:A8t,clone:I8t,datum:F8t,on:L8t,dispatch:U8t};function h2e(e){return typeof e=="string"?new Qi([[document.querySelector(e)]],[document.documentElement]):new Qi([[e]],VW)}function W8t(e){return h2e(MO(e).call(document.documentElement))}var V8t=0;function d2e(){return new O4}function O4(){this._="@"+(++V8t).toString(36)}O4.prototype=d2e.prototype={constructor:O4,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};function GW(){for(var e=Gl,t;t=e.sourceEvent;)e=t;return e}function RO(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function G8t(e){var t=GW();return t.changedTouches&&(t=t.changedTouches[0]),RO(e,t)}function H8t(e){return typeof e=="string"?new Qi([document.querySelectorAll(e)],[document.documentElement]):new Qi([e??[]],VW)}function q8t(e,t,n){arguments.length<3&&(n=t,t=GW().changedTouches);for(var r=0,i=t?t.length:0,s;r<i;++r)if((s=t[r]).identifier===n)return RO(e,s);return null}function X8t(e,t){t==null&&(t=GW().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=RO(e,t[n]);return i}const Y8t=Object.freeze(Object.defineProperty({__proto__:null,clientPoint:RO,create:W8t,creator:MO,customEvent:B8t,get event(){return Gl},local:d2e,matcher:t2e,mouse:G8t,namespace:zW,namespaces:F4,select:h2e,selectAll:H8t,selection:f2e,selector:jW,selectorAll:Qxe,style:r2e,touch:q8t,touches:X8t,window:UW},Symbol.toStringTag,{value:"Module"})),K8t=Kp(Y8t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Ty,"__esModule",{value:!0});const Z8t=Jxe,NQ=K8t,wM=we,J8t=is;function Q8t(e,t,n={}){if(t&&t.headers==null)throw new Error('Data to render must have a "headers" property');if(t&&t.values==null)throw new Error('Data to render must have a "values" property');const r=J8t.getDrawArea(e),i=Object.assign({},e7t,n);let s=NQ.select(r).select("table.tf-table");const o=wM.css({fontSize:i.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(s.size()===0&&(s=NQ.select(r).append("table"),s.attr("class",` ${o} tf-table`),s.append("thead").append("tr"),s.append("tbody")),s.size()!==1)throw new Error("Error inserting table");const a=wM.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),u=s.select("thead").select("tr").selectAll("th").data(t.headers),l=u.enter().append("th").attr("class",`${a}`);u.merge(l).html(g=>g),u.exit().remove();const c=Z8t.format(",.4~f"),f=s.select("tbody").selectAll("tr").data(t.values),h=f.enter().append("tr"),d=wM.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),p=f.merge(h).selectAll("td").data(g=>g),m=p.enter().append("td").attr("class",`${d}`);p.merge(m).html(g=>typeof g=="number"?c(g):g),p.exit().remove(),f.exit().remove()}Ty.table=Q8t;const e7t={fontSize:14};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var t7t=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},n7t=st&&st.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(cS,"__esModule",{value:!0});const MQ=Jxe,r7t=n7t(ky),T_=Xo,i7t=gl,s7t=Ty,o7t={maxBins:12,fontSize:11};function a7t(e,t,n={}){return t7t(this,void 0,void 0,function*(){const r=l7t(t),i=Object.assign({},o7t,n),s={actions:!1,mode:"vega-lite",defaultStyle:!1},o=T_.subSurface(e,"histogram");if(n.stats!==!1){const l=T_.subSurface(e,"stats",{prepend:!0});let c;n.stats?c=n.stats:c=i7t.arrayStats(r.map(f=>f.value)),u7t(c,l,{fontSize:i.fontSize})}if(r.length===0)return;const a=[];for(let l=0;l<r.length;l++){const c=r[l].value;c!=null&&isFinite(c)&&a.push(r[l])}const u={width:i.width||T_.getDefaultWidth(o),height:i.height||T_.getDefaultHeight(o),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:a},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},encoding:{x:{bin:{maxbins:i.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:i.color||"#001B44"}}};return r7t.default(o,u,s)})}cS.histogram=a7t;function u7t(e,t,n){const r=MQ.format(",.4~f"),i=MQ.format(".4~p"),s=[],o=[];if(e.numVals!=null&&(s.push("Num Vals"),o.push(r(e.numVals))),e.min!=null&&(s.push("Min"),o.push(r(e.min))),e.max!=null&&(s.push("Max"),o.push(r(e.max))),e.numZeros!=null){s.push("# Zeros");let a="";e.numVals&&(a=e.numZeros>0?`(${i(e.numZeros/e.numVals)})`:""),o.push(`${r(e.numZeros)} ${a}`)}if(e.numNans!=null){s.push("# NaNs");let a="";e.numVals&&(a=e.numNans>0?`(${i(e.numNans/e.numVals)})`:""),o.push(`${r(e.numNans)} ${a}`)}if(e.numInfs!=null){s.push("# Infinity");let a="";e.numVals&&(a=e.numInfs>0?`(${i(e.numInfs/e.numVals)})`:""),o.push(`${r(e.numInfs)} ${a}`)}s7t.table(t,{headers:s,values:[o]},n)}function l7t(e){if(e.length==null)throw new Error("input data must be an array");if(e.length===0)return[];if(typeof e[0]=="object"){if(e[0].value==null)throw new Error("input data must have a value field");return e}else{const t=Array(e.length);for(let n=0;n<e.length;n++)t[n]={value:e[n]};return t}}var PO={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var c7t=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},f7t=st&&st.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PO,"__esModule",{value:!0});const h7t=f7t(ky),RQ=Xo,PQ=Dc,d7t=is;function p7t(e,t,n={}){return c7t(this,void 0,void 0,function*(){const r=Array.isArray(t.values[0])?t.values:[t.values],i=r[0].length,s=t.series?t.series:r.map((m,g)=>`Series ${g+1}`);PQ.assert(s.length===r.length,"Must have an equal number of series labels as there are data series"),n.seriesColors!=null&&PQ.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const o=[];for(let m=0;m<i;m++){const g={x:m};s.forEach((y,b)=>{const x=r[b][m].y;g[y]=x,g[`${y}-name`]=y}),o.push(g)}const a=Object.assign({},g7t,n),u=()=>{if(a.zoomToFit)return{zero:!1};if(a.yAxisDomain!=null)return{domain:a.yAxisDomain}},l={x:{field:"x",type:a.xType,title:a.xLabel},tooltip:[{field:"x",type:"quantitative"},...s.map(m=>({field:m,type:"quantitative"}))]},c=s.map(m=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:m,type:a.yType,title:a.yLabel,scale:u()},color:{field:`${m}-name`,type:"nominal",legend:{values:s,title:null},scale:{range:a.seriesColors}}}})),f={mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}},h=d7t.getDrawArea(e),d={width:a.width||RQ.getDefaultWidth(h),height:a.height||RQ.getDefaultHeight(h),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},text:{fontSize:a.fontSize},legend:{labelFontSize:a.fontSize,titleFontSize:a.fontSize}},data:{values:o},encoding:l,layer:[...c,f]},p={actions:!1,mode:"vega-lite",defaultStyle:!1};return yield h7t.default(h,d,p),Promise.resolve()})}PO.linechart=p7t;const g7t={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11};var HW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var m7t=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},y7t=st&&st.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(HW,"__esModule",{value:!0});const b7t=y7t(ky),LQ=Xo,v7t=Dc,x7t=is;function w7t(e,t,n={}){return m7t(this,void 0,void 0,function*(){let r=t.values;const i=t.series==null?[]:t.series;r=Array.isArray(r[0])?r:[r];const s=[];r.forEach((h,d)=>{const p=i[d]!=null?i[d]:`Series ${d+1}`,m=h.map(g=>Object.assign({},g,{series:p}));s.push(...m)}),n.seriesColors!=null&&v7t.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const o=x7t.getDrawArea(e),a=Object.assign({},C7t,n),u={actions:!1,mode:"vega-lite",defaultStyle:!1},l=()=>{if(a.zoomToFit)return{zero:!1};if(a.xAxisDomain!=null)return{domain:a.xAxisDomain}},c=()=>{if(a.zoomToFit)return{zero:!1};if(a.yAxisDomain!=null)return{domain:a.yAxisDomain}},f={width:a.width||LQ.getDefaultWidth(o),height:a.height||LQ.getDefaultHeight(o),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},text:{fontSize:a.fontSize},legend:{labelFontSize:a.fontSize,titleFontSize:a.fontSize}},data:{values:s},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:a.xType,title:a.xLabel,scale:l()},y:{field:"y",type:a.yType,title:a.yLabel,scale:c()},color:{field:"series",type:"nominal",scale:{range:a.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield b7t.default(o,f,u),Promise.resolve()})}HW.scatterplot=w7t;const C7t={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11};var LO={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var p2e=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(LO,"__esModule",{value:!0});const S7t=PO,N4=is,g2e=Xo;function m2e(e,t,n,r={}){return p2e(this,void 0,void 0,function*(){const i=N4.getDrawArea(e),s={};for(const l of n)if(/val_/.test(l)){const c=l.replace("val_","");BQ(s,c);const f=zQ(t,l,n.indexOf(l));s[c].series.push(l),s[c].values.push(f)}else{const c=zQ(t,l,n.indexOf(l));BQ(s,l),s[l].series.push(l),s[l].values.push(c)}const o=Object.keys(s),a=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},r),u=[];for(const l of o){const c=g2e.subSurface(i,l),f=s[l].series,h=s[l].values;f.every(p=>!!p.match("acc"))&&(a.zoomToFitAccuracy?a.zoomToFit=!0:(a.yAxisDomain=[0,1],delete a.zoomToFit));const d=S7t.linechart(c,{values:h,series:f},a);u.push(d)}yield Promise.all(u)})}LO.history=m2e;function BQ(e,t){e[t]==null&&(e[t]={series:[],values:[]})}function zQ(e,t,n){if(Array.isArray(e)){const r=Array.isArray(e[0])?e[n]:e,i=[];for(let s=0;s<r.length;s++){const o=r[s];i.push({x:s,y:o[t]})}return i}else return e.history[t].map((r,i)=>({x:i,y:r}))}function _7t(e,t,n={}){const r={},i=n.callbacks||["onEpochEnd","onBatchEnd"],s=N4.getDrawArea(e),o=Object.assign({},n);delete o.callbacks;function a(l){return(c,f)=>p2e(this,void 0,void 0,function*(){/batch/i.test(l)?o.xLabel="Batch":/epoch/i.test(l)&&(o.xLabel="Epoch");const h=[],d=[];for(const m of t)if(f[m]!=null){d.push(m);const g=$7t(r,l,m);g.push({[m]:f[m]}),h.push(g)}const p=g2e.subSurface(s,l,{title:l});m2e(p,h,d,o),yield N4.nextFrame()})}const u={};return i.forEach(l=>{u[l]=a(l)}),u}LO.fitCallbacks=_7t;function $7t(e,t,n){return e[t]==null&&(e[t]={}),e[t][n]==null&&(e[t][n]=[]),e[t][n]}var BO={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var bA=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(BO,"__esModule",{value:!0});const k7t=cS,y2e=is,b2e=Ty,CM=Xo,E7t=gl;function A7t(e,t){return bA(this,void 0,void 0,function*(){const n=y2e.getDrawArea(e),r=D7t(t),i=["Layer Name","Output Shape","# Of Params","Trainable"],s=r.layers.map(o=>[o.name,o.outputShape,o.parameters,o.trainable]);b2e.table(n,{headers:i,values:s})})}BO.modelSummary=A7t;function T7t(e,t){return bA(this,void 0,void 0,function*(){const n=y2e.getDrawArea(e),r=yield F7t(t),i=["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],s=CM.subSurface(n,"layer-weights-info"),o=r.map(c=>[c.name,c.shape,c.stats.min,c.stats.max,c.weight.size,c.stats.numZeros,c.stats.numNans,c.stats.numInfs]);b2e.table(s,{headers:i,values:o});const a=CM.subSurface(n,"select-layer"),u=CM.subSurface(n,"param-distribution"),l=c=>bA(this,void 0,void 0,function*(){const h=yield r.filter(d=>d.name===c)[0].weight.data();k7t.histogram(u,h,{height:150,width:460,stats:!1})});O7t(r.map(c=>c.name),a,l)})}BO.layer=T7t;function D7t(e){return{layers:e.layers.map(I7t)}}function I7t(e){let t;return Array.isArray(e.outputShape[0])?t=`[${e.outputShape.map(r=>M4(r)).join(", ")}]`:t=M4(e.outputShape),{name:e.name,trainable:e.trainable,parameters:e.countParams(),outputShape:t}}function F7t(e){return bA(this,void 0,void 0,function*(){const t=e.getWeights(),n=e.weights,r=t.map(E7t.tensorStats),i=yield Promise.all(r),s=t.map(o=>o.shape);return t.map((o,a)=>({name:n[a].name,stats:i[a],shape:M4(s[a]),weight:o}))})}function M4(e){const t=e.slice();return t.length===0?"Scalar":(t[0]===null&&(t[0]="batch"),`[${t.join(",")}]`)}function O7t(e,t,n){const s=`<div><button>Show Values Distribution for:</button>${`
    <select>
      ${e.map(u=>`<option value=${u}>${u}</option>`)}
    </select>
  `}</div>`;t.innerHTML=s;const o=t.querySelector("button"),a=t.querySelector("select");o.addEventListener("click",()=>{n(a.selectedOptions[0].label)})}var qW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var N7t=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(qW,"__esModule",{value:!0});const M7t=is,R7t=Ty;function P7t(e,t,n){return N7t(this,void 0,void 0,function*(){const r=M7t.getDrawArea(e),i=["Class","Accuracy","# Samples"],s=[];for(let o=0;o<t.length;o++){const a=n?n[o]:o.toString(),u=t[o];s.push([a,u.accuracy,u.count])}return R7t.table(r,{headers:i,values:s})})}qW.perClassAccuracy=P7t;var XW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var L7t=st&&st.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(XW,"__esModule",{value:!0});const B7t=cS,z7t=is,j7t=gl;function U7t(e,t){return L7t(this,void 0,void 0,function*(){const n=z7t.getDrawArea(e),r=yield j7t.tensorStats(t),i=yield t.data();B7t.histogram(n,i,{height:150,stats:r})})}XW.valuesDistribution=U7t;var YW={};/** @license See the LICENSE file. */Object.defineProperty(YW,"__esModule",{value:!0});const W7t="1.5.1";YW.version=W7t;(function(e){function t(x){for(var v in x)e.hasOwnProperty(v)||(e[v]=x[v])}Object.defineProperty(e,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n=iz,r=LW,i=BW,s=cS,o=PO,a=HW,u=Ty,l=LO,c=BO,f=qW,h=XW,d=gl,p=YW;e.version_vis=p.version;const m={barchart:n.barchart,table:u.table,histogram:s.histogram,linechart:o.linechart,scatterplot:a.scatterplot,confusionMatrix:r.confusionMatrix,heatmap:i.heatmap};e.render=m;const g={accuracy:d.accuracy,perClassAccuracy:d.perClassAccuracy,confusionMatrix:d.confusionMatrix};e.metrics=g;const y={history:l.history,fitCallbacks:l.fitCallbacks,perClassAccuracy:f.perClassAccuracy,valuesDistribution:h.valuesDistribution,layer:c.layer,modelSummary:c.modelSummary};e.show=y;var b=lS;e.visor=b.visor,t(uS)})(nae);function V7t(e){let t,n,r,i,s,o,a;return t=new mGe({}),t.$on("imageData",e[1]),{c(){$2e(t.$$.fragment),n=m$(),r=gd("div"),i=VQ(e[0]),s=m$(),o=gd("div"),this.h()},l(u){k2e(t.$$.fragment,u),n=y$(u),r=md(u,"DIV",{});var l=yd(r);i=GQ(l,e[0]),l.forEach(go),s=y$(u),o=md(u,"DIV",{id:!0}),yd(o).forEach(go),this.h()},h(){Jo(o,"id","prediction")},m(u,l){E2e(t,u,l),gb(u,n,l),gb(u,r,l),Nc(r,i),gb(u,s,l),gb(u,o,l),a=!0},p(u,[l]){(!a||l&1)&&A2e(i,u[0])},i(u){a||(T2e(t.$$.fragment,u),a=!0)},o(u){D2e(t.$$.fragment,u),a=!1},d(u){I2e(t,u),u&&go(n),u&&go(r),u&&go(s),u&&go(o)}}}function G7t(e,t,n){let{data:r}=t,i=r.model,s;function o(a){console.log("got image");const u=a.detail.image,l=nne(u,1);n(0,s=ue(()=>ne(l,[1,28*28]).toFloat().div(255).mul(-1).add(1)));const c=xh(i.predict(s)).dataSync(),f=document.getElementById("prediction"),h=[];for(const[d,p]of c.entries())h.push({index:d,value:p});nae.render.barchart(f,h,{fontSize:20})}return e.$$set=a=>{"data"in a&&n(2,r=a.data)},[s,o,r]}class o9t extends jQ{constructor(t){super(),UQ(this,t,G7t,V7t,WQ,{data:2})}}export{o9t as component,r9t as universal};
