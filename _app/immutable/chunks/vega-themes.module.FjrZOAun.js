import{e as C4}from"./stores.0Q_cJDUb.js";/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var M4=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)r.hasOwnProperty(o)&&(i[o]=r[o])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),F4=Object.prototype.hasOwnProperty;function Z0(e,t){return F4.call(e,t)}function e1(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var i=[];for(var r in e)Z0(e,r)&&i.push(r);return i}function Mn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function t1(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function xs(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function JA(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function n1(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(n1(e[t]))return!0}else if(typeof e=="object"){for(var i=e1(e),r=i.length,o=0;o<r;o++)if(n1(e[i[o]]))return!0}}return!1}function N_(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r<"u"&&n.push(i+": "+r)}return n.join(`
`)}var QA=function(e){M4(t,e);function t(n,i,r,o,s){var a=this.constructor,u=e.call(this,N_(n,{name:i,index:r,operation:o,tree:s}))||this;return u.name=i,u.index=r,u.operation=o,u.tree=s,Object.setPrototypeOf(u,a.prototype),u.message=N_(n,{name:i,index:r,operation:o,tree:s}),u}return t}(Error),qe=QA,D4=Mn,Ua={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=Vd(n,this.path);i&&(i=Mn(i));var r=Ds(n,{op:"remove",path:this.from}).removed;return Ds(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=Vd(n,this.from);return Ds(n,{op:"add",path:this.path,value:Mn(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:gc(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},T4={add:function(e,t,n){return t1(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:Ua.move,copy:Ua.copy,test:Ua.test,_get:Ua._get};function Vd(e,t){if(t=="")return e;var n={op:"_get",path:t};return Ds(e,n),n.value}function Ds(e,t,n,i,r,o){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),o===void 0&&(o=0),n&&(typeof n=="function"?n(t,0,e,t.path):Xd(t,0)),t.path===""){var s={newDocument:e};if(t.op==="add")return s.newDocument=t.value,s;if(t.op==="replace")return s.newDocument=t.value,s.removed=e,s;if(t.op==="move"||t.op==="copy")return s.newDocument=Vd(e,t.from),t.op==="move"&&(s.removed=e),s;if(t.op==="test"){if(s.test=gc(e,t.value),s.test===!1)throw new qe("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return s.newDocument=e,s}else{if(t.op==="remove")return s.removed=e,s.newDocument=null,s;if(t.op==="_get")return t.value=e,s;if(n)throw new qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,t,e);return s}}else{i||(e=Mn(e));var a=t.path||"",u=a.split("/"),l=e,c=1,f=u.length,d=void 0,h=void 0,g=void 0;for(typeof n=="function"?g=n:g=Xd;;){if(h=u[c],h&&h.indexOf("~")!=-1&&(h=JA(h)),r&&(h=="__proto__"||h=="prototype"&&c>0&&u[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=u.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&g(t,0,e,d)),c++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!t1(h))throw new qe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,t,e);t1(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>l.length)throw new qe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,t,e);var s=T4[t.op].call(t,l,h,e);if(s.test===!1)throw new qe("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return s}}else if(c>=f){var s=Ua[t.op].call(t,l,h,e);if(s.test===!1)throw new qe("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return s}if(l=l[h],n&&c<f&&(!l||typeof l!="object"))throw new qe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,t,e)}}}function lb(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=Mn(e));for(var o=new Array(t.length),s=0,a=t.length;s<a;s++)o[s]=Ds(e,t[s],n,!0,r,s),e=o[s].newDocument;return o.newDocument=e,o}function N4(e,t,n){var i=Ds(e,t);if(i.test===!1)throw new qe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function Xd(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new qe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Ua[e.op]){if(typeof e.path!="string")throw new qe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new qe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new qe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&n1(e.value))throw new qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,o=i.split("/").length;if(r!==o+1&&r!==o)throw new qe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new qe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var s={op:"_get",path:e.from,value:void 0},a=ZA([s],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new qe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function ZA(e,t,n){try{if(!Array.isArray(e))throw new qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)lb(Mn(t),Mn(e),n||!0);else{n=n||Xd;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof qe)return r;throw r}}function gc(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,o,s;if(n&&i){if(o=e.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!gc(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var a=Object.keys(e);if(o=a.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!t.hasOwnProperty(a[r]))return!1;for(r=o;r--!==0;)if(s=a[r],!gc(e[s],t[s]))return!1;return!0}return e!==e&&t!==t}const O4=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:qe,_areEquals:gc,applyOperation:Ds,applyPatch:lb,applyReducer:N4,deepClone:D4,getValueByPointer:Vd,validate:ZA,validator:Xd},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var cb=new WeakMap,R4=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),z4=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function P4(e){return cb.get(e)}function L4(e,t){return e.observers.get(t)}function I4(e,t){e.observers.delete(t.callback)}function B4(e,t){t.unobserve()}function U4(e,t){var n=[],i,r=P4(e);if(!r)r=new R4(e),cb.set(e,r);else{var o=L4(r,t);i=o&&o.observer}if(i)return i;if(i={},r.value=Mn(e),t){i.callback=t,i.next=null;var s=function(){i1(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(s)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=n,i.object=e,i.unobserve=function(){i1(i),clearTimeout(i.next),I4(r,i),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(t,new z4(t,i)),i}function i1(e,t){t===void 0&&(t=!1);var n=cb.get(e.object);fb(n.value,e.object,e.patches,"",t),e.patches.length&&lb(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function fb(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var o=e1(t),s=e1(e),a=!1,u=s.length-1;u>=0;u--){var l=s[u],c=e[l];if(Z0(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null&&Array.isArray(c)===Array.isArray(f)?fb(c,f,n,i+"/"+xs(l),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+xs(l),value:Mn(c)}),n.push({op:"replace",path:i+"/"+xs(l),value:Mn(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+xs(l),value:Mn(c)}),n.push({op:"remove",path:i+"/"+xs(l)}),a=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!a&&o.length==s.length))for(var u=0;u<o.length;u++){var l=o[u];!Z0(e,l)&&t[l]!==void 0&&n.push({op:"add",path:i+"/"+xs(l),value:Mn(t[l])})}}}function j4(e,t,n){n===void 0&&(n=!1);var i=[];return fb(e,t,i,"",n),i}const q4=Object.freeze(Object.defineProperty({__proto__:null,compare:j4,generate:i1,observe:U4,unobserve:B4},Symbol.toStringTag,{value:"Module"}));Object.assign({},O4,q4,{JsonPatchError:QA,deepClone:Mn,escapePathComponent:xs,unescapePathComponent:JA});var W4=/("(?:[^\\"]|\\.)*")|[:,]/g,H4=function(t,n){var i,r,o;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,o=n.replacer,function s(a,u,l){var c,f,d,h,g,p,m,y,b,x,v,w;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),v=JSON.stringify(a,o),v===void 0)return v;if(m=r-u.length-l,v.length<=m&&(b=v.replace(W4,function(S,_){return _||S+" "}),b.length<=m))return b;if(o!=null&&(a=JSON.parse(v),o=void 0),typeof a=="object"&&a!==null){if(y=u+i,d=[],f=0,Array.isArray(a))for(x="[",c="]",m=a.length;f<m;f++)d.push(s(a[f],y,f===m-1?0:1)||"null");else for(x="{",c="}",p=Object.keys(a),m=p.length;f<m;f++)h=p[f],g=JSON.stringify(h)+": ",w=s(a[h],y,g.length+(f===m-1?0:1)),w!==void 0&&d.push(g+w);if(d.length>0)return[x,i+d.join(`,
`+y),c].join(`
`+u)}return v}(t,"",0)};const hfe=C4(H4);function Sn(e,t,n){return e.fields=t||[],e.fname=n,e}function Ge(e){return e==null?null:e.fname}function Pt(e){return e==null?null:e.fields}function eC(e){return e.length===1?G4(e[0]):Y4(e)}const G4=e=>function(t){return t[e]},Y4=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function O(e){throw Error(e)}function ar(e){const t=[],n=e.length;let i=null,r=0,o="",s,a,u;e=e+"";function l(){t.push(o+e.substring(s,a)),o="",s=a+1}for(s=a=0;a<n;++a)if(u=e[a],u==="\\")o+=e.substring(s,a++),s=a;else if(u===i)l(),i=null,r=-1;else{if(i)continue;s===r&&u==='"'||s===r&&u==="'"?(s=a+1,i=u):u==="."&&!r?a>s?l():s=a+1:u==="["?(a>s&&l(),r=s=a+1):u==="]"&&(r||O("Access path missing open bracket: "+e),r>0&&l(),r=0,s=a+1)}return r&&O("Access path missing closing bracket: "+e),i&&O("Access path missing closing quote: "+e),a>s&&(a++,l()),t}function Kn(e,t,n){const i=ar(e);return e=i.length===1?i[0]:e,Sn((n&&n.get||eC)(i),[e],t||e)}const Xc=Kn("id"),Ut=Sn(e=>e,[],"identity"),fo=Sn(()=>0,[],"zero"),Iu=Sn(()=>1,[],"one"),Jn=Sn(()=>!0,[],"true"),io=Sn(()=>!1,[],"false");function V4(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}const tC=0,db=1,hb=2,nC=3,iC=4;function gb(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:V4,i=e||tC;return{level(r){return arguments.length?(i=+r,this):i},error(){return i>=db&&n(t||"error","ERROR",arguments),this},warn(){return i>=hb&&n(t||"warn","WARN",arguments),this},info(){return i>=nC&&n(t||"log","INFO",arguments),this},debug(){return i>=iC&&n(t||"log","DEBUG",arguments),this}}}var z=Array.isArray;function G(e){return e===Object(e)}const O_=e=>e!=="__proto__";function Cg(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((i,r)=>{for(const o in r)if(o==="signals")i.signals=X4(i.signals,r.signals);else{const s=o==="legend"?{layout:1}:o==="style"?!0:null;Kc(i,o,r[o],s)}return i},{})}function Kc(e,t,n,i){if(!O_(t))return;let r,o;if(G(n)&&!z(n)){o=G(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?Kc(o,r,n[r]):O_(r)&&(o[r]=n[r])}else e[t]=n}function X4(e,t){if(e==null)return t;const n={},i=[];function r(o){n[o.name]||(n[o.name]=1,i.push(o))}return t.forEach(r),e.forEach(r),i}function ye(e){return e[e.length-1]}function Ot(e){return e==null||e===""?null:+e}const rC=e=>t=>e*Math.exp(t),oC=e=>t=>Math.log(e*t),sC=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),aC=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Kd=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Mg(e,t,n,i){const r=n(e[0]),o=n(ye(e)),s=(o-r)*t;return[i(r-s),i(o-s)]}function uC(e,t){return Mg(e,t,Ot,Ut)}function lC(e,t){var n=Math.sign(e[0]);return Mg(e,t,oC(n),rC(n))}function cC(e,t,n){return Mg(e,t,Kd(n),Kd(1/n))}function fC(e,t,n){return Mg(e,t,sC(n),aC(n))}function Fg(e,t,n,i,r){const o=i(e[0]),s=i(ye(e)),a=t!=null?i(t):(o+s)/2;return[r(a+(o-a)*n),r(a+(s-a)*n)]}function pb(e,t,n){return Fg(e,t,n,Ot,Ut)}function mb(e,t,n){const i=Math.sign(e[0]);return Fg(e,t,n,oC(i),rC(i))}function Jd(e,t,n,i){return Fg(e,t,n,Kd(i),Kd(1/i))}function yb(e,t,n,i){return Fg(e,t,n,sC(i),aC(i))}function dC(e){return 1+~~(new Date(e).getMonth()/3)}function hC(e){return 1+~~(new Date(e).getUTCMonth()/3)}function H(e){return e!=null?z(e)?e:[e]:[]}function gC(e,t,n){let i=e[0],r=e[1],o;return r<i&&(o=r,r=i,i=o),o=r-i,o>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-o),i+o]}function ue(e){return typeof e=="function"}const K4="descending";function bb(e,t,n){n=n||{},t=H(t)||[];const i=[],r=[],o={},s=n.comparator||J4;return H(e).forEach((a,u)=>{a!=null&&(i.push(t[u]===K4?-1:1),r.push(a=ue(a)?a:Kn(a,null,n)),(Pt(a)||[]).forEach(l=>o[l]=1))}),r.length===0?null:Sn(s(r,i),Object.keys(o))}const Dg=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),J4=(e,t)=>e.length===1?Q4(e[0],t[0]):Z4(e,t,e.length),Q4=(e,t)=>function(n,i){return Dg(e(n),e(i))*t},Z4=(e,t,n)=>(t.push(0),function(i,r){let o,s=0,a=-1;for(;s===0&&++a<n;)o=e[a],s=Dg(o(i),o(r));return s*t[a]});function jt(e){return ue(e)?e:()=>e}function xb(e,t){let n;return i=>{n&&clearTimeout(n),n=setTimeout(()=>(t(i),n=null),e)}}function ae(e){for(let t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function Qi(e,t){let n=0,i,r,o,s;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(o=s=r;n<i;++n)r=e[n],r!=null&&(r<o&&(o=r),r>s&&(s=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(o=s=r;n<i;++n)r=t(e[n]),r!=null&&(r<o&&(o=r),r>s&&(s=r))}return[o,s]}function pC(e,t){const n=e.length;let i=-1,r,o,s,a,u;if(t==null){for(;++i<n;)if(o=e[i],o!=null&&o>=o){r=s=o;break}if(i===n)return[-1,-1];for(a=u=i;++i<n;)o=e[i],o!=null&&(r>o&&(r=o,a=i),s<o&&(s=o,u=i))}else{for(;++i<n;)if(o=t(e[i],i,e),o!=null&&o>=o){r=s=o;break}if(i===n)return[-1,-1];for(a=u=i;++i<n;)o=t(e[i],i,e),o!=null&&(r>o&&(r=o,a=i),s<o&&(s=o,u=i))}return[a,u]}const e8=Object.prototype.hasOwnProperty;function ne(e,t){return e8.call(e,t)}const Bf={};function Bu(e){let t={},n;function i(o){return ne(t,o)&&t[o]!==Bf}const r={size:0,empty:0,object:t,has:i,get(o){return i(o)?t[o]:void 0},set(o,s){return i(o)||(++r.size,t[o]===Bf&&--r.empty),t[o]=s,this},delete(o){return i(o)&&(--r.size,++r.empty,t[o]=Bf),this},clear(){r.size=r.empty=0,r.object=t={}},test(o){return arguments.length?(n=o,r):n},clean(){const o={};let s=0;for(const a in t){const u=t[a];u!==Bf&&(!n||!n(u))&&(o[a]=u,++s)}r.size=s,r.empty=0,r.object=t=o}};return e&&Object.keys(e).forEach(o=>{r.set(o,e[o])}),r}function mC(e,t,n,i,r,o){if(!n&&n!==0)return o;const s=+n;let a=e[0],u=ye(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=s?i:c<=s?r:o}function U(e,t,n){const i=e.prototype=Object.create(t.prototype);return Object.defineProperty(i,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),ae(i,n)}function ja(e,t,n,i){let r=t[0],o=t[t.length-1],s;return r>o&&(s=r,r=o,o=s),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=o:e<o)}function ua(e){return typeof e=="boolean"}function _o(e){return Object.prototype.toString.call(e)==="[object Date]"}function yC(e){return e&&ue(e[Symbol.iterator])}function xe(e){return typeof e=="number"}function bC(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Y(e){return typeof e=="string"}function vb(e,t,n){e&&(e=t?H(e).map(a=>a.replace(/\\(.)/g,"$1")):H(e));const i=e&&e.length,r=n&&n.get||eC,o=a=>r(t?[a]:ar(a));let s;if(!i)s=function(){return""};else if(i===1){const a=o(e[0]);s=function(u){return""+a(u)}}else{const a=e.map(o);s=function(u){let l=""+a[0](u),c=0;for(;++c<i;)l+="|"+a[c](u);return l}}return Sn(s,e,"key")}function xC(e,t){const n=e[0],i=ye(e),r=+t;return r?r===1?i:n+r*(i-n):n}const t8=1e4;function vC(e){e=+e||t8;let t,n,i;const r=()=>{t={},n={},i=0},o=(s,a)=>(++i>e&&(n=t,t={},i=1),t[s]=a);return r(),{clear:r,has:s=>ne(t,s)||ne(n,s),get:s=>ne(t,s)?t[s]:ne(n,s)?o(s,n[s]):void 0,set:(s,a)=>ne(t,s)?t[s]=a:o(s,a)}}function wC(e,t,n,i){const r=t.length,o=n.length;if(!o)return t;if(!r)return n;const s=i||new t.constructor(r+o);let a=0,u=0,l=0;for(;a<r&&u<o;++l)s[l]=e(t[a],n[u])>0?n[u++]:t[a++];for(;a<r;++a,++l)s[l]=t[a];for(;u<o;++u,++l)s[l]=n[u];return s}function Dl(e,t){let n="";for(;--t>=0;)n+=e;return n}function _C(e,t,n,i){const r=n||" ",o=e+"",s=t-o.length;return s<=0?o:i==="left"?Dl(r,s)+o:i==="center"?Dl(r,~~(s/2))+o+Dl(r,Math.ceil(s/2)):o+Dl(r,s)}function Jc(e){return e&&ye(e)-e[0]||0}function j(e){return z(e)?"["+e.map(j)+"]":G(e)||Y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function wb(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const n8=e=>xe(e)||_o(e)?e:Date.parse(e);function _b(e,t){return t=t||n8,e==null||e===""?null:t(e)}function Sb(e){return e==null||e===""?null:e+""}function Si(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function SC(e,t,n,i){const r=i??"…",o=e+"",s=o.length,a=Math.max(0,t-r.length);return s<=t?o:n==="left"?r+o.slice(s-a):n==="center"?o.slice(0,Math.ceil(a/2))+r+o.slice(s-~~(a/2)):o.slice(0,a)+r}function so(e,t,n){if(e)if(t){const i=e.length;for(let r=0;r<i;++r){const o=t(e[r]);o&&n(o,r,e)}}else e.forEach(n)}var R_={},Nm={},Om=34,al=10,Rm=13;function EC(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function i8(e,t){var n=EC(e);return function(i,r){return t(n(i),r,e)}}function z_(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function ln(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function r8(e){return e<0?"-"+ln(-e,6):e>9999?"+"+ln(e,6):ln(e,4)}function o8(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":r8(e.getUTCFullYear())+"-"+ln(e.getUTCMonth()+1,2)+"-"+ln(e.getUTCDate(),2)+(r?"T"+ln(t,2)+":"+ln(n,2)+":"+ln(i,2)+"."+ln(r,3)+"Z":i?"T"+ln(t,2)+":"+ln(n,2)+":"+ln(i,2)+"Z":n||t?"T"+ln(t,2)+":"+ln(n,2)+"Z":"")}function s8(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,d){var h,g,p=r(f,function(m,y){if(h)return h(m,y-1);g=m,h=d?i8(m,d):EC(m)});return p.columns=g||[],p}function r(f,d){var h=[],g=f.length,p=0,m=0,y,b=g<=0,x=!1;f.charCodeAt(g-1)===al&&--g,f.charCodeAt(g-1)===Rm&&--g;function v(){if(b)return Nm;if(x)return x=!1,R_;var S,_=p,E;if(f.charCodeAt(_)===Om){for(;p++<g&&f.charCodeAt(p)!==Om||f.charCodeAt(++p)===Om;);return(S=p)>=g?b=!0:(E=f.charCodeAt(p++))===al?x=!0:E===Rm&&(x=!0,f.charCodeAt(p)===al&&++p),f.slice(_+1,S-1).replace(/""/g,'"')}for(;p<g;){if((E=f.charCodeAt(S=p++))===al)x=!0;else if(E===Rm)x=!0,f.charCodeAt(p)===al&&++p;else if(E!==n)continue;return f.slice(_,S)}return b=!0,f.slice(_,g)}for(;(y=v())!==Nm;){for(var w=[];y!==R_&&y!==Nm;)w.push(y),y=v();d&&(w=d(w,m++))==null||h.push(w)}return h}function o(f,d){return f.map(function(h){return d.map(function(g){return c(h[g])}).join(e)})}function s(f,d){return d==null&&(d=z_(f)),[d.map(c).join(e)].concat(o(f,d)).join(`
`)}function a(f,d){return d==null&&(d=z_(f)),o(f,d).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?o8(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:s,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function a8(e){return e}function u8(e){if(e==null)return a8;var t,n,i=e.scale[0],r=e.scale[1],o=e.translate[0],s=e.translate[1];return function(a,u){u||(t=n=0);var l=2,c=a.length,f=new Array(c);for(f[0]=(t+=a[0])*i+o,f[1]=(n+=a[1])*r+s;l<c;)f[l]=a[l],++l;return f}}function l8(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function c8(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return P_(e,n)})}:P_(e,t)}function P_(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,o=kC(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:o}:i==null?{type:"Feature",id:n,properties:r,geometry:o}:{type:"Feature",id:n,bbox:i,properties:r,geometry:o}}function kC(e,t){var n=u8(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var d=i[c<0?~c:c],h=0,g=d.length;h<g;++h)f.push(n(d[h],h));c<0&&l8(f,g)}function o(c){return n(c)}function s(c){for(var f=[],d=0,h=c.length;d<h;++d)r(c[d],f);return f.length<2&&f.push(f[0]),f}function a(c){for(var f=s(c);f.length<4;)f.push(f[0]);return f}function u(c){return c.map(a)}function l(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(l)};case"Point":d=o(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(o);break;case"LineString":d=s(c.arcs);break;case"MultiLineString":d=c.arcs.map(s);break;case"Polygon":d=u(c.arcs);break;case"MultiPolygon":d=c.arcs.map(u);break;default:return null}return{type:f,coordinates:d}}return l(t)}function f8(e,t){var n={},i={},r={},o=[],s=-1;t.forEach(function(l,c){var f=e.arcs[l<0?~l:l],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++s],t[s]=l,t[c]=d)}),t.forEach(function(l){var c=a(l),f=c[0],d=c[1],h,g;if(h=r[f])if(delete r[h.end],h.push(l),h.end=d,g=i[d]){delete i[g.start];var p=g===h?h:h.concat(g);i[p.start=h.start]=r[p.end=g.end]=p}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(l),h.start=f,g=r[f]){delete r[g.end];var m=g===h?h:g.concat(h);i[m.start=g.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[l],i[h.start=f]=r[h.end=d]=h});function a(l){var c=e.arcs[l<0?~l:l],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],l<0?[d,f]:[f,d]}function u(l,c){for(var f in l){var d=l[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),o.push(d)}}return u(r,i),u(i,r),t.forEach(function(l){n[l<0?~l:l]||o.push([l])}),o}function d8(e){return kC(e,h8.apply(this,arguments))}function h8(e,t,n){var i,r,o;if(arguments.length>1)i=g8(e,t,n);else for(r=0,i=new Array(o=e.arcs.length);r<o;++r)i[r]=r;return{type:"MultiLineString",arcs:f8(e,i)}}function g8(e,t,n){var i=[],r=[],o;function s(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:o})}function a(f){f.forEach(s)}function u(f){f.forEach(a)}function l(f){f.forEach(u)}function c(f){switch(o=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":a(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":l(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}function Or(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function p8(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Uu(e){let t,n,i;e.length!==2?(t=Or,n=(a,u)=>Or(e(a),u),i=(a,u)=>e(a)-u):(t=e===Or||e===p8?e:m8,n=e,i=e);function r(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){const f=r(a,u,l,c-1);return f>l&&i(a[f-1],u)>-i(a[f],u)?f-1:f}return{left:r,center:s,right:o}}function m8(){return 0}function $C(e){return e===null?NaN:+e}function*y8(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}const AC=Uu(Or),Co=AC.right,b8=AC.left;Uu($C).center;function x8(e,t){let n=0,i,r=0,o=0;if(t===void 0)for(let s of e)s!=null&&(s=+s)>=s&&(i=s-r,r+=i/++n,o+=i*(s-r));else{let s=-1;for(let a of e)(a=t(a,++s,e))!=null&&(a=+a)>=a&&(i=a-r,r+=i/++n,o+=i*(a-r))}if(n>1)return o/(n-1)}function v8(e,t){const n=x8(e,t);return n&&Math.sqrt(n)}class en{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const o=n[r],s=t+o,a=Math.abs(t)<Math.abs(o)?t-(s-o):o-(s-t);a&&(n[i++]=a),t=s}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n=this._n,i,r,o,s=0;if(n>0){for(s=t[--n];n>0&&(i=s,r=t[--n],s=i+r,o=r-(s-i),!o););n>0&&(o<0&&t[n-1]<0||o>0&&t[n-1]>0)&&(r=o*2,i=s+r,r==i-s&&(s=i))}return s}}class L_ extends Map{constructor(t,n=FC){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(r1(this,t))}has(t){return super.has(r1(this,t))}set(t,n){return super.set(CC(this,t),n)}delete(t){return super.delete(MC(this,t))}}class Qd extends Set{constructor(t,n=FC){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const i of t)this.add(i)}has(t){return super.has(r1(this,t))}add(t){return super.add(CC(this,t))}delete(t){return super.delete(MC(this,t))}}function r1({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function CC({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function MC({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function FC(e){return e!==null&&typeof e=="object"?e.valueOf():e}function w8(e,t){return Array.from(t,n=>e[n])}function _8(e=Or){if(e===Or)return DC;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const i=e(t,n);return i||i===0?i:(e(n,n)===0)-(e(t,t)===0)}}function DC(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const S8=Math.sqrt(50),E8=Math.sqrt(10),k8=Math.sqrt(2);function Zd(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),s=o>=S8?10:o>=E8?5:o>=k8?2:1;let a,u,l;return r<0?(l=Math.pow(10,-r)/s,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,r)*s,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?Zd(e,t,n*2):[a,u,l]}function o1(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,o,s]=i?Zd(t,e,n):Zd(e,t,n);if(!(o>=r))return[];const a=o-r+1,u=new Array(a);if(i)if(s<0)for(let l=0;l<a;++l)u[l]=(o-l)/-s;else for(let l=0;l<a;++l)u[l]=(o-l)*s;else if(s<0)for(let l=0;l<a;++l)u[l]=(r+l)/-s;else for(let l=0;l<a;++l)u[l]=(r+l)*s;return u}function s1(e,t,n){return t=+t,e=+e,n=+n,Zd(e,t,n)[2]}function Mo(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?s1(t,e,n):s1(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function Ts(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function a1(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function TC(e,t,n=0,i=1/0,r){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(e.length-1,i)),!(n<=t&&t<=i))return e;for(r=r===void 0?DC:_8(r);i>n;){if(i-n>600){const u=i-n+1,l=t-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),h=Math.max(n,Math.floor(t-l*f/u+d)),g=Math.min(i,Math.floor(t+(u-l)*f/u+d));TC(e,t,h,g,r)}const o=e[t];let s=n,a=i;for(ul(e,n,t),r(e[i],o)>0&&ul(e,n,i);s<a;){for(ul(e,s,a),++s,--a;r(e[s],o)<0;)++s;for(;r(e[a],o)>0;)--a}r(e[n],o)===0?ul(e,n,a):(++a,ul(e,a,i)),a<=t&&(n=a+1),t<=a&&(i=a-1)}return e}function ul(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function u1(e,t,n){if(e=Float64Array.from(y8(e,n)),!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return a1(e);if(t>=1)return Ts(e);var i,r=(i-1)*t,o=Math.floor(r),s=Ts(TC(e,o).subarray(0,o+1)),a=a1(e.subarray(o+1));return s+(a-s)*(r-o)}}function NC(e,t,n=$C){if(!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,o=Math.floor(r),s=+n(e[o],o,e),a=+n(e[o+1],o+1,e);return s+(a-s)*(r-o)}}function $8(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(o=+o)>=o&&(++n,i+=o)}if(n)return i/n}function OC(e,t){return u1(e,.5,t)}function*A8(e){for(const t of e)yield*t}function RC(e){return Array.from(A8(e))}function Fn(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(r);++i<r;)o[i]=e+i*n;return o}function zC(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function C8(e,...t){e=new Qd(e),t=t.map(M8);e:for(const n of e)for(const i of t)if(!i.has(n)){e.delete(n);continue e}return e}function M8(e){return e instanceof Qd?e:new Qd(e)}function F8(...e){const t=new Qd;for(const n of e)for(const i of n)t.add(i);return t}function D8(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function eh(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function ru(e){return e=eh(Math.abs(e)),e?e[1]:NaN}function T8(e,t){return function(n,i){for(var r=n.length,o=[],s=0,a=e[0],u=0;r>0&&a>0&&(u+a+1>i&&(a=Math.max(1,i-u)),o.push(n.substring(r-=a,r+a)),!((u+=a+1)>i));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function N8(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var O8=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pc(e){if(!(t=O8.exec(e)))throw new Error("invalid format: "+e);var t;return new Eb({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}pc.prototype=Eb.prototype;function Eb(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Eb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function R8(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var PC;function z8(e,t){var n=eh(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(PC=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+eh(e,Math.max(0,t+o-1))[0]}function I_(e,t){var n=eh(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const B_={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:D8,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>I_(e*100,t),r:I_,s:z8,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function U_(e){return e}var j_=Array.prototype.map,q_=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function LC(e){var t=e.grouping===void 0||e.thousands===void 0?U_:T8(j_.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?U_:N8(j_.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=pc(f);var d=f.fill,h=f.align,g=f.sign,p=f.symbol,m=f.zero,y=f.width,b=f.comma,x=f.precision,v=f.trim,w=f.type;w==="n"?(b=!0,w="g"):B_[w]||(x===void 0&&(x=12),v=!0,w="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var S=p==="$"?n:p==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",_=p==="$"?i:/[%p]/.test(w)?s:"",E=B_[w],A=/[defgprs%]/.test(w);x=x===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function k($){var T=S,M=_,D,C,R;if(w==="c")M=E($)+M,$="";else{$=+$;var W=$<0||1/$<0;if($=isNaN($)?u:E(Math.abs($),x),v&&($=R8($)),W&&+$==0&&g!=="+"&&(W=!1),T=(W?g==="("?g:a:g==="-"||g==="("?"":g)+T,M=(w==="s"?q_[8+PC/3]:"")+M+(W&&g==="("?")":""),A){for(D=-1,C=$.length;++D<C;)if(R=$.charCodeAt(D),48>R||R>57){M=(R===46?r+$.slice(D+1):$.slice(D))+M,$=$.slice(0,D);break}}}b&&!m&&($=t($,1/0));var V=T.length+$.length+M.length,J=V<y?new Array(y-V+1).join(d):"";switch(b&&m&&($=t(J+$,J.length?y-M.length:1/0),J=""),h){case"<":$=T+$+M+J;break;case"=":$=T+J+$+M;break;case"^":$=J.slice(0,V=J.length>>1)+T+$+M+J.slice(V);break;default:$=J+T+$+M;break}return o($)}return k.toString=function(){return f+""},k}function c(f,d){var h=l((f=pc(f),f.type="f",f)),g=Math.max(-8,Math.min(8,Math.floor(ru(d)/3)))*3,p=Math.pow(10,-g),m=q_[8+g/3];return function(y){return h(p*y)+m}}return{format:l,formatPrefix:c}}var Uf,IC,BC;P8({thousands:",",grouping:[3],currency:["$",""]});function P8(e){return Uf=LC(e),IC=Uf.format,BC=Uf.formatPrefix,Uf}function L8(e){return Math.max(0,-ru(Math.abs(e)))}function I8(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ru(t)/3)))*3-ru(Math.abs(e)))}function B8(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,ru(t)-ru(e))+1}const zm=new Date,Pm=new Date;function ot(e,t,n,i){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=o=>(e(o=new Date(+o)),o),r.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),r.round=o=>{const s=r(o),a=r.ceil(o);return o-s<a-o?s:a},r.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),r.range=(o,s,a)=>{const u=[];if(o=r.ceil(o),a=a==null?1:Math.floor(a),!(o<s)||!(a>0))return u;let l;do u.push(l=new Date(+o)),t(o,a),e(o);while(l<o&&o<s);return u},r.filter=o=>ot(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;t(s,-1),!o(s););else for(;--a>=0;)for(;t(s,1),!o(s););}),n&&(r.count=(o,s)=>(zm.setTime(+o),Pm.setTime(+s),e(zm),e(Pm),Math.floor(n(zm,Pm))),r.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(i?s=>i(s)%o===0:s=>r.count(0,s)%o===0):r)),r}const ou=ot(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);ou.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ot(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):ou);ou.range;const Cr=1e3,Wn=Cr*60,Mr=Wn*60,Ur=Mr*24,kb=Ur*7,W_=Ur*30,Lm=Ur*365,Fr=ot(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Cr)},(e,t)=>(t-e)/Cr,e=>e.getUTCSeconds());Fr.range;const Tg=ot(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Cr)},(e,t)=>{e.setTime(+e+t*Wn)},(e,t)=>(t-e)/Wn,e=>e.getMinutes());Tg.range;const Ng=ot(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Wn)},(e,t)=>(t-e)/Wn,e=>e.getUTCMinutes());Ng.range;const Og=ot(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Cr-e.getMinutes()*Wn)},(e,t)=>{e.setTime(+e+t*Mr)},(e,t)=>(t-e)/Mr,e=>e.getHours());Og.range;const Rg=ot(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Mr)},(e,t)=>(t-e)/Mr,e=>e.getUTCHours());Rg.range;const Rr=ot(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Wn)/Ur,e=>e.getDate()-1);Rr.range;const So=ot(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ur,e=>e.getUTCDate()-1);So.range;const UC=ot(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ur,e=>Math.floor(e/Ur));UC.range;function la(e){return ot(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Wn)/kb)}const ju=la(0),th=la(1),U8=la(2),j8=la(3),su=la(4),q8=la(5),W8=la(6);ju.range;th.range;U8.range;j8.range;su.range;q8.range;W8.range;function ca(e){return ot(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/kb)}const qu=ca(0),nh=ca(1),H8=ca(2),G8=ca(3),au=ca(4),Y8=ca(5),V8=ca(6);qu.range;nh.range;H8.range;G8.range;au.range;Y8.range;V8.range;const mc=ot(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());mc.range;const yc=ot(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());yc.range;const Zi=ot(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Zi.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ot(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Zi.range;const er=ot(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());er.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ot(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});er.range;function jC(e,t,n,i,r,o){const s=[[Fr,1,Cr],[Fr,5,5*Cr],[Fr,15,15*Cr],[Fr,30,30*Cr],[o,1,Wn],[o,5,5*Wn],[o,15,15*Wn],[o,30,30*Wn],[r,1,Mr],[r,3,3*Mr],[r,6,6*Mr],[r,12,12*Mr],[i,1,Ur],[i,2,2*Ur],[n,1,kb],[t,1,W_],[t,3,3*W_],[e,1,Lm]];function a(l,c,f){const d=c<l;d&&([l,c]=[c,l]);const h=f&&typeof f.range=="function"?f:u(l,c,f),g=h?h.range(l,+c+1):[];return d?g.reverse():g}function u(l,c,f){const d=Math.abs(c-l)/f,h=Uu(([,,m])=>m).right(s,d);if(h===s.length)return e.every(Mo(l/Lm,c/Lm,f));if(h===0)return ou.every(Math.max(Mo(l,c,f),1));const[g,p]=s[d/s[h-1][2]<s[h][2]/d?h-1:h];return g.every(p)}return[a,u]}const[X8,K8]=jC(er,yc,qu,UC,Rg,Ng),[J8,Q8]=jC(Zi,mc,ju,Rr,Og,Tg),St="year",yn="quarter",Lt="month",nt="week",bn="date",Nt="day",tr="dayofyear",On="hours",Rn="minutes",Qn="seconds",Ei="milliseconds",$b=[St,yn,Lt,nt,bn,Nt,tr,On,Rn,Qn,Ei],Im=$b.reduce((e,t,n)=>(e[t]=1+n,e),{});function Ab(e){const t=H(e).slice(),n={};return t.length||O("Missing time unit."),t.forEach(r=>{ne(Im,r)?n[r]=1:O(`Invalid time unit: ${r}.`)}),(n[nt]||n[Nt]?1:0)+(n[yn]||n[Lt]||n[bn]?1:0)+(n[tr]?1:0)>1&&O(`Incompatible time units: ${e}`),t.sort((r,o)=>Im[r]-Im[o]),t}const Z8={[St]:"%Y ",[yn]:"Q%q ",[Lt]:"%b ",[bn]:"%d ",[nt]:"W%U ",[Nt]:"%a ",[tr]:"%j ",[On]:"%H:00",[Rn]:"00:%M",[Qn]:":%S",[Ei]:".%L",[`${St}-${Lt}`]:"%Y-%m ",[`${St}-${Lt}-${bn}`]:"%Y-%m-%d ",[`${On}-${Rn}`]:"%H:%M"};function qC(e,t){const n=ae({},Z8,t),i=Ab(e),r=i.length;let o="",s=0,a,u;for(s=0;s<r;)for(a=i.length;a>s;--a)if(u=i.slice(s,a).join("-"),n[u]!=null){o+=n[u],s=a;break}return o.trim()}const _s=new Date;function Cb(e){return _s.setFullYear(e),_s.setMonth(0),_s.setDate(1),_s.setHours(0,0,0,0),_s}function WC(e){return GC(new Date(e))}function HC(e){return l1(new Date(e))}function GC(e){return Rr.count(Cb(e.getFullYear())-1,e)}function l1(e){return ju.count(Cb(e.getFullYear())-1,e)}function c1(e){return Cb(e).getDay()}function ez(e,t,n,i,r,o,s){if(0<=e&&e<100){const a=new Date(-1,t,n,i,r,o,s);return a.setFullYear(e),a}return new Date(e,t,n,i,r,o,s)}function YC(e){return XC(new Date(e))}function VC(e){return f1(new Date(e))}function XC(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return So.count(t-1,e)}function f1(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return qu.count(t-1,e)}function d1(e){return _s.setTime(Date.UTC(e,0,1)),_s.getUTCDay()}function tz(e,t,n,i,r,o,s){if(0<=e&&e<100){const a=new Date(Date.UTC(-1,t,n,i,r,o,s));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(e,t,n,i,r,o,s))}function KC(e,t,n,i,r){const o=t||1,s=ye(e),a=(y,b,x)=>(x=x||y,nz(n[x],i[x],y===s&&o,b)),u=new Date,l=Si(e),c=l[St]?a(St):jt(2012),f=l[Lt]?a(Lt):l[yn]?a(yn):fo,d=l[nt]&&l[Nt]?a(Nt,1,nt+Nt):l[nt]?a(nt,1):l[Nt]?a(Nt,1):l[bn]?a(bn,1):l[tr]?a(tr,1):Iu,h=l[On]?a(On):fo,g=l[Rn]?a(Rn):fo,p=l[Qn]?a(Qn):fo,m=l[Ei]?a(Ei):fo;return function(y){u.setTime(+y);const b=c(u);return r(b,f(u),d(u,b),h(u),g(u),p(u),m(u))}}function nz(e,t,n,i){const r=n<=1?e:i?(o,s)=>i+n*Math.floor((e(o,s)-i)/n):(o,s)=>n*Math.floor(e(o,s)/n);return t?(o,s)=>t(r(o,s),s):r}function uu(e,t,n){return t+e*7-(n+6)%7}const iz={[St]:e=>e.getFullYear(),[yn]:e=>Math.floor(e.getMonth()/3),[Lt]:e=>e.getMonth(),[bn]:e=>e.getDate(),[On]:e=>e.getHours(),[Rn]:e=>e.getMinutes(),[Qn]:e=>e.getSeconds(),[Ei]:e=>e.getMilliseconds(),[tr]:e=>GC(e),[nt]:e=>l1(e),[nt+Nt]:(e,t)=>uu(l1(e),e.getDay(),c1(t)),[Nt]:(e,t)=>uu(1,e.getDay(),c1(t))},rz={[yn]:e=>3*e,[nt]:(e,t)=>uu(e,0,c1(t))};function JC(e,t){return KC(e,t||1,iz,rz,ez)}const oz={[St]:e=>e.getUTCFullYear(),[yn]:e=>Math.floor(e.getUTCMonth()/3),[Lt]:e=>e.getUTCMonth(),[bn]:e=>e.getUTCDate(),[On]:e=>e.getUTCHours(),[Rn]:e=>e.getUTCMinutes(),[Qn]:e=>e.getUTCSeconds(),[Ei]:e=>e.getUTCMilliseconds(),[tr]:e=>XC(e),[nt]:e=>f1(e),[Nt]:(e,t)=>uu(1,e.getUTCDay(),d1(t)),[nt+Nt]:(e,t)=>uu(f1(e),e.getUTCDay(),d1(t))},sz={[yn]:e=>3*e,[nt]:(e,t)=>uu(e,0,d1(t))};function QC(e,t){return KC(e,t||1,oz,sz,tz)}const az={[St]:Zi,[yn]:mc.every(3),[Lt]:mc,[nt]:ju,[bn]:Rr,[Nt]:Rr,[tr]:Rr,[On]:Og,[Rn]:Tg,[Qn]:Fr,[Ei]:ou},uz={[St]:er,[yn]:yc.every(3),[Lt]:yc,[nt]:qu,[bn]:So,[Nt]:So,[tr]:So,[On]:Rg,[Rn]:Ng,[Qn]:Fr,[Ei]:ou};function Wu(e){return az[e]}function Hu(e){return uz[e]}function ZC(e,t,n){return e?e.offset(t,n):void 0}function eM(e,t,n){return ZC(Wu(e),t,n)}function tM(e,t,n){return ZC(Hu(e),t,n)}function nM(e,t,n,i){return e?e.range(t,n,i):void 0}function iM(e,t,n,i){return nM(Wu(e),t,n,i)}function rM(e,t,n,i){return nM(Hu(e),t,n,i)}const Tl=1e3,Nl=Tl*60,Ol=Nl*60,zg=Ol*24,lz=zg*7,H_=zg*30,h1=zg*365,oM=[St,Lt,bn,On,Rn,Qn,Ei],Rl=oM.slice(0,-1),zl=Rl.slice(0,-1),Pl=zl.slice(0,-1),cz=Pl.slice(0,-1),fz=[St,nt],G_=[St,Lt],sM=[St],ll=[[Rl,1,Tl],[Rl,5,5*Tl],[Rl,15,15*Tl],[Rl,30,30*Tl],[zl,1,Nl],[zl,5,5*Nl],[zl,15,15*Nl],[zl,30,30*Nl],[Pl,1,Ol],[Pl,3,3*Ol],[Pl,6,6*Ol],[Pl,12,12*Ol],[cz,1,zg],[fz,1,lz],[G_,1,H_],[G_,3,3*H_],[sM,1,h1]];function aM(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(Jc(t))/n;let r=Uu(a=>a[2]).right(ll,i),o,s;return r===ll.length?(o=sM,s=Mo(t[0]/h1,t[1]/h1,n)):r?(r=ll[i/ll[r-1][2]<ll[r][2]/i?r-1:r],o=r[0],s=r[1]):(o=oM,s=Math.max(Mo(t[0],t[1],n),1)),{units:o,step:s}}function Bm(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Um(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function cl(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function uM(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,o=e.days,s=e.shortDays,a=e.months,u=e.shortMonths,l=fl(r),c=dl(r),f=fl(o),d=dl(o),h=fl(s),g=dl(s),p=fl(a),m=dl(a),y=fl(u),b=dl(u),x={a:W,A:V,b:J,B:he,c:null,d:Q_,e:Q_,f:Oz,g:Wz,G:Gz,H:Dz,I:Tz,j:Nz,L:lM,m:Rz,M:zz,p:Be,q:Ze,Q:tS,s:nS,S:Pz,u:Lz,U:Iz,V:Bz,w:Uz,W:jz,x:null,X:null,y:qz,Y:Hz,Z:Yz,"%":eS},v={a:at,A:qt,b:Je,B:to,c:null,d:Z_,e:Z_,f:Jz,g:aP,G:lP,H:Vz,I:Xz,j:Kz,L:fM,m:Qz,M:Zz,p:$a,q:as,Q:tS,s:nS,S:eP,u:tP,U:nP,V:iP,w:rP,W:oP,x:null,X:null,y:sP,Y:uP,Z:cP,"%":eS},w={a:k,A:$,b:T,B:M,c:D,d:K_,e:K_,f:Az,g:X_,G:V_,H:J_,I:J_,j:Sz,L:$z,m:_z,M:Ez,p:A,q:wz,Q:Mz,s:Fz,S:kz,u:mz,U:yz,V:bz,w:pz,W:xz,x:C,X:R,y:X_,Y:V_,Z:vz,"%":Cz};x.x=S(n,x),x.X=S(i,x),x.c=S(t,x),v.x=S(n,v),v.X=S(i,v),v.c=S(t,v);function S(X,le){return function(fe){var B=[],xt=-1,Se=0,At=X.length,Wt,us,T_;for(fe instanceof Date||(fe=new Date(+fe));++xt<At;)X.charCodeAt(xt)===37&&(B.push(X.slice(Se,xt)),(us=Y_[Wt=X.charAt(++xt)])!=null?Wt=X.charAt(++xt):us=Wt==="e"?" ":"0",(T_=le[Wt])&&(Wt=T_(fe,us)),B.push(Wt),Se=xt+1);return B.push(X.slice(Se,xt)),B.join("")}}function _(X,le){return function(fe){var B=cl(1900,void 0,1),xt=E(B,X,fe+="",0),Se,At;if(xt!=fe.length)return null;if("Q"in B)return new Date(B.Q);if("s"in B)return new Date(B.s*1e3+("L"in B?B.L:0));if(le&&!("Z"in B)&&(B.Z=0),"p"in B&&(B.H=B.H%12+B.p*12),B.m===void 0&&(B.m="q"in B?B.q:0),"V"in B){if(B.V<1||B.V>53)return null;"w"in B||(B.w=1),"Z"in B?(Se=Um(cl(B.y,0,1)),At=Se.getUTCDay(),Se=At>4||At===0?nh.ceil(Se):nh(Se),Se=So.offset(Se,(B.V-1)*7),B.y=Se.getUTCFullYear(),B.m=Se.getUTCMonth(),B.d=Se.getUTCDate()+(B.w+6)%7):(Se=Bm(cl(B.y,0,1)),At=Se.getDay(),Se=At>4||At===0?th.ceil(Se):th(Se),Se=Rr.offset(Se,(B.V-1)*7),B.y=Se.getFullYear(),B.m=Se.getMonth(),B.d=Se.getDate()+(B.w+6)%7)}else("W"in B||"U"in B)&&("w"in B||(B.w="u"in B?B.u%7:"W"in B?1:0),At="Z"in B?Um(cl(B.y,0,1)).getUTCDay():Bm(cl(B.y,0,1)).getDay(),B.m=0,B.d="W"in B?(B.w+6)%7+B.W*7-(At+5)%7:B.w+B.U*7-(At+6)%7);return"Z"in B?(B.H+=B.Z/100|0,B.M+=B.Z%100,Um(B)):Bm(B)}}function E(X,le,fe,B){for(var xt=0,Se=le.length,At=fe.length,Wt,us;xt<Se;){if(B>=At)return-1;if(Wt=le.charCodeAt(xt++),Wt===37){if(Wt=le.charAt(xt++),us=w[Wt in Y_?le.charAt(xt++):Wt],!us||(B=us(X,fe,B))<0)return-1}else if(Wt!=fe.charCodeAt(B++))return-1}return B}function A(X,le,fe){var B=l.exec(le.slice(fe));return B?(X.p=c.get(B[0].toLowerCase()),fe+B[0].length):-1}function k(X,le,fe){var B=h.exec(le.slice(fe));return B?(X.w=g.get(B[0].toLowerCase()),fe+B[0].length):-1}function $(X,le,fe){var B=f.exec(le.slice(fe));return B?(X.w=d.get(B[0].toLowerCase()),fe+B[0].length):-1}function T(X,le,fe){var B=y.exec(le.slice(fe));return B?(X.m=b.get(B[0].toLowerCase()),fe+B[0].length):-1}function M(X,le,fe){var B=p.exec(le.slice(fe));return B?(X.m=m.get(B[0].toLowerCase()),fe+B[0].length):-1}function D(X,le,fe){return E(X,t,le,fe)}function C(X,le,fe){return E(X,n,le,fe)}function R(X,le,fe){return E(X,i,le,fe)}function W(X){return s[X.getDay()]}function V(X){return o[X.getDay()]}function J(X){return u[X.getMonth()]}function he(X){return a[X.getMonth()]}function Be(X){return r[+(X.getHours()>=12)]}function Ze(X){return 1+~~(X.getMonth()/3)}function at(X){return s[X.getUTCDay()]}function qt(X){return o[X.getUTCDay()]}function Je(X){return u[X.getUTCMonth()]}function to(X){return a[X.getUTCMonth()]}function $a(X){return r[+(X.getUTCHours()>=12)]}function as(X){return 1+~~(X.getUTCMonth()/3)}return{format:function(X){var le=S(X+="",x);return le.toString=function(){return X},le},parse:function(X){var le=_(X+="",!1);return le.toString=function(){return X},le},utcFormat:function(X){var le=S(X+="",v);return le.toString=function(){return X},le},utcParse:function(X){var le=_(X+="",!0);return le.toString=function(){return X},le}}}var Y_={"-":"",_:" ",0:"0"},yt=/^\s*\d+/,dz=/^%/,hz=/[\\^$*+?|[\]().{}]/g;function we(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",o=r.length;return i+(o<n?new Array(n-o+1).join(t)+r:r)}function gz(e){return e.replace(hz,"\\$&")}function fl(e){return new RegExp("^(?:"+e.map(gz).join("|")+")","i")}function dl(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function pz(e,t,n){var i=yt.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function mz(e,t,n){var i=yt.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function yz(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function bz(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function xz(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function V_(e,t,n){var i=yt.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function X_(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function vz(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function wz(e,t,n){var i=yt.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function _z(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function K_(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function Sz(e,t,n){var i=yt.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function J_(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function Ez(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function kz(e,t,n){var i=yt.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function $z(e,t,n){var i=yt.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function Az(e,t,n){var i=yt.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function Cz(e,t,n){var i=dz.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function Mz(e,t,n){var i=yt.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function Fz(e,t,n){var i=yt.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function Q_(e,t){return we(e.getDate(),t,2)}function Dz(e,t){return we(e.getHours(),t,2)}function Tz(e,t){return we(e.getHours()%12||12,t,2)}function Nz(e,t){return we(1+Rr.count(Zi(e),e),t,3)}function lM(e,t){return we(e.getMilliseconds(),t,3)}function Oz(e,t){return lM(e,t)+"000"}function Rz(e,t){return we(e.getMonth()+1,t,2)}function zz(e,t){return we(e.getMinutes(),t,2)}function Pz(e,t){return we(e.getSeconds(),t,2)}function Lz(e){var t=e.getDay();return t===0?7:t}function Iz(e,t){return we(ju.count(Zi(e)-1,e),t,2)}function cM(e){var t=e.getDay();return t>=4||t===0?su(e):su.ceil(e)}function Bz(e,t){return e=cM(e),we(su.count(Zi(e),e)+(Zi(e).getDay()===4),t,2)}function Uz(e){return e.getDay()}function jz(e,t){return we(th.count(Zi(e)-1,e),t,2)}function qz(e,t){return we(e.getFullYear()%100,t,2)}function Wz(e,t){return e=cM(e),we(e.getFullYear()%100,t,2)}function Hz(e,t){return we(e.getFullYear()%1e4,t,4)}function Gz(e,t){var n=e.getDay();return e=n>=4||n===0?su(e):su.ceil(e),we(e.getFullYear()%1e4,t,4)}function Yz(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+we(t/60|0,"0",2)+we(t%60,"0",2)}function Z_(e,t){return we(e.getUTCDate(),t,2)}function Vz(e,t){return we(e.getUTCHours(),t,2)}function Xz(e,t){return we(e.getUTCHours()%12||12,t,2)}function Kz(e,t){return we(1+So.count(er(e),e),t,3)}function fM(e,t){return we(e.getUTCMilliseconds(),t,3)}function Jz(e,t){return fM(e,t)+"000"}function Qz(e,t){return we(e.getUTCMonth()+1,t,2)}function Zz(e,t){return we(e.getUTCMinutes(),t,2)}function eP(e,t){return we(e.getUTCSeconds(),t,2)}function tP(e){var t=e.getUTCDay();return t===0?7:t}function nP(e,t){return we(qu.count(er(e)-1,e),t,2)}function dM(e){var t=e.getUTCDay();return t>=4||t===0?au(e):au.ceil(e)}function iP(e,t){return e=dM(e),we(au.count(er(e),e)+(er(e).getUTCDay()===4),t,2)}function rP(e){return e.getUTCDay()}function oP(e,t){return we(nh.count(er(e)-1,e),t,2)}function sP(e,t){return we(e.getUTCFullYear()%100,t,2)}function aP(e,t){return e=dM(e),we(e.getUTCFullYear()%100,t,2)}function uP(e,t){return we(e.getUTCFullYear()%1e4,t,4)}function lP(e,t){var n=e.getUTCDay();return e=n>=4||n===0?au(e):au.ceil(e),we(e.getUTCFullYear()%1e4,t,4)}function cP(){return"+0000"}function eS(){return"%"}function tS(e){return+e}function nS(e){return Math.floor(+e/1e3)}var Aa,Mb,hM,Fb,gM;fP({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function fP(e){return Aa=uM(e),Mb=Aa.format,hM=Aa.parse,Fb=Aa.utcFormat,gM=Aa.utcParse,Aa}function Ll(e){const t={};return n=>t[n]||(t[n]=e(n))}function dP(e,t){return n=>{const i=e(n),r=i.indexOf(t);if(r<0)return i;let o=hP(i,r);const s=o<i.length?i.slice(o):"";for(;--o>r;)if(i[o]!=="0"){++o;break}return i.slice(0,o)+s}}function hP(e,t){let n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function pM(e){const t=Ll(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){const r=pc(i||",");if(r.precision==null){switch(r.precision=12,r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return dP(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,o,s){s=pc(s??",f");const a=Mo(i,r,o),u=Math.max(Math.abs(i),Math.abs(r));let l;if(s.precision==null)switch(s.type){case"s":return isNaN(l=I8(a,u))||(s.precision=l),n(s,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=B8(a,u))||(s.precision=l-(s.type==="e"));break}case"f":case"%":{isNaN(l=L8(a))||(s.precision=l-(s.type==="%")*2);break}}return t(s)}}}let g1;mM();function mM(){return g1=pM({format:IC,formatPrefix:BC})}function yM(e){return pM(LC(e))}function ih(e){return arguments.length?g1=yM(e):g1}function iS(e,t,n){n=n||{},G(n)||O(`Invalid time multi-format specifier: ${n}`);const i=t(Qn),r=t(Rn),o=t(On),s=t(bn),a=t(nt),u=t(Lt),l=t(yn),c=t(St),f=e(n[Ei]||".%L"),d=e(n[Qn]||":%S"),h=e(n[Rn]||"%I:%M"),g=e(n[On]||"%I %p"),p=e(n[bn]||n[Nt]||"%a %d"),m=e(n[nt]||"%b %d"),y=e(n[Lt]||"%B"),b=e(n[yn]||"%B"),x=e(n[St]||"%Y");return v=>(i(v)<v?f:r(v)<v?d:o(v)<v?h:s(v)<v?g:u(v)<v?a(v)<v?p:m:c(v)<v?l(v)<v?y:b:x)(v)}function bM(e){const t=Ll(e.format),n=Ll(e.utcFormat);return{timeFormat:i=>Y(i)?t(i):iS(t,Wu,i),utcFormat:i=>Y(i)?n(i):iS(n,Hu,i),timeParse:Ll(e.parse),utcParse:Ll(e.utcParse)}}let p1;xM();function xM(){return p1=bM({format:Mb,parse:hM,utcFormat:Fb,utcParse:gM})}function vM(e){return bM(uM(e))}function bc(e){return arguments.length?p1=vM(e):p1}const m1=(e,t)=>ae({},e,t);function wM(e,t){const n=e?yM(e):ih(),i=t?vM(t):bc();return m1(n,i)}function Db(e,t){const n=arguments.length;return n&&n!==2&&O("defaultLocale expects either zero or two arguments."),n?m1(ih(e),bc(t)):m1(ih(),bc())}function gP(){return mM(),xM(),Db()}const pP=/^(data:|([A-Za-z]+:)?\/\/)/,mP=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,yP=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,rS="file://";function bP(e,t){return n=>({options:n||{},sanitize:vP,load:xP,fileAccess:!!t,file:wP(t),http:SP(e)})}async function xP(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function vP(e,t){t=ae({},this.options,t);const n=this.fileAccess,i={href:null};let r,o,s;const a=mP.test(e.replace(yP,""));(e==null||typeof e!="string"||!a)&&O("Sanitize failure, invalid URI: "+j(e));const u=pP.test(e);return(s=t.baseURL)&&!u&&(!e.startsWith("/")&&!s.endsWith("/")&&(e="/"+e),e=s+e),o=(r=e.startsWith(rS))||t.mode==="file"||t.mode!=="http"&&!u&&n,r?e=e.slice(rS.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),o=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!o}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function wP(e){return e?t=>new Promise((n,i)=>{e.readFile(t,(r,o)=>{r?i(r):n(o)})}):_P}async function _P(){O("No file system access.")}function SP(e){return e?async function(t,n){const i=ae({},this.options.http,n),r=n&&n.response,o=await e(t,i);return o.ok?ue(o[r])?o[r]():o.text():O(o.status+""+o.statusText)}:EP}async function EP(){O("No HTTP fetch method available.")}const kP=e=>e!=null&&e===e,$P=e=>e==="true"||e==="false"||e===!0||e===!1,AP=e=>!Number.isNaN(Date.parse(e)),_M=e=>!Number.isNaN(+e)&&!(e instanceof Date),CP=e=>_M(e)&&Number.isInteger(+e),y1={boolean:wb,integer:Ot,number:Ot,date:_b,string:Sb,unknown:Ut},jf=[$P,CP,_M,AP],MP=["boolean","integer","number","date"];function SM(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=jf.length,r=jf.map((o,s)=>s+1);for(let o=0,s=0,a,u;o<n;++o)for(u=t?e[o][t]:e[o],a=0;a<i;++a)if(r[a]&&kP(u)&&!jf[a](u)&&(r[a]=0,++s,s===jf.length))return"string";return MP[r.reduce((o,s)=>o===0?s:o,0)-1]}function EM(e,t){return t.reduce((n,i)=>(n[i]=SM(e,i),n),{})}function oS(e){const t=function(n,i){const r={delimiter:e};return Tb(n,i?ae(i,r):r)};return t.responseType="text",t}function Tb(e,t){return t.header&&(e=t.header.map(j).join(t.delimiter)+`
`+e),s8(t.delimiter).parse(e+"")}Tb.responseType="text";function FP(e){return typeof Buffer=="function"&&ue(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function Nb(e,t){const n=t&&t.property?Kn(t.property):Ut;return G(e)&&!FP(e)?DP(n(e),t):n(JSON.parse(e))}Nb.responseType="json";function DP(e,t){return!z(e)&&yC(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const TP={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function kM(e,t){let n,i,r,o;return e=Nb(e,t),t&&t.feature?(n=c8,r=t.feature):t&&t.mesh?(n=d8,r=t.mesh,o=TP[t.filter]):O("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,o):O("Invalid TopoJSON object: "+r),i&&i.features||[i]}kM.responseType="json";const Ed={dsv:Tb,csv:oS(","),tsv:oS("	"),json:Nb,topojson:kM};function Ob(e,t){return arguments.length>1?(Ed[e]=t,this):ne(Ed,e)?Ed[e]:null}function $M(e){const t=Ob(e);return t&&t.responseType||"text"}function AM(e,t,n,i){t=t||{};const r=Ob(t.type||"json");return r||O("Unknown data format type: "+t.type),e=r(e,t),t.parse&&NP(e,t.parse,n,i),ne(e,"columns")&&delete e.columns,e}function NP(e,t,n,i){if(!e.length)return;const r=bc();n=n||r.timeParse,i=i||r.utcParse;let o=e.columns||Object.keys(e[0]),s,a,u,l,c,f;t==="auto"&&(t=EM(e,o)),o=Object.keys(t);const d=o.map(h=>{const g=t[h];let p,m;if(g&&(g.startsWith("date:")||g.startsWith("utc:")))return p=g.split(/:(.+)?/,2),m=p[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(p[0]==="utc"?i:n)(m);if(!y1[g])throw Error("Illegal format pattern: "+h+":"+g);return y1[g]});for(u=0,c=e.length,f=o.length;u<c;++u)for(s=e[u],l=0;l<f;++l)a=o[l],s[a]=d[l](s[a])}const Pg=bP(typeof fetch<"u"&&fetch,null);function Lg(e){const t=e||Ut,n=[],i={};return n.add=r=>{const o=t(r);return i[o]||(i[o]=1,n.push(r)),n},n.remove=r=>{const o=t(r);if(i[o]){i[o]=0;const s=n.indexOf(r);s>=0&&n.splice(s,1)}return n},n}async function kd(e,t){try{await t(e)}catch(n){e.error(n)}}const CM=Symbol("vega_id");let OP=1;function Ig(e){return!!(e&&ee(e))}function ee(e){return e[CM]}function MM(e,t){return e[CM]=t,e}function Ee(e){const t=e===Object(e)?e:{data:e};return ee(t)?t:MM(t,OP++)}function Rb(e){return Bg(e,Ee({}))}function Bg(e,t){for(const n in e)t[n]=e[n];return t}function FM(e,t){return MM(t,ee(e))}function fa(e,t){return e?t?(n,i)=>e(n,i)||ee(t(n))-ee(t(i)):(n,i)=>e(n,i)||ee(n)-ee(i):null}function DM(e){return e&&e.constructor===da}function da(){const e=[],t=[],n=[],i=[],r=[];let o=null,s=!1;return{constructor:da,insert(a){const u=H(a),l=u.length;for(let c=0;c<l;++c)e.push(u[c]);return this},remove(a){const u=ue(a)?i:t,l=H(a),c=l.length;for(let f=0;f<c;++f)u.push(l[f]);return this},modify(a,u,l){const c={field:u,value:jt(l)};return ue(a)?(c.filter=a,r.push(c)):(c.tuple=a,n.push(c)),this},encode(a,u){return ue(a)?r.push({filter:a,field:u}):n.push({tuple:a,field:u}),this},clean(a){return o=a,this},reflow(){return s=!0,this},pulse(a,u){const l={},c={};let f,d,h,g,p,m;for(f=0,d=u.length;f<d;++f)l[ee(u[f])]=1;for(f=0,d=t.length;f<d;++f)p=t[f],l[ee(p)]=-1;for(f=0,d=i.length;f<d;++f)g=i[f],u.forEach(b=>{g(b)&&(l[ee(b)]=-1)});for(f=0,d=e.length;f<d;++f)p=e[f],m=ee(p),l[m]?l[m]=1:a.add.push(Ee(e[f]));for(f=0,d=u.length;f<d;++f)p=u[f],l[ee(p)]<0&&a.rem.push(p);function y(b,x,v){v?b[x]=v(b):a.encode=x,s||(c[ee(b)]=b)}for(f=0,d=n.length;f<d;++f)h=n[f],p=h.tuple,g=h.field,m=l[ee(p)],m>0&&(y(p,g,h.value),a.modifies(g));for(f=0,d=r.length;f<d;++f)h=r[f],g=h.filter,u.forEach(b=>{g(b)&&l[ee(b)]>0&&y(b,h.field,h.value)}),a.modifies(h.field);if(s)a.mod=t.length||i.length?u.filter(b=>l[ee(b)]>0):u.slice();else for(m in c)a.mod.push(c[m]);return(o||o==null&&(t.length||i.length))&&a.clean(!0),a}}}const $d="_:mod:_";function Ug(){Object.defineProperty(this,$d,{writable:!0,value:{}})}Ug.prototype={set(e,t,n,i){const r=this,o=r[e],s=r[$d];return t!=null&&t>=0?(o[t]!==n||i)&&(o[t]=n,s[t+":"+e]=-1,s[e]=-1):(o!==n||i)&&(r[e]=n,s[e]=z(n)?1+n.length:-1),r},modified(e,t){const n=this[$d];if(arguments.length){if(z(e)){for(let i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(const i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[$d]={},this}};let RP=0;const zP="pulse",PP=new Ug,LP=1,IP=2;function Te(e,t,n,i){this.id=++RP,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}function sS(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Te.prototype={targets(){return this._targets||(this._targets=Lg(Xc))},set(e){return this.value!==e?(this.value=e,1):0},skip:sS(LP),modified:sS(IP),parameters(e,t,n){t=t!==!1;const i=this._argval=this._argval||new Ug,r=this._argops=this._argops||[],o=[];let s,a,u,l;const c=(f,d,h)=>{h instanceof Te?(h!==this&&(t&&h.targets().add(this),o.push(h)),r.push({op:h,name:f,index:d})):i.set(f,d,h)};for(s in e)if(a=e[s],s===zP)H(a).forEach(f=>{f instanceof Te?f!==this&&(f.targets().add(this),o.push(f)):O("Pulse parameters must be operator instances.")}),this.source=a;else if(z(a))for(i.set(s,-1,Array(u=a.length)),l=0;l<u;++l)c(s,l,a[l]);else c(s,-1,a);return this.marshall().clear(),n&&(r.initonly=!0),o},marshall(e){const t=this._argval||PP,n=this._argops;let i,r,o,s;if(n){const a=n.length;for(r=0;r<a;++r)i=n[r],o=i.op,s=o.modified()&&o.stamp===e,t.set(i.name,i.index,o.value,s);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function BP(e,t,n,i){let r=1,o;return e instanceof Te?o=e:e&&e.prototype instanceof Te?o=new e:ue(e)?o=new Te(null,e):(r=0,o=new Te(e,t)),this.rank(o),r&&(i=n,n=t),n&&this.connect(o,o.parameters(n,i)),this.touch(o),o}function UP(e,t){const n=e.rank,i=t.length;for(let r=0;r<i;++r)if(n<t[r].rank){this.rerank(e);return}}let jP=0;function jg(e,t,n){this.id=++jP,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function ro(e,t,n){return new jg(e,t,n)}jg.prototype={_filter:Jn,_apply:Ut,targets(){return this._targets||(this._targets=Lg(Xc))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,i=n?n.length:0;for(let r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=ro(e);return this.targets().add(t),t},apply(e){const t=ro(null,e);return this.targets().add(t),t},merge(){const e=ro();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=ro();return this.targets().add(ro(null,null,xb(e,n=>{const i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},between(e,t){let n=!1;return e.targets().add(ro(null,null,()=>n=!0)),t.targets().add(ro(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=Jn,this._targets=null}};function qP(e,t,n,i){const r=this,o=ro(n,i),s=function(l){l.dataflow=r;try{o.receive(l)}catch(c){r.error(c)}finally{r.run()}};let a;typeof e=="string"&&typeof document<"u"?a=document.querySelectorAll(e):a=H(e);const u=a.length;for(let l=0;l<u;++l)a[l].addEventListener(t,s);return o}function WP(e,t){const n=this.locale();return AM(e,t,n.timeParse,n.utcParse)}function HP(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function GP(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:$M(t&&t.type)});try{r=n.parse(r,t)}catch(o){i=-2,n.warn("Data ingestion failed",e,o)}}catch(o){i=-1,n.warn("Loading failed",e,o)}return{data:r,status:i}}async function YP(e,t,n){const i=this,r=i._pending||VP(i);r.requests+=1;const o=await i.request(t,n);return i.pulse(e,i.changeset().remove(Jn).insert(o.data||[])),r.done(),o}function VP(e){let t;const n=new Promise(i=>t=i);return n.requests=0,n.done=()=>{--n.requests===0&&(e._pending=null,t(e))},e._pending=n}const XP={skip:!0};function KP(e,t,n,i,r){return(e instanceof Te?QP:JP)(this,e,t,n,i,r),this}function JP(e,t,n,i,r,o){const s=ae({},o,XP);let a,u;ue(n)||(n=jt(n)),i===void 0?a=l=>e.touch(n(l)):ue(i)?(u=new Te(null,i,r,!1),a=l=>{u.evaluate(l);const c=n(l),f=u.value;DM(f)?e.pulse(c,f,o):e.update(c,f,s)}):a=l=>e.update(n(l),i,s),t.apply(a)}function QP(e,t,n,i,r,o){if(i===void 0)t.targets().add(n);else{const s=o||{},a=new Te(null,ZP(n,i),r,!1);a.modified(s.force),a.rank=t.rank,t.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),e.connect(n,[a]))}}function ZP(e,t){return t=ue(t)?t:jt(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function e9(e){e.rank=++this._rank}function t9(e){const t=[e];let n,i,r;for(;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&O("Cycle detected in dataflow graph.")}const rh={},Ii=1,ao=2,Sr=4,n9=Ii|ao,aS=Ii|Sr,Ca=Ii|ao|Sr,uS=8,hl=16,lS=32,cS=64;function Eo(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function jm(e,t){const n=[];return so(e,t,i=>n.push(i)),n}function fS(e,t){const n={};return e.visit(t,i=>{n[ee(i)]=1}),i=>n[ee(i)]?null:i}function qf(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}Eo.prototype={StopPropagation:rh,ADD:Ii,REM:ao,MOD:Sr,ADD_REM:n9,ADD_MOD:aS,ALL:Ca,REFLOW:uS,SOURCE:hl,NO_SOURCE:lS,NO_FIELDS:cS,fork(e){return new Eo(this.dataflow).init(this,e)},clone(){const e=this.fork(Ca);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(Ca|hl)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new Eo(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&cS)&&(n.fields=e.fields),t&Ii?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&ao?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&Sr?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&lS?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||Ca;return t&Ii&&this.add.length||t&ao&&this.rem.length||t&Sr&&this.mod.length},reflow(e){if(e)return this.fork(Ca).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(Sr,fS(this,Ii))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return z(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?z(e)?e.some(i=>n[i]):n[e]:!!n:!1},filter(e,t){const n=this;return e&Ii&&(n.addF=qf(n.addF,t)),e&ao&&(n.remF=qf(n.remF,t)),e&Sr&&(n.modF=qf(n.modF,t)),e&hl&&(n.srcF=qf(n.srcF,t)),n},materialize(e){e=e||Ca;const t=this;return e&Ii&&t.addF&&(t.add=jm(t.add,t.addF),t.addF=null),e&ao&&t.remF&&(t.rem=jm(t.rem,t.remF),t.remF=null),e&Sr&&t.modF&&(t.mod=jm(t.mod,t.modF),t.modF=null),e&hl&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,i=t;if(e&hl)return so(n.source,n.srcF,i),n;e&Ii&&so(n.add,n.addF,i),e&ao&&so(n.rem,n.remF,i),e&Sr&&so(n.mod,n.modF,i);const r=n.source;if(e&uS&&r){const o=n.add.length+n.mod.length;o===r.length||(o?so(r,fS(n,aS),i):so(r,n.srcF,i))}return n}};function zb(e,t,n,i){const r=this;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n;for(const s of n)if(s.stamp===t){if(s.fields){const a=r.fields||(r.fields={});for(const u in s.fields)a[u]=1}s.changed(r.ADD)&&(o|=r.ADD),s.changed(r.REM)&&(o|=r.REM),s.changed(r.MOD)&&(o|=r.MOD)}this.changes=o}U(zb,Eo,{fork(e){const t=new Eo(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?z(e)?e.some(i=>n[i]):n[e]:0},filter(){O("MultiPulse does not support filtering.")},materialize(){O("MultiPulse does not support materialization.")},visit(e,t){const n=this,i=n.pulses,r=i.length;let o=0;if(e&n.SOURCE)for(;o<r;++o)i[o].visit(e,t);else for(;o<r;++o)i[o].stamp===n.stamp&&i[o].visit(e,t);return n}});async function i9(e,t,n){const i=this,r=[];if(i._pulse)return TM(i);if(i._pending&&await i._pending,t&&await kd(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const o=++i._clock;i._pulse=new Eo(i,o,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=Lg(Xc);let s=0,a,u,l;try{for(;i._heap.size()>0;){if(a=i._heap.pop(),a.rank!==a.qrank){i._enqueue(a,!0);continue}u=a.run(i._getPulse(a,e)),u.then?u=await u:u.async&&(r.push(u.async),u=rh),u!==rh&&a._targets&&a._targets.forEach(c=>i._enqueue(c)),++s}}catch(c){i._heap.clear(),l=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${o}: ${s} operators`),l&&(i._postrun=[],i.error(l)),i._postrun.length){const c=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await kd(i,c[f].callback)}return n&&await kd(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function r9(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function o9(e,t,n){return this._pulse?TM(this):(this.evaluate(e,t,n),this)}function s9(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function TM(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function a9(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function u9(e,t){const n=e.source,i=this._clock;return n&&z(n)?new zb(this,i,n.map(r=>r.pulse),t):this._input[e.id]||l9(this._pulse,n&&n.pulse)}function l9(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==rh&&(e.source=t.source),e)}const Pb={skip:!1,force:!1};function c9(e,t){const n=t||Pb;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function f9(e,t,n){const i=n||Pb;return(e.set(t)||i.force)&&this.touch(e,i),this}function d9(e,t,n){this.touch(e,n||Pb);const i=new Eo(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function h9(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),NM(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let i;return t.length?(i=t[0],t[0]=n,g9(t,0,e)):i=n,i}}}function NM(e,t,n,i){let r,o;const s=e[n];for(;n>t;){if(o=n-1>>1,r=e[o],i(s,r)<0){e[n]=r,n=o;continue}break}return e[n]=s}function g9(e,t,n){const i=t,r=e.length,o=e[t];let s=(t<<1)+1,a;for(;s<r;)a=s+1,a<r&&n(e[s],e[a])>=0&&(s=a),e[t]=e[s],t=s,s=(t<<1)+1;return e[t]=o,NM(e,i,t,n)}function Va(){this.logger(gb()),this.logLevel(db),this._clock=0,this._rank=0,this._locale=Db();try{this._loader=Pg()}catch{}this._touched=Lg(Xc),this._input={},this._pulse=null,this._heap=h9((e,t)=>e.qrank-t.qrank),this._postrun=[]}function gl(e){return function(){return this._log[e].apply(this,arguments)}}Va.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:gl("error"),warn:gl("warn"),info:gl("info"),debug:gl("debug"),logLevel:gl("level"),cleanThreshold:1e4,add:BP,connect:UP,rank:e9,rerank:t9,pulse:d9,touch:c9,update:f9,changeset:da,ingest:HP,parse:WP,preload:YP,request:GP,events:qP,on:KP,evaluate:i9,run:o9,runAsync:r9,runAfter:s9,_enqueue:a9,_getPulse:u9};function F(e,t){Te.call(this,e,null,t)}U(F,Te,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const lu={};function OM(e){const t=RM(e);return t&&t.Definition||null}function RM(e){return e=e&&e.toLowerCase(),ne(lu,e)?lu[e]:null}function*zM(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function Lb(e,t,n){const i=Float64Array.from(zM(e,n));return i.sort(Or),t.map(r=>NC(i,r))}function Ib(e,t){return Lb(e,[.25,.5,.75],t)}function Bb(e,t){const n=e.length,i=v8(e,t),r=Ib(e,t),o=(r[2]-r[0])/1.34;return 1.06*(Math.min(i,o)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}function PM(e){const t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2];let o=e.extent[0],s=e.extent[1],a,u,l,c,f,d;const h=e.span||s-o||Math.abs(o)||1;if(e.step)a=e.step;else if(e.steps){for(c=h/t,f=0,d=e.steps.length;f<d&&e.steps[f]<c;++f);a=e.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(t)/i),l=e.minstep||0,a=Math.max(l,Math.pow(n,Math.round(Math.log(h)/i)-u));Math.ceil(h/a)>t;)a*=n;for(f=0,d=r.length;f<d;++f)c=a/r[f],c>=l&&h/c<=t&&(a=c)}c=Math.log(a);const g=c>=0?0:~~(-c/i)+1,p=Math.pow(n,-g-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(o/a+p)*a,o=o<c?c-a:c,s=Math.ceil(s/a)*a),{start:o,stop:s===o?o+a:s,step:a}}var Zn=Math.random;function p9(e){Zn=e}function LM(e,t,n,i){if(!e.length)return[void 0,void 0];const r=Float64Array.from(zM(e,i)),o=r.length,s=t;let a,u,l,c;for(l=0,c=Array(s);l<s;++l){for(a=0,u=0;u<o;++u)a+=r[~~(Zn()*o)];c[l]=a/o}return c.sort(Or),[u1(c,n/2),u1(c,1-n/2)]}function IM(e,t,n,i){i=i||(d=>d);const r=e.length,o=new Float64Array(r);let s=0,a=1,u=i(e[0]),l=u,c=u+t,f;for(;a<r;++a){if(f=i(e[a]),f>=c){for(l=(u+l)/2;s<a;++s)o[s]=l;c=f+t,u=f}l=f}for(l=(u+l)/2;s<a;++s)o[s]=l;return n?m9(o,t+t/4):o}function m9(e,t){const n=e.length;let i=0,r=1,o,s;for(;e[i]===e[r];)++r;for(;r<n;){for(o=r+1;e[r]===e[o];)++o;if(e[r]-e[r-1]<t){for(s=r+(i+o-r-r>>1);s<r;)e[s++]=e[r];for(;s>r;)e[s--]=e[i]}i=r,r=o}return e}function y9(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function b9(e,t){t==null&&(t=e,e=0);let n,i,r;const o={min(s){return arguments.length?(n=s||0,r=i-n,o):n},max(s){return arguments.length?(i=s||0,r=i-n,o):i},sample(){return n+Math.floor(r*Zn())},pdf(s){return s===Math.floor(s)&&s>=n&&s<i?1/r:0},cdf(s){const a=Math.floor(s);return a<n?0:a>=i?1:(a-n+1)/r},icdf(s){return s>=0&&s<=1?n-1+Math.floor(s*r):NaN}};return o.min(e).max(t)}const BM=Math.sqrt(2*Math.PI),x9=Math.SQRT2;let pl=NaN;function qg(e,t){e=e||0,t=t??1;let n=0,i=0,r,o;if(pl===pl)n=pl,pl=NaN;else{do n=Zn()*2-1,i=Zn()*2-1,r=n*n+i*i;while(r===0||r>1);o=Math.sqrt(-2*Math.log(r)/r),n*=o,pl=i*o}return e+n*t}function Ub(e,t,n){n=n??1;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*BM)}function Wg(e,t,n){t=t||0,n=n??1;const i=(e-t)/n,r=Math.abs(i);let o;if(r>37)o=0;else{const s=Math.exp(-r*r/2);let a;r<7.07106781186547?(a=.0352624965998911*r+.700383064443688,a=a*r+6.37396220353165,a=a*r+33.912866078383,a=a*r+112.079291497871,a=a*r+221.213596169931,a=a*r+220.206867912376,o=s*a,a=.0883883476483184*r+1.75566716318264,a=a*r+16.064177579207,a=a*r+86.7807322029461,a=a*r+296.564248779674,a=a*r+637.333633378831,a=a*r+793.826512519948,a=a*r+440.413735824752,o=o/a):(a=r+.65,a=r+4/a,a=r+3/a,a=r+2/a,a=r+1/a,o=s/a/2.506628274631)}return i>0?1-o:o}function Hg(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*x9*v9(2*e-1)}function v9(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}function jb(e,t){let n,i;const r={mean(o){return arguments.length?(n=o||0,r):n},stdev(o){return arguments.length?(i=o??1,r):i},sample:()=>qg(n,i),pdf:o=>Ub(o,n,i),cdf:o=>Wg(o,n,i),icdf:o=>Hg(o,n,i)};return r.mean(e).stdev(t)}function qb(e,t){const n=jb();let i=0;const r={data(o){return arguments.length?(e=o,i=o?o.length:0,r.bandwidth(t)):e},bandwidth(o){return arguments.length?(t=o,!t&&e&&(t=Bb(e)),r):t},sample(){return e[~~(Zn()*i)]+t*n.sample()},pdf(o){let s=0,a=0;for(;a<i;++a)s+=n.pdf((o-e[a])/t);return s/t/i},cdf(o){let s=0,a=0;for(;a<i;++a)s+=n.cdf((o-e[a])/t);return s/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(e)}function Wb(e,t){return e=e||0,t=t??1,Math.exp(e+qg()*t)}function Hb(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*BM*e)}function Gb(e,t,n){return Wg(Math.log(e),t,n)}function Yb(e,t,n){return Math.exp(Hg(e,t,n))}function UM(e,t){let n,i;const r={mean(o){return arguments.length?(n=o||0,r):n},stdev(o){return arguments.length?(i=o??1,r):i},sample:()=>Wb(n,i),pdf:o=>Hb(o,n,i),cdf:o=>Gb(o,n,i),icdf:o=>Yb(o,n,i)};return r.mean(e).stdev(t)}function jM(e,t){let n=0,i;function r(s){const a=[];let u=0,l;for(l=0;l<n;++l)u+=a[l]=s[l]==null?1:+s[l];for(l=0;l<n;++l)a[l]/=u;return a}const o={weights(s){return arguments.length?(i=r(t=s||[]),o):t},distributions(s){return arguments.length?(s?(n=s.length,e=s):(n=0,e=[]),o.weights(t)):e},sample(){const s=Zn();let a=e[n-1],u=i[0],l=0;for(;l<n-1;u+=i[++l])if(s<u){a=e[l];break}return a.sample()},pdf(s){let a=0,u=0;for(;u<n;++u)a+=i[u]*e[u].pdf(s);return a},cdf(s){let a=0,u=0;for(;u<n;++u)a+=i[u]*e[u].cdf(s);return a},icdf(){throw Error("Mixture icdf not supported.")}};return o.distributions(e).weights(t)}function Vb(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Zn()}function Xb(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function Kb(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function Jb(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function qM(e,t){let n,i;const r={min(o){return arguments.length?(n=o||0,r):n},max(o){return arguments.length?(i=o??1,r):i},sample:()=>Vb(n,i),pdf:o=>Xb(o,n,i),cdf:o=>Kb(o,n,i),icdf:o=>Jb(o,n,i)};return t==null&&(t=e??1,e=0),r.min(e).max(t)}function Qb(e,t,n){let i=0,r=0;for(const o of e){const s=n(o);t(o)==null||s==null||isNaN(s)||(i+=(s-i)/++r)}return{coef:[i],predict:()=>i,rSquared:0}}function Qc(e,t,n,i){const r=i-e*e,o=Math.abs(r)<1e-24?0:(n-e*t)/r;return[t-o*e,o]}function Gg(e,t,n,i){e=e.filter(h=>{let g=t(h),p=n(h);return g!=null&&(g=+g)>=g&&p!=null&&(p=+p)>=p}),i&&e.sort((h,g)=>t(h)-t(g));const r=e.length,o=new Float64Array(r),s=new Float64Array(r);let a=0,u=0,l=0,c,f,d;for(d of e)o[a]=c=+t(d),s[a]=f=+n(d),++a,u+=(c-u)/a,l+=(f-l)/a;for(a=0;a<r;++a)o[a]-=u,s[a]-=l;return[o,s,u,l]}function Zc(e,t,n,i){let r=-1,o,s;for(const a of e)o=t(a),s=n(a),o!=null&&(o=+o)>=o&&s!=null&&(s=+s)>=s&&i(o,s,++r)}function Gu(e,t,n,i,r){let o=0,s=0;return Zc(e,t,n,(a,u)=>{const l=u-r(a),c=u-i;o+=l*l,s+=c*c}),1-o/s}function Zb(e,t,n){let i=0,r=0,o=0,s=0,a=0;Zc(e,t,n,(c,f)=>{++a,i+=(c-i)/a,r+=(f-r)/a,o+=(c*f-o)/a,s+=(c*c-s)/a});const u=Qc(i,r,o,s),l=c=>u[0]+u[1]*c;return{coef:u,predict:l,rSquared:Gu(e,t,n,r,l)}}function WM(e,t,n){let i=0,r=0,o=0,s=0,a=0;Zc(e,t,n,(c,f)=>{++a,c=Math.log(c),i+=(c-i)/a,r+=(f-r)/a,o+=(c*f-o)/a,s+=(c*c-s)/a});const u=Qc(i,r,o,s),l=c=>u[0]+u[1]*Math.log(c);return{coef:u,predict:l,rSquared:Gu(e,t,n,r,l)}}function HM(e,t,n){const[i,r,o,s]=Gg(e,t,n);let a=0,u=0,l=0,c=0,f=0,d,h,g;Zc(e,t,n,(b,x)=>{d=i[f++],h=Math.log(x),g=d*x,a+=(x*h-a)/f,u+=(g-u)/f,l+=(g*h-l)/f,c+=(d*g-c)/f});const[p,m]=Qc(u/s,a/s,l/s,c/s),y=b=>Math.exp(p+m*(b-o));return{coef:[Math.exp(p-m*o),m],predict:y,rSquared:Gu(e,t,n,s,y)}}function GM(e,t,n){let i=0,r=0,o=0,s=0,a=0,u=0;Zc(e,t,n,(f,d)=>{const h=Math.log(f),g=Math.log(d);++u,i+=(h-i)/u,r+=(g-r)/u,o+=(h*g-o)/u,s+=(h*h-s)/u,a+=(d-a)/u});const l=Qc(i,r,o,s),c=f=>l[0]*Math.pow(f,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:Gu(e,t,n,a,c)}}function ex(e,t,n){const[i,r,o,s]=Gg(e,t,n),a=i.length;let u=0,l=0,c=0,f=0,d=0,h,g,p,m;for(h=0;h<a;)g=i[h],p=r[h++],m=g*g,u+=(m-u)/h,l+=(m*g-l)/h,c+=(m*m-c)/h,f+=(g*p-f)/h,d+=(m*p-d)/h;const y=c-u*u,b=u*y-l*l,x=(d*u-f*l)/b,v=(f*y-d*l)/b,w=-x*u,S=_=>(_=_-o,x*_*_+v*_+w+s);return{coef:[w-v*o+x*o*o+s,v-2*x*o,x],predict:S,rSquared:Gu(e,t,n,s,S)}}function YM(e,t,n,i){if(i===0)return Qb(e,t,n);if(i===1)return Zb(e,t,n);if(i===2)return ex(e,t,n);const[r,o,s,a]=Gg(e,t,n),u=r.length,l=[],c=[],f=i+1;let d,h,g,p,m;for(d=0;d<f;++d){for(g=0,p=0;g<u;++g)p+=Math.pow(r[g],d)*o[g];for(l.push(p),m=new Float64Array(f),h=0;h<f;++h){for(g=0,p=0;g<u;++g)p+=Math.pow(r[g],d+h);m[h]=p}c.push(m)}c.push(l);const y=_9(c),b=x=>{x-=s;let v=a+y[0]+y[1]*x+y[2]*x*x;for(d=3;d<f;++d)v+=y[d]*Math.pow(x,d);return v};return{coef:w9(f,y,-s,a),predict:b,rSquared:Gu(e,t,n,a,b)}}function w9(e,t,n,i){const r=Array(e);let o,s,a,u;for(o=0;o<e;++o)r[o]=0;for(o=e-1;o>=0;--o)for(a=t[o],u=1,r[o]+=a,s=1;s<=o;++s)u*=(o+1-s)/s,r[o-s]+=a*Math.pow(n,s)*u;return r[0]+=i,r}function _9(e){const t=e.length-1,n=[];let i,r,o,s,a;for(i=0;i<t;++i){for(s=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][s])&&(s=r);for(o=i;o<t+1;++o)a=e[o][i],e[o][i]=e[o][s],e[o][s]=a;for(r=i+1;r<t;++r)for(o=t;o>=i;o--)e[o][r]-=e[o][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(a=0,o=r+1;o<t;++o)a+=e[o][r]*n[o];n[r]=(e[t][r]-a)/e[r][r]}return n}const dS=2,hS=1e-12;function VM(e,t,n,i){const[r,o,s,a]=Gg(e,t,n,!0),u=r.length,l=Math.max(2,~~(i*u)),c=new Float64Array(u),f=new Float64Array(u),d=new Float64Array(u).fill(1);for(let h=-1;++h<=dS;){const g=[0,l-1];for(let m=0;m<u;++m){const y=r[m],b=g[0],x=g[1],v=y-r[b]>r[x]-y?b:x;let w=0,S=0,_=0,E=0,A=0;const k=1/Math.abs(r[v]-y||1);for(let M=b;M<=x;++M){const D=r[M],C=o[M],R=S9(Math.abs(y-D)*k)*d[M],W=D*R;w+=R,S+=W,_+=C*R,E+=C*W,A+=D*W}const[$,T]=Qc(S/w,_/w,E/w,A/w);c[m]=$+T*y,f[m]=Math.abs(o[m]-c[m]),E9(r,m+1,g)}if(h===dS)break;const p=OC(f);if(Math.abs(p)<hS)break;for(let m=0,y,b;m<u;++m)y=f[m]/(6*p),d[m]=y>=1?hS:(b=1-y*y)*b}return k9(r,c,s,a)}function S9(e){return(e=1-e*e*e)*e*e}function E9(e,t,n){const i=e[t];let r=n[0],o=n[1]+1;if(!(o>=e.length))for(;t>r&&e[o]-i<=i-e[r];)n[0]=++r,n[1]=o,++o}function k9(e,t,n,i){const r=e.length,o=[];let s=0,a=0,u=[],l;for(;s<r;++s)l=e[s]+n,u[0]===l?u[1]+=(t[s]-u[1])/++a:(a=0,u[1]+=i,u=[l,t[s]],o.push(u));return u[1]+=i,o}const $9=.5*Math.PI/180;function Yg(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=p=>[p,e(p)],o=t[0],s=t[1],a=s-o,u=a/i,l=[r(o)],c=[];if(n===i){for(let p=1;p<i;++p)l.push(r(o+p/n*a));return l.push(r(s)),l}else{c.push(r(s));for(let p=n;--p>0;)c.push(r(o+p/n*a))}let f=l[0],d=c[c.length-1];const h=1/a,g=A9(f[1],c);for(;d;){const p=r((f[0]+d[0])/2);p[0]-f[0]>=u&&C9(f,p,d,h,g)>$9?c.push(p):(f=d,l.push(d),c.pop()),d=c[c.length-1]}return l}function A9(e,t){let n=e,i=e;const r=t.length;for(let o=0;o<r;++o){const s=t[o][1];s<n&&(n=s),s>i&&(i=s)}return 1/(i-n)}function C9(e,t,n,i,r){const o=Math.atan2(r*(n[1]-e[1]),i*(n[0]-e[0])),s=Math.atan2(r*(t[1]-e[1]),i*(t[0]-e[0]));return Math.abs(o-s)}function M9(e){return t=>{const n=e.length;let i=1,r=String(e[0](t));for(;i<n;++i)r+="|"+e[i](t);return r}}function b1(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:M9(e)}function XM(e,t,n){return n||e+(t?"_"+t:"")}const qm=()=>{},F9={init:qm,add:qm,rem:qm,idx:0},xc={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3},exponential:{init:(e,t)=>{e.exp=0,e.exp_r=t},value:e=>e.valid?e.exp*(1-e.exp_r)/(1-e.exp_r**e.valid):void 0,add:(e,t)=>e.exp=e.exp_r*e.exp+t,rem:(e,t)=>e.exp=(e.exp-t/e.exp_r**(e.valid-1))/e.exp_r},exponentialb:{value:e=>e.valid?e.exp*(1-e.exp_r):void 0,req:["exponential"],idx:1}},ef=Object.keys(xc).filter(e=>e!=="__count__");function D9(e,t){return(n,i)=>ae({name:e,aggregate_param:i,out:n||e},F9,t)}[...ef,"__count__"].forEach(e=>{xc[e]=D9(e,xc[e])});function KM(e,t,n){return xc[e](n,t)}function JM(e,t){return e.idx-t.idx}function T9(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{i.req&&i.req.forEach(r=>{t[r]||n(t[r]=xc[r]())})};return e.forEach(n),Object.values(t).sort(JM)}function N9(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.aggregate_param==null?e.init(this):e.init(this,e.aggregate_param))}function O9(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t)))}function R9(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t)))}function z9(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function QM(e,t){const n=t||Ut,i=T9(e),r=e.slice().sort(JM);function o(s){this._ops=i,this._out=r,this.cell=s,this.init()}return o.prototype.init=N9,o.prototype.add=O9,o.prototype.rem=R9,o.prototype.set=z9,o.prototype.get=n,o.fields=e.map(s=>s.out),o}function tx(e){this._key=e?Kn(e):ee,this.reset()}const $t=tx.prototype;$t.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};$t.add=function(e){this._add.push(e)};$t.rem=function(e){this._rem.push(e)};$t.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,o=Array(i-r),s={};let a,u,l;for(a=0;a<r;++a)s[n(t[a])]=1;for(a=0,u=0;a<i;++a)s[n(l=e[a])]?s[n(l)]=0:o[u++]=l;return this._rem=[],this._add=o};$t.distinct=function(e){const t=this.values(),n={};let i=t.length,r=0,o;for(;--i>=0;)o=e(t[i])+"",ne(n,o)||(n[o]=1,++r);return r};$t.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=pC(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext};$t.argmin=function(e){return this.extent(e)[0]||{}};$t.argmax=function(e){return this.extent(e)[1]||{}};$t.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0};$t.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0};$t.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=Ib(this.values(),e),this._get=e),this._q};$t.q1=function(e){return this.quartile(e)[0]};$t.q2=function(e){return this.quartile(e)[1]};$t.q3=function(e){return this.quartile(e)[2]};$t.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=LM(this.values(),1e3,.05,e),this._get=e),this._ci};$t.ci0=function(e){return this.ci(e)[0]};$t.ci1=function(e){return this.ci(e)[1]};function Fo(e){F.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Fo.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:ef},{name:"aggregate_params",type:"field",null:!0,array:!0,default:[null]},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};U(Fo,F,{transform(e,t){const n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):Object.create(null),t.visit(t.SOURCE,o=>n.add(o))):(n.value=n.value||n.init(e),t.visit(t.REM,o=>n.rem(o)),t.visit(t.ADD,o=>n.add(o))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){const e=this,t=e.value,n=e._dnames,i=n.map(()=>({})),r=n.length;function o(a){let u,l,c,f;for(u in a)for(c=a[u].tuple,l=0;l<r;++l)i[l][f=c[n[l]]]=f}o(e._prev),o(t);function s(a,u,l){const c=n[l],f=i[l++];for(const d in f){const h=a?a+"|"+d:d;u[c]=f[d],l<r?s(h,u,l):t[h]||e.cell(h,u)}}s("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],i={};function r(b){const x=H(Pt(b)),v=x.length;let w=0,S;for(;w<v;++w)i[S=x[w]]||(i[S]=1,t.push(S))}this._dims=H(e.groupby),this._dnames=this._dims.map(b=>{const x=Ge(b);return r(b),n.push(x),x}),this.cellkey=e.key?e.key:b1(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const o=e.fields||[null],s=e.ops||["count"],a=e.aggregate_params||[null],u=e.as||[],l=o.length,c={};let f,d,h,g,p,m,y;for(l!==s.length&&O("Unmatched number of fields and aggregate ops."),y=0;y<l;++y){if(f=o[y],d=s[y],h=a[y]||null,f==null&&d!=="count"&&O("Null aggregate field specified."),p=Ge(f),m=XM(d,p,u[y]),n.push(m),d==="count"){this._counts.push(m);continue}g=c[p],g||(r(f),g=c[p]=[],g.field=f,this._measures.push(g)),d!=="count"&&(this._countOnly=!1),g.push(KM(d,h,m))}return this._measures=this._measures.map(b=>QM(b,b.field)),Object.create(null)},cellkey:b1(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,r=i.length;n.agg=Array(r);for(let o=0;o<r;++o)n.agg[o]=new i[o](n)}return n.store&&(n.data=new tx),n},newtuple(e,t){const n=this._dnames,i=this._dims,r=i.length,o={};for(let s=0;s<r;++s)o[n[s]]=i[s](e);return t?FM(t.tuple,o):Ee(o)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const i=n.agg;for(let r=0,o=i.length;r<o;++r)i[r].add(i[r].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const i=n.agg;for(let r=0,o=i.length;r<o;++r)i[r].rem(i[r].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let i=0,r=n.length;i<r;++i)t[n[i]]=e.num;if(!this._countOnly){const i=e.agg;for(let r=0,o=i.length;r<o;++r)i[r].set(t)}return t},changes(e){const t=this._adds,n=this._mods,i=this._prev,r=this._drop,o=e.add,s=e.rem,a=e.mod;let u,l,c,f;if(i)for(l in i)u=i[l],(!r||u.num)&&s.push(u.tuple);for(c=0,f=this._alen;c<f;++c)o.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(u.num===0&&r?s:a).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const P9=1e-14;function nx(e){F.call(this,null,e)}nx.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};U(nx,F,{transform(e,t){const n=e.interval!==!1,i=this._bins(e),r=i.start,o=i.step,s=e.as||["bin0","bin1"],a=s[0],u=s[1];let l;return e.modified()?(t=t.reflow(!0),l=t.SOURCE):l=t.modified(Pt(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?c=>{const f=i(c);c[a]=f,c[u]=f==null?null:r+o*(1+(f-r)/o)}:c=>c[a]=i(c)),t.modifies(n?s:a)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=PM(e),i=n.step;let r=n.start,o=r+Math.ceil((n.stop-r)/i)*i,s,a;(s=e.anchor)!=null&&(a=s-(r+i*Math.floor((s-r)/i)),r+=a,o+=a);const u=function(l){let c=Ot(t(l));return c==null?null:c<r?-1/0:c>o?1/0:(c=Math.max(r,Math.min(c,o-i)),r+i*Math.floor(P9+(c-r)/i))};return u.start=r,u.stop=n.stop,u.step=i,this.value=Sn(u,Pt(t),e.name||"bin_"+Ge(t))}});function ZM(e,t,n){const i=e;let r=t||[],o=n||[],s={},a=0;return{add:u=>o.push(u),remove:u=>s[i(u)]=++a,size:()=>r.length,data:(u,l)=>(a&&(r=r.filter(c=>!s[i(c)]),s={},a=0),l&&u&&r.sort(u),o.length&&(r=u?wC(u,r,o.sort(u)):r.concat(o),o=[]),r)}}function ix(e){F.call(this,[],e)}ix.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};U(ix,F,{transform(e,t){const n=t.fork(t.ALL),i=ZM(ee,this.value,n.materialize(n.ADD).add),r=e.sort,o=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(o),this.value=n.source=i.data(fa(r),o),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function eF(e){Te.call(this,null,L9,e)}U(eF,Te);function L9(e){return this.value&&!e.modified()?this.value:bb(e.fields,e.orders)}function rx(e){F.call(this,null,e)}rx.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function I9(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}U(rx,F,{transform(e,t){const n=f=>d=>{for(var h=I9(a(d),e.case,o)||[],g,p=0,m=h.length;p<m;++p)s.test(g=h[p])||f(g)},i=this._parameterCheck(e,t),r=this._counts,o=this._match,s=this._stop,a=e.field,u=e.as||["text","count"],l=n(f=>r[f]=1+(r[f]||0)),c=n(f=>r[f]-=1);return i?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],o=t[1],s=e.fork(e.NO_SOURCE|e.NO_FIELDS);let a,u,l;for(a in n)u=i[a],l=n[a]||0,!u&&l?(i[a]=u=Ee({}),u[r]=a,u[o]=l,s.add.push(u)):l===0?(u&&s.rem.push(u),n[a]=null,i[a]=null):u[o]!==l&&(u[o]=l,s.mod.push(u));return s.modifies(t)}});function ox(e){F.call(this,null,e)}ox.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};U(ox,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.as||["a","b"],r=i[0],o=i[1],s=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let a=this.value;return s?(a&&(n.rem=a),a=t.materialize(t.SOURCE).source,n.add=this.value=B9(a,r,o,e.filter||Jn)):n.mod=a,n.source=this.value,n.modifies(i)}});function B9(e,t,n,i){for(var r=[],o={},s=e.length,a=0,u,l;a<s;++a)for(o[t]=l=e[a],u=0;u<s;++u)o[n]=e[u],i(o)&&(r.push(Ee(o)),o={},o[t]=l);return r}const gS={kde:qb,mixture:jM,normal:jb,lognormal:UM,uniform:qM},U9="distributions",pS="function",j9="field";function tF(e,t){const n=e[pS];ne(gS,n)||O("Unknown distribution function: "+n);const i=gS[n]();for(const r in e)r===j9?i.data((e.from||t()).map(e[r])):r===U9?i[r](e[r].map(o=>tF(o,t))):typeof i[r]===pS&&i[r](e[r]);return i}function sx(e){F.call(this,null,e)}const nF=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],q9={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:nF},{name:"weights",type:"number",array:!0}]};sx.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:nF.concat(q9)},{name:"as",type:"string",array:!0,default:["value","density"]}]};U(sx,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=tF(e.distribution,W9(t)),r=e.steps||e.minsteps||25,o=e.steps||e.maxsteps||200;let s=e.method||"pdf";s!=="pdf"&&s!=="cdf"&&O("Invalid density method: "+s),!e.extent&&!i.data&&O("Missing density extent parameter."),s=i[s];const a=e.as||["value","density"],u=e.extent||Qi(i.data()),l=Yg(s,u,r,o).map(c=>{const f={};return f[a[0]]=c[0],f[a[1]]=c[1],Ee(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function W9(e){return()=>e.materialize(e.SOURCE).source}function iF(e,t){return e?e.map((n,i)=>t[i]||Ge(n)):null}function ax(e,t,n){const i=[],r=f=>f(u);let o,s,a,u,l,c;if(t==null)i.push(e.map(n));else for(o={},s=0,a=e.length;s<a;++s)u=e[s],l=t.map(r),c=o[l],c||(o[l]=c=[],c.dims=l,i.push(c)),c.push(n(u));return i}const rF="bin";function ux(e){F.call(this,null,e)}ux.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:rF}]};const H9=(e,t)=>Jc(Qi(e,t))/30;U(ux,F,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=ax(t.source,e.groupby,Ut),r=e.smooth||!1,o=e.field,s=e.step||H9(n,o),a=fa((g,p)=>o(g)-o(p)),u=e.as||rF,l=i.length;let c=1/0,f=-1/0,d=0,h;for(;d<l;++d){const g=i[d].sort(a);h=-1;for(const p of IM(g,s,r,o))p<c&&(c=p),p>f&&(f=p),g[++h][u]=p}return this.value={start:c,stop:f,step:s},t.reflow(!0).modifies(u)}});function oF(e){Te.call(this,null,G9,e),this.modified(!0)}U(oF,Te);function G9(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Sn(n=>t(n,e),Pt(t),Ge(t))}function lx(e){F.call(this,[void 0,void 0],e)}lx.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};U(lx,F,{transform(e,t){const n=this.value,i=e.field,r=t.changed()||t.modified(i.fields)||e.modified("field");let o=n[0],s=n[1];if((r||o==null)&&(o=1/0,s=-1/0),t.visit(r?t.SOURCE:t.ADD,a=>{const u=Ot(i(a));u!=null&&(u<o&&(o=u),u>s&&(s=u))}),!Number.isFinite(o)||!Number.isFinite(s)){let a=Ge(i);a&&(a=` for field "${a}"`),t.dataflow.warn(`Infinite extent${a}: [${o}, ${s}]`),o=s=void 0}this.value=[o,s]}});function cx(e,t){Te.call(this,e),this.parent=t,this.count=0}U(cx,Te,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function Vg(e){F.call(this,{},e),this._keys=Bu();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}U(Vg,F,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,i){const r=this.value;let o=ne(r,e)&&r[e],s,a;return o?o.value.stamp<n.stamp&&(o.init(n),this.activate(o)):(a=i||(a=this._group[e])&&a.tuple,s=n.dataflow,o=new cx(n.fork(n.NO_SOURCE),this),s.add(o).connect(t(s,e,a)),r[e]=o,this.activate(o)),o},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const i=e[n].detachSubflow;i&&i(),delete e[n],++t}if(t){const n=this._targets.filter(i=>i&&i.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,i=e?e.length:0;let r=0;for(;r<i;++r)t[r]=e[r];for(;r<n&&t[r]!=null;++r)t[r]=null;t.active=i},transform(e,t){const n=t.dataflow,i=e.key,r=e.subflow,o=this._keys,s=e.modified("key"),a=u=>this.subflow(u,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,u=>{const l=ee(u),c=o.get(l);c!==void 0&&(o.delete(l),a(c).rem(u))}),t.visit(t.ADD,u=>{const l=i(u);o.set(ee(u),l),a(l).add(u)}),s||t.modified(i.fields)?t.visit(t.MOD,u=>{const l=ee(u),c=o.get(l),f=i(u);c===f?a(f).mod(u):(o.set(l,f),a(c).rem(u),a(f).add(u))}):t.changed(t.MOD)&&t.visit(t.MOD,u=>{a(o.get(ee(u))).mod(u)}),s&&t.visit(t.REFLOW,u=>{const l=ee(u),c=o.get(l),f=i(u);c!==f&&(o.set(l,f),a(c).rem(u),a(f).add(u))}),t.clean()?n.runAfter(()=>{this.clean(),o.clean()}):o.empty>n.cleanThreshold&&n.runAfter(o.clean),t}});function sF(e){Te.call(this,null,Y9,e)}U(sF,Te);function Y9(e){return this.value&&!e.modified()?this.value:z(e.name)?H(e.name).map(t=>Kn(t)):Kn(e.name,e.as)}function fx(e){F.call(this,Bu(),e)}fx.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};U(fx,F,{transform(e,t){const n=t.dataflow,i=this.value,r=t.fork(),o=r.add,s=r.rem,a=r.mod,u=e.expr;let l=!0;t.visit(t.REM,f=>{const d=ee(f);i.has(d)?i.delete(d):s.push(f)}),t.visit(t.ADD,f=>{u(f,e)?o.push(f):i.set(ee(f),1)});function c(f){const d=ee(f),h=u(f,e),g=i.get(d);h&&g?(i.delete(d),o.push(f)):!h&&!g?(i.set(d,1),s.push(f)):l&&h&&!g&&a.push(f)}return t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}});function dx(e){F.call(this,[],e)}dx.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};U(dx,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=iF(i,e.as||[]),o=e.index||null,s=r.length;return n.rem=this.value,t.visit(t.SOURCE,a=>{const u=i.map(g=>g(a)),l=u.reduce((g,p)=>Math.max(g,p.length),0);let c=0,f,d,h;for(;c<l;++c){for(d=Rb(a),f=0;f<s;++f)d[r[f]]=(h=u[f][c])==null?null:h;o&&(d[o]=c),n.add.push(d)}}),this.value=n.source=n.add,o&&n.modifies(o),n.modifies(r)}});function hx(e){F.call(this,[],e)}hx.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};U(hx,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(Ge),o=e.as||["key","value"],s=o[0],a=o[1],u=i.length;return n.rem=this.value,t.visit(t.SOURCE,l=>{for(let c=0,f;c<u;++c)f=Rb(l),f[s]=r[c],f[a]=i[c](l),n.add.push(f)}),this.value=n.source=n.add,n.modifies(o)}});function gx(e){F.call(this,null,e)}gx.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};U(gx,F,{transform(e,t){const n=e.expr,i=e.as,r=e.modified(),o=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(o,s=>s[i]=n(s,e))}});function aF(e){F.call(this,[],e)}U(aF,F,{transform(e,t){const n=t.fork(t.ALL),i=e.generator;let r=this.value,o=e.size-r.length,s,a,u;if(o>0){for(s=[];--o>=0;)s.push(u=Ee(i(e))),r.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(s):s}else a=r.slice(0,-o),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,r=r.slice(-o);return n.source=this.value=r,n}});const Wf={value:"value",median:OC,mean:$8,min:a1,max:Ts},V9=[];function px(e){F.call(this,[],e)}px.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function X9(e){var t=e.method||Wf.value,n;if(Wf[t]==null)O("Unrecognized imputation method: "+t);else return t===Wf.value?(n=e.value!==void 0?e.value:0,()=>n):Wf[t]}function K9(e){const t=e.field;return n=>n?t(n):NaN}U(px,F,{transform(e,t){var n=t.fork(t.ALL),i=X9(e),r=K9(e),o=Ge(e.field),s=Ge(e.key),a=(e.groupby||[]).map(Ge),u=J9(t.source,e.groupby,e.key,e.keyvals),l=[],c=this.value,f=u.domain.length,d,h,g,p,m,y,b,x,v,w;for(m=0,x=u.length;m<x;++m)for(d=u[m],g=d.values,h=NaN,b=0;b<f;++b)if(d[b]==null){for(p=u.domain[b],w={_impute:!0},y=0,v=g.length;y<v;++y)w[a[y]]=g[y];w[s]=p,w[o]=Number.isNaN(h)?h=i(d,r):h,l.push(Ee(w))}return l.length&&(n.add=n.materialize(n.ADD).add.concat(l)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=l,n}});function J9(e,t,n,i){var r=y=>y(m),o=[],s=i?i.slice():[],a={},u={},l,c,f,d,h,g,p,m;for(s.forEach((y,b)=>a[y]=b+1),d=0,p=e.length;d<p;++d)m=e[d],g=n(m),h=a[g]||(a[g]=s.push(g)),c=(l=t?t.map(r):V9)+"",(f=u[c])||(f=u[c]=[],o.push(f),f.values=l),f[h-1]=m;return o.domain=s,o}function mx(e){Fo.call(this,e)}mx.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:ef},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};U(mx,Fo,{transform(e,t){const n=this,i=e.modified();let r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,o=>n.add(o))):(r=n.value=n.value||this.init(e),t.visit(t.REM,o=>n.rem(o)),t.visit(t.ADD,o=>n.add(o))),n.changes(),t.visit(t.SOURCE,o=>{ae(o,r[n.cellkey(o)].tuple)}),t.reflow(i).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function yx(e){F.call(this,null,e)}yx.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};U(yx,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=ax(i,e.groupby,e.field),o=(e.groupby||[]).map(Ge),s=e.bandwidth,a=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;a!=="pdf"&&a!=="cdf"&&O("Invalid density method: "+a),e.resolve==="shared"&&(c||(c=Qi(i,e.field)),f=d=e.steps||d),r.forEach(h=>{const g=qb(h,s)[a],p=e.counts?h.length:1,m=c||Qi(h);Yg(g,m,f,d).forEach(y=>{const b={};for(let x=0;x<o.length;++x)b[o[x]]=h.dims[x];b[u[0]]=y[0],b[u[1]]=y[1]*p,l.push(Ee(b))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function uF(e){Te.call(this,null,Q9,e)}U(uF,Te);function Q9(e){return this.value&&!e.modified()?this.value:vb(e.fields,e.flat)}function lF(e){F.call(this,[],e),this._pending=null}U(lF,F,{transform(e,t){const n=t.dataflow;return this._pending?Wm(this,t,this._pending):Z9(e)?t.StopPropagation:e.values?Wm(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=H(r.data),o=>o.touch(this)))}:n.request(e.url,e.format).then(i=>Wm(this,t,H(i.data)))}});function Z9(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function Wm(e,t,n){n.forEach(Ee);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function bx(e){F.call(this,{},e)}bx.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};U(bx,F,{transform(e,t){const n=e.fields,i=e.index,r=e.values,o=e.default==null?null:e.default,s=e.modified(),a=n.length;let u=s?t.SOURCE:t.ADD,l=t,c=e.as,f,d,h;return r?(d=r.length,a>1&&!c&&O('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==a*d&&O('The "as" parameter has too few output field names.'),c=c||r.map(Ge),f=function(g){for(var p=0,m=0,y,b;p<a;++p)if(b=i.get(n[p](g)),b==null)for(y=0;y<d;++y,++m)g[c[m]]=o;else for(y=0;y<d;++y,++m)g[c[m]]=r[y](b)}):(c||O("Missing output field names."),f=function(g){for(var p=0,m;p<a;++p)m=i.get(n[p](g)),g[c[p]]=m??o}),s?l=t.reflow(!0):(h=n.some(g=>t.modified(g.fields)),u|=h?t.MOD:0),t.visit(u,f),l.modifies(c)}});function cF(e){Te.call(this,null,e7,e)}U(cF,Te);function e7(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let i=1/0,r=-1/0,o,s;for(o=0;o<n;++o)s=t[o],s[0]<i&&(i=s[0]),s[1]>r&&(r=s[1]);return[i,r]}function fF(e){Te.call(this,null,t7,e)}U(fF,Te);function t7(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function dF(e){F.call(this,null,e)}U(dF,F,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function xx(e){Fo.call(this,e)}xx.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:ef,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};U(xx,Fo,{_transform:Fo.prototype.transform,transform(e,t){return this._transform(n7(e,t),t)}});function n7(e,t){const n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",o=Pt(n).concat(Pt(i)),s=r7(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:s.map(()=>r),fields:s.map(a=>i7(a,n,i,o)),as:s.map(a=>a+""),modified:e.modified.bind(e)}}function i7(e,t,n,i){return Sn(r=>t(r)===e?n(r):NaN,i,e+"")}function r7(e,t,n){const i={},r=[];return n.visit(n.SOURCE,o=>{const s=e(o);i[s]||(i[s]=1,r.push(s))}),r.sort(Dg),t?r.slice(0,t):r}function hF(e){Vg.call(this,e)}U(hF,Vg,{transform(e,t){const n=e.subflow,i=e.field,r=o=>this.subflow(ee(o),n,t,o);return(e.modified("field")||i&&t.modified(Pt(i)))&&O("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,o=>{const s=r(o);i(o).forEach(a=>s.mod(a))}),t.visit(t.ADD,o=>{const s=r(o);i(o).forEach(a=>s.add(Ee(a)))}),t.visit(t.REM,o=>{const s=r(o);i(o).forEach(a=>s.rem(a))})):(t.visit(t.MOD,o=>r(o).mod(o)),t.visit(t.ADD,o=>r(o).add(o)),t.visit(t.REM,o=>r(o).rem(o))),t.clean()&&t.runAfter(()=>this.clean()),t}});function vx(e){F.call(this,null,e)}vx.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};U(vx,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=iF(e.fields,e.as||[]),o=i?(a,u)=>o7(a,u,i,r):Bg;let s;return this.value?s=this.value:(t=t.addAll(),s=this.value={}),t.visit(t.REM,a=>{const u=ee(a);n.rem.push(s[u]),s[u]=null}),t.visit(t.ADD,a=>{const u=o(a,Ee({}));s[ee(a)]=u,n.add.push(u)}),t.visit(t.MOD,a=>{n.mod.push(o(a,s[ee(a)]))}),n}});function o7(e,t,n,i){for(let r=0,o=n.length;r<o;++r)t[i[r]]=n[r](e);return t}function gF(e){F.call(this,null,e)}U(gF,F,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function wx(e){F.call(this,null,e)}wx.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const s7=1e-14;U(wx,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,o=ax(r,e.groupby,e.field),s=(e.groupby||[]).map(Ge),a=[],u=e.step||.01,l=e.probs||Fn(u/2,1-s7,u),c=l.length;return o.forEach(f=>{const d=Lb(f,l);for(let h=0;h<c;++h){const g={};for(let p=0;p<s.length;++p)g[s[p]]=f.dims[p];g[i[0]]=l[h],g[i[1]]=d[h],a.push(Ee(g))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}});function pF(e){F.call(this,null,e)}U(pF,F,{transform(e,t){let n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{const o=ee(r);n.rem.push(i[o]),i[o]=null}),t.visit(t.ADD,r=>{const o=Rb(r);i[ee(r)]=o,n.add.push(o)}),t.visit(t.MOD,r=>{const o=i[ee(r)];for(const s in r)o[s]=r[s],n.modifies(s);n.mod.push(o)})),n}});function _x(e){F.call(this,[],e),this.count=0}_x.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};U(_x,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,o=this.value.reduce((c,f)=>(c[ee(f)]=1,c),{});let s=this.value,a=this.count,u=0;function l(c){let f,d;s.length<r?s.push(c):(d=~~((a+1)*Zn()),d<s.length&&d>=u&&(f=s[d],o[ee(f)]&&n.rem.push(f),s[d]=c)),++a}if(t.rem.length&&(t.visit(t.REM,c=>{const f=ee(c);o[f]&&(o[f]=-1,n.rem.push(c)),--a}),s=s.filter(c=>o[ee(c)]!==-1)),(t.rem.length||i)&&s.length<r&&t.source&&(u=a=s.length,t.visit(t.SOURCE,c=>{o[ee(c)]||l(c)}),u=-1),i&&s.length>r){const c=s.length-r;for(let f=0;f<c;++f)o[ee(s[f])]=-1,n.rem.push(s[f]);s=s.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{o[ee(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=s.filter(c=>!o[ee(c)])),this.count=a,this.value=n.source=s,n}});function Sx(e){F.call(this,null,e)}Sx.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};U(Sx,F,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Fn(e.start,e.stop,e.step||1).map(r=>{const o={};return o[i]=r,Ee(o)}),n.add=t.add.concat(this.value),n}});function mF(e){F.call(this,null,e),this.modified(!0)}U(mF,F,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Ex(e){F.call(this,null,e)}const yF=["unit0","unit1"];Ex.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:$b,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:yF}]};U(Ex,F,{transform(e,t){const n=e.field,i=e.interval!==!1,r=e.timezone==="utc",o=this._floor(e,t),s=(r?Hu:Wu)(o.unit).offset,a=e.as||yF,u=a[0],l=a[1],c=o.step;let f=o.start||1/0,d=o.stop||-1/0,h=t.ADD;return(e.modified()||t.changed(t.REM)||t.modified(Pt(n)))&&(t=t.reflow(!0),h=t.SOURCE,f=1/0,d=-1/0),t.visit(h,g=>{const p=n(g);let m,y;p==null?(g[u]=null,i&&(g[l]=null)):(g[u]=m=y=o(p),i&&(g[l]=y=s(m,c)),m<f&&(f=m),y>d&&(d=y))}),o.start=f,o.stop=d,t.modifies(i?a:u)},_floor(e,t){const n=e.timezone==="utc",{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:aM({extent:e.extent||Qi(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),o=Ab(i),s=this.value||{},a=(n?QC:JC)(o,r);return a.unit=ye(o),a.units=o,a.step=r,a.start=s.start,a.stop=s.stop,this.value=a}});function bF(e){F.call(this,Bu(),e)}U(bF,F,{transform(e,t){const n=t.dataflow,i=e.field,r=this.value,o=a=>r.set(i(a),a);let s=!0;return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,a=>r.delete(i(a))),t.visit(t.ADD,o)):s=!1,this.modified(s),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()}});function xF(e){F.call(this,null,e)}U(xF,F,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(fa(e.sort)):t.source).map(e.field))}});function a7(e,t,n,i){const r=vc[e](t,n);return{init:r.init||fo,update:function(o,s){s[i]=r.next(o)}}}const vc={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){const e=vc.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,i=t.compare;let r=t.index;if(e<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;e=r}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||O("ntile num must be greater than zero.");const n=vc.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{const i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||O("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{const r=i.data;return i.index<=n?t:(n=u7(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function u7(e,t,n){for(let i=t.length;n<i;++n)if(e(t[n])!=null)return n;return-1}const l7=Object.keys(vc);function vF(e){const t=H(e.ops),n=H(e.fields),i=H(e.params),r=H(e.aggregate_params),o=H(e.as),s=this.outputs=[],a=this.windows=[],u={},l={},c=[],f=[];let d=!0;function h(g){H(Pt(g)).forEach(p=>u[p]=1)}h(e.sort),t.forEach((g,p)=>{const m=n[p],y=i[p],b=r[p]||null,x=Ge(m),v=XM(g,x,o[p]);if(h(m),s.push(v),ne(vc,g))a.push(a7(g,m,y,v));else{if(m==null&&g!=="count"&&O("Null aggregate field specified."),g==="count"){c.push(v);return}d=!1;let w=l[x];w||(w=l[x]=[],w.field=m,f.push(w)),w.push(KM(g,b,v))}}),(c.length||f.length)&&(this.cell=c7(f,c,d)),this.inputs=Object.keys(u)}const wF=vF.prototype;wF.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()};wF.update=function(e,t){const n=this.cell,i=this.windows,r=e.data,o=i&&i.length;let s;if(n){for(s=e.p0;s<e.i0;++s)n.rem(r[s]);for(s=e.p1;s<e.i1;++s)n.add(r[s]);n.set(t)}for(s=0;s<o;++s)i[s].update(e,t)};function c7(e,t,n){e=e.map(u=>QM(u,u.field));const i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,o=i.agg=Array(r),s=0;s<r;++s)o[s]=new e[s](i);if(i.store)var a=i.data=new tx;return i.add=function(u){if(i.num+=1,!n){a&&a.add(u);for(let l=0;l<r;++l)o[l].add(o[l].get(u),u)}},i.rem=function(u){if(i.num-=1,!n){a&&a.rem(u);for(let l=0;l<r;++l)o[l].rem(o[l].get(u),u)}},i.set=function(u){let l,c;for(a&&a.values(),l=0,c=t.length;l<c;++l)u[t[l]]=i.num;if(!n)for(l=0,c=o.length;l<c;++l)o[l].set(u)},i.init=function(){i.num=0,a&&a.reset();for(let u=0;u<r;++u)o[u].init()},i}function kx(e){F.call(this,{},e),this._mlen=0,this._mods=[]}kx.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:l7.concat(ef)},{name:"params",type:"number",null:!0,array:!0},{name:"aggregate_params",type:"field",null:!0,array:!0,default:[null]},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};U(kx,F,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),i=fa(e.sort),r=b1(e.groupby),o=a=>this.group(r(a));let s=this.state;(!s||n)&&(s=this.state=new vF(e)),n||t.modified(s.inputs)?(this.value={},t.visit(t.SOURCE,a=>o(a).add(a))):(t.visit(t.REM,a=>o(a).remove(a)),t.visit(t.ADD,a=>o(a).add(a)));for(let a=0,u=this._mlen;a<u;++a)f7(this._mods[a],s,i,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(s.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=ZM(ee),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function f7(e,t,n,i){const r=i.sort,o=r&&!i.ignorePeers,s=i.frame||[null,0],a=e.data(n),u=a.length,l=o?Uu(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:r||jt(-1)};t.init();for(let f=0;f<u;++f)d7(c,s,f,u),o&&h7(c,l),t.update(c,a[f])}function d7(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function h7(e,t){const n=e.i0,i=e.i1-1,r=e.compare,o=e.data,s=o.length-1;n>0&&!r(o[n],o[n-1])&&(e.i0=t.left(o,o[n])),i<s&&!r(o[i],o[i+1])&&(e.i1=t.right(o,o[i]))}const g7=Object.freeze(Object.defineProperty({__proto__:null,aggregate:Fo,bin:nx,collect:ix,compare:eF,countpattern:rx,cross:ox,density:sx,dotbin:ux,expression:oF,extent:lx,facet:Vg,field:sF,filter:fx,flatten:dx,fold:hx,formula:gx,generate:aF,impute:px,joinaggregate:mx,kde:yx,key:uF,load:lF,lookup:bx,multiextent:cF,multivalues:fF,params:dF,pivot:xx,prefacet:hF,project:vx,proxy:gF,quantile:wx,relay:pF,sample:_x,sequence:Sx,sieve:mF,subflow:cx,timeunit:Ex,tupleindex:bF,values:xF,window:kx},Symbol.toStringTag,{value:"Module"}));function ke(e){return function(){return e}}const mS=Math.abs,Ct=Math.atan2,ls=Math.cos,p7=Math.max,Hm=Math.min,zi=Math.sin,As=Math.sqrt,Ft=1e-12,cu=Math.PI,oh=cu/2,_F=2*cu;function m7(e){return e>1?0:e<-1?cu:Math.acos(e)}function yS(e){return e>=1?oh:e<=-1?-oh:Math.asin(e)}const x1=Math.PI,v1=2*x1,vs=1e-6,y7=v1-vs;function SF(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function b7(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return SF;const n=10**t;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}let $x=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?SF:b7(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,o,s){this._append`C${+t},${+n},${+i},${+r},${this._x1=+o},${this._y1=+s}`}arcTo(t,n,i,r,o){if(t=+t,n=+n,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,u=i-t,l=r-n,c=s-t,f=a-n,d=c*c+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(d>vs)if(!(Math.abs(f*u-l*c)>vs)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let h=i-s,g=r-a,p=u*u+l*l,m=h*h+g*g,y=Math.sqrt(p),b=Math.sqrt(d),x=o*Math.tan((x1-Math.acos((p+d-m)/(2*y*b)))/2),v=x/b,w=x/y;Math.abs(v-1)>vs&&this._append`L${t+v*c},${n+v*f}`,this._append`A${o},${o},0,0,${+(f*h>c*g)},${this._x1=t+w*u},${this._y1=n+w*l}`}}arc(t,n,i,r,o,s){if(t=+t,n=+n,i=+i,s=!!s,i<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(r),u=i*Math.sin(r),l=t+a,c=n+u,f=1^s,d=s?r-o:o-r;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>vs||Math.abs(this._y1-c)>vs)&&this._append`L${l},${c}`,i&&(d<0&&(d=d%v1+v1),d>y7?this._append`A${i},${i},0,1,${f},${t-a},${n-u}A${i},${i},0,1,${f},${this._x1=l},${this._y1=c}`:d>vs&&this._append`A${i},${i},0,${+(d>=x1)},${f},${this._x1=t+i*Math.cos(o)},${this._y1=n+i*Math.sin(o)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}};function Xg(){return new $x}Xg.prototype=$x.prototype;function Kg(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new $x(t)}function x7(e){return e.innerRadius}function v7(e){return e.outerRadius}function w7(e){return e.startAngle}function _7(e){return e.endAngle}function S7(e){return e&&e.padAngle}function E7(e,t,n,i,r,o,s,a){var u=n-e,l=i-t,c=s-r,f=a-o,d=f*u-c*l;if(!(d*d<Ft))return d=(c*(t-o)-f*(e-r))/d,[e+d*u,t+d*l]}function Hf(e,t,n,i,r,o,s){var a=e-n,u=t-i,l=(s?o:-o)/As(a*a+u*u),c=l*u,f=-l*a,d=e+c,h=t+f,g=n+c,p=i+f,m=(d+g)/2,y=(h+p)/2,b=g-d,x=p-h,v=b*b+x*x,w=r-o,S=d*p-g*h,_=(x<0?-1:1)*As(p7(0,w*w*v-S*S)),E=(S*x-b*_)/v,A=(-S*b-x*_)/v,k=(S*x+b*_)/v,$=(-S*b+x*_)/v,T=E-m,M=A-y,D=k-m,C=$-y;return T*T+M*M>D*D+C*C&&(E=k,A=$),{cx:E,cy:A,x01:-c,y01:-f,x11:E*(r/w-1),y11:A*(r/w-1)}}function k7(){var e=x7,t=v7,n=ke(0),i=null,r=w7,o=_7,s=S7,a=null,u=Kg(l);function l(){var c,f,d=+e.apply(this,arguments),h=+t.apply(this,arguments),g=r.apply(this,arguments)-oh,p=o.apply(this,arguments)-oh,m=mS(p-g),y=p>g;if(a||(a=c=u()),h<d&&(f=h,h=d,d=f),!(h>Ft))a.moveTo(0,0);else if(m>_F-Ft)a.moveTo(h*ls(g),h*zi(g)),a.arc(0,0,h,g,p,!y),d>Ft&&(a.moveTo(d*ls(p),d*zi(p)),a.arc(0,0,d,p,g,y));else{var b=g,x=p,v=g,w=p,S=m,_=m,E=s.apply(this,arguments)/2,A=E>Ft&&(i?+i.apply(this,arguments):As(d*d+h*h)),k=Hm(mS(h-d)/2,+n.apply(this,arguments)),$=k,T=k,M,D;if(A>Ft){var C=yS(A/d*zi(E)),R=yS(A/h*zi(E));(S-=C*2)>Ft?(C*=y?1:-1,v+=C,w-=C):(S=0,v=w=(g+p)/2),(_-=R*2)>Ft?(R*=y?1:-1,b+=R,x-=R):(_=0,b=x=(g+p)/2)}var W=h*ls(b),V=h*zi(b),J=d*ls(w),he=d*zi(w);if(k>Ft){var Be=h*ls(x),Ze=h*zi(x),at=d*ls(v),qt=d*zi(v),Je;if(m<cu)if(Je=E7(W,V,at,qt,Be,Ze,J,he)){var to=W-Je[0],$a=V-Je[1],as=Be-Je[0],X=Ze-Je[1],le=1/zi(m7((to*as+$a*X)/(As(to*to+$a*$a)*As(as*as+X*X)))/2),fe=As(Je[0]*Je[0]+Je[1]*Je[1]);$=Hm(k,(d-fe)/(le-1)),T=Hm(k,(h-fe)/(le+1))}else $=T=0}_>Ft?T>Ft?(M=Hf(at,qt,W,V,h,T,y),D=Hf(Be,Ze,J,he,h,T,y),a.moveTo(M.cx+M.x01,M.cy+M.y01),T<k?a.arc(M.cx,M.cy,T,Ct(M.y01,M.x01),Ct(D.y01,D.x01),!y):(a.arc(M.cx,M.cy,T,Ct(M.y01,M.x01),Ct(M.y11,M.x11),!y),a.arc(0,0,h,Ct(M.cy+M.y11,M.cx+M.x11),Ct(D.cy+D.y11,D.cx+D.x11),!y),a.arc(D.cx,D.cy,T,Ct(D.y11,D.x11),Ct(D.y01,D.x01),!y))):(a.moveTo(W,V),a.arc(0,0,h,b,x,!y)):a.moveTo(W,V),!(d>Ft)||!(S>Ft)?a.lineTo(J,he):$>Ft?(M=Hf(J,he,Be,Ze,d,-$,y),D=Hf(W,V,at,qt,d,-$,y),a.lineTo(M.cx+M.x01,M.cy+M.y01),$<k?a.arc(M.cx,M.cy,$,Ct(M.y01,M.x01),Ct(D.y01,D.x01),!y):(a.arc(M.cx,M.cy,$,Ct(M.y01,M.x01),Ct(M.y11,M.x11),!y),a.arc(0,0,d,Ct(M.cy+M.y11,M.cx+M.x11),Ct(D.cy+D.y11,D.cx+D.x11),y),a.arc(D.cx,D.cy,$,Ct(D.y11,D.x11),Ct(D.y01,D.x01),!y))):a.arc(0,0,d,w,v,y)}if(a.closePath(),c)return a=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-cu/2;return[ls(f)*c,zi(f)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:ke(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:ke(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:ke(+c),l):n},l.padRadius=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:ke(+c),l):i},l.startAngle=function(c){return arguments.length?(r=typeof c=="function"?c:ke(+c),l):r},l.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:ke(+c),l):o},l.padAngle=function(c){return arguments.length?(s=typeof c=="function"?c:ke(+c),l):s},l.context=function(c){return arguments.length?(a=c??null,l):a},l}function EF(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function kF(e){this._context=e}kF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Ax(e){return new kF(e)}function $F(e){return e[0]}function AF(e){return e[1]}function CF(e,t){var n=ke(!0),i=null,r=Ax,o=null,s=Kg(a);e=typeof e=="function"?e:e===void 0?$F:ke(e),t=typeof t=="function"?t:t===void 0?AF:ke(t);function a(u){var l,c=(u=EF(u)).length,f,d=!1,h;for(i==null&&(o=r(h=s())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+e(f,l,u),+t(f,l,u));if(h)return o=null,h+""||null}return a.x=function(u){return arguments.length?(e=typeof u=="function"?u:ke(+u),a):e},a.y=function(u){return arguments.length?(t=typeof u=="function"?u:ke(+u),a):t},a.defined=function(u){return arguments.length?(n=typeof u=="function"?u:ke(!!u),a):n},a.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),a):r},a.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),a):i},a}function MF(e,t,n){var i=null,r=ke(!0),o=null,s=Ax,a=null,u=Kg(l);e=typeof e=="function"?e:e===void 0?$F:ke(+e),t=typeof t=="function"?t:ke(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?AF:ke(+n);function l(f){var d,h,g,p=(f=EF(f)).length,m,y=!1,b,x=new Array(p),v=new Array(p);for(o==null&&(a=s(b=u())),d=0;d<=p;++d){if(!(d<p&&r(m=f[d],d,f))===y)if(y=!y)h=d,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),g=d-1;g>=h;--g)a.point(x[g],v[g]);a.lineEnd(),a.areaEnd()}y&&(x[d]=+e(m,d,f),v[d]=+t(m,d,f),a.point(i?+i(m,d,f):x[d],n?+n(m,d,f):v[d]))}if(b)return a=null,b+""||null}function c(){return CF().defined(r).curve(s).context(o)}return l.x=function(f){return arguments.length?(e=typeof f=="function"?f:ke(+f),i=null,l):e},l.x0=function(f){return arguments.length?(e=typeof f=="function"?f:ke(+f),l):e},l.x1=function(f){return arguments.length?(i=f==null?null:typeof f=="function"?f:ke(+f),l):i},l.y=function(f){return arguments.length?(t=typeof f=="function"?f:ke(+f),n=null,l):t},l.y0=function(f){return arguments.length?(t=typeof f=="function"?f:ke(+f),l):t},l.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:ke(+f),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(i).y(t)},l.defined=function(f){return arguments.length?(r=typeof f=="function"?f:ke(!!f),l):r},l.curve=function(f){return arguments.length?(s=f,o!=null&&(a=s(o)),l):s},l.context=function(f){return arguments.length?(f==null?o=a=null:a=s(o=f),l):o},l}const $7={draw(e,t){const n=As(t/cu);e.moveTo(n,0),e.arc(0,0,n,0,_F)}};function A7(e,t){let n=null,i=Kg(r);e=typeof e=="function"?e:ke(e||$7),t=typeof t=="function"?t:ke(t===void 0?64:+t);function r(){let o;if(n||(n=o=i()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),o)return n=null,o+""||null}return r.type=function(o){return arguments.length?(e=typeof o=="function"?o:ke(o),r):e},r.size=function(o){return arguments.length?(t=typeof o=="function"?o:ke(+o),r):t},r.context=function(o){return arguments.length?(n=o??null,r):n},r}function Do(){}function sh(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Jg(e){this._context=e}Jg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:sh(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:sh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function C7(e){return new Jg(e)}function FF(e){this._context=e}FF.prototype={areaStart:Do,areaEnd:Do,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:sh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function M7(e){return new FF(e)}function DF(e){this._context=e}DF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:sh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function F7(e){return new DF(e)}function TF(e,t){this._basis=new Jg(e),this._beta=t}TF.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],o=e[n]-i,s=t[n]-r,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(i+u*o),this._beta*t[a]+(1-this._beta)*(r+u*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const D7=function e(t){function n(i){return t===1?new Jg(i):new TF(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function ah(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Cx(e,t){this._context=e,this._k=(1-t)/6}Cx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:ah(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:ah(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const T7=function e(t){function n(i){return new Cx(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Mx(e,t){this._context=e,this._k=(1-t)/6}Mx.prototype={areaStart:Do,areaEnd:Do,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:ah(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const N7=function e(t){function n(i){return new Mx(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Fx(e,t){this._context=e,this._k=(1-t)/6}Fx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ah(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const O7=function e(t){function n(i){return new Fx(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Dx(e,t,n){var i=e._x1,r=e._y1,o=e._x2,s=e._y2;if(e._l01_a>Ft){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,r=(r*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>Ft){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);o=(o*l+e._x1*e._l23_2a-t*e._l12_2a)/c,s=(s*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,o,s,e._x2,e._y2)}function NF(e,t){this._context=e,this._alpha=t}NF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Dx(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const R7=function e(t){function n(i){return t?new NF(i,t):new Cx(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function OF(e,t){this._context=e,this._alpha=t}OF.prototype={areaStart:Do,areaEnd:Do,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Dx(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const z7=function e(t){function n(i){return t?new OF(i,t):new Mx(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function RF(e,t){this._context=e,this._alpha=t}RF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Dx(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const P7=function e(t){function n(i){return t?new RF(i,t):new Fx(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function zF(e){this._context=e}zF.prototype={areaStart:Do,areaEnd:Do,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function L7(e){return new zF(e)}function bS(e){return e<0?-1:1}function xS(e,t,n){var i=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(i||r<0&&-0),s=(n-e._y1)/(r||i<0&&-0),a=(o*r+s*i)/(i+r);return(bS(o)+bS(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(a))||0}function vS(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Gm(e,t,n){var i=e._x0,r=e._y0,o=e._x1,s=e._y1,a=(o-i)/3;e._context.bezierCurveTo(i+a,r+a*t,o-a,s-a*n,o,s)}function uh(e){this._context=e}uh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Gm(this,this._t0,vS(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Gm(this,vS(this,n=xS(this,e,t)),n);break;default:Gm(this,this._t0,n=xS(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function PF(e){this._context=new LF(e)}(PF.prototype=Object.create(uh.prototype)).point=function(e,t){uh.prototype.point.call(this,t,e)};function LF(e){this._context=e}LF.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,o){this._context.bezierCurveTo(t,e,i,n,o,r)}};function I7(e){return new uh(e)}function B7(e){return new PF(e)}function IF(e){this._context=e}IF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=wS(e),r=wS(t),o=0,s=1;s<n;++o,++s)this._context.bezierCurveTo(i[0][o],r[0][o],i[1][o],r[1][o],e[s],t[s]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function wS(e){var t,n=e.length-1,i,r=new Array(n),o=new Array(n),s=new Array(n);for(r[0]=0,o[0]=2,s[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,o[t]=4,s[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,o[n-1]=7,s[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/o[t-1],o[t]-=i,s[t]-=i*s[t-1];for(r[n-1]=s[n-1]/o[n-1],t=n-2;t>=0;--t)r[t]=(s[t]-r[t+1])/o[t];for(o[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)o[t]=2*e[t+1]-r[t+1];return[r,o]}function U7(e){return new IF(e)}function Qg(e,t){this._context=e,this._t=t}Qg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function j7(e){return new Qg(e,.5)}function q7(e){return new Qg(e,0)}function W7(e){return new Qg(e,1)}function ko(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const H7=()=>typeof Image<"u"?Image:null;function ur(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Yo(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const w1=Symbol("implicit");function Tx(){var e=new L_,t=[],n=[],i=w1;function r(o){let s=e.get(o);if(s===void 0){if(i!==w1)return i;e.set(o,s=t.push(o)-1)}return n[s%n.length]}return r.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new L_;for(const s of o)e.has(s)||e.set(s,t.push(s)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return Tx(t,n).unknown(i)},ur.apply(r,arguments),r}function Yu(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function tf(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Vo(){}var Us=.7,fu=1/Us,Xa="\\s*([+-]?\\d+)\\s*",wc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",G7=/^#([0-9a-f]{3,8})$/,Y7=new RegExp(`^rgb\\(${Xa},${Xa},${Xa}\\)$`),V7=new RegExp(`^rgb\\(${Gi},${Gi},${Gi}\\)$`),X7=new RegExp(`^rgba\\(${Xa},${Xa},${Xa},${wc}\\)$`),K7=new RegExp(`^rgba\\(${Gi},${Gi},${Gi},${wc}\\)$`),J7=new RegExp(`^hsl\\(${wc},${Gi},${Gi}\\)$`),Q7=new RegExp(`^hsla\\(${wc},${Gi},${Gi},${wc}\\)$`),_S={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Yu(Vo,_c,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:SS,formatHex:SS,formatHex8:Z7,formatHsl:eL,formatRgb:ES,toString:ES});function SS(){return this.rgb().formatHex()}function Z7(){return this.rgb().formatHex8()}function eL(){return BF(this).formatHsl()}function ES(){return this.rgb().formatRgb()}function _c(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=G7.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?kS(t):n===3?new ct(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Gf(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Gf(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Y7.exec(e))?new ct(t[1],t[2],t[3],1):(t=V7.exec(e))?new ct(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=X7.exec(e))?Gf(t[1],t[2],t[3],t[4]):(t=K7.exec(e))?Gf(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=J7.exec(e))?CS(t[1],t[2]/100,t[3]/100,1):(t=Q7.exec(e))?CS(t[1],t[2]/100,t[3]/100,t[4]):_S.hasOwnProperty(e)?kS(_S[e]):e==="transparent"?new ct(NaN,NaN,NaN,0):null}function kS(e){return new ct(e>>16&255,e>>8&255,e&255,1)}function Gf(e,t,n,i){return i<=0&&(e=t=n=NaN),new ct(e,t,n,i)}function Nx(e){return e instanceof Vo||(e=_c(e)),e?(e=e.rgb(),new ct(e.r,e.g,e.b,e.opacity)):new ct}function To(e,t,n,i){return arguments.length===1?Nx(e):new ct(e,t,n,i??1)}function ct(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Yu(ct,To,tf(Vo,{brighter(e){return e=e==null?fu:Math.pow(fu,e),new ct(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Us:Math.pow(Us,e),new ct(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ct(Ns(this.r),Ns(this.g),Ns(this.b),lh(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$S,formatHex:$S,formatHex8:tL,formatRgb:AS,toString:AS}));function $S(){return`#${Cs(this.r)}${Cs(this.g)}${Cs(this.b)}`}function tL(){return`#${Cs(this.r)}${Cs(this.g)}${Cs(this.b)}${Cs((isNaN(this.opacity)?1:this.opacity)*255)}`}function AS(){const e=lh(this.opacity);return`${e===1?"rgb(":"rgba("}${Ns(this.r)}, ${Ns(this.g)}, ${Ns(this.b)}${e===1?")":`, ${e})`}`}function lh(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ns(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Cs(e){return e=Ns(e),(e<16?"0":"")+e.toString(16)}function CS(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new hi(e,t,n,i)}function BF(e){if(e instanceof hi)return new hi(e.h,e.s,e.l,e.opacity);if(e instanceof Vo||(e=_c(e)),!e)return new hi;if(e instanceof hi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),s=NaN,a=o-r,u=(o+r)/2;return a?(t===o?s=(n-i)/a+(n<i)*6:n===o?s=(i-t)/a+2:s=(t-n)/a+4,a/=u<.5?o+r:2-o-r,s*=60):a=u>0&&u<1?0:s,new hi(s,a,u,e.opacity)}function ch(e,t,n,i){return arguments.length===1?BF(e):new hi(e,t,n,i??1)}function hi(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Yu(hi,ch,tf(Vo,{brighter(e){return e=e==null?fu:Math.pow(fu,e),new hi(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Us:Math.pow(Us,e),new hi(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new ct(Ym(e>=240?e-240:e+120,r,i),Ym(e,r,i),Ym(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new hi(MS(this.h),Yf(this.s),Yf(this.l),lh(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=lh(this.opacity);return`${e===1?"hsl(":"hsla("}${MS(this.h)}, ${Yf(this.s)*100}%, ${Yf(this.l)*100}%${e===1?")":`, ${e})`}`}}));function MS(e){return e=(e||0)%360,e<0?e+360:e}function Yf(e){return Math.max(0,Math.min(1,e||0))}function Ym(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const UF=Math.PI/180,jF=180/Math.PI,fh=18,qF=.96422,WF=1,HF=.82521,GF=4/29,Ka=6/29,YF=3*Ka*Ka,nL=Ka*Ka*Ka;function VF(e){if(e instanceof Yi)return new Yi(e.l,e.a,e.b,e.opacity);if(e instanceof Dr)return XF(e);e instanceof ct||(e=Nx(e));var t=Jm(e.r),n=Jm(e.g),i=Jm(e.b),r=Vm((.2225045*t+.7168786*n+.0606169*i)/WF),o,s;return t===n&&n===i?o=s=r:(o=Vm((.4360747*t+.3850649*n+.1430804*i)/qF),s=Vm((.0139322*t+.0971045*n+.7141733*i)/HF)),new Yi(116*r-16,500*(o-r),200*(r-s),e.opacity)}function dh(e,t,n,i){return arguments.length===1?VF(e):new Yi(e,t,n,i??1)}function Yi(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}Yu(Yi,dh,tf(Vo,{brighter(e){return new Yi(this.l+fh*(e??1),this.a,this.b,this.opacity)},darker(e){return new Yi(this.l-fh*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=qF*Xm(t),e=WF*Xm(e),n=HF*Xm(n),new ct(Km(3.1338561*t-1.6168667*e-.4906146*n),Km(-.9787684*t+1.9161415*e+.033454*n),Km(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Vm(e){return e>nL?Math.pow(e,1/3):e/YF+GF}function Xm(e){return e>Ka?e*e*e:YF*(e-GF)}function Km(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Jm(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function iL(e){if(e instanceof Dr)return new Dr(e.h,e.c,e.l,e.opacity);if(e instanceof Yi||(e=VF(e)),e.a===0&&e.b===0)return new Dr(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*jF;return new Dr(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function hh(e,t,n,i){return arguments.length===1?iL(e):new Dr(e,t,n,i??1)}function Dr(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function XF(e){if(isNaN(e.h))return new Yi(e.l,0,0,e.opacity);var t=e.h*UF;return new Yi(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Yu(Dr,hh,tf(Vo,{brighter(e){return new Dr(this.h,this.c,this.l+fh*(e??1),this.opacity)},darker(e){return new Dr(this.h,this.c,this.l-fh*(e??1),this.opacity)},rgb(){return XF(this).rgb()}}));var KF=-.14861,Ox=1.78277,Rx=-.29227,Zg=-.90649,Sc=1.97294,FS=Sc*Zg,DS=Sc*Ox,TS=Ox*Rx-Zg*KF;function rL(e){if(e instanceof Os)return new Os(e.h,e.s,e.l,e.opacity);e instanceof ct||(e=Nx(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(TS*i+FS*t-DS*n)/(TS+FS-DS),o=i-r,s=(Sc*(n-r)-Rx*o)/Zg,a=Math.sqrt(s*s+o*o)/(Sc*r*(1-r)),u=a?Math.atan2(s,o)*jF-120:NaN;return new Os(u<0?u+360:u,a,r,e.opacity)}function _1(e,t,n,i){return arguments.length===1?rL(e):new Os(e,t,n,i??1)}function Os(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Yu(Os,_1,tf(Vo,{brighter(e){return e=e==null?fu:Math.pow(fu,e),new Os(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Us:Math.pow(Us,e),new Os(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*UF,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new ct(255*(t+n*(KF*i+Ox*r)),255*(t+n*(Rx*i+Zg*r)),255*(t+n*(Sc*i)),this.opacity)}}));function JF(e,t,n,i,r){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*i+s*r)/6}function QF(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],o=e[i+1],s=i>0?e[i-1]:2*r-o,a=i<t-1?e[i+2]:2*o-r;return JF((n-i/t)*t,s,r,o,a)}}function ZF(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],o=e[i%t],s=e[(i+1)%t],a=e[(i+2)%t];return JF((n-i/t)*t,r,o,s,a)}}const ep=e=>()=>e;function e3(e,t){return function(n){return e+n*t}}function oL(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function tp(e,t){var n=t-e;return n?e3(e,n>180||n<-180?n-360*Math.round(n/360):n):ep(isNaN(e)?t:e)}function sL(e){return(e=+e)==1?ft:function(t,n){return n-t?oL(t,n,e):ep(isNaN(t)?n:t)}}function ft(e,t){var n=t-e;return n?e3(e,n):ep(isNaN(e)?t:e)}const S1=function e(t){var n=sL(t);function i(r,o){var s=n((r=To(r)).r,(o=To(o)).r),a=n(r.g,o.g),u=n(r.b,o.b),l=ft(r.opacity,o.opacity);return function(c){return r.r=s(c),r.g=a(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function t3(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),o=new Array(n),s,a;for(s=0;s<n;++s)a=To(t[s]),i[s]=a.r||0,r[s]=a.g||0,o[s]=a.b||0;return i=e(i),r=e(r),o=e(o),a.opacity=1,function(u){return a.r=i(u),a.g=r(u),a.b=o(u),a+""}}}var aL=t3(QF),uL=t3(ZF);function zx(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function n3(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function lL(e,t){return(n3(t)?zx:i3)(e,t)}function i3(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),o=new Array(n),s;for(s=0;s<i;++s)r[s]=Xo(e[s],t[s]);for(;s<n;++s)o[s]=t[s];return function(a){for(s=0;s<i;++s)o[s]=r[s](a);return o}}function r3(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function fi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function o3(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Xo(e[r],t[r]):i[r]=t[r];return function(o){for(r in n)i[r]=n[r](o);return i}}var E1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qm=new RegExp(E1.source,"g");function cL(e){return function(){return e}}function fL(e){return function(t){return e(t)+""}}function s3(e,t){var n=E1.lastIndex=Qm.lastIndex=0,i,r,o,s=-1,a=[],u=[];for(e=e+"",t=t+"";(i=E1.exec(e))&&(r=Qm.exec(t));)(o=r.index)>n&&(o=t.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(i=i[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,u.push({i:s,x:fi(i,r)})),n=Qm.lastIndex;return n<t.length&&(o=t.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?u[0]?fL(u[0].x):cL(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Xo(e,t){var n=typeof t,i;return t==null||n==="boolean"?ep(t):(n==="number"?fi:n==="string"?(i=_c(t))?(t=i,S1):s3:t instanceof _c?S1:t instanceof Date?r3:n3(t)?zx:Array.isArray(t)?i3:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?o3:fi)(e,t)}function dL(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function hL(e,t){var n=tp(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function nf(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var NS=180/Math.PI,k1={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function a3(e,t,n,i,r,o){var s,a,u;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,u/=a),e*i<t*n&&(e=-e,t=-t,u=-u,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*NS,skewX:Math.atan(u)*NS,scaleX:s,scaleY:a}}var Vf;function gL(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?k1:a3(t.a,t.b,t.c,t.d,t.e,t.f)}function pL(e){return e==null||(Vf||(Vf=document.createElementNS("http://www.w3.org/2000/svg","g")),Vf.setAttribute("transform",e),!(e=Vf.transform.baseVal.consolidate()))?k1:(e=e.matrix,a3(e.a,e.b,e.c,e.d,e.e,e.f))}function u3(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function o(l,c,f,d,h,g){if(l!==f||c!==d){var p=h.push("translate(",null,t,null,n);g.push({i:p-4,x:fi(l,f)},{i:p-2,x:fi(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function s(l,c,f,d){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:fi(l,c)})):c&&f.push(r(f)+"rotate("+c+i)}function a(l,c,f,d){l!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:fi(l,c)}):c&&f.push(r(f)+"skewX("+c+i)}function u(l,c,f,d,h,g){if(l!==f||c!==d){var p=h.push(r(h)+"scale(",null,",",null,")");g.push({i:p-4,x:fi(l,f)},{i:p-2,x:fi(c,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(l,c){var f=[],d=[];return l=e(l),c=e(c),o(l.translateX,l.translateY,c.translateX,c.translateY,f,d),s(l.rotate,c.rotate,f,d),a(l.skewX,c.skewX,f,d),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,d),l=c=null,function(h){for(var g=-1,p=d.length,m;++g<p;)f[(m=d[g]).i]=m.x(h);return f.join("")}}}var mL=u3(gL,"px, ","px)","deg)"),yL=u3(pL,", ",")",")"),bL=1e-12;function OS(e){return((e=Math.exp(e))+1/e)/2}function xL(e){return((e=Math.exp(e))-1/e)/2}function vL(e){return((e=Math.exp(2*e))-1)/(e+1)}const wL=function e(t,n,i){function r(o,s){var a=o[0],u=o[1],l=o[2],c=s[0],f=s[1],d=s[2],h=c-a,g=f-u,p=h*h+g*g,m,y;if(p<bL)y=Math.log(d/l)/t,m=function(_){return[a+_*h,u+_*g,l*Math.exp(t*_*y)]};else{var b=Math.sqrt(p),x=(d*d-l*l+i*p)/(2*l*n*b),v=(d*d-l*l-i*p)/(2*d*n*b),w=Math.log(Math.sqrt(x*x+1)-x),S=Math.log(Math.sqrt(v*v+1)-v);y=(S-w)/t,m=function(_){var E=_*y,A=OS(w),k=l/(n*b)*(A*vL(t*E+w)-xL(w));return[a+k*h,u+k*g,l*A/OS(t*E+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return r.rho=function(o){var s=Math.max(.001,+o),a=s*s,u=a*a;return e(s,a,u)},r}(Math.SQRT2,2,4);function l3(e){return function(t,n){var i=e((t=ch(t)).h,(n=ch(n)).h),r=ft(t.s,n.s),o=ft(t.l,n.l),s=ft(t.opacity,n.opacity);return function(a){return t.h=i(a),t.s=r(a),t.l=o(a),t.opacity=s(a),t+""}}}const _L=l3(tp);var SL=l3(ft);function EL(e,t){var n=ft((e=dh(e)).l,(t=dh(t)).l),i=ft(e.a,t.a),r=ft(e.b,t.b),o=ft(e.opacity,t.opacity);return function(s){return e.l=n(s),e.a=i(s),e.b=r(s),e.opacity=o(s),e+""}}function c3(e){return function(t,n){var i=e((t=hh(t)).h,(n=hh(n)).h),r=ft(t.c,n.c),o=ft(t.l,n.l),s=ft(t.opacity,n.opacity);return function(a){return t.h=i(a),t.c=r(a),t.l=o(a),t.opacity=s(a),t+""}}}const kL=c3(tp);var $L=c3(ft);function f3(e){return function t(n){n=+n;function i(r,o){var s=e((r=_1(r)).h,(o=_1(o)).h),a=ft(r.s,o.s),u=ft(r.l,o.l),l=ft(r.opacity,o.opacity);return function(c){return r.h=s(c),r.s=a(c),r.l=u(Math.pow(c,n)),r.opacity=l(c),r+""}}return i.gamma=t,i}(1)}const AL=f3(tp);var CL=f3(ft);function Px(e,t){t===void 0&&(t=e,e=Xo);for(var n=0,i=t.length-1,r=t[0],o=new Array(i<0?0:i);n<i;)o[n]=e(r,r=t[++n]);return function(s){var a=Math.max(0,Math.min(i-1,Math.floor(s*=i)));return o[a](s-a)}}function ML(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}const FL=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Xo,interpolateArray:lL,interpolateBasis:QF,interpolateBasisClosed:ZF,interpolateCubehelix:AL,interpolateCubehelixLong:CL,interpolateDate:r3,interpolateDiscrete:dL,interpolateHcl:kL,interpolateHclLong:$L,interpolateHsl:_L,interpolateHslLong:SL,interpolateHue:hL,interpolateLab:EL,interpolateNumber:fi,interpolateNumberArray:zx,interpolateObject:o3,interpolateRgb:S1,interpolateRgbBasis:aL,interpolateRgbBasisClosed:uL,interpolateRound:nf,interpolateString:s3,interpolateTransformCss:mL,interpolateTransformSvg:yL,interpolateZoom:wL,piecewise:Px,quantize:ML},Symbol.toStringTag,{value:"Module"}));function DL(e){return function(){return e}}function $1(e){return+e}var RS=[0,1];function gn(e){return e}function A1(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:DL(isNaN(t)?NaN:.5)}function TL(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function NL(e,t,n){var i=e[0],r=e[1],o=t[0],s=t[1];return r<i?(i=A1(r,i),o=n(s,o)):(i=A1(i,r),o=n(o,s)),function(a){return o(i(a))}}function OL(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),o=new Array(i),s=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<i;)r[s]=A1(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(a){var u=Co(e,a,1,i)-1;return o[u](r[u](a))}}function rf(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function np(){var e=RS,t=RS,n=Xo,i,r,o,s=gn,a,u,l;function c(){var d=Math.min(e.length,t.length);return s!==gn&&(s=TL(e[0],e[d-1])),a=d>2?OL:NL,u=l=null,f}function f(d){return d==null||isNaN(d=+d)?o:(u||(u=a(e.map(i),t,n)))(i(s(d)))}return f.invert=function(d){return s(r((l||(l=a(t,e.map(i),fi)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,$1),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=nf,c()},f.clamp=function(d){return arguments.length?(s=d?!0:gn,c()):s!==gn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(o=d,f):o},function(d,h){return i=d,r=h,c()}}function d3(){return np()(gn,gn)}function gh(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function du(e){return e=gh(Math.abs(e)),e?e[1]:NaN}function RL(e,t){return function(n,i){for(var r=n.length,o=[],s=0,a=e[0],u=0;r>0&&a>0&&(u+a+1>i&&(a=Math.max(1,i-u)),o.push(n.substring(r-=a,r+a)),!((u+=a+1)>i));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function zL(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var PL=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ec(e){return new Lx(e)}Ec.prototype=Lx.prototype;function Lx(e){if(!(t=PL.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}Lx.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function LL(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(i>0){if(!+e[n])break e;i=0}break}return i>0?e.slice(0,i)+e.slice(r+1):e}var h3;function IL(e,t){var n=gh(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(h3=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+gh(e,Math.max(0,t+o-1))[0]}function zS(e,t){var n=gh(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const PS={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return zS(e*100,t)},r:zS,s:IL,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function LS(e){return e}var IS=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function BL(e){var t=e.grouping&&e.thousands?RL(e.grouping,e.thousands):LS,n=e.currency,i=e.decimal,r=e.numerals?zL(e.numerals):LS,o=e.percent||"%";function s(u){u=Ec(u);var l=u.fill,c=u.align,f=u.sign,d=u.symbol,h=u.zero,g=u.width,p=u.comma,m=u.precision,y=u.trim,b=u.type;b==="n"?(p=!0,b="g"):PS[b]||(m==null&&(m=12),y=!0,b="g"),(h||l==="0"&&c==="=")&&(h=!0,l="0",c="=");var x=d==="$"?n[0]:d==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",v=d==="$"?n[1]:/[%p]/.test(b)?o:"",w=PS[b],S=/[defgprs%]/.test(b);m=m==null?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m));function _(E){var A=x,k=v,$,T,M;if(b==="c")k=w(E)+k,E="";else{E=+E;var D=E<0;if(E=w(Math.abs(E),m),y&&(E=LL(E)),D&&+E==0&&(D=!1),A=(D?f==="("?f:"-":f==="-"||f==="("?"":f)+A,k=(b==="s"?IS[8+h3/3]:"")+k+(D&&f==="("?")":""),S){for($=-1,T=E.length;++$<T;)if(M=E.charCodeAt($),48>M||M>57){k=(M===46?i+E.slice($+1):E.slice($))+k,E=E.slice(0,$);break}}}p&&!h&&(E=t(E,1/0));var C=A.length+E.length+k.length,R=C<g?new Array(g-C+1).join(l):"";switch(p&&h&&(E=t(R+E,R.length?g-k.length:1/0),R=""),c){case"<":E=A+E+k+R;break;case"=":E=A+R+E+k;break;case"^":E=R.slice(0,C=R.length>>1)+A+E+k+R.slice(C);break;default:E=R+A+E+k;break}return r(E)}return _.toString=function(){return u+""},_}function a(u,l){var c=s((u=Ec(u),u.type="f",u)),f=Math.max(-8,Math.min(8,Math.floor(du(l)/3)))*3,d=Math.pow(10,-f),h=IS[8+f/3];return function(g){return c(d*g)+h}}return{format:s,formatPrefix:a}}var Xf,Ix,g3;UL({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function UL(e){return Xf=BL(e),Ix=Xf.format,g3=Xf.formatPrefix,Xf}function jL(e){return Math.max(0,-du(Math.abs(e)))}function qL(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(du(t)/3)))*3-du(Math.abs(e)))}function WL(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,du(t)-du(e))+1}function p3(e,t,n,i){var r=Mo(e,t,n),o;switch(i=Ec(i??",f"),i.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(o=qL(r,s))&&(i.precision=o),g3(i,s)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=WL(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=jL(r))&&(i.precision=o-(i.type==="%")*2);break}}return Ix(i)}function ha(e){var t=e.domain;return e.ticks=function(n){var i=t();return o1(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return p3(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,o=i.length-1,s=i[r],a=i[o],u,l,c=10;for(a<s&&(l=s,s=a,a=l,l=r,r=o,o=l);c-- >0;){if(l=s1(s,a,n),l===u)return i[r]=s,i[o]=a,t(i);if(l>0)s=Math.floor(s/l)*l,a=Math.ceil(a/l)*l;else if(l<0)s=Math.ceil(s*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function m3(){var e=d3();return e.copy=function(){return rf(e,m3())},ur.apply(e,arguments),ha(e)}function y3(e){var t;function n(i){return i==null||isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,$1),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return y3(e).unknown(t)},e=arguments.length?Array.from(e,$1):[0,1],ha(n)}function b3(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],o=e[i],s;return o<r&&(s=n,n=i,i=s,s=r,r=o,o=s),e[n]=t.floor(r),e[i]=t.ceil(o),e}function BS(e){return Math.log(e)}function US(e){return Math.exp(e)}function HL(e){return-Math.log(-e)}function GL(e){return-Math.exp(-e)}function YL(e){return isFinite(e)?+("1e"+e):e<0?0:e}function VL(e){return e===10?YL:e===Math.E?Math.exp:t=>Math.pow(e,t)}function XL(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function jS(e){return(t,n)=>-e(-t,n)}function Bx(e){const t=e(BS,US),n=t.domain;let i=10,r,o;function s(){return r=XL(i),o=VL(i),n()[0]<0?(r=jS(r),o=jS(o),e(HL,GL)):e(BS,US),t}return t.base=function(a){return arguments.length?(i=+a,s()):i},t.domain=function(a){return arguments.length?(n(a),s()):n()},t.ticks=a=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let d=r(l),h=r(c),g,p;const m=a==null?10:+a;let y=[];if(!(i%1)&&h-d<m){if(d=Math.floor(d),h=Math.ceil(h),l>0){for(;d<=h;++d)for(g=1;g<i;++g)if(p=d<0?g/o(-d):g*o(d),!(p<l)){if(p>c)break;y.push(p)}}else for(;d<=h;++d)for(g=i-1;g>=1;--g)if(p=d>0?g/o(-d):g*o(d),!(p<l)){if(p>c)break;y.push(p)}y.length*2<m&&(y=o1(l,c,m))}else y=o1(d,h,Math.min(h-d,m)).map(o);return f?y.reverse():y},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=i===10?"s":","),typeof u!="function"&&(!(i%1)&&(u=Ec(u)).precision==null&&(u.trim=!0),u=Ix(u)),a===1/0)return u;const l=Math.max(1,i*a/t.ticks().length);return c=>{let f=c/o(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=l?u(c):""}},t.nice=()=>n(b3(n(),{floor:a=>o(Math.floor(r(a))),ceil:a=>o(Math.ceil(r(a)))})),t}function x3(){const e=Bx(np()).domain([1,10]);return e.copy=()=>rf(e,x3()).base(e.base()),ur.apply(e,arguments),e}function qS(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function WS(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Ux(e){var t=1,n=e(qS(t),WS(t));return n.constant=function(i){return arguments.length?e(qS(t=+i),WS(t)):t},ha(n)}function v3(){var e=Ux(np());return e.copy=function(){return rf(e,v3()).constant(e.constant())},ur.apply(e,arguments)}function HS(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function KL(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function JL(e){return e<0?-e*e:e*e}function jx(e){var t=e(gn,gn),n=1;function i(){return n===1?e(gn,gn):n===.5?e(KL,JL):e(HS(n),HS(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},ha(t)}function qx(){var e=jx(np());return e.copy=function(){return rf(e,qx()).exponent(e.exponent())},ur.apply(e,arguments),e}function QL(){return qx.apply(null,arguments).exponent(.5)}function w3(){var e=[],t=[],n=[],i;function r(){var s=0,a=Math.max(1,t.length);for(n=new Array(a-1);++s<a;)n[s-1]=NC(e,s/a);return o}function o(s){return s==null||isNaN(s=+s)?i:t[Co(n,s)]}return o.invertExtent=function(s){var a=t.indexOf(s);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let a of s)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Or),r()},o.range=function(s){return arguments.length?(t=Array.from(s),r()):t.slice()},o.unknown=function(s){return arguments.length?(i=s,o):i},o.quantiles=function(){return n.slice()},o.copy=function(){return w3().domain(e).range(t).unknown(i)},ur.apply(o,arguments)}function _3(){var e=0,t=1,n=1,i=[.5],r=[0,1],o;function s(u){return u!=null&&u<=u?r[Co(i,u,0,n)]:o}function a(){var u=-1;for(i=new Array(n);++u<n;)i[u]=((u+1)*t-(u-n)*e)/(n+1);return s}return s.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},s.range=function(u){return arguments.length?(n=(r=Array.from(u)).length-1,a()):r.slice()},s.invertExtent=function(u){var l=r.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,i[0]]:l>=n?[i[n-1],t]:[i[l-1],i[l]]},s.unknown=function(u){return arguments.length&&(o=u),s},s.thresholds=function(){return i.slice()},s.copy=function(){return _3().domain([e,t]).range(r).unknown(o)},ur.apply(ha(s),arguments)}function S3(){var e=[.5],t=[0,1],n,i=1;function r(o){return o!=null&&o<=o?t[Co(e,o,0,i)]:n}return r.domain=function(o){return arguments.length?(e=Array.from(o),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(o){return arguments.length?(t=Array.from(o),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return S3().domain(e).range(t).unknown(n)},ur.apply(r,arguments)}function ZL(e){return new Date(e)}function eI(e){return e instanceof Date?+e:+new Date(+e)}function Wx(e,t,n,i,r,o,s,a,u,l){var c=d3(),f=c.invert,d=c.domain,h=l(".%L"),g=l(":%S"),p=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),b=l("%b %d"),x=l("%B"),v=l("%Y");function w(S){return(u(S)<S?h:a(S)<S?g:s(S)<S?p:o(S)<S?m:i(S)<S?r(S)<S?y:b:n(S)<S?x:v)(S)}return c.invert=function(S){return new Date(f(S))},c.domain=function(S){return arguments.length?d(Array.from(S,eI)):d().map(ZL)},c.ticks=function(S){var _=d();return e(_[0],_[_.length-1],S??10)},c.tickFormat=function(S,_){return _==null?w:l(_)},c.nice=function(S){var _=d();return(!S||typeof S.range!="function")&&(S=t(_[0],_[_.length-1],S??10)),S?d(b3(_,S)):c},c.copy=function(){return rf(c,Wx(e,t,n,i,r,o,s,a,u,l))},c}function tI(){return ur.apply(Wx(J8,Q8,Zi,mc,ju,Rr,Og,Tg,Fr,Mb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function nI(){return ur.apply(Wx(X8,K8,er,yc,qu,So,Rg,Ng,Fr,Fb).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function ip(){var e=0,t=1,n,i,r,o,s=gn,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:s(r===0?.5:(f=(o(f)-n)*r,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=o(e=+e),i=o(t=+t),r=n===i?0:1/(i-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(s=f,l):s};function c(f){return function(d){var h,g;return arguments.length?([h,g]=d,s=f(h,g),l):[s(0),s(1)]}}return l.range=c(Xo),l.rangeRound=c(nf),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return o=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),l}}function Ko(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Hx(){var e=ha(ip()(gn));return e.copy=function(){return Ko(e,Hx())},Yo.apply(e,arguments)}function E3(){var e=Bx(ip()).domain([1,10]);return e.copy=function(){return Ko(e,E3()).base(e.base())},Yo.apply(e,arguments)}function k3(){var e=Ux(ip());return e.copy=function(){return Ko(e,k3()).constant(e.constant())},Yo.apply(e,arguments)}function Gx(){var e=jx(ip());return e.copy=function(){return Ko(e,Gx()).exponent(e.exponent())},Yo.apply(e,arguments)}function iI(){return Gx.apply(null,arguments).exponent(.5)}function rp(){var e=0,t=.5,n=1,i=1,r,o,s,a,u,l=gn,c,f=!1,d;function h(p){return isNaN(p=+p)?d:(p=.5+((p=+c(p))-o)*(i*p<i*o?a:u),l(f?Math.max(0,Math.min(1,p)):p))}h.domain=function(p){return arguments.length?([e,t,n]=p,r=c(e=+e),o=c(t=+t),s=c(n=+n),a=r===o?0:.5/(o-r),u=o===s?0:.5/(s-o),i=o<r?-1:1,h):[e,t,n]},h.clamp=function(p){return arguments.length?(f=!!p,h):f},h.interpolator=function(p){return arguments.length?(l=p,h):l};function g(p){return function(m){var y,b,x;return arguments.length?([y,b,x]=m,l=Px(p,[y,b,x]),h):[l(0),l(.5),l(1)]}}return h.range=g(Xo),h.rangeRound=g(nf),h.unknown=function(p){return arguments.length?(d=p,h):d},function(p){return c=p,r=p(e),o=p(t),s=p(n),a=r===o?0:.5/(o-r),u=o===s?0:.5/(s-o),i=o<r?-1:1,h}}function $3(){var e=ha(rp()(gn));return e.copy=function(){return Ko(e,$3())},Yo.apply(e,arguments)}function A3(){var e=Bx(rp()).domain([.1,1,10]);return e.copy=function(){return Ko(e,A3()).base(e.base())},Yo.apply(e,arguments)}function C3(){var e=Ux(rp());return e.copy=function(){return Ko(e,C3()).constant(e.constant())},Yo.apply(e,arguments)}function Yx(){var e=jx(rp());return e.copy=function(){return Ko(e,Yx()).exponent(e.exponent())},Yo.apply(e,arguments)}function rI(){return Yx.apply(null,arguments).exponent(.5)}function Vx(e,t,n){const i=e-t+n*2;return e?i>0?i:1:0}const oI="identity",hu="linear",jr="log",of="pow",sf="sqrt",op="symlog",js="time",qs="utc",Vi="sequential",Vu="diverging",gu="quantile",sp="quantize",ap="threshold",Xx="ordinal",C1="point",M3="band",Kx="bin-ordinal",st="continuous",af="discrete",uf="discretizing",ii="interpolating",Jx="temporal";function sI(e){return function(t){let n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function aI(e){return function(t){const n=e.range();let i=t[0],r=t[1],o=-1,s,a,u,l;for(r<i&&(a=i,i=r,r=a),u=0,l=n.length;u<l;++u)n[u]>=i&&n[u]<=r&&(o<0&&(o=u),s=u);if(!(o<0))return i=e.invertExtent(n[o]),r=e.invertExtent(n[s]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]]}}function Qx(){const e=Tx().unknown(void 0),t=e.domain,n=e.range;let i=[0,1],r,o,s=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,d=i[1]<i[0],h=i[1-d],g=Vx(f,a,u);let p=i[d-0];r=(h-p)/(g||1),s&&(r=Math.floor(r)),p+=(h-p-r*(f-a))*l,o=r*(1-a),s&&(p=Math.round(p),o=Math.round(o));const m=Fn(f).map(y=>p+r*y);return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],s=!0,c()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(f){return arguments.length?(s=!!f,c()):s},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const d=i[1]<i[0],h=d?n().reverse():n(),g=h.length-1;let p=+f[0],m=+f[1],y,b,x;if(!(p!==p||m!==m)&&(m<p&&(x=p,p=m,m=x),!(m<h[0]||p>i[1-d])))return y=Math.max(0,Co(h,p)-1),b=p===m?y:Co(h,m)-1,p-h[y]>o+1e-10&&++y,d&&(x=y,y=g-b,b=g-x),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return Qx().domain(t()).range(i).round(s).paddingInner(a).paddingOuter(u).align(l)},c()}function F3(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return F3(t())},e}function uI(){return F3(Qx().paddingInner(1))}var lI=Array.prototype.map;function cI(e){return lI.call(e,Ot)}const fI=Array.prototype.slice;function D3(){let e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(Co(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=cI(i),n):e.slice()},n.range=function(i){return arguments.length?(t=fI.call(i),n):t.slice()},n.tickFormat=function(i,r){return p3(e[0],ye(e),i??10,r)},n.copy=function(){return D3().domain(n.domain()).range(n.range())},n}const ph=new Map,T3=Symbol("vega_scale");function N3(e){return e[T3]=!0,e}function dI(e){return e&&e[T3]===!0}function hI(e,t,n){const i=function(){const o=t();return o.invertRange||(o.invertRange=o.invert?sI(o):o.invertExtent?aI(o):void 0),o.type=e,N3(o)};return i.metadata=Si(H(n)),i}function _e(e,t,n){return arguments.length>1?(ph.set(e,hI(e,t,n)),this):O3(e)?ph.get(e):void 0}_e(oI,y3);_e(hu,m3,st);_e(jr,x3,[st,jr]);_e(of,qx,st);_e(sf,QL,st);_e(op,v3,st);_e(js,tI,[st,Jx]);_e(qs,nI,[st,Jx]);_e(Vi,Hx,[st,ii]);_e(`${Vi}-${hu}`,Hx,[st,ii]);_e(`${Vi}-${jr}`,E3,[st,ii,jr]);_e(`${Vi}-${of}`,Gx,[st,ii]);_e(`${Vi}-${sf}`,iI,[st,ii]);_e(`${Vi}-${op}`,k3,[st,ii]);_e(`${Vu}-${hu}`,$3,[st,ii]);_e(`${Vu}-${jr}`,A3,[st,ii,jr]);_e(`${Vu}-${of}`,Yx,[st,ii]);_e(`${Vu}-${sf}`,rI,[st,ii]);_e(`${Vu}-${op}`,C3,[st,ii]);_e(gu,w3,[uf,gu]);_e(sp,_3,uf);_e(ap,S3,uf);_e(Kx,D3,[af,uf]);_e(Xx,Tx,af);_e(M3,Qx,af);_e(C1,uI,af);function O3(e){return ph.has(e)}function ga(e,t){const n=ph.get(e);return n&&n.metadata[t]}function Zx(e){return ga(e,st)}function pu(e){return ga(e,af)}function M1(e){return ga(e,uf)}function R3(e){return ga(e,jr)}function gI(e){return ga(e,Jx)}function z3(e){return ga(e,ii)}function P3(e){return ga(e,gu)}const pI=["clamp","base","constant","exponent"];function L3(e,t){const n=t[0],i=ye(t)-n;return function(r){return e(n+r*i)}}function up(e,t,n){return Px(ev(t||"rgb",n),e)}function I3(e,t){const n=new Array(t),i=t+1;for(let r=0;r<t;)n[r]=e(++r/i);return n}function B3(e,t,n){const i=n-t;let r,o,s;return!i||!Number.isFinite(i)?jt(.5):(r=(o=e.type).indexOf("-"),o=r<0?o:o.slice(r+1),s=_e(o)().domain([t,n]).range([0,1]),pI.forEach(a=>e[a]?s[a](e[a]()):0),s)}function ev(e,t){const n=FL[mI(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function mI(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const yI={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},bI={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function U3(e){const t=e.length/6|0,n=new Array(t);for(let i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function j3(e,t){for(const n in e)tv(n,t(e[n]))}const GS={};j3(bI,U3);j3(yI,e=>up(U3(e)));function tv(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(GS[e]=t,this):GS[e]}const Ad="symbol",xI="discrete",vI="gradient",wI=e=>z(e)?e.map(t=>String(t)):String(e),_I=(e,t)=>e[1]-t[1],SI=(e,t)=>t[1]-e[1];function nv(e,t,n){let i;return xe(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Jc(e.domain())/n||1)+1))),G(t)&&(i=t.step,t=t.interval),Y(t)&&(t=e.type===js?Wu(t):e.type==qs?Hu(t):O("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function q3(e,t,n){let i=e.range(),r=i[0],o=ye(i),s=_I;if(r>o&&(i=o,o=r,r=i,s=SI),r=Math.floor(r),o=Math.ceil(o),t=t.map(a=>[a,e(a)]).filter(a=>r<=a[1]&&a[1]<=o).sort(s).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],ye(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function iv(e,t){return e.bins?q3(e,e.bins):e.ticks?e.ticks(t):e.domain()}function W3(e,t,n,i,r,o){const s=t.type;let a=wI;if(s===js||r===js)a=e.timeFormat(i);else if(s===qs||r===qs)a=e.utcFormat(i);else if(R3(s)){const u=e.formatFloat(i);if(o||t.bins)a=u;else{const l=H3(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,i)}else i&&(a=e.format(i));return a}function H3(e,t,n){const i=iv(e,t),r=e.base(),o=Math.log(r),s=Math.max(1,r*t/i.length),a=u=>{let l=u/Math.pow(r,Math.round(Math.log(u)/o));return l*r<r-.5&&(l*=r),l<=s};return n?i.filter(a):a}const F1={[gu]:"quantiles",[sp]:"thresholds",[ap]:"domain"},G3={[gu]:"quantiles",[sp]:"domain"};function Y3(e,t){return e.bins?$I(e.bins):e.type===jr?H3(e,t,!0):F1[e.type]?kI(e[F1[e.type]]()):iv(e,t)}function EI(e,t,n){const i=t[G3[t.type]](),r=i.length;let o=r>1?i[1]-i[0]:i[0],s;for(s=1;s<r;++s)o=Math.min(o,i[s]-i[s-1]);return e.formatSpan(0,o,3*10,n)}function kI(e){const t=[-1/0].concat(e);return t.max=1/0,t}function $I(e){const t=e.slice(0,-1);return t.max=ye(e),t}const AI=e=>F1[e.type]||e.bins;function V3(e,t,n,i,r,o,s){const a=G3[t.type]&&o!==js&&o!==qs?EI(e,t,r):W3(e,t,n,r,o,s);return i===Ad&&AI(t)?CI(a):i===xI?MI(a):FI(a)}const CI=e=>(t,n,i)=>{const r=YS(i[n+1],YS(i.max,1/0)),o=VS(t,e),s=VS(r,e);return o&&s?o+" – "+s:s?"< "+s:"≥ "+o},YS=(e,t)=>e??t,MI=e=>(t,n)=>n?e(t):null,FI=e=>t=>e(t),VS=(e,t)=>Number.isFinite(e)?t(e):null;function DI(e){const t=e.domain(),n=t.length-1;let i=+t[0],r=+ye(t),o=r-i;if(e.type===ap){const s=n?o/n:.1;i-=s,r+=s,o=r-i}return s=>(s-i)/o}function TI(e,t,n,i){const r=i||t.type;return Y(n)&&gI(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===js?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===qs?e.utcFormat("%A, %d %B %Y, %X UTC"):V3(e,t,5,null,n,i,!0)}function X3(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=TI(e,t,n.format,n.formatType);if(M1(t.type)){const o=Y3(t).slice(1).map(r),s=o.length;return`${s} boundar${s===1?"y":"ies"}: ${o.join(", ")}`}else if(pu(t.type)){const o=t.domain(),s=o.length,a=s>i?o.slice(0,i-2).map(r).join(", ")+", ending with "+o.slice(-1).map(r):o.map(r).join(", ");return`${s} value${s===1?"":"s"}: ${a}`}else{const o=t.domain();return`values from ${r(o[0])} to ${r(ye(o))}`}}let K3=0;function NI(){K3=0}const mh="p_";function rv(e){return e&&e.gradient}function J3(e,t,n){const i=e.gradient;let r=e.id,o=i==="radial"?mh:"";return r||(r=e.id="gradient_"+K3++,i==="radial"?(e.x1=Pi(e.x1,.5),e.y1=Pi(e.y1,.5),e.r1=Pi(e.r1,0),e.x2=Pi(e.x2,.5),e.y2=Pi(e.y2,.5),e.r2=Pi(e.r2,.5),o=mh):(e.x1=Pi(e.x1,0),e.y1=Pi(e.y1,0),e.x2=Pi(e.x2,1),e.y2=Pi(e.y2,0))),t[r]=e,"url("+(n||"")+"#"+o+r+")"}function Pi(e,t){return e??t}function Q3(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,o){return n.push({offset:r,color:o}),i}}}const XS={basis:{curve:C7},"basis-closed":{curve:M7},"basis-open":{curve:F7},bundle:{curve:D7,tension:"beta",value:.85},cardinal:{curve:T7,tension:"tension",value:0},"cardinal-open":{curve:O7,tension:"tension",value:0},"cardinal-closed":{curve:N7,tension:"tension",value:0},"catmull-rom":{curve:R7,tension:"alpha",value:.5},"catmull-rom-closed":{curve:z7,tension:"alpha",value:.5},"catmull-rom-open":{curve:P7,tension:"alpha",value:.5},linear:{curve:Ax},"linear-closed":{curve:L7},monotone:{horizontal:B7,vertical:I7},natural:{curve:U7},step:{curve:j7},"step-after":{curve:W7},"step-before":{curve:q7}};function ov(e,t,n){var i=ne(XS,e)&&XS[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}const OI={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},RI=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,zI=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,PI=/^((\s+,?\s*)|(,\s*))/,LI=/^[01]/;function mu(e){const t=[];return(e.match(RI)||[]).forEach(i=>{let r=i[0];const o=r.toLowerCase(),s=OI[o],a=II(o,s,i.slice(1).trim()),u=a.length;if(u<s||u&&u%s!==0)throw Error("Invalid SVG path, incorrect parameter count");if(t.push([r,...a.slice(0,s)]),u!==s){o==="m"&&(r=r==="M"?"L":"l");for(let l=s;l<u;l+=s)t.push([r,...a.slice(l,l+s)])}}),t}function II(e,t,n){const i=[];for(let r=0;t&&r<n.length;)for(let o=0;o<t;++o){const s=e==="a"&&(o===3||o===4)?LI:zI,a=n.slice(r).match(s);if(a===null)throw Error("Invalid SVG path, incorrect parameter type");r+=a[0].length,i.push(+a[0]);const u=n.slice(r).match(PI);u!==null&&(r+=u[0].length)}return i}const No=Math.PI/180,BI=1e-14,Ss=Math.PI/2,ji=Math.PI*2,Ma=Math.sqrt(3)/2;var Zm={},e0={},Z3=[].join;function UI(e,t,n,i,r,o,s,a,u){const l=Z3.call(arguments);if(Zm[l])return Zm[l];const c=s*No,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),i=Math.abs(i);const h=d*(a-e)*.5+f*(u-t)*.5,g=d*(u-t)*.5-f*(a-e)*.5;let p=h*h/(n*n)+g*g/(i*i);p>1&&(p=Math.sqrt(p),n*=p,i*=p);const m=d/n,y=f/n,b=-f/i,x=d/i,v=m*a+y*u,w=b*a+x*u,S=m*e+y*t,_=b*e+x*t;let A=1/((S-v)*(S-v)+(_-w)*(_-w))-.25;A<0&&(A=0);let k=Math.sqrt(A);o==r&&(k=-k);const $=.5*(v+S)-k*(_-w),T=.5*(w+_)+k*(S-v),M=Math.atan2(w-T,v-$);let C=Math.atan2(_-T,S-$)-M;C<0&&o===1?C+=ji:C>0&&o===0&&(C-=ji);const R=Math.ceil(Math.abs(C/(Ss+.001))),W=[];for(let V=0;V<R;++V){const J=M+V*C/R,he=M+(V+1)*C/R;W[V]=[$,T,J,he,n,i,f,d]}return Zm[l]=W}function jI(e){const t=Z3.call(e);if(e0[t])return e0[t];var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7];const c=l*s,f=-u*a,d=u*s,h=l*a,g=Math.cos(r),p=Math.sin(r),m=Math.cos(o),y=Math.sin(o),b=.5*(o-r),x=Math.sin(b*.5),v=8/3*x*x/Math.sin(b),w=n+g-v*p,S=i+p+v*g,_=n+m,E=i+y,A=_+v*y,k=E-v*m;return e0[t]=[c*w+f*S,d*w+h*S,c*A+f*k,d*A+h*k,c*_+f*E,d*_+h*E]}const Bn=["l",0,0,0,0,0,0,0];function qI(e,t,n){const i=Bn[0]=e[0];if(i==="a"||i==="A")Bn[1]=t*e[1],Bn[2]=n*e[2],Bn[3]=e[3],Bn[4]=e[4],Bn[5]=e[5],Bn[6]=t*e[6],Bn[7]=n*e[7];else if(i==="h"||i==="H")Bn[1]=t*e[1];else if(i==="v"||i==="V")Bn[1]=n*e[1];else for(var r=1,o=e.length;r<o;++r)Bn[r]=(r%2==1?t:n)*e[r];return Bn}function kc(e,t,n,i,r,o){var s,a=null,u=0,l=0,c=0,f=0,d,h,g,p,m=0,y=0;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),o==null&&(o=r),e.beginPath&&e.beginPath();for(var b=0,x=t.length;b<x;++b){switch(s=t[b],(r!==1||o!==1)&&(s=qI(s,r,o)),s[0]){case"l":u+=s[1],l+=s[2],e.lineTo(u+n,l+i);break;case"L":u=s[1],l=s[2],e.lineTo(u+n,l+i);break;case"h":u+=s[1],e.lineTo(u+n,l+i);break;case"H":u=s[1],e.lineTo(u+n,l+i);break;case"v":l+=s[1],e.lineTo(u+n,l+i);break;case"V":l=s[1],e.lineTo(u+n,l+i);break;case"m":u+=s[1],l+=s[2],m=u,y=l,e.moveTo(u+n,l+i);break;case"M":u=s[1],l=s[2],m=u,y=l,e.moveTo(u+n,l+i);break;case"c":d=u+s[5],h=l+s[6],c=u+s[3],f=l+s[4],e.bezierCurveTo(u+s[1]+n,l+s[2]+i,c+n,f+i,d+n,h+i),u=d,l=h;break;case"C":u=s[5],l=s[6],c=s[3],f=s[4],e.bezierCurveTo(s[1]+n,s[2]+i,c+n,f+i,u+n,l+i);break;case"s":d=u+s[3],h=l+s[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,u+s[1]+n,l+s[2]+i,d+n,h+i),c=u+s[1],f=l+s[2],u=d,l=h;break;case"S":d=s[3],h=s[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,s[1]+n,s[2]+i,d+n,h+i),u=d,l=h,c=s[1],f=s[2];break;case"q":d=u+s[3],h=l+s[4],c=u+s[1],f=l+s[2],e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h;break;case"Q":d=s[3],h=s[4],e.quadraticCurveTo(s[1]+n,s[2]+i,d+n,h+i),u=d,l=h,c=s[1],f=s[2];break;case"t":d=u+s[1],h=l+s[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-g,f=2*l-p):a[0]==="q"&&(c=2*u-c,f=2*l-f),g=c,p=f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h,c=u+s[1],f=l+s[2];break;case"T":d=s[1],h=s[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h;break;case"a":KS(e,u+n,l+i,[s[1],s[2],s[3],s[4],s[5],s[6]+u+n,s[7]+l+i]),u+=s[6],l+=s[7];break;case"A":KS(e,u+n,l+i,[s[1],s[2],s[3],s[4],s[5],s[6]+n,s[7]+i]),u=s[6],l=s[7];break;case"z":case"Z":u=m,l=y,e.closePath();break}a=s}}function KS(e,t,n,i){const r=UI(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n);for(let o=0;o<r.length;++o){const s=jI(r[o]);e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5])}}const JS=.5773502691896257,QS={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,ji)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,o=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-o),e.lineTo(r,-o),e.lineTo(0,-n),e.lineTo(-r,-o),e.lineTo(-i,-o),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ma*n,r=i-n*JS,o=n/4;e.moveTo(0,-i-r),e.lineTo(-o,i-r),e.lineTo(o,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ma*n,r=i-n*JS;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ma*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ma*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ma*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ma*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function eD(e){return ne(QS,e)?QS[e]:WI(e)}var t0={};function WI(e){if(!ne(t0,e)){const t=mu(e);t0[e]={draw:function(n,i){kc(n,t,0,0,Math.sqrt(i)/2)}}}return t0[e]}const no=.448084975506;function HI(e){return e.x}function GI(e){return e.y}function YI(e){return e.width}function VI(e){return e.height}function xr(e){return typeof e=="function"?e:()=>+e}function Kf(e,t,n){return Math.max(t,Math.min(e,n))}function tD(){var e=HI,t=GI,n=YI,i=VI,r=xr(0),o=r,s=r,a=r,u=null;function l(c,f,d){var h,g=f??+e.call(this,c),p=d??+t.call(this,c),m=+n.call(this,c),y=+i.call(this,c),b=Math.min(m,y)/2,x=Kf(+r.call(this,c),0,b),v=Kf(+o.call(this,c),0,b),w=Kf(+s.call(this,c),0,b),S=Kf(+a.call(this,c),0,b);if(u||(u=h=Xg()),x<=0&&v<=0&&w<=0&&S<=0)u.rect(g,p,m,y);else{var _=g+m,E=p+y;u.moveTo(g+x,p),u.lineTo(_-v,p),u.bezierCurveTo(_-no*v,p,_,p+no*v,_,p+v),u.lineTo(_,E-S),u.bezierCurveTo(_,E-no*S,_-no*S,E,_-S,E),u.lineTo(g+w,E),u.bezierCurveTo(g+no*w,E,g,E-no*w,g,E-w),u.lineTo(g,p+x),u.bezierCurveTo(g,p+no*x,g+no*x,p,g+x,p),u.closePath()}if(h)return u=null,h+""||null}return l.x=function(c){return arguments.length?(e=xr(c),l):e},l.y=function(c){return arguments.length?(t=xr(c),l):t},l.width=function(c){return arguments.length?(n=xr(c),l):n},l.height=function(c){return arguments.length?(i=xr(c),l):i},l.cornerRadius=function(c,f,d,h){return arguments.length?(r=xr(c),o=f!=null?xr(f):r,a=d!=null?xr(d):r,s=h!=null?xr(h):o,l):r},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function nD(){var e,t,n,i,r=null,o,s,a,u;function l(f,d,h){const g=h/2;if(o){var p=a-d,m=f-s;if(p||m){var y=Math.hypot(p,m),b=(p/=y)*u,x=(m/=y)*u,v=Math.atan2(m,p);r.moveTo(s-b,a-x),r.lineTo(f-p*g,d-m*g),r.arc(f,d,g,v-Math.PI,v),r.lineTo(s+b,a+x),r.arc(s,a,u,v,v+Math.PI)}else r.arc(f,d,g,0,ji);r.closePath()}else o=1;s=f,a=d,u=g}function c(f){var d,h=f.length,g,p=!1,m;for(r==null&&(r=m=Xg()),d=0;d<=h;++d)!(d<h&&i(g=f[d],d,f))===p&&(p=!p)&&(o=0),p&&l(+e(g,d,f),+t(g,d,f),+n(g,d,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function lf(e,t){return e??t}const cf=e=>e.x||0,ff=e=>e.y||0,XI=e=>e.width||0,KI=e=>e.height||0,JI=e=>(e.x||0)+(e.width||0),QI=e=>(e.y||0)+(e.height||0),ZI=e=>e.startAngle||0,eB=e=>e.endAngle||0,tB=e=>e.padAngle||0,nB=e=>e.innerRadius||0,iB=e=>e.outerRadius||0,rB=e=>e.cornerRadius||0,oB=e=>lf(e.cornerRadiusTopLeft,e.cornerRadius)||0,sB=e=>lf(e.cornerRadiusTopRight,e.cornerRadius)||0,aB=e=>lf(e.cornerRadiusBottomRight,e.cornerRadius)||0,uB=e=>lf(e.cornerRadiusBottomLeft,e.cornerRadius)||0,lB=e=>lf(e.size,64),cB=e=>e.size||1,lp=e=>e.defined!==!1,fB=e=>eD(e.shape||"circle"),dB=k7().startAngle(ZI).endAngle(eB).padAngle(tB).innerRadius(nB).outerRadius(iB).cornerRadius(rB),hB=MF().x(cf).y1(ff).y0(QI).defined(lp),gB=MF().y(ff).x1(cf).x0(JI).defined(lp),pB=CF().x(cf).y(ff).defined(lp),mB=tD().x(cf).y(ff).width(XI).height(KI).cornerRadius(oB,sB,aB,uB),yB=A7().type(fB).size(lB),bB=nD().x(cf).y(ff).defined(lp).size(cB);function sv(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function xB(e,t){return dB.context(e)(t)}function vB(e,t){const n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?gB:hB).curve(ov(i,n.orient,n.tension)).context(e)(t)}function wB(e,t){const n=t[0],i=n.interpolate||"linear";return pB.curve(ov(i,n.orient,n.tension)).context(e)(t)}function Xu(e,t,n,i){return mB.context(e)(t,n,i)}function _B(e,t){return(t.mark.shape||t.shape).context(e)(t)}function SB(e,t){return yB.context(e)(t)}function EB(e,t){return bB.context(e)(t)}var iD=1;function rD(){iD=1}function av(e,t,n){var i=t.clip,r=e._defs,o=t.clip_id||(t.clip_id="clip"+iD++),s=r.clipping[o]||(r.clipping[o]={id:o});return ue(i)?s.path=i(null):sv(n)?s.path=Xu(null,n,0,0):(s.width=n.width||0,s.height=n.height||0),"url(#"+o+")"}function Qe(e){this.clear(),e&&this.union(e)}Qe.prototype={clone(){return new Qe(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(e,t,n){var{x1:i,y1:r,x2:o,y2:s}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*i-u*r+l,u*i+a*r+c,a*i-u*s+l,u*i+a*s+c,a*o-u*r+l,u*o+a*r+c,a*o-u*s+l,u*o+a*s+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function cp(e){this.mark=e,this.bounds=this.bounds||new Qe}function fp(e){cp.call(this,e),this.items=this.items||[]}U(fp,cp);function uv(e){this._pending=0,this._loader=e||Pg()}function ZS(e){e._pending+=1}function ml(e){e._pending-=1}uv.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return ZS(t),t._loader.sanitize(e,{context:"href"}).then(n=>(ml(t),n)).catch(()=>(ml(t),null))},loadImage(e){const t=this,n=H7();return ZS(t),t._loader.sanitize(e,{context:"image"}).then(i=>{const r=i.href;if(!r||!n)throw{url:r};const o=new n,s=ne(i,"crossOrigin")?i.crossOrigin:"anonymous";return s!=null&&(o.crossOrigin=s),o.onload=()=>ml(t),o.onerror=()=>ml(t),o.src=r,o}).catch(i=>(ml(t),{complete:!1,width:0,height:0,src:i&&i.url||""}))},ready(){const e=this;return new Promise(t=>{function n(i){e.pending()?setTimeout(()=>{n(!0)},10):t(i)}n(!1)})}};function Gr(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?kB(t,i):0))}return e}function kB(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const $B=ji-1e-8;let dp,Cd,Md,Ms,D1,Fd,T1,N1;const ho=(e,t)=>dp.add(e,t),Dd=(e,t)=>ho(Cd=e,Md=t),eE=e=>ho(e,dp.y1),tE=e=>ho(dp.x1,e),Es=(e,t)=>D1*e+T1*t,ks=(e,t)=>Fd*e+N1*t,n0=(e,t)=>ho(Es(e,t),ks(e,t)),i0=(e,t)=>Dd(Es(e,t),ks(e,t));function df(e,t){return dp=e,t?(Ms=t*No,D1=N1=Math.cos(Ms),Fd=Math.sin(Ms),T1=-Fd):(D1=N1=1,Ms=Fd=T1=0),AB}const AB={beginPath(){},closePath(){},moveTo:i0,lineTo:i0,rect(e,t,n,i){Ms?(n0(e+n,t),n0(e+n,t+i),n0(e,t+i),i0(e,t)):(ho(e+n,t+i),Dd(e,t))},quadraticCurveTo(e,t,n,i){const r=Es(e,t),o=ks(e,t),s=Es(n,i),a=ks(n,i);nE(Cd,r,s,eE),nE(Md,o,a,tE),Dd(s,a)},bezierCurveTo(e,t,n,i,r,o){const s=Es(e,t),a=ks(e,t),u=Es(n,i),l=ks(n,i),c=Es(r,o),f=ks(r,o);iE(Cd,s,u,c,eE),iE(Md,a,l,f,tE),Dd(c,f)},arc(e,t,n,i,r,o){if(i+=Ms,r+=Ms,Cd=n*Math.cos(r)+e,Md=n*Math.sin(r)+t,Math.abs(r-i)>$B)ho(e-n,t-n),ho(e+n,t+n);else{const s=l=>ho(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(s(i),s(r),r!==i)if(i=i%ji,i<0&&(i+=ji),r=r%ji,r<0&&(r+=ji),r<i&&(o=!o,a=i,i=r,r=a),o)for(r-=ji,a=i-i%Ss,u=0;u<4&&a>r;++u,a-=Ss)s(a);else for(a=i-i%Ss+Ss,u=0;u<4&&a<r;++u,a=a+Ss)s(a)}}};function nE(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}function iE(e,t,n,i,r){const o=i-e+3*t-3*n,s=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(o)>BI?(c=s*s+a*o,c>=0&&(c=Math.sqrt(c),u=(-s+c)/o,l=(-s-c)/o)):u=.5*a/s,0<u&&u<1&&r(rE(u,e,t,n,i)),0<l&&l<1&&r(rE(l,e,t,n,i))}function rE(e,t,n,i,r){const o=1-e,s=o*o,a=e*e;return s*o*t+3*s*e*n+3*o*a*i+a*e*r}var $o=($o=ko(1,1))?$o.getContext("2d"):null;const O1=new Qe;function lv(e){return function(t,n){if(!$o)return!0;e($o,t),O1.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:o,y2:s}=O1;for(let a=r;a<=s;++a)for(let u=i;u<=o;++u)if($o.isPointInPath(u,a))return!0;return!1}}function cv(e,t){return t.contains(e.x||0,e.y||0)}function oD(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,o=e.height||0;return t.intersects(O1.set(n,i,n+r,i+o))}function sD(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,o=e.y2!=null?e.y2:i;return qa(t,n,i,r,o)}function qa(e,t,n,i,r){const{x1:o,y1:s,x2:a,y2:u}=e,l=i-t,c=r-n;let f=0,d=1,h,g,p,m;for(m=0;m<4;++m){if(m===0&&(h=-l,g=-(o-t)),m===1&&(h=l,g=a-t),m===2&&(h=-c,g=-(s-n)),m===3&&(h=c,g=u-n),Math.abs(h)<1e-10&&g<0)return!1;if(p=g/h,h<0){if(p>d)return!1;p>f&&(f=p)}else if(h>0){if(p<f)return!1;p<d&&(d=p)}}return!0}function yu(e,t){e.globalCompositeOperation=t.blend||"source-over"}function ai(e,t){return e??t}function oE(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function CB(e,t,n){const i=n.width(),r=n.height();let o;if(t.gradient==="radial")o=e.createRadialGradient(n.x1+ai(t.x1,.5)*i,n.y1+ai(t.y1,.5)*r,Math.max(i,r)*ai(t.r1,0),n.x1+ai(t.x2,.5)*i,n.y1+ai(t.y2,.5)*r,Math.max(i,r)*ai(t.r2,.5));else{const s=ai(t.x1,0),a=ai(t.y1,0),u=ai(t.x2,1),l=ai(t.y2,0);if(s===u||a===l||i===r)o=e.createLinearGradient(n.x1+s*i,n.y1+a*r,n.x1+u*i,n.y1+l*r);else{const c=ko(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=oE(f.createLinearGradient(s,a,u,l),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return oE(o,t.stops)}function aD(e,t,n){return rv(n)?CB(e,n,t.bounds):n}function yh(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=aD(e,t,t.fill),!0):!1}var MB=[];function bu(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=aD(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||MB),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function FB(e,t){return e.zindex-t.zindex||e.index-t.index}function fv(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,o;for(r=0,o=t.length;r<o;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(FB)}function ki(e,t){var n=e.items,i,r;if(!n||!n.length)return;const o=fv(e);if(o&&o.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=o}for(i=0,r=n.length;i<r;++i)t(n[i])}function bh(e,t){var n=e.items,i,r;if(!n||!n.length)return null;const o=fv(e);for(o&&o.length&&(n=o),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===o){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function dv(e){return function(t,n,i){ki(n,r=>{(!i||i.intersects(r.bounds))&&uD(e,t,r,r)})}}function DB(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&uD(e,t,n.items[0],n.items)}}function uD(e,t,n,i){var r=n.opacity==null?1:n.opacity;r!==0&&(e(t,i)||(yu(t,n),n.fill&&yh(t,n,r)&&t.fill(),n.stroke&&bu(t,n,r)&&t.stroke()))}function hp(e){return e=e||Jn,function(t,n,i,r,o,s){return i*=t.pixelRatio,r*=t.pixelRatio,bh(n,a=>{const u=a.bounds;if(!(u&&!u.contains(o,s)||!u)&&e(t,a,i,r,o,s))return a})}}function hf(e,t){return function(n,i,r,o){var s=Array.isArray(i)?i[0]:i,a=t??s.fill,u=s.stroke&&n.isPointInStroke,l,c;return u&&(l=s.strokeWidth,c=s.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,i)?!1:a&&n.isPointInPath(r,o)||u&&n.isPointInStroke(r,o)}}function hv(e){return hp(hf(e))}function Rs(e,t){return"translate("+e+","+t+")"}function gv(e){return"rotate("+e+")"}function TB(e,t){return"scale("+e+","+t+")"}function lD(e){return Rs(e.x||0,e.y||0)}function NB(e){return Rs(e.x||0,e.y||0)+(e.angle?" "+gv(e.angle):"")}function OB(e){return Rs(e.x||0,e.y||0)+(e.angle?" "+gv(e.angle):"")+(e.scaleX||e.scaleY?" "+TB(e.scaleX||1,e.scaleY||1):"")}function pv(e,t,n){function i(s,a){s("transform",NB(a)),s("d",t(null,a))}function r(s,a){return t(df(s,a.angle),a),Gr(s,a).translate(a.x||0,a.y||0)}function o(s,a){var u=a.x||0,l=a.y||0,c=a.angle||0;s.translate(u,l),c&&s.rotate(c*=No),s.beginPath(),t(s,a),c&&s.rotate(-c),s.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:dv(o),pick:hv(o),isect:n||lv(o)}}var RB=pv("arc",xB);function zB(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,o=1/0,s,a;--r>=0;)e[r].defined!==!1&&(a=Math.abs(e[r][i]-n),a<o&&(o=a,s=e[r]));return s}function PB(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,o,s;--i>=0;)if(e[i].defined!==!1&&(r=e[i].x-t[0],o=e[i].y-t[1],s=r*r+o*o,s<n))return e[i];return null}function LB(e,t){for(var n=e.length,i,r,o;--n>=0;)if(e[n].defined!==!1&&(i=e[n].x-t[0],r=e[n].y-t[1],o=i*i+r*r,i=e[n].size||1,o<i*i))return e[n];return null}function mv(e,t,n){function i(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function r(u,l){var c=l.items;return c.length===0?u:(t(df(u),c),Gr(u,c[0]))}function o(u,l){u.beginPath(),t(u,l)}const s=hf(o);function a(u,l,c,f,d,h){var g=l.items,p=l.bounds;return!g||!g.length||p&&!p.contains(d,h)?null:(c*=u.pixelRatio,f*=u.pixelRatio,s(u,g,c,f)?g[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:DB(o),pick:a,isect:cv,tip:n}}var IB=mv("area",vB,zB);function BB(e,t){var n=t.clip;e.save(),ue(n)?(e.beginPath(),n(e),e.clip()):cD(e,t.group)}function cD(e,t){e.beginPath(),sv(t)?Xu(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function fD(e){const t=ai(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function UB(e,t){e("transform",lD(t))}function dD(e,t){const n=fD(t);e("d",Xu(null,t,n,n))}function jB(e,t){e("class","background"),e("aria-hidden",!0),dD(e,t)}function qB(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?dD(e,t):e("d","")}function WB(e,t,n){const i=t.clip?av(n,t,t):null;e("clip-path",i)}function HB(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Gr(e,t),e.translate(t.x||0,t.y||0)}function $c(e,t,n,i){const r=fD(t);e.beginPath(),Xu(e,t,(n||0)+r,(i||0)+r)}const GB=hf($c),YB=hf($c,!1),VB=hf($c,!0);function XB(e,t,n,i){ki(t,r=>{const o=r.x||0,s=r.y||0,a=r.strokeForeground,u=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&u&&($c(e,r,o,s),yu(e,r),r.fill&&yh(e,r,u)&&e.fill(),r.stroke&&!a&&bu(e,r,u)&&e.stroke()),e.save(),e.translate(o,s),r.clip&&cD(e,r),n&&n.translate(-o,-s),ki(r,l=>{(l.marktype==="group"||i==null||i.includes(l.marktype))&&this.draw(e,l,n,i)}),n&&n.translate(o,s),e.restore(),a&&r.stroke&&u&&($c(e,r,o,s),yu(e,r),bu(e,r,u)&&e.stroke())})}function KB(e,t,n,i,r,o){if(t.bounds&&!t.bounds.contains(r,o)||!t.items)return null;const s=n*e.pixelRatio,a=i*e.pixelRatio;return bh(t,u=>{let l,c,f;const d=u.bounds;if(d&&!d.contains(r,o))return;c=u.x||0,f=u.y||0;const h=c+(u.width||0),g=f+(u.height||0),p=u.clip;if(p&&(r<c||r>h||o<f||o>g))return;if(e.save(),e.translate(c,f),c=r-c,f=o-f,p&&sv(u)&&!VB(e,u,s,a))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&YB(e,u,s,a)?(e.restore(),u):(l=bh(u,b=>JB(b,c,f)?this.pick(b,n,i,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&GB(e,u,s,a)&&(l=u),e.restore(),l||null)})}function JB(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var QB={type:"group",tag:"g",nested:!1,attr:UB,bound:HB,draw:XB,pick:KB,isect:oD,content:WB,background:jB,foreground:qB},Ac={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function yv(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function bv(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function xv(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function gp(e,t){return e==="center"?t/2:e==="right"?t:0}function pp(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function ZB(e,t,n){const i=yv(t,n),r=bv(t,i),o=xv(t,i),s=(t.x||0)-gp(t.align,r),a=(t.y||0)-pp(t.baseline,o),u=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",u,Ac["xmlns:xlink"],"xlink:href"),e("transform",Rs(s,a)),e("width",r),e("height",o),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function eU(e,t){const n=t.image,i=bv(t,n),r=xv(t,n),o=(t.x||0)-gp(t.align,i),s=(t.y||0)-pp(t.baseline,r);return e.set(o,s,o+i,s+r)}function tU(e,t,n){ki(t,i=>{if(n&&!n.intersects(i.bounds))return;const r=yv(i,this);let o=bv(i,r),s=xv(i,r);if(o===0||s===0)return;let a=(i.x||0)-gp(i.align,o),u=(i.y||0)-pp(i.baseline,s),l,c,f,d;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(d=o/c,u+=(s-d)/2,s=d):(d=s*c,a+=(o-d)/2,o=d))),(r.complete||r.toDataURL)&&(yu(e,i),e.globalAlpha=(l=i.opacity)!=null?l:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,a,u,o,s))})}var nU={type:"image",tag:"image",nested:!1,attr:ZB,bound:eU,draw:tU,pick:hp(),isect:Jn,get:yv,xOffset:gp,yOffset:pp},iU=mv("line",wB,PB);function rU(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",OB(t)),e("d",t.path)}function Td(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,o=t.scaleX||1,s=t.scaleY||1,a=(t.angle||0)*No,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=mu(n)).path=n),a&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(a),kc(e,u,0,0,o,s),e.rotate(-a),e.translate(-i,-r)):kc(e,u,i,r,o,s)}function oU(e,t){return Td(df(e,t.angle),t)?e.set(0,0,0,0):Gr(e,t,!0)}var sU={type:"path",tag:"path",nested:!1,attr:rU,bound:oU,draw:dv(Td),pick:hv(Td),isect:lv(Td)};function aU(e,t){e("d",Xu(null,t))}function uU(e,t){var n,i;return Gr(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function sE(e,t){e.beginPath(),Xu(e,t)}var lU={type:"rect",tag:"path",nested:!1,attr:aU,bound:uU,draw:dv(sE),pick:hv(sE),isect:oD};function cU(e,t){e("transform",lD(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function fU(e,t){var n,i;return Gr(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function hD(e,t,n){var i,r,o,s;return t.stroke&&bu(e,t,n)?(i=t.x||0,r=t.y||0,o=t.x2!=null?t.x2:i,s=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(o,s),!0):!1}function dU(e,t,n){ki(t,i=>{if(!(n&&!n.intersects(i.bounds))){var r=i.opacity==null?1:i.opacity;r&&hD(e,i,r)&&(yu(e,i),e.stroke())}})}function hU(e,t,n,i){return e.isPointInStroke?hD(e,t,1)&&e.isPointInStroke(n,i):!1}var gU={type:"rule",tag:"line",nested:!1,attr:cU,bound:fU,draw:dU,pick:hp(hU),isect:sD},pU=pv("shape",_B),mU=pv("symbol",SB,cv);const aE=vC();var Tn={height:lr,measureWidth:vv,estimateWidth:xh,width:xh,canvas:gD};gD(!0);function gD(e){Tn.width=e&&$o?vv:xh}function xh(e,t){return pD(Ro(e,t),lr(e))}function pD(e,t){return~~(.8*e.length*t)}function vv(e,t){return lr(e)<=0||!(t=Ro(e,t))?0:mD(t,mp(e))}function mD(e,t){const n=`(${t}) ${e}`;let i=aE.get(n);return i===void 0&&($o.font=t,i=$o.measureText(e).width,aE.set(n,i)),i}function lr(e){return e.fontSize!=null?+e.fontSize||0:11}function Oo(e){return e.lineHeight!=null?e.lineHeight:lr(e)+2}function yU(e){return z(e)?e.length>1?e:e[0]:e}function gf(e){return yU(e.lineBreak&&e.text&&!z(e.text)?e.text.split(e.lineBreak):e.text)}function wv(e){const t=gf(e);return(z(t)?t.length-1:0)*Oo(e)}function Ro(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?xU(e,n):n}function bU(e){if(Tn.width===vv){const t=mp(e);return n=>mD(n,t)}else if(Tn.width===xh){const t=lr(e);return n=>pD(n,t)}else return t=>Tn.width(e,t)}function xU(e,t){var n=+e.limit,i=bU(e);if(i(t)<n)return t;var r=e.ellipsis||"…",o=e.dir==="rtl",s=0,a=t.length,u;if(n-=i(r),o){for(;s<a;)u=s+a>>>1,i(t.slice(u))>n?s=u+1:a=u;return r+t.slice(s)}else{for(;s<a;)u=1+(s+a>>>1),i(t.slice(0,u))<n?s=u:a=u-1;return t.slice(0,s)+r}}function pf(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function mp(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+lr(e)+"px "+pf(e,t)}function _v(e){var t=e.baseline,n=lr(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Oo(e):t==="line-bottom"?.29*n-.5*Oo(e):0)}const vU={left:"start",center:"middle",right:"end"},ec=new Qe;function yp(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-Ss,t+=i*Math.cos(r),n+=i*Math.sin(r)),ec.x1=t,ec.y1=n,ec}function wU(e,t){var n=t.dx||0,i=(t.dy||0)+_v(t),r=yp(t),o=r.x1,s=r.y1,a=t.angle||0,u;e("text-anchor",vU[t.align]||"start"),a?(u=Rs(o,s)+" "+gv(a),(n||i)&&(u+=" "+Rs(n,i))):u=Rs(o+n,s+i),e("transform",u)}function Sv(e,t,n){var i=Tn.height(t),r=t.align,o=yp(t),s=o.x1,a=o.y1,u=t.dx||0,l=(t.dy||0)+_v(t)-Math.round(.8*i),c=gf(t),f;if(z(c)?(i+=Oo(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,Tn.width(t,h)),0)):f=Tn.width(t,c),r==="center"?u-=f/2:r==="right"&&(u-=f),e.set(u+=s,l+=a,u+f,l+i),t.angle&&!n)e.rotate(t.angle*No,s,a);else if(n===2)return e.rotatedPoints(t.angle*No,s,a);return e}function _U(e,t,n){ki(t,i=>{var r=i.opacity==null?1:i.opacity,o,s,a,u,l,c,f;if(!(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)){if(e.font=mp(i),e.textAlign=i.align||"left",o=yp(i),s=o.x1,a=o.y1,i.angle&&(e.save(),e.translate(s,a),e.rotate(i.angle*No),s=a=0),s+=i.dx||0,a+=(i.dy||0)+_v(i),c=gf(i),yu(e,i),z(c))for(l=Oo(i),u=0;u<c.length;++u)f=Ro(i,c[u]),i.fill&&yh(e,i,r)&&e.fillText(f,s,a),i.stroke&&bu(e,i,r)&&e.strokeText(f,s,a),a+=l;else f=Ro(i,c),i.fill&&yh(e,i,r)&&e.fillText(f,s,a),i.stroke&&bu(e,i,r)&&e.strokeText(f,s,a);i.angle&&e.restore()}})}function SU(e,t,n,i,r,o){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var s=yp(t),a=s.x1,u=s.y1,l=Sv(ec,t,1),c=-t.angle*No,f=Math.cos(c),d=Math.sin(c),h=f*r-d*o+(a-f*a+d*u),g=d*r+f*o+(u-d*a-f*u);return l.contains(h,g)}function EU(e,t){const n=Sv(ec,e,2);return qa(t,n[0],n[1],n[2],n[3])||qa(t,n[0],n[1],n[4],n[5])||qa(t,n[4],n[5],n[6],n[7])||qa(t,n[2],n[3],n[6],n[7])}var kU={type:"text",tag:"text",nested:!1,attr:wU,bound:Sv,draw:_U,pick:hp(SU),isect:EU},$U=mv("trail",EB,LB),zn={arc:RB,area:IB,group:QB,image:nU,line:iU,path:sU,rect:lU,rule:gU,shape:pU,symbol:mU,text:kU,trail:$U};function R1(e,t,n){var i=zn[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new Qe),e,n)}var uE={mark:null};function yD(e,t,n){var i=zn[e.marktype],r=i.bound,o=e.items,s=o&&o.length,a,u,l,c;if(i.nested)return s?l=o[0]:(uE.mark=e,l=uE),c=R1(l,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new Qe,s)for(a=0,u=o.length;a<u;++a)t.union(R1(o[a],r,n));return e.bounds=t}const AU=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function bD(e,t){return JSON.stringify(e,AU,t)}function xD(e){const t=typeof e=="string"?JSON.parse(e):e;return vD(t)}function vD(e){var t=e.marktype,n=e.items,i,r,o;if(n)for(r=0,o=n.length;r<o;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&vD(n[r]);return t&&yD(e),e}function Ev(e){arguments.length?this.root=xD(e):(this.root=wD({marktype:"group",name:"root",role:"frame"}),this.root.items=[new fp(this.root)])}Ev.prototype={toJSON(e){return bD(this.root,e||0)},mark(e,t,n){t=t||this.root.items[0];const i=wD(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}};function wD(e,t){const n={bounds:new Qe,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function go(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function kv(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function tt(e,t,n,i){var r=e.childNodes[t],o;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(o=r||null,r=go(e.ownerDocument,n,i),e.insertBefore(r,o)),r}function jn(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function _D(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function bp(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function CU(e,t,n,i){var r=e&&e.mark,o,s;if(r&&(o=zn[r.marktype]).tip){for(s=bp(t,n),s[0]-=i[0],s[1]-=i[1];e=e.mark.group;)s[0]-=e.x||0,s[1]-=e.y||0;e=o.tip(r.items,s)}return e}function zo(e,t){this._active=null,this._handlers={},this._loader=e||Pg(),this._tooltip=t||MU}function MU(e,t,n,i){e.element().setAttribute("title",i||"")}zo.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const i in t)n.push(...t[i]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),o=go(null,"a");for(const s in i)o.setAttribute(s,i[s]);o.dispatchEvent(r)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=CU(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,o=r.width(),s=r.height();let a=r.x1+i[0]+n.left,u=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:o,height:s,left:a,top:u,right:a+o,bottom:u+s}}};function In(e){this._el=null,this._bgcolor=null,this._loader=new uv(e)}In.prototype={initialize(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(e,t){const n=this;return n._call=function(){n._render(e,t)},n._call(),n._call=null,n},_render(){},renderAsync(e,t){const n=this.render(e,t);return this._ready?this._ready.then(()=>n):Promise.resolve(n)},_load(e,t){var n=this,i=n._loader[e](t);if(!n._ready){const r=n._call;n._ready=n._loader.ready().then(o=>{o&&r(),n._ready=null})}return i},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const FU="keydown",DU="keypress",TU="keyup",SD="dragenter",Nd="dragleave",ED="dragover",z1="pointerdown",NU="pointerup",vh="pointermove",tc="pointerout",kD="pointerover",P1="mousedown",OU="mouseup",$D="mousemove",L1="mouseout",AD="mouseover",wh="click",RU="dblclick",zU="wheel",CD="mousewheel",_h="touchstart",Sh="touchmove",Eh="touchend",PU=[FU,DU,TU,SD,Nd,ED,z1,NU,vh,tc,kD,P1,OU,$D,L1,AD,wh,RU,zU,CD,_h,Sh,Eh],I1=vh,Cc=tc,B1=wh;function Po(e,t){zo.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const LU=e=>e===_h||e===Sh||e===Eh?[_h,Sh,Eh]:[e];function lE(e,t){LU(t).forEach(n=>IU(e,n))}function IU(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}function Il(e,t,n){t.forEach(i=>e.fire(i,n))}function cE(e,t,n){return function(i){const r=this._active,o=this.pickEvent(i);o===r?Il(this,e,i):((!r||!r.exit)&&Il(this,n,i),this._active=o,Il(this,t,i),Il(this,e,i))}}function fE(e){return function(t){Il(this,e,t),this._active=null}}U(Po,zo,{initialize(e,t,n){return this._canvas=e&&kv(e,"canvas"),[wh,P1,z1,vh,tc,Nd].forEach(i=>lE(this,i)),zo.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:PU,DOMMouseScroll(e){this.fire(CD,e)},pointermove:cE([vh,$D],[kD,AD],[tc,L1]),dragover:cE([ED],[SD],[Nd]),pointerout:fE([tc,L1]),dragleave:fE([Nd]),pointerdown(e){this._down=this._active,this.fire(z1,e)},mousedown(e){this._down=this._active,this.fire(P1,e)},click(e){this._down===this._active&&(this.fire(wh,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(_h,e,!0)},touchmove(e){this.fire(Sh,e,!0)},touchend(e){this.fire(Eh,e,!0),this._touch=null},fire(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===B1&&i&&i.href?this.handleHref(t,i,i.href):(e===I1||e===Cc)&&this.handleTooltip(t,i,e!==Cc),r)for(let o=0,s=r.length;o<s;++o)r[o].handler.call(this._obj,t,i)},on(e,t){const n=this.eventName(e),i=this._handlers;return this._handlerIndex(i[n],e,t)<0&&(lE(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},pickEvent(e){const t=bp(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,i,r){const o=this.context();return zn[e.marktype].pick.call(this,o,e,t,n,i,r)}});function BU(){return typeof window<"u"&&window.devicePixelRatio||1}var UU=BU();function jU(e,t,n,i,r,o){const s=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=s?UU:r;e.width=t*u,e.height=n*u;for(const l in o)a[l]=o[l];return s&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*i[0],u*i[1]),e}function Mc(e){In.call(this,e),this._options={},this._redraw=!1,this._dirty=new Qe,this._tempb=new Qe}const dE=In.prototype,qU=(e,t,n)=>new Qe().set(0,0,t,n).translate(-e[0],-e[1]);function WU(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}U(Mc,In,{initialize(e,t,n,i,r,o){return this._options=o||{},this._canvas=this._options.externalContext?null:ko(1,1,this._options.type),e&&this._canvas&&(jn(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),dE.initialize.call(this,e,t,n,i,r)},resize(e,t,n,i){if(dE.resize.call(this,e,t,n,i),this._canvas)jU(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||O("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e,t){const n=this.context(),i=this._origin,r=this._width,o=this._height,s=this._dirty,a=qU(i,r,o);n.save();const u=this._redraw||s.empty()?(this._redraw=!1,a.expand(1)):WU(n,a.intersect(s),i);return this.clear(-i[0],-i[1],r,o),this.draw(n,e,u,t),n.restore(),s.clear(),this},draw(e,t,n,i){if(t.marktype!=="group"&&i!=null&&!i.includes(t.marktype))return;const r=zn[t.marktype];t.clip&&BB(e,t),r.draw.call(this,e,t,n,i),t.clip&&e.restore()},clear(e,t,n,i){const r=this._options,o=this.context();r.type!=="pdf"&&!r.externalContext&&o.clearRect(e,t,n,i),this._bgcolor!=null&&(o.fillStyle=this._bgcolor,o.fillRect(e,t,n,i))}});function $v(e,t){zo.call(this,e,t);const n=this;n._hrefHandler=U1(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=U1(n,(i,r)=>{n.handleTooltip(i,r,i.type!==Cc)})}const U1=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};U($v,zo,{initialize(e,t,n){let i=this._svg;return i&&(i.removeEventListener(B1,this._hrefHandler),i.removeEventListener(I1,this._tooltipHandler),i.removeEventListener(Cc,this._tooltipHandler)),this._svg=i=e&&kv(e,"svg"),i&&(i.addEventListener(B1,this._hrefHandler),i.addEventListener(I1,this._tooltipHandler),i.addEventListener(Cc,this._tooltipHandler)),zo.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),i=this._handlers;if(this._handlerIndex(i[n],e,t)<0){const o={type:e,handler:t,listener:U1(this,t)};(i[n]||(i[n]=[])).push(o),this._svg&&this._svg.addEventListener(n,o.listener)}return this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const MD="aria-hidden",Av="aria-label",Cv="role",Mv="aria-roledescription",FD="graphics-object",Fv="graphics-symbol",DD=(e,t,n)=>({[Cv]:e,[Mv]:t,[Av]:n||void 0}),HU=Si(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),hE={axis:{desc:"axis",caption:VU},legend:{desc:"legend",caption:XU},"title-text":{desc:"title",caption:e=>`Title text '${pE(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${pE(e)}'`}},gE={ariaRole:Cv,ariaRoleDescription:Mv,description:Av};function TD(e,t){const n=t.aria===!1;if(e(MD,n||void 0),n||t.description==null)for(const i in gE)e(gE[i],void 0);else{const i=t.mark.marktype;e(Av,t.description),e(Cv,t.ariaRole||(i==="group"?FD:Fv)),e(Mv,t.ariaRoleDescription||`${i} mark`)}}function ND(e){return e.aria===!1?{[MD]:!0}:HU[e.role]?null:hE[e.role]?YU(e,hE[e.role]):GU(e)}function GU(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return DD(n?FD:Fv,`${t} mark container`,e.description)}function YU(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return DD(t.role||Fv,t.desc,n.description||i(n))}catch{return null}}function pE(e){return H(e.text).join(" ")}function VU(e){const t=e.datum,n=e.orient,i=t.title?OD(e):null,r=e.context,o=r.scales[t.scale].value,s=r.dataflow.locale(),a=o.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(i?` titled '${i}'`:"")+` for a ${pu(a)?"discrete":a} scale with ${X3(s,o,e)}`}function XU(e){const t=e.datum,n=t.title?OD(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,o=Object.keys(r),s=e.context,a=s.scales[r[o[0]]].value,u=s.dataflow.locale();return JU(i)+(n?` titled '${n}'`:"")+` for ${KU(o)} with ${X3(u,a,e)}`}function OD(e){try{return H(ye(e.items).items[0].text).join(" ")}catch{return null}}function KU(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ye(e)}function JU(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const RD=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),QU=e=>RD(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function Dv(){let e="",t="",n="";const i=[],r=()=>t=n="",o=u=>{t&&(e+=`${t}>${n}`,r()),i.push(u)},s=(u,l)=>(l!=null&&(t+=` ${u}="${QU(l)}"`),a),a={open(u){o(u),t="<"+u;for(var l=arguments.length,c=new Array(l>1?l-1:0),f=1;f<l;f++)c[f-1]=arguments[f];for(const d of c)for(const h in d)s(h,d[h]);return a},close(){const u=i.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,r(),a},attr:s,text:u=>(n+=RD(u),a),toString:()=>e};return a}const zD=e=>PD(Dv(),e)+"";function PD(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,i=n.length;for(let r=0;r<i;++r)e.attr(n[r].name,n[r].value)}if(t.hasChildNodes()){const n=t.childNodes;for(const i of n)i.nodeType===3?e.text(i.nodeValue):PD(e,i)}return e.close()}const kh={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},$h={blend:"mix-blend-mode"},LD={fill:"none","stroke-miterlimit":10},yl=0,mE="http://www.w3.org/2000/xmlns/",et=Ac.xmlns;function xp(e){In.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const r0=In.prototype;U(xp,In,{initialize(e,t,n,i,r){return this._defs={},this._clearDefs(),e&&(this._svg=tt(e,0,"svg",et),this._svg.setAttributeNS(mE,"xmlns",et),this._svg.setAttributeNS(mE,"xmlns:xlink",Ac["xmlns:xlink"]),this._svg.setAttribute("version",Ac.version),this._svg.setAttribute("class","marks"),jn(e,1),this._root=tt(this._svg,yl,"g",et),po(this._root,LD),jn(this._svg,yl+1)),this.background(this._bgcolor),r0.initialize.call(this,e,t,n,i,r)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),r0.background.apply(this,arguments)},resize(e,t,n,i){return r0.resize.call(this,e,t,n,i),this._svg&&(po(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=tt(e,yl,"rect",et),po(n,{width:this._width,height:this._height,fill:t}));const i=zD(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),i},_render(e,t){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e,void 0,t),jn(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||!e._svg.ownerSVGElement||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,i,r,o,s,a,u;for(s=0,a=e.length;s<a;++s)if(n=e[s],i=n.mark,i.marktype!==r&&(r=i.marktype,o=zn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,yE(n,t),i.items.forEach(l=>{l.dirty=t})),!i.zdirty){if(n.exit){o.nested&&i.items.length?(u=i.items[0],u._svg&&this._update(o,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=o.nested?i.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,yE(n,t)):this._update(o,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n,i){if(!this.isDirty(t))return t._svg;const r=this._svg,o=t.marktype,s=zn[o],a=t.interactive===!1?"none":null,u=s.tag==="g",l=bE(t,e,n,"g",r);if(o!=="group"&&i!=null&&!i.includes(o))return jn(l,0),t._svg;l.setAttribute("class",_D(t));const c=ND(t);for(const g in c)Yt(l,g,c[g]);u||Yt(l,"pointer-events",a),Yt(l,"clip-path",t.clip?av(this,t,t.group):null);let f=null,d=0;const h=g=>{const p=this.isDirty(g),m=bE(g,l,f,s.tag,r);p&&(this._update(s,m,g),u&&tj(this,m,g,i)),f=m,++d};return s.nested?t.items.length&&h(t.items[0]):ki(t,h),jn(l,d),l},_update(e,t,n){Tr=t,Tt=t.__values__,TD(nc,n),e.attr(nc,n,this);const i=ij[e.type];i&&i.call(this,e,t,n),Tr&&this.style(Tr,n)},style(e,t){if(t!=null){for(const n in kh){let i=n==="font"?pf(t):t[n];if(i===Tt[n])continue;const r=kh[n];i==null?e.removeAttribute(r):(rv(i)&&(i=J3(i,this._defs.gradient,ID())),e.setAttribute(r,i+"")),Tt[n]=i}for(const n in $h)Od(e,$h[n],t[n])}},defs(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=tt(e,yl+1,"defs",et)),i=ZU(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=tt(e,yl+1,"defs",et)),i=ej(n,t.clipping[r],i);n&&(i===0?(e.removeChild(n),t.el=null):jn(n,i))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function yE(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function ZU(e,t,n){let i,r,o;if(t.gradient==="radial"){let s=tt(e,n++,"pattern",et);po(s,{id:mh+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),s=tt(s,0,"rect",et),po(s,{width:1,height:1,fill:`url(${ID()}#${t.id})`}),e=tt(e,n++,"radialGradient",et),po(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=tt(e,n++,"linearGradient",et),po(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(i=0,r=t.stops.length;i<r;++i)o=tt(e,i,"stop",et),o.setAttribute("offset",t.stops[i].offset),o.setAttribute("stop-color",t.stops[i].color);return jn(e,i),n}function ej(e,t,n){let i;return e=tt(e,n,"clipPath",et),e.setAttribute("id",t.id),t.path?(i=tt(e,0,"path",et),i.setAttribute("d",t.path)):(i=tt(e,0,"rect",et),po(i,{x:0,y:0,width:t.width,height:t.height})),jn(e,1),n+1}function tj(e,t,n,i){t=t.lastChild.previousSibling;let r,o=0;ki(n,s=>{r=e.mark(t,s,r,i),++o}),jn(t,1+o)}function bE(e,t,n,i,r){let o=e._svg,s;if(!o&&(s=t.ownerDocument,o=go(s,i,et),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},i==="g"))){const a=go(s,"path",et);o.appendChild(a),a.__data__=e;const u=go(s,"g",et);o.appendChild(u),u.__data__=e;const l=go(s,"path",et);o.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(o.ownerSVGElement!==r||nj(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}function nj(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Tr=null,Tt=null;const ij={group(e,t,n){const i=Tr=t.childNodes[2];Tt=i.__values__,e.foreground(nc,n,this),Tt=t.__values__,Tr=t.childNodes[1],e.content(nc,n,this);const r=Tr=t.childNodes[0];e.background(nc,n,this);const o=n.mark.interactive===!1?"none":null;if(o!==Tt.events&&(Yt(i,"pointer-events",o),Yt(r,"pointer-events",o),Tt.events=o),n.strokeForeground&&n.stroke){const s=n.fill;Yt(i,"display",null),this.style(r,n),Yt(r,"stroke",null),s&&(n.fill=null),Tt=i.__values__,this.style(i,n),s&&(n.fill=s),Tr=null}else Yt(i,"display","none")},image(e,t,n){n.smooth===!1?(Od(t,"image-rendering","optimizeSpeed"),Od(t,"image-rendering","pixelated")):Od(t,"image-rendering",null)},text(e,t,n){const i=gf(n);let r,o,s,a;z(i)?(o=i.map(u=>Ro(n,u)),r=o.join(`
`),r!==Tt.text&&(jn(t,0),s=t.ownerDocument,a=Oo(n),o.forEach((u,l)=>{const c=go(s,"tspan",et);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),Tt.text=r)):(o=Ro(n,i),o!==Tt.text&&(t.textContent=o,Tt.text=o)),Yt(t,"font-family",pf(n)),Yt(t,"font-size",lr(n)+"px"),Yt(t,"font-style",n.fontStyle),Yt(t,"font-variant",n.fontVariant),Yt(t,"font-weight",n.fontWeight)}};function nc(e,t,n){t!==Tt[e]&&(n?rj(Tr,e,t,n):Yt(Tr,e,t),Tt[e]=t)}function Od(e,t,n){n!==Tt[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Tt[t]=n)}function po(e,t){for(const n in t)Yt(e,n,t[n])}function Yt(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function rj(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}function ID(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Tv(e){In.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}U(Tv,In,{svg(){return this._text},_render(e){const t=Dv();t.open("svg",ae({},Ac,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",LD,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=zn[t.marktype],i=n.tag,r=[TD,n.attr];e.open("g",{class:_D(t),"clip-path":t.clip?av(this,t,t.group):null},ND(t),{"pointer-events":i!=="g"&&t.interactive===!1?"none":null});const o=s=>{const a=this.href(s);if(a&&e.open("a",a),e.open(i,this.attr(t,s,r,i!=="g"?i:null)),i==="text"){const u=gf(s);if(z(u)){const l={x:0,dy:Oo(s)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(Ro(s,u[c])).close()}else e.text(Ro(s,u))}else if(i==="g"){const u=s.strokeForeground,l=s.fill,c=s.stroke;u&&c&&(s.stroke=null),e.open("path",this.attr(t,s,n.background,"bgrect")).close(),e.open("g",this.attr(t,s,n.content)),ki(s,f=>this.mark(e,f)),e.close(),u&&c?(l&&(s.fill=null),s.stroke=c,e.open("path",this.attr(t,s,n.foreground,"bgrect")).close(),l&&(s.fill=l)):e.open("path",this.attr(t,s,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&o(t.items[0]):ki(t,o),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(i=>{i["xlink:href"]=i.href,i.href=null,(this._hrefs||(this._hrefs={}))[t]=i})}return null},attr(e,t,n,i){const r={},o=(s,a,u,l)=>{r[l||s]=a};return Array.isArray(n)?n.forEach(s=>s(o,t,this)):n(o,t,this),i&&oj(r,t,e,i,this._defs),r},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const r in t){const o=t[r],s=o.stops;o.gradient==="radial"?(e.open("pattern",{id:mh+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:o.x1,fy:o.y1,fr:o.r1,cx:o.x2,cy:o.y2,r:o.r2})):e.open("linearGradient",{id:r,x1:o.x1,x2:o.x2,y1:o.y1,y2:o.y2});for(let a=0;a<s.length;++a)e.open("stop",{offset:s[a].offset,"stop-color":s[a].color}).close();e.close()}for(const r in n){const o=n[r];e.open("clipPath",{id:r}),o.path?e.open("path",{d:o.path}).close():e.open("rect",{x:0,y:0,width:o.width,height:o.height}).close(),e.close()}e.close()}}});function oj(e,t,n,i,r){let o;if(t==null||(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;i==="image"&&t.smooth===!1&&(o=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),i==="text"&&(e["font-family"]=pf(t),e["font-size"]=lr(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const s in kh){let a=t[s];const u=kh[s];a==="transparent"&&(u==="fill"||u==="stroke")||a!=null&&(rv(a)&&(a=J3(a,r.gradient,"")),e[u]=a)}for(const s in $h){const a=t[s];a!=null&&(o=o||[],o.push(`${$h[s]}: ${a};`))}return o&&(e.style=o.join(" ")),e}const li={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function sj(e){li.svgMarkTypes=e.svgMarkTypes??["text"],li.svgOnTop=e.svgOnTop??!0,li.debug=e.debug??!1}function Ah(e){In.call(this,e),this._svgRenderer=new xp(e),this._canvasRenderer=new Mc(e)}const xE=In.prototype;U(Ah,In,{initialize(e,t,n,i,r){this._root_el=tt(e,0,"div");const o=tt(this._root_el,0,"div"),s=tt(this._root_el,1,"div");return this._root_el.style.position="relative",li.debug||(o.style.height="100%",s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.height="100%",s.style.width="100%"),this._svgEl=li.svgOnTop?s:o,this._canvasEl=li.svgOnTop?o:s,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,t,n,i,r),this._svgRenderer.initialize(this._svgEl,t,n,i,r),xE.initialize.call(this,e,t,n,i,r)},dirty(e){return li.svgMarkTypes.includes(e.mark.marktype)?this._svgRenderer.dirty(e):this._canvasRenderer.dirty(e),this},_render(e,t){const i=(t??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter(r=>!li.svgMarkTypes.includes(r));this._svgRenderer.render(e,li.svgMarkTypes),this._canvasRenderer.render(e,i)},resize(e,t,n,i){return xE.resize.call(this,e,t,n,i),this._svgRenderer.resize(e,t,n,i),this._canvasRenderer.resize(e,t,n,i),this},background(e){return li.svgOnTop?this._canvasRenderer.background(e):this._svgRenderer.background(e),this}});function Nv(e,t){Po.call(this,e,t)}U(Nv,Po,{initialize(e,t,n){const i=tt(tt(e,0,"div"),li.svgOnTop?0:1,"div");return Po.prototype.initialize.call(this,i,t,n)}});const BD="canvas",UD="hybrid",jD="png",qD="svg",WD="none",mo={Canvas:BD,PNG:jD,SVG:qD,Hybrid:UD,None:WD},Ws={};Ws[BD]=Ws[jD]={renderer:Mc,headless:Mc,handler:Po};Ws[qD]={renderer:xp,headless:Tv,handler:$v};Ws[UD]={renderer:Ah,headless:Ah,handler:Nv};Ws[WD]={};function vp(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(Ws[e]=t,this):Ws[e]}function HD(e,t,n){const i=[],r=new Qe().union(t),o=e.marktype;return o?GD(e,r,n,i):o==="group"?YD(e,r,n,i):O("Intersect scene must be mark node or group item.")}function GD(e,t,n,i){if(aj(e,t,n)){const r=e.items,o=e.marktype,s=r.length;let a=0;if(o==="group")for(;a<s;++a)YD(r[a],t,n,i);else for(const u=zn[o].isect;a<s;++a){const l=r[a];VD(l,t,u)&&i.push(l)}}return i}function aj(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function YD(e,t,n,i){n&&n(e.mark)&&VD(e,t,zn.group.isect)&&i.push(e);const r=e.items,o=r&&r.length;if(o){const s=e.x||0,a=e.y||0;t.translate(-s,-a);for(let u=0;u<o;++u)GD(r[u],t,n,i);t.translate(s,a)}return i}function VD(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}const o0=new Qe;function XD(e){const t=e.clip;if(ue(t))t(df(o0.clear()));else if(t)o0.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(o0)}const uj=1e-9;function Ov(e,t,n){return e===t?!0:n==="path"?KD(e,t):e instanceof Date&&t instanceof Date?+e==+t:xe(e)&&xe(t)?Math.abs(e-t)<=uj:!e||!t||!G(e)&&!G(t)?e==t:lj(e,t)}function KD(e,t){return Ov(mu(e),mu(t))}function lj(e,t){var n=Object.keys(e),i=Object.keys(t),r,o;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),o=n.length-1;o>=0;o--)if(n[o]!=i[o])return!1;for(o=n.length-1;o>=0;o--)if(r=n[o],!Ov(e[r],t[r],r))return!1;return typeof e==typeof t}function cj(){rD(),NI()}const xu="top",gi="left",pi="right",Lo="bottom",fj="top-left",dj="top-right",hj="bottom-left",gj="bottom-right",Rv="start",j1="middle",Vt="end",pj="x",mj="y",wp="group",zv="axis",Pv="title",yj="frame",bj="scope",Lv="legend",JD="row-header",QD="row-footer",ZD="row-title",e5="column-header",t5="column-footer",n5="column-title",xj="padding",vj="symbol",i5="fit",r5="fit-x",o5="fit-y",wj="pad",Iv="none",Jf="all",q1="each",Bv="flush",yo="column",bo="row";function s5(e){F.call(this,null,e)}U(s5,F,{transform(e,t){const n=t.dataflow,i=e.mark,r=i.marktype,o=zn[r],s=o.bound;let a=i.bounds,u;if(o.nested)i.items.length&&n.dirty(i.items[0]),a=Qf(i,s),i.items.forEach(l=>{l.bounds.clear().union(a)});else if(r===wp||e.modified())switch(t.visit(t.MOD,l=>n.dirty(l)),a.clear(),i.items.forEach(l=>a.union(Qf(l,s))),i.role){case zv:case Lv:case Pv:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,l=>{a.union(Qf(l,s))}),t.visit(t.MOD,l=>{u=u||a.alignsWith(l.bounds),n.dirty(l),a.union(Qf(l,s))}),u&&(a.clear(),i.items.forEach(l=>a.union(l.bounds)));return XD(i),t.modifies("bounds")}});function Qf(e,t,n){return t(e.bounds.clear(),e,n)}const vE=":vega_identifier:";function Uv(e){F.call(this,0,e)}Uv.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};U(Uv,F,{transform(e,t){const n=_j(t.dataflow),i=e.as;let r=n.value;return t.visit(t.ADD,o=>o[i]=o[i]||++r),n.set(this.value=r),t}});function _j(e){return e._signals[vE]||(e._signals[vE]=e.add(0))}function a5(e){F.call(this,null,e)}U(a5,F,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,Sj(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const i=n.marktype===wp?fp:cp;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function Sj(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function u5(e){F.call(this,null,e)}const wE={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((i,r)=>!r||!l5(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}},l5=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),_E=(e,t)=>{for(var n=1,i=e.length,r=e[0].bounds,o;n<i;r=o,++n)if(l5(r,o=e[n].bounds,t))return!0},Ej=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},kj=(e,t,n)=>{var i=e.range(),r=new Qe;return t===xu||t===Lo?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),o=>r.encloses(o.bounds)},SE=e=>(e.forEach(t=>t.opacity=1),e),EE=(e,t)=>e.reflow(t.modified()).modifies("opacity");U(u5,F,{transform(e,t){const n=wE[e.method]||wE.parity,i=e.separation||0;let r=t.materialize(t.SOURCE).source,o,s;if(!r||!r.length)return;if(!e.method)return e.modified("method")&&(SE(r),t=EE(t,e)),t;if(r=r.filter(Ej),!r.length)return;if(e.sort&&(r=r.slice().sort(e.sort)),o=SE(r),t=EE(t,e),o.length>=3&&_E(o,i)){do o=n(o,i);while(o.length>=3&&_E(o,i));o.length<3&&!ye(r).opacity&&(o.length>1&&(ye(o).opacity=0),ye(r).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(s=kj(e.boundScale,e.boundOrient,+e.boundTolerance),r.forEach(u=>{s(u)||(u.opacity=0)}));const a=o[0].mark.bounds.clear();return r.forEach(u=>{u.opacity&&a.union(u.bounds)}),t}});function c5(e){F.call(this,null,e)}U(c5,F,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,i=>n.dirty(i)),t.fields&&t.fields.zindex){const i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}}});const Dt=new Qe;function Wa(e,t,n){return e[t]===n?0:(e[t]=n,1)}function $j(e){var t=e.items[0].orient;return t===gi||t===pi}function Aj(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function Cj(e,t,n,i){var r=t.items[0],o=r.datum,s=r.translate!=null?r.translate:.5,a=r.orient,u=Aj(o),l=r.range,c=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,g=o.title&&r.items[u[2]].items[0],p=r.titlePadding,m=r.bounds,y=g&&wv(g),b=0,x=0,v,w;switch(Dt.clear().union(m),m.clear(),(v=u[0])>-1&&m.union(r.items[v].bounds),(v=u[1])>-1&&m.union(r.items[v].bounds),a){case xu:b=f||0,x=-c,w=Math.max(d,Math.min(h,-m.y1)),m.add(0,-w).add(l,0),g&&Zf(e,g,w,p,y,0,-1,m);break;case gi:b=-c,x=f||0,w=Math.max(d,Math.min(h,-m.x1)),m.add(-w,0).add(0,l),g&&Zf(e,g,w,p,y,1,-1,m);break;case pi:b=n+c,x=f||0,w=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(w,l),g&&Zf(e,g,w,p,y,1,1,m);break;case Lo:b=f||0,x=i+c,w=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(l,w),g&&Zf(e,g,w,p,0,0,1,m);break;default:b=r.x,x=r.y}return Gr(m.translate(b,x),r),Wa(r,"x",b+s)|Wa(r,"y",x+s)&&(r.bounds=Dt,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function Zf(e,t,n,i,r,o,s,a){const u=t.bounds;if(t.auto){const l=s*(n+r+i);let c=0,f=0;e.dirty(t),o?c=(t.x||0)-(t.x=l):f=(t.y||0)-(t.y=l),t.mark.bounds.clear().union(u.translate(-c,-f)),e.dirty(t)}a.union(u)}const kE=(e,t)=>Math.floor(Math.min(e,t)),$E=(e,t)=>Math.ceil(Math.max(e,t));function Mj(e){var t=e.items,n=t.length,i=0,r,o;const s={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i)if(r=t[i],o=r.items,r.marktype===wp)switch(r.role){case zv:case Lv:case Pv:break;case JD:s.rowheaders.push(...o);break;case QD:s.rowfooters.push(...o);break;case e5:s.colheaders.push(...o);break;case t5:s.colfooters.push(...o);break;case ZD:s.rowtitle=o[0];break;case n5:s.coltitle=o[0];break;default:s.marks.push(...o)}return s}function Fj(e){return new Qe().set(0,0,e.width||0,e.height||0)}function Dj(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Pe(e,t,n){const i=G(e)?e[t]:e;return i??(n!==void 0?n:0)}function AE(e){return e<0?Math.ceil(-e):0}function f5(e,t,n){var i=!n.nodirty,r=n.bounds===Bv?Fj:Dj,o=Dt.set(0,0,0,0),s=Pe(n.align,yo),a=Pe(n.align,bo),u=Pe(n.padding,yo),l=Pe(n.padding,bo),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),g=Array(c),p=0,m=Array(d),y=Array(f),b=0,x=Array(d),v=Array(d),w=Array(d),S,_,E,A,k,$,T,M,D,C,R;for(_=0;_<c;++_)g[_]=0;for(_=0;_<f;++_)y[_]=0;for(_=0;_<d;++_)$=t[_],k=w[_]=r($),$.x=$.x||0,x[_]=0,$.y=$.y||0,v[_]=0,E=_%c,A=~~(_/c),p=Math.max(p,T=Math.ceil(k.x2)),b=Math.max(b,M=Math.ceil(k.y2)),g[E]=Math.max(g[E],T),y[A]=Math.max(y[A],M),h[_]=u+AE(k.x1),m[_]=l+AE(k.y1),i&&e.dirty(t[_]);for(_=0;_<d;++_)_%c===0&&(h[_]=0),_<c&&(m[_]=0);if(s===q1)for(E=1;E<c;++E){for(R=0,_=E;_<d;_+=c)R<h[_]&&(R=h[_]);for(_=E;_<d;_+=c)h[_]=R+g[E-1]}else if(s===Jf){for(R=0,_=0;_<d;++_)_%c&&R<h[_]&&(R=h[_]);for(_=0;_<d;++_)_%c&&(h[_]=R+p)}else for(s=!1,E=1;E<c;++E)for(_=E;_<d;_+=c)h[_]+=g[E-1];if(a===q1)for(A=1;A<f;++A){for(R=0,_=A*c,S=_+c;_<S;++_)R<m[_]&&(R=m[_]);for(_=A*c;_<S;++_)m[_]=R+y[A-1]}else if(a===Jf){for(R=0,_=c;_<d;++_)R<m[_]&&(R=m[_]);for(_=c;_<d;++_)m[_]=R+b}else for(a=!1,A=1;A<f;++A)for(_=A*c,S=_+c;_<S;++_)m[_]+=y[A-1];for(D=0,_=0;_<d;++_)D=h[_]+(_%c?D:0),x[_]+=D-t[_].x;for(E=0;E<c;++E)for(C=0,_=E;_<d;_+=c)C+=m[_],v[_]+=C-t[_].y;if(s&&Pe(n.center,yo)&&f>1)for(_=0;_<d;++_)k=s===Jf?p:g[_%c],D=k-w[_].x2-t[_].x-x[_],D>0&&(x[_]+=D/2);if(a&&Pe(n.center,bo)&&c!==1)for(_=0;_<d;++_)k=a===Jf?b:y[~~(_/c)],C=k-w[_].y2-t[_].y-v[_],C>0&&(v[_]+=C/2);for(_=0;_<d;++_)o.union(w[_].translate(x[_],v[_]));switch(D=Pe(n.anchor,pj),C=Pe(n.anchor,mj),Pe(n.anchor,yo)){case Vt:D-=o.width();break;case j1:D-=o.width()/2}switch(Pe(n.anchor,bo)){case Vt:C-=o.height();break;case j1:C-=o.height()/2}for(D=Math.round(D),C=Math.round(C),o.clear(),_=0;_<d;++_)t[_].mark.bounds.clear();for(_=0;_<d;++_)$=t[_],$.x+=x[_]+=D,$.y+=v[_]+=C,o.union($.mark.bounds.union($.bounds.translate(x[_],v[_]))),i&&e.dirty($);return o}function Tj(e,t,n){var i=Mj(t),r=i.marks,o=n.bounds===Bv?Nj:Oj,s=n.offset,a=n.columns||r.length,u=a<=0?1:Math.ceil(r.length/a),l=u*a,c,f,d,h,g,p,m;const y=f5(e,r,n);y.empty()&&y.set(0,0,0,0),i.rowheaders&&(p=Pe(n.headerBand,bo,null),c=ed(e,i.rowheaders,r,a,u,-Pe(s,"rowHeader"),kE,0,o,"x1",0,a,1,p)),i.colheaders&&(p=Pe(n.headerBand,yo,null),f=ed(e,i.colheaders,r,a,a,-Pe(s,"columnHeader"),kE,1,o,"y1",0,1,a,p)),i.rowfooters&&(p=Pe(n.footerBand,bo,null),d=ed(e,i.rowfooters,r,a,u,Pe(s,"rowFooter"),$E,0,o,"x2",a-1,a,1,p)),i.colfooters&&(p=Pe(n.footerBand,yo,null),h=ed(e,i.colfooters,r,a,a,Pe(s,"columnFooter"),$E,1,o,"y2",l-a,1,a,p)),i.rowtitle&&(g=Pe(n.titleAnchor,bo),m=Pe(s,"rowTitle"),m=g===Vt?d+m:c-m,p=Pe(n.titleBand,bo,.5),CE(e,i.rowtitle,m,0,y,p)),i.coltitle&&(g=Pe(n.titleAnchor,yo),m=Pe(s,"columnTitle"),m=g===Vt?h+m:f-m,p=Pe(n.titleBand,yo,.5),CE(e,i.coltitle,m,1,y,p))}function Nj(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function Oj(e,t){return e.bounds[t]}function ed(e,t,n,i,r,o,s,a,u,l,c,f,d,h){var g=n.length,p=0,m=0,y,b,x,v,w,S,_,E,A;if(!g)return p;for(y=c;y<g;y+=f)n[y]&&(p=s(p,u(n[y],l)));if(!t.length)return p;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),p+=o,b=0,v=t.length;b<v;++b)e.dirty(t[b]),t[b].mark.bounds.clear();for(y=c,b=0,v=t.length;b<v;++b,y+=f){for(S=t[b],w=S.mark.bounds,x=y;x>=0&&(_=n[x])==null;x-=d);a?(E=h==null?_.x:Math.round(_.bounds.x1+h*_.bounds.width()),A=p):(E=p,A=h==null?_.y:Math.round(_.bounds.y1+h*_.bounds.height())),w.union(S.bounds.translate(E-(S.x||0),A-(S.y||0))),S.x=E,S.y=A,e.dirty(S),m=s(m,w[l])}return m}function CE(e,t,n,i,r,o){if(t){e.dirty(t);var s=n,a=n;i?s=Math.round(r.x1+o*r.width()):a=Math.round(r.y1+o*r.height()),t.bounds.translate(s-(t.x||0),a-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=s,t.y=a,e.dirty(t)}}function Rj(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function zj(e,t){let n=-1/0;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-1/0?n:t}function Pj(e,t,n,i,r,o,s){const a=Rj(n,t),u=zj(e,a("offset",0)),l=a("anchor",Rv),c=l===Vt?1:l===j1?.5:0,f={align:q1,bounds:a("bounds",Bv),columns:a("direction")==="vertical"?1:e.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(t){case gi:f.anchor={x:Math.floor(i.x1)-u,column:Vt,y:c*(s||i.height()+2*i.y1),row:l};break;case pi:f.anchor={x:Math.ceil(i.x2)+u,y:c*(s||i.height()+2*i.y1),row:l};break;case xu:f.anchor={y:Math.floor(r.y1)-u,row:Vt,x:c*(o||r.width()+2*r.x1),column:l};break;case Lo:f.anchor={y:Math.ceil(r.y2)+u,x:c*(o||r.width()+2*r.x1),column:l};break;case fj:f.anchor={x:u,y:u};break;case dj:f.anchor={x:o-u,y:u,column:Vt};break;case hj:f.anchor={x:u,y:s-u,row:Vt};break;case gj:f.anchor={x:o-u,y:s-u,column:Vt,row:Vt};break}return f}function Lj(e,t){var n=t.items[0],i=n.datum,r=n.orient,o=n.bounds,s=n.x,a=n.y,u,l;return n._bounds?n._bounds.clear().union(o):n._bounds=o.clone(),o.clear(),Bj(e,n,n.items[0].items[0]),o=Ij(n,o),u=2*n.padding,l=2*n.padding,o.empty()||(u=Math.ceil(o.width()+u),l=Math.ceil(o.height()+l)),i.type===vj&&Uj(n.items[0].items[0].items[0].items),r!==Iv&&(n.x=s=0,n.y=a=0),n.width=u,n.height=l,Gr(o.set(s,a,s+u,a+l),n),n.mark.bounds.clear().union(o),n}function Ij(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function Bj(e,t,n){var i=t.padding,r=i-n.x,o=i-n.y;if(!t.datum.title)(r||o)&&bl(e,n,r,o);else{var s=t.items[1].items[0],a=s.anchor,u=t.titlePadding||0,l=i-s.x,c=i-s.y;switch(s.orient){case gi:r+=Math.ceil(s.bounds.width())+u;break;case pi:case Lo:break;default:o+=s.bounds.height()+u}switch((r||o)&&bl(e,n,r,o),s.orient){case gi:c+=Fa(t,n,s,a,1,1);break;case pi:l+=Fa(t,n,s,Vt,0,0)+u,c+=Fa(t,n,s,a,1,1);break;case Lo:l+=Fa(t,n,s,a,0,0),c+=Fa(t,n,s,Vt,-1,0,1)+u;break;default:l+=Fa(t,n,s,a,0,0)}(l||c)&&bl(e,s,l,c),(l=Math.round(s.bounds.x1-i))<0&&(bl(e,n,-l,0),bl(e,s,-l,0))}}function Fa(e,t,n,i,r,o,s){const a=e.datum.type!=="symbol",u=n.datum.vgrad,l=a&&(o||!u)&&!s?t.items[0]:t,c=l.bounds[r?"y2":"x2"]-e.padding,f=u&&o?c:0,d=u&&o?0:c,h=r<=0?0:wv(n);return Math.round(i===Rv?f:i===Vt?d-h:.5*(c-h))}function bl(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function Uj(e){const t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function jj(e,t,n,i,r){var o=t.items[0],s=o.frame,a=o.orient,u=o.anchor,l=o.offset,c=o.padding,f=o.items[0].items[0],d=o.items[1]&&o.items[1].items[0],h=a===gi||a===pi?i:n,g=0,p=0,m=0,y=0,b=0,x;if(s!==wp?a===gi?(g=r.y2,h=r.y1):a===pi?(g=r.y1,h=r.y2):(g=r.x1,h=r.x2):a===gi&&(g=i,h=0),x=u===Rv?g:u===Vt?h:(g+h)/2,d&&d.text){switch(a){case xu:case Lo:b=f.bounds.height()+c;break;case gi:y=f.bounds.width()+c;break;case pi:y=-f.bounds.width()-c;break}Dt.clear().union(d.bounds),Dt.translate(y-(d.x||0),b-(d.y||0)),Wa(d,"x",y)|Wa(d,"y",b)&&(e.dirty(d),d.bounds.clear().union(Dt),d.mark.bounds.clear().union(Dt),e.dirty(d)),Dt.clear().union(d.bounds)}else Dt.clear();switch(Dt.union(f.bounds),a){case xu:p=x,m=r.y1-Dt.height()-l;break;case gi:p=r.x1-Dt.width()-l,m=x;break;case pi:p=r.x2+Dt.width()+l,m=x;break;case Lo:p=x,m=r.y2+l;break;default:p=o.x,m=o.y}return Wa(o,"x",p)|Wa(o,"y",m)&&(Dt.translate(p,m),e.dirty(o),o.bounds.clear().union(Dt),t.bounds.clear().union(Dt),e.dirty(o)),o.bounds}function d5(e){F.call(this,null,e)}U(d5,F,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&Tj(n,i,e.layout),Wj(n,i,e)}),qj(e.mark.group)?t.reflow():t}});function qj(e){return e&&e.mark.role!=="legend-entry"}function Wj(e,t,n){var i=t.items,r=Math.max(0,t.width||0),o=Math.max(0,t.height||0),s=new Qe().set(0,0,r,o),a=s.clone(),u=s.clone(),l=[],c,f,d,h,g,p;for(g=0,p=i.length;g<p;++g)switch(f=i[g],f.role){case zv:h=$j(f)?a:u,h.union(Cj(e,f,r,o));break;case Pv:c=f;break;case Lv:l.push(Lj(e,f));break;case yj:case bj:case JD:case QD:case ZD:case e5:case t5:case n5:a.union(f.bounds),u.union(f.bounds);break;default:s.union(f.bounds)}if(l.length){const m={};l.forEach(y=>{d=y.orient||pi,d!==Iv&&(m[d]||(m[d]=[])).push(y)});for(const y in m){const b=m[y];f5(e,b,Pj(b,y,n.legends,a,u,r,o))}l.forEach(y=>{const b=y.bounds;if(b.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=b,e.dirty(y)),n.autosize&&(n.autosize.type===i5||n.autosize.type===r5||n.autosize.type===o5))switch(y.orient){case gi:case pi:s.add(b.x1,0).add(b.x2,0);break;case xu:case Lo:s.add(0,b.y1).add(0,b.y2)}else s.union(b)})}s.union(a).union(u),c&&s.union(jj(e,c,r,o,s)),t.clip&&s.set(0,0,t.width||0,t.height||0),Hj(e,t,s,n)}function Hj(e,t,n,i){const r=i.autosize||{},o=r.type;if(e._autosize<1||!o)return;let s=e._width,a=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-u)),h=Math.max(0,Math.ceil(n.y2-c));if(r.contains===xj){const g=e.padding();s-=g.left+g.right,a-=g.top+g.bottom}o===Iv?(l=0,f=0,u=s,c=a):o===i5?(u=Math.max(0,s-l-d),c=Math.max(0,a-f-h)):o===r5?(u=Math.max(0,s-l-d),a=c+f+h):o===o5?(s=u+l+d,c=Math.max(0,a-f-h)):o===wj&&(s=u+l+d,a=c+f+h),e._resizeView(s,a,u,c,[l,f],r.resize)}const Gj=Object.freeze(Object.defineProperty({__proto__:null,bound:s5,identifier:Uv,mark:a5,overlap:u5,render:c5,viewlayout:d5},Symbol.toStringTag,{value:"Module"}));function h5(e){F.call(this,null,e)}U(h5,F,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,o=e.scale,s=e.count==null?e.values?e.values.length:10:e.count,a=nv(o,s,e.minstep),u=e.format||W3(n,o,a,e.formatSpecifier,e.formatType,!!e.values),l=e.values?q3(o,e.values,a):iv(o,a);return r&&(i.rem=r),r=l.map((c,f)=>Ee({index:f/(l.length-1||1),value:c,label:u(c)})),e.extra&&r.length&&r.push(Ee({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}});function g5(e){F.call(this,null,e)}function Yj(){return Ee({})}function Vj(e){const t=Bu().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}U(g5,F,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||Yj,o=e.key||ee,s=this.value;return z(i.encode)&&(i.encode=null),s&&(e.modified("key")||t.modified(o))&&O("DataJoin does not support modified key function or fields."),s||(t=t.addAll(),this.value=s=Vj(o)),t.visit(t.ADD,a=>{const u=o(a);let l=s.get(u);l?l.exit?(s.empty--,i.add.push(l)):i.mod.push(l):(l=r(a),s.set(u,l),i.add.push(l)),l.datum=a,l.exit=!1}),t.visit(t.MOD,a=>{const u=o(a),l=s.get(u);l&&(l.datum=a,i.mod.push(l))}),t.visit(t.REM,a=>{const u=o(a),l=s.get(u);a===l.datum&&!l.exit&&(i.rem.push(l),l.exit=!0,++s.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&s.empty>n.cleanThreshold)&&n.runAfter(s.clean),i}});function p5(e){F.call(this,null,e)}U(p5,F,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,o=t.encode;if(z(o))if(n.changed()||o.every(f=>r[f]))o=o[0],n.encode=null;else return t.StopPropagation;var s=o==="enter",a=r.update||io,u=r.enter||io,l=r.exit||io,c=(o&&!s?r[o]:a)||io;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{u(f,e),a(f,e)}),n.modifies(u.output),n.modifies(a.output),c!==io&&c!==a&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&l!==io&&(t.visit(t.REM,f=>{l(f,e)}),n.modifies(l.output)),s||c!==io){const f=t.MOD|(e.modified()?t.REFLOW:0);s?(t.visit(f,d=>{const h=u(d,e)||i;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(u.output)):t.visit(f,d=>{(c(d,e)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function m5(e){F.call(this,[],e)}U(m5,F,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,o=e.type||Ad,s=e.scale,a=+e.limit,u=nv(s,e.count==null?5:e.count,e.minstep),l=!!e.values||o===Ad,c=e.format||V3(n,s,u,o,e.formatSpecifier,e.formatType,l),f=e.values||Y3(s,u),d,h,g,p,m;return r&&(i.rem=r),o===Ad?(a&&f.length>a?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,a-1),m=!0):r=f,ue(g=e.size)?(!e.values&&s(r[0])===0&&(r=r.slice(1)),p=r.reduce((y,b)=>Math.max(y,g(b,e)),0)):g=jt(p=g||8),r=r.map((y,b)=>Ee({index:b,label:c(y,b,r),value:y,offset:p,size:g(y,e)})),m&&(m=f[r.length],r.push(Ee({index:r.length,label:`…${f.length-r.length} entries`,value:m,offset:p,size:g(m,e)})))):o===vI?(d=s.domain(),h=B3(s,d[0],ye(d)),f.length<3&&!e.values&&d[0]!==ye(d)&&(f=[d[0],ye(d)]),r=f.map((y,b)=>Ee({index:b,label:c(y,b,f),value:y,perc:h(y)}))):(g=f.length-1,h=DI(s),r=f.map((y,b)=>Ee({index:b,label:c(y,b,f),value:y,perc:b?h(y):0,perc2:b===g?1:h(f[b+1])}))),i.source=r,i.add=r,this.value=r,i}});const Xj=e=>e.source.x,Kj=e=>e.source.y,Jj=e=>e.target.x,Qj=e=>e.target.y;function jv(e){F.call(this,{},e)}jv.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};U(jv,F,{transform(e,t){var n=e.sourceX||Xj,i=e.sourceY||Kj,r=e.targetX||Jj,o=e.targetY||Qj,s=e.as||"path",a=e.orient||"vertical",u=e.shape||"line",l=ME.get(u+"-"+a)||ME.get(u);return l||O("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[s]=l(n(c),i(c),r(c),o(c))}),t.reflow(e.modified()).modifies(s)}});const y5=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,Zj=(e,t,n,i)=>y5(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),b5=(e,t,n,i)=>{var r=n-e,o=i-t,s=Math.hypot(r,o)/2,a=180*Math.atan2(o,r)/Math.PI;return"M"+e+","+t+"A"+s+","+s+" "+a+" 0 1 "+n+","+i},eq=(e,t,n,i)=>b5(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),x5=(e,t,n,i)=>{const r=n-e,o=i-t,s=.2*(r+o),a=.2*(o-r);return"M"+e+","+t+"C"+(e+s)+","+(t+a)+" "+(n+a)+","+(i-s)+" "+n+","+i},tq=(e,t,n,i)=>x5(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),nq=(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,iq=(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,rq=(e,t,n,i)=>{const r=Math.cos(e),o=Math.sin(e),s=Math.cos(n),a=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*o+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*s+","+t*a+"L"+i*s+","+i*a},oq=(e,t,n,i)=>{const r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i},sq=(e,t,n,i)=>{const r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i},aq=(e,t,n,i)=>{const r=Math.cos(e),o=Math.sin(e),s=Math.cos(n),a=Math.sin(n),u=(t+i)/2;return"M"+t*r+","+t*o+"C"+u*r+","+u*o+" "+u*s+","+u*a+" "+i*s+","+i*a},ME=Bu({line:y5,"line-radial":Zj,arc:b5,"arc-radial":eq,curve:x5,"curve-radial":tq,"orthogonal-horizontal":nq,"orthogonal-vertical":iq,"orthogonal-radial":rq,"diagonal-horizontal":oq,"diagonal-vertical":sq,"diagonal-radial":aq});function qv(e){F.call(this,null,e)}qv.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};U(qv,F,{transform(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],o=e.field||Iu,s=e.startAngle||0,a=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(o),c=l.length,f=s,d=(a-s)/zC(l),h=Fn(c),g,p,m;for(e.sort&&h.sort((y,b)=>l[y]-l[b]),g=0;g<c;++g)m=l[h[g]],p=u[h[g]],p[i]=f,p[r]=f+=m*d;return this.value=l,t.reflow(e.modified()).modifies(n)}});const uq=5;function lq(e){const t=e.type;return!e.bins&&(t===hu||t===of||t===sf)}function v5(e){return Zx(e)&&e!==Vi}const cq=Si(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function w5(e){F.call(this,null,e),this.modified(!0)}U(w5,F,{transform(e,t){var n=t.dataflow,i=this.value,r=fq(e);(!i||r!==i.type)&&(this.value=i=_e(r)());for(r in e)if(!cq[r]){if(r==="padding"&&v5(i.type))continue;ue(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return yq(i,e,mq(i,e,hq(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function fq(e){var t=e.type,n="",i;return t===Vi?Vi+"-"+hu:(dq(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?Vi+"-":i===3?Vu+"-":""),(n+t||hu).toLowerCase())}function dq(e){const t=e.type;return Zx(t)&&t!==js&&t!==qs&&(e.scheme||e.range&&e.range.length&&e.range.every(Y))}function hq(e,t,n){const i=gq(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,o=e.type,s=t.zero||t.zero===void 0&&lq(e),a,u;if(!r)return 0;if(v5(o)&&t.padding&&r[0]!==ye(r)&&(r=pq(o,r,t.range,t.padding,t.exponent,t.constant)),(s||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(a=(r=r.slice()).length-1||1,s&&(r[0]>0&&(r[0]=0),r[a]<0&&(r[a]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[a]=t.domainMax),t.domainMid!=null)){u=t.domainMid;const l=u>r[a]?a+1:u<r[0]?0:a;l!==a&&n.warn("Scale domainMid exceeds domain min or max.",u),r.splice(l,0,u)}return e.domain(_5(o,r,n)),o===Xx&&e.unknown(t.domainImplicit?w1:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&nv(e,t.nice)||null),r.length}function gq(e,t,n){return t?(e.domain(_5(e.type,t,n)),t.length):-1}function pq(e,t,n,i,r,o){var s=Math.abs(ye(n)-n[0]),a=s/(s-2*i),u=e===jr?mb(t,null,a):e===sf?Jd(t,null,a,.5):e===of?Jd(t,null,a,r||1):e===op?yb(t,null,a,o||1):pb(t,null,a);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function _5(e,t,n){if(R3(e)){var i=Math.abs(t.reduce((r,o)=>r+(o<0?-1:o>0?1:0),0));i!==t.length&&n.warn("Log scale domain includes zero: "+j(t))}return t}function mq(e,t,n){let i=t.bins;if(i&&!z(i)){const r=e.domain(),o=r[0],s=ye(r),a=i.step;let u=i.start==null?o:i.start,l=i.stop==null?s:i.stop;a||O("Scale bins parameter missing step property."),u<o&&(u=a*Math.ceil(o/a)),l>s&&(l=a*Math.floor(s/a)),i=Fn(u,l+a/2,a)}return i?e.bins=i:e.bins&&delete e.bins,e.type===Kx&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function yq(e,t,n){var i=e.type,r=t.round||!1,o=t.range;if(t.rangeStep!=null)o=bq(i,t,n);else if(t.scheme&&(o=xq(i,t,n),ue(o))){if(e.interpolator)return e.interpolator(o);O(`Scale type ${i} does not support interpolating color schemes.`)}if(o&&z3(i))return e.interpolator(up(W1(o,t.reverse),t.interpolate,t.interpolateGamma));o&&t.interpolate&&e.interpolate?e.interpolate(ev(t.interpolate,t.interpolateGamma)):ue(e.round)?e.round(r):ue(e.rangeRound)&&e.interpolate(r?nf:Xo),o&&e.range(W1(o,t.reverse))}function bq(e,t,n){e!==M3&&e!==C1&&O("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===C1?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Vx(n,r,i)]}function xq(e,t,n){var i=t.schemeExtent,r,o;return z(t.scheme)?o=up(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),o=tv(r),o||O(`Unrecognized scheme name: ${t.scheme}`)),n=e===ap?n+1:e===Kx?n-1:e===gu||e===sp?+t.schemeCount||uq:n,z3(e)?FE(o,i,t.reverse):ue(o)?I3(FE(o,i),n):e===Xx?o:o.slice(0,n)}function FE(e,t,n){return ue(e)&&(t||n)?L3(e,W1(t||[0,1],n)):e}function W1(e,t){return t?e.slice().reverse():e}function S5(e){F.call(this,null,e)}U(S5,F,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(fa(e.sort)),this.modified(n),t}});const DE="zero",E5="center",k5="normalize",$5=["y0","y1"];function Wv(e){F.call(this,null,e)}Wv.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:DE,values:[DE,E5,k5]},{name:"as",type:"string",array:!0,length:2,default:$5}]};U(Wv,F,{transform(e,t){var n=e.as||$5,i=n[0],r=n[1],o=fa(e.sort),s=e.field||Iu,a=e.offset===E5?vq:e.offset===k5?wq:_q,u,l,c,f;for(u=Sq(t.source,e.groupby,o,s),l=0,c=u.length,f=u.max;l<c;++l)a(u[l],f,s,i,r);return t.reflow(e.modified()).modifies(n)}});function vq(e,t,n,i,r){for(var o=(t-e.sum)/2,s=e.length,a=0,u;a<s;++a)u=e[a],u[i]=o,u[r]=o+=Math.abs(n(u))}function wq(e,t,n,i,r){for(var o=1/e.sum,s=0,a=e.length,u=0,l=0,c;u<a;++u)c=e[u],c[i]=s,c[r]=s=o*(l+=Math.abs(n(c)))}function _q(e,t,n,i,r){for(var o=0,s=0,a=e.length,u=0,l,c;u<a;++u)c=e[u],l=+n(c),l<0?(c[i]=s,c[r]=s+=l):(c[i]=o,c[r]=o+=l)}function Sq(e,t,n,i){var r=[],o=p=>p(c),s,a,u,l,c,f,d,h,g;if(t==null)r.push(e.slice());else for(s={},a=0,u=e.length;a<u;++a)c=e[a],f=t.map(o),d=s[f],d||(s[f]=d=[],r.push(d)),d.push(c);for(f=0,g=0,l=r.length;f<l;++f){for(d=r[f],a=0,h=0,u=d.length;a<u;++a)h+=Math.abs(i(d[a]));d.sum=h,h>g&&(g=h),n&&d.sort(n)}return r.max=g,r}const Eq=Object.freeze(Object.defineProperty({__proto__:null,axisticks:h5,datajoin:g5,encode:p5,legendentries:m5,linkpath:jv,pie:qv,scale:w5,sortitems:S5,stack:Wv},Symbol.toStringTag,{value:"Module"}));var ie=1e-6,Ch=1e-12,de=Math.PI,He=de/2,Mh=de/4,rn=de*2,Ye=180/de,ce=de/180,me=Math.abs,Ku=Math.atan,ei=Math.atan2,re=Math.cos,td=Math.ceil,A5=Math.exp,H1=Math.hypot,Fh=Math.log,s0=Math.pow,te=Math.sin,Hn=Math.sign||function(e){return e>0?1:e<0?-1:0},on=Math.sqrt,Hv=Math.tan;function C5(e){return e>1?0:e<-1?de:Math.acos(e)}function xn(e){return e>1?He:e<-1?-He:Math.asin(e)}function wt(){}function Dh(e,t){e&&NE.hasOwnProperty(e.type)&&NE[e.type](e,t)}var TE={Feature:function(e,t){Dh(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)Dh(n[i].geometry,t)}},NE={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){G1(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)G1(n[i],t,0)},Polygon:function(e,t){OE(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)OE(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)Dh(n[i],t)}};function G1(e,t,n){var i=-1,r=e.length-n,o;for(t.lineStart();++i<r;)o=e[i],t.point(o[0],o[1],o[2]);t.lineEnd()}function OE(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)G1(e[n],t,1);t.polygonEnd()}function $r(e,t){e&&TE.hasOwnProperty(e.type)?TE[e.type](e,t):Dh(e,t)}var Th=new en,Nh=new en,M5,F5,Y1,V1,X1,nr={point:wt,lineStart:wt,lineEnd:wt,polygonStart:function(){Th=new en,nr.lineStart=kq,nr.lineEnd=$q},polygonEnd:function(){var e=+Th;Nh.add(e<0?rn+e:e),this.lineStart=this.lineEnd=this.point=wt},sphere:function(){Nh.add(rn)}};function kq(){nr.point=Aq}function $q(){D5(M5,F5)}function Aq(e,t){nr.point=D5,M5=e,F5=t,e*=ce,t*=ce,Y1=e,V1=re(t=t/2+Mh),X1=te(t)}function D5(e,t){e*=ce,t*=ce,t=t/2+Mh;var n=e-Y1,i=n>=0?1:-1,r=i*n,o=re(t),s=te(t),a=X1*s,u=V1*o+a*re(r),l=a*i*te(r);Th.add(ei(l,u)),Y1=e,V1=o,X1=s}function Cq(e){return Nh=new en,$r(e,nr),Nh*2}function Oh(e){return[ei(e[1],e[0]),xn(e[2])]}function Hs(e){var t=e[0],n=e[1],i=re(n);return[i*re(t),i*te(t),te(n)]}function nd(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function vu(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function a0(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function id(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Rh(e){var t=on(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ue,fn,je,An,ws,T5,N5,Ja,ic,uo,qr,Er={point:K1,lineStart:RE,lineEnd:zE,polygonStart:function(){Er.point=R5,Er.lineStart=Mq,Er.lineEnd=Fq,ic=new en,nr.polygonStart()},polygonEnd:function(){nr.polygonEnd(),Er.point=K1,Er.lineStart=RE,Er.lineEnd=zE,Th<0?(Ue=-(je=180),fn=-(An=90)):ic>ie?An=90:ic<-ie&&(fn=-90),qr[0]=Ue,qr[1]=je},sphere:function(){Ue=-(je=180),fn=-(An=90)}};function K1(e,t){uo.push(qr=[Ue=e,je=e]),t<fn&&(fn=t),t>An&&(An=t)}function O5(e,t){var n=Hs([e*ce,t*ce]);if(Ja){var i=vu(Ja,n),r=[i[1],-i[0],0],o=vu(r,i);Rh(o),o=Oh(o);var s=e-ws,a=s>0?1:-1,u=o[0]*Ye*a,l,c=me(s)>180;c^(a*ws<u&&u<a*e)?(l=o[1]*Ye,l>An&&(An=l)):(u=(u+360)%360-180,c^(a*ws<u&&u<a*e)?(l=-o[1]*Ye,l<fn&&(fn=l)):(t<fn&&(fn=t),t>An&&(An=t))),c?e<ws?$n(Ue,e)>$n(Ue,je)&&(je=e):$n(e,je)>$n(Ue,je)&&(Ue=e):je>=Ue?(e<Ue&&(Ue=e),e>je&&(je=e)):e>ws?$n(Ue,e)>$n(Ue,je)&&(je=e):$n(e,je)>$n(Ue,je)&&(Ue=e)}else uo.push(qr=[Ue=e,je=e]);t<fn&&(fn=t),t>An&&(An=t),Ja=n,ws=e}function RE(){Er.point=O5}function zE(){qr[0]=Ue,qr[1]=je,Er.point=K1,Ja=null}function R5(e,t){if(Ja){var n=e-ws;ic.add(me(n)>180?n+(n>0?360:-360):n)}else T5=e,N5=t;nr.point(e,t),O5(e,t)}function Mq(){nr.lineStart()}function Fq(){R5(T5,N5),nr.lineEnd(),me(ic)>ie&&(Ue=-(je=180)),qr[0]=Ue,qr[1]=je,Ja=null}function $n(e,t){return(t-=e)<0?t+360:t}function Dq(e,t){return e[0]-t[0]}function PE(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function Tq(e){var t,n,i,r,o,s,a;if(An=je=-(Ue=fn=1/0),uo=[],$r(e,Er),n=uo.length){for(uo.sort(Dq),t=1,i=uo[0],o=[i];t<n;++t)r=uo[t],PE(i,r[0])||PE(i,r[1])?($n(i[0],r[1])>$n(i[0],i[1])&&(i[1]=r[1]),$n(r[0],i[1])>$n(i[0],i[1])&&(i[0]=r[0])):o.push(i=r);for(s=-1/0,n=o.length-1,t=0,i=o[n];t<=n;i=r,++t)r=o[t],(a=$n(i[1],r[0]))>s&&(s=a,Ue=r[0],je=i[1])}return uo=qr=null,Ue===1/0||fn===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ue,fn],[je,An]]}var Bl,zh,Ph,Lh,Ih,Bh,Uh,jh,J1,Q1,Z1,z5,P5,Xt,Kt,Jt,mi={sphere:wt,point:Gv,lineStart:LE,lineEnd:IE,polygonStart:function(){mi.lineStart=Rq,mi.lineEnd=zq},polygonEnd:function(){mi.lineStart=LE,mi.lineEnd=IE}};function Gv(e,t){e*=ce,t*=ce;var n=re(t);mf(n*re(e),n*te(e),te(t))}function mf(e,t,n){++Bl,Ph+=(e-Ph)/Bl,Lh+=(t-Lh)/Bl,Ih+=(n-Ih)/Bl}function LE(){mi.point=Nq}function Nq(e,t){e*=ce,t*=ce;var n=re(t);Xt=n*re(e),Kt=n*te(e),Jt=te(t),mi.point=Oq,mf(Xt,Kt,Jt)}function Oq(e,t){e*=ce,t*=ce;var n=re(t),i=n*re(e),r=n*te(e),o=te(t),s=ei(on((s=Kt*o-Jt*r)*s+(s=Jt*i-Xt*o)*s+(s=Xt*r-Kt*i)*s),Xt*i+Kt*r+Jt*o);zh+=s,Bh+=s*(Xt+(Xt=i)),Uh+=s*(Kt+(Kt=r)),jh+=s*(Jt+(Jt=o)),mf(Xt,Kt,Jt)}function IE(){mi.point=Gv}function Rq(){mi.point=Pq}function zq(){L5(z5,P5),mi.point=Gv}function Pq(e,t){z5=e,P5=t,e*=ce,t*=ce,mi.point=L5;var n=re(t);Xt=n*re(e),Kt=n*te(e),Jt=te(t),mf(Xt,Kt,Jt)}function L5(e,t){e*=ce,t*=ce;var n=re(t),i=n*re(e),r=n*te(e),o=te(t),s=Kt*o-Jt*r,a=Jt*i-Xt*o,u=Xt*r-Kt*i,l=H1(s,a,u),c=xn(l),f=l&&-c/l;J1.add(f*s),Q1.add(f*a),Z1.add(f*u),zh+=c,Bh+=c*(Xt+(Xt=i)),Uh+=c*(Kt+(Kt=r)),jh+=c*(Jt+(Jt=o)),mf(Xt,Kt,Jt)}function Lq(e){Bl=zh=Ph=Lh=Ih=Bh=Uh=jh=0,J1=new en,Q1=new en,Z1=new en,$r(e,mi);var t=+J1,n=+Q1,i=+Z1,r=H1(t,n,i);return r<Ch&&(t=Bh,n=Uh,i=jh,zh<ie&&(t=Ph,n=Lh,i=Ih),r=H1(t,n,i),r<Ch)?[NaN,NaN]:[ei(n,t)*Ye,xn(i/r)*Ye]}function ey(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function ty(e,t){return me(e)>de&&(e-=Math.round(e/rn)*rn),[e,t]}ty.invert=ty;function I5(e,t,n){return(e%=rn)?t||n?ey(UE(e),jE(t,n)):UE(e):t||n?jE(t,n):ty}function BE(e){return function(t,n){return t+=e,me(t)>de&&(t-=Math.round(t/rn)*rn),[t,n]}}function UE(e){var t=BE(e);return t.invert=BE(-e),t}function jE(e,t){var n=re(e),i=te(e),r=re(t),o=te(t);function s(a,u){var l=re(u),c=re(a)*l,f=te(a)*l,d=te(u),h=d*n+c*i;return[ei(f*r-h*o,c*n-d*i),xn(h*r+f*o)]}return s.invert=function(a,u){var l=re(u),c=re(a)*l,f=te(a)*l,d=te(u),h=d*r-f*o;return[ei(f*r+d*o,c*n+h*i),xn(h*n-c*i)]},s}function Iq(e){e=I5(e[0]*ce,e[1]*ce,e.length>2?e[2]*ce:0);function t(n){return n=e(n[0]*ce,n[1]*ce),n[0]*=Ye,n[1]*=Ye,n}return t.invert=function(n){return n=e.invert(n[0]*ce,n[1]*ce),n[0]*=Ye,n[1]*=Ye,n},t}function Bq(e,t,n,i,r,o){if(n){var s=re(t),a=te(t),u=i*n;r==null?(r=t+i*rn,o=t-u/2):(r=qE(s,r),o=qE(s,o),(i>0?r<o:r>o)&&(r+=i*rn));for(var l,c=r;i>0?c>o:c<o;c-=u)l=Oh([s,-a*re(c),-a*te(c)]),e.point(l[0],l[1])}}function qE(e,t){t=Hs(t),t[0]-=e,Rh(t);var n=C5(-t[1]);return((-t[2]<0?-n:n)+rn-ie)%rn}function B5(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:wt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Rd(e,t){return me(e[0]-t[0])<ie&&me(e[1]-t[1])<ie}function rd(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function U5(e,t,n,i,r){var o=[],s=[],a,u;if(e.forEach(function(g){if(!((p=g.length-1)<=0)){var p,m=g[0],y=g[p],b;if(Rd(m,y)){if(!m[2]&&!y[2]){for(r.lineStart(),a=0;a<p;++a)r.point((m=g[a])[0],m[1]);r.lineEnd();return}y[0]+=2*ie}o.push(b=new rd(m,g,null,!0)),s.push(b.o=new rd(m,null,b,!1)),o.push(b=new rd(y,g,null,!1)),s.push(b.o=new rd(y,null,b,!0))}}),!!o.length){for(s.sort(t),WE(o),WE(s),a=0,u=s.length;a<u;++a)s[a].e=n=!n;for(var l=o[0],c,f;;){for(var d=l,h=!0;d.v;)if((d=d.n)===l)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,u=c.length;a<u;++a)r.point((f=c[a])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(c=d.p.z,a=c.length-1;a>=0;--a)r.point((f=c[a])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);r.lineEnd()}}}function WE(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function u0(e){return me(e[0])<=de?e[0]:Hn(e[0])*((me(e[0])+de)%rn-de)}function Uq(e,t){var n=u0(t),i=t[1],r=te(i),o=[te(n),-re(n),0],s=0,a=0,u=new en;r===1?i=He+ie:r===-1&&(i=-He-ie);for(var l=0,c=e.length;l<c;++l)if(d=(f=e[l]).length)for(var f,d,h=f[d-1],g=u0(h),p=h[1]/2+Mh,m=te(p),y=re(p),b=0;b<d;++b,g=v,m=S,y=_,h=x){var x=f[b],v=u0(x),w=x[1]/2+Mh,S=te(w),_=re(w),E=v-g,A=E>=0?1:-1,k=A*E,$=k>de,T=m*S;if(u.add(ei(T*A*te(k),y*_+T*re(k))),s+=$?E+A*rn:E,$^g>=n^v>=n){var M=vu(Hs(h),Hs(x));Rh(M);var D=vu(o,M);Rh(D);var C=($^E>=0?-1:1)*xn(D[2]);(i>C||i===C&&(M[0]||M[1]))&&(a+=$^E>=0?1:-1)}}return(s<-ie||s<ie&&u<-Ch)^a&1}function j5(e,t,n,i){return function(r){var o=t(r),s=B5(),a=t(s),u=!1,l,c,f,d={point:h,lineStart:p,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=b,d.lineEnd=x,c=[],l=[]},polygonEnd:function(){d.point=h,d.lineStart=p,d.lineEnd=m,c=RC(c);var v=Uq(l,i);c.length?(u||(r.polygonStart(),u=!0),U5(c,qq,v,n,r)):v&&(u||(r.polygonStart(),u=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),u&&(r.polygonEnd(),u=!1),c=l=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(v,w){e(v,w)&&r.point(v,w)}function g(v,w){o.point(v,w)}function p(){d.point=g,o.lineStart()}function m(){d.point=h,o.lineEnd()}function y(v,w){f.push([v,w]),a.point(v,w)}function b(){a.lineStart(),f=[]}function x(){y(f[0][0],f[0][1]),a.lineEnd();var v=a.clean(),w=s.result(),S,_=w.length,E,A,k;if(f.pop(),l.push(f),f=null,!!_){if(v&1){if(A=w[0],(E=A.length-1)>0){for(u||(r.polygonStart(),u=!0),r.lineStart(),S=0;S<E;++S)r.point((k=A[S])[0],k[1]);r.lineEnd()}return}_>1&&v&2&&w.push(w.pop().concat(w.shift())),c.push(w.filter(jq))}}return d}}function jq(e){return e.length>1}function qq(e,t){return((e=e.x)[0]<0?e[1]-He-ie:He-e[1])-((t=t.x)[0]<0?t[1]-He-ie:He-t[1])}const HE=j5(function(){return!0},Wq,Gq,[-de,-He]);function Wq(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(o,s){var a=o>0?de:-de,u=me(o-t);me(u-de)<ie?(e.point(t,n=(n+s)/2>0?He:-He),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(o,n),r=0):i!==a&&u>=de&&(me(t-i)<ie&&(t-=i*ie),me(o-a)<ie&&(o-=a*ie),n=Hq(t,n,o,s),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=o,n=s),i=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function Hq(e,t,n,i){var r,o,s=te(e-n);return me(s)>ie?Ku((te(t)*(o=re(i))*te(n)-te(i)*(r=re(t))*te(e))/(r*o*s)):(t+i)/2}function Gq(e,t,n,i){var r;if(e==null)r=n*He,i.point(-de,r),i.point(0,r),i.point(de,r),i.point(de,0),i.point(de,-r),i.point(0,-r),i.point(-de,-r),i.point(-de,0),i.point(-de,r);else if(me(e[0]-t[0])>ie){var o=e[0]<t[0]?de:-de;r=n*o/2,i.point(-o,r),i.point(0,r),i.point(o,r)}else i.point(t[0],t[1])}function Yq(e){var t=re(e),n=6*ce,i=t>0,r=me(t)>ie;function o(c,f,d,h){Bq(h,e,n,d,c,f)}function s(c,f){return re(c)*re(f)>t}function a(c){var f,d,h,g,p;return{lineStart:function(){g=h=!1,p=1},point:function(m,y){var b=[m,y],x,v=s(m,y),w=i?v?0:l(m,y):v?l(m+(m<0?de:-de),y):0;if(!f&&(g=h=v)&&c.lineStart(),v!==h&&(x=u(f,b),(!x||Rd(f,x)||Rd(b,x))&&(b[2]=1)),v!==h)p=0,v?(c.lineStart(),x=u(b,f),c.point(x[0],x[1])):(x=u(f,b),c.point(x[0],x[1],2),c.lineEnd()),f=x;else if(r&&f&&i^v){var S;!(w&d)&&(S=u(b,f,!0))&&(p=0,i?(c.lineStart(),c.point(S[0][0],S[0][1]),c.point(S[1][0],S[1][1]),c.lineEnd()):(c.point(S[1][0],S[1][1]),c.lineEnd(),c.lineStart(),c.point(S[0][0],S[0][1],3)))}v&&(!f||!Rd(f,b))&&c.point(b[0],b[1]),f=b,h=v,d=w},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return p|(g&&h)<<1}}}function u(c,f,d){var h=Hs(c),g=Hs(f),p=[1,0,0],m=vu(h,g),y=nd(m,m),b=m[0],x=y-b*b;if(!x)return!d&&c;var v=t*y/x,w=-t*b/x,S=vu(p,m),_=id(p,v),E=id(m,w);a0(_,E);var A=S,k=nd(_,A),$=nd(A,A),T=k*k-$*(nd(_,_)-1);if(!(T<0)){var M=on(T),D=id(A,(-k-M)/$);if(a0(D,_),D=Oh(D),!d)return D;var C=c[0],R=f[0],W=c[1],V=f[1],J;R<C&&(J=C,C=R,R=J);var he=R-C,Be=me(he-de)<ie,Ze=Be||he<ie;if(!Be&&V<W&&(J=W,W=V,V=J),Ze?Be?W+V>0^D[1]<(me(D[0]-C)<ie?W:V):W<=D[1]&&D[1]<=V:he>de^(C<=D[0]&&D[0]<=R)){var at=id(A,(-k+M)/$);return a0(at,_),[D,Oh(at)]}}}function l(c,f){var d=i?e:de-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return j5(s,a,o,i?[0,-e]:[-de,e-de])}function Vq(e,t,n,i,r,o){var s=e[0],a=e[1],u=t[0],l=t[1],c=0,f=1,d=u-s,h=l-a,g;if(g=n-s,!(!d&&g>0)){if(g/=d,d<0){if(g<c)return;g<f&&(f=g)}else if(d>0){if(g>f)return;g>c&&(c=g)}if(g=r-s,!(!d&&g<0)){if(g/=d,d<0){if(g>f)return;g>c&&(c=g)}else if(d>0){if(g<c)return;g<f&&(f=g)}if(g=i-a,!(!h&&g>0)){if(g/=h,h<0){if(g<c)return;g<f&&(f=g)}else if(h>0){if(g>f)return;g>c&&(c=g)}if(g=o-a,!(!h&&g<0)){if(g/=h,h<0){if(g>f)return;g>c&&(c=g)}else if(h>0){if(g<c)return;g<f&&(f=g)}return c>0&&(e[0]=s+c*d,e[1]=a+c*h),f<1&&(t[0]=s+f*d,t[1]=a+f*h),!0}}}}}var Ul=1e9,od=-Ul;function q5(e,t,n,i){function r(l,c){return e<=l&&l<=n&&t<=c&&c<=i}function o(l,c,f,d){var h=0,g=0;if(l==null||(h=s(l,f))!==(g=s(c,f))||u(l,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?i:t);while((h=(h+f+4)%4)!==g);else d.point(c[0],c[1])}function s(l,c){return me(l[0]-e)<ie?c>0?0:3:me(l[0]-n)<ie?c>0?2:1:me(l[1]-t)<ie?c>0?1:0:c>0?3:2}function a(l,c){return u(l.x,c.x)}function u(l,c){var f=s(l,1),d=s(c,1);return f!==d?f-d:f===0?c[1]-l[1]:f===1?l[0]-c[0]:f===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,f=B5(),d,h,g,p,m,y,b,x,v,w,S,_={point:E,lineStart:T,lineEnd:M,polygonStart:k,polygonEnd:$};function E(C,R){r(C,R)&&c.point(C,R)}function A(){for(var C=0,R=0,W=h.length;R<W;++R)for(var V=h[R],J=1,he=V.length,Be=V[0],Ze,at,qt=Be[0],Je=Be[1];J<he;++J)Ze=qt,at=Je,Be=V[J],qt=Be[0],Je=Be[1],at<=i?Je>i&&(qt-Ze)*(i-at)>(Je-at)*(e-Ze)&&++C:Je<=i&&(qt-Ze)*(i-at)<(Je-at)*(e-Ze)&&--C;return C}function k(){c=f,d=[],h=[],S=!0}function $(){var C=A(),R=S&&C,W=(d=RC(d)).length;(R||W)&&(l.polygonStart(),R&&(l.lineStart(),o(null,null,1,l),l.lineEnd()),W&&U5(d,a,C,o,l),l.polygonEnd()),c=l,d=h=g=null}function T(){_.point=D,h&&h.push(g=[]),w=!0,v=!1,b=x=NaN}function M(){d&&(D(p,m),y&&v&&f.rejoin(),d.push(f.result())),_.point=E,v&&c.lineEnd()}function D(C,R){var W=r(C,R);if(h&&g.push([C,R]),w)p=C,m=R,y=W,w=!1,W&&(c.lineStart(),c.point(C,R));else if(W&&v)c.point(C,R);else{var V=[b=Math.max(od,Math.min(Ul,b)),x=Math.max(od,Math.min(Ul,x))],J=[C=Math.max(od,Math.min(Ul,C)),R=Math.max(od,Math.min(Ul,R))];Vq(V,J,e,t,n,i)?(v||(c.lineStart(),c.point(V[0],V[1])),c.point(J[0],J[1]),W||c.lineEnd(),S=!1):W&&(c.lineStart(),c.point(C,R),S=!1)}b=C,x=R,v=W}return _}}function GE(e,t,n){var i=Fn(e,t-ie,n).concat(t);return function(r){return i.map(function(o){return[r,o]})}}function YE(e,t,n){var i=Fn(e,t-ie,n).concat(t);return function(r){return i.map(function(o){return[o,r]})}}function Xq(){var e,t,n,i,r,o,s,a,u=10,l=u,c=90,f=360,d,h,g,p,m=2.5;function y(){return{type:"MultiLineString",coordinates:b()}}function b(){return Fn(td(i/c)*c,n,c).map(g).concat(Fn(td(a/f)*f,s,f).map(p)).concat(Fn(td(t/u)*u,e,u).filter(function(x){return me(x%c)>ie}).map(d)).concat(Fn(td(o/l)*l,r,l).filter(function(x){return me(x%f)>ie}).map(h))}return y.lines=function(){return b().map(function(x){return{type:"LineString",coordinates:x}})},y.outline=function(){return{type:"Polygon",coordinates:[g(i).concat(p(s).slice(1),g(n).reverse().slice(1),p(a).reverse().slice(1))]}},y.extent=function(x){return arguments.length?y.extentMajor(x).extentMinor(x):y.extentMinor()},y.extentMajor=function(x){return arguments.length?(i=+x[0][0],n=+x[1][0],a=+x[0][1],s=+x[1][1],i>n&&(x=i,i=n,n=x),a>s&&(x=a,a=s,s=x),y.precision(m)):[[i,a],[n,s]]},y.extentMinor=function(x){return arguments.length?(t=+x[0][0],e=+x[1][0],o=+x[0][1],r=+x[1][1],t>e&&(x=t,t=e,e=x),o>r&&(x=o,o=r,r=x),y.precision(m)):[[t,o],[e,r]]},y.step=function(x){return arguments.length?y.stepMajor(x).stepMinor(x):y.stepMinor()},y.stepMajor=function(x){return arguments.length?(c=+x[0],f=+x[1],y):[c,f]},y.stepMinor=function(x){return arguments.length?(u=+x[0],l=+x[1],y):[u,l]},y.precision=function(x){return arguments.length?(m=+x,d=GE(o,r,90),h=YE(t,e,m),g=GE(a,s,90),p=YE(i,n,m),y):m},y.extentMajor([[-180,-90+ie],[180,90-ie]]).extentMinor([[-180,-80-ie],[180,80+ie]])}const Fc=e=>e;var l0=new en,ny=new en,W5,H5,iy,ry,Ar={point:wt,lineStart:wt,lineEnd:wt,polygonStart:function(){Ar.lineStart=Kq,Ar.lineEnd=Qq},polygonEnd:function(){Ar.lineStart=Ar.lineEnd=Ar.point=wt,l0.add(me(ny)),ny=new en},result:function(){var e=l0/2;return l0=new en,e}};function Kq(){Ar.point=Jq}function Jq(e,t){Ar.point=G5,W5=iy=e,H5=ry=t}function G5(e,t){ny.add(ry*e-iy*t),iy=e,ry=t}function Qq(){G5(W5,H5)}var wu=1/0,qh=wu,Dc=-wu,Wh=Dc,Hh={point:Zq,lineStart:wt,lineEnd:wt,polygonStart:wt,polygonEnd:wt,result:function(){var e=[[wu,qh],[Dc,Wh]];return Dc=Wh=-(qh=wu=1/0),e}};function Zq(e,t){e<wu&&(wu=e),e>Dc&&(Dc=e),t<qh&&(qh=t),t>Wh&&(Wh=t)}var oy=0,sy=0,jl=0,Gh=0,Yh=0,Ha=0,ay=0,uy=0,ql=0,Y5,V5,qi,Wi,qn={point:Gs,lineStart:VE,lineEnd:XE,polygonStart:function(){qn.lineStart=nW,qn.lineEnd=iW},polygonEnd:function(){qn.point=Gs,qn.lineStart=VE,qn.lineEnd=XE},result:function(){var e=ql?[ay/ql,uy/ql]:Ha?[Gh/Ha,Yh/Ha]:jl?[oy/jl,sy/jl]:[NaN,NaN];return oy=sy=jl=Gh=Yh=Ha=ay=uy=ql=0,e}};function Gs(e,t){oy+=e,sy+=t,++jl}function VE(){qn.point=eW}function eW(e,t){qn.point=tW,Gs(qi=e,Wi=t)}function tW(e,t){var n=e-qi,i=t-Wi,r=on(n*n+i*i);Gh+=r*(qi+e)/2,Yh+=r*(Wi+t)/2,Ha+=r,Gs(qi=e,Wi=t)}function XE(){qn.point=Gs}function nW(){qn.point=rW}function iW(){X5(Y5,V5)}function rW(e,t){qn.point=X5,Gs(Y5=qi=e,V5=Wi=t)}function X5(e,t){var n=e-qi,i=t-Wi,r=on(n*n+i*i);Gh+=r*(qi+e)/2,Yh+=r*(Wi+t)/2,Ha+=r,r=Wi*e-qi*t,ay+=r*(qi+e),uy+=r*(Wi+t),ql+=r*3,Gs(qi=e,Wi=t)}function K5(e){this._context=e}K5.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,rn);break}}},result:wt};var ly=new en,c0,J5,Q5,Wl,Hl,Tc={point:wt,lineStart:function(){Tc.point=oW},lineEnd:function(){c0&&Z5(J5,Q5),Tc.point=wt},polygonStart:function(){c0=!0},polygonEnd:function(){c0=null},result:function(){var e=+ly;return ly=new en,e}};function oW(e,t){Tc.point=Z5,J5=Wl=e,Q5=Hl=t}function Z5(e,t){Wl-=e,Hl-=t,ly.add(on(Wl*Wl+Hl*Hl)),Wl=e,Hl=t}let KE,Vh,JE,QE;class ZE{constructor(t){this._append=t==null?eT:sW(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==JE||this._append!==Vh){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,JE=i,Vh=this._append,QE=this._,this._=r}this._+=QE;break}}}result(){const t=this._;return this._="",t.length?t:null}}function eT(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function sW(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return eT;if(t!==KE){const n=10**t;KE=t,Vh=function(r){let o=1;this._+=r[0];for(const s=r.length;o<s;++o)this._+=Math.round(arguments[o]*n)/n+r[o]}}return Vh}function tT(e,t){let n=3,i=4.5,r,o;function s(a){return a&&(typeof i=="function"&&o.pointRadius(+i.apply(this,arguments)),$r(a,r(o))),o.result()}return s.area=function(a){return $r(a,r(Ar)),Ar.result()},s.measure=function(a){return $r(a,r(Tc)),Tc.result()},s.bounds=function(a){return $r(a,r(Hh)),Hh.result()},s.centroid=function(a){return $r(a,r(qn)),qn.result()},s.projection=function(a){return arguments.length?(r=a==null?(e=null,Fc):(e=a).stream,s):e},s.context=function(a){return arguments.length?(o=a==null?(t=null,new ZE(n)):new K5(t=a),typeof i!="function"&&o.pointRadius(i),s):t},s.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(o.pointRadius(+a),+a),s):i},s.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const u=Math.floor(a);if(!(u>=0))throw new RangeError(`invalid digits: ${a}`);n=u}return t===null&&(o=new ZE(n)),s},s.projection(e).digits(n).context(t)}function _p(e){return function(t){var n=new cy;for(var i in e)n[i]=e[i];return n.stream=t,n}}function cy(){}cy.prototype={constructor:cy,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Yv(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),$r(n,e.stream(Hh)),t(Hh.result()),i!=null&&e.clipExtent(i),e}function Sp(e,t,n){return Yv(e,function(i){var r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],s=Math.min(r/(i[1][0]-i[0][0]),o/(i[1][1]-i[0][1])),a=+t[0][0]+(r-s*(i[1][0]+i[0][0]))/2,u=+t[0][1]+(o-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([a,u])},n)}function Vv(e,t,n){return Sp(e,[[0,0],t],n)}function Xv(e,t,n){return Yv(e,function(i){var r=+t,o=r/(i[1][0]-i[0][0]),s=(r-o*(i[1][0]+i[0][0]))/2,a=-o*i[0][1];e.scale(150*o).translate([s,a])},n)}function Kv(e,t,n){return Yv(e,function(i){var r=+t,o=r/(i[1][1]-i[0][1]),s=-o*i[0][0],a=(r-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([s,a])},n)}var ek=16,aW=re(30*ce);function tk(e,t){return+t?lW(e,t):uW(e)}function uW(e){return _p({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function lW(e,t){function n(i,r,o,s,a,u,l,c,f,d,h,g,p,m){var y=l-i,b=c-r,x=y*y+b*b;if(x>4*t&&p--){var v=s+d,w=a+h,S=u+g,_=on(v*v+w*w+S*S),E=xn(S/=_),A=me(me(S)-1)<ie||me(o-f)<ie?(o+f)/2:ei(w,v),k=e(A,E),$=k[0],T=k[1],M=$-i,D=T-r,C=b*M-y*D;(C*C/x>t||me((y*M+b*D)/x-.5)>.3||s*d+a*h+u*g<aW)&&(n(i,r,o,s,a,u,$,T,A,v/=_,w/=_,S,p,m),m.point($,T),n($,T,A,v,w,S,l,c,f,d,h,g,p,m))}}return function(i){var r,o,s,a,u,l,c,f,d,h,g,p,m={point:y,lineStart:b,lineEnd:v,polygonStart:function(){i.polygonStart(),m.lineStart=w},polygonEnd:function(){i.polygonEnd(),m.lineStart=b}};function y(E,A){E=e(E,A),i.point(E[0],E[1])}function b(){f=NaN,m.point=x,i.lineStart()}function x(E,A){var k=Hs([E,A]),$=e(E,A);n(f,d,c,h,g,p,f=$[0],d=$[1],c=E,h=k[0],g=k[1],p=k[2],ek,i),i.point(f,d)}function v(){m.point=y,i.lineEnd()}function w(){b(),m.point=S,m.lineEnd=_}function S(E,A){x(r=E,A),o=f,s=d,a=h,u=g,l=p,m.point=x}function _(){n(f,d,c,h,g,p,o,s,r,a,u,l,ek,i),m.lineEnd=v,v()}return m}}var cW=_p({point:function(e,t){this.stream.point(e*ce,t*ce)}});function fW(e){return _p({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function dW(e,t,n,i,r){function o(s,a){return s*=i,a*=r,[t+e*s,n-e*a]}return o.invert=function(s,a){return[(s-t)/e*i,(n-a)/e*r]},o}function nk(e,t,n,i,r,o){if(!o)return dW(e,t,n,i,r);var s=re(o),a=te(o),u=s*e,l=a*e,c=s/e,f=a/e,d=(a*n-s*t)/e,h=(a*t+s*n)/e;function g(p,m){return p*=i,m*=r,[u*p-l*m+t,n-l*p-u*m]}return g.invert=function(p,m){return[i*(c*p-f*m+d),r*(h-f*p-c*m)]},g}function cr(e){return nT(function(){return e})()}function nT(e){var t,n=150,i=480,r=250,o=0,s=0,a=0,u=0,l=0,c,f=0,d=1,h=1,g=null,p=HE,m=null,y,b,x,v=Fc,w=.5,S,_,E,A,k;function $(C){return E(C[0]*ce,C[1]*ce)}function T(C){return C=E.invert(C[0],C[1]),C&&[C[0]*Ye,C[1]*Ye]}$.stream=function(C){return A&&k===C?A:A=cW(fW(c)(p(S(v(k=C)))))},$.preclip=function(C){return arguments.length?(p=C,g=void 0,D()):p},$.postclip=function(C){return arguments.length?(v=C,m=y=b=x=null,D()):v},$.clipAngle=function(C){return arguments.length?(p=+C?Yq(g=C*ce):(g=null,HE),D()):g*Ye},$.clipExtent=function(C){return arguments.length?(v=C==null?(m=y=b=x=null,Fc):q5(m=+C[0][0],y=+C[0][1],b=+C[1][0],x=+C[1][1]),D()):m==null?null:[[m,y],[b,x]]},$.scale=function(C){return arguments.length?(n=+C,M()):n},$.translate=function(C){return arguments.length?(i=+C[0],r=+C[1],M()):[i,r]},$.center=function(C){return arguments.length?(o=C[0]%360*ce,s=C[1]%360*ce,M()):[o*Ye,s*Ye]},$.rotate=function(C){return arguments.length?(a=C[0]%360*ce,u=C[1]%360*ce,l=C.length>2?C[2]%360*ce:0,M()):[a*Ye,u*Ye,l*Ye]},$.angle=function(C){return arguments.length?(f=C%360*ce,M()):f*Ye},$.reflectX=function(C){return arguments.length?(d=C?-1:1,M()):d<0},$.reflectY=function(C){return arguments.length?(h=C?-1:1,M()):h<0},$.precision=function(C){return arguments.length?(S=tk(_,w=C*C),D()):on(w)},$.fitExtent=function(C,R){return Sp($,C,R)},$.fitSize=function(C,R){return Vv($,C,R)},$.fitWidth=function(C,R){return Xv($,C,R)},$.fitHeight=function(C,R){return Kv($,C,R)};function M(){var C=nk(n,0,0,d,h,f).apply(null,t(o,s)),R=nk(n,i-C[0],r-C[1],d,h,f);return c=I5(a,u,l),_=ey(t,R),E=ey(c,_),S=tk(_,w),D()}function D(){return A=k=null,$}return function(){return t=e.apply(this,arguments),$.invert=t.invert&&T,M()}}function Jv(e){var t=0,n=de/3,i=nT(e),r=i(t,n);return r.parallels=function(o){return arguments.length?i(t=o[0]*ce,n=o[1]*ce):[t*Ye,n*Ye]},r}function hW(e){var t=re(e);function n(i,r){return[i*t,te(r)/t]}return n.invert=function(i,r){return[i/t,xn(r*t)]},n}function gW(e,t){var n=te(e),i=(n+te(t))/2;if(me(i)<ie)return hW(e);var r=1+n*(2*i-n),o=on(r)/i;function s(a,u){var l=on(r-2*i*te(u))/i;return[l*te(a*=i),o-l*re(a)]}return s.invert=function(a,u){var l=o-u,c=ei(a,me(l))*Hn(l);return l*i<0&&(c-=de*Hn(a)*Hn(l)),[c/i,xn((r-(a*a+l*l)*i*i)/(2*i))]},s}function Xh(){return Jv(gW).scale(155.424).center([0,33.6442])}function iT(){return Xh().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function pW(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function mW(){var e,t,n=iT(),i,r=Xh().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,s=Xh().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,l={point:function(d,h){u=[d,h]}};function c(d){var h=d[0],g=d[1];return u=null,i.point(h,g),u||(o.point(h,g),u)||(a.point(h,g),u)}c.invert=function(d){var h=n.scale(),g=n.translate(),p=(d[0]-g[0])/h,m=(d[1]-g[1])/h;return(m>=.12&&m<.234&&p>=-.425&&p<-.214?r:m>=.166&&m<.234&&p>=-.214&&p<-.115?s:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=pW([n.stream(t=d),r.stream(d),s.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),s.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),s.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),g=+d[0],p=+d[1];return i=n.translate(d).clipExtent([[g-.455*h,p-.238*h],[g+.455*h,p+.238*h]]).stream(l),o=r.translate([g-.307*h,p+.201*h]).clipExtent([[g-.425*h+ie,p+.12*h+ie],[g-.214*h-ie,p+.234*h-ie]]).stream(l),a=s.translate([g-.205*h,p+.212*h]).clipExtent([[g-.214*h+ie,p+.166*h+ie],[g-.115*h-ie,p+.234*h-ie]]).stream(l),f()},c.fitExtent=function(d,h){return Sp(c,d,h)},c.fitSize=function(d,h){return Vv(c,d,h)},c.fitWidth=function(d,h){return Xv(c,d,h)},c.fitHeight=function(d,h){return Kv(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function rT(e){return function(t,n){var i=re(t),r=re(n),o=e(i*r);return o===1/0?[2,0]:[o*r*te(t),o*te(n)]}}function yf(e){return function(t,n){var i=on(t*t+n*n),r=e(i),o=te(r),s=re(r);return[ei(t*o,i*s),xn(i&&n*o/i)]}}var oT=rT(function(e){return on(2/(1+e))});oT.invert=yf(function(e){return 2*xn(e/2)});function yW(){return cr(oT).scale(124.75).clipAngle(180-.001)}var sT=rT(function(e){return(e=C5(e))&&e/te(e)});sT.invert=yf(function(e){return e});function bW(){return cr(sT).scale(79.4188).clipAngle(180-.001)}function Ep(e,t){return[e,Fh(Hv((He+t)/2))]}Ep.invert=function(e,t){return[e,2*Ku(A5(t))-He]};function xW(){return aT(Ep).scale(961/rn)}function aT(e){var t=cr(e),n=t.center,i=t.scale,r=t.translate,o=t.clipExtent,s=null,a,u,l;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?s=a=u=l=null:(s=+f[0][0],a=+f[0][1],u=+f[1][0],l=+f[1][1]),c()):s==null?null:[[s,a],[u,l]]};function c(){var f=de*i(),d=t(Iq(t.rotate()).invert([0,0]));return o(s==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===Ep?[[Math.max(d[0]-f,s),a],[Math.min(d[0]+f,u),l]]:[[s,Math.max(d[1]-f,a)],[u,Math.min(d[1]+f,l)]])}return c()}function sd(e){return Hv((He+e)/2)}function vW(e,t){var n=re(e),i=e===t?te(e):Fh(n/re(t))/Fh(sd(t)/sd(e)),r=n*s0(sd(e),i)/i;if(!i)return Ep;function o(s,a){r>0?a<-He+ie&&(a=-He+ie):a>He-ie&&(a=He-ie);var u=r/s0(sd(a),i);return[u*te(i*s),r-u*re(i*s)]}return o.invert=function(s,a){var u=r-a,l=Hn(i)*on(s*s+u*u),c=ei(s,me(u))*Hn(u);return u*i<0&&(c-=de*Hn(s)*Hn(u)),[c/i,2*Ku(s0(r/l,1/i))-He]},o}function wW(){return Jv(vW).scale(109.5).parallels([30,30])}function Kh(e,t){return[e,t]}Kh.invert=Kh;function _W(){return cr(Kh).scale(152.63)}function SW(e,t){var n=re(e),i=e===t?te(e):(n-re(t))/(t-e),r=n/i+e;if(me(i)<ie)return Kh;function o(s,a){var u=r-a,l=i*s;return[u*te(l),r-u*re(l)]}return o.invert=function(s,a){var u=r-a,l=ei(s,me(u))*Hn(u);return u*i<0&&(l-=de*Hn(s)*Hn(u)),[l/i,r-Hn(i)*on(s*s+u*u)]},o}function EW(){return Jv(SW).scale(131.154).center([0,13.9389])}var rc=1.340264,oc=-.081106,sc=893e-6,ac=.003796,Jh=on(3)/2,kW=12;function uT(e,t){var n=xn(Jh*te(t)),i=n*n,r=i*i*i;return[e*re(n)/(Jh*(rc+3*oc*i+r*(7*sc+9*ac*i))),n*(rc+oc*i+r*(sc+ac*i))]}uT.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,o=0,s,a,u;o<kW&&(a=n*(rc+oc*i+r*(sc+ac*i))-t,u=rc+3*oc*i+r*(7*sc+9*ac*i),n-=s=a/u,i=n*n,r=i*i*i,!(me(s)<Ch));++o);return[Jh*e*(rc+3*oc*i+r*(7*sc+9*ac*i))/re(n),xn(te(n)/Jh)]};function $W(){return cr(uT).scale(177.158)}function lT(e,t){var n=re(t),i=re(e)*n;return[n*te(e)/i,te(t)/i]}lT.invert=yf(Ku);function AW(){return cr(lT).scale(144.049).clipAngle(60)}function CW(){var e=1,t=0,n=0,i=1,r=1,o=0,s,a,u=null,l,c,f,d=1,h=1,g=_p({point:function(v,w){var S=x([v,w]);this.stream.point(S[0],S[1])}}),p=Fc,m,y;function b(){return d=e*i,h=e*r,m=y=null,x}function x(v){var w=v[0]*d,S=v[1]*h;if(o){var _=S*s-w*a;w=w*s+S*a,S=_}return[w+t,S+n]}return x.invert=function(v){var w=v[0]-t,S=v[1]-n;if(o){var _=S*s+w*a;w=w*s-S*a,S=_}return[w/d,S/h]},x.stream=function(v){return m&&y===v?m:m=g(p(y=v))},x.postclip=function(v){return arguments.length?(p=v,u=l=c=f=null,b()):p},x.clipExtent=function(v){return arguments.length?(p=v==null?(u=l=c=f=null,Fc):q5(u=+v[0][0],l=+v[0][1],c=+v[1][0],f=+v[1][1]),b()):u==null?null:[[u,l],[c,f]]},x.scale=function(v){return arguments.length?(e=+v,b()):e},x.translate=function(v){return arguments.length?(t=+v[0],n=+v[1],b()):[t,n]},x.angle=function(v){return arguments.length?(o=v%360*ce,a=te(o),s=re(o),b()):o*Ye},x.reflectX=function(v){return arguments.length?(i=v?-1:1,b()):i<0},x.reflectY=function(v){return arguments.length?(r=v?-1:1,b()):r<0},x.fitExtent=function(v,w){return Sp(x,v,w)},x.fitSize=function(v,w){return Vv(x,v,w)},x.fitWidth=function(v,w){return Xv(x,v,w)},x.fitHeight=function(v,w){return Kv(x,v,w)},x}function cT(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}cT.invert=function(e,t){var n=t,i=25,r;do{var o=n*n,s=o*o;n-=r=(n*(1.007226+o*(.015085+s*(-.044475+.028874*o-.005916*s)))-t)/(1.007226+o*(.015085*3+s*(-.044475*7+.028874*9*o-.005916*11*s)))}while(me(r)>ie&&--i>0);return[e/(.8707+(o=n*n)*(-.131979+o*(-.013791+o*o*o*(.003971-.001529*o)))),n]};function MW(){return cr(cT).scale(175.295)}function fT(e,t){return[re(t)*te(e),te(t)]}fT.invert=yf(xn);function FW(){return cr(fT).scale(249.5).clipAngle(90+ie)}function dT(e,t){var n=re(t),i=1+re(e)*n;return[n*te(e)/i,te(t)/i]}dT.invert=yf(function(e){return 2*Ku(e)});function DW(){return cr(dT).scale(250).clipAngle(142)}function hT(e,t){return[Fh(Hv((He+t)/2)),-e]}hT.invert=function(e,t){return[-t,2*Ku(A5(e))-He]};function TW(){var e=aT(hT),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var NW=Math.abs,fy=Math.cos,Qh=Math.sin,OW=1e-6,gT=Math.PI,dy=gT/2,ik=RW(2);function rk(e){return e>1?dy:e<-1?-dy:Math.asin(e)}function RW(e){return e>0?Math.sqrt(e):0}function zW(e,t){var n=e*Qh(t),i=30,r;do t-=r=(t+Qh(t)-n)/(1+fy(t));while(NW(r)>OW&&--i>0);return t/2}function PW(e,t,n){function i(r,o){return[e*r*fy(o=zW(n,o)),t*Qh(o)]}return i.invert=function(r,o){return o=rk(o/t),[r/(e*fy(o)),rk((2*o+Qh(2*o))/n)]},i}var LW=PW(ik/dy,ik,gT);function IW(){return cr(LW).scale(169.529)}const BW=tT(),hy=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function UW(e,t){return function n(){const i=t();return i.type=e,i.path=tT().projection(i),i.copy=i.copy||function(){const r=n();return hy.forEach(o=>{i[o]&&r[o](i[o]())}),r.path.pointRadius(i.path.pointRadius()),r},N3(i)}}function Qv(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Zh[e]=UW(e,t),this):Zh[e]||null}function pT(e){return e&&e.path||BW}const Zh={albers:iT,albersusa:mW,azimuthalequalarea:yW,azimuthalequidistant:bW,conicconformal:wW,conicequalarea:Xh,conicequidistant:EW,equalEarth:$W,equirectangular:_W,gnomonic:AW,identity:CW,mercator:xW,mollweide:IW,naturalEarth1:MW,orthographic:FW,stereographic:DW,transversemercator:TW};for(const e in Zh)Qv(e,Zh[e]);function jW(){}const vr=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function mT(){var e=1,t=1,n=a;function i(u,l){return l.map(c=>r(u,c))}function r(u,l){var c=[],f=[];return o(u,l,d=>{n(d,u,l),qW(d)>0?c.push([d]):f.push(d)}),f.forEach(d=>{for(var h=0,g=c.length,p;h<g;++h)if(WW((p=c[h])[0],d)!==-1){p.push(d);return}}),{type:"MultiPolygon",value:l,coordinates:c}}function o(u,l,c){var f=new Array,d=new Array,h,g,p,m,y,b;for(h=g=-1,m=u[0]>=l,vr[m<<1].forEach(x);++h<e-1;)p=m,m=u[h+1]>=l,vr[p|m<<1].forEach(x);for(vr[m<<0].forEach(x);++g<t-1;){for(h=-1,m=u[g*e+e]>=l,y=u[g*e]>=l,vr[m<<1|y<<2].forEach(x);++h<e-1;)p=m,m=u[g*e+e+h+1]>=l,b=y,y=u[g*e+h+1]>=l,vr[p|m<<1|y<<2|b<<3].forEach(x);vr[m|y<<3].forEach(x)}for(h=-1,y=u[g*e]>=l,vr[y<<2].forEach(x);++h<e-1;)b=y,y=u[g*e+h+1]>=l,vr[y<<2|b<<3].forEach(x);vr[y<<3].forEach(x);function x(v){var w=[v[0][0]+h,v[0][1]+g],S=[v[1][0]+h,v[1][1]+g],_=s(w),E=s(S),A,k;(A=d[_])?(k=f[E])?(delete d[A.end],delete f[k.start],A===k?(A.ring.push(S),c(A.ring)):f[A.start]=d[k.end]={start:A.start,end:k.end,ring:A.ring.concat(k.ring)}):(delete d[A.end],A.ring.push(S),d[A.end=E]=A):(A=f[E])?(k=d[_])?(delete f[A.start],delete d[k.end],A===k?(A.ring.push(S),c(A.ring)):f[k.start]=d[A.end]={start:k.start,end:A.end,ring:k.ring.concat(A.ring)}):(delete f[A.start],A.ring.unshift(w),f[A.start=_]=A):f[_]=d[E]={start:_,end:E,ring:[w,S]}}}function s(u){return u[0]*2+u[1]*(e+1)*4}function a(u,l,c){u.forEach(f=>{var d=f[0],h=f[1],g=d|0,p=h|0,m,y=l[p*e+g];d>0&&d<e&&g===d&&(m=l[p*e+g-1],f[0]=d+(c-m)/(y-m)-.5),h>0&&h<t&&p===h&&(m=l[(p-1)*e+g],f[1]=h+(c-m)/(y-m)-.5)})}return i.contour=r,i.size=function(u){if(!arguments.length)return[e,t];var l=Math.floor(u[0]),c=Math.floor(u[1]);return l>=0&&c>=0||O("invalid size"),e=l,t=c,i},i.smooth=function(u){return arguments.length?(n=u?a:jW,i):n===a},i}function qW(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function WW(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=HW(e,t[n]))return r;return 0}function HW(e,t){for(var n=t[0],i=t[1],r=-1,o=0,s=e.length,a=s-1;o<s;a=o++){var u=e[o],l=u[0],c=u[1],f=e[a],d=f[0],h=f[1];if(GW(u,f,t))return 0;c>i!=h>i&&n<(d-l)*(i-c)/(h-c)+l&&(r=-r)}return r}function GW(e,t,n){var i;return YW(e,t,n)&&VW(e[i=+(e[0]===t[0])],n[i],t[i])}function YW(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function VW(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function yT(e,t,n){return function(i){var r=Qi(i),o=n?Math.min(r[0],0):r[0],s=r[1],a=s-o,u=t?Mo(o,s,e):a/(e+1);return Fn(o+u,s,u)}}function Zv(e){F.call(this,null,e)}Zv.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};U(Zv,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||Ut,o=mT().smooth(e.smooth!==!1),s=e.thresholds||XW(i,r,e),a=e.as===null?null:e.as||"contour",u=[];return i.forEach(l=>{const c=r(l),f=o.size([c.width,c.height])(c.values,z(s)?s:s(c.values));KW(f,c,l,e),f.forEach(d=>{u.push(Bg(l,Ee(a!=null?{[a]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function XW(e,t,n){const i=yT(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>Ts(t(r).values)))}function KW(e,t,n,i){let r=i.scale||t.scale,o=i.translate||t.translate;if(ue(r)&&(r=r(n,i)),ue(o)&&(o=o(n,i)),(r===1||r==null)&&!o)return;const s=(xe(r)?r:r[0])||1,a=(xe(r)?r:r[1])||1,u=o&&o[0]||0,l=o&&o[1]||0;e.forEach(bT(t,s,a,u,l))}function bT(e,t,n,i,r){const o=e.x1||0,s=e.y1||0,a=t*n<0;function u(f){f.forEach(l)}function l(f){a&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-o)*t+i,f[1]=(f[1]-s)*n+r}return function(f){return f.coordinates.forEach(u),f}}function ok(e,t,n){const i=e>=0?e:Bb(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function f0(e){return ue(e)?e:jt(+e)}function xT(){var e=u=>u[0],t=u=>u[1],n=Iu,i=[-1,-1],r=960,o=500,s=2;function a(u,l){const c=ok(i[0],u,e)>>s,f=ok(i[1],u,t)>>s,d=c?c+2:0,h=f?f+2:0,g=2*d+(r>>s),p=2*h+(o>>s),m=new Float32Array(g*p),y=new Float32Array(g*p);let b=m;u.forEach(v=>{const w=d+(+e(v)>>s),S=h+(+t(v)>>s);w>=0&&w<g&&S>=0&&S<p&&(m[w+S*g]+=+n(v))}),c>0&&f>0?(Da(g,p,m,y,c),Ta(g,p,y,m,f),Da(g,p,m,y,c),Ta(g,p,y,m,f),Da(g,p,m,y,c),Ta(g,p,y,m,f)):c>0?(Da(g,p,m,y,c),Da(g,p,y,m,c),Da(g,p,m,y,c),b=y):f>0&&(Ta(g,p,m,y,f),Ta(g,p,y,m,f),Ta(g,p,m,y,f),b=y);const x=l?Math.pow(2,-2*s):1/zC(b);for(let v=0,w=g*p;v<w;++v)b[v]*=x;return{values:b,scale:1<<s,width:g,height:p,x1:d,y1:h,x2:d+(r>>s),y2:h+(o>>s)}}return a.x=function(u){return arguments.length?(e=f0(u),a):e},a.y=function(u){return arguments.length?(t=f0(u),a):t},a.weight=function(u){return arguments.length?(n=f0(u),a):n},a.size=function(u){if(!arguments.length)return[r,o];var l=+u[0],c=+u[1];return l>=0&&c>=0||O("invalid size"),r=l,o=c,a},a.cellSize=function(u){return arguments.length?((u=+u)>=1||O("invalid cell size"),s=Math.floor(Math.log(u)/Math.LN2),a):1<<s},a.bandwidth=function(u){return arguments.length?(u=H(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&O("invalid bandwidth"),i=u,a):i},a}function Da(e,t,n,i,r){const o=(r<<1)+1;for(let s=0;s<t;++s)for(let a=0,u=0;a<e+r;++a)a<e&&(u+=n[a+s*e]),a>=r&&(a>=o&&(u-=n[a-o+s*e]),i[a-r+s*e]=u/Math.min(a+1,e-1+o-a,o))}function Ta(e,t,n,i,r){const o=(r<<1)+1;for(let s=0;s<e;++s)for(let a=0,u=0;a<t+r;++a)a<t&&(u+=n[s+a*e]),a>=r&&(a>=o&&(u-=n[s+(a-o)*e]),i[s+(a-r)*e]=u/Math.min(a+1,t-1+o-a,o))}function e2(e){F.call(this,null,e)}e2.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const JW=["x","y","weight","size","cellSize","bandwidth"];function vT(e,t){return JW.forEach(n=>t[n]!=null?e[n](t[n]):0),e}U(e2,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=QW(i,e.groupby),o=(e.groupby||[]).map(Ge),s=vT(xT(),e),a=e.as||"grid",u=[];function l(c,f){for(let d=0;d<o.length;++d)c[o[d]]=f[d];return c}return u=r.map(c=>Ee(l({[a]:s(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function QW(e,t){var n=[],i=c=>c(a),r,o,s,a,u,l;if(t==null)n.push(e);else for(r={},o=0,s=e.length;o<s;++o)a=e[o],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function t2(e){F.call(this,null,e)}t2.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};U(t2,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=mT().smooth(e.smooth!==!1),r=e.values,o=e.thresholds||yT(e.count||10,e.nice,!!r),s=e.size,a,u;return r||(r=t.materialize(t.SOURCE).source,a=vT(xT(),e)(r,!0),u=bT(a,a.scale||1,a.scale||1,0,0),s=[a.width,a.height],r=a.values),o=z(o)?o:o(r),r=i.size(s)(r,o),u&&r.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(Ee),n}});const gy="Feature",n2="FeatureCollection",ZW="MultiPoint";function i2(e){F.call(this,null,e)}i2.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};U(i2,F,{transform(e,t){var n=this._features,i=this._points,r=e.fields,o=r&&r[0],s=r&&r[1],a=e.geojson||!r&&Ut,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(Pt(a))||o&&t.modified(Pt(o))||s&&t.modified(Pt(s)),(!this.value||l)&&(u=t.SOURCE,this._features=n=[],this._points=i=[]),a&&t.visit(u,c=>n.push(a(c))),o&&s&&(t.visit(u,c=>{var f=o(c),d=s(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:gy,geometry:{type:ZW,coordinates:i}})),this.value={type:n2,features:n}}});function r2(e){F.call(this,null,e)}r2.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};U(r2,F,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||Ut,o=e.as||"path",s=n.SOURCE;!i||e.modified()?(this.value=i=pT(e.projection),n.materialize().reflow()):s=r===Ut||t.modified(r.fields)?n.ADD_MOD:n.ADD;const a=eH(i,e.pointRadius);return n.visit(s,u=>u[o]=i(r(u))),i.pointRadius(a),n.modifies(o)}});function eH(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function o2(e){F.call(this,null,e)}o2.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};U(o2,F,{transform(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],o=e.as||["x","y"],s=o[0],a=o[1],u;function l(c){const f=n([i(c),r(c)]);f?(c[s]=f[0],c[a]=f[1]):(c[s]=void 0,c[a]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(u=t.modified(i.fields)||t.modified(r.fields),t.visit(u?t.ADD_MOD:t.ADD,l)),t.modifies(o)}});function s2(e){F.call(this,null,e)}s2.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};U(s2,F,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",o=n.ADD;return(!i||e.modified())&&(this.value=i=tH(pT(e.projection),e.field||Kn("datum"),e.pointRadius),n.materialize().reflow(),o=n.SOURCE),n.visit(o,s=>s[r]=i),n.modifies(r)}});function tH(e,t,n){const i=n==null?r=>e(t(r)):r=>{var o=e.pointRadius(),s=e.pointRadius(n)(t(r));return e.pointRadius(o),s};return i.context=r=>(e.context(r),i),i}function a2(e){F.call(this,[],e),this.generator=Xq()}a2.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};U(a2,F,{transform(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(const o in e)ue(i[o])&&i[o](e[o]);return r=i(),n.length?t.mod.push(FM(n[0],r)):t.add.push(Ee(r)),n[0]=r,t}});function u2(e){F.call(this,null,e)}u2.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};U(u2,F,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||Ut,o=iH(e.opacity,e),s=nH(e.color,e),a=e.as||"image",u={$x:0,$y:0,$value:0,$max:i?Ts(n.map(l=>Ts(r(l).values))):0};return n.forEach(l=>{const c=r(l),f=ae({},l,u);i||(f.$max=Ts(c.values||[])),l[a]=rH(c,f,s.dep?s:jt(s(f)),o.dep?o:jt(o(f)))}),t.reflow(!0).modifies(a)}});function nH(e,t){let n;return ue(e)?(n=i=>To(e(i,t)),n.dep=wT(e)):n=jt(To(e||"#888")),n}function iH(e,t){let n;return ue(e)?(n=i=>e(i,t),n.dep=wT(e)):e?n=jt(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function wT(e){if(!ue(e))return!1;const t=Si(Pt(e));return t.$x||t.$y||t.$value||t.$max}function rH(e,t,n,i){const r=e.width,o=e.height,s=e.x1||0,a=e.y1||0,u=e.x2||r,l=e.y2||o,c=e.values,f=c?m=>c[m]:fo,d=ko(u-s,l-a),h=d.getContext("2d"),g=h.getImageData(0,0,u-s,l-a),p=g.data;for(let m=a,y=0;m<l;++m){t.$y=m-a;for(let b=s,x=m*r;b<u;++b,y+=4){t.$x=b-s,t.$value=f(b+x);const v=n(t);p[y+0]=v.r,p[y+1]=v.g,p[y+2]=v.b,p[y+3]=~~(255*i(t))}}return h.putImageData(g,0,0),d}function _T(e){F.call(this,null,e),this.modified(!0)}U(_T,F,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=sH(e.type),hy.forEach(i=>{e[i]!=null&&sk(n,i,e[i])})):hy.forEach(i=>{e.modified(i)&&sk(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&oH(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function oH(e,t){const n=aH(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function sH(e){const t=Qv((e||"mercator").toLowerCase());return t||O("Unrecognized projection type: "+e),t()}function sk(e,t,n){ue(e[t])&&e[t](n)}function aH(e){return e=H(e),e.length===1?e[0]:{type:n2,features:e.reduce((t,n)=>t.concat(uH(n)),[])}}function uH(e){return e.type===n2?e.features:H(e).filter(t=>t!=null).map(t=>t.type===gy?t:{type:gy,geometry:t})}const lH=Object.freeze(Object.defineProperty({__proto__:null,contour:t2,geojson:i2,geopath:r2,geopoint:o2,geoshape:s2,graticule:a2,heatmap:u2,isocontour:Zv,kde2d:e2,projection:_T},Symbol.toStringTag,{value:"Module"}));function cH(e,t){var n,i=1;e==null&&(e=0),t==null&&(t=0);function r(){var o,s=n.length,a,u=0,l=0;for(o=0;o<s;++o)a=n[o],u+=a.x,l+=a.y;for(u=(u/s-e)*i,l=(l/s-t)*i,o=0;o<s;++o)a=n[o],a.x-=u,a.y-=l}return r.initialize=function(o){n=o},r.x=function(o){return arguments.length?(e=+o,r):e},r.y=function(o){return arguments.length?(t=+o,r):t},r.strength=function(o){return arguments.length?(i=+o,r):i},r}function fH(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return ST(this.cover(t,n),t,n,e)}function ST(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,o=e._root,s={data:i},a=e._x0,u=e._y0,l=e._x1,c=e._y1,f,d,h,g,p,m,y,b;if(!o)return e._root=s,e;for(;o.length;)if((p=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(d=(u+c)/2))?u=d:c=d,r=o,!(o=o[y=m<<1|p]))return r[y]=s,e;if(h=+e._x.call(null,o.data),g=+e._y.call(null,o.data),t===h&&n===g)return s.next=o,r?r[y]=s:e._root=s,e;do r=r?r[y]=new Array(4):e._root=new Array(4),(p=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(d=(u+c)/2))?u=d:c=d;while((y=m<<1|p)===(b=(g>=d)<<1|h>=f));return r[b]=o,r[y]=s,e}function dH(e){var t,n,i=e.length,r,o,s=new Array(i),a=new Array(i),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(o=+this._y.call(null,t))||(s[n]=r,a[n]=o,r<u&&(u=r),r>c&&(c=r),o<l&&(l=o),o>f&&(f=o));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<i;++n)ST(this,s[n],a[n],e[n]);return this}function hH(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,o=(i=Math.floor(t))+1;else{for(var s=r-n||1,a=this._root,u,l;n>e||e>=r||i>t||t>=o;)switch(l=(t<i)<<1|e<n,u=new Array(4),u[l]=a,a=u,s*=2,l){case 0:r=n+s,o=i+s;break;case 1:n=r-s,o=i+s;break;case 2:r=n+s,i=o-s;break;case 3:n=r-s,i=o-s;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this}function gH(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function pH(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Qt(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function mH(e,t,n){var i,r=this._x0,o=this._y0,s,a,u,l,c=this._x1,f=this._y1,d=[],h=this._root,g,p;for(h&&d.push(new Qt(h,r,o,c,f)),n==null?n=1/0:(r=e-n,o=t-n,c=e+n,f=t+n,n*=n);g=d.pop();)if(!(!(h=g.node)||(s=g.x0)>c||(a=g.y0)>f||(u=g.x1)<r||(l=g.y1)<o))if(h.length){var m=(s+u)/2,y=(a+l)/2;d.push(new Qt(h[3],m,y,u,l),new Qt(h[2],s,y,m,l),new Qt(h[1],m,a,u,y),new Qt(h[0],s,a,m,y)),(p=(t>=y)<<1|e>=m)&&(g=d[d.length-1],d[d.length-1]=d[d.length-1-p],d[d.length-1-p]=g)}else{var b=e-+this._x.call(null,h.data),x=t-+this._y.call(null,h.data),v=b*b+x*x;if(v<n){var w=Math.sqrt(n=v);r=e-w,o=t-w,c=e+w,f=t+w,i=h.data}}return i}function yH(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,o,s=this._x0,a=this._y0,u=this._x1,l=this._y1,c,f,d,h,g,p,m,y;if(!n)return this;if(n.length)for(;;){if((g=c>=(d=(s+u)/2))?s=d:u=d,(p=f>=(h=(a+l)/2))?a=h:l=h,t=n,!(n=n[m=p<<1|g]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,y=m)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(o=n.next)&&delete n.next,r?(o?r.next=o:delete r.next,this):t?(o?t[m]=o:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[y]=n:this._root=n),this):(this._root=o,this)}function bH(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function xH(){return this._root}function vH(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function wH(e){var t=[],n,i=this._root,r,o,s,a,u;for(i&&t.push(new Qt(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,o=n.x0,s=n.y0,a=n.x1,u=n.y1)&&i.length){var l=(o+a)/2,c=(s+u)/2;(r=i[3])&&t.push(new Qt(r,l,c,a,u)),(r=i[2])&&t.push(new Qt(r,o,c,l,u)),(r=i[1])&&t.push(new Qt(r,l,s,a,c)),(r=i[0])&&t.push(new Qt(r,o,s,l,c))}return this}function _H(e){var t=[],n=[],i;for(this._root&&t.push(new Qt(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var o,s=i.x0,a=i.y0,u=i.x1,l=i.y1,c=(s+u)/2,f=(a+l)/2;(o=r[0])&&t.push(new Qt(o,s,a,c,f)),(o=r[1])&&t.push(new Qt(o,c,a,u,f)),(o=r[2])&&t.push(new Qt(o,s,f,c,l)),(o=r[3])&&t.push(new Qt(o,c,f,u,l))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function SH(e){return e[0]}function EH(e){return arguments.length?(this._x=e,this):this._x}function kH(e){return e[1]}function $H(e){return arguments.length?(this._y=e,this):this._y}function l2(e,t,n){var i=new c2(t??SH,n??kH,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function c2(e,t,n,i,r,o){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function ak(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var an=l2.prototype=c2.prototype;an.copy=function(){var e=new c2(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=ak(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=ak(i));return e};an.add=fH;an.addAll=dH;an.cover=hH;an.data=gH;an.extent=pH;an.find=mH;an.remove=yH;an.removeAll=bH;an.root=xH;an.size=vH;an.visit=wH;an.visitAfter=_H;an.x=EH;an.y=$H;function Zt(e){return function(){return e}}function xo(e){return(e()-.5)*1e-6}function AH(e){return e.x+e.vx}function CH(e){return e.y+e.vy}function MH(e){var t,n,i,r=1,o=1;typeof e!="function"&&(e=Zt(e==null?1:+e));function s(){for(var l,c=t.length,f,d,h,g,p,m,y=0;y<o;++y)for(f=l2(t,AH,CH).visitAfter(a),l=0;l<c;++l)d=t[l],p=n[d.index],m=p*p,h=d.x+d.vx,g=d.y+d.vy,f.visit(b);function b(x,v,w,S,_){var E=x.data,A=x.r,k=p+A;if(E){if(E.index>d.index){var $=h-E.x-E.vx,T=g-E.y-E.vy,M=$*$+T*T;M<k*k&&($===0&&($=xo(i),M+=$*$),T===0&&(T=xo(i),M+=T*T),M=(k-(M=Math.sqrt(M)))/M*r,d.vx+=($*=M)*(k=(A*=A)/(m+A)),d.vy+=(T*=M)*k,E.vx-=$*(k=1-k),E.vy-=T*k)}return}return v>h+k||S<h-k||w>g+k||_<g-k}}function a(l){if(l.data)return l.r=n[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function u(){if(t){var l,c=t.length,f;for(n=new Array(c),l=0;l<c;++l)f=t[l],n[f.index]=+e(f,l,t)}}return s.initialize=function(l,c){t=l,i=c,u()},s.iterations=function(l){return arguments.length?(o=+l,s):o},s.strength=function(l){return arguments.length?(r=+l,s):r},s.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Zt(+l),u(),s):e},s}function FH(e){return e.index}function uk(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function DH(e){var t=FH,n=f,i,r=Zt(30),o,s,a,u,l,c=1;e==null&&(e=[]);function f(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var y=0,b=e.length;y<c;++y)for(var x=0,v,w,S,_,E,A,k;x<b;++x)v=e[x],w=v.source,S=v.target,_=S.x+S.vx-w.x-w.vx||xo(l),E=S.y+S.vy-w.y-w.vy||xo(l),A=Math.sqrt(_*_+E*E),A=(A-o[x])/A*m*i[x],_*=A,E*=A,S.vx-=_*(k=u[x]),S.vy-=E*k,w.vx+=_*(k=1-k),w.vy+=E*k}function h(){if(s){var m,y=s.length,b=e.length,x=new Map(s.map((w,S)=>[t(w,S,s),w])),v;for(m=0,a=new Array(y);m<b;++m)v=e[m],v.index=m,typeof v.source!="object"&&(v.source=uk(x,v.source)),typeof v.target!="object"&&(v.target=uk(x,v.target)),a[v.source.index]=(a[v.source.index]||0)+1,a[v.target.index]=(a[v.target.index]||0)+1;for(m=0,u=new Array(b);m<b;++m)v=e[m],u[m]=a[v.source.index]/(a[v.source.index]+a[v.target.index]);i=new Array(b),g(),o=new Array(b),p()}}function g(){if(s)for(var m=0,y=e.length;m<y;++m)i[m]=+n(e[m],m,e)}function p(){if(s)for(var m=0,y=e.length;m<y;++m)o[m]=+r(e[m],m,e)}return d.initialize=function(m,y){s=m,l=y,h()},d.links=function(m){return arguments.length?(e=m,h(),d):e},d.id=function(m){return arguments.length?(t=m,d):t},d.iterations=function(m){return arguments.length?(c=+m,d):c},d.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Zt(+m),g(),d):n},d.distance=function(m){return arguments.length?(r=typeof m=="function"?m:Zt(+m),p(),d):r},d}var TH={value:()=>{}};function ET(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new zd(n)}function zd(e){this._=e}function NH(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}zd.prototype=ET.prototype={constructor:zd,on:function(e,t){var n=this._,i=NH(e+"",n),r,o=-1,s=i.length;if(arguments.length<2){for(;++o<s;)if((r=(e=i[o]).type)&&(r=OH(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(r=(e=i[o]).type)n[r]=lk(n[r],e.name,t);else if(t==null)for(r in n)n[r]=lk(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new zd(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,o;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};function OH(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function lk(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=TH,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var _u=0,Gl=0,xl=0,kT=1e3,eg,Yl,tg=0,Ys=0,kp=0,Nc=typeof performance=="object"&&performance.now?performance:Date,$T=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function f2(){return Ys||($T(RH),Ys=Nc.now()+kp)}function RH(){Ys=0}function ng(){this._call=this._time=this._next=null}ng.prototype=AT.prototype={constructor:ng,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?f2():+n)+(t==null?0:+t),!this._next&&Yl!==this&&(Yl?Yl._next=this:eg=this,Yl=this),this._call=e,this._time=n,py()},stop:function(){this._call&&(this._call=null,this._time=1/0,py())}};function AT(e,t,n){var i=new ng;return i.restart(e,t,n),i}function zH(){f2(),++_u;for(var e=eg,t;e;)(t=Ys-e._time)>=0&&e._call.call(void 0,t),e=e._next;--_u}function ck(){Ys=(tg=Nc.now())+kp,_u=Gl=0;try{zH()}finally{_u=0,LH(),Ys=0}}function PH(){var e=Nc.now(),t=e-tg;t>kT&&(kp-=t,tg=e)}function LH(){for(var e,t=eg,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:eg=n);Yl=e,py(i)}function py(e){if(!_u){Gl&&(Gl=clearTimeout(Gl));var t=e-Ys;t>24?(e<1/0&&(Gl=setTimeout(ck,e-Nc.now()-kp)),xl&&(xl=clearInterval(xl))):(xl||(tg=Nc.now(),xl=setInterval(PH,kT)),_u=1,$T(ck))}}function IH(e,t,n){var i=new ng,r=t;return t==null?(i.restart(e,t,n),i):(i._restart=i.restart,i.restart=function(o,s,a){s=+s,a=a==null?f2():+a,i._restart(function u(l){l+=r,i._restart(u,r+=s,a),o(l)},s,a)},i.restart(e,t,n),i)}const BH=1664525,UH=1013904223,fk=4294967296;function jH(){let e=1;return()=>(e=(BH*e+UH)%fk)/fk}function qH(e){return e.x}function WH(e){return e.y}var HH=10,GH=Math.PI*(3-Math.sqrt(5));function YH(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),o=0,s=.6,a=new Map,u=AT(f),l=ET("tick","end"),c=jH();e==null&&(e=[]);function f(){d(),l.call("tick",t),n<i&&(u.stop(),l.call("end",t))}function d(p){var m,y=e.length,b;p===void 0&&(p=1);for(var x=0;x<p;++x)for(n+=(o-n)*r,a.forEach(function(v){v(n)}),m=0;m<y;++m)b=e[m],b.fx==null?b.x+=b.vx*=s:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=s:(b.y=b.fy,b.vy=0);return t}function h(){for(var p=0,m=e.length,y;p<m;++p){if(y=e[p],y.index=p,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var b=HH*Math.sqrt(.5+p),x=p*GH;y.x=b*Math.cos(x),y.y=b*Math.sin(x)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function g(p){return p.initialize&&p.initialize(e,c),p}return h(),t={tick:d,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(p){return arguments.length?(e=p,h(),a.forEach(g),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(o=+p,t):o},velocityDecay:function(p){return arguments.length?(s=1-p,t):1-s},randomSource:function(p){return arguments.length?(c=p,a.forEach(g),t):c},force:function(p,m){return arguments.length>1?(m==null?a.delete(p):a.set(p,g(m)),t):a.get(p)},find:function(p,m,y){var b=0,x=e.length,v,w,S,_,E;for(y==null?y=1/0:y*=y,b=0;b<x;++b)_=e[b],v=p-_.x,w=m-_.y,S=v*v+w*w,S<y&&(E=_,y=S);return E},on:function(p,m){return arguments.length>1?(l.on(p,m),t):l.on(p)}}}function VH(){var e,t,n,i,r=Zt(-30),o,s=1,a=1/0,u=.81;function l(h){var g,p=e.length,m=l2(e,qH,WH).visitAfter(f);for(i=h,g=0;g<p;++g)t=e[g],m.visit(d)}function c(){if(e){var h,g=e.length,p;for(o=new Array(g),h=0;h<g;++h)p=e[h],o[p.index]=+r(p,h,e)}}function f(h){var g=0,p,m,y=0,b,x,v;if(h.length){for(b=x=v=0;v<4;++v)(p=h[v])&&(m=Math.abs(p.value))&&(g+=p.value,y+=m,b+=m*p.x,x+=m*p.y);h.x=b/y,h.y=x/y}else{p=h,p.x=p.data.x,p.y=p.data.y;do g+=o[p.data.index];while(p=p.next)}h.value=g}function d(h,g,p,m){if(!h.value)return!0;var y=h.x-t.x,b=h.y-t.y,x=m-g,v=y*y+b*b;if(x*x/u<v)return v<a&&(y===0&&(y=xo(n),v+=y*y),b===0&&(b=xo(n),v+=b*b),v<s&&(v=Math.sqrt(s*v)),t.vx+=y*h.value*i/v,t.vy+=b*h.value*i/v),!0;if(h.length||v>=a)return;(h.data!==t||h.next)&&(y===0&&(y=xo(n),v+=y*y),b===0&&(b=xo(n),v+=b*b),v<s&&(v=Math.sqrt(s*v)));do h.data!==t&&(x=o[h.data.index]*i/v,t.vx+=y*x,t.vy+=b*x);while(h=h.next)}return l.initialize=function(h,g){e=h,n=g,c()},l.strength=function(h){return arguments.length?(r=typeof h=="function"?h:Zt(+h),c(),l):r},l.distanceMin=function(h){return arguments.length?(s=h*h,l):Math.sqrt(s)},l.distanceMax=function(h){return arguments.length?(a=h*h,l):Math.sqrt(a)},l.theta=function(h){return arguments.length?(u=h*h,l):Math.sqrt(u)},l}function XH(e){var t=Zt(.1),n,i,r;typeof e!="function"&&(e=Zt(e==null?0:+e));function o(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vx+=(r[u]-c.x)*i[u]*a}function s(){if(n){var a,u=n.length;for(i=new Array(u),r=new Array(u),a=0;a<u;++a)i[a]=isNaN(r[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return o.initialize=function(a){n=a,s()},o.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Zt(+a),s(),o):t},o.x=function(a){return arguments.length?(e=typeof a=="function"?a:Zt(+a),s(),o):e},o}function KH(e){var t=Zt(.1),n,i,r;typeof e!="function"&&(e=Zt(e==null?0:+e));function o(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vy+=(r[u]-c.y)*i[u]*a}function s(){if(n){var a,u=n.length;for(i=new Array(u),r=new Array(u),a=0;a<u;++a)i[a]=isNaN(r[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return o.initialize=function(a){n=a,s()},o.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Zt(+a),s(),o):t},o.y=function(a){return arguments.length?(e=typeof a=="function"?a:Zt(+a),s(),o):e},o}const dk={center:cH,collide:MH,nbody:VH,link:DH,x:XH,y:KH},Vl="forces",my=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],JH=["static","iterations"],CT=["x","y","vx","vy"];function d2(e){F.call(this,null,e)}d2.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:CT}]};U(d2,F,{transform(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(my),o=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&MT(n,e,0,t)):(this.value=n=ZH(t.source,e),n.on("tick",QH(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(JH)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/o)),e.static)for(n.stop();--o>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let a=this._argops,u=0,l=a.length,c;u<l;++u)if(c=a[u],!(c.name!==Vl||c.op._argval.force!=="link")){for(var i=c.op._argops,r=0,o=i.length,s;r<o;++r)if(i[r].name==="links"&&(s=i[r].op.source)){n.pulse(s,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(CT)}});function QH(e,t){return()=>e.touch(t).run()}function ZH(e,t){const n=YH(e),i=n.stop,r=n.restart;let o=!1;return n.stopped=()=>o,n.restart=()=>(o=!1,r()),n.stop=()=>(o=!0,i()),MT(n,t,!0).on("end",()=>o=!0)}function MT(e,t,n,i){var r=H(t.forces),o,s,a,u;for(o=0,s=my.length;o<s;++o)a=my[o],a!==Vl&&t.modified(a)&&e[a](t[a]);for(o=0,s=r.length;o<s;++o)u=Vl+o,a=n||t.modified(Vl,o)?tG(r[o]):i&&eG(r[o],i)?e.force(u):null,a&&e.force(u,a);for(s=e.numForces||0;o<s;++o)e.force(Vl+o,null);return e.numForces=r.length,e}function eG(e,t){var n,i;for(n in e)if(ue(i=e[n])&&t.modified(Pt(i)))return 1;return 0}function tG(e){var t,n;ne(dk,e.force)||O("Unrecognized force: "+e.force),t=dk[e.force]();for(n in e)ue(t[n])&&nG(t[n],e[n],e);return t}function nG(e,t,n){e(ue(t)?i=>t(i,n):t)}const iG=Object.freeze(Object.defineProperty({__proto__:null,force:d2},Symbol.toStringTag,{value:"Module"}));function rG(e,t){return e.parent===t.parent?1:2}function oG(e){return e.reduce(sG,0)/e.length}function sG(e,t){return e+t.x}function aG(e){return 1+e.reduce(uG,0)}function uG(e,t){return Math.max(e,t.y)}function lG(e){for(var t;t=e.children;)e=t[0];return e}function cG(e){for(var t;t=e.children;)e=t[t.length-1];return e}function fG(){var e=rG,t=1,n=1,i=!1;function r(o){var s,a=0;o.eachAfter(function(d){var h=d.children;h?(d.x=oG(h),d.y=aG(h)):(d.x=s?a+=e(d,s):0,d.y=0,s=d)});var u=lG(o),l=cG(o),c=u.x-e(u,l)/2,f=l.x+e(l,u)/2;return o.eachAfter(i?function(d){d.x=(d.x-o.x)*t,d.y=(o.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(o.y?d.y/o.y:1))*n})}return r.separation=function(o){return arguments.length?(e=o,r):e},r.size=function(o){return arguments.length?(i=!1,t=+o[0],n=+o[1],r):i?null:[t,n]},r.nodeSize=function(o){return arguments.length?(i=!0,t=+o[0],n=+o[1],r):i?[t,n]:null},r}function dG(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function hG(){return this.eachAfter(dG)}function gG(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this}function pG(e,t){for(var n=this,i=[n],r,o,s=-1;n=i.pop();)if(e.call(t,n,++s,this),r=n.children)for(o=r.length-1;o>=0;--o)i.push(r[o]);return this}function mG(e,t){for(var n=this,i=[n],r=[],o,s,a,u=-1;n=i.pop();)if(r.push(n),o=n.children)for(s=0,a=o.length;s<a;++s)i.push(o[s]);for(;n=r.pop();)e.call(t,n,++u,this);return this}function yG(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i}function bG(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function xG(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function vG(e){for(var t=this,n=wG(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function wG(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function _G(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function SG(){return Array.from(this)}function EG(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function kG(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*$G(){var e=this,t,n=[e],i,r,o;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,i=e.children)for(r=0,o=i.length;r<o;++r)n.push(i[r]);while(n.length)}function h2(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=MG)):t===void 0&&(t=CG);for(var n=new Su(e),i,r=[n],o,s,a,u;i=r.pop();)if((s=t(i.data))&&(u=(s=Array.from(s)).length))for(i.children=s,a=u-1;a>=0;--a)r.push(o=s[a]=new Su(s[a])),o.parent=i,o.depth=i.depth+1;return n.eachBefore(FT)}function AG(){return h2(this).eachBefore(FG)}function CG(e){return e.children}function MG(e){return Array.isArray(e)?e[1]:null}function FG(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function FT(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function Su(e){this.data=e,this.depth=this.height=0,this.parent=null}Su.prototype=h2.prototype={constructor:Su,count:hG,each:gG,eachAfter:mG,eachBefore:pG,find:yG,sum:bG,sort:xG,path:vG,ancestors:_G,descendants:SG,leaves:EG,links:kG,copy:AG,[Symbol.iterator]:$G};function Pd(e){return e==null?null:DT(e)}function DT(e){if(typeof e!="function")throw new Error;return e}function $s(){return 0}function Ia(e){return function(){return e}}const DG=1664525,TG=1013904223,hk=4294967296;function NG(){let e=1;return()=>(e=(DG*e+TG)%hk)/hk}function OG(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function RG(e,t){let n=e.length,i,r;for(;n;)r=t()*n--|0,i=e[n],e[n]=e[r],e[r]=i;return e}function zG(e,t){for(var n=0,i=(e=RG(Array.from(e),t)).length,r=[],o,s;n<i;)o=e[n],s&&TT(s,o)?++n:(s=LG(r=PG(r,o)),n=0);return s}function PG(e,t){var n,i;if(d0(t,e))return[t];for(n=0;n<e.length;++n)if(ad(t,e[n])&&d0(Xl(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(ad(Xl(e[n],e[i]),t)&&ad(Xl(e[n],t),e[i])&&ad(Xl(e[i],t),e[n])&&d0(NT(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error}function ad(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function TT(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function d0(e,t){for(var n=0;n<t.length;++n)if(!TT(e,t[n]))return!1;return!0}function LG(e){switch(e.length){case 1:return IG(e[0]);case 2:return Xl(e[0],e[1]);case 3:return NT(e[0],e[1],e[2])}}function IG(e){return{x:e.x,y:e.y,r:e.r}}function Xl(e,t){var n=e.x,i=e.y,r=e.r,o=t.x,s=t.y,a=t.r,u=o-n,l=s-i,c=a-r,f=Math.sqrt(u*u+l*l);return{x:(n+o+u/f*c)/2,y:(i+s+l/f*c)/2,r:(f+r+a)/2}}function NT(e,t,n){var i=e.x,r=e.y,o=e.r,s=t.x,a=t.y,u=t.r,l=n.x,c=n.y,f=n.r,d=i-s,h=i-l,g=r-a,p=r-c,m=u-o,y=f-o,b=i*i+r*r-o*o,x=b-s*s-a*a+u*u,v=b-l*l-c*c+f*f,w=h*g-d*p,S=(g*v-p*x)/(w*2)-i,_=(p*m-g*y)/w,E=(h*x-d*v)/(w*2)-r,A=(d*y-h*m)/w,k=_*_+A*A-1,$=2*(o+S*_+E*A),T=S*S+E*E-o*o,M=-(Math.abs(k)>1e-6?($+Math.sqrt($*$-4*k*T))/(2*k):T/$);return{x:i+S+_*M,y:r+E+A*M,r:M}}function gk(e,t,n){var i=e.x-t.x,r,o,s=e.y-t.y,a,u,l=i*i+s*s;l?(o=t.r+n.r,o*=o,u=e.r+n.r,u*=u,o>u?(r=(l+u-o)/(2*l),a=Math.sqrt(Math.max(0,u/l-r*r)),n.x=e.x-r*i-a*s,n.y=e.y-r*s+a*i):(r=(l+o-u)/(2*l),a=Math.sqrt(Math.max(0,o/l-r*r)),n.x=t.x+r*i-a*s,n.y=t.y+r*s+a*i)):(n.x=t.x+n.r,n.y=t.y)}function pk(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function mk(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,o=(t.y*n.r+n.y*t.r)/i;return r*r+o*o}function ud(e){this._=e,this.next=null,this.previous=null}function BG(e,t){if(!(o=(e=OG(e)).length))return 0;var n,i,r,o,s,a,u,l,c,f,d;if(n=e[0],n.x=0,n.y=0,!(o>1))return n.r;if(i=e[1],n.x=-i.r,i.x=n.r,i.y=0,!(o>2))return n.r+i.r;gk(i,n,r=e[2]),n=new ud(n),i=new ud(i),r=new ud(r),n.next=r.previous=i,i.next=n.previous=r,r.next=i.previous=n;e:for(u=3;u<o;++u){gk(n._,i._,r=e[u]),r=new ud(r),l=i.next,c=n.previous,f=i._.r,d=n._.r;do if(f<=d){if(pk(l._,r._)){i=l,n.next=i,i.previous=n,--u;continue e}f+=l._.r,l=l.next}else{if(pk(c._,r._)){n=c,n.next=i,i.previous=n,--u;continue e}d+=c._.r,c=c.previous}while(l!==c.next);for(r.previous=n,r.next=i,n.next=i.previous=i=r,s=mk(n);(r=r.next)!==i;)(a=mk(r))<s&&(n=r,s=a);i=n.next}for(n=[i._],r=i;(r=r.next)!==i;)n.push(r._);for(r=zG(n,t),u=0;u<o;++u)n=e[u],n.x-=r.x,n.y-=r.y;return r.r}function UG(e){return Math.sqrt(e.value)}function jG(){var e=null,t=1,n=1,i=$s;function r(o){const s=NG();return o.x=t/2,o.y=n/2,e?o.eachBefore(yk(e)).eachAfter(h0(i,.5,s)).eachBefore(bk(1)):o.eachBefore(yk(UG)).eachAfter(h0($s,1,s)).eachAfter(h0(i,o.r/Math.min(t,n),s)).eachBefore(bk(Math.min(t,n)/(2*o.r))),o}return r.radius=function(o){return arguments.length?(e=Pd(o),r):e},r.size=function(o){return arguments.length?(t=+o[0],n=+o[1],r):[t,n]},r.padding=function(o){return arguments.length?(i=typeof o=="function"?o:Ia(+o),r):i},r}function yk(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function h0(e,t,n){return function(i){if(r=i.children){var r,o,s=r.length,a=e(i)*t||0,u;if(a)for(o=0;o<s;++o)r[o].r+=a;if(u=BG(r,n),a)for(o=0;o<s;++o)r[o].r-=a;i.r=u+a}}}function bk(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function OT(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function bf(e,t,n,i,r){for(var o=e.children,s,a=-1,u=o.length,l=e.value&&(i-t)/e.value;++a<u;)s=o[a],s.y0=n,s.y1=r,s.x0=t,s.x1=t+=s.value*l}function qG(){var e=1,t=1,n=0,i=!1;function r(s){var a=s.height+1;return s.x0=s.y0=n,s.x1=e,s.y1=t/a,s.eachBefore(o(t,a)),i&&s.eachBefore(OT),s}function o(s,a){return function(u){u.children&&bf(u,u.x0,s*(u.depth+1)/a,u.x1,s*(u.depth+2)/a);var l=u.x0,c=u.y0,f=u.x1-n,d=u.y1-n;f<l&&(l=f=(l+f)/2),d<c&&(c=d=(c+d)/2),u.x0=l,u.y0=c,u.x1=f,u.y1=d}}return r.round=function(s){return arguments.length?(i=!!s,r):i},r.size=function(s){return arguments.length?(e=+s[0],t=+s[1],r):[e,t]},r.padding=function(s){return arguments.length?(n=+s,r):n},r}var WG={depth:-1},xk={},g0={};function HG(e){return e.id}function GG(e){return e.parentId}function vk(){var e=HG,t=GG,n;function i(r){var o=Array.from(r),s=e,a=t,u,l,c,f,d,h,g,p,m=new Map;if(n!=null){const y=o.map((v,w)=>YG(n(v,w,r))),b=y.map(wk),x=new Set(y).add("");for(const v of b)x.has(v)||(x.add(v),y.push(v),b.push(wk(v)),o.push(g0));s=(v,w)=>y[w],a=(v,w)=>b[w]}for(c=0,u=o.length;c<u;++c)l=o[c],h=o[c]=new Su(l),(g=s(l,c,r))!=null&&(g+="")&&(p=h.id=g,m.set(p,m.has(p)?xk:h)),(g=a(l,c,r))!=null&&(g+="")&&(h.parent=g);for(c=0;c<u;++c)if(h=o[c],g=h.parent){if(d=m.get(g),!d)throw new Error("missing: "+g);if(d===xk)throw new Error("ambiguous: "+g);d.children?d.children.push(h):d.children=[h],h.parent=d}else{if(f)throw new Error("multiple roots");f=h}if(!f)throw new Error("no root");if(n!=null){for(;f.data===g0&&f.children.length===1;)f=f.children[0],--u;for(let y=o.length-1;y>=0&&(h=o[y],h.data===g0);--y)h.data=null}if(f.parent=WG,f.eachBefore(function(y){y.depth=y.parent.depth+1,--u}).eachBefore(FT),f.parent=null,u>0)throw new Error("cycle");return f}return i.id=function(r){return arguments.length?(e=Pd(r),i):e},i.parentId=function(r){return arguments.length?(t=Pd(r),i):t},i.path=function(r){return arguments.length?(n=Pd(r),i):n},i}function YG(e){e=`${e}`;let t=e.length;return yy(e,t-1)&&!yy(e,t-2)&&(e=e.slice(0,-1)),e[0]==="/"?e:`/${e}`}function wk(e){let t=e.length;if(t<2)return"";for(;--t>1&&!yy(e,t););return e.slice(0,t)}function yy(e,t){if(e[t]==="/"){let n=0;for(;t>0&&e[--t]==="\\";)++n;if(!(n&1))return!0}return!1}function VG(e,t){return e.parent===t.parent?1:2}function p0(e){var t=e.children;return t?t[0]:e.t}function m0(e){var t=e.children;return t?t[t.length-1]:e.t}function XG(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function KG(e){for(var t=0,n=0,i=e.children,r=i.length,o;--r>=0;)o=i[r],o.z+=t,o.m+=t,t+=o.s+(n+=o.c)}function JG(e,t,n){return e.a.parent===t.parent?e.a:n}function Ld(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}Ld.prototype=Object.create(Su.prototype);function QG(e){for(var t=new Ld(e,0),n,i=[t],r,o,s,a;n=i.pop();)if(o=n._.children)for(n.children=new Array(a=o.length),s=a-1;s>=0;--s)i.push(r=n.children[s]=new Ld(o[s],s)),r.parent=n;return(t.parent=new Ld(null,0)).children=[t],t}function ZG(){var e=VG,t=1,n=1,i=null;function r(l){var c=QG(l);if(c.eachAfter(o),c.parent.m=-c.z,c.eachBefore(s),i)l.eachBefore(u);else{var f=l,d=l,h=l;l.eachBefore(function(b){b.x<f.x&&(f=b),b.x>d.x&&(d=b),b.depth>h.depth&&(h=b)});var g=f===d?1:e(f,d)/2,p=g-f.x,m=t/(d.x+g+p),y=n/(h.depth||1);l.eachBefore(function(b){b.x=(b.x+p)*m,b.y=b.depth*y})}return l}function o(l){var c=l.children,f=l.parent.children,d=l.i?f[l.i-1]:null;if(c){KG(l);var h=(c[0].z+c[c.length-1].z)/2;d?(l.z=d.z+e(l._,d._),l.m=l.z-h):l.z=h}else d&&(l.z=d.z+e(l._,d._));l.parent.A=a(l,d,l.parent.A||f[0])}function s(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function a(l,c,f){if(c){for(var d=l,h=l,g=c,p=d.parent.children[0],m=d.m,y=h.m,b=g.m,x=p.m,v;g=m0(g),d=p0(d),g&&d;)p=p0(p),h=m0(h),h.a=l,v=g.z+b-d.z-m+e(g._,d._),v>0&&(XG(JG(g,l,f),l,v),m+=v,y+=v),b+=g.m,m+=d.m,x+=p.m,y+=h.m;g&&!m0(h)&&(h.t=g,h.m+=b-y),d&&!p0(p)&&(p.t=d,p.m+=m-x,f=l)}return f}function u(l){l.x*=t,l.y=l.depth*n}return r.separation=function(l){return arguments.length?(e=l,r):e},r.size=function(l){return arguments.length?(i=!1,t=+l[0],n=+l[1],r):i?null:[t,n]},r.nodeSize=function(l){return arguments.length?(i=!0,t=+l[0],n=+l[1],r):i?[t,n]:null},r}function $p(e,t,n,i,r){for(var o=e.children,s,a=-1,u=o.length,l=e.value&&(r-n)/e.value;++a<u;)s=o[a],s.x0=t,s.x1=i,s.y0=n,s.y1=n+=s.value*l}var RT=(1+Math.sqrt(5))/2;function zT(e,t,n,i,r,o){for(var s=[],a=t.children,u,l,c=0,f=0,d=a.length,h,g,p=t.value,m,y,b,x,v,w,S;c<d;){h=r-n,g=o-i;do m=a[f++].value;while(!m&&f<d);for(y=b=m,w=Math.max(g/h,h/g)/(p*e),S=m*m*w,v=Math.max(b/S,S/y);f<d;++f){if(m+=l=a[f].value,l<y&&(y=l),l>b&&(b=l),S=m*m*w,x=Math.max(b/S,S/y),x>v){m-=l;break}v=x}s.push(u={value:m,dice:h<g,children:a.slice(c,f)}),u.dice?bf(u,n,i,r,p?i+=g*m/p:o):$p(u,n,i,p?n+=h*m/p:r,o),p-=m,c=f}return s}const PT=function e(t){function n(i,r,o,s,a){zT(t,i,r,o,s,a)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(RT);function eY(){var e=PT,t=!1,n=1,i=1,r=[0],o=$s,s=$s,a=$s,u=$s,l=$s;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],t&&d.eachBefore(OT),d}function f(d){var h=r[d.depth],g=d.x0+h,p=d.y0+h,m=d.x1-h,y=d.y1-h;m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),d.x0=g,d.y0=p,d.x1=m,d.y1=y,d.children&&(h=r[d.depth+1]=o(d)/2,g+=l(d)-h,p+=s(d)-h,m-=a(d)-h,y-=u(d)-h,m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),e(d,g,p,m,y))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],i=+d[1],c):[n,i]},c.tile=function(d){return arguments.length?(e=DT(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(o=typeof d=="function"?d:Ia(+d),c):o},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(s=typeof d=="function"?d:Ia(+d),c):s},c.paddingRight=function(d){return arguments.length?(a=typeof d=="function"?d:Ia(+d),c):a},c.paddingBottom=function(d){return arguments.length?(u=typeof d=="function"?d:Ia(+d),c):u},c.paddingLeft=function(d){return arguments.length?(l=typeof d=="function"?d:Ia(+d),c):l},c}function tY(e,t,n,i,r){var o=e.children,s,a=o.length,u,l=new Array(a+1);for(l[0]=u=s=0;s<a;++s)l[s+1]=u+=o[s].value;c(0,a,e.value,t,n,i,r);function c(f,d,h,g,p,m,y){if(f>=d-1){var b=o[f];b.x0=g,b.y0=p,b.x1=m,b.y1=y;return}for(var x=l[f],v=h/2+x,w=f+1,S=d-1;w<S;){var _=w+S>>>1;l[_]<v?w=_+1:S=_}v-l[w-1]<l[w]-v&&f+1<w&&--w;var E=l[w]-x,A=h-E;if(m-g>y-p){var k=h?(g*A+m*E)/h:m;c(f,w,E,g,p,k,y),c(w,d,A,k,p,m,y)}else{var $=h?(p*A+y*E)/h:y;c(f,w,E,g,p,m,$),c(w,d,A,g,$,m,y)}}}function nY(e,t,n,i,r){(e.depth&1?$p:bf)(e,t,n,i,r)}const iY=function e(t){function n(i,r,o,s,a){if((u=i._squarify)&&u.ratio===t)for(var u,l,c,f,d=-1,h,g=u.length,p=i.value;++d<g;){for(l=u[d],c=l.children,f=l.value=0,h=c.length;f<h;++f)l.value+=c[f].value;l.dice?bf(l,r,o,s,p?o+=(a-o)*l.value/p:a):$p(l,r,o,p?r+=(s-r)*l.value/p:s,a),p-=l.value}else i._squarify=u=zT(t,i,r,o,s,a),u.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(RT);function by(e,t,n){const i={};return e.each(r=>{const o=r.data;n(o)&&(i[t(o)]=r)}),e.lookup=i,e}function g2(e){F.call(this,null,e)}g2.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const rY=e=>e.values;U(g2,F,{transform(e,t){t.source||O("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),o=this.value;return(!o||i||t.changed())&&(o&&o.each(s=>{s.children&&Ig(s.data)&&r.rem.push(s.data)}),this.value=o=h2({values:H(e.keys).reduce((s,a)=>(s.key(a),s),oY()).entries(r.source)},rY),n&&o.each(s=>{s.children&&(s=Ee(s.data),r.add.push(s),r.source.push(s))}),by(o,ee,ee)),r.source.root=o,r}});function oY(){const e=[],t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)};function n(r,o){if(o>=e.length)return r;const s=r.length,a=e[o++],u={},l={};let c=-1,f,d,h;for(;++c<s;)f=a(d=r[c])+"",(h=u[f])?h.push(d):u[f]=[d];for(f in u)l[f]=n(u[f],o);return l}function i(r,o){if(++o>e.length)return r;const s=[];for(const a in r)s.push({key:a,values:i(r[a],o)});return s}return t}function Yr(e){F.call(this,null,e)}const sY=(e,t)=>e.parent===t.parent?1:2;U(Yr,F,{transform(e,t){(!t.source||!t.source.root)&&O(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),i=this.fields,r=t.source.root,o=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(fa(e.sort,s=>s.data)),aY(n,this.params,e),n.separation&&n.separation(e.separation!==!1?sY:Iu);try{this.value=n(r)}catch(s){O(s)}return r.each(s=>uY(s,i,o)),t.reflow(e.modified()).modifies(o).modifies("leaf")}});function aY(e,t,n){for(let i,r=0,o=t.length;r<o;++r)i=t[r],i in n&&e[i](n[i])}function uY(e,t,n){const i=e.data,r=t.length-1;for(let o=0;o<r;++o)i[n[o]]=e[t[o]];i[n[r]]=e.children?e.children.length:0}const xy=["x","y","r","depth","children"];function p2(e){Yr.call(this,e)}p2.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:xy.length,default:xy}]};U(p2,Yr,{layout:jG,params:["radius","size","padding"],fields:xy});const vy=["x0","y0","x1","y1","depth","children"];function m2(e){Yr.call(this,e)}m2.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:vy.length,default:vy}]};U(m2,Yr,{layout:qG,params:["size","round","padding"],fields:vy});function y2(e){F.call(this,null,e)}y2.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};U(y2,F,{transform(e,t){t.source||O("Stratify transform requires an upstream data source.");let n=this.value;const i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),o=!n||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),o&&(n=r.source.length?by(vk().id(e.key).parentId(e.parentKey)(r.source),e.key,Jn):by(vk()([{}]),e.key,e.key)),r.source.root=this.value=n,r}});const _k={tidy:ZG,cluster:fG},wy=["x","y","depth","children"];function b2(e){Yr.call(this,e)}b2.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:wy.length,default:wy}]};U(b2,Yr,{layout(e){const t=e||"tidy";if(ne(_k,t))return _k[t]();O("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:wy});function x2(e){F.call(this,[],e)}x2.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};U(x2,F,{transform(e,t){const n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),o={};return i||O("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,s=>o[ee(s)]=1),i.each(s=>{const a=s.data,u=s.parent&&s.parent.data;u&&o[ee(a)]&&o[ee(u)]&&r.add.push(Ee({source:u,target:a}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,s=>o[ee(s)]=1),n.forEach(s=>{(o[ee(s.source)]||o[ee(s.target)])&&r.mod.push(s)})),r}});const Sk={binary:tY,dice:bf,slice:$p,slicedice:nY,squarify:PT,resquarify:iY},_y=["x0","y0","x1","y1","depth","children"];function v2(e){Yr.call(this,e)}v2.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:_y.length,default:_y}]};U(v2,Yr,{layout(){const e=eY();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{ne(Sk,t)?e.tile(Sk[t]):O("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:_y});const lY=Object.freeze(Object.defineProperty({__proto__:null,nest:g2,pack:p2,partition:m2,stratify:y2,tree:b2,treelinks:x2,treemap:v2},Symbol.toStringTag,{value:"Module"})),y0=4278190080;function cY(e,t){const n=e.bitmap();return(t||[]).forEach(i=>n.set(e(i.boundary[0]),e(i.boundary[3]))),[n,void 0]}function fY(e,t,n,i,r){const o=e.width,s=e.height,a=i||r,u=ko(o,s).getContext("2d"),l=ko(o,s).getContext("2d"),c=a&&ko(o,s).getContext("2d");n.forEach(E=>Id(u,E,!1)),Id(l,t,!1),a&&Id(c,t,!0);const f=b0(u,o,s),d=b0(l,o,s),h=a&&b0(c,o,s),g=e.bitmap(),p=a&&e.bitmap();let m,y,b,x,v,w,S,_;for(y=0;y<s;++y)for(m=0;m<o;++m)v=y*o+m,w=f[v]&y0,_=d[v]&y0,S=a&&h[v]&y0,(w||S||_)&&(b=e(m),x=e(y),!r&&(w||_)&&g.set(b,x),a&&(w||S)&&p.set(b,x));return[g,p]}function b0(e,t,n){return new Uint32Array(e.getImageData(0,0,t,n).data.buffer)}function Id(e,t,n){if(!t.length)return;const i=t[0].mark.marktype;i==="group"?t.forEach(r=>{r.items.forEach(o=>Id(e,o.items,n))}):zn[i].draw(e,{items:n?t.map(dY):t})}function dY(e){const t=Bg(e,{});return t.stroke&&t.strokeOpacity!==0||t.fill&&t.fillOpacity!==0?{...t,strokeOpacity:1,stroke:"#000",fillOpacity:0}:t}const wr=5,Ht=31,Oc=32,lo=new Uint32Array(Oc+1),di=new Uint32Array(Oc+1);di[0]=0;lo[0]=~di[0];for(let e=1;e<=Oc;++e)di[e]=di[e-1]<<1|1,lo[e]=~di[e];function hY(e,t){const n=new Uint32Array(~~((e*t+Oc)/Oc));function i(o,s){n[o]|=s}function r(o,s){n[o]&=s}return{array:n,get:(o,s)=>{const a=s*e+o;return n[a>>>wr]&1<<(a&Ht)},set:(o,s)=>{const a=s*e+o;i(a>>>wr,1<<(a&Ht))},clear:(o,s)=>{const a=s*e+o;r(a>>>wr,~(1<<(a&Ht)))},getRange:(o,s,a,u)=>{let l=u,c,f,d,h;for(;l>=s;--l)if(c=l*e+o,f=l*e+a,d=c>>>wr,h=f>>>wr,d===h){if(n[d]&lo[c&Ht]&di[(f&Ht)+1])return!0}else{if(n[d]&lo[c&Ht]||n[h]&di[(f&Ht)+1])return!0;for(let g=d+1;g<h;++g)if(n[g])return!0}return!1},setRange:(o,s,a,u)=>{let l,c,f,d,h;for(;s<=u;++s)if(l=s*e+o,c=s*e+a,f=l>>>wr,d=c>>>wr,f===d)i(f,lo[l&Ht]&di[(c&Ht)+1]);else for(i(f,lo[l&Ht]),i(d,di[(c&Ht)+1]),h=f+1;h<d;++h)i(h,4294967295)},clearRange:(o,s,a,u)=>{let l,c,f,d,h;for(;s<=u;++s)if(l=s*e+o,c=s*e+a,f=l>>>wr,d=c>>>wr,f===d)r(f,di[l&Ht]|lo[(c&Ht)+1]);else for(r(f,di[l&Ht]),r(d,lo[(c&Ht)+1]),h=f+1;h<d;++h)r(h,0)},outOfBounds:(o,s,a,u)=>o<0||s<0||u>=t||a>=e}}function gY(e,t,n){const i=Math.max(1,Math.sqrt(e*t/1e6)),r=~~((e+2*n+i)/i),o=~~((t+2*n+i)/i),s=a=>~~((a+n)/i);return s.invert=a=>a*i-n,s.bitmap=()=>hY(r,o),s.ratio=i,s.padding=n,s.width=e,s.height=t,s}function pY(e,t,n,i){const r=e.width,o=e.height;return function(s){const a=s.datum.datum.items[i].items,u=a.length,l=s.datum.fontSize,c=Tn.width(s.datum,s.datum.text);let f=0,d,h,g,p,m,y,b;for(let x=0;x<u;++x)d=a[x].x,g=a[x].y,h=a[x].x2===void 0?d:a[x].x2,p=a[x].y2===void 0?g:a[x].y2,m=(d+h)/2,y=(g+p)/2,b=Math.abs(h-d+p-g),b>=f&&(f=b,s.x=m,s.y=y);return m=c/2,y=l/2,d=s.x-m,h=s.x+m,g=s.y-y,p=s.y+y,s.align="center",d<0&&h<=r?s.align="left":0<=d&&r<h&&(s.align="right"),s.baseline="middle",g<0&&p<=o?s.baseline="top":0<=g&&o<p&&(s.baseline="bottom"),!0}}function ig(e,t,n,i,r,o){let s=n/2;return e-s<0||e+s>r||t-(s=i/2)<0||t+s>o}function vo(e,t,n,i,r,o,s,a){const u=r*o/(i*2),l=e(t-u),c=e(t+u),f=e(n-(o=o/2)),d=e(n+o);return s.outOfBounds(l,f,c,d)||s.getRange(l,f,c,d)||a&&a.getRange(l,f,c,d)}function mY(e,t,n,i){const r=e.width,o=e.height,s=t[0],a=t[1];function u(l,c,f,d,h){const g=e.invert(l),p=e.invert(c);let m=f,y=o,b;if(!ig(g,p,d,h,r,o)&&!vo(e,g,p,h,d,m,s,a)&&!vo(e,g,p,h,d,h,s,null)){for(;y-m>=1;)b=(m+y)/2,vo(e,g,p,h,d,b,s,a)?y=b:m=b;if(m>f)return[g,p,m,!0]}}return function(l){const c=l.datum.datum.items[i].items,f=c.length,d=l.datum.fontSize,h=Tn.width(l.datum,l.datum.text);let g=n?d:0,p=!1,m=!1,y=0,b,x,v,w,S,_,E,A,k,$,T,M,D,C,R,W,V;for(let J=0;J<f;++J){for(b=c[J].x,v=c[J].y,x=c[J].x2===void 0?b:c[J].x2,w=c[J].y2===void 0?v:c[J].y2,b>x&&(V=b,b=x,x=V),v>w&&(V=v,v=w,w=V),k=e(b),T=e(x),$=~~((k+T)/2),M=e(v),C=e(w),D=~~((M+C)/2),E=$;E>=k;--E)for(A=D;A>=M;--A)W=u(E,A,g,h,d),W&&([l.x,l.y,g,p]=W);for(E=$;E<=T;++E)for(A=D;A<=C;++A)W=u(E,A,g,h,d),W&&([l.x,l.y,g,p]=W);!p&&!n&&(R=Math.abs(x-b+w-v),S=(b+x)/2,_=(v+w)/2,R>=y&&!ig(S,_,h,d,r,o)&&!vo(e,S,_,d,h,d,s,null)&&(y=R,l.x=S,l.y=_,m=!0))}return p||m?(S=h/2,_=d/2,s.setRange(e(l.x-S),e(l.y-_),e(l.x+S),e(l.y+_)),l.align="center",l.baseline="middle",!0):!1}}const yY=[-1,-1,1,1],bY=[-1,1,-1,1];function xY(e,t,n,i){const r=e.width,o=e.height,s=t[0],a=t[1],u=e.bitmap();return function(l){const c=l.datum.datum.items[i].items,f=c.length,d=l.datum.fontSize,h=Tn.width(l.datum,l.datum.text),g=[];let p=n?d:0,m=!1,y=!1,b=0,x,v,w,S,_,E,A,k,$,T,M,D;for(let C=0;C<f;++C){for(x=c[C].x,w=c[C].y,v=c[C].x2===void 0?x:c[C].x2,S=c[C].y2===void 0?w:c[C].y2,g.push([e((x+v)/2),e((w+S)/2)]);g.length;)if([A,k]=g.pop(),!(s.get(A,k)||a.get(A,k)||u.get(A,k))){u.set(A,k);for(let R=0;R<4;++R)_=A+yY[R],E=k+bY[R],u.outOfBounds(_,E,_,E)||g.push([_,E]);if(_=e.invert(A),E=e.invert(k),$=p,T=o,!ig(_,E,h,d,r,o)&&!vo(e,_,E,d,h,$,s,a)&&!vo(e,_,E,d,h,d,s,null)){for(;T-$>=1;)M=($+T)/2,vo(e,_,E,d,h,M,s,a)?T=M:$=M;$>p&&(l.x=_,l.y=E,p=$,m=!0)}}!m&&!n&&(D=Math.abs(v-x+S-w),_=(x+v)/2,E=(w+S)/2,D>=b&&!ig(_,E,h,d,r,o)&&!vo(e,_,E,d,h,d,s,null)&&(b=D,l.x=_,l.y=E,y=!0))}return m||y?(_=h/2,E=d/2,s.setRange(e(l.x-_),e(l.y-E),e(l.x+_),e(l.y+E)),l.align="center",l.baseline="middle",!0):!1}}const vY=["right","center","left"],wY=["bottom","middle","top"];function _Y(e,t,n,i){const r=e.width,o=e.height,s=t[0],a=t[1],u=i.length;return function(l){const c=l.boundary,f=l.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>r||c[3]>o)return!1;let d=l.textWidth??0,h,g,p,m,y,b,x,v,w,S,_,E,A,k,$;for(let T=0;T<u;++T){if(h=(n[T]&3)-1,g=(n[T]>>>2&3)-1,p=h===0&&g===0||i[T]<0,m=h&&g?Math.SQRT1_2:1,y=i[T]<0?-1:1,b=c[1+h]+i[T]*h*m,_=c[4+g]+y*f*g/2+i[T]*g*m,v=_-f/2,w=_+f/2,E=e(b),k=e(v),$=e(w),!d)if(Ek(E,E,k,$,s,a,b,b,v,w,c,p))d=Tn.width(l.datum,l.datum.text);else continue;if(S=b+y*d*h/2,b=S-d/2,x=S+d/2,E=e(b),A=e(x),Ek(E,A,k,$,s,a,b,x,v,w,c,p))return l.x=h?h*y<0?x:b:S,l.y=g?g*y<0?w:v:_,l.align=vY[h*y+1],l.baseline=wY[g*y+1],s.setRange(E,k,A,$),!0}return!1}}function Ek(e,t,n,i,r,o,s,a,u,l,c,f){return!(r.outOfBounds(e,n,t,i)||(f&&o||r).getRange(e,n,t,i))}const x0=0,v0=4,w0=8,_0=0,S0=1,E0=2,SY={"top-left":x0+_0,top:x0+S0,"top-right":x0+E0,left:v0+_0,middle:v0+S0,right:v0+E0,"bottom-left":w0+_0,bottom:w0+S0,"bottom-right":w0+E0},EY={naive:pY,"reduced-search":mY,floodfill:xY};function kY(e,t,n,i,r,o,s,a,u,l,c){if(!e.length)return e;const f=Math.max(i.length,r.length),d=$Y(i,f),h=AY(r,f),g=CY(e[0].datum),p=g==="group"&&e[0].datum.items[u].marktype,m=p==="area",y=MY(g,p,a,u),b=l===null||l===1/0,x=m&&c==="naive";let v=-1,w=-1;const S=e.map(k=>{const $=b?Tn.width(k,k.text):void 0;return v=Math.max(v,$),w=Math.max(w,k.fontSize),{datum:k,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(k),textWidth:$}});l=l===null||l===1/0?Math.max(v,w)+Math.max(...i):l;const _=gY(t[0],t[1],l);let E;if(!x){n&&S.sort((T,M)=>n(T.datum,M.datum));let k=!1;for(let T=0;T<h.length&&!k;++T)k=h[T]===5||d[T]<0;const $=(g&&s||m)&&e.map(T=>T.datum);E=o.length||$?fY(_,$||[],o,k,m):cY(_,s&&S)}const A=m?EY[c](_,E,s,u):_Y(_,E,h,d);return S.forEach(k=>k.opacity=+A(k)),S}function $Y(e,t){const n=new Float64Array(t),i=e.length;for(let r=0;r<i;++r)n[r]=e[r]||0;for(let r=i;r<t;++r)n[r]=n[i-1];return n}function AY(e,t){const n=new Int8Array(t),i=e.length;for(let r=0;r<i;++r)n[r]|=SY[e[r]];for(let r=i;r<t;++r)n[r]=n[i-1];return n}function CY(e){return e&&e.mark&&e.mark.marktype}function MY(e,t,n,i){const r=o=>[o.x,o.x,o.x,o.y,o.y,o.y];return e?e==="line"||e==="area"?o=>r(o.datum):t==="line"?o=>{const s=o.datum.items[i].items;return r(s.length?s[n==="start"?0:s.length-1]:{x:NaN,y:NaN})}:o=>{const s=o.datum.bounds;return[s.x1,(s.x1+s.x2)/2,s.x2,s.y1,(s.y1+s.y2)/2,s.y2]}:r}const Sy=["x","y","opacity","align","baseline"],LT=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function w2(e){F.call(this,null,e)}w2.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:LT},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:Sy.length,default:Sy}]};U(w2,F,{transform(e,t){function n(o){const s=e[o];return ue(s)&&t.modified(s.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&O("Size parameter should be specified as a [width, height] array.");const r=e.as||Sy;return kY(t.materialize(t.SOURCE).source||[],e.size,e.sort,H(e.offset==null?1:e.offset),H(e.anchor||LT),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding===void 0?0:e.padding,e.method||"naive").forEach(o=>{const s=o.datum;s[r[0]]=o.x,s[r[1]]=o.y,s[r[2]]=o.opacity,s[r[3]]=o.align,s[r[4]]=o.baseline}),t.reflow(i).modifies(r)}});const FY=Object.freeze(Object.defineProperty({__proto__:null,label:w2},Symbol.toStringTag,{value:"Module"}));function IT(e,t){var n=[],i=function(c){return c(a)},r,o,s,a,u,l;if(t==null)n.push(e);else for(r={},o=0,s=e.length;o<s;++o)a=e[o],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function _2(e){F.call(this,null,e)}_2.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};U(_2,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=IT(i,e.groupby),o=(e.groupby||[]).map(Ge),s=o.length,a=e.as||[Ge(e.x),Ge(e.y)],u=[];r.forEach(l=>{VM(l,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<s;++d)f[o[d]]=l.dims[d];f[a[0]]=c[0],f[a[1]]=c[1],u.push(Ee(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const Ey={constant:Qb,linear:Zb,log:WM,exp:HM,pow:GM,quad:ex,poly:YM},DY=(e,t)=>e==="poly"?t:e==="quad"?2:1;function S2(e){F.call(this,null,e)}S2.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Ey)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};U(S2,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=IT(i,e.groupby),o=(e.groupby||[]).map(Ge),s=e.method||"linear",a=e.order==null?3:e.order,u=DY(s,a),l=e.as||[Ge(e.x),Ge(e.y)],c=Ey[s],f=[];let d=e.extent;ne(Ey,s)||O("Invalid regression method: "+s),d!=null&&s==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach(h=>{if(h.length<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const p=c(h,e.x,e.y,a);if(e.params){f.push(Ee({keys:h.dims,coef:p.coef,rSquared:p.rSquared}));return}const m=d||Qi(h,e.x),y=b=>{const x={};for(let v=0;v<o.length;++v)x[o[v]]=h.dims[v];x[l[0]]=b[0],x[l[1]]=b[1],f.push(Ee(x))};s==="linear"||s==="constant"?m.forEach(b=>y([b,p.predict(b)])):Yg(p.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const TY=Object.freeze(Object.defineProperty({__proto__:null,loess:_2,regression:S2},Symbol.toStringTag,{value:"Module"})),zr=11102230246251565e-32,Mt=134217729,NY=(3+8*zr)*zr;function k0(e,t,n,i,r){let o,s,a,u,l=t[0],c=i[0],f=0,d=0;c>l==c>-l?(o=l,l=t[++f]):(o=c,c=i[++d]);let h=0;if(f<e&&d<n)for(c>l==c>-l?(s=l+o,a=o-(s-l),l=t[++f]):(s=c+o,a=o-(s-c),c=i[++d]),o=s,a!==0&&(r[h++]=a);f<e&&d<n;)c>l==c>-l?(s=o+l,u=s-o,a=o-(s-u)+(l-u),l=t[++f]):(s=o+c,u=s-o,a=o-(s-u)+(c-u),c=i[++d]),o=s,a!==0&&(r[h++]=a);for(;f<e;)s=o+l,u=s-o,a=o-(s-u)+(l-u),l=t[++f],o=s,a!==0&&(r[h++]=a);for(;d<n;)s=o+c,u=s-o,a=o-(s-u)+(c-u),c=i[++d],o=s,a!==0&&(r[h++]=a);return(o!==0||h===0)&&(r[h++]=o),h}function OY(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}function xf(e){return new Float64Array(e)}const RY=(3+16*zr)*zr,zY=(2+12*zr)*zr,PY=(9+64*zr)*zr*zr,Na=xf(4),kk=xf(8),$k=xf(12),Ak=xf(16),Gt=xf(4);function LY(e,t,n,i,r,o,s){let a,u,l,c,f,d,h,g,p,m,y,b,x,v,w,S,_,E;const A=e-r,k=n-r,$=t-o,T=i-o;v=A*T,d=Mt*A,h=d-(d-A),g=A-h,d=Mt*T,p=d-(d-T),m=T-p,w=g*m-(v-h*p-g*p-h*m),S=$*k,d=Mt*$,h=d-(d-$),g=$-h,d=Mt*k,p=d-(d-k),m=k-p,_=g*m-(S-h*p-g*p-h*m),y=w-_,f=w-y,Na[0]=w-(y+f)+(f-_),b=v+y,f=b-v,x=v-(b-f)+(y-f),y=x-S,f=x-y,Na[1]=x-(y+f)+(f-S),E=b+y,f=E-b,Na[2]=b-(E-f)+(y-f),Na[3]=E;let M=OY(4,Na),D=zY*s;if(M>=D||-M>=D||(f=e-A,a=e-(A+f)+(f-r),f=n-k,l=n-(k+f)+(f-r),f=t-$,u=t-($+f)+(f-o),f=i-T,c=i-(T+f)+(f-o),a===0&&u===0&&l===0&&c===0)||(D=PY*s+NY*Math.abs(M),M+=A*c+T*a-($*l+k*u),M>=D||-M>=D))return M;v=a*T,d=Mt*a,h=d-(d-a),g=a-h,d=Mt*T,p=d-(d-T),m=T-p,w=g*m-(v-h*p-g*p-h*m),S=u*k,d=Mt*u,h=d-(d-u),g=u-h,d=Mt*k,p=d-(d-k),m=k-p,_=g*m-(S-h*p-g*p-h*m),y=w-_,f=w-y,Gt[0]=w-(y+f)+(f-_),b=v+y,f=b-v,x=v-(b-f)+(y-f),y=x-S,f=x-y,Gt[1]=x-(y+f)+(f-S),E=b+y,f=E-b,Gt[2]=b-(E-f)+(y-f),Gt[3]=E;const C=k0(4,Na,4,Gt,kk);v=A*c,d=Mt*A,h=d-(d-A),g=A-h,d=Mt*c,p=d-(d-c),m=c-p,w=g*m-(v-h*p-g*p-h*m),S=$*l,d=Mt*$,h=d-(d-$),g=$-h,d=Mt*l,p=d-(d-l),m=l-p,_=g*m-(S-h*p-g*p-h*m),y=w-_,f=w-y,Gt[0]=w-(y+f)+(f-_),b=v+y,f=b-v,x=v-(b-f)+(y-f),y=x-S,f=x-y,Gt[1]=x-(y+f)+(f-S),E=b+y,f=E-b,Gt[2]=b-(E-f)+(y-f),Gt[3]=E;const R=k0(C,kk,4,Gt,$k);v=a*c,d=Mt*a,h=d-(d-a),g=a-h,d=Mt*c,p=d-(d-c),m=c-p,w=g*m-(v-h*p-g*p-h*m),S=u*l,d=Mt*u,h=d-(d-u),g=u-h,d=Mt*l,p=d-(d-l),m=l-p,_=g*m-(S-h*p-g*p-h*m),y=w-_,f=w-y,Gt[0]=w-(y+f)+(f-_),b=v+y,f=b-v,x=v-(b-f)+(y-f),y=x-S,f=x-y,Gt[1]=x-(y+f)+(f-S),E=b+y,f=E-b,Gt[2]=b-(E-f)+(y-f),Gt[3]=E;const W=k0(R,$k,4,Gt,Ak);return Ak[W-1]}function ld(e,t,n,i,r,o){const s=(t-o)*(n-r),a=(e-r)*(i-o),u=s-a,l=Math.abs(s+a);return Math.abs(u)>=RY*l?u:-LY(e,t,n,i,r,o,l)}const Ck=Math.pow(2,-52),cd=new Uint32Array(512);class rg{static from(t,n=qY,i=WY){const r=t.length,o=new Float64Array(r*2);for(let s=0;s<r;s++){const a=t[s];o[2*s]=n(a),o[2*s+1]=i(a)}return new rg(o)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:o}=this,s=t.length>>1;let a=1/0,u=1/0,l=-1/0,c=-1/0;for(let k=0;k<s;k++){const $=t[2*k],T=t[2*k+1];$<a&&(a=$),T<u&&(u=T),$>l&&(l=$),T>c&&(c=T),this._ids[k]=k}const f=(a+l)/2,d=(u+c)/2;let h=1/0,g,p,m;for(let k=0;k<s;k++){const $=$0(f,d,t[2*k],t[2*k+1]);$<h&&(g=k,h=$)}const y=t[2*g],b=t[2*g+1];h=1/0;for(let k=0;k<s;k++){if(k===g)continue;const $=$0(y,b,t[2*k],t[2*k+1]);$<h&&$>0&&(p=k,h=$)}let x=t[2*p],v=t[2*p+1],w=1/0;for(let k=0;k<s;k++){if(k===g||k===p)continue;const $=UY(y,b,x,v,t[2*k],t[2*k+1]);$<w&&(m=k,w=$)}let S=t[2*m],_=t[2*m+1];if(w===1/0){for(let T=0;T<s;T++)this._dists[T]=t[2*T]-t[0]||t[2*T+1]-t[1];Ga(this._ids,this._dists,0,s-1);const k=new Uint32Array(s);let $=0;for(let T=0,M=-1/0;T<s;T++){const D=this._ids[T];this._dists[D]>M&&(k[$++]=D,M=this._dists[D])}this.hull=k.subarray(0,$),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(ld(y,b,x,v,S,_)<0){const k=p,$=x,T=v;p=m,x=S,v=_,m=k,S=$,_=T}const E=jY(y,b,x,v,S,_);this._cx=E.x,this._cy=E.y;for(let k=0;k<s;k++)this._dists[k]=$0(t[2*k],t[2*k+1],E.x,E.y);Ga(this._ids,this._dists,0,s-1),this._hullStart=g;let A=3;i[g]=n[m]=p,i[p]=n[g]=m,i[m]=n[p]=g,r[g]=0,r[p]=1,r[m]=2,o.fill(-1),o[this._hashKey(y,b)]=g,o[this._hashKey(x,v)]=p,o[this._hashKey(S,_)]=m,this.trianglesLen=0,this._addTriangle(g,p,m,-1,-1,-1);for(let k=0,$,T;k<this._ids.length;k++){const M=this._ids[k],D=t[2*M],C=t[2*M+1];if(k>0&&Math.abs(D-$)<=Ck&&Math.abs(C-T)<=Ck||($=D,T=C,M===g||M===p||M===m))continue;let R=0;for(let Be=0,Ze=this._hashKey(D,C);Be<this._hashSize&&(R=o[(Ze+Be)%this._hashSize],!(R!==-1&&R!==i[R]));Be++);R=n[R];let W=R,V;for(;V=i[W],ld(D,C,t[2*W],t[2*W+1],t[2*V],t[2*V+1])>=0;)if(W=V,W===R){W=-1;break}if(W===-1)continue;let J=this._addTriangle(W,M,i[W],-1,-1,r[W]);r[M]=this._legalize(J+2),r[W]=J,A++;let he=i[W];for(;V=i[he],ld(D,C,t[2*he],t[2*he+1],t[2*V],t[2*V+1])<0;)J=this._addTriangle(he,M,V,r[M],-1,r[he]),r[M]=this._legalize(J+2),i[he]=he,A--,he=V;if(W===R)for(;V=n[W],ld(D,C,t[2*V],t[2*V+1],t[2*W],t[2*W+1])<0;)J=this._addTriangle(V,M,W,-1,r[W],r[V]),this._legalize(J+2),r[V]=J,i[W]=W,A--,W=V;this._hullStart=n[M]=W,i[W]=n[he]=M,i[M]=he,o[this._hashKey(D,C)]=M,o[this._hashKey(t[2*W],t[2*W+1])]=W}this.hull=new Uint32Array(A);for(let k=0,$=this._hullStart;k<A;k++)this.hull[k]=$,$=i[$];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(IY(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let o=0,s=0;for(;;){const a=i[t],u=t-t%3;if(s=u+(t+2)%3,a===-1){if(o===0)break;t=cd[--o];continue}const l=a-a%3,c=u+(t+1)%3,f=l+(a+2)%3,d=n[s],h=n[t],g=n[c],p=n[f];if(BY(r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*g],r[2*g+1],r[2*p],r[2*p+1])){n[t]=p,n[a]=d;const y=i[f];if(y===-1){let x=this._hullStart;do{if(this._hullTri[x]===f){this._hullTri[x]=t;break}x=this._hullPrev[x]}while(x!==this._hullStart)}this._link(t,y),this._link(a,i[s]),this._link(s,f);const b=l+(a+1)%3;o<cd.length&&(cd[o++]=b)}else{if(o===0)break;t=cd[--o]}}return s}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,o,s){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,o),this._link(a+2,s),this.trianglesLen+=3,a}}function IY(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function $0(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}function BY(e,t,n,i,r,o,s,a){const u=e-s,l=t-a,c=n-s,f=i-a,d=r-s,h=o-a,g=u*u+l*l,p=c*c+f*f,m=d*d+h*h;return u*(f*m-p*h)-l*(c*m-p*d)+g*(c*h-f*d)<0}function UY(e,t,n,i,r,o){const s=n-e,a=i-t,u=r-e,l=o-t,c=s*s+a*a,f=u*u+l*l,d=.5/(s*l-a*u),h=(l*c-a*f)*d,g=(s*f-u*c)*d;return h*h+g*g}function jY(e,t,n,i,r,o){const s=n-e,a=i-t,u=r-e,l=o-t,c=s*s+a*a,f=u*u+l*l,d=.5/(s*l-a*u),h=e+(l*c-a*f)*d,g=t+(s*f-u*c)*d;return{x:h,y:g}}function Ga(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const o=e[r],s=t[o];let a=r-1;for(;a>=n&&t[e[a]]>s;)e[a+1]=e[a--];e[a+1]=o}else{const r=n+i>>1;let o=n+1,s=i;vl(e,r,o),t[e[n]]>t[e[i]]&&vl(e,n,i),t[e[o]]>t[e[i]]&&vl(e,o,i),t[e[n]]>t[e[o]]&&vl(e,n,o);const a=e[o],u=t[a];for(;;){do o++;while(t[e[o]]<u);do s--;while(t[e[s]]>u);if(s<o)break;vl(e,o,s)}e[n+1]=e[s],e[s]=a,i-o+1>=s-n?(Ga(e,t,o,i),Ga(e,t,n,s-1)):(Ga(e,t,n,s-1),Ga(e,t,o,i))}}function vl(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function qY(e){return e[0]}function WY(e){return e[1]}const Mk=1e-6;class Fs{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const r=t+i,o=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${o}`:(Math.abs(this._x1-r)>Mk||Math.abs(this._y1-o)>Mk)&&(this._+="L"+r+","+o),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=o}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class ky{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}let HY=class{constructor(t,[n,i,r,o]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=o,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this;let o,s;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let p=0,m=0,y=i.length,b,x;p<y;p+=3,m+=2){const v=i[p]*2,w=i[p+1]*2,S=i[p+2]*2,_=t[v],E=t[v+1],A=t[w],k=t[w+1],$=t[S],T=t[S+1],M=A-_,D=k-E,C=$-_,R=T-E,W=(M*R-D*C)*2;if(Math.abs(W)<1e-9){if(o===void 0){o=s=0;for(const J of n)o+=t[J*2],s+=t[J*2+1];o/=n.length,s/=n.length}const V=1e9*Math.sign((o-_)*R-(s-E)*C);b=(_+$)/2-V*R,x=(E+T)/2+V*C}else{const V=1/W,J=M*M+D*D,he=C*C+R*R;b=_+(R*J-D*he)*V,x=E+(M*he-C*J)*V}a[m]=b,a[m+1]=x}let u=n[n.length-1],l,c=u*4,f,d=t[2*u],h,g=t[2*u+1];r.fill(0);for(let p=0;p<n.length;++p)u=n[p],l=c,f=d,h=g,c=u*4,d=t[2*u],g=t[2*u+1],r[l+2]=r[c]=h-g,r[l+3]=r[c+1]=d-f}render(t){const n=t==null?t=new Fs:void 0,{delaunay:{halfedges:i,inedges:r,hull:o},circumcenters:s,vectors:a}=this;if(o.length<=1)return null;for(let c=0,f=i.length;c<f;++c){const d=i[c];if(d<c)continue;const h=Math.floor(c/3)*2,g=Math.floor(d/3)*2,p=s[h],m=s[h+1],y=s[g],b=s[g+1];this._renderSegment(p,m,y,b,t)}let u,l=o[o.length-1];for(let c=0;c<o.length;++c){u=l,l=o[c];const f=Math.floor(r[l]/3)*2,d=s[f],h=s[f+1],g=u*4,p=this._project(d,h,a[g+2],a[g+3]);p&&this._renderSegment(d,h,p[0],p[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Fs:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new Fs:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let o=r.length;for(;r[0]===r[o-2]&&r[1]===r[o-1]&&o>1;)o-=2;for(let s=2;s<o;s+=2)(r[s]!==r[s-2]||r[s+1]!==r[s-1])&&n.lineTo(r[s],r[s+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new ky;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,o){let s;const a=this._regioncode(t,n),u=this._regioncode(i,r);a===0&&u===0?(o.moveTo(t,n),o.lineTo(i,r)):(s=this._clipSegment(t,n,i,r,a,u))&&(o.moveTo(s[0],s[1]),o.lineTo(s[2],s[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r){e:for(let o=0,s=n.length;o<s;o+=2)for(let a=0,u=r.length;a<u;a+=2)if(n[o]===r[a]&&n[o+1]===r[a+1]&&n[(o+2)%s]===r[(a+u-2)%u]&&n[(o+3)%s]===r[(a+u-1)%u]){yield i;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:o}}=this,s=i[t];if(s===-1)return null;const a=[];let u=s;do{const l=Math.floor(u/3);if(a.push(n[l*2],n[l*2+1]),u=u%3===2?u-2:u+1,o[u]!==t)break;u=r[u]}while(u!==s&&u!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,r=t*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n))}_clipFinite(t,n){const i=n.length;let r=null,o,s,a=n[i-2],u=n[i-1],l,c=this._regioncode(a,u),f,d=0;for(let h=0;h<i;h+=2)if(o=a,s=u,a=n[h],u=n[h+1],l=c,c=this._regioncode(a,u),l===0&&c===0)f=d,d=0,r?r.push(a,u):r=[a,u];else{let g,p,m,y,b;if(l===0){if((g=this._clipSegment(o,s,a,u,l,c))===null)continue;[p,m,y,b]=g}else{if((g=this._clipSegment(a,u,o,s,c,l))===null)continue;[y,b,p,m]=g,f=d,d=this._edgecode(p,m),f&&d&&this._edge(t,f,d,r,r.length),r?r.push(p,m):r=[p,m]}f=d,d=this._edgecode(y,b),f&&d&&this._edge(t,f,d,r,r.length),r?r.push(y,b):r=[y,b]}if(r)f=d,d=this._edgecode(r[0],r[1]),f&&d&&this._edge(t,f,d,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,o,s){const a=o<s;for(a&&([t,n,i,r,o,s]=[i,r,t,n,s,o]);;){if(o===0&&s===0)return a?[i,r,t,n]:[t,n,i,r];if(o&s)return null;let u,l,c=o||s;c&8?(u=t+(i-t)*(this.ymax-n)/(r-n),l=this.ymax):c&4?(u=t+(i-t)*(this.ymin-n)/(r-n),l=this.ymin):c&2?(l=n+(r-n)*(this.xmax-t)/(i-t),u=this.xmax):(l=n+(r-n)*(this.xmin-t)/(i-t),u=this.xmin),o?(t=u,n=l,o=this._regioncode(t,n)):(i=u,r=l,s=this._regioncode(i,r))}}_clipInfinite(t,n,i,r,o,s){let a=Array.from(n),u;if((u=this._project(a[0],a[1],i,r))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],o,s))&&a.push(u[0],u[1]),a=this._clipFinite(t,a))for(let l=0,c=a.length,f,d=this._edgecode(a[c-2],a[c-1]);l<c;l+=2)f=d,d=this._edgecode(a[l],a[l+1]),f&&d&&(l=this._edge(t,f,d,a,l),c=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,i,r,o){for(;n!==i;){let s,a;switch(n){case 5:n=4;continue;case 4:n=6,s=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,s=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,s=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,s=this.xmin,a=this.ymin;break}(r[o]!==s||r[o+1]!==a)&&this.contains(t,s,a)&&(r.splice(o,0,s,a),o+=2)}return o}_project(t,n,i,r){let o=1/0,s,a,u;if(r<0){if(n<=this.ymin)return null;(s=(this.ymin-n)/r)<o&&(u=this.ymin,a=t+(o=s)*i)}else if(r>0){if(n>=this.ymax)return null;(s=(this.ymax-n)/r)<o&&(u=this.ymax,a=t+(o=s)*i)}if(i>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/i)<o&&(a=this.xmax,u=n+(o=s)*r)}else if(i<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/i)<o&&(a=this.xmin,u=n+(o=s)*r)}return[a,u]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const i=(n+2)%t.length,r=(n+4)%t.length;(t[n]===t[i]&&t[i]===t[r]||t[n+1]===t[i+1]&&t[i+1]===t[r+1])&&(t.splice(i,2),n-=2)}t.length||(t=null)}return t}};const GY=2*Math.PI,Oa=Math.pow;function YY(e){return e[0]}function VY(e){return e[1]}function XY(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],o=2*t[i+1],s=2*t[i+2];if((n[s]-n[r])*(n[o+1]-n[r+1])-(n[o]-n[r])*(n[s+1]-n[r+1])>1e-10)return!1}return!0}function KY(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class E2{static from(t,n=YY,i=VY,r){return new E2("length"in t?JY(t,n,i,r):Float64Array.from(QY(t,n,i,r)))}constructor(t){this._delaunator=new rg(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&XY(t)){this.collinear=Int32Array.from({length:n.length/2},(d,h)=>h).sort((d,h)=>n[2*d]-n[2*h]||n[2*d+1]-n[2*h+1]);const u=this.collinear[0],l=this.collinear[this.collinear.length-1],c=[n[2*u],n[2*u+1],n[2*l],n[2*l+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let d=0,h=n.length/2;d<h;++d){const g=KY(n[2*d],n[2*d+1],f);n[2*d]=g[0],n[2*d+1]=g[1]}this._delaunator=new rg(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,l=i.length;u<l;++u){const c=o[u%3===2?u-2:u+1];(i[u]===-1||s[c]===-1)&&(s[c]=u)}for(let u=0,l=r.length;u<l;++u)a[r[u]]=u;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],s[r[0]]=1,r.length===2&&(s[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new HY(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:o,triangles:s,collinear:a}=this;if(a){const f=a.indexOf(t);f>0&&(yield a[f-1]),f<a.length-1&&(yield a[f+1]);return}const u=n[t];if(u===-1)return;let l=u,c=-1;do{if(yield c=s[l],l=l%3===2?l-2:l+1,s[l]!==t)return;if(l=o[l],l===-1){const f=i[(r[t]+1)%i.length];f!==c&&(yield f);return}}while(l!==u)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=i;let o;for(;(o=this._step(i,t,n))>=0&&o!==i&&o!==r;)i=o;return o}_step(t,n,i){const{inedges:r,hull:o,_hullIndex:s,halfedges:a,triangles:u,points:l}=this;if(r[t]===-1||!l.length)return(t+1)%(l.length>>1);let c=t,f=Oa(n-l[t*2],2)+Oa(i-l[t*2+1],2);const d=r[t];let h=d;do{let g=u[h];const p=Oa(n-l[g*2],2)+Oa(i-l[g*2+1],2);if(p<f&&(f=p,c=g),h=h%3===2?h-2:h+1,u[h]!==t)break;if(h=a[h],h===-1){if(h=o[(s[t]+1)%o.length],h!==g&&Oa(n-l[h*2],2)+Oa(i-l[h*2+1],2)<f)return h;break}}while(h!==d);return c}render(t){const n=t==null?t=new Fs:void 0,{points:i,halfedges:r,triangles:o}=this;for(let s=0,a=r.length;s<a;++s){const u=r[s];if(u<s)continue;const l=o[s]*2,c=o[u]*2;t.moveTo(i[l],i[l+1]),t.lineTo(i[c],i[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const i=t==null?t=new Fs:void 0,{points:r}=this;for(let o=0,s=r.length;o<s;o+=2){const a=r[o],u=r[o+1];t.moveTo(a+n,u),t.arc(a,u,n,0,GY)}return i&&i.value()}renderHull(t){const n=t==null?t=new Fs:void 0,{hull:i,points:r}=this,o=i[0]*2,s=i.length;t.moveTo(r[o],r[o+1]);for(let a=1;a<s;++a){const u=2*i[a];t.lineTo(r[u],r[u+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new ky;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new Fs:void 0,{points:r,triangles:o}=this,s=o[t*=3]*2,a=o[t+1]*2,u=o[t+2]*2;return n.moveTo(r[s],r[s+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[u],r[u+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new ky;return this.renderTriangle(t,n),n.value()}}function JY(e,t,n,i){const r=e.length,o=new Float64Array(r*2);for(let s=0;s<r;++s){const a=e[s];o[s*2]=t.call(i,a,s,e),o[s*2+1]=n.call(i,a,s,e)}return o}function*QY(e,t,n,i){let r=0;for(const o of e)yield t.call(i,o,r,e),yield n.call(i,o,r,e),++r}function k2(e){F.call(this,null,e)}k2.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const ZY=[-1e5,-1e5,1e5,1e5];U(k2,F,{transform(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:ZY;const o=this.value=E2.from(i,e.x,e.y).voronoi(r);for(let s=0,a=i.length;s<a;++s){const u=o.cellPolygon(s);i[s][n]=u&&!tV(u)?eV(u):null}return t.reflow(e.modified()).modifies(n)}});function eV(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}function tV(e){return e.length===2&&e[0][0]===e[1][0]&&e[0][1]===e[1][1]}const nV=Object.freeze(Object.defineProperty({__proto__:null,voronoi:k2},Symbol.toStringTag,{value:"Module"}));var A0=Math.PI/180,Kl=64,Bd=2048;function iV(){var e=[256,256],t,n,i,r,o,s,a,u=BT,l=[],c=Math.random,f={};f.layout=function(){for(var g=d(ko()),p=lV((e[0]>>5)*e[1]),m=null,y=l.length,b=-1,x=[],v=l.map(S=>({text:t(S),font:n(S),style:r(S),weight:o(S),rotate:s(S),size:~~(i(S)+1e-14),padding:a(S),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:S})).sort((S,_)=>_.size-S.size);++b<y;){var w=v[b];w.x=e[0]*(c()+.5)>>1,w.y=e[1]*(c()+.5)>>1,rV(g,w,v,b),w.hasText&&h(p,w,m)&&(x.push(w),m?sV(m,w):m=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=e[0]>>1,w.y-=e[1]>>1)}return x};function d(g){g.width=g.height=1;var p=Math.sqrt(g.getContext("2d").getImageData(0,0,1,1).data.length>>2);g.width=(Kl<<5)/p,g.height=Bd/p;var m=g.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:p}}function h(g,p,m){for(var y=p.x,b=p.y,x=Math.sqrt(e[0]*e[0]+e[1]*e[1]),v=u(e),w=c()<.5?1:-1,S=-w,_,E,A;(_=v(S+=w))&&(E=~~_[0],A=~~_[1],!(Math.min(Math.abs(E),Math.abs(A))>=x));)if(p.x=y+E,p.y=b+A,!(p.x+p.x0<0||p.y+p.y0<0||p.x+p.x1>e[0]||p.y+p.y1>e[1])&&(!m||!oV(p,g,e[0]))&&(!m||aV(p,m))){for(var k=p.sprite,$=p.width>>5,T=e[0]>>5,M=p.x-($<<4),D=M&127,C=32-D,R=p.y1-p.y0,W=(p.y+p.y0)*T+(M>>5),V,J=0;J<R;J++){V=0;for(var he=0;he<=$;he++)g[W+he]|=V<<C|(he<$?(V=k[J*$+he])>>>D:0);W+=T}return p.sprite=null,!0}return!1}return f.words=function(g){return arguments.length?(l=g,f):l},f.size=function(g){return arguments.length?(e=[+g[0],+g[1]],f):e},f.font=function(g){return arguments.length?(n=cs(g),f):n},f.fontStyle=function(g){return arguments.length?(r=cs(g),f):r},f.fontWeight=function(g){return arguments.length?(o=cs(g),f):o},f.rotate=function(g){return arguments.length?(s=cs(g),f):s},f.text=function(g){return arguments.length?(t=cs(g),f):t},f.spiral=function(g){return arguments.length?(u=cV[g]||g,f):u},f.fontSize=function(g){return arguments.length?(i=cs(g),f):i},f.padding=function(g){return arguments.length?(a=cs(g),f):a},f.random=function(g){return arguments.length?(c=g,f):c},f}function rV(e,t,n,i){if(!t.sprite){var r=e.context,o=e.ratio;r.clearRect(0,0,(Kl<<5)/o,Bd/o);var s=0,a=0,u=0,l=n.length,c,f,d,h,g;for(--i;++i<l;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/o)+"px "+t.font,c=r.measureText(t.text+"m").width*o,d=t.size<<1,t.rotate){var p=Math.sin(t.rotate*A0),m=Math.cos(t.rotate*A0),y=c*m,b=c*p,x=d*m,v=d*p;c=Math.max(Math.abs(y+v),Math.abs(y-v))+31>>5<<5,d=~~Math.max(Math.abs(b+x),Math.abs(b-x))}else c=c+31>>5<<5;if(d>u&&(u=d),s+c>=Kl<<5&&(s=0,a+=u,u=0),a+d>=Bd)break;r.translate((s+(c>>1))/o,(a+(d>>1))/o),t.rotate&&r.rotate(t.rotate*A0),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=d,t.xoff=s,t.yoff=a,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,s+=c}for(var w=r.getImageData(0,0,(Kl<<5)/o,Bd/o).data,S=[];--i>=0;)if(t=n[i],!!t.hasText){for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)S[h]=0;if(s=t.xoff,s==null)return;a=t.yoff;var _=0,E=-1;for(g=0;g<d;g++){for(h=0;h<c;h++){var A=f*g+(h>>5),k=w[(a+g)*(Kl<<5)+(s+h)<<2]?1<<31-h%32:0;S[A]|=k,_|=k}_?E=g:(t.y0++,d--,g--,a++)}t.y1=t.y0+E,t.sprite=S.slice(0,(t.y1-t.y0)*f)}}}function oV(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,o=e.x-(r<<4),s=o&127,a=32-s,u=e.y1-e.y0,l=(e.y+e.y0)*n+(o>>5),c,f=0;f<u;f++){c=0;for(var d=0;d<=r;d++)if((c<<a|(d<r?(c=i[f*r+d])>>>s:0))&t[l+d])return!0;l+=n}return!1}function sV(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function aV(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function BT(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function uV(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(o){var s=o<0?-1:1;switch(Math.sqrt(1+4*s*o)-s&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function lV(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function cs(e){return typeof e=="function"?e:function(){return e}}var cV={archimedean:BT,rectangular:uV};const UT=["x","y","font","fontSize","fontStyle","fontWeight","angle"],fV=["text","font","rotate","fontSize","fontStyle","fontWeight"];function $2(e){F.call(this,iV(),e)}$2.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:UT}]};U($2,F,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&O("Wordcloud size dimensions must be non-zero.");function n(g){const p=e[g];return ue(p)&&t.modified(p.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||fV.some(n)))return;const r=t.materialize(t.SOURCE).source,o=this.value,s=e.as||UT;let a=e.fontSize||14,u;if(ue(a)?u=e.fontSizeRange:a=jt(a),u){const g=a,p=_e("sqrt")().domain(Qi(r,g)).range(u);a=m=>p(g(m))}r.forEach(g=>{g[s[0]]=NaN,g[s[1]]=NaN,g[s[3]]=0});const l=o.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(a).random(Zn).layout(),c=o.size(),f=c[0]>>1,d=c[1]>>1,h=l.length;for(let g=0,p,m;g<h;++g)p=l[g],m=p.datum,m[s[0]]=p.x+f,m[s[1]]=p.y+d,m[s[2]]=p.font,m[s[3]]=p.size,m[s[4]]=p.style,m[s[5]]=p.weight,m[s[6]]=p.rotate;return t.reflow(i).modifies(s)}});const dV=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:$2},Symbol.toStringTag,{value:"Module"})),hV=e=>new Uint8Array(e),gV=e=>new Uint16Array(e),uc=e=>new Uint32Array(e);function pV(){let e=8,t=[],n=uc(0),i=fd(0,e),r=fd(0,e);return{data:()=>t,seen:()=>n=mV(n,t.length),add(o){for(let s=0,a=t.length,u=o.length,l;s<u;++s)l=o[s],l._index=a++,t.push(l)},remove(o,s){const a=t.length,u=Array(a-o),l=t;let c,f,d;for(f=0;!s[f]&&f<a;++f)u[f]=t[f],l[f]=f;for(d=f;f<a;++f)c=t[f],s[f]?l[f]=-1:(l[f]=d,i[d]=i[f],r[d]=r[f],u[d]=c,c._index=d++),i[f]=0;return t=u,l},size:()=>t.length,curr:()=>i,prev:()=>r,reset:o=>r[o]=i[o],all:()=>e<257?255:e<65537?65535:4294967295,set(o,s){i[o]|=s},clear(o,s){i[o]&=~s},resize(o,s){const a=i.length;(o>a||s>e)&&(e=Math.max(s,e),i=fd(o,e,i),r=fd(o,e))}}}function mV(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function fd(e,t,n){const i=(t<257?hV:t<65537?gV:uc)(e);return n&&i.set(n),i}function Fk(e,t,n){const i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(r,o){const s=this,a=s.bisect(s.range,r.value),u=r.index,l=a[0],c=a[1],f=u.length;let d;for(d=0;d<l;++d)o[u[d]]|=i;for(d=c;d<f;++d)o[u[d]]|=i;return s}}}function Dk(){let e=uc(0),t=[],n=0;function i(a,u,l){if(!u.length)return[];const c=n,f=u.length,d=uc(f);let h=Array(f),g,p,m;for(m=0;m<f;++m)h[m]=a(u[m]),d[m]=m;if(h=yV(h,d),c)g=t,p=e,t=Array(c+f),e=uc(c+f),bV(l,g,p,c,h,d,f,t,e);else{if(l>0)for(m=0;m<f;++m)d[m]+=l;t=h,e=d}return n=c+f,{index:d,value:h}}function r(a,u){const l=n;let c,f,d;for(f=0;!u[e[f]]&&f<l;++f);for(d=f;f<l;++f)u[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=l-a}function o(a){for(let u=0,l=n;u<l;++u)e[u]=a[e[u]]}function s(a,u){let l;return u?l=u.length:(u=t,l=n),[b8(u,a[0],0,l),Co(u,a[1],0,l)]}return{insert:i,remove:r,bisect:s,reindex:o,index:()=>e,size:()=>n}}function yV(e,t){return e.sort.call(t,(n,i)=>{const r=e[n],o=e[i];return r<o?-1:r>o?1:0}),w8(e,t)}function bV(e,t,n,i,r,o,s,a,u){let l=0,c=0,f;for(f=0;l<i&&c<s;++f)t[l]<r[c]?(a[f]=t[l],u[f]=n[l++]):(a[f]=r[c],u[f]=o[c++]+e);for(;l<i;++l,++f)a[f]=t[l],u[f]=n[l];for(;c<s;++c,++f)a[f]=r[c],u[f]=o[c]+e}function A2(e){F.call(this,pV(),e),this._indices=null,this._dims=null}A2.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};U(A2,F,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(i=>t.modified(i.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,i=e.query,r=this._indices={},o=this._dims=[],s=i.length;let a=0,u,l;for(;a<s;++a)u=n[a].fname,l=r[u]||(r[u]=Dk()),o.push(Fk(l,a,i[a]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),i=e.fields,r=e.query,o=this._indices,s=this._dims,a=this.value,u=a.curr(),l=a.prev(),c=a.all(),f=n.rem=n.add,d=n.mod,h=r.length,g={};let p,m,y,b,x,v,w,S,_;if(l.set(u),t.rem.length&&(x=this.remove(e,t,n)),t.add.length&&a.add(t.add),t.mod.length)for(v={},b=t.mod,w=0,S=b.length;w<S;++w)v[b[w]._index]=1;for(w=0;w<h;++w)_=i[w],(!s[w]||e.modified("fields",w)||t.modified(_.fields))&&(y=_.fname,(p=g[y])||(o[y]=m=Dk(),g[y]=p=m.insert(_,t.source,0)),s[w]=Fk(m,w,r[w]).onAdd(p,u));for(w=0,S=a.data().length;w<S;++w)x[w]||(l[w]!==u[w]?f.push(w):v[w]&&u[w]!==c&&d.push(w));return a.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),i=this._dims.length;let r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},insert(e,t,n){const i=t.add,r=this.value,o=this._dims,s=this._indices,a=e.fields,u={},l=n.add,c=r.size()+i.length,f=o.length;let d=r.size(),h,g,p;r.resize(c,f),r.add(i);const m=r.curr(),y=r.prev(),b=r.all();for(h=0;h<f;++h)g=a[h].fname,p=u[g]||(u[g]=s[g].insert(a[h],i,d)),o[h].onAdd(p,m);for(;d<c;++d)y[d]=b,m[d]!==b&&l.push(d)},modify(e,t){const n=t.mod,i=this.value,r=i.curr(),o=i.all(),s=e.mod;let a,u,l;for(a=0,u=s.length;a<u;++a)l=s[a]._index,r[l]!==o&&n.push(l)},remove(e,t,n){const i=this._indices,r=this.value,o=r.curr(),s=r.prev(),a=r.all(),u={},l=n.rem,c=t.rem;let f,d,h,g;for(f=0,d=c.length;f<d;++f)h=c[f]._index,u[h]=1,s[h]=g=o[h],o[h]=a,g!==a&&l.push(h);for(h in i)i[h].remove(d,u);return this.reindex(t,d,u),u},reindex(e,t,n){const i=this._indices,r=this.value;e.runAfter(()=>{const o=r.remove(t,n);for(const s in i)i[s].reindex(o)})},update(e,t,n){const i=this._dims,r=e.query,o=t.stamp,s=i.length;let a=0,u,l;for(n.filters=0,l=0;l<s;++l)e.modified("query",l)&&(u=l,++a);if(a===1)a=i[u].one,this.incrementOne(i[u],r[u],n.add,n.rem);else for(l=0,a=0;l<s;++l)e.modified("query",l)&&(a|=i[l].one,this.incrementAll(i[l],r[l],o,n.add),n.rem=n.add);return a},incrementAll(e,t,n,i){const r=this.value,o=r.seen(),s=r.curr(),a=r.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=l[0],g=l[1],p=e.one;let m,y,b;if(f<h)for(m=f,y=Math.min(h,d);m<y;++m)b=u[m],o[b]!==n&&(a[b]=s[b],o[b]=n,i.push(b)),s[b]^=p;else if(f>h)for(m=h,y=Math.min(f,g);m<y;++m)b=u[m],o[b]!==n&&(a[b]=s[b],o[b]=n,i.push(b)),s[b]^=p;if(d>g)for(m=Math.max(f,g),y=d;m<y;++m)b=u[m],o[b]!==n&&(a[b]=s[b],o[b]=n,i.push(b)),s[b]^=p;else if(d<g)for(m=Math.max(h,d),y=g;m<y;++m)b=u[m],o[b]!==n&&(a[b]=s[b],o[b]=n,i.push(b)),s[b]^=p;e.range=t.slice()},incrementOne(e,t,n,i){const r=this.value,o=r.curr(),s=e.index(),a=e.bisect(e.range),u=e.bisect(t),l=u[0],c=u[1],f=a[0],d=a[1],h=e.one;let g,p,m;if(l<f)for(g=l,p=Math.min(f,c);g<p;++g)m=s[g],o[m]^=h,n.push(m);else if(l>f)for(g=f,p=Math.min(l,d);g<p;++g)m=s[g],o[m]^=h,i.push(m);if(c>d)for(g=Math.max(l,d),p=c;g<p;++g)m=s[g],o[m]^=h,n.push(m);else if(c<d)for(g=Math.max(f,c),p=d;g<p;++g)m=s[g],o[m]^=h,i.push(m);e.range=t.slice()}});function C2(e){F.call(this,null,e)}C2.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};U(C2,F,{transform(e,t){const n=~(e.ignore||0),i=e.filter,r=i.mask;if(!(r&n))return t.StopPropagation;const o=t.fork(t.ALL),s=i.data(),a=i.curr(),u=i.prev(),l=c=>a[c]&n?null:s[c];return o.filter(o.MOD,l),r&r-1?(o.filter(o.ADD,c=>{const f=a[c]&n;return!f&&f^u[c]&n?s[c]:null}),o.filter(o.REM,c=>{const f=a[c]&n;return f&&!(f^(f^u[c]&n))?s[c]:null})):(o.filter(o.ADD,l),o.filter(o.REM,c=>(a[c]&n)===r?s[c]:null)),o.filter(o.SOURCE,c=>l(c._index))}});const xV=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:A2,resolvefilter:C2},Symbol.toStringTag,{value:"Module"})),vV="RawCode",Vs="Literal",wV="Property",_V="Identifier",SV="ArrayExpression",EV="BinaryExpression",jT="CallExpression",kV="ConditionalExpression",$V="LogicalExpression",AV="MemberExpression",CV="ObjectExpression",MV="UnaryExpression";function Ci(e){this.type=e}Ci.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=FV(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};function FV(e){switch(e.type){case SV:return e.elements;case EV:case $V:return[e.left,e.right];case jT:return[e.callee].concat(e.arguments);case kV:return[e.test,e.consequent,e.alternate];case AV:return[e.object,e.property];case CV:return e.properties;case wV:return[e.key,e.value];case MV:return[e.argument];case _V:case Vs:case vV:default:return[]}}var fr,K,N,It,Ae,Ap=1,vf=2,Xs=3,Jo=4,Cp=5,pa=6,cn=7,wf=8,DV=9;fr={};fr[Ap]="Boolean";fr[vf]="<end>";fr[Xs]="Identifier";fr[Jo]="Keyword";fr[Cp]="Null";fr[pa]="Numeric";fr[cn]="Punctuator";fr[wf]="String";fr[DV]="RegularExpression";var TV="ArrayExpression",NV="BinaryExpression",OV="CallExpression",RV="ConditionalExpression",qT="Identifier",zV="Literal",PV="LogicalExpression",LV="MemberExpression",IV="ObjectExpression",BV="Property",UV="UnaryExpression",dt="Unexpected token %0",jV="Unexpected number",qV="Unexpected string",WV="Unexpected identifier",HV="Unexpected reserved word",GV="Unexpected end of input",$y="Invalid regular expression",C0="Invalid regular expression: missing /",WT="Octal literals are not allowed in strict mode.",YV="Duplicate data property in object literal not allowed in strict mode",_t="ILLEGAL",Rc="Disabled.",VV=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),XV=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Mp(e,t){if(!e)throw new Error("ASSERT: "+t)}function kr(e){return e>=48&&e<=57}function M2(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function lc(e){return"01234567".indexOf(e)>=0}function KV(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function zc(e){return e===10||e===13||e===8232||e===8233}function _f(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&VV.test(String.fromCharCode(e))}function og(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&XV.test(String.fromCharCode(e))}const JV={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function HT(){for(;N<It;){const e=K.charCodeAt(N);if(KV(e)||zc(e))++N;else break}}function Ay(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)N<It&&M2(K[N])?(i=K[N++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):ve({},dt,_t);return String.fromCharCode(r)}function QV(){var e,t,n,i;for(e=K[N],t=0,e==="}"&&ve({},dt,_t);N<It&&(e=K[N++],!!M2(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&ve({},dt,_t),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function GT(){var e,t;for(e=K.charCodeAt(N++),t=String.fromCharCode(e),e===92&&(K.charCodeAt(N)!==117&&ve({},dt,_t),++N,e=Ay("u"),(!e||e==="\\"||!_f(e.charCodeAt(0)))&&ve({},dt,_t),t=e);N<It&&(e=K.charCodeAt(N),!!og(e));)++N,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),K.charCodeAt(N)!==117&&ve({},dt,_t),++N,e=Ay("u"),(!e||e==="\\"||!og(e.charCodeAt(0)))&&ve({},dt,_t),t+=e);return t}function ZV(){var e,t;for(e=N++;N<It;){if(t=K.charCodeAt(N),t===92)return N=e,GT();if(og(t))++N;else break}return K.slice(e,N)}function eX(){var e,t,n;return e=N,t=K.charCodeAt(N)===92?GT():ZV(),t.length===1?n=Xs:JV.hasOwnProperty(t)?n=Jo:t==="null"?n=Cp:t==="true"||t==="false"?n=Ap:n=Xs,{type:n,value:t,start:e,end:N}}function M0(){var e=N,t=K.charCodeAt(N),n,i=K[N],r,o,s;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++N,{type:cn,value:String.fromCharCode(t),start:e,end:N};default:if(n=K.charCodeAt(N+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return N+=2,{type:cn,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:N};case 33:case 61:return N+=2,K.charCodeAt(N)===61&&++N,{type:cn,value:K.slice(e,N),start:e,end:N}}}if(s=K.substr(N,4),s===">>>=")return N+=4,{type:cn,value:s,start:e,end:N};if(o=s.substr(0,3),o===">>>"||o==="<<="||o===">>=")return N+=3,{type:cn,value:o,start:e,end:N};if(r=o.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return N+=2,{type:cn,value:r,start:e,end:N};if(r==="//"&&ve({},dt,_t),"<>=!+-*%&|^/".indexOf(i)>=0)return++N,{type:cn,value:i,start:e,end:N};ve({},dt,_t)}function tX(e){let t="";for(;N<It&&M2(K[N]);)t+=K[N++];return t.length===0&&ve({},dt,_t),_f(K.charCodeAt(N))&&ve({},dt,_t),{type:pa,value:parseInt("0x"+t,16),start:e,end:N}}function nX(e){let t="0"+K[N++];for(;N<It&&lc(K[N]);)t+=K[N++];return(_f(K.charCodeAt(N))||kr(K.charCodeAt(N)))&&ve({},dt,_t),{type:pa,value:parseInt(t,8),octal:!0,start:e,end:N}}function Tk(){var e,t,n;if(n=K[N],Mp(kr(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=N,e="",n!=="."){if(e=K[N++],n=K[N],e==="0"){if(n==="x"||n==="X")return++N,tX(t);if(lc(n))return nX(t);n&&kr(n.charCodeAt(0))&&ve({},dt,_t)}for(;kr(K.charCodeAt(N));)e+=K[N++];n=K[N]}if(n==="."){for(e+=K[N++];kr(K.charCodeAt(N));)e+=K[N++];n=K[N]}if(n==="e"||n==="E")if(e+=K[N++],n=K[N],(n==="+"||n==="-")&&(e+=K[N++]),kr(K.charCodeAt(N)))for(;kr(K.charCodeAt(N));)e+=K[N++];else ve({},dt,_t);return _f(K.charCodeAt(N))&&ve({},dt,_t),{type:pa,value:parseFloat(e),start:t,end:N}}function iX(){var e="",t,n,i,r,o=!1;for(t=K[N],Mp(t==="'"||t==='"',"String literal must starts with a quote"),n=N,++N;N<It;)if(i=K[N++],i===t){t="";break}else if(i==="\\")if(i=K[N++],!i||!zc(i.charCodeAt(0)))switch(i){case"u":case"x":K[N]==="{"?(++N,e+=QV()):e+=Ay(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:lc(i)?(r="01234567".indexOf(i),r!==0&&(o=!0),N<It&&lc(K[N])&&(o=!0,r=r*8+"01234567".indexOf(K[N++]),"0123".indexOf(i)>=0&&N<It&&lc(K[N])&&(r=r*8+"01234567".indexOf(K[N++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&K[N]===`
`&&++N;else{if(zc(i.charCodeAt(0)))break;e+=i}return t!==""&&ve({},dt,_t),{type:wf,value:e,octal:o,start:n,end:N}}function rX(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";ve({},$y)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{ve({},$y)}try{return new RegExp(e,t)}catch{return null}}function oX(){var e,t,n,i,r;for(e=K[N],Mp(e==="/","Regular expression literal must start with a slash"),t=K[N++],n=!1,i=!1;N<It;)if(e=K[N++],t+=e,e==="\\")e=K[N++],zc(e.charCodeAt(0))&&ve({},C0),t+=e;else if(zc(e.charCodeAt(0)))ve({},C0);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||ve({},C0),r=t.substr(1,t.length-2),{value:r,literal:t}}function sX(){var e,t,n;for(t="",n="";N<It&&(e=K[N],!!og(e.charCodeAt(0)));)++N,e==="\\"&&N<It?ve({},dt,_t):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&ve({},$y,n),{value:n,literal:t}}function aX(){var e,t,n,i;return Ae=null,HT(),e=N,t=oX(),n=sX(),i=rX(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:N}}function uX(e){return e.type===Xs||e.type===Jo||e.type===Ap||e.type===Cp}function YT(){if(HT(),N>=It)return{type:vf,start:N,end:N};const e=K.charCodeAt(N);return _f(e)?eX():e===40||e===41||e===59?M0():e===39||e===34?iX():e===46?kr(K.charCodeAt(N+1))?Tk():M0():kr(e)?Tk():M0()}function hn(){const e=Ae;return N=e.end,Ae=YT(),N=e.end,e}function VT(){const e=N;Ae=YT(),N=e}function lX(e){const t=new Ci(TV);return t.elements=e,t}function Nk(e,t,n){const i=new Ci(e==="||"||e==="&&"?PV:NV);return i.operator=e,i.left=t,i.right=n,i}function cX(e,t){const n=new Ci(OV);return n.callee=e,n.arguments=t,n}function fX(e,t,n){const i=new Ci(RV);return i.test=e,i.consequent=t,i.alternate=n,i}function F2(e){const t=new Ci(qT);return t.name=e,t}function Jl(e){const t=new Ci(zV);return t.value=e.value,t.raw=K.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function Ok(e,t,n){const i=new Ci(LV);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function dX(e){const t=new Ci(IV);return t.properties=e,t}function Rk(e,t,n){const i=new Ci(BV);return i.key=t,i.value=n,i.kind=e,i}function hX(e,t){const n=new Ci(UV);return n.operator=e,n.argument=t,n.prefix=!0,n}function ve(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(o,s)=>(Mp(s<i.length,"Message reference must be in range"),i[s]));throw n=new Error(r),n.index=N,n.description=r,n}function Fp(e){e.type===vf&&ve(e,GV),e.type===pa&&ve(e,jV),e.type===wf&&ve(e,qV),e.type===Xs&&ve(e,WV),e.type===Jo&&ve(e,HV),ve(e,dt,e.value)}function Bt(e){const t=hn();(t.type!==cn||t.value!==e)&&Fp(t)}function Re(e){return Ae.type===cn&&Ae.value===e}function F0(e){return Ae.type===Jo&&Ae.value===e}function gX(){const e=[];for(N=Ae.start,Bt("[");!Re("]");)Re(",")?(hn(),e.push(null)):(e.push(Ks()),Re("]")||Bt(","));return hn(),lX(e)}function zk(){N=Ae.start;const e=hn();return e.type===wf||e.type===pa?(e.octal&&ve(e,WT),Jl(e)):F2(e.value)}function pX(){var e,t,n,i;if(N=Ae.start,e=Ae,e.type===Xs)return n=zk(),Bt(":"),i=Ks(),Rk("init",n,i);if(e.type===vf||e.type===cn)Fp(e);else return t=zk(),Bt(":"),i=Ks(),Rk("init",t,i)}function mX(){var e=[],t,n,i,r={},o=String;for(N=Ae.start,Bt("{");!Re("}");)t=pX(),t.key.type===qT?n=t.key.name:n=o(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?ve({},YV):r[i]=!0,e.push(t),Re("}")||Bt(",");return Bt("}"),dX(e)}function yX(){Bt("(");const e=D2();return Bt(")"),e}const bX={if:1};function xX(){var e,t,n;if(Re("("))return yX();if(Re("["))return gX();if(Re("{"))return mX();if(e=Ae.type,N=Ae.start,e===Xs||bX[Ae.value])n=F2(hn().value);else if(e===wf||e===pa)Ae.octal&&ve(Ae,WT),n=Jl(hn());else{if(e===Jo)throw new Error(Rc);e===Ap?(t=hn(),t.value=t.value==="true",n=Jl(t)):e===Cp?(t=hn(),t.value=null,n=Jl(t)):Re("/")||Re("/=")?(n=Jl(aX()),VT()):Fp(hn())}return n}function vX(){const e=[];if(Bt("("),!Re(")"))for(;N<It&&(e.push(Ks()),!Re(")"));)Bt(",");return Bt(")"),e}function wX(){N=Ae.start;const e=hn();return uX(e)||Fp(e),F2(e.value)}function _X(){return Bt("."),wX()}function SX(){Bt("[");const e=D2();return Bt("]"),e}function EX(){var e,t,n;for(e=xX();;)if(Re("."))n=_X(),e=Ok(".",e,n);else if(Re("("))t=vX(),e=cX(e,t);else if(Re("["))n=SX(),e=Ok("[",e,n);else break;return e}function Pk(){const e=EX();if(Ae.type===cn&&(Re("++")||Re("--")))throw new Error(Rc);return e}function Ud(){var e,t;if(Ae.type!==cn&&Ae.type!==Jo)t=Pk();else{if(Re("++")||Re("--"))throw new Error(Rc);if(Re("+")||Re("-")||Re("~")||Re("!"))e=hn(),t=Ud(),t=hX(e.value,t);else{if(F0("delete")||F0("void")||F0("typeof"))throw new Error(Rc);t=Pk()}}return t}function Lk(e){let t=0;if(e.type!==cn&&e.type!==Jo)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function kX(){var e,t,n,i,r,o,s,a,u,l;if(e=Ae,u=Ud(),i=Ae,r=Lk(i),r===0)return u;for(i.prec=r,hn(),t=[e,Ae],s=Ud(),o=[u,i,s];(r=Lk(Ae))>0;){for(;o.length>2&&r<=o[o.length-2].prec;)s=o.pop(),a=o.pop().value,u=o.pop(),t.pop(),n=Nk(a,u,s),o.push(n);i=hn(),i.prec=r,o.push(i),t.push(Ae),n=Ud(),o.push(n)}for(l=o.length-1,n=o[l],t.pop();l>1;)t.pop(),n=Nk(o[l-1].value,o[l-2],n),l-=2;return n}function Ks(){var e,t,n;return e=kX(),Re("?")&&(hn(),t=Ks(),Bt(":"),n=Ks(),e=fX(e,t,n)),e}function D2(){const e=Ks();if(Re(","))throw new Error(Rc);return e}function T2(e){K=e,N=0,It=K.length,Ae=null,VT();const t=D2();if(Ae.type!==vf)throw new Error("Unexpect token after expression.");return t}var XT={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function KT(e){function t(s,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+s+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(s,a,u){return l=>t(s,l,a,u)}const i="new Date",r="String",o="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(s){s.length<3&&O("Missing arguments to clamp function."),s.length>3&&O("Too many arguments to clamp function.");const a=s.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:o,test:n("test",o),if:function(s){s.length<3&&O("Missing arguments to if function."),s.length>3&&O("Too many arguments to if function.");const a=s.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function $X(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function JT(e){e=e||{};const t=e.allowed?Si(e.allowed):{},n=e.forbidden?Si(e.forbidden):{},i=e.constants||XT,r=(e.functions||KT)(f),o=e.globalvar,s=e.fieldvar,a=ue(o)?o:g=>`${o}["${g}"]`;let u={},l={},c=0;function f(g){if(Y(g))return g;const p=d[g.type];return p==null&&O("Unsupported type: "+g.type),p(g)}const d={Literal:g=>g.raw,Identifier:g=>{const p=g.name;return c>0?p:ne(n,p)?O("Illegal identifier: "+p):ne(i,p)?i[p]:ne(t,p)?p:(u[p]=1,a(p))},MemberExpression:g=>{const p=!g.computed,m=f(g.object);p&&(c+=1);const y=f(g.property);return m===s&&(l[$X(y)]=1),p&&(c-=1),m+(p?"."+y:"["+y+"]")},CallExpression:g=>{g.callee.type!=="Identifier"&&O("Illegal callee type: "+g.callee.type);const p=g.callee.name,m=g.arguments,y=ne(r,p)&&r[p];return y||O("Unrecognized function: "+p),ue(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:g=>"["+g.elements.map(f).join(",")+"]",BinaryExpression:g=>"("+f(g.left)+" "+g.operator+" "+f(g.right)+")",UnaryExpression:g=>"("+g.operator+f(g.argument)+")",ConditionalExpression:g=>"("+f(g.test)+"?"+f(g.consequent)+":"+f(g.alternate)+")",LogicalExpression:g=>"("+f(g.left)+g.operator+f(g.right)+")",ObjectExpression:g=>"{"+g.properties.map(f).join(",")+"}",Property:g=>{c+=1;const p=f(g.key);return c-=1,p+":"+f(g.value)}};function h(g){const p={code:f(g),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},p}return h.functions=r,h.constants=i,h}const Ik=Symbol("vega_selection_getter");function QT(e){return(!e.getter||!e.getter[Ik])&&(e.getter=Kn(e.field),e.getter[Ik]=!0),e.getter}const N2="intersect",Bk="union",AX="vlMulti",CX="vlPoint",Uk="or",MX="and",Ui="_vgsid_",Pc=Kn(Ui),FX="E",DX="R",TX="R-E",NX="R-LE",OX="R-RE",sg="index:unit";function jk(e,t){for(var n=t.fields,i=t.values,r=n.length,o=0,s,a;o<r;++o)if(a=n[o],s=QT(a)(e),_o(s)&&(s=Ot(s)),_o(i[o])&&(i[o]=Ot(i[o])),z(i[o])&&_o(i[o][0])&&(i[o]=i[o].map(Ot)),a.type===FX){if(z(i[o])?i[o].indexOf(s)<0:s!==i[o])return!1}else if(a.type===DX){if(!ja(s,i[o]))return!1}else if(a.type===OX){if(!ja(s,i[o],!0,!1))return!1}else if(a.type===TX){if(!ja(s,i[o],!1,!1))return!1}else if(a.type===NX&&!ja(s,i[o],!1,!0))return!1;return!0}function RX(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],o=i?i[sg]&&i[sg].value:void 0,s=n===N2,a=r.length,u=0,l,c,f,d,h;u<a;++u)if(l=r[u],o&&s){if(c=c||{},f=c[d=l.unit]||0,f===-1)continue;if(h=jk(t,l),c[d]=h?-1:++f,h&&o.size===1)return!0;if(!h&&f===o.get(d).count)return!1}else if(h=jk(t,l),s^h)return h;return a&&s}const ZT=Uu(Pc),zX=ZT.left,PX=ZT.right;function LX(e,t,n){const i=this.context.data[e],r=i?i.values.value:[],o=i?i[sg]&&i[sg].value:void 0,s=n===N2,a=Pc(t),u=zX(r,a);if(u===r.length||Pc(r[u])!==a)return!1;if(o&&s){if(o.size===1)return!0;if(PX(r,a)-u<o.size)return!1}return!0}function IX(e,t){return e.map(n=>ae(t.fields?{values:t.fields.map(i=>QT(i)(n.datum))}:{[Ui]:Pc(n.datum)},t))}function BX(e,t,n,i){for(var r=this.context.data[e],o=r?r.values.value:[],s={},a={},u={},l,c,f,d,h,g,p,m,y,b,x=o.length,v=0,w,S;v<x;++v)if(l=o[v],d=l.unit,c=l.fields,f=l.values,c&&f){for(w=0,S=c.length;w<S;++w)h=c[w],p=s[h.field]||(s[h.field]={}),m=p[d]||(p[d]=[]),u[h.field]=y=h.type.charAt(0),b=D0[`${y}_union`],p[d]=b(m,H(f[w]));n&&(m=a[d]||(a[d]=[]),m.push(H(f).reduce((_,E,A)=>(_[c[A].field]=E,_),{})))}else h=Ui,g=Pc(l),p=s[h]||(s[h]={}),m=p[d]||(p[d]=[]),m.push(g),n&&(m=a[d]||(a[d]=[]),m.push({[Ui]:g}));if(t=t||Bk,s[Ui]?s[Ui]=D0[`${Ui}_${t}`](...Object.values(s[Ui])):Object.keys(s).forEach(_=>{s[_]=Object.keys(s[_]).map(E=>s[_][E]).reduce((E,A)=>E===void 0?A:D0[`${u[_]}_${t}`](E,A))}),o=Object.keys(a),n&&o.length){const _=i?CX:AX;s[_]=t===Bk?{[Uk]:o.reduce((E,A)=>(E.push(...a[A]),E),[])}:{[MX]:o.map(E=>({[Uk]:a[E]}))}}return s}var D0={[`${Ui}_union`]:F8,[`${Ui}_intersect`]:C8,E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Ot(t[0]),i=Ot(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=Ot(t[0]),i=Ot(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const UX=":",jX="@";function O2(e,t,n,i){t[0].type!==Vs&&O("First argument to selection functions must be a string literal.");const r=t[0].value,o=t.length>=2&&ye(t).value,s="unit",a=jX+s,u=UX+r;o===N2&&!ne(i,a)&&(i[a]=n.getData(r).indataRef(n,s)),ne(i,u)||(i[u]=n.getData(r).tuplesRef())}function eN(e){const t=this.context.data[e];return t?t.values.value:[]}function qX(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function WX(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(Jn).insert(t)),1}function HX(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const Sf=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},GX=Sf("format"),tN=Sf("timeFormat"),YX=Sf("utcFormat"),VX=Sf("timeParse"),XX=Sf("utcParse"),dd=new Date(2e3,0,1);function Dp(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(dd.setYear(2e3),dd.setMonth(e),dd.setDate(t),tN.call(this,dd,n))}function KX(e){return Dp.call(this,e,1,"%B")}function JX(e){return Dp.call(this,e,1,"%b")}function QX(e){return Dp.call(this,0,2+e,"%A")}function ZX(e){return Dp.call(this,0,2+e,"%a")}const eK=":",tK="@",Cy="%",nN="$";function R2(e,t,n,i){t[0].type!==Vs&&O("First argument to data functions must be a string literal.");const r=t[0].value,o=eK+r;if(!ne(o,i))try{i[o]=n.getData(r).tuplesRef()}catch{}}function nK(e,t,n,i){t[0].type!==Vs&&O("First argument to indata must be a string literal."),t[1].type!==Vs&&O("Second argument to indata must be a string literal.");const r=t[0].value,o=t[1].value,s=tK+o;ne(s,i)||(i[s]=n.getData(r).indataRef(n,o))}function tn(e,t,n,i){if(t[0].type===Vs)qk(n,i,t[0].value);else for(e in n.scales)qk(n,i,e)}function qk(e,t,n){const i=Cy+n;if(!ne(t,i))try{t[i]=e.scaleRef(n)}catch{}}function dr(e,t){if(ue(e))return e;if(Y(e)){const n=t.scales[e];return n&&dI(n.value)?n.value:void 0}}function iK(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=tn,n._range=tn,n._scale=tn;const i=r=>"_["+(r.type===Vs?j(Cy+r.value):j(Cy)+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}function z2(e,t){return function(n,i,r){if(n){const o=dr(n,(r||this).context);return o&&o.path[e](i)}else return t(i)}}const rK=z2("area",Cq),oK=z2("bounds",Tq),sK=z2("centroid",Lq);function aK(e,t){const n=dr(e,(t||this).context);return n&&n.scale()}function uK(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function P2(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function lK(){return P2(this.context.dataflow,"warn",arguments)}function cK(){return P2(this.context.dataflow,"info",arguments)}function fK(){return P2(this.context.dataflow,"debug",arguments)}function T0(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function My(e){const t=To(e),n=T0(t.r),i=T0(t.g),r=T0(t.b);return .2126*n+.7152*i+.0722*r}function dK(e,t){const n=My(e),i=My(t),r=Math.max(n,i),o=Math.min(n,i);return(r+.05)/(o+.05)}function hK(){const e=[].slice.call(arguments);return e.unshift({}),ae(...e)}function iN(e,t){return e===t||e!==e&&t!==t?!0:z(e)?z(t)&&e.length===t.length?gK(e,t):!1:G(e)&&G(t)?rN(e,t):!1}function gK(e,t){for(let n=0,i=e.length;n<i;++n)if(!iN(e[n],t[n]))return!1;return!0}function rN(e,t){for(const n in e)if(!iN(e[n],t[n]))return!1;return!0}function Wk(e){return t=>rN(e,t)}function pK(e,t,n,i,r,o){const s=this.context.dataflow,a=this.context.data[e],u=a.input,l=s.stamp();let c=a.changes,f,d;if(s._trigger===!1||!(u.value.length||t||i))return 0;if((!c||c.stamp<l)&&(a.changes=c=s.changeset(),c.stamp=l,s.runAfter(()=>{a.modified=!0,s.pulse(u,c).run()},!0,1)),n&&(f=n===!0?Jn:z(n)||Ig(n)?n:Wk(n),c.remove(f)),t&&c.insert(t),i&&(f=Wk(i),u.value.some(f)?c.remove(f):c.insert(i)),r)for(d in o)c.modify(r,d,o[d]);return 1}function mK(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.hypot(n,i)}function yK(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const Hk={};function bK(e,t){const n=Hk[t]||(Hk[t]=Kn(t));return z(e)?e.map(n):n(e)}function L2(e){return z(e)||ArrayBuffer.isView(e)?e:null}function I2(e){return L2(e)||(Y(e)?e:null)}function xK(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return L2(e).join(...n)}function vK(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return I2(e).indexOf(...n)}function wK(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return I2(e).lastIndexOf(...n)}function _K(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return I2(e).slice(...n)}function SK(e,t,n){return ue(n)&&O("Function argument passed to replace."),String(e).replace(t,n)}function EK(e){return L2(e).slice().reverse()}function kK(e,t,n){return Vx(e||0,t||0,n||0)}function $K(e,t){const n=dr(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function AK(e,t){const n=dr(e,(t||this).context);return n?n.copy():void 0}function CK(e,t){const n=dr(e,(t||this).context);return n?n.domain():[]}function MK(e,t,n){const i=dr(e,(n||this).context);return i?z(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function FK(e,t){const n=dr(e,(t||this).context);return n&&n.range?n.range():[]}function DK(e,t,n){const i=dr(e,(n||this).context);return i?i(t):void 0}function TK(e,t,n,i,r){e=dr(e,(r||this).context);const o=Q3(t,n);let s=e.domain(),a=s[0],u=ye(s),l=Ut;return u-a?l=B3(e,a,u):e=(e.interpolator?_e("sequential")().interpolator(e.interpolator()):_e("linear")().interpolate(e.interpolate()).range(e.range())).domain([a=0,u=1]),e.ticks&&(s=e.ticks(+i||15),a!==s[0]&&s.unshift(a),u!==ye(s)&&s.push(u)),s.forEach(c=>o.stop(l(c),e(c))),o}function NK(e,t,n){const i=dr(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function OK(e){let t=null;return function(n){return n?kc(n,t=t||mu(e)):e}}const oN=e=>e.data;function sN(e,t){const n=eN.call(t,e);return n.root&&n.root.lookup||{}}function RK(e,t,n){const i=sN(e,this),r=i[t],o=i[n];return r&&o?r.path(o).map(oN):void 0}function zK(e,t){const n=sN(e,this)[t];return n?n.ancestors().map(oN):void 0}const aN=()=>typeof window<"u"&&window||null;function PK(){const e=aN();return e?e.screen:{}}function LK(){const e=aN();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function IK(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function uN(e,t,n){if(!e)return[];const[i,r]=e,o=new Qe().set(i[0],i[1],r[0],r[1]),s=n||this.context.dataflow.scenegraph().root;return HD(s,o,BK(t))}function BK(e){let t=null;if(e){const n=H(e.marktype),i=H(e.markname);t=r=>(!n.length||n.some(o=>r.marktype===o))&&(!i.length||i.some(o=>r.name===o))}return t}function UK(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;e=H(e);const r=e[e.length-1];return r===void 0||Math.hypot(r[0]-t,r[1]-n)>i?[...e,[t,n]]:e}function jK(e){return H(e).reduce((t,n,i)=>{let[r,o]=n;return t+=i==0?`M ${r},${o} `:i===e.length-1?" Z":`L ${r},${o} `},"")}function qK(e,t,n){const{x:i,y:r,mark:o}=n,s=new Qe().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[u,l]of t)u<s.x1&&(s.x1=u),u>s.x2&&(s.x2=u),l<s.y1&&(s.y1=l),l>s.y2&&(s.y2=l);return s.translate(i,r),uN([[s.x1,s.y1],[s.x2,s.y2]],e,o).filter(u=>WK(u.x,u.y,t))}function WK(e,t,n){let i=0;for(let r=0,o=n.length-1;r<n.length;o=r++){const[s,a]=n[o],[u,l]=n[r];l>t!=a>t&&e<(s-u)*(t-l)/(a-l)+u&&i++}return i&1}const Lc={random(){return Zn()},cumulativeNormal:Wg,cumulativeLogNormal:Gb,cumulativeUniform:Kb,densityNormal:Ub,densityLogNormal:Hb,densityUniform:Xb,quantileNormal:Hg,quantileLogNormal:Yb,quantileUniform:Jb,sampleNormal:qg,sampleLogNormal:Wb,sampleUniform:Vb,isArray:z,isBoolean:ua,isDate:_o,isDefined(e){return e!==void 0},isNumber:xe,isObject:G,isRegExp:bC,isString:Y,isTuple:Ig,isValid(e){return e!=null&&e===e},toBoolean:wb,toDate(e){return _b(e)},toNumber:Ot,toString:Sb,indexof:vK,join:xK,lastindexof:wK,replace:SK,reverse:EK,slice:_K,flush:mC,lerp:xC,merge:hK,pad:_C,peek:ye,pluck:bK,span:Jc,inrange:ja,truncate:SC,rgb:To,lab:dh,hcl:hh,hsl:ch,luminance:My,contrast:dK,sequence:Fn,format:GX,utcFormat:YX,utcParse:XX,utcOffset:tM,utcSequence:rM,timeFormat:tN,timeParse:VX,timeOffset:eM,timeSequence:iM,timeUnitSpecifier:qC,monthFormat:KX,monthAbbrevFormat:JX,dayFormat:QX,dayAbbrevFormat:ZX,quarter:dC,utcquarter:hC,week:HC,utcweek:VC,dayofyear:WC,utcdayofyear:YC,warn:lK,info:cK,debug:fK,extent(e){return Qi(e)},inScope:uK,intersect:uN,clampRange:gC,pinchDistance:mK,pinchAngle:yK,screen:PK,containerSize:IK,windowSize:LK,bandspace:kK,setdata:WX,pathShape:OK,panLinear:uC,panLog:lC,panPow:cC,panSymlog:fC,zoomLinear:pb,zoomLog:mb,zoomPow:Jd,zoomSymlog:yb,encode:HX,modify:pK,lassoAppend:UK,lassoPath:jK,intersectLasso:qK},HK=["view","item","group","xy","x","y"],GK="event.vega.",lN="this.",B2={},cN={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${j(nN+e)}]`,functions:YK,constants:XT,visitors:B2},Fy=JT(cN);function YK(e){const t=KT(e);HK.forEach(n=>t[n]=GK+n);for(const n in Lc)t[n]=lN+n;return ae(t,iK(e,Lc,B2)),t}function Ke(e,t,n){return arguments.length===1?Lc[e]:(Lc[e]=t,n&&(B2[e]=n),Fy&&(Fy.functions[e]=lN+e),this)}Ke("bandwidth",$K,tn);Ke("copy",AK,tn);Ke("domain",CK,tn);Ke("range",FK,tn);Ke("invert",MK,tn);Ke("scale",DK,tn);Ke("gradient",TK,tn);Ke("geoArea",rK,tn);Ke("geoBounds",oK,tn);Ke("geoCentroid",sK,tn);Ke("geoShape",NK,tn);Ke("geoScale",aK,tn);Ke("indata",qX,nK);Ke("data",eN,R2);Ke("treePath",RK,R2);Ke("treeAncestors",zK,R2);Ke("vlSelectionTest",RX,O2);Ke("vlSelectionIdTest",LX,O2);Ke("vlSelectionResolve",BX,O2);Ke("vlSelectionTuples",IX);function ir(e,t){const n={};let i;try{e=Y(e)?e:j(e)+"",i=T2(e)}catch{O("Expression parse error: "+e)}i.visit(o=>{if(o.type!==jT)return;const s=o.callee.name,a=cN.visitors[s];a&&a(s,o.arguments,t,n)});const r=Fy(i);return r.globals.forEach(o=>{const s=nN+o;!ne(n,s)&&t.getSignal(o)&&(n[s]=t.signalRef(o))}),{$expr:ae({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function VK(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const XK=Si(["rule"]),Gk=Si(["group","image","rect"]);function KK(e,t){let n="";return XK[t]||(e.x2&&(e.x?(Gk[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(Gk[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function U2(e){return(e+"").toLowerCase()}function JK(e){return U2(e)==="operator"}function QK(e){return U2(e)==="collect"}function wl(e,t,n){n.endsWith(";")||(n="return("+n+");");const i=Function(...t.concat(n));return e&&e.functions?i.bind(e.functions):i}function ZK(e,t,n,i){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${i} : `}var eJ={operator:(e,t)=>wl(e,["_"],t.code),parameter:(e,t)=>wl(e,["datum","_"],t.code),event:(e,t)=>wl(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return wl(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const o in i){const s="o["+j(o)+"]";r+=`$=${i[o].code};if(${s}!==$)${s}=$,m=1;`}return r+=KK(i,n),r+="return m;",wl(e,["item","_"],r)},codegen:{get(e){const t=`[${e.map(j).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const i=(o,s)=>{const a=t[s];let u,l;return o.path?(u=`a${o.path}`,l=`b${o.path}`):((n=n||{})["f"+s]=o,u=`this.f${s}(a)`,l=`this.f${s}(b)`),ZK(u,l,-a,a)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function tJ(e){const t=this;JK(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function nJ(e){const t=this;if(e.params){const n=t.get(e.id);n||O("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function iJ(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=z(r)?r.map(o=>Yk(o,n,t)):Yk(r,n,t)}return t}function Yk(e,t,n){if(!e||!G(e))return e;for(let i=0,r=Vk.length,o;i<r;++i)if(o=Vk[i],ne(e,o.key))return o.parse(e,t,n);return e}var Vk=[{key:"$ref",parse:rJ},{key:"$key",parse:sJ},{key:"$expr",parse:oJ},{key:"$field",parse:aJ},{key:"$encode",parse:lJ},{key:"$compare",parse:uJ},{key:"$context",parse:cJ},{key:"$subflow",parse:fJ},{key:"$tupleid",parse:dJ}];function rJ(e,t){return t.get(e.$ref)||O("Operator not defined: "+e.$ref)}function oJ(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code;return t.fn[i]||(t.fn[i]=Sn(t.parameterExpression(e.$expr),e.$fields))}function sJ(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=vb(e.$key,e.$flat,t.expr.codegen))}function aJ(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Kn(e.$field,e.$name,t.expr.codegen))}function uJ(e,t){const n="c:"+e.$compare+"_"+e.$order,i=H(e.$compare).map(r=>r&&r.$tupleid?ee:r);return t.fn[n]||(t.fn[n]=bb(i,e.$order,t.expr.codegen))}function lJ(e,t){const n=e.$encode,i={};for(const r in n){const o=n[r];i[r]=Sn(t.encodeExpression(o.$expr),o.$fields),i[r].output=o.$output}return i}function cJ(e,t){return t}function fJ(e,t){const n=e.$subflow;return function(i,r,o){const s=t.fork().parse(n),a=s.get(n.operators[0].id),u=s.signals.parent;return u&&u.set(o),a.detachSubflow=()=>t.detach(s),a}}function dJ(){return ee}function hJ(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(o=>t.get(o)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(o=>t.get(o)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&O("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function gJ(e){var t=this,n=G(n=e.source)?n.$ref:n,i=t.get(n),r=null,o=e.update,s=void 0;i||O("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),o&&o.$expr&&(o.$params&&(s=t.parseParameters(o.$params)),o=t.handlerExpression(o.$expr)),t.update(e,i,r,o,s)}const pJ={skip:!0};function mJ(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(o=>{const s=t.signals[o];e.signals(o,s)&&(i[o]=s.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(o=>{const s=t.data[o];e.data(o,s)&&(r[o]=s.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(o=>o.getState(e))),n}function yJ(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(o=>{n.update(t.signals[o],r[o],pJ)}),Object.keys(i||{}).forEach(o=>{n.pulse(t.data[o].input,n.changeset().remove(Jn).insert(i[o]))}),(e.subcontext||[]).forEach((o,s)=>{const a=t.subcontext[s];a&&a.setState(o)})}function fN(e,t,n,i){return new dN(e,t,n,i)}function dN(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||eJ,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function Xk(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}dN.prototype=Xk.prototype={fork(){const e=new Xk(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),QK(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){let o=n.get(e.parent.$ref);o?(i.connect(o,[t]),t.targets().add(o)):(n.unresolved=n.unresolved||[]).push(()=>{o=n.get(e.parent.$ref),i.connect(o,[t]),t.targets().add(o)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const o in e.data){const s=n.data[o]||(n.data[o]={});e.data[o].forEach(a=>s[a]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[U2(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:VK,parseOperator:tJ,parseOperatorParameters:nJ,parseParameters:iJ,parseStream:hJ,parseUpdate:gJ,getState:mJ,setState:yJ};function bJ(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),hN(t,e.description()))}function hN(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function xJ(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const N0="default";function vJ(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:N0,item:null}));e.on(e.events("view","mousemove"),t,(n,i)=>{const r=t.value,o=r?Y(r)?r:r.user:N0,s=i.item&&i.item.cursor||null;return r&&o===r.user&&s==r.item?r:{user:o,item:s}}),e.add(null,function(n){let i=n.cursor,r=this.value;return Y(i)||(r=i.item,i=i.user),Dy(e,i&&i!==N0?i:r||i),r},{cursor:t})}function Dy(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function ag(e,t){var n=e._runtime.data;return ne(n,t)||O("Unrecognized data set: "+t),n[t]}function wJ(e,t){return arguments.length<2?ag(this,e).values.value:Tp.call(this,e,da().remove(Jn).insert(t))}function Tp(e,t){DM(t)||O("Second argument to changes must be a changeset.");const n=ag(this,e);return n.modified=!0,this.pulse(n.input,t)}function _J(e,t){return Tp.call(this,e,da().insert(t))}function SJ(e,t){return Tp.call(this,e,da().remove(t))}function gN(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function pN(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Np(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function EJ(e){var t=Np(e),n=gN(e),i=pN(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(r=>{try{r(n,i)}catch(o){e.error(o)}})}function kJ(e,t,n){var i=e._renderer,r=i&&i.canvas(),o,s,a;return r&&(a=Np(e),s=t.changedTouches?t.changedTouches[0]:t,o=bp(s,r),o[0]-=a[0],o[1]-=a[1]),t.dataflow=e,t.item=n,t.vega=$J(e,n,o),t}function $J(e,t,n){const i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(s){var a=i,u;if(s){for(u=t;u;u=u.mark.group)if(u.mark.name===s){a=u;break}}return a&&a.mark&&a.mark.interactive?a:{}}function o(s){if(!s)return n;Y(s)&&(s=r(s));const a=n.slice();for(;s;)a[0]-=s.x||0,a[1]-=s.y||0,s=s.mark&&s.mark.group;return a}return{view:jt(e),item:jt(t||{}),group:r,xy:o,x:s=>o(s)[0],y:s=>o(s)[1]}}const Kk="view",AJ="timer",CJ="window",MJ={trap:!1};function FJ(e){const t=ae({defaults:{}},e),n=(i,r)=>{r.forEach(o=>{z(i[o])&&(i[o]=Si(i[o]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function mN(e,t,n,i){e._eventListeners.push({type:n,sources:H(t),handler:i})}function DJ(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function hd(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||G(i)&&!i[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function TJ(e,t,n){var i=this,r=new jg(n),o=function(l,c){i.runAsync(null,()=>{e===Kk&&DJ(i,t)&&l.preventDefault(),r.receive(kJ(i,l,c))})},s;if(e===AJ)hd(i,"timer",t)&&i.timer(o,t);else if(e===Kk)hd(i,"view",t)&&i.addEventListener(t,o,MJ);else if(e===CJ?hd(i,"window",t)&&typeof window<"u"&&(s=[window]):typeof document<"u"&&hd(i,"selector",t)&&(s=Array.from(document.querySelectorAll(e))),!s)i.warn("Can not resolve event source: "+e);else{for(var a=0,u=s.length;a<u;++a)s[a].addEventListener(t,o);mN(i,s,t,o)}return r}function Jk(e){return e.item}function Qk(e){return e.item.mark.source}function Zk(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function NJ(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",Jk),Qk,Zk(e)),this.on(this.events("view","mouseout",Jk),Qk,Zk(t)),this}function OJ(){var e=this._tooltip,t=this._timers,n=this._eventListeners,i,r,o;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(o=n[i],r=o.sources.length;--r>=0;)o.sources[r].removeEventListener(o.type,o.handler);return e&&e.call(this,this._handler,null,null,null),this}function Nn(e,t,n){const i=document.createElement(e);for(const r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const RJ="vega-bind",zJ="vega-bind-name",PJ="vega-bind-radio";function LJ(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:s=>{s!=e.signal(i.signal)&&e.runAsync(null,()=>{r.source=!0,e.signal(i.signal,s)})}},i.debounce&&(r.update=xb(i.debounce,r.update))),(i.input==null&&i.element?IJ:UJ)(r,t,i,e),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function IJ(e,t,n,i){const r=n.event||"input",o=()=>e.update(t.value);i.signal(n.signal,t.value),t.addEventListener(r,o),mN(i,t,r,o),e.set=s=>{t.value=s,t.dispatchEvent(BJ(r))}}function BJ(e){return typeof Event<"u"?new Event(e):{type:e}}function UJ(e,t,n,i){const r=i.signal(n.signal),o=Nn("div",{class:RJ}),s=n.input==="radio"?o:o.appendChild(Nn("label"));s.appendChild(Nn("span",{class:zJ},n.name||n.signal)),t.appendChild(o);let a=jJ;switch(n.input){case"checkbox":a=qJ;break;case"select":a=WJ;break;case"radio":a=HJ;break;case"range":a=GJ;break}a(e,s,n,r)}function jJ(e,t,n,i){const r=Nn("input");for(const o in n)o!=="signal"&&o!=="element"&&r.setAttribute(o==="input"?"type":o,n[o]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=o=>r.value=o}function qJ(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const o=Nn("input",r);t.appendChild(o),o.addEventListener("change",()=>e.update(o.checked)),e.elements=[o],e.set=s=>o.checked=!!s||null}function WJ(e,t,n,i){const r=Nn("select",{name:n.signal}),o=n.labels||[];n.options.forEach((s,a)=>{const u={value:s};ug(s,i)&&(u.selected=!0),r.appendChild(Nn("option",u,(o[a]||s)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=s=>{for(let a=0,u=n.options.length;a<u;++a)if(ug(n.options[a],s)){r.selectedIndex=a;return}}}function HJ(e,t,n,i){const r=Nn("span",{class:PJ}),o=n.labels||[];t.appendChild(r),e.elements=n.options.map((s,a)=>{const u={type:"radio",name:n.signal,value:s};ug(s,i)&&(u.checked=!0);const l=Nn("input",u);l.addEventListener("change",()=>e.update(s));const c=Nn("label",{},(o[a]||s)+"");return c.prepend(l),r.appendChild(c),l}),e.set=s=>{const a=e.elements,u=a.length;for(let l=0;l<u;++l)ug(a[l].value,s)&&(a[l].checked=!0)}}function GJ(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,o=n.min||Math.min(0,r,+i)||0,s=n.step||Mo(o,r,100),a=Nn("input",{type:"range",name:n.signal,min:o,max:r,step:s});a.value=i;const u=Nn("span",{},+i);t.appendChild(a),t.appendChild(u);const l=()=>{u.textContent=a.value,e.update(+a.value)};a.addEventListener("input",l),a.addEventListener("change",l),e.elements=[a],e.set=c=>{a.value=c,u.textContent=c}}function ug(e,t){return e===t||e+""==t+""}function yN(e,t,n,i,r,o){return t=t||new i(e.loader()),t.initialize(n,gN(e),pN(e),Np(e),r,o).background(e.background())}function j2(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function YJ(e,t,n,i){const r=new i(e.loader(),j2(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Np(e),e);return t&&t.handlers().forEach(o=>{r.on(o.type,o.handler)}),r}function VJ(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,o=vp(i);e=n._el=e?O0(n,e,!0):null,bJ(n),o||n.error("Unrecognized renderer type: "+i);const s=o.handler||Po,a=e?o.renderer:o.headless;return n._renderer=a?yN(n,n._renderer,e,a):null,n._handler=YJ(n,n._handler,e,s),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=O0(n,t,!0):e.appendChild(Nn("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&r!=="container"&&(u.element=O0(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{LJ(n,u.element||t,u)})),n}function O0(e,t,n){if(typeof t=="string")if(typeof document<"u"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.textContent=""}catch(i){t=null,e.error(i)}return t}const _l=e=>+e||0,XJ=e=>({top:e,bottom:e,left:e,right:e});function e$(e){return G(e)?{top:_l(e.top),bottom:_l(e.bottom),left:_l(e.left),right:_l(e.right)}:XJ(_l(e))}async function q2(e,t,n,i){const r=vp(t),o=r&&r.headless;return o||O("Unrecognized renderer type: "+t),await e.runAsync(),yN(e,null,null,o,n,i).renderAsync(e._scenegraph.root)}async function KJ(e,t){e!==mo.Canvas&&e!==mo.SVG&&e!==mo.PNG&&O("Unrecognized image type: "+e);const n=await q2(this,e,t);return e===mo.SVG?JJ(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function JJ(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function QJ(e,t){return(await q2(this,mo.Canvas,e,t)).canvas()}async function ZJ(e){return(await q2(this,mo.SVG,e)).svg()}function eQ(e,t,n){return fN(e,lu,Lc,n).parse(t)}function tQ(e){var t=this._runtime.scales;return ne(t,e)||O("Unrecognized scale or projection: "+e),t[e].value}var bN="width",xN="height",W2="padding",t$={skip:!0};function vN(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===W2?i.left+i.right:0)}function wN(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===W2?i.top+i.bottom:0)}function nQ(e){var t=e._signals,n=t[bN],i=t[xN],r=t[W2];function o(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,a=>{e._width=a.size,e._viewWidth=vN(e,a.size),o()},{size:n}),e._resizeHeight=e.add(null,a=>{e._height=a.size,e._viewHeight=wN(e,a.size),o()},{size:i});const s=e.add(null,o,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,s.rank=r.rank+1}function iQ(e,t,n,i,r,o){this.runAfter(s=>{let a=0;s._autosize=0,s.width()!==n&&(a=1,s.signal(bN,n,t$),s._resizeWidth.skip(!0)),s.height()!==i&&(a=1,s.signal(xN,i,t$),s._resizeHeight.skip(!0)),s._viewWidth!==e&&(s._resize=1,s._viewWidth=e),s._viewHeight!==t&&(s._resize=1,s._viewHeight=t),(s._origin[0]!==r[0]||s._origin[1]!==r[1])&&(s._resize=1,s._origin=r),a&&s.run("enter"),o&&s.runAfter(u=>u.resize())},!1,1)}function rQ(e){return this._runtime.getState(e||{data:oQ,signals:sQ,recurse:!0})}function oQ(e,t){return t.modified&&z(t.input.value)&&e.indexOf("_:vega:_")}function sQ(e,t){return!(e==="parent"||t instanceof lu.proxy)}function aQ(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function uQ(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(IH(n,t))}function lQ(e,t,n,i){const r=e.element();r&&r.setAttribute("title",cQ(i))}function cQ(e){return e==null?"":z(e)?_N(e):G(e)&&!_o(e)?fQ(e):e+""}function fQ(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(z(n)?_N(n):SN(n))}).join(`
`)}function _N(e){return"["+e.map(SN).join(", ")+"]"}function SN(e){return z(e)?"[…]":G(e)&&!_o(e)?"{…}":e}function EN(e,t){const n=this;if(t=t||{},Va.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const o=ae({},e.locale,t.locale);n.locale(wM(o.number,o.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||mo.Canvas,n._scenegraph=new Ev;const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||lQ,n._redraw=!0,n._handler=new Po().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=FJ(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=eQ(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(o=>({state:null,param:ae({},o)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=vN(n,n._width),n._viewHeight=wN(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,nQ(n),xJ(n),vJ(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function gd(e,t){return ne(e._signals,t)?e._signals[t]:O("Unrecognized signal name: "+j(t))}function kN(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function n$(e,t,n,i){let r=kN(n,i);return r||(r=j2(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function i$(e,t,n){const i=kN(t,n);return i&&t._targets.remove(i),e}U(EN,Va,{async evaluate(e,t,n){if(await Va.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,EJ(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&kd(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&hN(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const i=gd(this,e);return arguments.length===1?i.value:this.update(i,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",e$(e)):e$(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(vp(e)||O("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Va.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(gd(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:iQ,addEventListener(e,t,n){let i=t;return n&&n.trap===!1||(i=j2(this,t),i.raw=t),this._handler.on(e,i),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),i=n.length,r,o;--i>=0;)if(o=n[i].type,r=n[i].handler,e===o&&(t===r||t===r.raw)){this._handler.off(o,r);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return n$(this,e,gd(this,e),t)},removeSignalListener(e,t){return i$(this,gd(this,e),t)},addDataListener(e,t){return n$(this,e,ag(this,e).values,t)},removeDataListener(e,t){return i$(this,ag(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=Dy(this,null);this._globalCursor=!!e,t&&Dy(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:uQ,events:TJ,finalize:OJ,hover:NJ,data:wJ,change:Tp,insert:_J,remove:SJ,scale:tQ,initialize:VJ,toImageURL:KJ,toCanvas:QJ,toSVG:ZJ,getState:rQ,setState:aQ});const dQ="view",lg="[",cg="]",$N="{",AN="}",hQ=":",CN=",",gQ="@",pQ=">",mQ=/[[\]{}]/,yQ={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let MN,FN;function Qo(e,t,n){return MN=t||dQ,FN=n||yQ,DN(e.trim()).map(Ty)}function bQ(e){return FN[e]}function cc(e,t,n,i,r){const o=e.length;let s=0,a;for(;t<o;++t){if(a=e[t],!s&&a===n)return t;r&&r.indexOf(a)>=0?--s:i&&i.indexOf(a)>=0&&++s}return t}function DN(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=cc(e,r,CN,lg+$N,cg+AN),t.push(e.substring(i,r).trim()),i=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function Ty(e){return e[0]==="["?xQ(e):vQ(e)}function xQ(e){const t=e.length;let n=1,i;if(n=cc(e,n,cg,lg,cg),n===t)throw"Empty between selector: "+e;if(i=DN(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==pQ)throw"Expected '>' after between selector: "+e;i=i.map(Ty);const r=Ty(e.slice(1).trim());return r.between?{between:i,stream:r}:(r.between=i,r)}function vQ(e){const t={source:MN},n=[];let i=[0,0],r=0,o=0,s=e.length,a=0,u,l;if(e[s-1]===AN){if(a=e.lastIndexOf($N),a>=0){try{i=wQ(e.substring(a+1,s-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),s=e.length}else throw"Unmatched right brace: "+e;a=0}if(!s)throw e;if(e[0]===gQ&&(r=++a),u=cc(e,a,hQ),u<s&&(n.push(e.substring(o,u).trim()),o=a=++u),a=cc(e,a,lg),a===s)n.push(e.substring(o,s).trim());else if(n.push(e.substring(o,a).trim()),l=[],o=++a,o===s)throw"Unmatched left bracket: "+e;for(;a<s;){if(a=cc(e,a,cg),a===s)throw"Unmatched left bracket: "+e;if(l.push(e.substring(o,a).trim()),a<s-1&&e[++a]!==lg)throw"Expected left bracket: "+e;o=++a}if(!(s=n.length)||mQ.test(n[s-1]))throw"Invalid event selector: "+e;return s>1?(t.type=n[1],r?t.markname=n[0].slice(1):bQ(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function wQ(e){const t=e.split(CN);if(!e.length||t.length>2)throw e;return t.map(n=>{const i=+n;if(i!==i)throw e;return i})}function _Q(e){return G(e)?e:{type:e||"pad"}}const Sl=e=>+e||0,SQ=e=>({top:e,bottom:e,left:e,right:e});function EQ(e){return G(e)?e.signal?e:{top:Sl(e.top),bottom:Sl(e.bottom),left:Sl(e.left),right:Sl(e.right)}:SQ(Sl(e))}const ht=e=>G(e)&&!z(e)?ae({},e):{value:e};function r$(e,t,n,i){return n!=null?(G(n)&&!z(n)||z(n)&&n.length&&G(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function kt(e,t,n){for(const i in t)r$(e,i,t[i]);for(const i in n)r$(e,i,n[i],"update")}function Ju(e,t,n){for(const i in t)n&&ne(n,i)||(e[i]=ae(e[i]||{},t[i]));return e}function Ba(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const H2="mark",G2="frame",Y2="scope",kQ="axis",$Q="axis-domain",AQ="axis-grid",CQ="axis-label",MQ="axis-tick",FQ="axis-title",DQ="legend",TQ="legend-band",NQ="legend-entry",OQ="legend-gradient",TN="legend-label",RQ="legend-symbol",zQ="legend-title",PQ="title",LQ="title-text",IQ="title-subtitle";function BQ(e,t,n,i,r){const o={},s={};let a,u,l,c;u="lineBreak",t==="text"&&r[u]!=null&&!Ba(u,e)&&R0(o,u,r[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===G2?r.group:n===H2?ae({},r.mark,r[t]):null;for(u in c)l=Ba(u,e)||(u==="fill"||u==="stroke")&&(Ba("fill",e)||Ba("stroke",e)),l||R0(o,u,c[u]);H(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)Ba(h,e)||R0(o,h,d[h])}),e=ae({},e);for(u in o)c=o[u],c.signal?(a=a||{})[u]=c:s[u]=c;return e.enter=ae(s,e.enter),a&&(e.update=ae(a,e.update)),e}function R0(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const NN=e=>Y(e)?j(e):e.signal?`(${e.signal})`:ON(e);function Op(e){if(e.gradient!=null)return jQ(e);let t=e.signal?`(${e.signal})`:e.color?UQ(e.color):e.field!=null?ON(e.field):e.value!==void 0?j(e.value):void 0;return e.scale!=null&&(t=qQ(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${jd(e.exponent)})`),e.mult!=null&&(t+=`*${jd(e.mult)}`),e.offset!=null&&(t+=`+${jd(e.offset)}`),e.round&&(t=`round(${t})`),t}const pd=(e,t,n,i)=>`(${e}(${[t,n,i].map(Op).join(",")})+'')`;function UQ(e){return e.c?pd("hcl",e.h,e.c,e.l):e.h||e.s?pd("hsl",e.h,e.s,e.l):e.l||e.a?pd("lab",e.l,e.a,e.b):e.r||e.g||e.b?pd("rgb",e.r,e.g,e.b):null}function jQ(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:j(n));for(;t.length&&ye(t)==null;)t.pop();return t.unshift(NN(e.gradient)),`gradient(${t.join(",")})`}function jd(e){return G(e)?"("+Op(e)+")":e}function ON(e){return RN(G(e)?e:{datum:e})}function RN(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):O("Invalid field reference: "+j(e));return e.signal||(i=Y(i)?ar(i).map(j).join("]["):RN(i)),t+"["+i+"]"}function qQ(e,t){const n=NN(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band==1?"":"*"+jd(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function WQ(e){let t="";return e.forEach(n=>{const i=Op(n);t+=n.test?`(${n.test})?${i}:`:i}),ye(t)===":"&&(t+="null"),t}function zN(e,t,n,i,r,o){const s={};o=o||{},o.encoders={$encode:s},e=BQ(e,t,n,i,r.config);for(const a in e)s[a]=HQ(e[a],t,o,r);return o}function HQ(e,t,n,i){const r={},o={};for(const s in e)e[s]!=null&&(r[s]=YQ(GQ(e[s]),i,n,o));return{$expr:{marktype:t,channels:r},$fields:Object.keys(o),$output:Object.keys(e)}}function GQ(e){return z(e)?WQ(e):Op(e)}function YQ(e,t,n,i){const r=ir(e,t);return r.$fields.forEach(o=>i[o]=1),ae(n,r.$params),r.$expr}const VQ="outer",XQ=["value","update","init","react","bind"];function o$(e,t){O(e+' for "outer" push: '+j(t))}function PN(e,t){const n=e.name;if(e.push===VQ)t.signals[n]||o$("No prior signal definition",n),XQ.forEach(i=>{e[i]!==void 0&&o$("Invalid property ",i)});else{const i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Ny(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function Rp(e,t,n,i){return new Ny(e,t,n,i)}function fg(e,t){return Rp("operator",e,t)}function Z(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Ic(e,t){return t?{$field:e,$name:t}:{$field:e}}const Oy=Ic("key");function s$(e,t){return{$compare:e,$order:t}}function KQ(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const JQ="ascending",QQ="descending";function ZQ(e){return G(e)?(e.order===QQ?"-":"+")+zp(e.op,e.field):""}function zp(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const V2="scope",Ry="view";function rt(e){return e&&e.signal}function eZ(e){return e&&e.expr}function qd(e){if(rt(e))return!0;if(G(e)){for(const t in e)if(qd(e[t]))return!0}return!1}function ci(e,t){return e??t}function zs(e){return e&&e.signal||e}const a$="timer";function Bc(e,t){return(e.merge?nZ:e.stream?iZ:e.type?rZ:O("Invalid stream specification: "+j(e)))(e,t)}function tZ(e){return e===V2?Ry:e||Ry}function nZ(e,t){const n=e.merge.map(r=>Bc(r,t)),i=X2({merge:n},e,t);return t.addStream(i).id}function iZ(e,t){const n=Bc(e.stream,t),i=X2({stream:n},e,t);return t.addStream(i).id}function rZ(e,t){let n;e.type===a$?(n=t.event(a$,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(tZ(e.source),e.type);const i=X2({stream:n},e,t);return Object.keys(i).length===1?n:t.addStream(i).id}function X2(e,t,n){let i=t.between;return i&&(i.length!==2&&O('Stream "between" parameter must have 2 entries: '+j(t)),e.between=[Bc(i[0],n),Bc(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(oZ(t.marktype,t.markname,t.markrole)),t.source===V2&&i.push("inScope(event.item)"),i.length&&(e.filter=ir("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function oZ(e,t,n){const i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}const sZ={code:"_.$value",ast:{type:"Identifier",value:"value"}};function aZ(e,t,n){const i=e.encode,r={target:n};let o=e.events,s=e.update,a=[];o||O("Signal update missing events specification."),Y(o)&&(o=Qo(o,t.isSubscope()?V2:Ry)),o=H(o).filter(u=>u.signal||u.scale?(a.push(u),0):1),a.length>1&&(a=[lZ(a)]),o.length&&a.push(o.length>1?{merge:o}:o[0]),i!=null&&(s&&O("Signal encode and update are mutually exclusive."),s="encode(item(),"+j(i)+")"),r.update=Y(s)?ir(s,t):s.expr!=null?ir(s.expr,t):s.value!=null?s.value:s.signal!=null?{$expr:sZ,$params:{$value:t.signalRef(s.signal)}}:O("Invalid signal update specification."),e.force&&(r.options={force:!0}),a.forEach(u=>t.addUpdate(ae(uZ(u,t),r)))}function uZ(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Bc(e,t)}}function lZ(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function cZ(e,t){const n=t.getSignal(e.name);let i=e.update;e.init&&(i?O("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=ir(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(r=>aZ(r,t,n.id))}const De=e=>(t,n,i)=>Rp(e,n,t||void 0,i),LN=De("aggregate"),fZ=De("axisticks"),IN=De("bound"),Mi=De("collect"),u$=De("compare"),dZ=De("datajoin"),BN=De("encode"),hZ=De("expression"),gZ=De("facet"),pZ=De("field"),mZ=De("key"),yZ=De("legendentries"),bZ=De("load"),xZ=De("mark"),vZ=De("multiextent"),wZ=De("multivalues"),_Z=De("overlap"),SZ=De("params"),UN=De("prefacet"),EZ=De("projection"),kZ=De("proxy"),$Z=De("relay"),jN=De("render"),AZ=De("scale"),ma=De("sieve"),CZ=De("sortitems"),qN=De("viewlayout"),MZ=De("values");let FZ=0;const WN={min:"min",max:"max",count:"sum"};function DZ(e,t){const n=e.type||"linear";O3(n)||O("Unrecognized scale type: "+j(n)),t.addScale(e.name,{type:n,domain:void 0})}function TZ(e,t){const n=t.getScale(e.name).params;let i;n.domain=HN(e.domain,e,t),e.range!=null&&(n.range=YN(e,t,n)),e.interpolate!=null&&jZ(e.interpolate,n),e.nice!=null&&(n.nice=UZ(e.nice)),e.bins!=null&&(n.bins=BZ(e.bins,t));for(i in e)ne(n,i)||i==="name"||(n[i]=Gn(e[i],t))}function Gn(e,t){return G(e)?e.signal?t.signalRef(e.signal):O("Unsupported object: "+j(e)):e}function Wd(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Gn(n,t))}function Pp(e){O("Can not find data set: "+j(e))}function HN(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&O("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(z(e)?NZ:e.fields?RZ:OZ)(e,t,n)}function NZ(e,t,n){return e.map(i=>Gn(i,n))}function OZ(e,t,n){const i=n.getData(e.data);return i||Pp(e.data),pu(t.type)?i.valuesRef(n,e.field,GN(e.sort,!1)):P3(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function RZ(e,t,n){const i=e.data,r=e.fields.reduce((o,s)=>(s=Y(s)?{data:i,field:s}:z(s)||s.signal?zZ(s,n):s,o.push(s),o),[]);return(pu(t.type)?PZ:P3(t.type)?LZ:IZ)(e,n,r)}function zZ(e,t){const n="_:vega:_"+FZ++,i=Mi({});if(z(e))i.value={$ingest:e};else if(e.signal){const r="setdata("+j(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,ma({})]),{data:n,field:"data"}}function PZ(e,t,n){const i=GN(e.sort,!0);let r,o;const s=n.map(l=>{const c=t.getData(l.data);return c||Pp(l.data),c.countsRef(t,l.field,i)}),a={groupby:Oy,pulse:s};i&&(r=i.op||"count",o=i.field?zp(r,i.field):"count",a.ops=[WN[r]],a.fields=[t.fieldRef(o)],a.as=[o]),r=t.add(LN(a));const u=t.add(Mi({pulse:Z(r)}));return o=t.add(MZ({field:Oy,sort:t.sortRef(i),pulse:Z(u)})),Z(o)}function GN(e,t){return e&&(!e.field&&!e.op?G(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?O("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!WN[e.op]&&O("Multiple domain scales can not be sorted using "+e.op)),e}function LZ(e,t,n){const i=n.map(r=>{const o=t.getData(r.data);return o||Pp(r.data),o.domainRef(t,r.field)});return Z(t.add(wZ({values:i})))}function IZ(e,t,n){const i=n.map(r=>{const o=t.getData(r.data);return o||Pp(r.data),o.extentRef(t,r.field)});return Z(t.add(vZ({extents:i})))}function BZ(e,t){return e.signal||z(e)?Wd(e,t):t.objectProperty(e)}function UZ(e){return G(e)?{interval:Gn(e.interval),step:Gn(e.step)}:Gn(e)}function jZ(e,t){t.interpolate=Gn(e.type||e),e.gamma!=null&&(t.interpolateGamma=Gn(e.gamma))}function YN(e,t,n){const i=t.config.range;let r=e.range;if(r.signal)return t.signalRef(r.signal);if(Y(r)){if(i&&ne(i,r))return e=ae({},e,{range:i[r]}),YN(e,t,n);r==="width"?r=[0,{signal:"width"}]:r==="height"?r=pu(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:O("Unrecognized scale range value: "+j(r))}else if(r.scheme){n.scheme=z(r.scheme)?Wd(r.scheme,t):Gn(r.scheme,t),r.extent&&(n.schemeExtent=Wd(r.extent,t)),r.count&&(n.schemeCount=Gn(r.count,t));return}else if(r.step){n.rangeStep=Gn(r.step,t);return}else{if(pu(e.type)&&!z(r))return HN(r,e,t);z(r)||O("Unsupported range type: "+j(r))}return r.map(o=>(z(o)?Wd:Gn)(o,t))}function qZ(e,t){const n=t.config.projection||{},i={};for(const r in e)r!=="name"&&(i[r]=zy(e[r],r,t));for(const r in n)i[r]==null&&(i[r]=zy(n[r],r,t));t.addProjection(e.name,i)}function zy(e,t,n){return z(e)?e.map(i=>zy(i,t,n)):G(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:O("Unsupported parameter object: "+j(e)):e}const Fi="top",Qu="left",Zu="right",Io="bottom",VN="center",WZ="vertical",HZ="start",GZ="middle",YZ="end",Py="index",K2="label",VZ="offset",Eu="perc",XZ="perc2",Vn="value",Ef="guide-label",J2="guide-title",KZ="group-title",JZ="group-subtitle",l$="symbol",Hd="gradient",Ly="discrete",Iy="size",QZ="shape",ZZ="fill",eee="stroke",tee="strokeWidth",nee="strokeDash",iee="opacity",Q2=[Iy,QZ,ZZ,eee,tee,nee,iee],kf={name:1,style:1,interactive:1},be={value:0},Xn={value:1},Lp="group",XN="rect",Z2="rule",ree="symbol",ya="text";function Uc(e){return e.type=Lp,e.interactive=e.interactive||!1,e}function En(e,t){const n=(i,r)=>ci(e[i],ci(t[i],r));return n.isVertical=i=>WZ===ci(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>ci(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>ci(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>ci(e.columns,ci(t.columns,+n.isVertical(!0))),n}function KN(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function oee(e,t,n){const i=t.config.style[n];return i&&i[e]}function Ip(e,t,n){return`item.anchor === '${HZ}' ? ${e} : item.anchor === '${YZ}' ? ${t} : ${n}`}const ew=Ip(j(Qu),j(Zu),j(VN));function see(e){const t=e("tickBand");let n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},G(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function JN(e,t){return t?e?G(e)?Object.assign({},e,{offset:JN(e.offset,t)}):{value:e,offset:t}:t:e}function Pn(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Ju(e.encode,t,kf)):e.interactive=!1,e}function aee(e,t,n,i){const r=En(e,n),o=r.isVertical(),s=r.gradientThickness(),a=r.gradientLength();let u,l,c,f,d;o?(l=[0,1],c=[0,0],f=s,d=a):(l=[0,0],c=[1,0],f=a,d=s);const h={enter:u={opacity:be,x:be,y:be,width:ht(f),height:ht(d)},update:ae({},u,{opacity:Xn,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:be}};return kt(h,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),Pn({type:XN,role:OQ,encode:h},i)}function uee(e,t,n,i,r){const o=En(e,n),s=o.isVertical(),a=o.gradientThickness(),u=o.gradientLength();let l,c,f,d,h="";s?(l="y",f="y2",c="x",d="width",h="1-"):(l="x",f="x2",c="y",d="height");const g={opacity:be,fill:{scale:t,field:Vn}};g[l]={signal:h+"datum."+Eu,mult:u},g[c]=be,g[f]={signal:h+"datum."+XZ,mult:u},g[d]=ht(a);const p={enter:g,update:ae({},g,{opacity:Xn}),exit:{opacity:be}};return kt(p,{stroke:o("gradientStrokeColor"),strokeWidth:o("gradientStrokeWidth")},{opacity:o("gradientOpacity")}),Pn({type:XN,role:TQ,key:Vn,from:r,encode:p},i)}const lee=`datum.${Eu}<=0?"${Qu}":datum.${Eu}>=1?"${Zu}":"${VN}"`,cee=`datum.${Eu}<=0?"${Io}":datum.${Eu}>=1?"${Fi}":"${GZ}"`;function c$(e,t,n,i){const r=En(e,t),o=r.isVertical(),s=ht(r.gradientThickness()),a=r.gradientLength();let u=r("labelOverlap"),l,c,f,d,h="";const g={enter:l={opacity:be},update:c={opacity:Xn,text:{field:K2}},exit:{opacity:be}};return kt(g,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:ci(e.labelLimit,t.gradientLabelLimit)}),o?(l.align={value:"left"},l.baseline=c.baseline={signal:cee},f="y",d="x",h="1-"):(l.align=c.align={signal:lee},l.baseline={value:"top"},f="x",d="y"),l[f]=c[f]={signal:h+"datum."+Eu,mult:a},l[d]=c[d]=s,s.offset=ci(e.labelOffset,t.gradientLabelOffset)||0,u=u?{separation:r("labelSeparation"),method:u,order:"datum."+Py}:void 0,Pn({type:ya,role:TN,style:Ef,key:Vn,from:i,encode:g,overlap:u},n)}function fee(e,t,n,i,r){const o=En(e,t),s=n.entries,a=!!(s&&s.interactive),u=s?s.name:void 0,l=o("clipHeight"),c=o("symbolOffset"),f={data:"value"},d=`(${r}) ? datum.${VZ} : datum.${Iy}`,h=l?ht(l):{field:Iy},g=`datum.${Py}`,p=`max(1, ${r})`;let m,y,b,x,v;h.mult=.5,m={enter:y={opacity:be,x:{signal:d,mult:.5,offset:c},y:h},update:b={opacity:Xn,x:y.x,y:y.y},exit:{opacity:be}};let w=null,S=null;e.fill||(w=t.symbolBaseFillColor,S=t.symbolBaseStrokeColor),kt(m,{fill:o("symbolFillColor",w),shape:o("symbolType"),size:o("symbolSize"),stroke:o("symbolStrokeColor",S),strokeDash:o("symbolDash"),strokeDashOffset:o("symbolDashOffset"),strokeWidth:o("symbolStrokeWidth")},{opacity:o("symbolOpacity")}),Q2.forEach(k=>{e[k]&&(b[k]=y[k]={scale:e[k],field:Vn})});const _=Pn({type:ree,role:RQ,key:Vn,from:f,clip:l?!0:void 0,encode:m},n.symbols),E=ht(c);E.offset=o("labelOffset"),m={enter:y={opacity:be,x:{signal:d,offset:E},y:h},update:b={opacity:Xn,text:{field:K2},x:y.x,y:y.y},exit:{opacity:be}},kt(m,{align:o("labelAlign"),baseline:o("labelBaseline"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontStyle:o("labelFontStyle"),fontWeight:o("labelFontWeight"),limit:o("labelLimit")});const A=Pn({type:ya,role:TN,style:Ef,key:Vn,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:be,height:l?ht(l):be,opacity:be},exit:{opacity:be},update:b={opacity:Xn,row:{signal:null},column:{signal:null}}},o.isVertical(!0)?(x=`ceil(item.mark.items.length / ${p})`,b.row.signal=`${g}%${x}`,b.column.signal=`floor(${g} / ${x})`,v={field:["row",g]}):(b.row.signal=`floor(${g} / ${p})`,b.column.signal=`${g} % ${p}`,v={field:g}),b.column.signal=`(${r})?${b.column.signal}:${g}`,i={facet:{data:i,name:"value",groupby:Py}},Uc({role:Y2,from:i,encode:Ju(m,s,kf),marks:[_,A],name:u,interactive:a,sort:v})}function dee(e,t){const n=En(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const tw='item.orient === "left"',nw='item.orient === "right"',Bp=`(${tw} || ${nw})`,hee=`datum.vgrad && ${Bp}`,gee=Ip('"top"','"bottom"','"middle"'),pee=Ip('"right"','"left"','"center"'),mee=`datum.vgrad && ${nw} ? (${pee}) : (${Bp} && !(datum.vgrad && ${tw})) ? "left" : ${ew}`,yee=`item._anchor || (${Bp} ? "middle" : "start")`,bee=`${hee} ? (${tw} ? -90 : 90) : 0`,xee=`${Bp} ? (datum.vgrad ? (${nw} ? "bottom" : "top") : ${gee}) : "top"`;function vee(e,t,n,i){const r=En(e,t),o={enter:{opacity:be},update:{opacity:Xn,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:be}};return kt(o,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:yee},angle:{signal:bee},align:{signal:mee},baseline:{signal:xee},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),Pn({type:ya,role:zQ,style:J2,from:i,encode:o},n)}function wee(e,t){let n;return G(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+f$(e.path)+")":e.sphere&&(n="geoShape("+f$(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function f$(e){return G(e)&&e.signal?e.signal:j(e)}function QN(e){const t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===Lp?Y2:t||H2}function _ee(e){return{marktype:e.type,name:e.name||void 0,role:e.role||QN(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function See(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function iw(e,t){const n=OM(e.type);n||O("Unrecognized transform type: "+j(e.type));const i=Rp(n.type.toLowerCase(),null,ZN(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function ZN(e,t,n){const i={},r=e.params.length;for(let o=0;o<r;++o){const s=e.params[o];i[s.name]=Eee(s,t,n)}return i}function Eee(e,t,n){const i=e.type,r=t[e.name];if(i==="index")return kee(e,t,n);if(r===void 0){e.required&&O("Missing required "+j(t.type)+" parameter: "+j(e.name));return}else{if(i==="param")return $ee(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!rt(r)?r.map(o=>d$(e,o,n)):d$(e,r,n)}function d$(e,t,n){const i=e.type;if(rt(t))return g$(i)?O("Expression references can not be signals."):z0(i)?n.fieldRef(t):p$(i)?n.compareRef(t):n.signalRef(t.signal);{const r=e.expr||z0(i);return r&&Aee(t)?n.exprRef(t.expr,t.as):r&&Cee(t)?Ic(t.field,t.as):g$(i)?ir(t,n):Mee(i)?Z(n.getData(t).values):z0(i)?Ic(t):p$(i)?n.compareRef(t):t}}function kee(e,t,n){return Y(t.from)||O('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function $ee(e,t,n){const i=t[e.name];return e.array?(z(i)||O("Expected an array of sub-parameters. Instead: "+j(i)),i.map(r=>h$(e,r,n))):h$(e,i,n)}function h$(e,t,n){const i=e.params.length;let r;for(let s=0;s<i;++s){r=e.params[s];for(const a in r.key)if(r.key[a]!==t[a]){r=null;break}if(r)break}r||O("Unsupported parameter: "+j(t));const o=ae(ZN(r,t,n),r.key);return Z(n.add(SZ(o)))}const Aee=e=>e&&e.expr,Cee=e=>e&&e.field,Mee=e=>e==="data",g$=e=>e==="expr",z0=e=>e==="field",p$=e=>e==="compare";function Fee(e,t,n){let i,r,o,s,a;return e?(i=e.facet)&&(t||O("Only group marks can be faceted."),i.field!=null?s=a=Gd(i,n):(e.data?a=Z(n.getData(e.data).aggregate):(o=iw(ae({type:"aggregate",groupby:H(i.groupby)},i.aggregate),n),o.params.key=n.keyRef(i.groupby),o.params.pulse=Gd(i,n),s=a=Z(n.add(o))),r=n.keyRef(i.groupby,!0))):s=Z(n.add(Mi(null,[{}]))),s||(s=Gd(e,n)),{key:r,pulse:s,parent:a}}function Gd(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Z(t.getData(e.data).output)}function Js(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}Js.fromEntries=function(e,t){const n=t.length,i=t[n-1],r=t[n-2];let o=t[0],s=null,a=1;for(o&&o.type==="load"&&(o=t[1]),e.add(t[0]);a<n;++a)t[a].params.pulse=Z(t[a-1]),e.add(t[a]),t[a].type==="aggregate"&&(s=t[a]);return new Js(e,o,r,i,s)};function eO(e){return Y(e)?e:null}function m$(e,t,n){const i=zp(n.op,n.field);let r;if(t.ops){for(let o=0,s=t.as.length;o<s;++o)if(t.as[o]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function El(e,t,n,i,r,o,s){const a=t[n]||(t[n]={}),u=ZQ(o);let l=eO(r),c,f;if(l!=null&&(e=t.scope,l=l+(u?"|"+u:""),c=a[l]),!c){const d=o?{field:Oy,pulse:t.countsRef(e,r,o)}:{field:e.fieldRef(r),pulse:Z(t.output)};u&&(d.sort=e.sortRef(o)),f=e.add(Rp(i,void 0,d)),s&&(t.index[r]=f),c=Z(f),l!=null&&(a[l]=c)}return c}Js.prototype={countsRef(e,t,n){const i=this,r=i.counts||(i.counts={}),o=eO(t);let s,a,u;return o!=null&&(e=i.scope,s=r[o]),s?n&&n.field&&m$(e,s.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:Z(i.output)},n&&n.field&&m$(e,u,n),a=e.add(LN(u)),s=e.add(Mi({pulse:Z(a)})),s={agg:a,ref:Z(s)},o!=null&&(r[o]=s)),s.ref},tuplesRef(){return Z(this.values)},extentRef(e,t){return El(e,this,"extent","extent",t,!1)},domainRef(e,t){return El(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return El(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return El(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return El(e,this,"indata","tupleindex",t,!0,!0)}};function Dee(e,t,n){const i=e.from.facet,r=i.name,o=Gd(i,t);let s;i.name||O("Facet must have a name: "+j(i)),i.data||O("Facet must reference a data set: "+j(i)),i.field?s=t.add(UN({field:t.fieldRef(i.field),pulse:o})):i.groupby?s=t.add(gZ({key:t.keyRef(i.groupby),group:Z(t.proxy(n.parent)),pulse:o})):O("Facet must specify groupby or field: "+j(i));const a=t.fork(),u=a.add(Mi()),l=a.add(ma({pulse:Z(u)}));a.addData(r,new Js(a,u,u,l)),a.addSignal("parent",null),s.params.subflow={$subflow:a.parse(e).toRuntime()}}function Tee(e,t,n){const i=t.add(UN({pulse:n.pulse})),r=t.fork();r.add(ma()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function tO(e,t,n){const i=e.remove,r=e.insert,o=e.toggle,s=e.modify,a=e.values,u=t.add(fg()),l="if("+e.trigger+',modify("'+n+'",'+[r,i,o,s,a].map(f=>f??"null").join(",")+"),0)",c=ir(l,t);u.update=c.$expr,u.params=c.$params}function Up(e,t){const n=QN(e),i=e.type===Lp,r=e.from&&e.from.facet,o=e.overlap;let s=e.layout||n===Y2||n===G2,a,u,l,c,f,d,h;const g=n===H2||s||r,p=Fee(e.from,i,t);u=t.add(dZ({key:p.key||(e.key?Ic(e.key):void 0),pulse:p.pulse,clean:!i}));const m=Z(u);u=l=t.add(Mi({pulse:m})),u=t.add(xZ({markdef:_ee(e),interactive:See(e.interactive,t),clip:wee(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Z(u)}));const y=Z(u);u=c=t.add(BN(zN(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(S=>{const _=iw(S,t),E=_.metadata;(E.generates||E.changes)&&O("Mark transforms should not generate new data."),E.nomod||(c.params.mod=!0),_.params.pulse=Z(u),t.add(u=_)}),e.sort&&(u=t.add(CZ({sort:t.compareRef(e.sort),pulse:Z(u)})));const b=Z(u);(r||s)&&(s=t.add(qN({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),d=Z(s));const x=t.add(IN({mark:y,pulse:d||b}));h=Z(x),i&&(g&&(a=t.operators,a.pop(),s&&a.pop()),t.pushState(b,d||h,m),r?Dee(e,t,p):g?Tee(e,t,p):t.parse(e),t.popState(),g&&(s&&a.push(s),a.push(x))),o&&(h=Nee(o,h,t));const v=t.add(jN({pulse:h})),w=t.add(ma({pulse:Z(v)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new Js(t,l,v,w)),e.on&&e.on.forEach(S=>{(S.insert||S.remove||S.toggle)&&O("Marks only support modify triggers."),tO(S,t,f)}))}function Nee(e,t,n){const i=e.method,r=e.bound,o=e.separation,s={separation:rt(o)?n.signalRef(o.signal):o,method:rt(i)?n.signalRef(i.signal):i,pulse:t};if(e.order&&(s.sort=n.compareRef({field:e.order})),r){const a=r.tolerance;s.boundTolerance=rt(a)?n.signalRef(a.signal):+a,s.boundScale=n.scaleRef(r.scale),s.boundOrient=r.orient}return Z(n.add(_Z(s)))}function Oee(e,t){const n=t.config.legend,i=e.encode||{},r=En(e,n),o=i.legend||{},s=o.name||void 0,a=o.interactive,u=o.style,l={};let c=0,f,d,h;Q2.forEach(x=>e[x]?(l[x]=e[x],c=c||e[x]):0),c||O("Missing valid scale for legend.");const g=Ree(e,t.scaleType(c)),p={title:e.title!=null,scales:l,type:g,vgrad:g!=="symbol"&&r.isVertical()},m=Z(t.add(Mi(null,[p]))),y={enter:{x:{value:0},y:{value:0}}},b=Z(t.add(yZ(d={type:g,scale:t.scaleRef(c),count:t.objectProperty(r("tickCount")),limit:t.property(r("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return g===Hd?(h=[aee(e,c,n,i.gradient),c$(e,n,i.labels,b)],d.count=d.count||t.signalRef(`max(2,2*floor((${zs(r.gradientLength())})/100))`)):g===Ly?h=[uee(e,c,n,i.gradient,b),c$(e,n,i.labels,b)]:(f=dee(e,n),h=[fee(e,n,i,b,zs(f.columns))],d.size=Lee(e,t,h[0].marks)),h=[Uc({role:NQ,from:m,encode:y,marks:h,layout:f,interactive:a})],p.title&&h.push(vee(e,n,i.title,m)),Up(Uc({role:DQ,from:m,encode:Ju(Pee(r,e,n),o,kf),marks:h,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:s,interactive:a,style:u}),t)}function Ree(e,t){let n=e.type||l$;return!e.type&&zee(e)===1&&(e.fill||e.stroke)&&(n=Zx(t)?Hd:M1(t)?Ly:l$),n!==Hd?n:M1(t)?Ly:Hd}function zee(e){return Q2.reduce((t,n)=>t+(e[n]?1:0),0)}function Pee(e,t,n){const i={enter:{},update:{}};return kt(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function Lee(e,t,n){const i=zs(y$("size",e,n)),r=zs(y$("strokeWidth",e,n)),o=zs(Iee(n[1].encode,t,Ef));return ir(`max(ceil(sqrt(${i})+${r}),${o})`,t)}function y$(e,t,n){return t[e]?`scale("${t[e]}",datum)`:KN(e,n[0].encode)}function Iee(e,t,n){return KN("fontSize",e)||oee("fontSize",t,n)}const Bee=`item.orient==="${Qu}"?-90:item.orient==="${Zu}"?90:0`;function Uee(e,t){e=Y(e)?{text:e}:e;const n=En(e,t.config.title),i=e.encode||{},r=i.group||{},o=r.name||void 0,s=r.interactive,a=r.style,u=[],l={},c=Z(t.add(Mi(null,[l])));return u.push(Wee(e,n,jee(e),c)),e.subtitle&&u.push(Hee(e,n,i.subtitle,c)),Up(Uc({role:PQ,from:c,encode:qee(n,r),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:o,interactive:s,style:a}),t)}function jee(e){const t=e.encode;return t&&t.title||ae({name:e.name,interactive:e.interactive,style:e.style},t)}function qee(e,t){const n={enter:{},update:{}};return kt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:ew},angle:{signal:Bee},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Ju(n,t,kf)}function Wee(e,t,n,i){const r={value:0},o=e.text,s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return kt(s,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Pn({type:ya,role:LQ,style:KZ,from:i,encode:s},n)}function Hee(e,t,n,i){const r={value:0},o=e.subtitle,s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return kt(s,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Pn({type:ya,role:IQ,style:JZ,from:i,encode:s},n)}function Gee(e,t){const n=[];e.transform&&e.transform.forEach(i=>{n.push(iw(i,t))}),e.on&&e.on.forEach(i=>{tO(i,t,e.name)}),t.addDataPipeline(e.name,Yee(e,t,n))}function Yee(e,t,n){const i=[];let r=null,o=!1,s=!1,a,u,l,c,f;for(e.values?rt(e.values)||qd(e.format)?(i.push(b$(t,e)),i.push(r=fs())):i.push(r=fs({$ingest:e.values,$format:e.format})):e.url?qd(e.url)||qd(e.format)?(i.push(b$(t,e)),i.push(r=fs())):i.push(r=fs({$request:e.url,$format:e.format})):e.source&&(r=a=H(e.source).map(d=>Z(t.getData(d).output)),i.push(null)),u=0,l=n.length;u<l;++u)c=n[u],f=c.metadata,!r&&!f.source&&i.push(r=fs()),i.push(c),f.generates&&(s=!0),f.modifies&&!s&&(o=!0),f.source?r=c:f.changes&&(r=null);return a&&(l=a.length-1,i[0]=$Z({derive:o,pulse:l?a:a[0]}),(o||l)&&i.splice(1,0,fs())),r||i.push(fs()),i.push(ma({})),i}function fs(e){const t=Mi({},e);return t.metadata={source:!0},t}function b$(e,t){return bZ({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const nO=e=>e===Io||e===Fi,jp=(e,t,n)=>rt(e)?Jee(e.signal,t,n):e===Qu||e===Fi?t:n,gt=(e,t,n)=>rt(e)?Xee(e.signal,t,n):nO(e)?t:n,vi=(e,t,n)=>rt(e)?Kee(e.signal,t,n):nO(e)?n:t,iO=(e,t,n)=>rt(e)?Qee(e.signal,t,n):e===Fi?{value:t}:{value:n},Vee=(e,t,n)=>rt(e)?Zee(e.signal,t,n):e===Zu?{value:t}:{value:n},Xee=(e,t,n)=>rO(`${e} === '${Fi}' || ${e} === '${Io}'`,t,n),Kee=(e,t,n)=>rO(`${e} !== '${Fi}' && ${e} !== '${Io}'`,t,n),Jee=(e,t,n)=>rw(`${e} === '${Qu}' || ${e} === '${Fi}'`,t,n),Qee=(e,t,n)=>rw(`${e} === '${Fi}'`,t,n),Zee=(e,t,n)=>rw(`${e} === '${Zu}'`,t,n),rO=(e,t,n)=>(t=t!=null?ht(t):t,n=n!=null?ht(n):n,x$(t)&&x$(n)?(t=t?t.signal||j(t.value):null,n=n?n.signal||j(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[ae({test:e},t)].concat(n||[])),x$=e=>e==null||Object.keys(e).length===1,rw=(e,t,n)=>({signal:`${e} ? (${Ya(t)}) : (${Ya(n)})`}),ete=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${Qu}' ? (${Ya(i)}) : `:"")+(n!=null?`${e} === '${Io}' ? (${Ya(n)}) : `:"")+(r!=null?`${e} === '${Zu}' ? (${Ya(r)}) : `:"")+(t!=null?`${e} === '${Fi}' ? (${Ya(t)}) : `:"")+"(null)"}),Ya=e=>rt(e)?e.signal:e==null?null:j(e),tte=(e,t)=>t===0?0:rt(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Qa=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Ra(e,t,n,i){let r;if(t&&ne(t,e))return t[e];if(ne(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[J2][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[Ef][r]}return null}function v$(e){const t={};for(const n of e)if(n)for(const i in n)t[i]=1;return Object.keys(t)}function nte(e,t){var n=t.config,i=n.style,r=n.axis,o=t.scaleType(e.scale)==="band"&&n.axisBand,s=e.orient,a,u,l;if(rt(s)){const f=v$([n.axisX,n.axisY]),d=v$([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);a={};for(l of f)a[l]=gt(s,Ra(l,n.axisX,r,i),Ra(l,n.axisY,r,i));u={};for(l of d)u[l]=ete(s.signal,Ra(l,n.axisTop,r,i),Ra(l,n.axisBottom,r,i),Ra(l,n.axisLeft,r,i),Ra(l,n.axisRight,r,i))}else a=s===Fi||s===Io?n.axisX:n.axisY,u=n["axis"+s[0].toUpperCase()+s.slice(1)];return a||u||o?ae({},r,a,u,o):r}function ite(e,t,n,i){const r=En(e,t),o=e.orient;let s,a;const u={enter:s={opacity:be},update:a={opacity:Xn},exit:{opacity:be}};kt(u,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const l=w$(e,0),c=w$(e,1);return s.x=a.x=gt(o,l,be),s.x2=a.x2=gt(o,c),s.y=a.y=vi(o,l,be),s.y2=a.y2=vi(o,c),Pn({type:Z2,role:$Q,from:i,encode:u},n)}function w$(e,t){return{scale:e.scale,range:t}}function rte(e,t,n,i,r){const o=En(e,t),s=e.orient,a=e.gridScale,u=jp(s,1,-1),l=ote(e.offset,u);let c,f,d;const h={enter:c={opacity:be},update:d={opacity:Xn},exit:f={opacity:be}};kt(h,{stroke:o("gridColor"),strokeCap:o("gridCap"),strokeDash:o("gridDash"),strokeDashOffset:o("gridDashOffset"),strokeOpacity:o("gridOpacity"),strokeWidth:o("gridWidth")});const g={scale:e.scale,field:Vn,band:r.band,extra:r.extra,offset:r.offset,round:o("tickRound")},p=gt(s,{signal:"height"},{signal:"width"}),m=a?{scale:a,range:0,mult:u,offset:l}:{value:0,offset:l},y=a?{scale:a,range:1,mult:u,offset:l}:ae(p,{mult:u,offset:l});return c.x=d.x=gt(s,g,m),c.y=d.y=vi(s,g,m),c.x2=d.x2=vi(s,y),c.y2=d.y2=gt(s,y),f.x=gt(s,g),f.y=vi(s,g),Pn({type:Z2,role:AQ,key:Vn,from:i,encode:h},n)}function ote(e,t){if(t!==1)if(!G(e))e=rt(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=ae({},e);for(;n.mult!=null;)if(G(n.mult))n=n.mult=ae({},n.mult);else return n.mult=rt(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function ste(e,t,n,i,r,o){const s=En(e,t),a=e.orient,u=jp(a,-1,1);let l,c,f;const d={enter:l={opacity:be},update:f={opacity:Xn},exit:c={opacity:be}};kt(d,{stroke:s("tickColor"),strokeCap:s("tickCap"),strokeDash:s("tickDash"),strokeDashOffset:s("tickDashOffset"),strokeOpacity:s("tickOpacity"),strokeWidth:s("tickWidth")});const h=ht(r);h.mult=u;const g={scale:e.scale,field:Vn,band:o.band,extra:o.extra,offset:o.offset,round:s("tickRound")};return f.y=l.y=gt(a,be,g),f.y2=l.y2=gt(a,h),c.x=gt(a,g),f.x=l.x=vi(a,be,g),f.x2=l.x2=vi(a,h),c.y=vi(a,g),Pn({type:Z2,role:MQ,key:Vn,from:i,encode:d},n)}function P0(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function ate(e,t,n,i,r,o){const s=En(e,t),a=e.orient,u=e.scale,l=jp(a,-1,1),c=zs(s("labelFlush")),f=zs(s("labelFlushOffset")),d=s("labelAlign"),h=s("labelBaseline");let g=c===0||!!c,p;const m=ht(r);m.mult=l,m.offset=ht(s("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:Vn,band:.5,offset:JN(o.offset,s("labelOffset"))},b=gt(a,g?P0(u,c,'"left"','"right"','"center"'):{value:"center"},Vee(a,"left","right")),x=gt(a,iO(a,"bottom","top"),g?P0(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),v=P0(u,c,`-(${f})`,f,0);g=g&&f;const w={opacity:be,x:gt(a,y,m),y:vi(a,y,m)},S={enter:w,update:p={opacity:Xn,text:{field:K2},x:w.x,y:w.y,align:b,baseline:x},exit:{opacity:be,x:w.x,y:w.y}};kt(S,{dx:!d&&g?gt(a,v):null,dy:!h&&g?vi(a,v):null}),kt(S,{angle:s("labelAngle"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontWeight:s("labelFontWeight"),fontStyle:s("labelFontStyle"),limit:s("labelLimit"),lineHeight:s("labelLineHeight")},{align:d,baseline:h});const _=s("labelBound");let E=s("labelOverlap");return E=E||_?{separation:s("labelSeparation"),method:E,order:"datum.index",bound:_?{scale:u,orient:a,tolerance:_}:null}:void 0,p.align!==b&&(p.align=Qa(p.align,b)),p.baseline!==x&&(p.baseline=Qa(p.baseline,x)),Pn({type:ya,role:CQ,style:Ef,key:Vn,from:i,encode:S,overlap:E},n)}function ute(e,t,n,i){const r=En(e,t),o=e.orient,s=jp(o,-1,1);let a,u;const l={enter:a={opacity:be,anchor:ht(r("titleAnchor",null)),align:{signal:ew}},update:u=ae({},a,{opacity:Xn,text:ht(e.title)}),exit:{opacity:be}},c={signal:`lerp(range("${e.scale}"), ${Ip(0,1,.5)})`};return u.x=gt(o,c),u.y=vi(o,c),a.angle=gt(o,be,tte(s,90)),a.baseline=gt(o,iO(o,Io,Fi),{value:Io}),u.angle=a.angle,u.baseline=a.baseline,kt(l,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),lte(r,o,l,n),l.update.align=Qa(l.update.align,a.align),l.update.angle=Qa(l.update.angle,a.angle),l.update.baseline=Qa(l.update.baseline,a.baseline),Pn({type:ya,role:FQ,style:J2,from:i,encode:l},n)}function lte(e,t,n,i){const r=(a,u)=>a!=null?(n.update[u]=Qa(ht(a),n.update[u]),!1):!Ba(u,i),o=r(e("titleX"),"x"),s=r(e("titleY"),"y");n.enter.auto=s===o?ht(s):gt(t,ht(s),ht(o))}function cte(e,t){const n=nte(e,t),i=e.encode||{},r=i.axis||{},o=r.name||void 0,s=r.interactive,a=r.style,u=En(e,n),l=see(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null},f=Z(t.add(Mi({},[c]))),d=Z(t.add(fZ({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let g;return c.grid&&h.push(rte(e,n,i.grid,d,l)),c.ticks&&(g=u("tickSize"),h.push(ste(e,n,i.ticks,d,g,l))),c.labels&&(g=c.ticks?g:0,h.push(ate(e,n,i.labels,d,g,l))),c.domain&&h.push(ite(e,n,i.domain,f)),c.title&&h.push(ute(e,n,i.title,f)),Up(Uc({role:kQ,from:f,encode:Ju(fte(u,e),r,kf),marks:h,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:o,interactive:s,style:a}),t)}function fte(e,t){const n={enter:{},update:{}};return kt(n,{orient:e("orient"),offset:e("offset")||0,position:ci(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function oO(e,t,n){const i=H(e.signals),r=H(e.scales);return n||i.forEach(o=>PN(o,t)),H(e.projections).forEach(o=>qZ(o,t)),r.forEach(o=>DZ(o,t)),H(e.data).forEach(o=>Gee(o,t)),r.forEach(o=>TZ(o,t)),(n||i).forEach(o=>cZ(o,t)),H(e.axes).forEach(o=>cte(o,t)),H(e.marks).forEach(o=>Up(o,t)),H(e.legends).forEach(o=>Oee(o,t)),e.title&&Uee(e.title,t),t.parseLambdas(),t}const dte=e=>Ju({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function hte(e,t){const n=t.config,i=Z(t.root=t.add(fg())),r=gte(e,n);r.forEach(l=>PN(l,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const o=t.add(Mi()),s=t.add(BN(zN(dte(e.encode),Lp,G2,e.style,t,{pulse:Z(o)}))),a=t.add(qN({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:Z(s)}));t.operators.pop(),t.pushState(Z(s),Z(a),null),oO(e,t,r),t.operators.push(a);let u=t.add(IN({mark:i,pulse:Z(a)}));return u=t.add(jN({pulse:Z(u)})),u=t.add(ma({pulse:Z(u)})),t.addData("root",new Js(t,o,o,u)),t}function kl(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function gte(e,t){const n=s=>ci(e[s],t[s]),i=[kl("background",n("background")),kl("autosize",_Q(n("autosize"))),kl("padding",EQ(n("padding"))),kl("width",n("width")||0),kl("height",n("height")||0)],r=i.reduce((s,a)=>(s[a.name]=a,s),{}),o={};return H(e.signals).forEach(s=>{ne(r,s.name)?s=ae(r[s.name],s):i.push(s),o[s.name]=s}),H(t.signals).forEach(s=>{!ne(o,s.name)&&!ne(r,s.name)&&i.push(s)}),i}function sO(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function _$(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}sO.prototype=_$.prototype={parse(e){return oO(e,this)},fork(){return new _$(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof Ny?Z(e):e;return this.add(kZ({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(i,r,o){let s,a;i&&(s=i.data||(i.data={}),a=s[r]||(s[r]=[]),a.push(o))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(Z(this.add(ma({pulse:e})))),this._parent.push(t),this._lookup.push(n?Z(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return ye(this._parent)},encode(){return ye(this._encode)},lookup(){return ye(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Y(e))return Ic(e,t);e.signal||O("Unsupported field reference: "+j(e));const n=e.signal;let i=this.field[n];if(!i){const r={name:this.signalRef(n)};t&&(r.as=t),this.field[n]=i=Z(this.add(pZ(r)))}return i},compareRef(e){let t=!1;const n=o=>rt(o)?(t=!0,this.signalRef(o.signal)):eZ(o)?(t=!0,this.exprRef(o.expr)):o,i=H(e.field).map(n),r=H(e.order).map(n);return t?Z(this.add(u$({fields:i,orders:r}))):s$(i,r)},keyRef(e,t){let n=!1;const i=o=>rt(o)?(n=!0,Z(r[o.signal])):o,r=this.signals;return e=H(e).map(i),n?Z(this.add(mZ({fields:e,flat:t}))):KQ(e,t)},sortRef(e){if(!e)return e;const t=zp(e.op,e.field),n=e.order||JQ;return n.signal?Z(this.add(u$({fields:t,orders:this.signalRef(n.signal)}))):s$(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return ne(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&O("Duplicate signal name: "+j(e));const n=t instanceof Ny?t:this.add(fg(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||O("Unrecognized signal name: "+j(e)),this.signals[e]},signalRef(e){return this.signals[e]?Z(this.signals[e]):(ne(this.lambdas,e)||(this.lambdas[e]=this.add(fg(null))),Z(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const i=e[t],r=ir(i,this),o=this.lambdas[i];o.params=r.$params,o.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!G(e)?e:this.signalRef(e.signal||ow(e))},exprRef(e,t){const n={expr:ir(e,this)};return t&&(n.expr.$name=t),Z(this.add(hZ(n)))},addBinding(e,t){this.bindings||O("Nested signals do not support binding: "+j(e)),this.bindings.push(ae({signal:e},t))},addScaleProj(e,t){ne(this.scales,e)&&O("Duplicate scale or projection name: "+j(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,AZ(t))},addProjection(e,t){this.addScaleProj(e,EZ(t))},getScale(e){return this.scales[e]||O("Unrecognized scale name: "+j(e)),this.scales[e]},scaleRef(e){return Z(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return ne(this.data,e)&&O("Duplicate data set name: "+j(e)),this.data[e]=t},getData(e){return this.data[e]||O("Undefined data set name: "+j(e)),this.data[e]},addDataPipeline(e,t){return ne(this.data,e)&&O("Duplicate data set name: "+j(e)),this.addData(e,Js.fromEntries(this,t))}};function ow(e){return(z(e)?pte:mte)(e)}function pte(e){const t=e.length;let n="[";for(let i=0;i<t;++i){const r=e[i];n+=(i>0?",":"")+(G(r)?r.signal||ow(r):j(r))}return n+"]"}function mte(e){let t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+j(i)+":"+(G(r)?r.signal||ow(r):j(r));return t+"}"}function yte(){const e="sans-serif",i="#4c78a8",r="#000",o="#888",s="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:2},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:2},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:s},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:o,grid:!1,gridWidth:1,gridColor:s,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:o,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:s,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:o,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function bte(e,t,n){return G(e)||O("Input Vega specification must be an object."),t=Cg(yte(),t,e.config),hte(e,new sO(t,n)).toRuntime()}var xte="5.26.1";ae(lu,g7,Gj,Eq,lH,iG,FY,lY,TY,nV,dV,xV);const mfe=Object.freeze(Object.defineProperty({__proto__:null,Bounds:Qe,CanvasHandler:Po,CanvasRenderer:Mc,DATE:bn,DAY:Nt,DAYOFYEAR:tr,Dataflow:Va,Debug:iC,Error:db,EventStream:jg,Gradient:Q3,GroupItem:fp,HOURS:On,Handler:zo,HybridHandler:Nv,HybridRenderer:Ah,Info:nC,Item:cp,MILLISECONDS:Ei,MINUTES:Rn,MONTH:Lt,Marks:zn,MultiPulse:zb,None:tC,Operator:Te,Parameters:Ug,Pulse:Eo,QUARTER:yn,RenderType:mo,Renderer:In,ResourceLoader:uv,SECONDS:Qn,SVGHandler:$v,SVGRenderer:xp,SVGStringRenderer:Tv,Scenegraph:Ev,TIME_UNITS:$b,Transform:F,View:EN,WEEK:nt,Warn:hb,YEAR:St,accessor:Sn,accessorFields:Pt,accessorName:Ge,array:H,ascending:Dg,bandwidthNRD:Bb,bin:PM,bootstrapCI:LM,boundClip:XD,boundContext:df,boundItem:R1,boundMark:yD,boundStroke:Gr,changeset:da,clampRange:gC,codegenExpression:JT,compare:bb,constant:jt,cumulativeLogNormal:Gb,cumulativeNormal:Wg,cumulativeUniform:Kb,dayofyear:WC,debounce:xb,defaultLocale:Db,definition:OM,densityLogNormal:Hb,densityNormal:Ub,densityUniform:Xb,domChild:tt,domClear:jn,domCreate:go,domFind:kv,dotbin:IM,error:O,expressionFunction:Ke,extend:ae,extent:Qi,extentIndex:pC,falsy:io,fastmap:Bu,field:Kn,flush:mC,font:mp,fontFamily:pf,fontSize:lr,format:Ed,formatLocale:ih,formats:Ob,hasOwnProperty:ne,id:Xc,identity:Ut,inferType:SM,inferTypes:EM,ingest:Ee,inherits:U,inrange:ja,interpolate:ev,interpolateColors:up,interpolateRange:L3,intersect:HD,intersectBoxLine:qa,intersectPath:lv,intersectPoint:cv,intersectRule:sD,isArray:z,isBoolean:ua,isDate:_o,isFunction:ue,isIterable:yC,isNumber:xe,isObject:G,isRegExp:bC,isString:Y,isTuple:Ig,key:vb,lerp:xC,lineHeight:Oo,loader:Pg,locale:wM,logger:gb,lruCache:vC,markup:Dv,merge:wC,mergeConfig:Cg,multiLineOffset:wv,one:Iu,pad:_C,panLinear:uC,panLog:lC,panPow:cC,panSymlog:fC,parse:bte,parseExpression:T2,parseSelector:Qo,path:Xg,pathCurves:ov,pathEqual:KD,pathParse:mu,pathRectangle:tD,pathRender:kc,pathSymbols:eD,pathTrail:nD,peek:ye,point:bp,projection:Qv,quantileLogNormal:Yb,quantileNormal:Hg,quantileUniform:Jb,quantiles:Lb,quantizeInterpolator:I3,quarter:dC,quartiles:Ib,get random(){return Zn},randomInteger:b9,randomKDE:qb,randomLCG:y9,randomLogNormal:UM,randomMixture:jM,randomNormal:jb,randomUniform:qM,read:AM,regressionConstant:Qb,regressionExp:HM,regressionLinear:Zb,regressionLoess:VM,regressionLog:WM,regressionPoly:YM,regressionPow:GM,regressionQuad:ex,renderModule:vp,repeat:Dl,resetDefaultLocale:gP,resetSVGClipId:rD,resetSVGDefIds:cj,responseType:$M,runtimeContext:fN,sampleCurve:Yg,sampleLogNormal:Wb,sampleNormal:qg,sampleUniform:Vb,scale:_e,sceneEqual:Ov,sceneFromJSON:xD,scenePickVisit:bh,sceneToJSON:bD,sceneVisit:ki,sceneZOrder:fv,scheme:tv,serializeXML:zD,setHybridRendererOptions:sj,setRandom:p9,span:Jc,splitAccessPath:ar,stringValue:j,textMetrics:Tn,timeBin:aM,timeFloor:JC,timeFormatLocale:bc,timeInterval:Wu,timeOffset:eM,timeSequence:iM,timeUnitSpecifier:qC,timeUnits:Ab,toBoolean:wb,toDate:_b,toNumber:Ot,toSet:Si,toString:Sb,transform:RM,transforms:lu,truncate:SC,truthy:Jn,tupleid:ee,typeParsers:y1,utcFloor:QC,utcInterval:Hu,utcOffset:tM,utcSequence:rM,utcdayofyear:YC,utcquarter:hC,utcweek:VC,version:xte,visitArray:so,week:HC,writeConfig:Kc,zero:fo,zoomLinear:pb,zoomLog:mb,zoomPow:Jd,zoomSymlog:yb},Symbol.toStringTag,{value:"Module"})),vte="vega-lite",wte='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',_te="5.16.3",Ste=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Ete="https://vega.github.io/vega-lite/",kte="Vega-Lite is a concise high-level language for interactive visualization.",$te=["vega","chart","visualization"],Ate="build/vega-lite.js",Cte="build/vega-lite.min.js",Mte="build/vega-lite.min.js",Fte="build/src/index",Dte="build/src/index.d.ts",Tte={vl2pdf:"./bin/vl2pdf",vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},Nte=["bin","build","src","vega-lite*","tsconfig.json"],Ote={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.mjs","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/","watch:test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest --watch test-runtime/ --config test-runtime/jest-config.json",release:"release-it"},Rte={type:"git",url:"https://github.com/vega/vega-lite.git"},zte="BSD-3-Clause",Pte={url:"https://github.com/vega/vega-lite/issues"},Lte={"@babel/core":"^7.22.10","@babel/plugin-proposal-class-properties":"^7.18.6","@babel/preset-env":"^7.22.10","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-alias":"^5.0.0","@rollup/plugin-babel":"^6.0.3","@rollup/plugin-commonjs":"^25.0.4","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.2.1","@rollup/plugin-terser":"^0.4.3","@types/chai":"^4.3.5","@types/d3":"^7.4.0","@types/jest":"^29.5.4","@types/pako":"^2.0.0","@typescript-eslint/eslint-plugin":"^6.4.1","@typescript-eslint/parser":"^6.4.1",ajv:"^8.12.0","ajv-formats":"^2.1.1",chai:"^4.3.7",cheerio:"^1.0.0-rc.12","conventional-changelog-cli":"^4.0.0",d3:"^7.8.5","del-cli":"^5.0.0",eslint:"^8.47.0","eslint-config-prettier":"^9.0.0","eslint-plugin-jest":"^27.2.3","eslint-plugin-prettier":"^5.0.0","fast-json-stable-stringify":"~2.1.0","highlight.js":"^11.8.0",jest:"^29.6.3","jest-dev-server":"^9.0.0",mkdirp:"^3.0.1",pako:"^2.1.0",prettier:"^3.0.2",puppeteer:"^15.0.0","release-it":"^16.1.5",rollup:"^3.28.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3",serve:"^14.2.1",terser:"^5.19.2","ts-jest":"^29.1.1","ts-json-schema-generator":"^1.3.0",typescript:"~5.2.2","vega-cli":"^5.25.0","vega-datasets":"^2.7.0","vega-embed":"^6.22.2","vega-tooltip":"^0.33.0","yaml-front-matter":"^4.1.1"},Ite={"json-stringify-pretty-compact":"~3.0.0",tslib:"~2.6.2","vega-event-selector":"~3.0.1","vega-expression":"~5.1.0","vega-util":"~1.17.2",yargs:"~17.7.2"},Bte={vega:"^5.24.0"},Ute={node:">=18"},jte={name:vte,author:wte,version:_te,collaborators:Ste,homepage:Ete,description:kte,keywords:$te,main:Ate,unpkg:Cte,jsdelivr:Mte,module:Fte,types:Dte,bin:Tte,files:Nte,scripts:Ote,repository:Rte,license:zte,bugs:Pte,devDependencies:Lte,dependencies:Ite,peerDependencies:Bte,engines:Ute};function sw(e){return!!e.or}function aw(e){return!!e.and}function uw(e){return!!e.not}function Yd(e,t){if(uw(e))Yd(e.not,t);else if(aw(e))for(const n of e.and)Yd(n,t);else if(sw(e))for(const n of e.or)Yd(n,t);else t(e)}function Za(e,t){return uw(e)?{not:Za(e.not,t)}:aw(e)?{and:e.and.map(n=>Za(n,t))}:sw(e)?{or:e.or.map(n=>Za(n,t))}:t(e)}const oe=structuredClone;function aO(e){throw new Error(e)}function ku(e,t){const n={};for(const i of t)ne(e,i)&&(n[i]=e[i]);return n}function pn(e,t){const n={...e};for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Fe(e)).join(",")})`};function ge(e){if(xe(e))return e;const t=Y(e)?e:Fe(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function By(e){return e===!1||e===null}function pe(e,t){return e.includes(t)}function Qs(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function lw(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function uO(e,...t){for(const n of t)qte(e,n??{});return e}function qte(e,t){for(const n of P(t))Kc(e,n,t[n],!0)}function Hi(e,t){const n=[],i={};let r;for(const o of e)r=t(o),!(r in i)&&(i[r]=1,n.push(o));return n}function Wte(e,t){const n=P(e),i=P(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function lO(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function cw(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Uy(e){const t=new Set;for(const n of e){const r=ar(n).map((s,a)=>a===0?s:`[${s}]`),o=r.map((s,a)=>r.slice(0,a+1).join(""));for(const s of o)t.add(s)}return t}function fw(e,t){return e===void 0||t===void 0?!0:cw(Uy(e),Uy(t))}function Me(e){return P(e).length===0}const P=Object.keys,Et=Object.values,Bo=Object.entries;function jc(e){return e===!0||e===!1}function Le(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function fc(e,t){return uw(e)?`!(${fc(e.not,t)})`:aw(e)?`(${e.and.map(n=>fc(n,t)).join(") && (")})`:sw(e)?`(${e.or.map(n=>fc(n,t)).join(") || (")})`:t(e)}function dg(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&dg(e[n],t)&&delete e[n],Me(e)}function $f(e){return e.charAt(0).toUpperCase()+e.substr(1)}function dw(e,t="datum"){const n=ar(e),i=[];for(let r=1;r<=n.length;r++){const o=`[${n.slice(0,r).map(j).join("][")}]`;i.push(`${t}${o}`)}return i.join(" && ")}function cO(e,t="datum"){return`${t}[${j(ar(e).join("."))}]`}function Hte(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ti(e){return`${ar(e).map(Hte).join("\\.")}`}function Zs(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function hw(e){return`${ar(e).join(".")}`}function $u(e){return e?ar(e).length:0}function Ve(...e){for(const t of e)if(t!==void 0)return t}let fO=42;function dO(e){const t=++fO;return e?String(e)+t:t}function Gte(){fO=42}function hO(e){return gO(e)?e:`__${e}`}function gO(e){return e.startsWith("__")}function qc(e){if(e!==void 0)return(e%360+360)%360}function qp(e){return xe(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const S$=Object.getPrototypeOf(structuredClone({}));function Dn(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor.name!==t.constructor.name)return!1;let n,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(i=n;i--!==0;)if(!Dn(e[i],t[i]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(i of e.entries())if(!t.has(i[0]))return!1;for(i of e.entries())if(!Dn(i[1],t.get(i[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(i of e.entries())if(!t.has(i[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(i=n;i--!==0;)if(e[i]!==t[i])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&e.valueOf!==S$.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&e.toString!==S$.toString)return e.toString()===t.toString();const r=Object.keys(e);if(n=r.length,n!==Object.keys(t).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[i]))return!1;for(i=n;i--!==0;){const o=r[i];if(!Dn(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function Fe(e){const t=[];return function n(i){if(i&&i.toJSON&&typeof i.toJSON=="function"&&(i=i.toJSON()),i===void 0)return;if(typeof i=="number")return isFinite(i)?""+i:"null";if(typeof i!="object")return JSON.stringify(i);let r,o;if(Array.isArray(i)){for(o="[",r=0;r<i.length;r++)r&&(o+=","),o+=n(i[r])||"null";return o+"]"}if(i===null)return"null";if(t.includes(i))throw new TypeError("Converting circular structure to JSON");const s=t.push(i)-1,a=Object.keys(i).sort();for(o="",r=0;r<a.length;r++){const u=a[r],l=n(i[u]);l&&(o&&(o+=","),o+=JSON.stringify(u)+":"+l)}return t.splice(s,1),`{${o}}`}(e)}const Pr="row",Lr="column",Wp="facet",Ie="x",bt="y",Di="x2",hr="y2",Zo="xOffset",el="yOffset",Ti="radius",Vr="radius2",ri="theta",Xr="theta2",Ni="latitude",Oi="longitude",Ri="latitude2",ni="longitude2",vn="color",gr="fill",pr="stroke",wn="shape",Kr="size",ba="angle",Jr="opacity",es="fillOpacity",ts="strokeOpacity",ns="strokeWidth",is="strokeDash",Af="text",Au="order",Cf="detail",Hp="key",ea="tooltip",Gp="href",Yp="url",Vp="description",Yte={x:1,y:1,x2:1,y2:1},pO={theta:1,theta2:1,radius:1,radius2:1};function mO(e){return e in pO}const gw={longitude:1,longitude2:1,latitude:1,latitude2:1};function yO(e){switch(e){case Ni:return"y";case Ri:return"y2";case Oi:return"x";case ni:return"x2"}}function bO(e){return e in gw}const Vte=P(gw),pw={...Yte,...pO,...gw,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function eu(e){return e===vn||e===gr||e===pr}const xO={row:1,column:1,facet:1},Yn=P(xO),mw={...pw,...xO},Xte=P(mw),{order:yfe,detail:bfe,tooltip:xfe,...Kte}=mw,{row:vfe,column:wfe,facet:_fe,...Jte}=Kte;function Qte(e){return!!Jte[e]}function vO(e){return!!mw[e]}const Zte=[Di,hr,Ri,ni,Xr,Vr];function wO(e){return xa(e)!==e}function xa(e){switch(e){case Di:return Ie;case hr:return bt;case Ri:return Ni;case ni:return Oi;case Xr:return ri;case Vr:return Ti}return e}function Uo(e){if(mO(e))switch(e){case ri:return"startAngle";case Xr:return"endAngle";case Ti:return"outerRadius";case Vr:return"innerRadius"}return e}function mr(e){switch(e){case Ie:return Di;case bt:return hr;case Ni:return Ri;case Oi:return ni;case ri:return Xr;case Ti:return Vr}}function _n(e){switch(e){case Ie:case Di:return"width";case bt:case hr:return"height"}}function _O(e){switch(e){case Ie:return"xOffset";case bt:return"yOffset";case Di:return"x2Offset";case hr:return"y2Offset";case ri:return"thetaOffset";case Ti:return"radiusOffset";case Xr:return"theta2Offset";case Vr:return"radius2Offset"}}function yw(e){switch(e){case Ie:return"xOffset";case bt:return"yOffset"}}function ene(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const tne=P(pw),{x:Sfe,y:Efe,x2:kfe,y2:$fe,xOffset:Afe,yOffset:Cfe,latitude:Mfe,longitude:Ffe,latitude2:Dfe,longitude2:Tfe,theta:Nfe,theta2:Ofe,radius:Rfe,radius2:zfe,...bw}=pw,nne=P(bw),xw={x:1,y:1},yr=P(xw);function Xe(e){return e in xw}const vw={theta:1,radius:1},ine=P(vw);function Xp(e){return e==="width"?Ie:bt}const SO={xOffset:1,yOffset:1};function Mf(e){return e in SO}const{text:Pfe,tooltip:Lfe,href:Ife,url:Bfe,description:Ufe,detail:jfe,key:qfe,order:Wfe,...EO}=bw,rne=P(EO);function one(e){return!!bw[e]}function sne(e){switch(e){case vn:case gr:case pr:case Kr:case wn:case Jr:case ns:case is:return!0;case es:case ts:case ba:return!1}}const kO={...xw,...vw,...SO,...EO},Kp=P(kO);function Qr(e){return!!kO[e]}function ane(e,t){return lne(e)[t]}const $O={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:Hfe,...une}=$O;function lne(e){switch(e){case vn:case gr:case pr:case Vp:case Cf:case Hp:case ea:case Gp:case Au:case Jr:case es:case ts:case ns:case Wp:case Pr:case Lr:return $O;case Ie:case bt:case Zo:case el:case Ni:case Oi:return une;case Di:case hr:case Ri:case ni:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Kr:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case is:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case wn:return{point:"always",geoshape:"always"};case Af:return{text:"always"};case ba:return{point:"always",square:"always",text:"always"};case Yp:return{image:"always"};case ri:return{text:"always",arc:"always"};case Ti:return{text:"always",arc:"always"};case Xr:case Vr:return{arc:"always"}}}function L0(e){switch(e){case Ie:case bt:case ri:case Ti:case Zo:case el:case Kr:case ba:case ns:case Jr:case es:case ts:case Di:case hr:case Xr:case Vr:return;case Wp:case Pr:case Lr:case wn:case is:case Af:case ea:case Gp:case Yp:case Vp:return"discrete";case vn:case gr:case pr:return"flexible";case Ni:case Oi:case Ri:case ni:case Cf:case Hp:case Au:return}}const cne={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},fne={count:1,min:1,max:1};function Wr(e){return!!e&&!!e.argmin}function rs(e){return!!e&&!!e.argmax}function ww(e){return Y(e)&&!!cne[e]}const dne=new Set(["count","valid","missing","distinct"]);function AO(e){return Y(e)&&dne.has(e)}function hne(e){return Y(e)&&pe(["min","max"],e)}const gne=new Set(["count","sum","distinct","valid","missing"]),pne=new Set(["mean","average","median","q1","q3","min","max"]);function CO(e){return ua(e)&&(e=um(e,void 0)),"bin"+P(e).map(t=>Jp(e[t])?Le(`_${t}_${Bo(e[t])}`):Le(`_${t}_${e[t]}`)).join("")}function Oe(e){return e===!0||va(e)&&!e.binned}function vt(e){return e==="binned"||va(e)&&e.binned===!0}function va(e){return G(e)}function Jp(e){return e?.param}function E$(e){switch(e){case Pr:case Lr:case Kr:case vn:case gr:case pr:case ns:case Jr:case es:case ts:case wn:return 6;case is:return 4;default:return 10}}function Ff(e){return!!e?.expr}function dn(e){const t=P(e||{}),n={};for(const i of t)n[i]=Cn(e[i]);return n}function MO(e){const{anchor:t,frame:n,offset:i,orient:r,angle:o,limit:s,color:a,subtitleColor:u,subtitleFont:l,subtitleFontSize:c,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:h,subtitlePadding:g,...p}=e,m={...p,...a?{fill:a}:{}},y={...t?{anchor:t}:{},...n?{frame:n}:{},...i?{offset:i}:{},...r?{orient:r}:{},...o!==void 0?{angle:o}:{},...s!==void 0?{limit:s}:{}},b={...u?{subtitleColor:u}:{},...l?{subtitleFont:l}:{},...c?{subtitleFontSize:c}:{},...f?{subtitleFontStyle:f}:{},...d?{subtitleFontWeight:d}:{},...h?{subtitleLineHeight:h}:{},...g?{subtitlePadding:g}:{}},x=ku(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:x,nonMarkTitleProperties:y,subtitle:b}}function co(e){return Y(e)||z(e)&&Y(e[0])}function Q(e){return!!e?.signal}function os(e){return!!e.step}function mne(e){return z(e)?!1:"fields"in e&&!("data"in e)}function yne(e){return z(e)?!1:"fields"in e&&"data"in e}function Nr(e){return z(e)?!1:"field"in e&&"data"in e}const bne={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},xne=P(bne),vne={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},jy=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function FO(e){const t=z(e.condition)?e.condition.map(k$):k$(e.condition);return{...Cn(e),condition:t}}function Cn(e){if(Ff(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function k$(e){if(Ff(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function ze(e){if(Ff(e)){const{expr:t,...n}=e;return{signal:t,...n}}return Q(e)?e:e!==void 0?{value:e}:void 0}function wne(e){return Q(e)?e.signal:j(e)}function $$(e){return Q(e)?e.signal:j(e.value)}function yi(e){return Q(e)?e.signal:e==null?null:j(e)}function _ne(e,t,n){for(const i of n){const r=Hr(i,t.markDef,t.config);r!==void 0&&(e[i]=ze(r))}return e}function DO(e){return[].concat(e.type,e.style??[])}function $e(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:o}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:o&&(!r||r===e)?void 0:Hr(e,t,n,i)}function Hr(e,t,n,{vgChannel:i}={}){return Ve(i?hg(e,t,n.style):void 0,hg(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function hg(e,t,n){return TO(e,DO(t),n)}function TO(e,t,n){t=H(t);let i;for(const r of t){const o=n[r];o&&o[e]!==void 0&&(i=o[e])}return i}function NO(e,t){return H(e).reduce((n,i)=>(n.field.push(q(i,t)),n.order.push(i.sort??"ascending"),n),{field:[],order:[]})}function OO(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Dn(r,i))return;n.push(i)}),n}function RO(e,t){return Dn(e,t)||!t?e:e?[...H(e),...H(t)].join(", "):t}function zO(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((co(n)||Q(n))&&(co(i)||Q(i)))return{explicit:e.explicit,value:RO(n,i)};if(co(n)||Q(n))return{explicit:e.explicit,value:n};if(co(i)||Q(i))return{explicit:e.explicit,value:i};if(!co(n)&&!Q(n)&&!co(i)&&!Q(i))return{explicit:e.explicit,value:OO(n,i)};throw new Error("It should never reach here")}function _w(e){return`Invalid specification ${Fe(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Sne='Autosize "fit" only works for single views and layered views.';function A$(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function C$(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function M$(e){return e?`Dropping "fit-${e}" because spec has discrete ${_n(e)}.`:'Dropping "fit" because spec has discrete size.'}function Sw(e){return`Unknown field for ${e}. Cannot calculate view size.`}function F$(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Ene(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function kne(e){return`The "nearest" transform is not supported for ${e} marks.`}function PO(e){return`Selection not supported for ${e} yet.`}function $ne(e){return`Cannot find a selection named "${e}".`}const Ane="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Cne="Legend bindings are only supported for selections over an individual field or encoding channel.";function Mne(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function Fne(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Dne="The same selection must be used to override scale domains in a layered view.",Tne='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function Nne(e){return`Unknown repeated value "${e}".`}function D$(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const One="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Rne(e){return`Unrecognized parse "${e}".`}function T$(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const zne="Attempt to add the same child twice.";function Pne(e){return`Ignoring an invalid transform: ${Fe(e)}.`}const Lne='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function N$(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function Ine(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Fe(t)} is overridden by a child projection ${Fe(n)}.`}const Bne="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Une(e){return`${e}Offset dropped because ${e} is continuous`}function jne(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Fe(n)}}.`}function LO(e){return`Invalid field type "${e}".`}function qne(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Wne(e){return`Invalid aggregation operator "${e}".`}function IO(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Hne(e){return`Position range does not support relative band size for ${e}.`}function qy(e,t){return`Dropping ${Fe(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const Gne="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Qp(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function Yne(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function Vne(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function Xne(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function Kne(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function I0(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function Jne(e){return`The ${e} for range marks cannot be an expression`}function Qne(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function Zne(e,t){return`Specified orient "${e}" overridden with "${t}".`}function eie(e){return`Cannot use the scale property "${e}" with non-color channel.`}function tie(e){return`Cannot use the relative band size with ${e} scale.`}function nie(e){return`Using unaggregated domain with raw field has no effect (${Fe(e)}).`}function iie(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function rie(e){return`Unaggregated domain is currently unsupported for log scale (${Fe(e)}).`}function oie(e){return`Cannot apply size to non-oriented mark "${e}".`}function sie(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function aie(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function BO(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function UO(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function uie(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Fe(n)} and ${Fe(i)}). Using ${Fe(n)}.`}function lie(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Fe(n)} and ${Fe(i)}). Using the union of the two domains.`}function cie(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function fie(e){return`Dropping sort property ${Fe(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const O$="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",die="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",hie="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",gie="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function pie(e){return`Cannot stack "${e}" if there is already "${e}2".`}function mie(e){return`Cannot stack non-linear scale (${e}).`}function yie(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function gg(e,t){return`Invalid ${e}: ${Fe(t)}.`}function bie(e){return`Dropping day from datetime ${Fe(e)} as day cannot be combined with other units.`}function xie(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function vie(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function wie(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function R$(e){return`1D error band does not support ${e}.`}function jO(e){return`Channel ${e} is required for "binned" bin.`}function _ie(e){return`Channel ${e} should not be used with "binned" bin.`}function Sie(e){return`Domain for ${e} is required for threshold scale.`}const qO=gb(hb);let Cu=qO;function Eie(e){return Cu=e,Cu}function kie(){return Cu=qO,Cu}function I(...e){Cu.warn(...e)}function $ie(...e){Cu.debug(...e)}function wa(e){if(e&&G(e)){for(const t of kw)if(t in e)return!0}return!1}const WO=["january","february","march","april","may","june","july","august","september","october","november","december"],Aie=WO.map(e=>e.substr(0,3)),HO=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Cie=HO.map(e=>e.substr(0,3));function Mie(e){if(qp(e)&&(e=+e),xe(e))return e>4&&I(gg("quarter",e)),e-1;throw new Error(gg("quarter",e))}function Fie(e){if(qp(e)&&(e=+e),xe(e))return e-1;{const t=e.toLowerCase(),n=WO.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Aie.indexOf(i);if(r!==-1)return r;throw new Error(gg("month",e))}}function Die(e){if(qp(e)&&(e=+e),xe(e))return e%7;{const t=e.toLowerCase(),n=HO.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Cie.indexOf(i);if(r!==-1)return r;throw new Error(gg("day",e))}}function Ew(e,t){const n=[];if(t&&e.day!==void 0&&P(e).length>1&&(I(bie(e)),e=oe(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Fie(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Mie(e.quarter):e.quarter;n.push(xe(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Die(e.day):e.day;n.push(xe(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r>"u"?0:r)}return n}function ta(e){const n=Ew(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Tie(e){const n=Ew(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Nie(e){const t=Ew(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const GO={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},kw=P(GO);function Oie(e){return!!GO[e]}function _a(e){return G(e)?e.binned:YO(e)}function YO(e){return e&&e.startsWith("binned")}function $w(e){return e.startsWith("utc")}function Rie(e){return e.substring(3)}const zie={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Zp(e){return kw.filter(t=>XO(e,t))}function VO(e){const t=Zp(e);return t[t.length-1]}function XO(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function Pie(e,t,{end:n}={end:!1}){const i=dw(t),r=$w(e)?"utc":"";function o(u){return u==="quarter"?`(${r}quarter(${i})-1)`:`${r}${u}(${i})`}let s;const a={};for(const u of kw)XO(e,u)&&(a[u]=o(u),s=u);return n&&(a[s]+="+1"),Tie(a)}function KO(e){if(!e)return;const t=Zp(e);return`timeUnitSpecifier(${Fe(t)}, ${Fe(zie)})`}function Lie(e,t,n){if(!e)return;const i=KO(e);return`${n||$w(e)?"utc":"time"}Format(${t}, ${i})`}function pt(e){if(!e)return;let t;return Y(e)?YO(e)?t={unit:e.substring(6),binned:!0}:t={unit:e}:G(e)&&(t={...e,...e.unit?{unit:e.unit}:{}}),$w(t.unit)&&(t.utc=!0,t.unit=Rie(t.unit)),t}function Iie(e){const{utc:t,...n}=pt(e);return n.unit?(t?"utc":"")+P(n).map(i=>Le(`${i==="unit"?"":`_${i}_`}${n[i]}`)).join(""):(t?"utc":"")+"timeunit"+P(n).map(i=>Le(`_${i}_${n[i]}`)).join("")}function JO(e,t=n=>n){const n=pt(e),i=VO(n.unit);if(i&&i!=="day"){const r={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},{step:o,part:s}=QO(i,n.step),a={...r,[s]:+r[s]+o};return`${t(ta(a))} - ${t(ta(r))}`}}const Bie={year:1,month:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};function Uie(e){return!!Bie[e]}function QO(e,t=1){if(Uie(e))return{part:e,step:t};switch(e){case"day":case"dayofyear":return{part:"date",step:t};case"quarter":return{part:"month",step:t*3};case"week":return{part:"date",step:t*7}}}function jie(e){return e?.param}function Aw(e){return!!e?.field&&e.equal!==void 0}function Cw(e){return!!e?.field&&e.lt!==void 0}function Mw(e){return!!e?.field&&e.lte!==void 0}function Fw(e){return!!e?.field&&e.gt!==void 0}function Dw(e){return!!e?.field&&e.gte!==void 0}function Tw(e){if(e?.field){if(z(e.range)&&e.range.length===2)return!0;if(Q(e.range))return!0}return!1}function Nw(e){return!!e?.field&&(z(e.oneOf)||z(e.in))}function qie(e){return!!e?.field&&e.valid!==void 0}function ZO(e){return Nw(e)||Aw(e)||Tw(e)||Cw(e)||Fw(e)||Mw(e)||Dw(e)}function Li(e,t){return lm(e,{timeUnit:t,wrapTime:!0})}function Wie(e,t){return e.map(n=>Li(n,t))}function e6(e,t=!0){const{field:n}=e,i=pt(e.timeUnit),{unit:r,binned:o}=i||{},s=q(e,{expr:"datum"}),a=r?`time(${o?s:Pie(r,n)})`:s;if(Aw(e))return`${a}===${Li(e.equal,r)}`;if(Cw(e)){const u=e.lt;return`${a}<${Li(u,r)}`}else if(Fw(e)){const u=e.gt;return`${a}>${Li(u,r)}`}else if(Mw(e)){const u=e.lte;return`${a}<=${Li(u,r)}`}else if(Dw(e)){const u=e.gte;return`${a}>=${Li(u,r)}`}else{if(Nw(e))return`indexof([${Wie(e.oneOf,r).join(",")}], ${a}) !== -1`;if(qie(e))return Ow(a,e.valid);if(Tw(e)){const{range:u}=e,l=Q(u)?{signal:`${u.signal}[0]`}:u[0],c=Q(u)?{signal:`${u.signal}[1]`}:u[1];if(l!==null&&c!==null&&t)return"inrange("+a+", ["+Li(l,r)+", "+Li(c,r)+"])";const f=[];return l!==null&&f.push(`${a} >= ${Li(l,r)}`),c!==null&&f.push(`${a} <= ${Li(c,r)}`),f.length>0?f.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${Fe(e)}`)}function Ow(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function Hie(e){return ZO(e)&&e.timeUnit?{...e,timeUnit:pt(e.timeUnit)}:e}const Df={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function Gie(e){return e==="quantitative"||e==="temporal"}function t6(e){return e==="ordinal"||e==="nominal"}const na=Df.quantitative,Rw=Df.ordinal,Mu=Df.temporal,zw=Df.nominal,tl=Df.geojson;function Yie(e){if(e)switch(e=e.toLowerCase(),e){case"q":case na:return"quantitative";case"t":case Mu:return"temporal";case"o":case Rw:return"ordinal";case"n":case zw:return"nominal";case tl:return"geojson"}}const mn={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Wy={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Vie(e,t){const n=Wy[e],i=Wy[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const Xie={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function z$(e){return Xie[e]}const n6=new Set(["linear","log","pow","sqrt","symlog"]),i6=new Set([...n6,"time","utc"]);function r6(e){return n6.has(e)}const o6=new Set(["quantile","quantize","threshold"]),Kie=new Set([...i6,...o6,"sequential","identity"]),Jie=new Set(["ordinal","bin-ordinal","point","band"]);function mt(e){return Jie.has(e)}function Ln(e){return Kie.has(e)}function bi(e){return i6.has(e)}function Fu(e){return o6.has(e)}const Qie={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0};function Zie(e){return!Y(e)&&!!e.name}function s6(e){return e?.param}function ere(e){return e?.unionWith}function tre(e){return G(e)&&"field"in e}const nre={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,domainRaw:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:Gfe,domain:Yfe,range:Vfe,rangeMax:Xfe,rangeMin:Kfe,scheme:Jfe,...ire}=nre,rre=P(ire);function Hy(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return bi(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return bi(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"domainRaw":case"clamp":return bi(e);case"nice":return bi(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return Ln(e)&&!pe(["log","time","utc","threshold","quantile"],e)}}function a6(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return eu(e)?void 0:eie(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"domainRaw":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function ore(e,t){return pe([Rw,zw],t)?e===void 0||mt(e):t===Mu?pe([mn.TIME,mn.UTC,void 0],e):t===na?r6(e)||Fu(e)||e===void 0:!0}function sre(e,t,n=!1){if(!Qr(e))return!1;switch(e){case Ie:case bt:case Zo:case el:case ri:case Ti:return bi(t)||t==="band"?!0:t==="point"?!n:!1;case Kr:case ns:case Jr:case es:case ts:case ba:return bi(t)||Fu(t)||pe(["band","point","ordinal"],t);case vn:case gr:case pr:return t!=="band";case is:case wn:return t==="ordinal"||Fu(t)}}const un={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},u6=un.arc,em=un.area,tm=un.bar,are=un.image,nm=un.line,im=un.point,ure=un.rect,pg=un.rule,l6=un.text,Pw=un.tick,lre=un.trail,Lw=un.circle,Iw=un.square,c6=un.geoshape;function ss(e){return["line","area","trail"].includes(e)}function Wc(e){return["rect","bar","image","arc"].includes(e)}const cre=new Set(P(un));function rr(e){return e.type}const fre=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],dre=["fill","fillOpacity"],hre=[...fre,...dre],gre={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},P$=P(gre),pre={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],line:["point"],tick:["bandSize","thickness"]},mre={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},yre={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},f6=P(yre);function ia(e){return e&&e.band!=null}const bre={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},d6=5,xre={binSpacing:1,continuousBandSize:d6,minBandSize:.25,timeUnitBandPosition:.5},vre={binSpacing:0,continuousBandSize:d6,minBandSize:.25,timeUnitBandPosition:.5},wre={thickness:1};function _re(e){return rr(e)?e.type:e}function Bw(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:o}=e,s=jw(e);return L(n)&&!AO(n.aggregate)&&r&&bi(r.get("type"))?Sre({fieldDef:n,channel:t,markDef:i,ref:s,config:o}):s}function Sre({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return ss(n.type)?i:$e("invalid",n,r)===null?[Ere(e,t),i]:i}function Ere(e,t){const n=Uw(e,!0),r=xa(t)==="y"?{field:{group:"height"}}:{value:0};return{test:n,...r}}function Uw(e,t=!0){return Ow(Y(e)?e:q(e,{expr:"datum"}),!t)}function kre(e){const{datum:t}=e;return wa(t)?ta(t):`${Fe(t)}`}function Ps(e,t,n,i){const r={};if(t&&(r.scale=t),br(e)){const{datum:o}=e;wa(o)?r.signal=ta(o):Q(o)?r.signal=o.signal:Ff(o)?r.signal=o.expr:r.value=o}else r.field=q(e,n);if(i){const{offset:o,band:s}=i;o&&(r.offset=o),s&&(r.band=s)}return r}function mg({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,endSuffix:o="end",bandPosition:s=.5}){const a=!Q(s)&&0<s&&s<1?"datum":void 0,u=q(t,{expr:a,suffix:r}),l=n!==void 0?q(n,{expr:a}):q(t,{suffix:o,expr:a}),c={};if(s===0||s===1){c.scale=e;const f=s===0?u:l;c.field=f}else{const f=Q(s)?`(1-${s.signal}) * ${u} + ${s.signal} * ${l}`:`${1-s} * ${u} + ${s} * ${l}`;c.signal=`scale("${e}", ${f})`}return i&&(c.offset=i),c}function $re({scaleName:e,fieldDef:t}){const n=q(t,{expr:"datum"}),i=q(t,{expr:"datum",suffix:"end"});return`abs(scale("${e}", ${i}) - scale("${e}", ${n}))`}function jw({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:s,stack:a,offset:u,defaultRef:l,bandPosition:c}){if(t){if(se(t)){const f=s?.get("type");if(sn(t)){c??(c=jo({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:d,timeUnit:h,type:g}=t;if(Oe(d)||c&&h&&g===Mu)return a?.impute?Ps(t,o,{binSuffix:"mid"},{offset:u}):c&&!mt(f)?mg({scaleName:o,fieldOrDatumDef:t,bandPosition:c,offset:u}):Ps(t,o,Rf(t,e)?{binSuffix:"range"}:{},{offset:u});if(vt(d)){if(L(n))return mg({scaleName:o,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:c,offset:u});I(jO(e===Ie?Di:hr))}}return Ps(t,o,mt(f)?{binSuffix:"range"}:{},{offset:u,band:f==="band"?c??t.bandPosition??.5:void 0})}else if($i(t)){const f=t.value,d=u?{offset:u}:{};return{...dc(e,f),...d}}}return ue(l)&&(l=l()),l&&{...l,...u?{offset:u}:{}}}function dc(e,t){return pe(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:pe(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:ze(t)}function ra(e){return e&&e!=="number"&&e!=="time"}function h6(e,t,n){return`${e}(${t}${n?`, ${Fe(n)}`:""})`}const Are=" – ";function qw({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o}){if(ra(n))return xi({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:o});const s=g6(e,i,r),a=Du(e);if(t===void 0&&n===void 0&&o.customFormatTypes){if(a==="quantitative"){if(r&&o.normalizedNumberFormatType)return xi({fieldOrDatumDef:e,format:o.normalizedNumberFormat,formatType:o.normalizedNumberFormatType,expr:i,config:o});if(o.numberFormatType)return xi({fieldOrDatumDef:e,format:o.numberFormat,formatType:o.numberFormatType,expr:i,config:o})}if(a==="temporal"&&o.timeFormatType&&L(e)&&e.timeUnit===void 0)return xi({fieldOrDatumDef:e,format:o.timeFormat,formatType:o.timeFormatType,expr:i,config:o})}if(Nu(e)){const u=Mre({field:s,timeUnit:L(e)?pt(e.timeUnit)?.unit:void 0,format:t,formatType:o.timeFormatType,rawTimeFormat:o.timeFormat,isUTCScale:Sa(e)&&e.scale?.type===mn.UTC});return u?{signal:u}:void 0}if(t=Gy({type:a,specifiedFormat:t,config:o,normalizeStack:r}),L(e)&&Oe(e.bin)){const u=q(e,{expr:i,binSuffix:"end"});return{signal:Tf(s,u,t,n,o)}}else return t||Du(e)==="quantitative"?{signal:`${y6(s,t)}`}:{signal:`isValid(${s}) ? ${s} : ""+${s}`}}function g6(e,t,n){return L(e)?n?`${q(e,{expr:t,suffix:"end"})}-${q(e,{expr:t,suffix:"start"})}`:q(e,{expr:t}):kre(e)}function xi({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o,field:s}){if(s??(s=g6(e,i,r)),s!=="datum.value"&&L(e)&&Oe(e.bin)){const a=q(e,{expr:i,binSuffix:"end"});return{signal:Tf(s,a,t,n,o)}}return{signal:h6(n,s,t)}}function p6(e,t,n,i,r,o){if(!(Y(i)&&ra(i))&&!(n===void 0&&i===void 0&&r.customFormatTypes&&Du(e)==="quantitative"&&(r.normalizedNumberFormatType&&Tu(e)&&e.stack==="normalize"||r.numberFormatType))){if(Tu(e)&&e.stack==="normalize"&&r.normalizedNumberFormat)return Gy({type:"quantitative",config:r,normalizeStack:!0});if(Nu(e)){const s=L(e)?pt(e.timeUnit)?.unit:void 0;return s===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:Cre({specifiedFormat:n,timeUnit:s,config:r,omitTimeFormatConfig:o})}return Gy({type:t,specifiedFormat:n,config:r})}}function m6(e,t,n){if(e&&(Q(e)||e==="number"||e==="time"))return e;if(Nu(t)&&n!=="time"&&n!=="utc")return L(t)&&pt(t?.timeUnit)?.utc?"utc":"time"}function Gy({type:e,specifiedFormat:t,config:n,normalizeStack:i}){if(Y(t))return t;if(e===na)return i?n.normalizedNumberFormat:n.numberFormat}function Cre({specifiedFormat:e,timeUnit:t,config:n,omitTimeFormatConfig:i}){return e||(t?{signal:KO(t)}:i?void 0:n.timeFormat)}function y6(e,t){return`format(${e}, "${t||""}")`}function L$(e,t,n,i){return ra(n)?h6(n,e,t):y6(e,(Y(t)?t:void 0)??i.numberFormat)}function Tf(e,t,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return Tf(e,t,r.numberFormat,r.numberFormatType,r);const o=L$(e,n,i,r),s=L$(t,n,i,r);return`${Ow(e,!1)} ? "null" : ${o} + "${Are}" + ${s}`}function Mre({field:e,timeUnit:t,format:n,formatType:i,rawTimeFormat:r,isUTCScale:o}){return!t||n?!t&&i?`${i}(${e}, '${n}')`:(n=Y(n)?n:r,`${o?"utc":"time"}Format(${e}, '${n}')`):Lie(t,e,o)}const rm="min",Fre={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function I$(e){return e in Fre}function b6(e){return!!e?.encoding}function Xi(e){return e&&(e.op==="count"||!!e.field)}function x6(e){return e&&z(e)}function Nf(e){return"row"in e||"column"in e}function Ww(e){return!!e&&"header"in e}function om(e){return"facet"in e}function Dre(e){return e.param}function Tre(e){return e&&!Y(e)&&"repeat"in e}function B$(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return{...n?{timeUnit:n}:{},...i?{bin:i}:{},...r?{aggregate:r}:{},field:t}}function Hw(e){return"sort"in e}function jo({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(se(e)&&e.bandPosition!==void 0)return e.bandPosition;if(L(e)){const{timeUnit:r,bin:o}=e;if(r&&!t)return Hr("timeUnitBandPosition",n,i);if(Oe(o))return .5}}function v6({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:o,useVlSizeChannel:s}){const a=_n(e),u=$e(s?"size":a,i,r,{vgChannel:a});if(u!==void 0)return u;if(L(t)){const{timeUnit:l,bin:c}=t;if(l&&!n)return{band:Hr("timeUnitBandSize",i,r)};if(Oe(c)&&!mt(o))return{band:1}}if(Wc(i.type))return o?mt(o)?r[i.type]?.discreteBandSize||{band:1}:r[i.type]?.continuousBandSize:r[i.type]?.discreteBandSize}function w6(e,t,n,i){return Oe(e.bin)||e.timeUnit&&sn(e)&&e.type==="temporal"?jo({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function _6(e){return e&&!!e.sort&&!e.field}function sm(e){return e&&"condition"in e}function am(e){const t=e?.condition;return!!t&&!z(t)&&L(t)}function Of(e){const t=e?.condition;return!!t&&!z(t)&&se(t)}function Nre(e){const t=e?.condition;return!!t&&(z(t)||$i(t))}function L(e){return e&&(!!e.field||e.aggregate==="count")}function Du(e){return e?.type}function br(e){return e&&"datum"in e}function wo(e){return sn(e)&&!bg(e)||yg(e)}function U$(e){return sn(e)&&e.type==="quantitative"&&!e.bin||yg(e)}function yg(e){return br(e)&&xe(e.datum)}function se(e){return L(e)||br(e)}function sn(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function $i(e){return e&&"value"in e&&"value"in e}function Sa(e){return e&&("scale"in e||"sort"in e)}function Tu(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function S6(e){return e&&"legend"in e}function E6(e){return e&&("format"in e||"formatType"in e)}function Ore(e){return pn(e,["legend","axis","header","scale"])}function Rre(e){return"op"in e}function q(e,t={}){let n=e.field;const i=t.prefix;let r=t.suffix,o="";if(Pre(e))n=hO("count");else{let s;if(!t.nofn)if(Rre(e))s=e.op;else{const{bin:a,aggregate:u,timeUnit:l}=e;Oe(a)?(s=CO(a),r=(t.binSuffix??"")+(t.suffix??"")):u?rs(u)?(o=`["${n}"]`,n=`argmax_${u.argmax}`):Wr(u)?(o=`["${n}"]`,n=`argmin_${u.argmin}`):s=String(u):l&&!_a(l)&&(s=Iie(l),r=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+(t.suffix??""))}s&&(n=n?`${s}_${n}`:s)}return r&&(n=`${n}_${r}`),i&&(n=`${i}_${n}`),t.forAs?hw(n):t.expr?cO(n,t.expr)+o:ti(n)+o}function bg(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return L(e)&&!!e.bin;case"temporal":return!1}throw new Error(LO(e.type))}function zre(e){return Sa(e)&&Fu(e.scale?.type)}function Pre(e){return e.aggregate==="count"}function Lre(e,t){const{field:n,bin:i,timeUnit:r,aggregate:o}=e;if(o==="count")return t.countTitle;if(Oe(i))return`${n} (binned)`;if(r&&!_a(r)){const s=pt(r)?.unit;if(s)return`${n} (${Zp(s).join("-")})`}else if(o)return rs(o)?`${n} for max ${o.argmax}`:Wr(o)?`${n} for min ${o.argmin}`:`${$f(o)} of ${n}`;return n}function Ire(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(rs(t))return`${r} for argmax(${t.argmax})`;if(Wr(t))return`${r} for argmin(${t.argmin})`;const o=i&&!_a(i)?pt(i):void 0,s=t||o?.unit||o?.maxbins&&"timeunit"||Oe(n)&&"bin";return s?`${s.toUpperCase()}(${r})`:r}const k6=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Ire(e);default:return Lre(e,t)}};let $6=k6;function A6(e){$6=e}function Bre(){A6(k6)}function tu(e,t,{allowDisabling:n,includeDefault:i=!0}){const r=Gw(e)?.title;if(!L(e))return r??e.title;const o=e,s=i?Yw(o,t):void 0;return n?Ve(r,o.title,s):r??o.title??s}function Gw(e){if(Tu(e)&&e.axis)return e.axis;if(S6(e)&&e.legend)return e.legend;if(Ww(e)&&e.header)return e.header}function Yw(e,t){return $6(e,t)}function xg(e){if(E6(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}else{const t=Gw(e)??{},{format:n,formatType:i}=t;return{format:n,formatType:i}}}function Ure(e,t){switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(Hw(e)&&z(e.sort))return"ordinal";const{aggregate:n,bin:i,timeUnit:r}=e;if(r)return"temporal";if(i||n&&!rs(n)&&!Wr(n))return"quantitative";if(Sa(e)&&e.scale?.type)switch(Wy[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function or(e){if(L(e))return e;if(am(e))return e.condition}function it(e){if(se(e))return e;if(Of(e))return e.condition}function C6(e,t,n,i={}){if(Y(e)||xe(e)||ua(e)){const r=Y(e)?"string":xe(e)?"number":"boolean";return I(jne(t,r,e)),{value:e}}return se(e)?vg(e,t,n,i):Of(e)?{...e,condition:vg(e.condition,t,n,i)}:e}function vg(e,t,n,i){if(E6(e)){const{format:r,formatType:o,...s}=e;if(ra(o)&&!n.customFormatTypes)return I(N$(t)),vg(s,t,n,i)}else{const r=Tu(e)?"axis":S6(e)?"legend":Ww(e)?"header":null;if(r&&e[r]){const{format:o,formatType:s,...a}=e[r];if(ra(s)&&!n.customFormatTypes)return I(N$(t)),vg({...e,[r]:a},t,n,i)}}return L(e)?Vw(e,t,i):jre(e)}function jre(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=xe(n)?"quantitative":Y(n)?"nominal":wa(n)?"temporal":void 0,{...e,type:t}}function Vw(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:o,field:s}=e,a={...e};if(!n&&i&&!ww(i)&&!rs(i)&&!Wr(i)&&(I(Wne(i)),delete a.aggregate),r&&(a.timeUnit=pt(r)),s&&(a.field=`${s}`),Oe(o)&&(a.bin=um(o,t)),vt(o)&&!Xe(t)&&I(_ie(t)),sn(a)){const{type:u}=a,l=Yie(u);u!==l&&(a.type=l),u!=="quantitative"&&AO(i)&&(I(qne(u,i)),a.type="quantitative")}else if(!wO(t)){const u=Ure(a,t);a.type=u}if(sn(a)){const{compatible:u,warning:l}=qre(a,t)||{};u===!1&&I(l)}if(Hw(a)&&Y(a.sort)){const{sort:u}=a;if(I$(u))return{...a,sort:{encoding:u}};const l=u.substr(1);if(u.charAt(0)==="-"&&I$(l))return{...a,sort:{encoding:l,order:"descending"}}}if(Ww(a)){const{header:u}=a;if(u){const{orient:l,...c}=u;if(l)return{...a,header:{...c,labelOrient:u.labelOrient||l,titleOrient:u.titleOrient||l}}}}return a}function um(e,t){return ua(e)?{maxbins:E$(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?{...e,maxbins:E$(t)}:e}const za={compatible:!0};function qre(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Pr:case Lr:case Wp:return bg(e)?za:{compatible:!1,warning:Vne(t)};case Ie:case bt:case Zo:case el:case vn:case gr:case pr:case Af:case Cf:case Hp:case ea:case Gp:case Yp:case ba:case ri:case Ti:case Vp:return za;case Oi:case ni:case Ni:case Ri:return n!==na?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:za;case Jr:case es:case ts:case ns:case Kr:case Xr:case Vr:case Di:case hr:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:za;case wn:case is:return!bg(e)&&!zre(e)?{compatible:!1,warning:Xne(t)}:za;case Au:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:za}}function Nu(e){const{formatType:t}=xg(e);return t==="time"||!t&&Wre(e)}function Wre(e){return e&&(e.type==="temporal"||L(e)&&!!e.timeUnit)}function lm(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){const o=t&&pt(t)?.unit;let s=o||n==="temporal",a;return Ff(e)?a=e.expr:Q(e)?a=e.signal:wa(e)?(s=!0,a=ta(e)):(Y(e)||xe(e))&&s&&(a=`datetime(${Fe(e)})`,Oie(o)&&(xe(e)&&e<1e4||Y(e)&&isNaN(Date.parse(e)))&&(a=ta({[o]:e}))),a?i&&s?`time(${a})`:a:r?void 0:Fe(e)}function M6(e,t){const{type:n}=e;return t.map(i=>{const r=L(e)&&!_a(e.timeUnit)?e.timeUnit:void 0,o=lm(i,{timeUnit:r,type:n,undefinedIfExprNotRequired:!0});return o!==void 0?{signal:o}:i})}function Rf(e,t){return Oe(e.bin)?Qr(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const j$={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function zf(e){return e?.condition}const F6=["domain","grid","labels","ticks","title"],Hre={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},D6={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Gre={...D6,style:1,labelExpr:1,encoding:1};function q$(e){return!!Gre[e]}const Yre={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},T6=P(Yre);function Zr(e){return"mark"in e}class cm{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return Zr(t)?_re(t.mark)===this.name:!1}}function Ls(e,t){const n=e&&e[t];return n?z(n)?Qs(n,i=>!!i.field):L(n)||am(n):!1}function N6(e,t){const n=e&&e[t];return n?z(n)?Qs(n,i=>!!i.field):L(n)||br(n)||Of(n):!1}function O6(e,t){if(Xe(t)){const n=e[t];if((L(n)||br(n))&&(t6(n.type)||L(n)&&n.timeUnit)){const i=yw(t);return N6(e,i)}}return!1}function Xw(e){return Qs(Xte,t=>{if(Ls(e,t)){const n=e[t];if(z(n))return Qs(n,i=>!!i.aggregate);{const i=or(n);return i&&!!i.aggregate}}return!1})}function R6(e,t){const n=[],i=[],r=[],o=[],s={};return Kw(e,(a,u)=>{if(L(a)){const{field:l,aggregate:c,bin:f,timeUnit:d,...h}=a;if(c||d||f){const p=Gw(a)?.title;let m=q(a,{forAs:!0});const y={...p?[]:{title:tu(a,t,{allowDisabling:!0})},...h,field:m};if(c){let b;if(rs(c)?(b="argmax",m=q({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${m}.${l}`):Wr(c)?(b="argmin",m=q({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${m}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(b=c),b){const x={op:b,as:m};l&&(x.field=l),o.push(x)}}else if(n.push(m),sn(a)&&Oe(f)){if(i.push({bin:f,field:l,as:m}),n.push(q(a,{binSuffix:"end"})),Rf(a,u)&&n.push(q(a,{binSuffix:"range"})),Xe(u)){const b={field:`${m}_end`};s[`${u}2`]=b}y.bin="binned",wO(u)||(y.type=na)}else if(d&&!_a(d)){r.push({timeUnit:d,field:l,as:m});const b=sn(a)&&a.type!==Mu&&"time";b&&(u===Af||u===ea?y.formatType=b:one(u)?y.legend={formatType:b,...y.legend}:Xe(u)&&(y.axis={formatType:b,...y.axis}))}s[u]=y}else n.push(l),s[u]=e[u]}else s[u]=e[u]}),{bins:i,timeUnits:r,aggregate:o,groupby:n,encoding:s}}function Vre(e,t,n){const i=ane(t,n);if(i){if(i==="binned"){const r=e[t===Di?Ie:bt];return!!(L(r)&&L(e[t])&&vt(r.bin))}}else return!1;return!0}function Xre(e,t,n,i){const r={};for(const o of P(e))vO(o)||I(Yne(o));for(let o of tne){if(!e[o])continue;const s=e[o];if(Mf(o)){const a=ene(o),u=r[a];if(L(u)&&Gie(u.type)&&L(s)&&!u.timeUnit){I(Une(a));continue}}if(o==="angle"&&t==="arc"&&!e.theta&&(I(Bne),o=ri),!Vre(e,o,t)){I(Qp(o,t));continue}if(o===Kr&&t==="line"&&or(e[o])?.aggregate){I(Gne);continue}if(o===vn&&(n?"fill"in e:"stroke"in e)){I(IO("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(o===Cf||o===Au&&!z(s)&&!$i(s)||o===ea&&z(s)){if(s){if(o===Au){const a=e[o];if(_6(a)){r[o]=a;continue}}r[o]=H(s).reduce((a,u)=>(L(u)?a.push(Vw(u,o)):I(qy(u,o)),a),[])}}else{if(o===ea&&s===null)r[o]=null;else if(!L(s)&&!br(s)&&!$i(s)&&!sm(s)&&!Q(s)){I(qy(s,o));continue}r[o]=C6(s,o,i)}}return r}function fm(e,t){const n={};for(const i of P(e)){const r=C6(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function Kre(e){const t=[];for(const n of P(e))if(Ls(e,n)){const i=e[n],r=H(i);for(const o of r)L(o)?t.push(o):am(o)&&t.push(o.condition)}return t}function Kw(e,t,n){if(e)for(const i of P(e)){const r=e[i];if(z(r))for(const o of r)t.call(n,o,i);else t.call(n,r,i)}}function Jre(e,t,n,i){return e?P(e).reduce((r,o)=>{const s=e[o];return z(s)?s.reduce((a,u)=>t.call(i,a,u,o),r):t.call(i,r,s,o)},n):n}function z6(e,t){return P(t).reduce((n,i)=>{switch(i){case Ie:case bt:case Gp:case Vp:case Yp:case Di:case hr:case Zo:case el:case ri:case Xr:case Ti:case Vr:case Ni:case Oi:case Ri:case ni:case Af:case wn:case ba:case ea:return n;case Au:if(e==="line"||e==="trail")return n;case Cf:case Hp:{const r=t[i];if(z(r)||L(r))for(const o of H(r))o.aggregate||n.push(q(o,{}));return n}case Kr:if(e==="trail")return n;case vn:case gr:case pr:case Jr:case es:case ts:case is:case ns:{const r=or(t[i]);return r&&!r.aggregate&&n.push(q(r,{})),n}}},[])}function Qre(e){const{tooltip:t,...n}=e;if(!t)return{filteredEncoding:n};let i,r;if(z(t)){for(const o of t)o.aggregate?(i||(i=[]),i.push(o)):(r||(r=[]),r.push(o));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return z(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Yy(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:s,titlePrefix:a})=>{const u=i?` of ${Jw(t)}`:"";return{field:s+t.field,type:t.type,title:Q(a)?{signal:`${a}"${escape(u)}"`}:a+u}}),o=Kre(n).map(Ore);return{tooltip:[...r,...Hi(o,ge)]}}function Jw(e){const{title:t,field:n}=e;return Ve(t,n)}function Qw(e,t,n,i,r){const{scale:o,axis:s}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,extraEncoding:f={}})=>{const d=Jw(n);return P6(e,a,r,{mark:u,encoding:{[t]:{field:`${l}_${n.field}`,type:n.type,...d!==void 0?{title:d}:{},...o!==void 0?{scale:o}:{},...s!==void 0?{axis:s}:{}},...Y(c)?{[`${t}2`]:{field:`${c}_${n.field}`}}:{},...i,...f}})}}function P6(e,t,n,i){const{clip:r,color:o,opacity:s}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[{...i,mark:{...n[t],...r?{clip:r}:{},...o?{color:o}:{},...s?{opacity:s}:{},...rr(i.mark)?i.mark:{type:i.mark},style:`${a}-${String(t)}`,...ua(e[t])?{}:e[t]}}]:[]}function L6(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",o=i[r],s=i[`${r}2`],a=i[`${r}Error`],u=i[`${r}Error2`];return{continuousAxisChannelDef:md(o,n),continuousAxisChannelDef2:md(s,n),continuousAxisChannelDefError:md(a,n),continuousAxisChannelDefError2:md(u,n),continuousAxis:r}}function md(e,t){if(e?.aggregate){const{aggregate:n,...i}=e;return n!==t&&I(wie(n,t)),i}else return e}function I6(e,t){const{mark:n,encoding:i}=e,{x:r,y:o}=i;if(rr(n)&&n.orient)return n.orient;if(wo(r)){if(wo(o)){const s=L(r)&&r.aggregate,a=L(o)&&o.aggregate;if(!s&&a===t)return"vertical";if(!a&&s===t)return"horizontal";if(s===t&&a===t)throw new Error("Both x and y cannot have aggregate");return Nu(o)&&!Nu(r)?"horizontal":"vertical"}return"horizontal"}else{if(wo(o))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}const wg="boxplot",Zre=["box","median","outliers","rule","ticks"],eoe=new cm(wg,U6);function B6(e){return xe(e)?"tukey":e}function U6(e,{config:t}){e={...e,encoding:fm(e.encoding,t)};const{mark:n,encoding:i,params:r,projection:o,...s}=e,a=rr(n)?n:{type:n};r&&I(PO("boxplot"));const u=a.extent??t.boxplot.extent,l=$e("size",a,t),c=a.invalid,f=B6(u),{bins:d,timeUnits:h,transform:g,continuousAxisChannelDef:p,continuousAxis:m,groupby:y,aggregate:b,encodingWithoutContinuousAxis:x,ticksOrient:v,boxOrient:w,customTooltipWithoutAggregatedField:S}=toe(e,u,t),{color:_,size:E,...A}=x,k=Wt=>Qw(a,m,p,Wt,t.boxplot),$=k(A),T=k(x),M=k({...A,...E?{size:E}:{}}),D=Yy([{fieldPrefix:f==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:f==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,x),C={type:"tick",color:"black",opacity:1,orient:v,invalid:c,aria:!1},R=f==="min-max"?D:Yy([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,x),W=[...$({partName:"rule",mark:{type:"rule",invalid:c,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:R}),...$({partName:"rule",mark:{type:"rule",invalid:c,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:R}),...$({partName:"ticks",mark:C,positionPrefix:"lower_whisker",extraEncoding:R}),...$({partName:"ticks",mark:C,positionPrefix:"upper_whisker",extraEncoding:R})],V=[...f!=="tukey"?W:[],...T({partName:"box",mark:{type:"bar",...l?{size:l}:{},orient:w,invalid:c,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:D}),...M({partName:"median",mark:{type:"tick",invalid:c,...G(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{},...l?{size:l}:{},orient:v,aria:!1},positionPrefix:"mid_box",extraEncoding:D})];if(f==="min-max")return{...s,transform:(s.transform??[]).concat(g),layer:V};const J=`datum["lower_box_${p.field}"]`,he=`datum["upper_box_${p.field}"]`,Be=`(${he} - ${J})`,Ze=`${J} - ${u} * ${Be}`,at=`${he} + ${u} * ${Be}`,qt=`datum["${p.field}"]`,Je={joinaggregate:j6(p.field),groupby:y},to={transform:[{filter:`(${Ze} <= ${qt}) && (${qt} <= ${at})`},{aggregate:[{op:"min",field:p.field,as:`lower_whisker_${p.field}`},{op:"max",field:p.field,as:`upper_whisker_${p.field}`},{op:"min",field:`lower_box_${p.field}`,as:`lower_box_${p.field}`},{op:"max",field:`upper_box_${p.field}`,as:`upper_box_${p.field}`},...b],groupby:y}],layer:W},{tooltip:$a,...as}=A,{scale:X,axis:le}=p,fe=Jw(p),B=pn(le,["title"]),xt=P6(a,"outliers",t.boxplot,{transform:[{filter:`(${qt} < ${Ze}) || (${qt} > ${at})`}],mark:"point",encoding:{[m]:{field:p.field,type:p.type,...fe!==void 0?{title:fe}:{},...X!==void 0?{scale:X}:{},...Me(B)?{}:{axis:B}},...as,..._?{color:_}:{},...S?{tooltip:S}:{}}})[0];let Se;const At=[...d,...h,Je];return xt?Se={transform:At,layer:[xt,to]}:(Se=to,Se.transform.unshift(...At)),{...s,layer:[Se,{transform:g,layer:V}]}}function j6(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function toe(e,t,n){const i=I6(e,wg),{continuousAxisChannelDef:r,continuousAxis:o}=L6(e,i,wg),s=r.field,a=B6(t),u=[...j6(s),{op:"median",field:s,as:`mid_box_${s}`},{op:"min",field:s,as:(a==="min-max"?"lower_whisker_":"min_")+s},{op:"max",field:s,as:(a==="min-max"?"upper_whisker_":"max_")+s}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${s}"] - datum["lower_box_${s}"]`,as:`iqr_${s}`},{calculate:`min(datum["upper_box_${s}"] + datum["iqr_${s}"] * ${t}, datum["max_${s}"])`,as:`upper_whisker_${s}`},{calculate:`max(datum["lower_box_${s}"] - datum["iqr_${s}"] * ${t}, datum["min_${s}"])`,as:`lower_whisker_${s}`}],{[o]:c,...f}=e.encoding,{customTooltipWithoutAggregatedField:d,filteredEncoding:h}=Qre(f),{bins:g,timeUnits:p,aggregate:m,groupby:y,encoding:b}=R6(h,n),x=i==="vertical"?"horizontal":"vertical",v=i,w=[...g,...p,{aggregate:[...m,...u],groupby:y},...l];return{bins:g,timeUnits:p,transform:w,groupby:y,aggregate:m,continuousAxisChannelDef:r,continuousAxis:o,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:v,customTooltipWithoutAggregatedField:d}}const Zw="errorbar",noe=["ticks","rule"],ioe=new cm(Zw,q6);function q6(e,{config:t}){e={...e,encoding:fm(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,ticksOrient:s,markDef:a,outerSpec:u,tooltipEncoding:l}=W6(e,Zw,t);delete o.size;const c=Qw(a,r,i,o,t.errorbar),f=a.thickness,d=a.size,h={type:"tick",orient:s,aria:!1,...f!==void 0?{thickness:f}:{},...d!==void 0?{size:d}:{}},g=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...f!==void 0?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return{...u,transform:n,...g.length>1?{layer:g}:{...g[0]}}}function roe(e,t){const{encoding:n}=e;if(ooe(n))return{orient:I6(e,t),inputType:"raw"};const i=soe(n),r=aoe(n),o=n.x,s=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(se(a)&&se(u))throw new Error(`${t} cannot have both x2 and y2`);if(se(a)){if(wo(o))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(se(u)){if(wo(s))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(se(u)&&!se(a))throw new Error(`${t} cannot have xError2 without xError`);if(se(c)&&!se(l))throw new Error(`${t} cannot have yError2 without yError`);if(se(a)&&se(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(se(a)){if(wo(o))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(se(l)){if(wo(s))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function ooe(e){return(se(e.x)||se(e.y))&&!se(e.x2)&&!se(e.y2)&&!se(e.xError)&&!se(e.xError2)&&!se(e.yError)&&!se(e.yError2)}function soe(e){return se(e.x2)||se(e.y2)}function aoe(e){return se(e.xError)||se(e.xError2)||se(e.yError)||se(e.yError2)}function W6(e,t,n){const{mark:i,encoding:r,params:o,projection:s,...a}=e,u=rr(i)?i:{type:i};o&&I(PO(t));const{orient:l,inputType:c}=roe(e,t),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:h,continuousAxisChannelDefError2:g,continuousAxis:p}=L6(e,l,t),{errorBarSpecificAggregate:m,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:x}=uoe(u,f,d,h,g,c,t,n),{[p]:v,[p==="x"?"x2":"y2"]:w,[p==="x"?"xError":"yError"]:S,[p==="x"?"xError2":"yError2"]:_,...E}=r,{bins:A,timeUnits:k,aggregate:$,groupby:T,encoding:M}=R6(E,n),D=[...$,...m],C=c!=="raw"?[]:T,R=Yy(b,f,M,x);return{transform:[...a.transform??[],...A,...k,...D.length===0?[]:[{aggregate:D,groupby:C}],...y],groupby:C,continuousAxisChannelDef:f,continuousAxis:p,encodingWithoutContinuousAxis:M,ticksOrient:l==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:a,tooltipEncoding:R}}function uoe(e,t,n,i,r,o,s,a){let u=[],l=[];const c=t.field;let f,d=!1;if(o==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,g=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!=(g==="iqr")&&I(vie(h,g,s)),g==="stderr"||g==="stdev")u=[{op:g,field:c,as:`extent_${c}`},{op:h,field:c,as:`center_${c}`}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:`upper_${c}`},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:`lower_${c}`}],f=[{fieldPrefix:"center_",titlePrefix:$f(h)},{fieldPrefix:"upper_",titlePrefix:W$(h,g,"+")},{fieldPrefix:"lower_",titlePrefix:W$(h,g,"-")}],d=!0;else{let p,m,y;g==="ci"?(p="mean",m="ci0",y="ci1"):(p="median",m="q1",y="q3"),u=[{op:m,field:c,as:`lower_${c}`},{op:y,field:c,as:`upper_${c}`},{op:p,field:c,as:`center_${c}`}],f=[{fieldPrefix:"upper_",titlePrefix:tu({field:c,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:tu({field:c,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:tu({field:c,aggregate:p,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&I(xie(e.center,e.extent)),o==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${c}`},{calculate:`datum["${c}"]`,as:`lower_${c}`}]):o==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:`upper_${c}`}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:`lower_${c}`}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:`lower_${c}`}));for(const h of l)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Zs(Zs(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function W$(e,t,n){return`${$f(e)} ${n} ${t}`}const e_="errorband",loe=["band","borders"],coe=new cm(e_,H6);function H6(e,{config:t}){e={...e,encoding:fm(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,markDef:s,outerSpec:a,tooltipEncoding:u}=W6(e,e_,t),l=s,c=Qw(l,r,i,o,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const g={...l.interpolate?{interpolate:l.interpolate}:{},...l.tension&&l.interpolate?{tension:l.tension}:{}};return f?(d={...d,...g,ariaRoleDescription:"errorband"},h={...h,...g,aria:!1}):l.interpolate?I(R$("interpolate")):l.tension&&I(R$("tension")),{...a,transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:u})]}}const G6={};function t_(e,t,n){const i=new cm(e,t);G6[e]={normalizer:i,parts:n}}function foe(){return P(G6)}t_(wg,U6,Zre);t_(Zw,q6,noe);t_(e_,H6,loe);const doe=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Y6={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},V6={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},hoe=P(Y6),goe=P(V6),poe={header:1,headerRow:1,headerColumn:1,headerFacet:1},X6=P(poe),K6=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],moe={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},yoe={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Ai="_vgsid_",boe={point:{on:"click",fields:[Ai],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[pointerdown, window:pointerup] > window:pointermove!",encodings:["x","y"],translate:"[pointerdown, window:pointerup] > window:pointermove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function n_(e){return e==="legend"||!!e?.legend}function B0(e){return n_(e)&&G(e)}function i_(e){return!!e?.select}function J6(e){const t=[];for(const n of e||[]){if(i_(n))continue;const{expr:i,bind:r,...o}=n;if(r&&i){const s={...o,bind:r,init:i};t.push(s)}else{const s={...o,...i?{update:i}:{},...r?{bind:r}:{}};t.push(s)}}return t}function xoe(e){return dm(e)||o_(e)||r_(e)}function r_(e){return"concat"in e}function dm(e){return"vconcat"in e}function o_(e){return"hconcat"in e}function Q6({step:e,offsetIsDiscrete:t}){return t?e.for??"offset":"position"}function sr(e){return G(e)&&e.step!==void 0}function H$(e){return e.view||e.width||e.height}const G$=20,voe={align:1,bounds:1,center:1,columns:1,spacing:1},woe=P(voe);function _oe(e,t,n){const i=n[t],r={},{spacing:o,columns:s}=i;o!==void 0&&(r.spacing=o),s!==void 0&&(om(e)&&!Nf(e.facet)||r_(e))&&(r.columns=s),dm(e)&&(r.columns=1);for(const a of woe)if(e[a]!==void 0)if(a==="spacing"){const u=e[a];r[a]=xe(u)?u:{row:u.row??o,column:u.column??o}}else r[a]=e[a];return r}function Vy(e,t){return e[t]??e[t==="width"?"continuousWidth":"continuousHeight"]}function _g(e,t){const n=Sg(e,t);return sr(n)?n.step:Z6}function Sg(e,t){const n=e[t]??e[t==="width"?"discreteWidth":"discreteHeight"];return Ve(n,{step:e.step})}const Z6=20,Soe={continuousWidth:200,continuousHeight:200,step:Z6},Eoe={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Soe,mark:mre,arc:{},area:{},bar:xre,circle:{},geoshape:{},image:{},line:{},point:{},rect:vre,rule:{color:"black"},square:{},text:{color:"black"},tick:wre,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Qie,projection:{},legend:moe,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:boe,style:{},title:{},facet:{spacing:G$},concat:{spacing:G$},normalizedNumberFormat:".0%"},_r=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Y$={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},V$={blue:_r[0],orange:_r[1],red:_r[2],teal:_r[3],green:_r[4],yellow:_r[5],purple:_r[6],pink:_r[7],brown:_r[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function koe(e={}){return{signals:[{name:"color",value:G(e)?{...V$,...e}:V$}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function $oe(e){return{signals:[{name:"fontSize",value:G(e)?{...Y$,...e}:Y$}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Aoe(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function eR(e){const t=P(e||{}),n={};for(const i of t){const r=e[i];n[i]=zf(r)?FO(r):Cn(r)}return n}function Coe(e){const t=P(e),n={};for(const i of t)n[i]=eR(e[i]);return n}const Moe=[...f6,...T6,...X6,"background","padding","legend","lineBreak","scale","style","title","view"];function tR(e={}){const{color:t,font:n,fontSize:i,selection:r,...o}=e,s=Cg({},oe(Eoe),n?Aoe(n):{},t?koe(t):{},i?$oe(i):{},o||{});r&&Kc(s,"selection",r,!0);const a=pn(s,Moe);for(const u of["background","lineBreak","padding"])s[u]&&(a[u]=Cn(s[u]));for(const u of f6)s[u]&&(a[u]=dn(s[u]));for(const u of T6)s[u]&&(a[u]=eR(s[u]));for(const u of X6)s[u]&&(a[u]=dn(s[u]));return s.legend&&(a.legend=dn(s.legend)),s.scale&&(a.scale=dn(s.scale)),s.style&&(a.style=Coe(s.style)),s.title&&(a.title=dn(s.title)),s.view&&(a.view=dn(s.view)),a}const Foe=new Set(["view",...cre]),Doe=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Toe={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...pre};function Noe(e){e=oe(e);for(const t of Doe)delete e[t];if(e.axis)for(const t in e.axis)zf(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of doe)delete e.legend[t];if(e.mark){for(const t of P$)delete e.mark[t];e.mark.tooltip&&G(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(J6(e.params)),delete e.params);for(const t of Foe){for(const i of P$)delete e[t][i];const n=Toe[t];if(n)for(const i of n)delete e[t][i];Roe(e,t)}for(const t of foe())delete e[t];Ooe(e);for(const t in e)G(e[t])&&Me(e[t])&&delete e[t];return Me(e)?void 0:e}function Ooe(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=MO(e.title);Me(t)||(e.style["group-title"]={...e.style["group-title"],...t}),Me(n)||(e.style["group-subtitle"]={...e.style["group-subtitle"],...n}),Me(i)?delete e.title:e.title=i}function Roe(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const o={...r,...e.style[n??t]};Me(o)||(e.style[n??t]=o),i||delete e[t]}function hm(e){return"layer"in e}function zoe(e){return"repeat"in e}function Poe(e){return!z(e.repeat)&&e.repeat.layer}class s_{map(t,n){return om(t)?this.mapFacet(t,n):zoe(t)?this.mapRepeat(t,n):o_(t)?this.mapHConcat(t,n):dm(t)?this.mapVConcat(t,n):r_(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(hm(t))return this.mapLayer(t,n);if(Zr(t))return this.mapUnit(t,n);throw new Error(_w(t))}mapLayer(t,n){return{...t,layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))}}mapHConcat(t,n){return{...t,hconcat:t.hconcat.map(i=>this.map(i,n))}}mapVConcat(t,n){return{...t,vconcat:t.vconcat.map(i=>this.map(i,n))}}mapConcat(t,n){const{concat:i,...r}=t;return{...r,concat:i.map(o=>this.map(o,n))}}mapFacet(t,n){return{...t,spec:this.map(t.spec,n)}}mapRepeat(t,n){return{...t,spec:this.map(t.spec,n)}}}const Loe={zero:1,center:1,normalize:1};function Ioe(e){return e in Loe}const Boe=new Set([u6,tm,em,pg,im,Lw,Iw,nm,l6,Pw]),Uoe=new Set([tm,em,u6]);function Pa(e){return L(e)&&Du(e)==="quantitative"&&!e.bin}function X$(e,t,{orient:n,type:i}){const r=t==="x"?"y":"radius",o=t==="x"&&["bar","area"].includes(i),s=e[t],a=e[r];if(L(s)&&L(a))if(Pa(s)&&Pa(a)){if(s.stack)return t;if(a.stack)return r;const u=L(s)&&!!s.aggregate,l=L(a)&&!!a.aggregate;if(u!==l)return u?t:r;if(o){if(n==="vertical")return r;if(n==="horizontal")return t}}else{if(Pa(s))return t;if(Pa(a))return r}else{if(Pa(s))return o&&n==="vertical"?void 0:t;if(Pa(a))return o&&n==="horizontal"?void 0:r}}function joe(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function nR(e,t){const n=rr(e)?e:{type:e},i=n.type;if(!Boe.has(i))return null;const r=X$(t,"x",n)||X$(t,"theta",n);if(!r)return null;const o=t[r],s=L(o)?q(o,{}):void 0,a=joe(r),u=[],l=new Set;if(t[a]){const p=t[a],m=L(p)?q(p,{}):void 0;m&&m!==s&&(u.push(a),l.add(m))}const c=a==="x"?"xOffset":"yOffset",f=t[c],d=L(f)?q(f,{}):void 0;d&&d!==s&&(u.push(c),l.add(d));const h=nne.reduce((p,m)=>{if(m!=="tooltip"&&Ls(t,m)){const y=t[m];for(const b of H(y)){const x=or(b);if(x.aggregate)continue;const v=q(x,{});(!v||!l.has(v))&&p.push({channel:m,fieldDef:x})}}return p},[]);let g;return o.stack!==void 0?ua(o.stack)?g=o.stack?"zero":null:g=o.stack:Uoe.has(i)&&(g="zero"),!g||!Ioe(g)||Xw(t)&&h.length===0?null:o?.scale?.type&&o?.scale?.type!==mn.LINEAR?(o?.stack&&I(mie(o.scale.type)),null):se(t[mr(r)])?(o.stack!==void 0&&I(pie(r)),null):(L(o)&&o.aggregate&&!gne.has(o.aggregate)&&I(yie(o.aggregate)),{groupbyChannels:u,groupbyFields:l,fieldChannel:r,impute:o.impute===null?!1:ss(i),stackBy:h,offset:g})}function iR(e,t,n){const i=dn(e),r=$e("orient",i,n);if(i.orient=Goe(i.type,t,r),r!==void 0&&r!==i.orient&&I(Zne(i.orient,r)),i.type==="bar"&&i.orient){const a=$e("cornerRadiusEnd",i,n);if(a!==void 0){const u=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:bre[i.orient];for(const l of u)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return $e("opacity",i,n)===void 0&&(i.opacity=Woe(i.type,t)),$e("cursor",i,n)===void 0&&(i.cursor=qoe(i,t,n)),i}function qoe(e,t,n){return t.href||e.href||$e("href",e,n)?"pointer":e.cursor}function Woe(e,t){if(pe([im,Pw,Lw,Iw],e)&&!Xw(t))return .7}function Hoe(e,t,{graticule:n}){if(n)return!1;const i=Hr("filled",e,t),r=e.type;return Ve(i,r!==im&&r!==nm&&r!==pg)}function Goe(e,t,n){switch(e){case im:case Lw:case Iw:case l6:case ure:case are:return}const{x:i,y:r,x2:o,y2:s}=t;switch(e){case tm:if(L(i)&&(vt(i.bin)||L(r)&&r.aggregate&&!i.aggregate))return"vertical";if(L(r)&&(vt(r.bin)||L(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(s||o){if(n)return n;if(!o)return(L(i)&&i.type===na&&!Oe(i.bin)||yg(i))&&L(r)&&vt(r.bin)?"horizontal":"vertical";if(!s)return(L(r)&&r.type===na&&!Oe(r.bin)||yg(r))&&L(i)&&vt(i.bin)?"vertical":"horizontal"}case pg:if(o&&!(L(i)&&vt(i.bin))&&s&&!(L(r)&&vt(r.bin)))return;case em:if(s)return L(r)&&vt(r.bin)?"horizontal":"vertical";if(o)return L(i)&&vt(i.bin)?"vertical":"horizontal";if(e===pg){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case nm:case Pw:{const a=U$(i),u=U$(r);if(n)return n;if(a&&!u)return e!=="tick"?"horizontal":"vertical";if(!a&&u)return e!=="tick"?"vertical":"horizontal";if(a&&u)return"vertical";{const l=sn(i)&&i.type===Mu,c=sn(r)&&r.type===Mu;if(l&&!c)return"vertical";if(!l&&c)return"horizontal"}return}}return"vertical"}function Yoe(e){const{point:t,line:n,...i}=e;return P(i).length>1?i:i.type}function Voe(e){for(const t of["line","area","rule","trail"])e[t]&&(e={...e,[t]:pn(e[t],["point","line"])});return e}function U0(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?G(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?G(t.point)?t.point:{}:void 0}function K$(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Xoe{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(Zr(t)){const{mark:i,encoding:r}=t,o=rr(i)?i:{type:i};switch(o.type){case"line":case"rule":case"trail":return!!U0(o,n[o.type],r);case"area":return!!U0(o,n[o.type],r)||!!K$(o,n[o.type])}}return!1}run(t,n,i){const{config:r}=n,{params:o,projection:s,mark:a,name:u,encoding:l,...c}=t,f=fm(l,r),d=rr(a)?a:{type:a},h=U0(d,r[d.type],f),g=d.type==="area"&&K$(d,r[d.type]),p=[{name:u,...o?{params:o}:{},mark:Yoe({...d.type==="area"&&d.opacity===void 0&&d.fillOpacity===void 0?{opacity:.7}:{},...d}),encoding:pn(f,["shape"])}],m=nR(iR(d,f,r),f);let y=f;if(m){const{fieldChannel:b,offset:x}=m;y={...f,[b]:{...f[b],...x?{stack:x}:{}}}}return y=pn(y,["y2","x2"]),g&&p.push({...s?{projection:s}:{},mark:{type:"line",...ku(d,["clip","interpolate","tension","tooltip"]),...g},encoding:y}),h&&p.push({...s?{projection:s}:{},mark:{type:"point",opacity:1,filled:!0,...ku(d,["clip","tooltip"]),...h},encoding:y}),i({...c,layer:p},{...n,config:Voe(r)})}}function Koe(e,t){return t?Nf(e)?oR(e,t):rR(e,t):e}function j0(e,t){return t?oR(e,t):e}function Xy(e,t,n){const i=t[e];if(Tre(i)){if(i.repeat in n)return{...t,[e]:n[i.repeat]};I(Nne(i.repeat));return}return t}function rR(e,t){if(e=Xy("field",e,t),e!==void 0){if(e===null)return null;if(Hw(e)&&Xi(e.sort)){const n=Xy("field",e.sort,t);e={...e,...n?{sort:n}:{}}}return e}}function J$(e,t){if(L(e))return rR(e,t);{const n=Xy("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function Q$(e,t){if(se(e)){const n=J$(e,t);if(n)return n;if(sm(e))return{condition:e.condition}}else{if(Of(e)){const n=J$(e.condition,t);if(n)return{...e,condition:n};{const{condition:i,...r}=e;return r}}return e}}function oR(e,t){const n={};for(const i in e)if(ne(e,i)){const r=e[i];if(z(r))n[i]=r.map(o=>Q$(o,t)).filter(o=>o);else{const o=Q$(r,t);o!==void 0&&(n[i]=o)}}return n}class Joe{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Zr(t)){const{encoding:n,mark:i}=t;if(i==="line"||rr(i)&&i.type==="line")for(const r of Zte){const o=xa(r),s=n[o];if(n[r]&&(L(s)&&!vt(s.bin)||br(s)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:o}=t;return I(Qne(!!r.x2,!!r.y2)),i({...t,mark:G(o)?{...o,type:"rule"}:"rule"},n)}}class Qoe extends s_{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[eoe,ioe,coe,new Xoe,new Joe]}map(t,n){if(Zr(t)){const i=Ls(t.encoding,Pr),r=Ls(t.encoding,Lr),o=Ls(t.encoding,Wp);if(i||r||o)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,o=j0(t.encoding,n.repeater),s={...t,...t.name?{name:[n.repeaterPrefix,t.name].filter(u=>u).join("_")}:{},...o?{encoding:o}:{}};if(i||r)return this.mapUnitWithParentEncodingOrProjection(s,n);const a=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(s,n.config))return u.run(s,n,a);return s}mapRepeat(t,n){return Poe(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r,...o}=t,{row:s,column:a,layer:u}=i,{repeater:l={},repeaterPrefix:c=""}=n;return s||a?this.mapRepeat({...t,repeat:{...s?{row:s}:{},...a?{column:a}:{}},spec:{repeat:{layer:u},spec:r}},n):{...o,layer:u.map(f=>{const d={...l,layer:f},h=`${(r.name?`${r.name}_`:"")+c}child__layer_${Le(f)}`,g=this.mapLayerOrUnit(r,{...n,repeater:d,repeaterPrefix:h});return g.name=h,g})}}mapNonLayerRepeat(t,n){const{repeat:i,spec:r,data:o,...s}=t;!z(i)&&t.columns&&(t=pn(t,["columns"]),I(D$("repeat")));const a=[],{repeater:u={},repeaterPrefix:l=""}=n,c=!z(i)&&i.row||[u?u.row:null],f=!z(i)&&i.column||[u?u.column:null],d=z(i)&&i||[u?u.repeat:null];for(const g of d)for(const p of c)for(const m of f){const y={repeat:g,row:p,column:m,layer:u.layer},b=(r.name?`${r.name}_`:"")+l+"child__"+(z(i)?`${Le(g)}`:(i.row?`row_${Le(p)}`:"")+(i.column?`column_${Le(m)}`:"")),x=this.map(r,{...n,repeater:y,repeaterPrefix:b});x.name=b,a.push(pn(x,["data"]))}const h=z(i)?t.columns:i.column?i.column.length:1;return{data:r.data??o,align:"all",...s,columns:h,concat:a}}mapFacet(t,n){const{facet:i}=t;return Nf(i)&&t.columns&&(t=pn(t,["columns"]),I(D$("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:o,parentProjection:s,config:a}=n,u=eA({parentProjection:s,projection:r}),l=Z$({parentEncoding:o,encoding:j0(i,n.repeater)});return this.mapUnit({...t,...u?{projection:u}:{},...l?{encoding:l}:{}},{config:a})}mapFacetedUnit(t,n){const{row:i,column:r,facet:o,...s}=t.encoding,{mark:a,width:u,projection:l,height:c,view:f,params:d,encoding:h,...g}=t,{facetMapping:p,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:o},n),y=j0(s,n.repeater);return this.mapFacet({...g,...m,facet:p,spec:{...u?{width:u}:{},...c?{height:c}:{},...f?{view:f}:{},...l?{projection:l}:{},mark:a,encoding:y,...d?{params:d}:{}}},n)}getFacetMappingAndLayout(t,n){const{row:i,column:r,facet:o}=t;if(i||r){o&&I(Kne([...i?[Pr]:[],...r?[Lr]:[]]));const s={},a={};for(const u of[Pr,Lr]){const l=t[u];if(l){const{align:c,center:f,spacing:d,columns:h,...g}=l;s[u]=g;for(const p of["align","center","spacing"])l[p]!==void 0&&(a[p]??(a[p]={}),a[p][u]=l[p])}}return{facetMapping:s,layout:a}}else{const{align:s,center:a,spacing:u,columns:l,...c}=o;return{facetMapping:Koe(c,n.repeater),layout:{...s?{align:s}:{},...a?{center:a}:{},...u?{spacing:u}:{},...l?{columns:l}:{}}}}}mapLayer(t,{parentEncoding:n,parentProjection:i,...r}){const{encoding:o,projection:s,...a}=t,u={...r,parentEncoding:Z$({parentEncoding:n,encoding:o,layer:!0}),parentProjection:eA({parentProjection:i,projection:s})};return super.mapLayer({...a,...t.name?{name:[u.repeaterPrefix,t.name].filter(l=>l).join("_")}:{}},u)}}function Z$({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...P(e),...P(t)]);for(const o of r){const s=t[o],a=e[o];if(se(s)){const u={...a,...s};i[o]=u}else Of(s)?i[o]={...s,condition:{...a,...s.condition}}:s||s===null?i[o]=s:(n||$i(a)||Q(a)||se(a)||z(a))&&(i[o]=a)}}else i=t;return!i||Me(i)?void 0:i}function eA(e){const{parentProjection:t,projection:n}=e;return t&&n&&I(Ine({parentProjection:t,projection:n})),n??t}function a_(e){return"filter"in e}function Zoe(e){return e?.stop!==void 0}function sR(e){return"lookup"in e}function ese(e){return"data"in e}function tse(e){return"param"in e}function nse(e){return"pivot"in e}function ise(e){return"density"in e}function rse(e){return"quantile"in e}function ose(e){return"regression"in e}function sse(e){return"loess"in e}function ase(e){return"sample"in e}function use(e){return"window"in e}function lse(e){return"joinaggregate"in e}function cse(e){return"flatten"in e}function fse(e){return"calculate"in e}function aR(e){return"bin"in e}function dse(e){return"impute"in e}function hse(e){return"timeUnit"in e}function gse(e){return"aggregate"in e}function pse(e){return"stack"in e}function mse(e){return"fold"in e}function yse(e){return"extent"in e&&!("density"in e)}function bse(e){return e.map(t=>a_(t)?{filter:Za(t.filter,Hie)}:t)}class xse extends s_{map(t,n){return n.emptySelections??(n.emptySelections={}),n.selectionPredicates??(n.selectionPredicates={}),t=tA(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=tA(t,n),t.encoding){const i={};for(const[r,o]of Bo(t.encoding))i[r]=uR(o,n);t={...t,encoding:i}}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const{selection:i,...r}=t;return i?{...r,params:Bo(i).map(([o,s])=>{const{init:a,bind:u,empty:l,...c}=s;c.type==="single"?(c.type="point",c.toggle=!1):c.type==="multi"&&(c.type="point"),n.emptySelections[o]=l!=="none";for(const f of Et(n.selectionPredicates[o]??{}))f.empty=l!=="none";return{name:o,value:a,select:c,bind:u}})}:t}}function tA(e,t){const{transform:n,...i}=e;if(n){const r=n.map(o=>{if(a_(o))return{filter:Ky(o,t)};if(aR(o)&&va(o.bin))return{...o,bin:lR(o.bin)};if(sR(o)){const{selection:s,...a}=o.from;return s?{...o,from:{param:s,...a}}:o}return o});return{...i,transform:r}}return e}function uR(e,t){const n=oe(e);if(L(n)&&va(n.bin)&&(n.bin=lR(n.bin)),Sa(n)&&n.scale?.domain?.selection){const{selection:i,...r}=n.scale.domain;n.scale.domain={...r,...i?{param:i}:{}}}if(sm(n))if(z(n.condition))n.condition=n.condition.map(i=>{const{selection:r,param:o,test:s,...a}=i;return o?i:{...a,test:Ky(i,t)}});else{const{selection:i,param:r,test:o,...s}=uR(n.condition,t);n.condition=r?n.condition:{...s,test:Ky(n.condition,t)}}return n}function lR(e){const t=e.extent;if(t?.selection){const{selection:n,...i}=t;return{...e,extent:{...i,param:n}}}return e}function Ky(e,t){const n=i=>Za(i,r=>{var o;const s=t.emptySelections[r]??!0,a={param:r,empty:s};return(o=t.selectionPredicates)[r]??(o[r]=[]),t.selectionPredicates[r].push(a),a});return e.selection?n(e.selection):Za(e.test||e.filter,i=>i.selection?n(i.selection):i)}class Jy extends s_{map(t,n){const i=n.selections??[];if(t.params&&!Zr(t)){const r=[];for(const o of t.params)i_(o)?i.push(o):r.push(o);t.params=r}return n.selections=i,super.map(t,n)}mapUnit(t,n){const i=n.selections;if(!i||!i.length)return t;const r=(n.path??[]).concat(t.name),o=[];for(const s of i)if(!s.views||!s.views.length)o.push(s);else for(const a of s.views)(Y(a)&&(a===t.name||r.includes(a))||z(a)&&a.map(u=>r.indexOf(u)).every((u,l,c)=>u!==-1&&(l===0||u>c[l-1])))&&o.push(s);return o.length&&(t.params=o),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=Jy.prototype[e];Jy.prototype[e]=function(n,i){return t.call(this,n,vse(n,i))}}function vse(e,t){return e.name?{...t,path:(t.path??[]).concat(e.name)}:t}function cR(e,t){t===void 0&&(t=tR(e.config));const n=Ese(e,t),{width:i,height:r}=e,o=kse(n,{width:i,height:r,autosize:e.autosize},t);return{...n,...o?{autosize:o}:{}}}const wse=new Qoe,_se=new xse,Sse=new Jy;function Ese(e,t={}){const n={config:t};return Sse.map(wse.map(_se.map(e,n),n),n)}function nA(e){return Y(e)?{type:e}:e??{}}function kse(e,t,n){let{width:i,height:r}=t;const o=Zr(e)||hm(e),s={};o?i=="container"&&r=="container"?(s.type="fit",s.contains="padding"):i=="container"?(s.type="fit-x",s.contains="padding"):r=="container"&&(s.type="fit-y",s.contains="padding"):(i=="container"&&(I(A$("width")),i=void 0),r=="container"&&(I(A$("height")),r=void 0));const a={type:"pad",...s,...n?nA(n.autosize):{},...nA(e.autosize)};if(a.type==="fit"&&!o&&(I(Sne),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&I(C$("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&I(C$("height")),!Dn(a,{type:"pad"}))return a}function $se(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Ase(e){return e?`fit-${Xp(e)}`:"fit"}const Cse=["background","padding"];function iA(e,t){const n={};for(const i of Cse)e&&e[i]!==void 0&&(n[i]=Cn(e[i]));return t&&(n.params=e.params),n}class eo{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new eo(oe(this.explicit),oe(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(t){return Ve(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of P(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Bi(e){return{explicit:!0,value:e}}function kn(e){return{explicit:!1,value:e}}function fR(e){return(t,n,i,r)=>{const o=e(t.value,n.value);return o>0?t:o<0?n:gm(t,n,i,r)}}function gm(e,t,n,i){return e.explicit&&t.explicit&&I(uie(n,i,e.value,t.value)),e}function qo(e,t,n,i,r=gm){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Dn(e.value,t.value)?e:r(e,t,n,i)}class Mse extends eo{constructor(t={},n={},i=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function Ou(e){return"url"in e}function Hc(e){return"values"in e}function dR(e){return"name"in e&&!Ou(e)&&!Hc(e)&&!Ao(e)}function Ao(e){return e&&(hR(e)||gR(e)||u_(e))}function hR(e){return"sequence"in e}function gR(e){return"sphere"in e}function u_(e){return"graticule"in e}var Ne;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(Ne||(Ne={}));function pR(e){const{signals:t,hasLegend:n,index:i,...r}=e;return r.field=ti(r.field),r}function oa(e,t=!0,n=Ut){if(z(e)){const i=e.map(r=>oa(r,t,n));return t?`[${i.join(", ")}]`:i}else if(wa(e))return n(t?ta(e):Nie(e));return t?n(Fe(e)):e}function Fse(e,t){for(const n of Et(e.component.selection??{})){const i=n.name;let r=`${i}${Ho}, ${n.resolve==="global"?"true":`{unit: ${Is(e)}}`}`;for(const o of bm)o.defined(n)&&(o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(r=o.modifyExpr(e,n,r)));t.push({name:i+uae,on:[{events:{signal:n.name+Ho},update:`modify(${j(n.name+sa)}, ${r})`}]})}return l_(t)}function Dse(e,t){if(e.component.selection&&P(e.component.selection).length){const n=j(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Qo("pointermove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return l_(t)}function Tse(e,t){let n=!1;for(const i of Et(e.component.selection??{})){const r=i.name,o=j(r+sa);if(t.filter(a=>a.name===r).length===0){const a=i.resolve==="global"?"union":i.resolve,u=i.type==="point"?", true, true)":")";t.push({name:i.name,update:`${NR}(${o}, ${j(a)}${u}`})}n=!0;for(const a of bm)a.defined(i)&&a.topLevelSignals&&(t=a.topLevelSignals(e,i,t))}return n&&t.filter(r=>r.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"pointermove",update:"isTuple(group()) ? group() : unit"}]}),l_(t)}function Nse(e,t){const n=[...t],i=Is(e,{escape:!1});for(const r of Et(e.component.selection??{})){const o={name:r.name+sa};if(r.project.hasSelectionId&&(o.transform=[{type:"collect",sort:{field:Ai}}]),r.init){const a=r.project.items.map(pR);o.values=r.project.hasSelectionId?r.init.map(u=>({unit:i,[Ai]:oa(u,!1)[0]})):r.init.map(u=>({unit:i,fields:a,values:oa(u,!1)}))}n.filter(a=>a.name===r.name+sa).length||n.push(o)}return n}function mR(e,t){for(const n of Et(e.component.selection??{}))for(const i of bm)i.defined(n)&&i.marks&&(t=i.marks(e,n,t));return t}function Ose(e,t){for(const n of e.children)We(n)&&(t=mR(n,t));return t}function Rse(e,t,n,i){const r=LR(e,t.param,t);return{signal:Ln(n.get("type"))&&z(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function l_(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class Ce{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){I(zne);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this);const i=t.parent.removeChild(t);this._parent=n,n.addChild(this,i),t.parent=this}}class nn extends Ce{clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}constructor(t,n,i,r){super(t,n),this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${dO()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}function q0(e){return e.as!==void 0}function rA(e){return`${e}_end`}class Ki extends Ce{clone(){return new Ki(null,oe(this.timeUnits))}constructor(t,n){super(t),this.timeUnits=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,o,s)=>{const{field:a,timeUnit:u}=o;if(u){let l;if(_a(u)){if(We(n)){const{mark:c,markDef:f,config:d}=n,h=jo({fieldDef:o,markDef:f,config:d});(Wc(c)||h)&&(l={timeUnit:pt(u),field:a})}}else l={as:q(o,{forAs:!0}),field:a,timeUnit:u};if(We(n)){const{mark:c,markDef:f,config:d}=n,h=jo({fieldDef:o,markDef:f,config:d});Wc(c)&&Xe(s)&&h!==.5&&(l.rectBandPosition=h)}l&&(r[ge(l)]=l)}return r},{});return Me(i)?null:new Ki(t,i)}static makeFromTransform(t,n){const{timeUnit:i,...r}={...n},o=pt(i),s={...r,timeUnit:o};return new Ki(t,{[ge(s)]:s})}merge(t){this.timeUnits={...this.timeUnits};for(const n in t.timeUnits)this.timeUnits[n]||(this.timeUnits[n]=t.timeUnits[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Bo(this.timeUnits)){const o=q0(r)?r.as:`${r.field}_end`;t.has(o)||(n[i]=r)}this.timeUnits=n}producedFields(){return new Set(Et(this.timeUnits).map(t=>q0(t)?t.as:rA(t.field)))}dependentFields(){return new Set(Et(this.timeUnits).map(t=>t.field))}hash(){return`TimeUnit ${ge(this.timeUnits)}`}assemble(){const t=[];for(const n of Et(this.timeUnits)){const{rectBandPosition:i}=n,r=pt(n.timeUnit);if(q0(n)){const{field:o,as:s}=n,{unit:a,utc:u,...l}=r,c=[s,`${s}_end`];t.push({field:ti(o),type:"timeunit",...a?{units:Zp(a)}:{},...u?{timezone:"utc"}:{},...l,as:c}),t.push(...oA(c,i,r))}else if(n){const{field:o}=n,s=o.replaceAll("\\.","."),a=yR({timeUnit:r,field:s}),u=rA(s);t.push({type:"formula",expr:a,as:u}),t.push(...oA([s,u],i,r))}}return t}}const pm="offsetted_rect_start",mm="offsetted_rect_end";function yR({timeUnit:e,field:t,reverse:n}){const{unit:i,utc:r}=e,o=VO(i),{part:s,step:a}=QO(o,e.step);return`${r?"utcOffset":"timeOffset"}('${s}', datum['${t}'], ${n?-a:a})`}function oA([e,t],n,i){if(n!==void 0&&n!==.5){const r=`datum['${e}']`,o=`datum['${t}']`;return[{type:"formula",expr:sA([yR({timeUnit:i,field:e,reverse:!0}),r],n+.5),as:`${e}_${pm}`},{type:"formula",expr:sA([r,o],n+.5),as:`${e}_${mm}`}]}return[]}function sA([e,t],n){return`${1-n} * ${e} + ${n} * ${t}`}const Pf="_tuple_fields";class zse{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const Pse={defined:()=>!0,parse:(e,t,n)=>{const i=t.name,r=t.project??(t.project=new zse),o={},s={},a=new Set,u=(g,p)=>{const m=p==="visual"?g.channel:g.field;let y=Le(`${i}_${m}`);for(let b=1;a.has(y);b++)y=Le(`${i}_${m}_${b}`);return a.add(y),{[p]:y}},l=t.type,c=e.config.selection[l],f=n.value!==void 0?H(n.value):null;let{fields:d,encodings:h}=G(n.select)?n.select:{};if(!d&&!h&&f){for(const g of f)if(G(g))for(const p of P(g))Qte(p)?(h||(h=[])).push(p):l==="interval"?(I(Tne),h=c.encodings):(d??(d=[])).push(p)}!d&&!h&&(h=c.encodings,"fields"in c&&(d=c.fields));for(const g of h??[]){const p=e.fieldDef(g);if(p){let m=p.field;if(p.aggregate){I(Ene(g,p.aggregate));continue}else if(!m){I(F$(g));continue}if(p.timeUnit&&!_a(p.timeUnit)){m=e.vgField(g);const y={timeUnit:p.timeUnit,as:m,field:p.field};s[ge(y)]=y}if(!o[m]){const y=l==="interval"&&Qr(g)&&Ln(e.getScaleComponent(g).get("type"))?"R":p.bin?"R-RE":"E",b={field:m,channel:g,type:y,index:r.items.length};b.signals={...u(b,"data"),...u(b,"visual")},r.items.push(o[m]=b),r.hasField[m]=o[m],r.hasSelectionId=r.hasSelectionId||m===Ai,bO(g)?(b.geoChannel=g,b.channel=yO(g),r.hasChannel[b.channel]=o[m]):r.hasChannel[g]=o[m]}}else I(F$(g))}for(const g of d??[]){if(r.hasField[g])continue;const p={type:"E",field:g,index:r.items.length};p.signals={...u(p,"data")},r.items.push(p),r.hasField[g]=p,r.hasSelectionId=r.hasSelectionId||g===Ai}f&&(t.init=f.map(g=>r.items.map(p=>G(g)?g[p.geoChannel||p.channel]!==void 0?g[p.geoChannel||p.channel]:g[p.field]:g))),Me(s)||(r.timeUnit=new Ki(null,s))},signals:(e,t,n)=>{const i=t.name+Pf;return n.filter(o=>o.name===i).length>0||t.project.hasSelectionId?n:n.concat({name:i,value:t.project.items.map(pR)})}},Ir={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Qr(r))continue;const o=e.getScaleComponent(r),s=o?o.get("type"):void 0;if(!o||!Ln(s)){I(Ane);continue}o.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(s=>n.filter(a=>a.name===s.signals.data).length===0);if(!e.parent||aA(e)||i.length===0)return n;const r=n.filter(s=>s.name===t.name)[0];let o=r.update;if(o.indexOf(NR)>=0)r.update=`{${i.map(s=>`${j(ti(s.field))}: ${s.signals.data}`).join(", ")}}`;else{for(const s of i){const a=`${j(ti(s.field))}: ${s.signals.data}`;o.includes(a)||(o=`${o.substring(0,o.length-1)}, ${a}}`)}r.update=o}return n.concat(i.map(s=>({name:s.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!aA(e))for(const i of t.scales){const r=n.filter(o=>o.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Qy(e,t){return`domain(${j(e.scaleName(t))})`}function aA(e){return e.parent&&sl(e.parent)&&!e.parent.parent}const nu="_brush",bR="_scale_trigger",$l="geo_interval_init_tick",xR="_init",Lse="_center",Ise={defined:e=>e.type==="interval",parse:(e,t,n)=>{var i;if(e.hasProjection){const r={...G(n.select)?n.select:{}};r.fields=[Ai],r.encodings||(r.encodings=n.value?P(n.value):[Oi,Ni]),n.select={type:"interval",...r}}if(t.translate&&!Ir.defined(t)){const r=`!event.item || event.item.mark.name !== ${j(t.name+nu)}`;for(const o of t.events){if(!o.between){I(`${o} is not an ordered event stream for interval selections.`);continue}const s=H((i=o.between[0]).filter??(i.filter=[]));s.indexOf(r)<0&&s.push(r)}}},signals:(e,t,n)=>{const i=t.name,r=i+Ho,o=Et(t.project.hasChannel).filter(a=>a.channel===Ie||a.channel===bt),s=t.init?t.init[0]:null;if(n.push(...o.reduce((a,u)=>a.concat(Bse(e,t,u,s&&s[u.index])),[])),e.hasProjection){const a=j(e.projectionName()),u=e.projectionName()+Lse,{x:l,y:c}=t.project.hasChannel,f=l&&l.signals.visual,d=c&&c.signals.visual,h=l?s&&s[l.index]:`${u}[0]`,g=c?s&&s[c.index]:`${u}[1]`,p=w=>e.getSizeSignalRef(w).signal,m=`[[${f?f+"[0]":"0"}, ${d?d+"[0]":"0"}],[${f?f+"[1]":p("width")}, ${d?d+"[1]":p("height")}]]`;s&&(n.unshift({name:i+xR,init:`[scale(${a}, [${l?h[0]:h}, ${c?g[0]:g}]), scale(${a}, [${l?h[1]:h}, ${c?g[1]:g}])]`}),(!l||!c)&&(n.find(S=>S.name===u)||n.unshift({name:u,update:`invert(${a}, [${p("width")}/2, ${p("height")}/2])`})));const y=`intersect(${m}, {markname: ${j(e.getName("marks"))}}, unit.mark)`,b=`{unit: ${Is(e)}}`,x=`vlSelectionTuples(${y}, ${b})`,v=o.map(w=>w.signals.visual);return n.concat({name:r,on:[{events:[...v.length?[{signal:v.join(" || ")}]:[],...s?[{signal:$l}]:[]],update:x}]})}else{if(!Ir.defined(t)){const l=i+bR,c=o.map(f=>{const d=f.channel,{data:h,visual:g}=f.signals,p=j(e.scaleName(d)),m=e.getScaleComponent(d).get("type"),y=Ln(m)?"+":"";return`(!isArray(${h}) || (${y}invert(${p}, ${g})[0] === ${y}${h}[0] && ${y}invert(${p}, ${g})[1] === ${y}${h}[1]))`});c.length&&n.push({name:l,value:{},on:[{events:o.map(f=>({scale:e.scaleName(f.channel)})),update:c.join(" && ")+` ? ${l} : {}`}]})}const a=o.map(l=>l.signals.data),u=`unit: ${Is(e)}, fields: ${i+Pf}, values`;return n.concat({name:r,...s?{init:`{${u}: ${oa(s)}}`}:{},...a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${u}: [${a}]} : null`}]}:{}})}},topLevelSignals:(e,t,n)=>(We(e)&&e.hasProjection&&t.init&&(n.filter(r=>r.name===$l).length||n.unshift({name:$l,value:null,on:[{events:"timer{1}",update:`${$l} === null ? {} : ${$l}`}]})),n),marks:(e,t,n)=>{const i=t.name,{x:r,y:o}=t.project.hasChannel,s=r?.signals.visual,a=o?.signals.visual,u=`data(${j(t.name+sa)})`;if(Ir.defined(t)||!r&&!o)return n;const l={x:r!==void 0?{signal:`${s}[0]`}:{value:0},y:o!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${s}[1]`}:{field:{group:"width"}},y2:o!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const p of P(l))l[p]=[{test:`${u}.length && ${u}[0].unit === ${Is(e)}`,...l[p]},{value:0}];const{fill:c,fillOpacity:f,cursor:d,...h}=t.mark,g=P(h).reduce((p,m)=>(p[m]=[{test:[r!==void 0&&`${s}[0] !== ${s}[1]`,o!==void 0&&`${a}[0] !== ${a}[1]`].filter(y=>y).join(" && "),value:h[m]},{value:null}],p),{});return[{name:`${i+nu}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:c},fillOpacity:{value:f}},update:l}},...n,{name:i+nu,type:"rect",clip:!0,encode:{enter:{...d?{cursor:{value:d}}:{},fill:{value:"transparent"}},update:{...l,...g}}}]}};function Bse(e,t,n,i){const r=!e.hasProjection,o=n.channel,s=n.signals.visual,a=j(r?e.scaleName(o):e.projectionName()),u=d=>`scale(${a}, ${d})`,l=e.getSizeSignalRef(o===Ie?"width":"height").signal,c=`${o}(unit)`,f=t.events.reduce((d,h)=>[...d,{events:h.between[0],update:`[${c}, ${c}]`},{events:h,update:`[${s}[0], clamp(${c}, 0, ${l})]`}],[]);if(r){const d=n.signals.data,h=Ir.defined(t),g=e.getScaleComponent(o),p=g?g.get("type"):void 0,m=i?{init:oa(i,!0,u)}:{value:[]};return f.push({events:{signal:t.name+bR},update:Ln(p)?`[${u(`${d}[0]`)}, ${u(`${d}[1]`)}]`:"[0, 0]"}),h?[{name:d,on:[]}]:[{name:s,...m,on:f},{name:d,...i?{init:oa(i)}:{},on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${a}, ${s})`}]}]}else{const d=o===Ie?0:1,h=t.name+xR,g=i?{init:`[${h}[0][${d}], ${h}[1][${d}]]`}:{value:[]};return[{name:s,...g,on:f}]}}const Use={defined:e=>e.type==="point",signals:(e,t,n)=>{const i=t.name,r=i+Pf,o=t.project,s="(item().isVoronoi ? datum.datum : datum)",a=Et(e.component.selection??{}).reduce((f,d)=>d.type==="interval"?f.concat(d.name+nu):f,[]).map(f=>`indexof(item().mark.name, '${f}') < 0`).join(" && "),u=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${a?` && ${a}`:""}`;let l=`unit: ${Is(e)}, `;if(t.project.hasSelectionId)l+=`${Ai}: ${s}[${j(Ai)}]`;else{const f=o.items.map(d=>e.fieldDef(d.channel)?.bin?`[${s}[${j(e.vgField(d.channel,{}))}], ${s}[${j(e.vgField(d.channel,{binSuffix:"end"}))}]]`:`${s}[${j(d.field)}]`).join(", ");l+=`fields: ${r}, values: [${f}]`}const c=t.events;return n.concat([{name:i+Ho,on:c?[{events:c,update:`${u} ? {${l}} : null`,force:!0}]:[]}])}};function nl(e,t,n,i){const r=sm(t)&&t.condition,o=i(t);if(r){const a=H(r).map(u=>{const l=i(u);if(Dre(u)){const{param:c,empty:f}=u;return{test:PR(e,{param:c,empty:f}),...l}}else return{test:$g(e,u.test),...l}});return{[n]:[...a,...o!==void 0?[o]:[]]}}else return o!==void 0?{[n]:o}:{}}function c_(e,t="text"){const n=e.encoding[t];return nl(e,n,t,i=>ym(i,e.config))}function ym(e,t,n="datum"){if(e){if($i(e))return ze(e.value);if(se(e)){const{format:i,formatType:r}=xg(e);return qw({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function vR(e,t={}){const{encoding:n,markDef:i,config:r,stack:o}=e,s=n.tooltip;if(z(s))return{tooltip:uA({tooltip:s},o,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return nl(e,s,"tooltip",u=>{const l=ym(u,r,a);if(l)return l;if(u===null)return;let c=$e("tooltip",i,r);if(c===!0&&(c={content:"encoding"}),Y(c))return{value:c};if(G(c))return Q(c)?c:c.content==="encoding"?uA(n,o,r,t):{signal:a}})}}function wR(e,t,n,{reactiveGeom:i}={}){const r={...n,...n.tooltipFormat},o={},s=i?"datum.datum":"datum",a=[];function u(c,f){const d=xa(f),h=sn(c)?c:{...c,type:e[d].type},g=h.title||Yw(h,r),p=H(g).join(", ").replaceAll(/"/g,'\\"');let m;if(Xe(f)){const y=f==="x"?"x2":"y2",b=or(e[y]);if(vt(h.bin)&&b){const x=q(h,{expr:s}),v=q(b,{expr:s}),{format:w,formatType:S}=xg(h);m=Tf(x,v,w,S,r),o[y]=!0}}if((Xe(f)||f===ri||f===Ti)&&t&&t.fieldChannel===f&&t.offset==="normalize"){const{format:y,formatType:b}=xg(h);m=qw({fieldOrDatumDef:h,format:y,formatType:b,expr:s,config:r,normalizeStack:!0}).signal}m??(m=ym(h,r,s).signal),a.push({channel:f,key:p,value:m})}Kw(e,(c,f)=>{L(c)?u(c,f):am(c)&&u(c.condition,f)});const l={};for(const{channel:c,key:f,value:d}of a)!o[c]&&!l[f]&&(l[f]=d);return l}function uA(e,t,n,{reactiveGeom:i}={}){const r=wR(e,t,n,{reactiveGeom:i}),o=Bo(r).map(([s,a])=>`"${s}": ${a}`);return o.length>0?{signal:`{${o.join(", ")}}`}:void 0}function jse(e){const{markDef:t,config:n}=e,i=$e("aria",t,n);return i===!1?{}:{...i?{aria:i}:{},...qse(e),...Wse(e)}}function qse(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=$e("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in vne?{}:{ariaRoleDescription:{value:t}}}function Wse(e){const{encoding:t,markDef:n,config:i,stack:r}=e,o=t.description;if(o)return nl(e,o,"description",u=>ym(u,e.config));const s=$e("description",n,i);if(s!=null)return{description:ze(s)};if(i.aria===!1)return{};const a=wR(t,r,i);if(!Me(a))return{description:{signal:Bo(a).map(([u,l],c)=>`"${c>0?"; ":""}${u}: " + (${l})`).join(" + ")}}}function lt(e,t,n={}){const{markDef:i,encoding:r,config:o}=t,{vgChannel:s}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u??(u=$e(e,i,o,{vgChannel:s,ignoreVgConfig:!0})),u!==void 0&&(a=ze(u)));const l=r[e];return nl(t,l,s??e,c=>jw({channel:e,channelDef:c,markDef:i,config:o,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function _R(e,t={filled:void 0}){const{markDef:n,encoding:i,config:r}=e,{type:o}=n,s=t.filled??$e("filled",n,r),a=pe(["bar","point","circle","square","geoshape"],o)?"transparent":void 0,u=$e(s===!0?"color":void 0,n,r,{vgChannel:"fill"})??r.mark[s===!0&&"color"]??a,l=$e(s===!1?"color":void 0,n,r,{vgChannel:"stroke"})??r.mark[s===!1&&"color"],c=s?"fill":"stroke",f={...u?{fill:ze(u)}:{},...l?{stroke:ze(l)}:{}};return n.color&&(s?n.fill:n.stroke)&&I(IO("property",{fill:"fill"in n,stroke:"stroke"in n})),{...f,...lt("color",e,{vgChannel:c,defaultValue:s?u:l}),...lt("fill",e,{defaultValue:i.fill?u:void 0}),...lt("stroke",e,{defaultValue:i.stroke?l:void 0})}}function Hse(e){const{encoding:t,mark:n}=e,i=t.order;return!ss(n)&&$i(i)?nl(e,i,"zindex",r=>ze(r.value)):{}}function Ru({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const o=`${e}Offset`,s=t[o],a=n[o];if((o==="xOffset"||o==="yOffset")&&a)return{offsetType:"encoding",offset:jw({channel:o,channelDef:a,markDef:t,config:i?.config,scaleName:i.scaleName(o),scale:i.getScaleComponent(o),stack:null,defaultRef:ze(s),bandPosition:r})};const u=t[o];return u?{offsetType:"visual",offset:u}:{}}function Rt(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:o,config:s,stack:a}=t,u=r[e],l=r[mr(e)],c=t.scaleName(e),f=t.getScaleComponent(e),{offset:d,offsetType:h}=Ru({channel:e,markDef:o,encoding:r,model:t,bandPosition:.5}),g=f_({model:t,defaultPos:n,channel:e,scaleName:c,scale:f}),p=!u&&Xe(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:Gse({channel:e,channelDef:u,channel2Def:l,markDef:o,config:s,scaleName:c,scale:f,stack:a,offset:d,defaultRef:g,bandPosition:h==="encoding"?0:void 0});return p?{[i||e]:p}:void 0}function Gse(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:o,markDef:s}=e;if(se(n)&&r&&t===r.fieldChannel){if(L(n)){let a=n.bandPosition;if(a===void 0&&s.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return mg({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:o})}return Ps(n,i,{suffix:"end"},{offset:o})}return Bw(e)}function f_({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:o,config:s}=e;return()=>{const a=xa(n),u=Uo(n),l=$e(n,o,s,{vgChannel:u});if(l!==void 0)return dc(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!pe([mn.LOG,mn.TIME,mn.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return{...e[_n(n)],mult:.5}}}}const Yse={left:"x",center:"xc",right:"x2"},Vse={top:"y",middle:"yc",bottom:"y2"};function SR(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Uo(e);const r=e==="x"?"align":"baseline",o=$e(r,t,n);let s;return Q(o)?(I(Jne(r)),s=void 0):s=o,e==="x"?Yse[s||(i==="top"?"left":"center")]:Vse[s||i]}function Eg(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?ER(e,t,{defaultPos:n,defaultPos2:i}):Rt(e,t,{defaultPos:n})}function ER(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:o}=t,s=mr(e),a=_n(e),u=Xse(t,i,s),l=u[a]?SR(e,r,o):Uo(e);return{...Rt(e,t,{defaultPos:n,vgChannel:l}),...u}}function Xse(e,t,n){const{encoding:i,mark:r,markDef:o,stack:s,config:a}=e,u=xa(n),l=_n(n),c=Uo(n),f=i[u],d=e.scaleName(u),h=e.getScaleComponent(u),{offset:g}=n in i||n in o?Ru({channel:n,markDef:o,encoding:i,model:e}):Ru({channel:u,markDef:o,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=_n(n),y=e.markDef[m];return y!=null?{[m]:{value:y}}:{[c]:{field:e.getName(n)}}}const p=Kse({channel:n,channelDef:f,channel2Def:i[n],markDef:o,config:a,scaleName:d,scale:h,stack:s,offset:g,defaultRef:void 0});return p!==void 0?{[c]:p}:yd(n,o)||yd(n,{[n]:hg(n,o,a.style),[l]:hg(l,o,a.style)})||yd(n,a[r])||yd(n,a.mark)||{[c]:f_({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function Kse({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:s,stack:a,offset:u,defaultRef:l}){return se(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Ps(t,o,{suffix:"start"},{offset:u}):Bw({channel:e,channelDef:n,scaleName:o,scale:s,stack:a,markDef:i,config:r,offset:u,defaultRef:l})}function yd(e,t){const n=_n(e),i=Uo(e);if(t[i]!==void 0)return{[i]:dc(e,t[i])};if(t[e]!==void 0)return{[i]:dc(e,t[e])};if(t[n]){const r=t[n];if(ia(r))I(Hne(n));else return{[n]:dc(e,r)}}}function Wo(e,t){const{config:n,encoding:i,markDef:r}=e,o=r.type,s=mr(t),a=_n(t),u=i[t],l=i[s],c=e.getScaleComponent(t),f=c?c.get("type"):void 0,d=r.orient,h=i[a]??i.size??$e("size",r,n,{vgChannel:a}),g=_O(t),p=o==="bar"&&(t==="x"?d==="vertical":d==="horizontal");return L(u)&&(Oe(u.bin)||vt(u.bin)||u.timeUnit&&!l)&&!(h&&!ia(h))&&!i[g]&&!mt(f)?Zse({fieldDef:u,fieldDef2:l,channel:t,model:e}):(se(u)&&mt(f)||p)&&!l?Qse(u,t,e):ER(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Jse(e,t,n,i,r,o,s){if(ia(r))if(n){const u=n.get("type");if(u==="band"){let l=`bandwidth('${t}')`;r.band!==1&&(l=`${r.band} * ${l}`);const c=Hr("minBandSize",{type:s},i);return{signal:c?`max(${yi(c)}, ${l})`:l}}else r.band!==1&&(I(tie(u)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(Q(r))return r;if(r)return{value:r}}if(n){const u=n.get("range");if(os(u)&&xe(u.step))return{value:u.step-2}}if(!o){const{bandPaddingInner:u,barBandPaddingInner:l,rectBandPaddingInner:c}=i.scale,f=Ve(u,s==="bar"?l:c);if(Q(f))return{signal:`(1 - (${f.signal})) * ${e}`};if(xe(f))return{signal:`${1-f} * ${e}`}}return{value:_g(i.view,e)-2}}function Qse(e,t,n){const{markDef:i,encoding:r,config:o,stack:s}=n,a=i.orient,u=n.scaleName(t),l=n.getScaleComponent(t),c=_n(t),f=mr(t),d=_O(t),h=n.scaleName(d),g=n.getScaleComponent(yw(t)),p=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let m;(r.size||i.size)&&(p?m=lt("size",n,{vgChannel:c,defaultRef:ze(i.size)}):I(oie(i.type)));const y=!!m,b=v6({channel:t,fieldDef:e,markDef:i,config:o,scaleType:(l||g)?.get("type"),useVlSizeChannel:p});m=m||{[c]:Jse(c,h||u,g||l,o,b,!!e,i.type)};const x=(l||g)?.get("type")==="band"&&ia(b)&&!y?"top":"middle",v=SR(t,i,o,x),w=v==="xc"||v==="yc",{offset:S,offsetType:_}=Ru({channel:t,markDef:i,encoding:r,model:n,bandPosition:w?.5:0}),E=Bw({channel:t,channelDef:e,markDef:i,config:o,scaleName:u,scale:l,stack:s,offset:S,defaultRef:f_({model:n,defaultPos:"mid",channel:t,scaleName:u,scale:l}),bandPosition:w?_==="encoding"?0:.5:Q(b)?{signal:`(1-${b})/2`}:ia(b)?(1-b.band)/2:0});if(c)return{[v]:E,...m};{const A=Uo(f),k=m[c],$=S?{...k,offset:S}:k;return{[v]:E,[A]:z(E)?[E[0],{...E[1],offset:$}]:{...E,offset:$}}}}function lA(e,t,n,i,r,o,s){if(mO(e))return 0;const a=e==="x"||e==="y2",u=a?-t/2:t/2;if(Q(n)||Q(r)||Q(i)||o){const l=yi(n),c=yi(r),f=yi(i),d=yi(o),g=o?`(${s} < ${d} ? ${a?"":"-"}0.5 * (${d} - (${s})) : ${u})`:u,p=f?`${f} + `:"",m=l?`(${l} ? -1 : 1) * `:"",y=c?`(${c} + ${g})`:g;return{signal:p+m+y}}else return r=r||0,i+(n?-r-u:+r+u)}function Zse({fieldDef:e,fieldDef2:t,channel:n,model:i}){const{config:r,markDef:o,encoding:s}=i,a=i.getScaleComponent(n),u=i.scaleName(n),l=a?a.get("type"):void 0,c=a.get("reverse"),f=v6({channel:n,fieldDef:e,markDef:o,config:r,scaleType:l}),h=i.component.axes[n]?.[0]?.get("translate")??.5,g=Xe(n)?$e("binSpacing",o,r)??0:0,p=mr(n),m=Uo(n),y=Uo(p),b=Hr("minBandSize",o,r),{offset:x}=Ru({channel:n,markDef:o,encoding:s,model:i,bandPosition:0}),{offset:v}=Ru({channel:p,markDef:o,encoding:s,model:i,bandPosition:0}),w=$re({fieldDef:e,scaleName:u}),S=lA(n,g,c,h,x,b,w),_=lA(p,g,c,h,v??x,b,w),E=Q(f)?{signal:`(1-${f.signal})/2`}:ia(f)?(1-f.band)/2:.5,A=jo({fieldDef:e,fieldDef2:t,markDef:o,config:r});if(Oe(e.bin)||e.timeUnit){const k=e.timeUnit&&A!==.5;return{[y]:cA({fieldDef:e,scaleName:u,bandPosition:E,offset:_,useRectOffsetField:k}),[m]:cA({fieldDef:e,scaleName:u,bandPosition:Q(E)?{signal:`1-${E.signal}`}:1-E,offset:S,useRectOffsetField:k})}}else if(vt(e.bin)){const k=Ps(e,u,{},{offset:_});if(L(t))return{[y]:k,[m]:Ps(t,u,{},{offset:S})};if(va(e.bin)&&e.bin.step)return{[y]:k,[m]:{signal:`scale("${u}", ${q(e,{expr:"datum"})} + ${e.bin.step})`,offset:S}}}I(jO(p))}function cA({fieldDef:e,scaleName:t,bandPosition:n,offset:i,useRectOffsetField:r}){return mg({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i,...r?{startSuffix:pm,endSuffix:mm}:{}})}const eae=new Set(["aria","width","height"]);function oi(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?_R(e):{};return{...tae(e.markDef,t),...fA(e,"fill",n),...fA(e,"stroke",i),...lt("opacity",e),...lt("fillOpacity",e),...lt("strokeOpacity",e),...lt("strokeWidth",e),...lt("strokeDash",e),...Hse(e),...vR(e),...c_(e,"href"),...jse(e)}}function fA(e,t,n){const{config:i,mark:r,markDef:o}=e;if($e("invalid",o,i)==="hide"&&n&&!ss(r)){const a=nae(e,{invalid:!0,channels:Kp});if(a)return{[t]:[{test:a,value:null},...H(n)]}}return n?{[t]:n}:{}}function tae(e,t){return xne.reduce((n,i)=>(!eae.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=ze(e[i])),n),{})}function nae(e,{invalid:t=!1,channels:n}){const i=n.reduce((o,s)=>{const a=e.getScaleComponent(s);if(a){const u=a.get("type"),l=e.vgField(s,{expr:"datum"});l&&Ln(u)&&(o[l]=!0)}return o},{}),r=P(i);if(r.length>0){const o=t?"||":"&&";return r.map(s=>Uw(s,t)).join(` ${o} `)}}function d_(e){const{config:t,markDef:n}=e;if($e("invalid",n,t)){const r=iae(e,{channels:yr});if(r)return{defined:{signal:r}}}return{}}function iae(e,{invalid:t=!1,channels:n}){const i=n.reduce((o,s)=>{const a=e.getScaleComponent(s);if(a){const u=a.get("type"),l=e.vgField(s,{expr:"datum",binSuffix:e.stack?.impute?"mid":void 0});l&&Ln(u)&&(o[l]=!0)}return o},{}),r=P(i);if(r.length>0){const o=t?"||":"&&";return r.map(s=>Uw(s,t)).join(` ${o} `)}}function dA(e,t){if(t!==void 0)return{[e]:ze(t)}}const W0="voronoi",kR={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(W0)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,o=e.mark;if(ss(o))return I(kne(o)),n;const s={name:e.getName(W0),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...vR(e,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((l,c)=>{const f=l.name??"";f===e.component.mark[0].name?a=c:f.indexOf(W0)>=0&&(u=!0)}),u||n.splice(a+1,0,s),n}},$R={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!n_(e.bind),parse:(e,t,n)=>OR(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,o=t.bind,s=t.init&&t.init[0],a=kR.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((u,l)=>{const c=Le(`${i}_${u.field}`);n.filter(d=>d.name===c).length||n.unshift({name:c,...s?{init:oa(s[l])}:{value:null},on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${j(u.field)}] : null`}]:[],bind:o[u.field]??o[u.channel]??o})}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.filter(l=>l.name===i+Ho)[0],s=i+Pf,a=r.items.map(l=>Le(`${i}_${l.field}`)),u=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(o.update=`${u} ? {fields: ${s}, values: [${a.join(", ")}]} : null`),delete o.value,delete o.on,n}},kg="_toggle",AR={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+kg,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Ho,i=t.name+kg;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Is(e)}}, `)+`${i} ? ${n} : null`}},rae={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=Y(t.clear)?Qo(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if($R.defined(t))for(const i of t.project.items){const r=n.findIndex(o=>o.name===Le(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,o){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:o})}if(t.type==="interval")for(const r of t.project.items){const o=n.findIndex(s=>s.name===r.signals.visual);if(i(o,"[0, 0]"),o===-1){const s=n.findIndex(a=>a.name===r.signals.data);i(s,"null")}}else{let r=n.findIndex(o=>o.name===t.name+Ho);i(r,"null"),AR.defined(t)&&(r=n.findIndex(o=>o.name===t.name+kg),i(r,"false"))}return n}},CR={defined:e=>{const t=e.resolve==="global"&&e.bind&&n_(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Ai;return t&&!n&&I(Cne),t&&n},parse:(e,t,n)=>{const i=oe(n);if(i.select=Y(i.select)?{type:i.select,toggle:t.toggle}:{...i.select,toggle:t.toggle},OR(t,i),G(n.select)&&(n.select.on||n.select.clear)){const s='event.item && indexof(event.item.mark.role, "legend") < 0';for(const a of t.events)a.filter=H(a.filter??[]),a.filter.includes(s)||a.filter.push(s)}const r=B0(t.bind)?t.bind.legend:"click",o=Y(r)?Qo(r,"view"):H(r);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=B0(t.bind)&&t.bind.legend,o=s=>a=>{const u=oe(a);return u.markname=s,u};for(const s of t.project.items){if(!s.hasLegend)continue;const a=`${Le(s.field)}_legend`,u=`${i}_${a}`;if(n.filter(c=>c.name===u).length===0){const c=r.merge.map(o(`${a}_symbols`)).concat(r.merge.map(o(`${a}_labels`))).concat(r.merge.map(o(`${a}_entries`)));n.unshift({name:u,...t.init?{}:{value:null},on:[{events:c,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]})}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.find(d=>d.name===i+Ho),s=i+Pf,a=r.items.filter(d=>d.hasLegend).map(d=>Le(`${i}_${Le(d.field)}_legend`)),l=`${a.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${s}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?o.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(o.update=l,delete o.value,delete o.on);const c=n.find(d=>d.name===i+kg),f=B0(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push({...c.on[0],events:f}):c.on[0].events=f),n}};function oae(e,t,n){const i=e.fieldDef(t)?.field;for(const r of Et(e.component.selection??{})){const o=r.project.hasField[i]??r.project.hasChannel[t];if(o&&CR.defined(r)){const s=n.get("selections")??[];s.push(r.name),n.set("selections",s,!1),o.hasLegend=!0}}}const MR="_translate_anchor",FR="_translate_delta",sae={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Ir.defined(t),o=i+MR,{x:s,y:a}=t.project.hasChannel;let u=Qo(t.translate,"scope");return r||(u=u.map(l=>(l.between[0].markname=i+nu,l))),n.push({name:o,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(s!==void 0?`, extent_x: ${r?Qy(e,Ie):`slice(${s.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?Qy(e,bt):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+FR,value:{},on:[{events:u,update:`{x: ${o}.x - x(unit), y: ${o}.y - y(unit)}`}]}),s!==void 0&&hA(e,t,s,"width",n),a!==void 0&&hA(e,t,a,"height",n),n}};function hA(e,t,n,i,r){const o=t.name,s=o+MR,a=o+FR,u=n.channel,l=Ir.defined(t),c=r.filter(w=>w.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(u),h=d&&d.get("type"),g=d&&d.get("reverse"),p=l?u===Ie?g?"":"-":g?"-":"":"",m=`${s}.extent_${u}`,y=`${p}${a}.${u} / ${l?`${f}`:`span(${m})`}`,b=!l||!d?"panLinear":h==="log"?"panLog":h==="symlog"?"panSymlog":h==="pow"?"panPow":"panLinear",x=l?h==="pow"?`, ${d.get("exponent")??1}`:h==="symlog"?`, ${d.get("constant")??1}`:"":"",v=`${b}(${m}, ${y}${x})`;c.on.push({events:{signal:a},update:l?v:`clampRange(${v}, 0, ${f})`})}const DR="_zoom_anchor",TR="_zoom_delta",aae={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Ir.defined(t),o=i+TR,{x:s,y:a}=t.project.hasChannel,u=j(e.scaleName(Ie)),l=j(e.scaleName(bt));let c=Qo(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+nu,f))),n.push({name:i+DR,on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),s!==void 0&&gA(e,t,s,"width",n),a!==void 0&&gA(e,t,a,"height",n),n}};function gA(e,t,n,i,r){const o=t.name,s=n.channel,a=Ir.defined(t),u=r.filter(b=>b.name===n.signals[a?"data":"visual"])[0],l=e.getSizeSignalRef(i).signal,c=e.getScaleComponent(s),f=c&&c.get("type"),d=a?Qy(e,s):u.name,h=o+TR,g=`${o}${DR}.${s}`,p=!a||!c?"zoomLinear":f==="log"?"zoomLog":f==="symlog"?"zoomSymlog":f==="pow"?"zoomPow":"zoomLinear",m=a?f==="pow"?`, ${c.get("exponent")??1}`:f==="symlog"?`, ${c.get("constant")??1}`:"":"",y=`${p}(${d}, ${g}, ${h}${m})`;u.on.push({events:{signal:h},update:a?y:`clampRange(${y}, 0, ${l})`})}const sa="_store",Ho="_tuple",uae="_modify",NR="vlSelectionResolve",bm=[Use,Ise,Pse,AR,$R,Ir,CR,rae,sae,aae,kR];function lae(e){let t=e.parent;for(;t&&!_i(t);)t=t.parent;return t}function Is(e,{escape:t}={escape:!0}){let n=t?j(e.name):e.name;const i=lae(e);if(i){const{facet:r}=i;for(const o of Yn)r[o]&&(n+=` + '__facet_${o}_' + (facet[${j(i.vgField(o))}])`)}return n}function h_(e){return Et(e.component.selection??{}).reduce((t,n)=>t||n.project.hasSelectionId,!1)}function OR(e,t){(Y(t.select)||!t.select.on)&&delete e.events,(Y(t.select)||!t.select.clear)&&delete e.clear,(Y(t.select)||!t.select.toggle)&&delete e.toggle}function Zy(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...Zy(e.object)),t.push(...Zy(e.property))),t)}function RR(e){return e.object.type==="MemberExpression"?RR(e.object):e.object.name==="datum"}function zR(e){const t=T2(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&RR(i)&&n.add(Zy(i).slice(1).join("."))}),n}class il extends Ce{clone(){return new il(null,this.model,oe(this.filter))}constructor(t,n,i){super(t),this.model=n,this.filter=i,this.expr=$g(this.model,this.filter,this),this._dependentFields=zR(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function cae(e,t){const n={},i=e.config.selection;if(!t||!t.length)return n;for(const r of t){const o=Le(r.name),s=r.select,a=Y(s)?s:s.type,u=G(s)?oe(s):{type:a},l=i[a];for(const d in l)d==="fields"||d==="encodings"||(d==="mark"&&(u[d]={...l[d],...u[d]}),(u[d]===void 0||u[d]===!0)&&(u[d]=oe(l[d]??u[d])));const c=n[o]={...u,name:o,type:a,init:r.value,bind:r.bind,events:Y(u.on)?Qo(u.on,"scope"):H(oe(u.on))},f=oe(r);for(const d of bm)d.defined(c)&&d.parse&&d.parse(e,c,f)}return n}function PR(e,t,n,i="datum"){const r=Y(t)?t:t.param,o=Le(r),s=j(o+sa);let a;try{a=e.getSelectionComponent(o,r)}catch{return`!!${o}`}if(a.project.timeUnit){const d=n??e.component.data.raw,h=a.project.timeUnit.clone();d.parent?h.insertAsParentOf(d):d.parent=h}const u=a.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",l=a.resolve==="global"?")":`, ${j(a.resolve)})`,c=`${u}${s}, ${i}${l}`,f=`length(data(${s}))`;return t.empty===!1?`${f} && ${c}`:`!${f} || ${c}`}function LR(e,t,n){const i=Le(t),r=n.encoding;let o=n.field,s;try{s=e.getSelectionComponent(i,t)}catch{return i}if(!r&&!o)o=s.project.items[0].field,s.project.items.length>1&&I(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${j(o)}.`);else if(r&&!o){const a=s.project.items.filter(u=>u.channel===r);!a.length||a.length>1?(o=s.project.items[0].field,I((a.length?"Multiple ":"No ")+`matching ${j(r)} encoding found for selection ${j(n.param)}. Using "field": ${j(o)}.`)):o=a[0].field}return`${s.name}[${j(ti(o))}]`}function fae(e,t){for(const[n,i]of Bo(e.component.selection??{})){const r=e.getName(`lookup_${n}`);e.component.data.outputNodes[r]=i.materialized=new nn(new il(t,e,{param:n}),r,Ne.Lookup,e.component.data.outputNodeRefCounts)}}function $g(e,t,n){return fc(t,i=>Y(i)?i:jie(i)?PR(e,i,n):e6(i))}function dae(e,t){if(e)return z(e)&&!co(e)?e.map(n=>Yw(n,t)).join(", "):e}function H0(e,t,n,i){var r,o;e.encode??(e.encode={}),(r=e.encode)[t]??(r[t]={}),(o=e.encode[t]).update??(o.update={}),e.encode[t].update[n]=i}function Ql(e,t,n,i={header:!1}){const{disable:r,orient:o,scale:s,labelExpr:a,title:u,zindex:l,...c}=e.combine();if(!r){for(const f in c){const d=Hre[f],h=c[f];if(d&&d!==t&&d!=="both")delete c[f];else if(zf(h)){const{condition:g,...p}=h,m=H(g),y=j$[f];if(y){const{vgProp:b,part:x}=y,v=[...m.map(w=>{const{test:S,..._}=w;return{test:$g(null,S),..._}}),p];H0(c,x,b,v),delete c[f]}else if(y===null){const b={signal:m.map(x=>{const{test:v,...w}=x;return`${$g(null,v)} ? ${$$(w)} : `}).join("")+$$(p)};c[f]=b}}else if(Q(h)){const g=j$[f];if(g){const{vgProp:p,part:m}=g;H0(c,m,p,h),delete c[f]}}pe(["labelAlign","labelBaseline"],f)&&c[f]===null&&delete c[f]}if(t==="grid"){if(!c.grid)return;if(c.encode){const{grid:f}=c.encode;c.encode={...f?{grid:f}:{}},Me(c.encode)&&delete c.encode}return{scale:s,orient:o,...c,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Ve(l,0)}}else{if(!i.header&&e.mainExtracted)return;if(a!==void 0){let d=a;c.encode?.labels?.update&&Q(c.encode.labels.update.text)&&(d=Zs(a,"datum.label",c.encode.labels.update.text.signal)),H0(c,"labels","text",{signal:d})}if(c.labelAlign===null&&delete c.labelAlign,c.encode){for(const d of F6)e.hasAxisPart(d)||delete c.encode[d];Me(c.encode)&&delete c.encode}const f=dae(u,n);return{scale:s,orient:o,grid:!1,...f?{title:f}:{},...c,...n.aria===!1?{aria:!1}:{},zindex:Ve(l,0)}}}}function IR(e){const{axes:t}=e.component,n=[];for(const i of yr)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const o=i==="x"?"height":"width",s=e.getSizeSignalRef(o).signal;o!==s&&n.push({name:o,update:s})}}return n}function hae(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>Ql(r,"grid",t)),...i.map(r=>Ql(r,"grid",t)),...n.map(r=>Ql(r,"main",t)),...i.map(r=>Ql(r,"main",t))].filter(r=>r)}function pA(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const o=n==="x"?"bottom":"left",s=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...P(s),...P(a)]),l={};for(const c of u.values())l[c]={signal:`${i.signal} === "${o}" ? ${yi(s[c])} : ${yi(a[c])}`};return l}return t[r]})])}function gae(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:r6(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],o=e==="x"?"axisX":"axisY",s=Q(n)?"axisOrient":`axis${$f(n)}`,a=[...r,...r.map(l=>o+l.substr(4))],u=["axis",s,o];return{vlOnlyAxisConfig:pA(a,i,e,n),vgAxisConfig:pA(u,i,e,n),axisConfigStyle:pae([...u,...a],i)}}function pae(e,t){const n=[{}];for(const i of e){let r=t[i]?.style;if(r){r=H(r);for(const o of r)n.push(t.style[o])}}return Object.assign.apply(null,n)}function eb(e,t,n,i={}){const r=TO(e,n,t);if(r!==void 0)return{configFrom:"style",configValue:r};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(i[o]?.[e]!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const mA={scale:({model:e,channel:t})=>e.scaleName(t),format:({format:e})=>e,formatType:({formatType:e})=>e,grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>t.grid??mae(n,e),gridScale:({model:e,channel:t})=>yae(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||UR(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||BR(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>e.labelFlush??xae(t.type,n),labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>e.labelOverlap??vae(t.type,n,L(t)&&!!t.timeUnit,L(t)?t.sort:void 0),orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{const o=e==="x"?"width":e==="y"?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return n.tickCount??_ae({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},tickMinStep:Sae,title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=jR(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),o=n==="x"?"x2":"y2",s=t.fieldDef(o);return OO(r?[B$(r)]:[],L(s)?[B$(s)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Eae(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>e.zindex??kae(n,t)};function mae(e,t){return!mt(e)&&L(t)&&!Oe(t?.bin)&&!vt(t?.bin)}function yae(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function bae(e,t,n,i,r){const o=t?.labelAngle;if(o!==void 0)return Q(o)?o:qc(o);{const{configValue:s}=eb("labelAngle",i,t?.style,r);return s!==void 0?qc(s):n===Ie&&pe([zw,Rw],e.type)&&!(L(e)&&e.timeUnit)?270:void 0}}function tb(e){return`(((${e.signal} % 360) + 360) % 360)`}function BR(e,t,n,i){if(e!==void 0)if(n==="x"){if(Q(e)){const r=tb(e),o=Q(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${o} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Q(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(Q(e)){const r=tb(e),o=Q(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${o} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(Q(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function UR(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,o=i?"bottom":"left";if(Q(e)){const s=tb(e),a=Q(t)?`(${t.signal} === "${o}")`:t===o;return{signal:`(${r?`(${s} + 90)`:s} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${s} && ${s} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(Q(t)){const s=r<e&&e<180+r?"===":"!==";return{signal:`${`${t.signal} ${s} "${o}"`} ? "left" : "right"`}}return(r<e&&e<180+r)==(t===o)?"left":"right"}function xae(e,t){if(t==="x"&&pe(["quantitative","temporal"],e))return!0}function vae(e,t,n,i){if(n&&!G(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function wae(e){return e==="x"?"bottom":"left"}function _ae({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){if(!i&&!mt(t)&&t!=="log"){if(L(e)){if(Oe(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&pe(["month","hours","day","quarter"],pt(e.timeUnit)?.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function Sae({format:e,fieldOrDatumDef:t}){if(e==="d")return 1;if(L(t)){const{timeUnit:n}=t;if(n){const i=JO(n);if(i)return{signal:i}}}}function jR(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),o=i?i.title:void 0,s=r?r.title:void 0;if(o&&s)return RO(o,s);if(o)return o;if(s)return s;if(o!==void 0)return o;if(s!==void 0)return s}function Eae(e,t){const n=e.values;if(z(n))return M6(t,n);if(Q(n))return n}function kae(e,t){return e==="rect"&&bg(t)?1:0}class zu extends Ce{clone(){return new zu(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this._dependentFields=zR(this.transform.calculate)}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(Sa(i)&&x6(i.sort)){const{field:o,timeUnit:s}=i,a=i.sort,u=a.map((l,c)=>`${e6({field:o,timeUnit:s,equal:l})} ? ${c} : `).join("")+a.length;t=new zu(t,{calculate:u,as:Pu(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${ge(this.transform)}`}}function Pu(e,t,n){return q(e,{prefix:t,suffix:"sort_index",...n??{}})}function xm(e,t){return pe(["top","bottom"],t)?"column":pe(["left","right"],t)||e==="row"?"row":"column"}function Lu(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return Ve((t||{})[e],r[e],n.header[e])}function vm(e,t,n,i){const r={};for(const o of e){const s=Lu(o,t||{},n,i);s!==void 0&&(r[o]=s)}return r}const g_=["row","column"],p_=["header","footer"];function $ae(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:o,titleAngle:s,titleOrient:a}=vm(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),u=xm(t,a),l=qc(s);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:{text:n,...t==="row"?{orient:"left"}:{},style:"guide-title",...WR(l,u),...qR(u,l,o),...HR(i,r,t,hoe,Y6)}}}function qR(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=UR(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function WR(e,t){const n=BR(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Aae(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of p_)if(n[r])for(const o of n[r]){const s=Mae(e,t,r,n,o);s!=null&&i.push(s)}return i}function Cae(e,t){const{sort:n}=e;return Xi(n)?{field:q(n,{expr:"datum"}),order:n.order??"ascending"}:z(n)?{field:Pu(e,t,{expr:"datum"}),order:"ascending"}:{field:q(e,{expr:"datum"}),order:n??"ascending"}}function nb(e,t,n){const{format:i,formatType:r,labelAngle:o,labelAnchor:s,labelOrient:a,labelExpr:u}=vm(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=qw({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=xm(t,a);return{text:{signal:u?Zs(Zs(u,"datum.label",l),"datum.value",q(e,{expr:"parent"})):l},...t==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...WR(o,c),...qR(c,o,s),...HR(n,e,t,goe,V6)}}function Mae(e,t,n,i,r){if(r){let o=null;const{facetFieldDef:s}=i,a=e.config?e.config:void 0;if(s&&r.labels){const{labelOrient:f}=vm(["labelOrient"],s.header,a,t);(t==="row"&&!pe(["top","bottom"],f)||t==="column"&&!pe(["left","right"],f))&&(o=nb(s,t,a))}const u=_i(e)&&!Nf(e.facet),l=r.axes,c=l?.length>0;if(o||c){const f=t==="row"?"height":"width";return{name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`,...i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:Cae(s,t)}:{},...c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{},...o?{title:o}:{},...r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{},...c?{axes:l}:{}}}}return null}const Fae={column:{start:0,end:1},row:{start:1,end:0}};function Dae(e,t){return Fae[t][e]}function Tae(e,t){const n={};for(const i of Yn){const r=e[i];if(r?.facetFieldDef){const{titleAnchor:o,titleOrient:s}=vm(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=xm(i,s),u=Dae(o,a);u!==void 0&&(n[a]=u)}}return Me(n)?void 0:n}function HR(e,t,n,i,r){const o={};for(const s of i){if(!r[s])continue;const a=Lu(s,t?.header,e,n);a!==void 0&&(o[r[s]]=a)}return o}function m_(e){return[...bd(e,"width"),...bd(e,"height"),...bd(e,"childWidth"),...bd(e,"childHeight")]}function bd(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const o=e.getScaleComponent(n);if(o){const s=o.get("type"),a=o.get("range");if(mt(s)&&os(a)){const u=e.scaleName(n);return _i(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[yA(u,a)]:[yA(u,a),{name:r,update:GR(u,o,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const o=r.endsWith("width"),s=o?"containerSize()[0]":"containerSize()[1]",a=Vy(e.config.view,o?"width":"height"),u=`isFinite(${s}) ? ${s} : ${a}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:r,value:i}]}function yA(e,t){const n=`${e}_step`;return Q(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function GR(e,t,n){const i=t.get("type"),r=t.get("padding"),o=Ve(t.get("paddingOuter"),r);let s=t.get("paddingInner");return s=i==="band"?s!==void 0?s:r:1,`bandspace(${n}, ${yi(s)}, ${yi(o)}) * ${e}_step`}function YR(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function VR(e,t){return P(e).reduce((n,i)=>{const r=e[i];return{...n,...nl(t,r,i,o=>ze(o.value))}},{})}function XR(e,t){if(_i(t))return e==="theta"?"independent":"shared";if(sl(t))return"shared";if(S_(t))return Xe(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function y_(e,t){const n=e.scale[t],i=Xe(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&I(cie(t)),"independent"):e[i][t]||"shared"}const Nae={...yoe,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},KR=P(Nae);class Oae extends eo{}const bA={symbols:Rae,gradient:zae,labels:Pae,entries:Lae};function Rae(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:o}){if(o!=="symbol")return;const{markDef:s,encoding:a,config:u,mark:l}=n,c=s.filled&&l!=="trail";let f={..._ne({},n,hre),..._R(n,{filled:c})};const d=r.get("symbolOpacity")??u.legend.symbolOpacity,h=r.get("symbolFillColor")??u.legend.symbolFillColor,g=r.get("symbolStrokeColor")??u.legend.symbolStrokeColor,p=d===void 0?JR(a.opacity)??s.opacity:void 0;if(f.fill){if(i==="fill"||c&&i===vn)delete f.fill;else if(f.fill.field)h?delete f.fill:(f.fill=ze(u.legend.symbolBaseFillColor??"black"),f.fillOpacity=ze(p??1));else if(z(f.fill)){const m=ib(a.fill??a.color)??s.fill??(c&&s.color);m&&(f.fill=ze(m))}}if(f.stroke){if(i==="stroke"||!c&&i===vn)delete f.stroke;else if(f.stroke.field||g)delete f.stroke;else if(z(f.stroke)){const m=Ve(ib(a.stroke||a.color),s.stroke,c?s.color:void 0);m&&(f.stroke={value:m})}}if(i!==Jr){const m=L(t)&&ZR(n,r,t);m?f.opacity=[{test:m,...ze(p??1)},ze(u.legend.unselectedOpacity)]:p&&(f.opacity=ze(p))}return f={...f,...e},Me(f)?void 0:f}function zae(e,{model:t,legendType:n,legendCmpt:i}){if(n!=="gradient")return;const{config:r,markDef:o,encoding:s}=t;let a={};const l=(i.get("gradientOpacity")??r.legend.gradientOpacity)===void 0?JR(s.opacity)||o.opacity:void 0;return l&&(a.opacity=ze(l)),a={...a,...e},Me(a)?void 0:a}function Pae(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const o=n.legend(i)||{},s=n.config,a=L(t)?ZR(n,r,t):void 0,u=a?[{test:a,value:1},{value:s.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=o;let f;ra(c)?f=xi({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:s}):l===void 0&&c===void 0&&s.customFormatTypes&&(t.type==="quantitative"&&s.numberFormatType?f=xi({fieldOrDatumDef:t,field:"datum.value",format:s.numberFormat,formatType:s.numberFormatType,config:s}):t.type==="temporal"&&s.timeFormatType&&L(t)&&t.timeUnit===void 0&&(f=xi({fieldOrDatumDef:t,field:"datum.value",format:s.timeFormat,formatType:s.timeFormatType,config:s})));const d={...u?{opacity:u}:{},...f?{text:f}:{},...e};return Me(d)?void 0:d}function Lae(e,{legendCmpt:t}){return t.get("selections")?.length?{...e,fill:{value:"transparent"}}:e}function JR(e){return QR(e,(t,n)=>Math.max(t,n.value))}function ib(e){return QR(e,(t,n)=>Ve(t,n.value))}function QR(e,t){if(Nre(e))return H(e.condition).reduce(t,e.value);if($i(e))return e.value}function ZR(e,t,n){const i=t.get("selections");if(!i?.length)return;const r=j(n.field);return i.map(o=>`(!length(data(${j(Le(o)+sa)})) || (${o}[${r}] && indexof(${o}[${r}], datum.value) >= 0))`).join(" || ")}const xA={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return p6(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return m6(i,t,n)},gradientLength:e=>{const{legend:t,legendConfig:n}=e;return t.gradientLength??n.gradientLength??Hae(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>e.labelOverlap??t.labelOverlap??Gae(n),symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>e.symbolType??Bae(t.type,n,i.shape,t.shape),title:({fieldOrDatumDef:e,config:t})=>tu(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(eu(n)&&bi(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Iae(t,e)};function Iae(e,t){const n=e.values;if(z(n))return M6(t,n);if(Q(n))return n}function Bae(e,t,n,i){if(t!=="shape"){const r=ib(n)??i;if(r)return r}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Uae(e){const{legend:t}=e;return Ve(t.type,jae(e))}function jae({channel:e,timeUnit:t,scaleType:n}){if(eu(e)){if(pe(["quarter","month","day"],t))return"symbol";if(bi(n))return"gradient"}return"symbol"}function qae({legendConfig:e,legendType:t,orient:n,legend:i}){return i.direction??e[t?"gradientDirection":"symbolDirection"]??Wae(n,t)}function Wae(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Hae({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:s,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(bi(r))return n==="horizontal"?i==="top"||i==="bottom"?vA(t,"width",s,o):s:vA(t,"height",u,a)}function vA(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function Gae(e){if(pe(["quantile","threshold","log","symlog"],e))return"greedy"}function e4(e){const t=We(e)?Yae(e):Jae(e);return e.component.legends=t,t}function Yae(e){const{encoding:t}=e,n={};for(const i of[vn,...K6]){const r=it(t[i]);!r||!e.getScaleComponent(i)||i===wn&&L(r)&&r.type===tl||(n[i]=Kae(e,i))}return n}function Vae(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Xae(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!n?.values;case"title":if(t==="title"&&e===i?.title)return!0}return e===(n||{})[t]}function Kae(e,t){let n=e.legend(t);const{markDef:i,encoding:r,config:o}=e,s=o.legend,a=new Oae({},Vae(e,t));oae(e,t,a);const u=n!==void 0?!n:s.disable;if(a.set("disable",u,n!==void 0),u)return a;n=n||{};const l=e.getScaleComponent(t).get("type"),c=it(r[t]),f=L(c)?pt(c.timeUnit)?.unit:void 0,d=n.orient||o.legend.orient||"right",h=Uae({legend:n,channel:t,timeUnit:f,scaleType:l}),g=qae({legend:n,legendType:h,orient:d,legendConfig:s}),p={legend:n,channel:t,model:e,markDef:i,encoding:r,fieldOrDatumDef:c,legendConfig:s,config:o,scaleType:l,orient:d,legendType:h,direction:g};for(const v of KR){if(h==="gradient"&&v.startsWith("symbol")||h==="symbol"&&v.startsWith("gradient"))continue;const w=v in xA?xA[v](p):n[v];if(w!==void 0){const S=Xae(w,v,n,e.fieldDef(t));(S||o.legend[v]===void 0)&&a.set(v,w,S)}}const m=n?.encoding??{},y=a.get("selections"),b={},x={fieldOrDatumDef:c,model:e,channel:t,legendCmpt:a,legendType:h};for(const v of["labels","legend","title","symbols","gradient","entries"]){const w=VR(m[v]??{},e),S=v in bA?bA[v](w,x):w;S!==void 0&&!Me(S)&&(b[v]={...y?.length&&L(c)?{name:`${Le(c.field)}_legend_${v}`}:{},...y?.length?{interactive:!!y}:{},update:S})}return Me(b)||a.set("encode",b,!!n?.encoding),a}function Jae(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){e4(i);for(const r of P(i.component.legends))n.legend[r]=y_(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=t4(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of P(t))for(const r of e.children)r.component.legends[i]&&n.legend[i]==="shared"&&delete r.component.legends[i];return t}function t4(e,t){if(!e)return t.clone();const n=e.getWithExplicit("orient"),i=t.getWithExplicit("orient");if(n.explicit&&i.explicit&&n.value!==i.value)return;let r=!1;for(const o of KR){const s=qo(e.getWithExplicit(o),t.getWithExplicit(o),o,"legend",(a,u)=>{switch(o){case"symbolType":return Qae(a,u);case"title":return zO(a,u);case"type":return r=!0,kn("symbol")}return gm(a,u,o,"legend")});e.setWithExplicit(o,s)}return r&&(e.implicit?.encode?.gradient&&dg(e.implicit,["encode","gradient"]),e.explicit?.encode?.gradient&&dg(e.explicit,["encode","gradient"])),e}function Qae(e,t){return t.value==="circle"?t:e}function Zae(e,t,n,i){var r,o;e.encode??(e.encode={}),(r=e.encode)[t]??(r[t]={}),(o=e.encode[t]).update??(o.update={}),e.encode[t].update[n]=i}function n4(e){const t=e.component.legends,n={};for(const r of P(t)){const o=e.getScaleComponent(r),s=Fe(o.get("domains"));if(n[s])for(const a of n[s])t4(a,t[r])||n[s].push(t[r]);else n[s]=[t[r].clone()]}return Et(n).flat().map(r=>eue(r,e.config)).filter(r=>r!==void 0)}function eue(e,t){const{disable:n,labelExpr:i,selections:r,...o}=e.combine();if(!n){if(t.aria===!1&&o.aria==null&&(o.aria=!1),o.encode?.symbols){const s=o.encode.symbols.update;s.fill&&s.fill.value!=="transparent"&&!s.stroke&&!o.stroke&&(s.stroke={value:"transparent"});for(const a of K6)o[a]&&delete s[a]}if(o.title||delete o.title,i!==void 0){let s=i;o.encode?.labels?.update&&Q(o.encode.labels.update.text)&&(s=Zs(i,"datum.label",o.encode.labels.update.text.signal)),Zae(o,"labels","text",{signal:s})}return o}}function tue(e){return sl(e)||S_(e)?nue(e):i4(e)}function nue(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),i4(e))}function i4(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(s=>s.signal).join(", ")}]`},o=t.data.reduce((s,a)=>{const u=Q(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return pe(s,u)||s.push(u),s},[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:i,size:r,fit:{signal:o.length>1?`[${o.join(", ")}]`:o[0]},...n}]}else return[{name:i,translate:{signal:"[width / 2, height / 2]"},...n}]}const iue=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class r4 extends eo{constructor(t,n,i,r){super({...n},{name:t}),this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function o4(e){e.component.projection=We(e)?rue(e):aue(e)}function rue(e){if(e.hasProjection){const t=dn(e.specifiedProjection),n=!(t&&(t.scale!=null||t.translate!=null)),i=n?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,r=n?oue(e):void 0,o=new r4(e.projectionName(!0),{...dn(e.config.projection)??{},...t??{}},i,r);return o.get("type")||o.set("type","equalEarth",!1),o}}function oue(e){const t=[],{encoding:n}=e;for(const i of[[Oi,Ni],[ni,Ri]])(it(n[i[0]])||it(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(wn)&&e.typedFieldDef(wn).type===tl&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(Ne.Main)),t}function sue(e,t){const n=lw(iue,r=>!!(!ne(e.explicit,r)&&!ne(t.explicit,r)||ne(e.explicit,r)&&ne(t.explicit,r)&&Dn(e.get(r),t.get(r))));if(Dn(e.size,t.size)){if(n)return e;if(Dn(e.explicit,{}))return t;if(Dn(t.explicit,{}))return e}return null}function aue(e){if(e.children.length===0)return;let t;for(const i of e.children)o4(i);const n=lw(e.children,i=>{const r=i.component.projection;if(r)if(t){const o=sue(t,r);return o&&(t=o),!!o}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new r4(i,t.specifiedProjection,t.size,oe(t.data));for(const o of e.children){const s=o.component.projection;s&&(s.isFit&&r.data.push(...o.component.projection.data),o.renameProjection(s.get("name"),i),s.merged=!0)}return r}}function uue(e,t,n,i){if(Rf(t,n)){const r=We(e)?e.axis(n)??e.legend(n)??{}:{},o=q(t,{expr:"datum"}),s=q(t,{expr:"datum",binSuffix:"end"});return{formulaAs:q(t,{binSuffix:"range",forAs:!0}),formula:Tf(o,s,r.format,r.formatType,i)}}return{}}function s4(e,t){return`${CO(e)}_${t}`}function lue(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function b_(e,t,n){const i=um(n,void 0)??{},r=s4(i,t);return e.getName(`${r}_bins`)}function cue(e){return"as"in e}function wA(e,t,n){let i,r;cue(e)?i=Y(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[q(e,{forAs:!0}),q(e,{binSuffix:"end",forAs:!0})];const o={...um(t,void 0)},s=s4(o,e.field),{signal:a,extentSignal:u}=lue(n,s);if(Jp(o.extent)){const c=o.extent;r=LR(n,c.param,c),delete o.extent}const l={bin:o,field:e.field,as:[i],...a?{signal:a}:{},...u?{extentSignal:u}:{},...r?{span:r}:{}};return{key:s,binComponent:l}}class Ji extends Ce{clone(){return new Ji(null,oe(this.bins))}constructor(t,n){super(t),this.bins=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,o,s)=>{if(sn(o)&&Oe(o.bin)){const{key:a,binComponent:u}=wA(o,o.bin,n);r[a]={...u,...r[a],...uue(n,o,s,n.config)}}return r},{});return Me(i)?null:new Ji(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:o}=wA(n,n.bin,i);return new Ji(t,{[r]:o})}merge(t,n){for(const i of P(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Hi([...this.bins[i].as,...t.bins[i].as],ge)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(Et(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Et(this.bins).map(t=>t.field))}hash(){return`Bin ${ge(this.bins)}`}assemble(){return Et(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,{extent:o,...s}=t.bin,a={type:"bin",field:ti(t.field),as:i,signal:t.signal,...Jp(o)?{extent:null}:{extent:o},...t.span?{span:{signal:`span(${t.span})`}}:{},...s};!o&&t.extentSignal&&(n.push({type:"extent",field:ti(t.field),signal:t.extentSignal}),a.extent={signal:t.extentSignal}),n.push(a);for(const u of r)for(let l=0;l<2;l++)n.push({type:"formula",expr:q({field:i[l]},{expr:"datum"}),as:u[l]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function fue(e,t,n,i){const r=We(i)?i.encoding[mr(t)]:void 0;if(sn(n)&&We(i)&&w6(n,r,i.markDef,i.config)){e.add(q(n,{})),e.add(q(n,{suffix:"end"}));const{mark:o,markDef:s,config:a}=i,u=jo({fieldDef:n,markDef:s,config:a});Wc(o)&&u!==.5&&Xe(t)&&(e.add(q(n,{suffix:pm})),e.add(q(n,{suffix:mm}))),n.bin&&Rf(n,t)&&e.add(q(n,{binSuffix:"range"}))}else if(bO(t)){const o=yO(t);e.add(i.getName(o))}else e.add(q(n));return Sa(n)&&tre(n.scale?.range)&&e.add(n.scale.range.field),e}function due(e,t){for(const n of P(t)){const i=t[n];for(const r of P(i))n in e?e[n][r]=new Set([...e[n][r]??[],...i[r]]):e[n]={[r]:i[r]}}}class wi extends Ce{clone(){return new wi(null,new Set(this.dimensions),oe(this.measures))}constructor(t,n,i){super(t),this.dimensions=n,this.measures=i}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(s=>{s.aggregate&&(i=!0)});const r={},o=new Set;return!i||(n.forEachFieldDef((s,a)=>{const{aggregate:u,field:l}=s;if(u)if(u==="count")r["*"]??(r["*"]={}),r["*"].count=new Set([q(s,{forAs:!0})]);else{if(Wr(u)||rs(u)){const c=Wr(u)?"argmin":"argmax",f=u[c];r[f]??(r[f]={}),r[f][c]=new Set([q({op:c,field:f},{forAs:!0})])}else r[l]??(r[l]={}),r[l][u]=new Set([q(s,{forAs:!0})]);Qr(a)&&n.scaleDomain(a)==="unaggregated"&&(r[l]??(r[l]={}),r[l].min=new Set([q({field:l,aggregate:"min"},{forAs:!0})]),r[l].max=new Set([q({field:l,aggregate:"max"},{forAs:!0})]))}else fue(o,a,s,n)}),o.size+P(r).length===0)?null:new wi(t,o,r)}static makeFromTransform(t,n){const i=new Set,r={};for(const o of n.aggregate){const{op:s,field:a,as:u}=o;s&&(s==="count"?(r["*"]??(r["*"]={}),r["*"].count=new Set([u||q(o,{forAs:!0})])):(r[a]??(r[a]={}),r[a][s]=new Set([u||q(o,{forAs:!0})])))}for(const o of n.groupby??[])i.add(o);return i.size+P(r).length===0?null:new wi(t,i,r)}merge(t){return lO(this.dimensions,t.dimensions)?(due(this.measures,t.measures),!0):($ie("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...P(this.measures)])}producedFields(){const t=new Set;for(const n of P(this.measures))for(const i of P(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${ge({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const o of P(this.measures))for(const s of P(this.measures[o]))for(const a of this.measures[o][s])i.push(a),t.push(s),n.push(o==="*"?null:ti(o));return{type:"aggregate",groupby:[...this.dimensions].map(ti),ops:t,fields:n,as:i}}}class rl extends Ce{constructor(t,n,i,r){super(t),this.model=n,this.name=i,this.data=r;for(const o of Yn){const s=n.facet[o];if(s){const{bin:a,sort:u}=s;this[o]={name:n.getName(`${o}_domain`),fields:[q(s),...Oe(a)?[q(s,{binSuffix:"end"})]:[]],...Xi(u)?{sortField:u}:z(u)?{sortIndexField:Pu(s,o)}:{}}}}this.childModel=n.child}hash(){let t="Facet";for(const n of Yn)this[n]&&(t+=` ${n.charAt(0)}:${ge(this[n])}`);return t}get fields(){const t=[];for(const n of Yn)this[n]?.fields&&t.push(...this[n].fields);return t}dependentFields(){const t=new Set(this.fields);for(const n of Yn)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of yr){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),o=i.get("range");if(mt(r)&&os(o)){const s=wm(this.childModel,n),a=__(s);a?t[n]=a:I(Sw(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],o=[],s=[],a=[];r&&i&&i[r]&&(n?(o.push(`distinct_${i[r]}`),s.push("max")):(o.push(i[r]),s.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=rm,field:f}=u;o.push(f),s.push(c),a.push(q(u,{forAs:!0}))}else l&&(o.push(l),s.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[{type:"aggregate",groupby:this[t].fields,...o.length?{fields:o,ops:s,as:a}:{}}]}}assembleFacetHeaderData(t){const{columns:n}=this.model.layout,{layoutHeaders:i}=this.model.component,r=[],o={};for(const u of g_){for(const l of p_){const c=(i[u]&&i[u][l])??[];for(const f of c)if(f.axes?.length>0){o[u]=!0;break}}if(o[u]){const l=`length(data("${this.facet.name}"))`,c=u==="row"?n?{signal:`ceil(${l} / ${n})`}:1:n?{signal:`min(${l}, ${n})`}:{signal:l};r.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:c}]})}}const{row:s,column:a}=o;return(s||a)&&r.unshift(this.assembleRowColumnHeaderData("facet",null,t)),r}assemble(){const t=[];let n=null;const i=this.getChildIndependentFieldsWithStep(),{column:r,row:o,facet:s}=this;if(r&&o&&(i.x||i.y)){n=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(i.x??[],i.y??[]),u=a.map(()=>"distinct");t.push({name:n,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:u}]})}for(const a of[Lr,Pr])this[a]&&t.push(this.assembleRowColumnHeaderData(a,n,i));if(s){const a=this.assembleFacetHeaderData(i);a&&t.push(...a)}return t}}function _A(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function hue(e,t){const n=dw(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=_A(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=_A(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return I(Rne(t)),null}function gue(e){const t={};return Yd(e.filter,n=>{if(ZO(n)){let i=null;Aw(n)?i=Cn(n.equal):Mw(n)?i=Cn(n.lte):Cw(n)?i=Cn(n.lt):Fw(n)?i=Cn(n.gt):Dw(n)?i=Cn(n.gte):Tw(n)?i=n.range[0]:Nw(n)&&(i=(n.oneOf??n.in)[0]),i&&(wa(i)?t[n.field]="date":xe(i)?t[n.field]="number":Y(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function pue(e){const t={};function n(i){Nu(i)?t[i.field]="date":i.type==="quantitative"&&hne(i.aggregate)?t[i.field]="number":$u(i.field)>1?i.field in t||(t[i.field]="flatten"):Sa(i)&&Xi(i.sort)&&$u(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((We(e)||_i(e))&&e.forEachFieldDef((i,r)=>{if(sn(i))n(i);else{const o=xa(r),s=e.fieldDef(o);n({...i,type:s.type})}}),We(e)){const{mark:i,markDef:r,encoding:o}=e;if(ss(i)&&!e.encoding.order){const s=r.orient==="horizontal"?"y":"x",a=o[s];L(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function mue(e){const t={};if(We(e)&&e.component.selection)for(const n of P(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&$u(r.field)>1&&(t[r.field]="flatten")}return t}class zt extends Ce{clone(){return new zt(null,oe(this._parse))}constructor(t,n){super(t),this._parse=n}hash(){return`Parse ${ge(this._parse)}`}static makeExplicit(t,n,i){let r={};const o=n.data;return!Ao(o)&&o?.format?.parse&&(r=o.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const a of P(i)){const u=r.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===i[a]||u.value==="derived"||i[a]==="flatten"?delete i[a]:I(T$(a,i[a],u.value)))}for(const a of P(n)){const u=r.get(a);u!==void 0&&(u===n[a]?delete n[a]:I(T$(a,n[a],u)))}const o=new eo(n,i);r.copyAll(o);const s={};for(const a of P(o.combine())){const u=o.get(a);u!==null&&(s[a]=u)}return P(s).length===0||r.parseNothing?null:new zt(t,s)}get parse(){return this._parse}merge(t){this._parse={...this._parse,...t.parse},t.remove()}assembleFormatParse(){const t={};for(const n of P(this._parse)){const i=this._parse[n];$u(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(P(this._parse))}dependentFields(){return new Set(P(this._parse))}assembleTransforms(t=!1){return P(this._parse).filter(n=>t?$u(n)>1:!0).map(n=>{const i=hue(n,this._parse[n]);return i?{type:"formula",expr:i,as:hw(n)}:null}).filter(n=>n!==null)}}class Go extends Ce{clone(){return new Go(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Ai])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Ai}}}class Lf extends Ce{clone(){return new Lf(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${ge(this.params)}`}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class If extends Ce{clone(){return new If(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){return new Set([this.params.as??"data"])}hash(){return`Hash ${ge(this.params)}`}assemble(){return{type:"sequence",...this.params}}}class aa extends Ce{constructor(t){super(null),t??(t={name:"source"});let n;if(Ao(t)||(n=t.format?{...pn(t.format,["parse"])}:{}),Hc(t))this._data={values:t.values};else if(Ou(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];pe(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else gR(t)?this._data={values:[{type:"Sphere"}]}:(dR(t)||Ao(t))&&(this._data={});this._generator=Ao(t),t.name&&(this._name=t.name),n&&!Me(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var SA=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},yue=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},Zl;function x_(e){return e instanceof aa||e instanceof Lf||e instanceof If}class v_{constructor(){Zl.set(this,void 0),SA(this,Zl,!1,"f")}setModified(){SA(this,Zl,!0,"f")}get modifiedFlag(){return yue(this,Zl,"f")}}Zl=new WeakMap;class Ea extends v_{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,o)=>o[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class w_ extends v_{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class bue extends w_{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of P(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class xue extends w_{constructor(t){super(),this.requiresSelectionId=t&&h_(t)}run(t){t instanceof Go&&(this.requiresSelectionId&&(x_(t.parent)||t.parent instanceof wi||t.parent instanceof zt)||(this.setModified(),t.remove()))}}class vue extends v_{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Ki&&(i=t.producedFields(),cw(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class wue extends w_{constructor(){super()}run(t){t instanceof nn&&!t.isRequired()&&(this.setModified(),t.remove())}}class _ue extends Ea{run(t){if(!x_(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof zt)if(t instanceof zt)this.setModified(),t.merge(n);else{if(fw(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class Sue extends Ea{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof zt);if(t.numChildren()>1&&i.length>=1){const r={},o=new Set;for(const s of i){const a=s.parse;for(const u of P(a))u in r?r[u]!==a[u]&&o.add(u):r[u]=a[u]}for(const s of o)delete r[s];if(!Me(r)){this.setModified();const s=new zt(t,r);for(const a of n){if(a instanceof zt)for(const u of P(r))delete a.parse[u];t.removeChild(a),a.parent=s,a instanceof zt&&P(a.parse).length===0&&a.remove()}}}}}class Eue extends Ea{run(t){t instanceof nn||t.numChildren()>0||t instanceof rl||t instanceof aa||(this.setModified(),t.remove())}}class kue extends Ea{run(t){const n=t.children.filter(r=>r instanceof Ki),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class $ue extends Ea{run(t){const n=t.children.filter(r=>r instanceof wi),i={};for(const r of n){const o=ge(r.groupBy);o in i||(i[o]=[]),i[o].push(r)}for(const r of P(i)){const o=i[r];if(o.length>1){const s=o.pop();for(const a of o)s.merge(a)&&(t.removeChild(a),a.parent=s,a.remove(),this.setModified())}}}}class Aue extends Ea{constructor(t){super(),this.model=t}run(t){const n=!(x_(t)||t instanceof il||t instanceof zt||t instanceof Go),i=[],r=[];for(const o of t.children)o instanceof Ji&&(n&&!fw(t.producedFields(),o.dependentFields())?i.push(o):r.push(o));if(i.length>0){const o=i.pop();for(const s of i)o.merge(s,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Ji?t.merge(o,this.model.renameSignal.bind(this.model)):o.swapWithParent()}if(r.length>1){const o=r.pop();for(const s of r)o.merge(s,this.model.renameSignal.bind(this.model));this.setModified()}}}class Cue extends Ea{run(t){const n=[...t.children];if(!Qs(n,s=>s instanceof nn)||t.numChildren()<=1)return;const r=[];let o;for(const s of n)if(s instanceof nn){let a=s;for(;a.numChildren()===1;){const[u]=a.children;if(u instanceof nn)a=u;else break}r.push(...a.children),o?(t.removeChild(s),s.parent=o.parent,o.parent.removeChild(o),o.parent=a,this.setModified()):o=a}else r.push(s);if(r.length){this.setModified();for(const s of r)s.parent.removeChild(s),s.parent=o}}}class ka extends Ce{clone(){return new ka(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=Hi(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){return t.as??q(t)}hash(){return`JoinAggregateTransform ${ge(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const o of this.transform.joinaggregate)n.push(o.op),i.push(this.getDefaultName(o)),t.push(o.field===void 0?null:o.field);const r=this.transform.groupby;return{type:"joinaggregate",as:i,ops:n,fields:t,...r!==void 0?{groupby:r}:{}}}}function Mue(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=q(i);return r&&t.push(r),t},[])}function Fue(e){return z(e)&&e.every(t=>Y(t))&&e.length>1}class Br extends Ce{clone(){return new Br(null,oe(this._stack))}constructor(t,n){super(t),this._stack=n}static makeFromTransform(t,n){const{stack:i,groupby:r,as:o,offset:s="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(Ve(f.order,"ascending"));const l={field:a,order:u};let c;return Fue(o)?c=o:Y(o)?c=[o,`${o}_end`]:c=[`${n.stack}_start`,`${n.stack}_end`],new Br(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:s,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:o,fieldChannel:s,offset:a,impute:u}=i,l=o.map(h=>{const g=r[h];return or(g)}).filter(h=>!!h),c=Mue(n),f=n.encoding.order;let d;if(z(f)||L(f))d=NO(f);else{const h=_6(f)?f.sort:s==="y"?"descending":"ascending";d=c.reduce((g,p)=>(g.field.push(p),g.order.push(h),g),{field:[],order:[]})}return new Br(t,{dimensionFieldDefs:l,stackField:n.vgField(s),facetby:[],stackby:c,sort:d,offset:a,impute:u,as:[n.vgField(s,{suffix:"start",forAs:!0}),n.vgField(s,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${ge(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[q(r,{binSuffix:"mid"})]:[q(r,{}),q(r,{binSuffix:"end"})]:[q(r)]).flat():i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:o,sort:s,offset:a,impute:u,as:l}=this._stack;if(u)for(const c of i){const{bandPosition:f=.5,bin:d}=c;if(d){const h=q(c,{expr:"datum"}),g=q(c,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${f}*${h}+${1-f}*${g}`,as:q(c,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...o,...n],key:q(c,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:s,as:l,offset:a}),t}}class ol extends Ce{clone(){return new ol(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=Hi(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return(this.transform.groupby??[]).forEach(t.add,t),(this.transform.sort??[]).forEach(n=>t.add(n.field)),this.transform.window.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){return t.as??q(t)}hash(){return`WindowTransform ${ge(this.transform)}`}assemble(){const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),t.push(f.field===void 0?null:f.field);const o=this.transform.frame,s=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&n.every(f=>ww(f)))return{type:"joinaggregate",as:i,ops:n,fields:t,...s!==void 0?{groupby:s}:{}};const a=[],u=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)a.push(f.field),u.push(f.order??"ascending");const l={field:a,order:u},c=this.transform.ignorePeers;return{type:"window",params:r,as:i,ops:n,fields:t,sort:l,...c!==void 0?{ignorePeers:c}:{},...s!==void 0?{groupby:s}:{},...o!==void 0?{frame:o}:{}}}}function Due(e){function t(n){if(!(n instanceof rl)){const i=n.clone();if(i instanceof nn){const r=ob+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof wi||i instanceof Br||i instanceof ol||i instanceof ka)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function rb(e){if(e instanceof rl)if(e.numChildren()===1&&!(e.children[0]instanceof nn)){const t=e.children[0];(t instanceof wi||t instanceof Br||t instanceof ol||t instanceof ka)&&t.addDimensions(e.fields),t.swapWithParent(),rb(e)}else{const t=e.model.component.data.main;a4(t);const n=Due(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(rb)}function a4(e){if(e instanceof nn&&e.type===Ne.Main&&e.numChildren()===1){const t=e.children[0];t instanceof rl||(t.swapWithParent(),a4(e))}}const ob="scale_",xd=5;function sb(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!sb(t.children))return!1}return!0}function si(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function EA(e,t,n){let i=e.sources,r=!1;return r=si(new wue,i)||r,r=si(new xue(t),i)||r,i=i.filter(o=>o.numChildren()>0),r=si(new Eue,i)||r,i=i.filter(o=>o.numChildren()>0),n||(r=si(new _ue,i)||r,r=si(new Aue(t),i)||r,r=si(new vue,i)||r,r=si(new Sue,i)||r,r=si(new $ue,i)||r,r=si(new kue,i)||r,r=si(new bue,i)||r,r=si(new Cue,i)||r),e.sources=i,r}function Tue(e,t){sb(e.sources);let n=0,i=0;for(let r=0;r<xd&&EA(e,t,!0);r++)n++;e.sources.map(rb);for(let r=0;r<xd&&EA(e,t,!1);r++)i++;sb(e.sources),Math.max(n,i)===xd&&I(`Maximum optimization runs(${xd}) reached.`)}class ut{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new ut(()=>t(n))}}function u4(e){We(e)?Nue(e):Oue(e)}function Nue(e){const t=e.component.scales;for(const n of P(t)){const i=zue(e,n);if(t[n].setWithExplicit("domains",i),Lue(e,n),e.component.data.isFaceted){let o=e;for(;!_i(o)&&o.parent;)o=o.parent;if(o.component.resolve.scale[n]==="shared")for(const a of i.value)Nr(a)&&(a.data=ob+a.data.replace(ob,""))}}}function Oue(e){for(const n of e.children)u4(n);const t=e.component.scales;for(const n of P(t)){let i,r=null;for(const o of e.children){const s=o.component.scales[n];if(s){i===void 0?i=s.getWithExplicit("domains"):i=qo(i,s.getWithExplicit("domains"),"domains","scale",ab);const a=s.get("selectionExtent");r&&a&&r.param!==a.param&&I(Dne),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function Rue(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:o}=kA(t,n);if(!r){I(o);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=kA(t,n);if(r)return"unaggregated"}return e}function zue(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=Rue(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]={...e.specifiedScales[t],domain:r}),t==="x"&&it(i.x2)?it(i.x)?qo(oo(n,r,e,"x"),oo(n,r,e,"x2"),"domain","scale",ab):oo(n,r,e,"x2"):t==="y"&&it(i.y2)?it(i.y)?qo(oo(n,r,e,"y"),oo(n,r,e,"y2"),"domain","scale",ab):oo(n,r,e,"y2"):oo(n,r,e,t)}function Pue(e,t,n){return e.map(i=>({signal:`{data: ${lm(i,{timeUnit:n,type:t})}}`}))}function G0(e,t,n){const i=pt(n)?.unit;return t==="temporal"||i?Pue(e,t,i):[e]}function oo(e,t,n,i){const{encoding:r,markDef:o,mark:s,config:a,stack:u}=n,l=it(r[i]),{type:c}=l,f=l.timeUnit;if(ere(t)){const g=oo(e,void 0,n,i),p=G0(t.unionWith,c,f);return Bi([...p,...g.value])}else{if(Q(t))return Bi([t]);if(t&&t!=="unaggregated"&&!s6(t))return Bi(G0(t,c,f))}if(u&&i===u.fieldChannel){if(u.offset==="normalize")return kn([[0,1]]);const g=n.requestDataName(Ne.Main);return kn([{data:g,field:n.vgField(i,{suffix:"start"})},{data:g,field:n.vgField(i,{suffix:"end"})}])}const d=Qr(i)&&L(l)?Iue(n,i,e):void 0;if(br(l)){const g=G0([l.datum],c,f);return kn(g)}const h=l;if(t==="unaggregated"){const g=n.requestDataName(Ne.Main),{field:p}=l;return kn([{data:g,field:q({field:p,aggregate:"min"})},{data:g,field:q({field:p,aggregate:"max"})}])}else if(Oe(h.bin)){if(mt(e))return kn(e==="bin-ordinal"?[]:[{data:jc(d)?n.requestDataName(Ne.Main):n.requestDataName(Ne.Raw),field:n.vgField(i,Rf(h,i)?{binSuffix:"range"}:{}),sort:d===!0||!G(d)?{field:n.vgField(i,{}),op:"min"}:d}]);{const{bin:g}=h;if(Oe(g)){const p=b_(n,h.field,g);return kn([new ut(()=>{const m=n.getSignalName(p);return`[${m}.start, ${m}.stop]`})])}else return kn([{data:n.requestDataName(Ne.Main),field:n.vgField(i,{})}])}}else if(h.timeUnit&&pe(["time","utc"],e)){const g=r[mr(i)];if(w6(h,g,o,a)){const p=n.requestDataName(Ne.Main),m=jo({fieldDef:h,fieldDef2:g,markDef:o,config:a}),y=Wc(s)&&m!==.5&&Xe(i);return kn([{data:p,field:n.vgField(i,y?{suffix:pm}:{})},{data:p,field:n.vgField(i,{suffix:y?mm:"end"})}])}}return kn(d?[{data:jc(d)?n.requestDataName(Ne.Main):n.requestDataName(Ne.Raw),field:n.vgField(i),sort:d}]:[{data:n.requestDataName(Ne.Main),field:n.vgField(i)}])}function Y0(e,t){const{op:n,field:i,order:r}=e;return{op:n??(t?"sum":rm),...i?{field:ti(i)}:{},...r?{order:r}:{}}}function Lue(e,t){const n=e.component.scales[t],i=e.specifiedScales[t].domain,r=e.fieldDef(t)?.bin,o=s6(i)&&i,s=va(r)&&Jp(r.extent)&&r.extent;(o||s)&&n.set("selectionExtent",o??s,!0)}function Iue(e,t,n){if(!mt(n))return;const i=e.fieldDef(t),r=i.sort;if(x6(r))return{op:"min",field:Pu(i,t),order:"ascending"};const{stack:o}=e,s=o?new Set([...o.groupbyFields,...o.stackBy.map(a=>a.fieldDef.field)]):void 0;if(Xi(r)){const a=o&&!s.has(r.field);return Y0(r,a)}else if(b6(r)){const{encoding:a,order:u}=r,l=e.fieldDef(a),{aggregate:c,field:f}=l,d=o&&!s.has(f);if(Wr(c)||rs(c))return Y0({field:q(l),order:u},d);if(ww(c)||!c)return Y0({op:c,field:f,order:u},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(pe(["ascending",void 0],r))return!0}}function kA(e,t){const{aggregate:n,type:i}=e;return n?Y(n)&&!pne.has(n)?{valid:!1,reason:iie(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:rie(e)}:{valid:!0}:{valid:!1,reason:nie(e)}}function ab(e,t,n,i){return e.explicit&&t.explicit&&I(lie(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function Bue(e){const t=Hi(e.map(s=>{if(Nr(s)){const{sort:a,...u}=s;return u}return s}),ge),n=Hi(e.map(s=>{if(Nr(s)){const a=s.sort;return a!==void 0&&!jc(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(s=>s!==void 0),ge);if(t.length===0)return;if(t.length===1){const s=e[0];if(Nr(s)&&n.length>0){let a=n[0];if(n.length>1){I(O$);const u=n.filter(l=>G(l)&&"op"in l&&l.op!=="min");n.every(l=>G(l)&&"op"in l)&&u.length===1?a=u[0]:a=!0}else if(G(a)&&"field"in a){const u=a.field;s.field===u&&(a=a.order?{order:a.order}:!0)}return{...s,sort:a}}return s}const i=Hi(n.map(s=>jc(s)||!("op"in s)||Y(s.op)&&s.op in fne?s:(I(fie(s)),!0)),ge);let r;i.length===1?r=i[0]:i.length>1&&(I(O$),r=!0);const o=Hi(e.map(s=>Nr(s)?s.data:null),s=>s);return o.length===1&&o[0]!==null?{data:o[0],fields:t.map(a=>a.field),...r?{sort:r}:{}}:{fields:t,...r?{sort:r}:{}}}function __(e){if(Nr(e)&&Y(e.field))return e.field;if(mne(e)){let t;for(const n of e.fields)if(Nr(n)&&Y(n.field)){if(!t)t=n.field;else if(t!==n.field)return I(die),t}return I(hie),t}else if(yne(e)){I(gie);const t=e.fields[0];return Y(t)?t:void 0}}function wm(e,t){const i=e.component.scales[t].get("domains").map(r=>(Nr(r)&&(r.data=e.lookupDataSource(r.data)),r));return Bue(i)}function l4(e){return sl(e)||S_(e)?e.children.reduce((t,n)=>t.concat(l4(n)),$A(e)):$A(e)}function $A(e){return P(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:o,type:s,selectionExtent:a,domains:u,range:l,reverse:c,...f}=r,d=Uue(r.range,o,n,e),h=wm(e,n),g=a?Rse(e,a,i,h):null;return t.push({name:o,type:s,...h?{domain:h}:{},...g?{domainRaw:g}:{},range:d,...c!==void 0?{reverse:c}:{},...f}),t},[])}function Uue(e,t,n,i){if(Xe(n)){if(os(e))return{step:{signal:`${t}_step`}}}else if(G(e)&&Nr(e))return{...e,data:i.lookupDataSource(e.data)};return e}class c4 extends eo{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Qs(this.get("domains"),t=>z(t)&&t.length===2&&xe(t[0])&&t[0]<=0&&xe(t[1])&&t[1]>=0)}}const jue=["range","scheme"];function que(e){const t=e.component.scales;for(const n of Kp){const i=t[n];if(!i)continue;const r=Wue(n,e);i.setWithExplicit("range",r)}}function AA(e,t){const n=e.fieldDef(t);if(n?.bin){const{bin:i,field:r}=n,o=_n(t),s=e.getName(o);if(G(i)&&i.binned&&i.step!==void 0)return new ut(()=>{const a=e.scaleName(t),u=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(s)} / (${u})`});if(Oe(i)){const a=b_(e,r,i);return new ut(()=>{const u=e.getSignalName(a),l=`(${u}.stop - ${u}.start) / ${u}.step`;return`${e.getSignalName(s)} / (${l})`})}}}function Wue(e,t){const n=t.specifiedScales[e],{size:i}=t,o=t.getScaleComponent(e).get("type");for(const f of jue)if(n[f]!==void 0){const d=Hy(o,f),h=a6(e,f);if(!d)I(BO(o,f,e));else if(h)I(h);else switch(f){case"range":{const g=n.range;if(z(g)){if(Xe(e))return Bi(g.map(p=>{if(p==="width"||p==="height"){const m=t.getName(p),y=t.getSignalName.bind(t);return ut.fromName(y,m)}return p}))}else if(G(g))return Bi({data:t.requestDataName(Ne.Main),field:g.field,sort:{op:"min",field:t.vgField(e)}});return Bi(g)}case"scheme":return Bi(Hue(n[f]))}}const s=e===Ie||e==="xOffset"?"width":"height",a=i[s];if(sr(a)){if(Xe(e))if(mt(o)){const f=d4(a,t,e);if(f)return Bi({step:f})}else I(UO(s));else if(Mf(e)){const f=e===Zo?"x":"y";if(t.getScaleComponent(f).get("type")==="band"){const g=h4(a,o);if(g)return Bi(g)}}}const{rangeMin:u,rangeMax:l}=n,c=Gue(e,t);return(u!==void 0||l!==void 0)&&Hy(o,"rangeMin")&&z(c)&&c.length===2?Bi([u??c[0],l??c[1]]):kn(c)}function Hue(e){return Zie(e)?{scheme:e.name,...pn(e,["name"])}:{scheme:e}}function f4(e,t,n,{center:i}={}){const r=_n(e),o=t.getName(r),s=t.getSignalName.bind(t);return e===bt&&Ln(n)?i?[ut.fromName(a=>`${s(a)}/2`,o),ut.fromName(a=>`-${s(a)}/2`,o)]:[ut.fromName(s,o),0]:i?[ut.fromName(a=>`-${s(a)}/2`,o),ut.fromName(a=>`${s(a)}/2`,o)]:[0,ut.fromName(s,o)]}function Gue(e,t){const{size:n,config:i,mark:r,encoding:o}=t,{type:s}=it(o[e]),u=t.getScaleComponent(e).get("type"),{domain:l,domainMid:c}=t.specifiedScales[e];switch(e){case Ie:case bt:{if(pe(["point","band"],u)){const f=g4(e,n,i.view);if(sr(f))return{step:d4(f,t,e)}}return f4(e,t,u)}case Zo:case el:return Yue(e,t,u);case Kr:{const f=t.component.scales[e].get("zero"),d=p4(r,f,i),h=Kue(r,n,t,i);return Fu(u)?Xue(d,h,Vue(u,i,l,e)):[d,h]}case ri:return[0,Math.PI*2];case ba:return[0,360];case Ti:return[0,new ut(()=>{const f=t.getSignalName("width"),d=t.getSignalName("height");return`min(${f},${d})/2`})];case ns:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case is:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case wn:return"symbol";case vn:case gr:case pr:return u==="ordinal"?s==="nominal"?"category":"ordinal":c!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case Jr:case es:case ts:return[i.scale.minOpacity,i.scale.maxOpacity]}}function d4(e,t,n){const{encoding:i}=t,r=t.getScaleComponent(n),o=yw(n),s=i[o];if(Q6({step:e,offsetIsDiscrete:se(s)&&t6(s.type)})==="offset"&&N6(i,o)){const u=t.getScaleComponent(o);let c=`domain('${t.scaleName(o)}').length`;if(u.get("type")==="band"){const d=u.get("paddingInner")??u.get("padding")??0,h=u.get("paddingOuter")??u.get("padding")??0;c=`bandspace(${c}, ${d}, ${h})`}const f=r.get("paddingInner")??r.get("padding");return{signal:`${e.step} * ${c} / (1-${wne(f)})`}}else return e.step}function h4(e,t){if(Q6({step:e,offsetIsDiscrete:mt(t)})==="offset")return{step:e.step}}function Yue(e,t,n){const i=e===Zo?"x":"y",r=t.getScaleComponent(i);if(!r)return f4(i,t,n,{center:!0});const o=r.get("type"),s=t.scaleName(i),{markDef:a,config:u}=t;if(o==="band"){const l=g4(i,t.size,t.config.view);if(sr(l)){const c=h4(l,n);if(c)return c}return[0,{signal:`bandwidth('${s}')`}]}else{const l=t.encoding[i];if(L(l)&&l.timeUnit){const c=JO(l.timeUnit,g=>`scale('${s}', ${g})`),f=t.config.scale.bandWithNestedOffsetPaddingInner,d=jo({fieldDef:l,markDef:a,config:u})-.5,h=d!==0?` + ${d}`:"";if(f){const g=Q(f)?`${f.signal}/2`+h:`${f/2+d}`,p=Q(f)?`(1 - ${f.signal}/2)`+h:`${1-f/2+d}`;return[{signal:`${g} * (${c})`},{signal:`${p} * (${c})`}]}return[0,{signal:c}]}return aO(`Cannot use ${e} scale if ${i} scale is not discrete.`)}}function g4(e,t,n){const i=e===Ie?"width":"height",r=t[i];return r||Sg(n,i)}function Vue(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&z(n)?n.length+1:(I(Sie(i)),3)}}function Xue(e,t,n){const i=()=>{const r=yi(t),o=yi(e),s=`(${r} - ${o}) / (${n} - 1)`;return`sequence(${o}, ${r} + ${s}, ${s})`};return Q(t)?new ut(i):{signal:i()}}function p4(e,t,n){if(t)return Q(t)?{signal:`${t.signal} ? 0 : ${p4(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Qp("size",e))}const CA=.95;function Kue(e,t,n,i){const r={x:AA(n,"x"),y:AA(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const o=MA(t,r,i.view);return xe(o)?o-1:new ut(()=>`${o.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const o=MA(t,r,i.view);return xe(o)?Math.pow(CA*o,2):new ut(()=>`pow(${CA} * ${o.signal}, 2)`)}}throw new Error(Qp("size",e))}function MA(e,t,n){const i=sr(e.width)?e.width.step:_g(n,"width"),r=sr(e.height)?e.height.step:_g(n,"height");return t.x||t.y?new ut(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function m4(e,t){We(e)?Jue(e,t):b4(e,t)}function Jue(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:o,specifiedScales:s}=e;for(const a of P(n)){const u=s[a],l=n[a],c=e.getScaleComponent(a),f=it(r[a]),d=u[t],h=c.get("type"),g=c.get("padding"),p=c.get("paddingInner"),m=Hy(h,t),y=a6(a,t);if(d!==void 0&&(m?y&&I(y):I(BO(h,t,a))),m&&y===void 0)if(d!==void 0){const b=f.timeUnit,x=f.type;switch(t){case"domainMax":case"domainMin":wa(u[t])||x==="temporal"||b?l.set(t,{signal:lm(u[t],{type:x,timeUnit:b})},!0):l.set(t,u[t],!0);break;default:l.copyKeyFromObject(t,u)}}else{const b=t in FA?FA[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:h,scalePadding:g,scalePaddingInner:p,domain:u.domain,domainMin:u.domainMin,domainMax:u.domainMax,markDef:o,config:i,hasNestedOffsetScale:O6(r,a),hasSecondaryRangeChannel:!!r[mr(a)]}):i.scale[t];b!==void 0&&l.set(t,b,!1)}}}const FA={bins:({model:e,fieldOrDatumDef:t})=>L(t)?Que(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>Zue(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:o})=>ele(e,t,n,i,r,o),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>tle(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:o})=>nle(e,t,n.type,i,r.scale,o),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:o})=>ile(e,t,n,i,r.scale,o),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=L(e)?e.sort:void 0;return rle(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r,config:o,hasSecondaryRangeChannel:s})=>ole(e,t,n,i,r,o.scale,s)};function y4(e){We(e)?que(e):b4(e,"range")}function b4(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?y4(i):m4(i,t);for(const i of P(n)){let r;for(const o of e.children){const s=o.component.scales[i];if(s){const a=s.getWithExplicit(t);r=qo(r,a,t,"scale",fR((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function Que(e,t){const n=t.bin;if(Oe(n)){const i=b_(e,t.field,n);return new ut(()=>e.getSignalName(i))}else if(vt(n)&&va(n)&&n.step!==void 0)return{step:n.step}}function Zue(e,t){if(pe([vn,gr,pr],e)&&t!=="nominal")return"hcl"}function ele(e,t,n,i,r,o){if(!(or(o)?.bin||z(n)||r!=null||i!=null||pe([mn.TIME,mn.UTC],e)))return Xe(t)?!0:void 0}function tle(e,t,n,i,r,o){if(Xe(e)){if(bi(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:s,orient:a}=r;if(s==="bar"&&!(L(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return o.continuousBandSize}if(t===mn.POINT)return n.pointPadding}}function nle(e,t,n,i,r,o=!1){if(e===void 0){if(Xe(t)){const{bandPaddingInner:s,barBandPaddingInner:a,rectBandPaddingInner:u,bandWithNestedOffsetPaddingInner:l}=r;return o?l:Ve(s,n==="bar"?a:u)}else if(Mf(t)&&i===mn.BAND)return r.offsetBandPaddingInner}}function ile(e,t,n,i,r,o=!1){if(e===void 0){if(Xe(t)){const{bandPaddingOuter:s,bandWithNestedOffsetPaddingOuter:a}=r;if(o)return a;if(n===mn.BAND)return Ve(s,Q(i)?{signal:`${i.signal}/2`}:i/2)}else if(Mf(t)){if(n===mn.POINT)return .5;if(n===mn.BAND)return r.offsetBandPaddingOuter}}}function rle(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return Ln(e)&&t==="descending"?Q(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(Ln(e)&&t==="descending")return!0}function ole(e,t,n,i,r,o,s){if(!!n&&n!=="unaggregated"&&Ln(r)){if(z(n)){const u=n[0],l=n[n.length-1];if(xe(u)&&u<=0&&xe(l)&&l>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Fu(r))return!0;if(!(L(t)&&t.bin)&&pe([...yr,...ine],e)){const{orient:u,type:l}=i;return pe(["bar","area","line","trail"],l)&&(u==="horizontal"&&e==="y"||u==="vertical"&&e==="x")?!1:pe(["bar","area"],l)&&!s?!0:o?.zero}return!1}function sle(e,t,n,i,r=!1){const o=ale(t,n,i,r),{type:s}=e;return Qr(t)?s!==void 0?sre(t,s)?L(n)&&!ore(s,n.type)?(I(aie(s,o)),o):s:(I(sie(t,s,o)),o):o:null}function ale(e,t,n,i){switch(t.type){case"nominal":case"ordinal":{if(eu(e)||L0(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&I(I0(e,"ordinal")),"ordinal";if(Xe(e)||Mf(e)){if(pe(["rect","bar","image","rule"],n.type)||i)return"band"}else if(n.type==="arc"&&e in vw)return"band";const r=n[_n(e)];return ia(r)||Tu(t)&&t.axis?.tickBand?"band":"point"}case"temporal":return eu(e)?"time":L0(e)==="discrete"?(I(I0(e,"temporal")),"ordinal"):L(t)&&t.timeUnit&&pt(t.timeUnit).utc?"utc":"time";case"quantitative":return eu(e)?L(t)&&Oe(t.bin)?"bin-ordinal":"linear":L0(e)==="discrete"?(I(I0(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(LO(t.type))}function ule(e,{ignoreRange:t}={}){x4(e),u4(e);for(const n of rre)m4(e,n);t||y4(e)}function x4(e){We(e)?e.component.scales=lle(e):e.component.scales=fle(e)}function lle(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const o of Kp){const s=it(t[o]);if(s&&n===c6&&o===wn&&s.type===tl)continue;let a=s&&s.scale;if(s&&a!==null&&a!==!1){a??(a={});const u=O6(t,o),l=sle(a,o,s,i,u);r[o]=new c4(e.scaleName(`${o}`,!0),{value:l,explicit:a.type===l})}}return r}const cle=fR((e,t)=>z$(e)-z$(t));function fle(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const o of e.children){x4(o);for(const s of P(o.component.scales))if((t=r.scale)[s]??(t[s]=XR(s,e)),r.scale[s]==="shared"){const a=i[s],u=o.component.scales[s].getWithExplicit("type");a?Vie(a.value,u.value)?i[s]=qo(a,u,"type","scale",cle):(r.scale[s]="independent",delete i[s]):i[s]=u}}for(const o of P(i)){const s=e.scaleName(o,!0),a=i[o];n[o]=new c4(s,a);for(const u of e.children){const l=u.component.scales[o];l&&(u.renameScale(l.get("name"),s),l.merged=!0)}}return n}class V0{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function We(e){return e?.type==="unit"}function _i(e){return e?.type==="facet"}function S_(e){return e?.type==="concat"}function sl(e){return e?.type==="layer"}class E_{constructor(t,n,i,r,o,s,a){this.type=n,this.parent=i,this.config=o,this.correctDataNames=u=>(u.from?.data&&(u.from.data=this.lookupDataSource(u.from.data)),u.from?.facet?.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u),this.parent=i,this.config=o,this.view=dn(a),this.name=t.name??r,this.title=co(t.title)?{text:t.title}:t.title?dn(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new V0,this.projectionNameMap=i?i.projectionNameMap:new V0,this.signalNameMap=i?i.signalNameMap:new V0,this.data=t.data,this.description=t.description,this.transforms=bse(t.transform??[]),this.layout=n==="layer"||n==="unit"?{}:_oe(t,n,o),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:om(t)||i?.component.data.isFaceted&&t.data===void 0},layoutSize:new eo,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...s?oe(s):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){ule(this)}parseProjection(){o4(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){e4(this)}assembleEncodeFromView(t){const{style:n,...i}=t,r={};for(const o of P(i)){const s=i[o];s!==void 0&&(r[o]=ze(s))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=ze(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...n??{}}:Me(n)?void 0:n}assembleLayout(){if(!this.layout)return;const{spacing:t,...n}=this.layout,{component:i,config:r}=this,o=Tae(i.layoutHeaders,r);return{padding:t,...this.assembleDefaultLayout(),...n,...o?{titleBand:o}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of Yn)t[i].title&&n.push($ae(this,i));for(const i of g_)n=n.concat(Aae(this,i));return n}assembleAxes(){return hae(this.component.axes,this.config)}assembleLegends(){return n4(this)}assembleProjections(){return tue(this)}assembleTitle(){const{encoding:t,...n}=this.title??{},i={...MO(this.config.title).nonMarkTitleProperties,...n,...t?{encode:{update:t}}:{}};if(i.text)return pe(["unit","layer"],this.type)?pe(["middle",void 0],i.anchor)&&(i.frame??(i.frame="group")):i.anchor??(i.anchor="start"),Me(i)?void 0:i}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||_i(this.parent)?l4(this):[];r.length>0&&(n.scales=r);const o=this.assembleAxes();o.length>0&&(n.axes=o);const s=this.assembleLegends();return s.length>0&&(n.legends=s),n}getName(t){return Le((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(Ne[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(_i(this.parent)){const n=YR(t),i=Xp(n),r=this.component.scales[i];if(r&&!r.merged){const o=r.get("type"),s=r.get("range");if(mt(o)&&os(s)){const a=r.get("name"),u=wm(this,i),l=__(u);if(l){const c=q({aggregate:"distinct",field:l},{expr:"datum"});return{signal:GR(a,r,c)}}else return I(Sw(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(vO(t)&&Qr(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error($ne(n));return i}hasAxisOrientSignalRef(){return this.component.axes.x?.some(t=>t.hasOrientSignalRef())||this.component.axes.y?.some(t=>t.hasOrientSignalRef())}}class v4 extends E_{vgField(t,n={}){const i=this.fieldDef(t);if(i)return q(i,n)}reduceFieldDef(t,n){return Jre(this.getMapping(),(i,r,o)=>{const s=or(r);return s?t(i,s,o):i},n)}forEachFieldDef(t,n){Kw(this.getMapping(),(i,r)=>{const o=or(i);o&&t(o,r)},n)}}class _m extends Ce{clone(){return new _m(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"value",i[1]??"density"]}dependentFields(){return new Set([this.transform.density,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${ge(this.transform)}`}assemble(){const{density:t,...n}=this.transform,i={type:"kde",field:t,...n};return this.transform.groupby&&(i.resolve="shared"),i}}class Sm extends Ce{clone(){return new Sm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n)}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return`ExtentTransform ${ge(this.transform)}`}assemble(){const{extent:t,param:n}=this.transform;return{type:"extent",field:t,signal:n}}}class Gc extends Ce{clone(){return new Gc(null,{...this.filter})}constructor(t,n){super(t),this.filter=n}static make(t,n){const{config:i,mark:r,markDef:o}=n;if($e("invalid",o,i)!=="filter")return null;const a=n.reduceFieldDef((u,l,c)=>{const f=Qr(c)&&n.getScaleComponent(c);if(f){const d=f.get("type");Ln(d)&&l.aggregate!=="count"&&!ss(r)&&(u[l.field]=l)}return u},{});return P(a).length?new Gc(t,a):null}dependentFields(){return new Set(P(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${ge(this.filter)}`}assemble(){const t=P(this.filter).reduce((n,i)=>{const r=this.filter[i],o=q(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${o}) || (isValid(${o}) && isFinite(+${o})))`):r.type==="quantitative"&&(n.push(`isValid(${o})`),n.push(`isFinite(+${o})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class Em extends Ce{clone(){return new Em(this.parent,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((o,s)=>r[s]??o)}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${ge(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class km extends Ce{clone(){return new km(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"key",i[1]??"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${ge(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class iu extends Ce{clone(){return new iu(null,oe(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Oi,Ni],[ni,Ri]]){const o=r.map(s=>{const a=it(n.encoding[s]);return L(a)?a.field:br(a)?{expr:`${a.datum}`}:$i(a)?{expr:`${a.value}`}:void 0});(o[0]||o[1])&&(t=new iu(t,o,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(wn)){const r=n.typedFieldDef(wn);r.type===tl&&(t=new iu(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}constructor(t,n,i,r){super(t),this.fields=n,this.geojson=i,this.signal=r}dependentFields(){const t=(this.fields??[]).filter(Y);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${ge(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class Yc extends Ce{clone(){return new Yc(null,this.projection,oe(this.fields),oe(this.as))}constructor(t,n,i,r){super(t),this.projection=n,this.fields=i,this.as=r}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Oi,Ni],[ni,Ri]]){const r=i.map(s=>{const a=it(n.encoding[s]);return L(a)?a.field:br(a)?{expr:`${a.datum}`}:$i(a)?{expr:`${a.value}`}:void 0}),o=i[0]===ni?"2":"";(r[0]||r[1])&&(t=new Yc(t,n.projectionName(),r,[n.getName(`x${o}`),n.getName(`y${o}`)]))}return t}dependentFields(){return new Set(this.fields.filter(Y))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${ge(this.fields)} ${ge(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Bs extends Ce{clone(){return new Bs(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set([this.transform.impute,this.transform.key,...this.transform.groupby??[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,n){return new Bs(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,o=i.y;if(L(r)&&L(o)){const s=r.impute?r:o.impute?o:void 0;if(s===void 0)return;const a=r.impute?o:o.impute?r:void 0,{method:u,value:l,frame:c,keyvals:f}=s.impute,d=z6(n.mark,i);return new Bs(t,{impute:s.field,key:a.field,...u?{method:u}:{},...l!==void 0?{value:l}:{},...c?{frame:c}:{},...f!==void 0?{keyvals:f}:{},...d.length?{groupby:d}:{}})}return null}hash(){return`Impute ${ge(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:o,value:s,frame:a=[null,null]}=this.transform,u={type:"impute",field:t,key:n,...i?{keyvals:Zoe(i)?this.processSequence(i):i}:{},method:"value",...o?{groupby:o}:{},value:!r||r==="value"?s:null};if(r&&r!=="value"){const l={type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1,...o?{groupby:o}:{}},c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}class $m extends Ce{clone(){return new $m(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.loess]}dependentFields(){return new Set([this.transform.loess,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${ge(this.transform)}`}assemble(){const{loess:t,on:n,...i}=this.transform;return{type:"loess",x:n,y:t,...i}}}class Vc extends Ce{clone(){return new Vc(null,oe(this.transform),this.secondary)}constructor(t,n,i){super(t),this.transform=n,this.secondary=i}static make(t,n,i,r){const o=n.component.data.sources,{from:s}=i;let a=null;if(ese(s)){let u=S4(s.data,o);u||(u=new aa(s.data),o.push(u));const l=n.getName(`lookup_${r}`);a=new nn(u,l,Ne.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(tse(s)){const u=s.param;i={as:u,...i};let l;try{l=n.getSelectionComponent(Le(u),u)}catch{throw new Error(Mne(u))}if(a=l.materialized,!a)throw new Error(Fne(u))}return new Vc(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?H(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${ge({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t={values:this.transform.from.fields,...this.transform.as?{as:H(this.transform.as)}:{}};else{let n=this.transform.as;Y(n)||(I(Lne),n="_lookup"),t={as:[n]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...t,...this.transform.default?{default:this.transform.default}:{}}}}class Am extends Ce{clone(){return new Am(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"prob",i[1]??"value"]}dependentFields(){return new Set([this.transform.quantile,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${ge(this.transform)}`}assemble(){const{quantile:t,...n}=this.transform;return{type:"quantile",field:t,...n}}}class Cm extends Ce{clone(){return new Cm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.regression]}dependentFields(){return new Set([this.transform.regression,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${ge(this.transform)}`}assemble(){const{regression:t,on:n,...i}=this.transform;return{type:"regression",x:n,y:t,...i}}}class Mm extends Ce{clone(){return new Mm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=Hi((this.transform.groupby??[]).concat(t),n=>n)}producedFields(){}dependentFields(){return new Set([this.transform.pivot,this.transform.value,...this.transform.groupby??[]])}hash(){return`PivotTransform ${ge(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:o}=this.transform;return{type:"pivot",field:t,value:n,...r!==void 0?{limit:r}:{},...o!==void 0?{op:o}:{},...i!==void 0?{groupby:i}:{}}}}class Fm extends Ce{clone(){return new Fm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${ge(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function w4(e){let t=0;function n(i,r){if(i instanceof aa&&!i.isGenerator&&!Ou(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof zt&&(i.parent instanceof aa&&!r.source?(r.format={...r.format??{},parse:i.assembleFormatParse()},r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof rl){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}switch((i instanceof Lf||i instanceof If||i instanceof Gc||i instanceof il||i instanceof zu||i instanceof Yc||i instanceof wi||i instanceof Vc||i instanceof ol||i instanceof ka||i instanceof km||i instanceof Em||i instanceof _m||i instanceof $m||i instanceof Am||i instanceof Cm||i instanceof Go||i instanceof Fm||i instanceof Mm||i instanceof Sm)&&r.transform.push(i.assemble()),(i instanceof Ji||i instanceof Ki||i instanceof Bs||i instanceof Br||i instanceof iu)&&r.transform.push(...i.assemble()),i instanceof nn&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof nn?i.setSource(r.name):(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof nn&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const s of i.children)n(s,{name:null,source:o,transform:[]});break}}}return n}function dle(e){const t=[],n=w4(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function hle(e,t){const n=[],i=w4(n);let r=0;for(const s of e.sources){s.hasName()||(s.dataName=`source_${r++}`);const a=s.assemble();i(s,a)}for(const s of n)s.transform.length===0&&delete s.transform;let o=0;for(const[s,a]of n.entries())(a.transform??[]).length===0&&!a.source&&n.splice(o++,0,n.splice(s,1)[0]);for(const s of n)for(const a of s.transform??[])a.type==="lookup"&&(a.from=e.outputNodes[a.from].getSource());for(const s of n)s.name in t&&(s.values=t[s.name]);return n}function gle(e){return e==="top"||e==="left"||Q(e)?"header":"footer"}function ple(e){for(const t of Yn)mle(e,t);DA(e,"x"),DA(e,"y")}function mle(e,t){const{facet:n,config:i,child:r,component:o}=e;if(e.channelHasField(t)){const s=n[t],a=Lu("title",null,i,t);let u=tu(s,i,{allowDisabling:!0,includeDefault:a===void 0||!!a});r.component.layoutHeaders[t].title&&(u=z(u)?u.join(", "):u,u+=` / ${r.component.layoutHeaders[t].title}`,r.component.layoutHeaders[t].title=null);const l=Lu("labelOrient",s.header,i,t),c=s.header!==null?Ve(s.header?.labels,i.header.labels,!0):!1,f=pe(["bottom","right"],l)?"footer":"header";o.layoutHeaders[t]={title:s.header!==null?u:null,facetFieldDef:s,[f]:t==="facet"?[]:[_4(e,t,c)]}}}function _4(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function DA(e,t){const{child:n}=e;if(n.component.axes[t]){const{layoutHeaders:i,resolve:r}=e.component;if(r.axis[t]=y_(r,t),r.axis[t]==="shared"){const o=t==="x"?"column":"row",s=i[o];for(const a of n.component.axes[t]){const u=gle(a.get("orient"));s[u]??(s[u]=[_4(e,o,!1)]);const l=Ql(a,"main",e.config,{header:!0});l&&s[u][0].axes.push(l),a.mainExtracted=!0}}}}function yle(e){k_(e),Ag(e,"width"),Ag(e,"height")}function ble(e){k_(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Ag(e,t),Ag(e,n)}function k_(e){for(const t of e.children)t.parseLayoutSize()}function Ag(e,t){const n=YR(t),i=Xp(n),r=e.component.resolve,o=e.component.layoutSize;let s;for(const a of e.children){const u=a.component.layoutSize.getWithExplicit(n),l=r.scale[i]??XR(i,e);if(l==="independent"&&u.value==="step"){s=void 0;break}if(s){if(l==="independent"&&s.value!==u.value){s=void 0;break}s=qo(s,u,n,"")}else s=u}if(s){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);o.setWithExplicit(t,s)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function xle(e){const{size:t,component:n}=e;for(const i of yr){const r=_n(i);if(t[r]){const o=t[r];n.layoutSize.set(r,sr(o)?"step":o,!0)}else{const o=vle(e,r);n.layoutSize.set(r,o,!1)}}}function vle(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const o=r.get("type"),s=r.get("range");if(mt(o)){const a=Sg(i.view,t);return os(s)||sr(a)?"step":a}else return Vy(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Vy(i.view,t);{const o=Sg(i.view,t);return sr(o)?o.step:o}}}function ub(e,t,n){return q(t,{suffix:`by_${q(e)}`,...n??{}})}class hc extends v4{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve),this.child=F_(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!Nf(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=P(t),i={};for(const r of n){if(![Pr,Lr].includes(r)){I(Qp(r,"facet"));break}const o=t[r];if(o.field===void 0){I(qy(o,r));break}i[r]=this.initFacetFieldDef(o,r)}return i}initFacetFieldDef(t,n){const i=Vw(t,n);return i.header?i.header=dn(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Dm(this),this.child.parseData()}parseLayoutSize(){k_(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),ple(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){const t={};for(const n of Yn)for(const i of p_){const r=this.component.layoutHeaders[n],o=r[i],{facetFieldDef:s}=r;if(s){const a=Lu("titleOrient",s.header,this.config,n);if(["right","bottom"].includes(a)){const u=xm(n,a);t.titleAnchor??(t.titleAnchor={}),t.titleAnchor[u]="end"}}if(o?.[0]){const a=n==="row"?"height":"width",u=i==="header"?"headerBand":"footerBand";n!=="facet"&&!this.child.component.layoutSize.get(a)&&(t[u]??(t[u]={}),t[u][n]=.5),r.title&&(t.offset??(t.offset={}),t.offset[n==="row"?"rowTitle":"columnTitle"]=10)}}return t}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),{...this.getHeaderLayoutMixins(),...i?{columns:i}:{},bounds:"full",align:r}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof hc))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(t){return this.parent&&this.parent instanceof hc?{...this.channelHasField("column")?{encode:{update:{columns:{field:q(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(t)}:super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof hc){if(this.child.channelHasField("column")){const r=q(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of yr){const o=this.child.component.scales[r];if(o&&!o.merged){const s=o.get("type"),a=o.get("range");if(mt(s)&&os(a)){const u=wm(this.child,r),l=__(u);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):I(Sw(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:o,ops:s,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const c of Yn){const f=this.facet[c];if(f){u.push(q(f));const{bin:d,sort:h}=f;if(Oe(d)&&u.push(q(f,{binSuffix:"end"})),Xi(h)){const{field:g,op:p=rm}=h,m=ub(f,h);i&&r?(o.push(m),s.push("max"),a.push(m)):(o.push(g),s.push(p),a.push(m))}else if(z(h)){const g=Pu(f,c);o.push(g),s.push("max"),a.push(g)}}}const l=!!i&&!!r;return{name:t,data:n,groupby:u,...l||o.length>0?{aggregate:{...l?{cross:l}:{},...o.length?{fields:o,ops:s,as:a}:{}}}:{}}}facetSortFields(t){const{facet:n}=this,i=n[t];return i?Xi(i.sort)?[ub(i,i.sort,{expr:"datum"})]:z(i.sort)?[Pu(i,t,{expr:"datum"})]:[q(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(Xi(r)?r.order:!z(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return nb(t.facet,"facet",n);const i={row:["top","bottom"],column:["left","right"]};for(const r of g_)if(t[r]){const o=Lu("labelOrient",t[r]?.header,n,r);if(i[r].includes(o))return nb(t[r],r,n)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=dle(n),r=t.assembleGroupEncodeEntry(!1),o=this.assembleLabelTitle()||t.assembleTitle(),s=t.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...o?{title:o}:{},...s?{style:s}:{},from:{facet:this.assembleFacet()},sort:{field:Yn.map(u=>this.facetSortFields(u)).flat(),order:Yn.map(u=>this.facetSortOrder(u)).flat()},...i.length>0?{data:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup(Dse(this,[]))}]}getMapping(){return this.facet}}function wle(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const o of[n,i])if(Xi(o.sort)){const{field:s,op:a=rm}=o.sort;e=r=new ka(e,{joinaggregate:[{op:a,field:s,as:ub(o,o.sort,{forAs:!0})}],groupby:[q(o)]})}return r}return null}function S4(e,t){for(const n of t){const i=n.data;if(e.name&&n.hasName()&&e.name!==n.dataName)continue;const r=e.format?.mesh,o=i.format?.feature;if(r&&o)continue;const s=e.format?.feature;if((s||o)&&s!==o)continue;const a=i.format?.mesh;if(!((r||a)&&r!==a)){if(Hc(e)&&Hc(i)){if(Dn(e.values,i.values))return n}else if(Ou(e)&&Ou(i)){if(e.url===i.url)return n}else if(dR(e)&&e.name===n.dataName)return n}}return null}function _le(e,t){if(e.data||!e.parent){if(e.data===null){const i=new aa({values:[]});return t.push(i),i}const n=S4(e.data,t);if(n)return Ao(e.data)||(n.data.format=uO({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new aa(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function Sle(e,t,n){let i=0;for(const r of t.transforms){let o,s;if(fse(r))s=e=new zu(e,r),o="derived";else if(a_(r)){const a=gue(r);s=e=zt.makeWithAncestors(e,{},a,n)??e,e=new il(e,t,r.filter)}else if(aR(r))s=e=Ji.makeFromTransform(e,r,t),o="number";else if(hse(r))o="date",n.getWithExplicit(r.field).value===void 0&&(e=new zt(e,{[r.field]:o}),n.set(r.field,o,!1)),s=e=Ki.makeFromTransform(e,r);else if(gse(r))s=e=wi.makeFromTransform(e,r),o="number",h_(t)&&(e=new Go(e));else if(sR(r))s=e=Vc.make(e,t,r,i++),o="derived";else if(use(r))s=e=new ol(e,r),o="number";else if(lse(r))s=e=new ka(e,r),o="number";else if(pse(r))s=e=Br.makeFromTransform(e,r),o="derived";else if(mse(r))s=e=new km(e,r),o="derived";else if(yse(r))s=e=new Sm(e,r),o="derived";else if(cse(r))s=e=new Em(e,r),o="derived";else if(nse(r))s=e=new Mm(e,r),o="derived";else if(ase(r))e=new Fm(e,r);else if(dse(r))s=e=Bs.makeFromTransform(e,r),o="derived";else if(ise(r))s=e=new _m(e,r),o="derived";else if(rse(r))s=e=new Am(e,r),o="derived";else if(ose(r))s=e=new Cm(e,r),o="derived";else if(sse(r))s=e=new $m(e,r),o="derived";else{I(Pne(r));continue}if(s&&o!==void 0)for(const a of s.producedFields()??[])n.set(a,o,!1)}return e}function Dm(e){let t=_le(e,e.component.data.sources);const{outputNodes:n,outputNodeRefCounts:i}=e.component.data,r=e.data,s=!(r&&(Ao(r)||Ou(r)||Hc(r)))&&e.parent?e.parent.component.data.ancestorParse.clone():new Mse;Ao(r)?(hR(r)?t=new If(t,r.sequence):u_(r)&&(t=new Lf(t,r.graticule)),s.parseNothing=!0):r?.format?.parse===null&&(s.parseNothing=!0),t=zt.makeExplicit(t,e,s)??t,t=new Go(t);const a=e.parent&&sl(e.parent);(We(e)||_i(e))&&a&&(t=Ji.makeFromEncoding(t,e)??t),e.transforms.length>0&&(t=Sle(t,e,s));const u=mue(e),l=pue(e);t=zt.makeWithAncestors(t,{},{...u,...l},s)??t,We(e)&&(t=iu.parseAll(t,e),t=Yc.parseAll(t,e)),(We(e)||_i(e))&&(a||(t=Ji.makeFromEncoding(t,e)??t),t=Ki.makeFromEncoding(t,e)??t,t=zu.parseAllForSortIndex(t,e));const c=e.getDataName(Ne.Raw),f=new nn(t,c,Ne.Raw,i);if(n[c]=f,t=f,We(e)){const p=wi.makeFromEncoding(t,e);p&&(t=p,h_(e)&&(t=new Go(t))),t=Bs.makeFromEncoding(t,e)??t,t=Br.makeFromEncoding(t,e)??t}We(e)&&(t=Gc.make(t,e)??t);const d=e.getDataName(Ne.Main),h=new nn(t,d,Ne.Main,i);n[d]=h,t=h,We(e)&&fae(e,h);let g=null;if(_i(e)){const p=e.getName("facet");t=wle(t,e.facet)??t,g=new rl(t,e,p,h.getSource()),n[p]=g}return{...e.component.data,outputNodes:n,outputNodeRefCounts:i,raw:f,main:h,facetRoot:g,ancestorParse:s}}class Ele extends E_{constructor(t,n,i,r){super(t,"concat",n,i,r,t.resolve),(t.resolve?.axis?.x==="shared"||t.resolve?.axis?.y==="shared")&&I(One),this.children=this.getChildren(t).map((o,s)=>F_(o,this,this.getName(`concat_${s}`),void 0,r))}parseData(){this.component.data=Dm(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of P(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return dm(t)?t.vconcat:o_(t)?t.hconcat:t.concat}parseLayoutSize(){ble(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=m_(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return{type:"group",name:t.getName("group"),...n?{title:n}:{},...i?{style:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){const t=this.layout.columns;return{...t!=null?{columns:t}:{},bounds:"full",align:"each"}}}function kle(e){return e===!1||e===null}const $le={disable:1,gridScale:1,scale:1,...D6,labelExpr:1,encode:1},E4=P($le);class $_ extends eo{constructor(t={},n={},i=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new $_(oe(this.explicit),oe(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!kle(this.get(t))}hasOrientSignalRef(){return Q(this.explicit.orient)}}function Ale(e,t,n){const{encoding:i,config:r}=e,o=it(i[t])??it(i[mr(t)]),s=e.axis(t)||{},{format:a,formatType:u}=s;if(ra(u))return{text:xi({fieldOrDatumDef:o,field:"datum.value",format:a,formatType:u,config:r}),...n};if(a===void 0&&u===void 0&&r.customFormatTypes){if(Du(o)==="quantitative"){if(Tu(o)&&o.stack==="normalize"&&r.normalizedNumberFormatType)return{text:xi({fieldOrDatumDef:o,field:"datum.value",format:r.normalizedNumberFormat,formatType:r.normalizedNumberFormatType,config:r}),...n};if(r.numberFormatType)return{text:xi({fieldOrDatumDef:o,field:"datum.value",format:r.numberFormat,formatType:r.numberFormatType,config:r}),...n}}if(Du(o)==="temporal"&&r.timeFormatType&&L(o)&&!o.timeUnit)return{text:xi({fieldOrDatumDef:o,field:"datum.value",format:r.timeFormat,formatType:r.timeFormatType,config:r}),...n}}return n}function Cle(e){return yr.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[Rle(n,e)]),t),{})}const Mle={bottom:"top",top:"bottom",left:"right",right:"left"};function Fle(e){const{axes:t,resolve:n}=e.component,i={top:0,bottom:0,right:0,left:0};for(const r of e.children){r.parseAxesAndHeaders();for(const o of P(r.component.axes))n.axis[o]=y_(e.component.resolve,o),n.axis[o]==="shared"&&(t[o]=Dle(t[o],r.component.axes[o]),t[o]||(n.axis[o]="independent",delete t[o]))}for(const r of yr){for(const o of e.children)if(o.component.axes[r]){if(n.axis[r]==="independent"){t[r]=(t[r]??[]).concat(o.component.axes[r]);for(const s of o.component.axes[r]){const{value:a,explicit:u}=s.getWithExplicit("orient");if(!Q(a)){if(i[a]>0&&!u){const l=Mle[a];i[a]>i[l]&&s.set("orient",l,!1)}i[a]++}}}delete o.component.axes[r]}if(n.axis[r]==="independent"&&t[r]&&t[r].length>1)for(const[o,s]of(t[r]||[]).entries())o>0&&s.get("grid")&&!s.explicit.grid&&(s.implicit.grid=!1)}}function Dle(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],o=t[i];if(!!r!=!!o)return;if(r&&o){const s=r.getWithExplicit("orient"),a=o.getWithExplicit("orient");if(s.explicit&&a.explicit&&s.value!==a.value)return;e[i]=Tle(r,o)}}}else return t.map(n=>n.clone());return e}function Tle(e,t){for(const n of E4){const i=qo(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,o)=>{switch(n){case"title":return zO(r,o);case"gridScale":return{explicit:r.explicit,value:Ve(r.value,o.value)}}return gm(r,o,n,"axis")});e.setWithExplicit(n,i)}return e}function Nle(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(Q(n.labelAngle)?n.labelAngle:qc(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===jR(i,r))return!0}return e===n[t]}const Ole=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Rle(e,t){let n=t.axis(e);const i=new $_,r=it(t.encoding[e]),{mark:o,config:s}=t,a=n?.orient||s[e==="x"?"axisX":"axisY"]?.orient||s.axis?.orient||wae(e),u=t.getScaleComponent(e).get("type"),l=gae(e,u,a,t.config),c=n!==void 0?!n:eb("disable",s.style,n?.style,l).configValue;if(i.set("disable",c,n!==void 0),c)return i;n=n||{};const f=bae(r,n,e,s.style,l),d=m6(n.formatType,r,u),h=p6(r,r.type,n.format,n.formatType,s,!0),g={fieldOrDatumDef:r,axis:n,channel:e,model:t,scaleType:u,orient:a,labelAngle:f,format:h,formatType:d,mark:o,config:s};for(const y of E4){const b=y in mA?mA[y](g):q$(y)?n[y]:void 0,x=b!==void 0,v=Nle(b,y,n,t,e);if(x&&v)i.set(y,b,v);else{const{configValue:w=void 0,configFrom:S=void 0}=q$(y)&&y!=="values"?eb(y,s.style,n.style,l):{},_=w!==void 0;x&&!_?i.set(y,b,v):(S!=="vgAxisConfig"||Ole.has(y)&&_||zf(w)||Q(w))&&i.set(y,w,!1)}}const p=n.encoding??{},m=F6.reduce((y,b)=>{if(!i.hasAxisPart(b))return y;const x=VR(p[b]??{},t),v=b==="labels"?Ale(t,e,x):x;return v!==void 0&&!Me(v)&&(y[b]={update:v}),y},{});return Me(m)||i.set("encode",m,!!n.encoding||n.labelAngle!==void 0),i}function zle({encoding:e,size:t}){for(const n of yr){const i=_n(n);sr(t[i])&&wo(e[n])&&(delete t[i],I(UO(i)))}return t}const Ple={vgMark:"arc",encodeEntry:e=>({...oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...Rt("x",e,{defaultPos:"mid"}),...Rt("y",e,{defaultPos:"mid"}),...Wo(e,"radius"),...Wo(e,"theta")})},Lle={vgMark:"area",encodeEntry:e=>({...oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...Eg("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"}),...Eg("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"}),...d_(e)})},Ile={vgMark:"rect",encodeEntry:e=>({...oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Wo(e,"x"),...Wo(e,"y")})},Ble={vgMark:"shape",encodeEntry:e=>({...oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[{type:"geoshape",projection:e.projectionName(),...n&&L(n)&&n.type===tl?{field:q(n,{expr:"datum"})}:{}}]}},Ule={vgMark:"image",encodeEntry:e=>({...oi(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...Wo(e,"x"),...Wo(e,"y"),...c_(e,"url")})},jle={vgMark:"line",encodeEntry:e=>({...oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...Rt("x",e,{defaultPos:"mid"}),...Rt("y",e,{defaultPos:"mid"}),...lt("size",e,{vgChannel:"strokeWidth"}),...d_(e)})},qle={vgMark:"trail",encodeEntry:e=>({...oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...Rt("x",e,{defaultPos:"mid"}),...Rt("y",e,{defaultPos:"mid"}),...lt("size",e),...d_(e)})};function A_(e,t){const{config:n}=e;return{...oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...Rt("x",e,{defaultPos:"mid"}),...Rt("y",e,{defaultPos:"mid"}),...lt("size",e),...lt("angle",e),...Wle(e,n,t)}}function Wle(e,t,n){return n?{shape:{value:n}}:lt("shape",e)}const Hle={vgMark:"symbol",encodeEntry:e=>A_(e)},Gle={vgMark:"symbol",encodeEntry:e=>A_(e,"circle")},Yle={vgMark:"symbol",encodeEntry:e=>A_(e,"square")},Vle={vgMark:"rect",encodeEntry:e=>({...oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Wo(e,"x"),...Wo(e,"y")})},Xle={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:{...oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Eg("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"}),...Eg("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"}),...lt("size",e,{vgChannel:"strokeWidth"})}}},Kle={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return{...oi(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...Rt("x",e,{defaultPos:"mid"}),...Rt("y",e,{defaultPos:"mid"}),...c_(e),...lt("size",e,{vgChannel:"fontSize"}),...lt("angle",e),...dA("align",Jle(e.markDef,n,t)),...dA("baseline",Qle(e.markDef,n,t)),...Rt("radius",e,{defaultPos:null}),...Rt("theta",e,{defaultPos:null})}}};function Jle(e,t,n){if($e("align",e,n)===void 0)return"center"}function Qle(e,t,n){if($e("baseline",e,n)===void 0)return"middle"}const Zle={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",o=i==="horizontal"?"height":"width";return{...oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Rt("x",e,{defaultPos:"mid",vgChannel:"xc"}),...Rt("y",e,{defaultPos:"mid",vgChannel:"yc"}),...lt("size",e,{defaultValue:ece(e),vgChannel:r}),[o]:ze($e("thickness",n,t))}}};function ece(e){const{config:t,markDef:n}=e,{orient:i}=n,r=i==="horizontal"?"width":"height",o=e.getScaleComponent(i==="horizontal"?"x":"y"),s=$e("size",n,t,{vgChannel:r})??t.tick.bandSize;if(s!==void 0)return s;{const a=o?o.get("range"):void 0;return a&&os(a)&&xe(a.step)?a.step*3/4:_g(t.view,r)*3/4}}const vd={arc:Ple,area:Lle,bar:Ile,circle:Gle,geoshape:Ble,image:Ule,line:jle,point:Hle,rect:Vle,rule:Xle,square:Yle,text:Kle,tick:Zle,trail:qle};function tce(e){if(pe([nm,em,lre],e.mark)){const t=z6(e.mark,e.encoding);if(t.length>0)return nce(e,t)}else if(e.mark===tm){const t=jy.some(n=>$e(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return ice(e)}return C_(e)}const TA="faceted_path_";function nce(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:TA+e.requestDataName(Ne.Main),data:e.requestDataName(Ne.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:C_(e,{fromPrefix:TA})}]}const NA="stack_group_";function ice(e){const[t]=C_(e,{fromPrefix:NA}),n=e.scaleName(e.stack.fieldChannel),i=(l={})=>e.vgField(e.stack.fieldChannel,l),r=(l,c)=>{const f=[i({prefix:"min",suffix:"start",expr:c}),i({prefix:"max",suffix:"start",expr:c}),i({prefix:"min",suffix:"end",expr:c}),i({prefix:"max",suffix:"end",expr:c})];return`${l}(${f.map(d=>`scale('${n}',${d})`).join(",")})`};let o,s;e.stack.fieldChannel==="x"?(o={...ku(t.encode.update,["y","yc","y2","height",...jy]),x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}},s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update={...pn(t.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(o={...ku(t.encode.update,["x","xc","x2","width"]),y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}},s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update={...pn(t.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const l of jy){const c=Hr(l,e.markDef,e.config);t.encode.update[l]?(o[l]=t.encode.update[l],delete t.encode.update[l]):c&&(o[l]=ze(c)),c&&(t.encode.update[l]={value:0})}const a=[];if(e.stack.groupbyChannels?.length>0)for(const l of e.stack.groupbyChannels){const c=e.fieldDef(l),f=q(c);f&&a.push(f),(c?.bin||c?.timeUnit)&&a.push(q(c,{binSuffix:"end"}))}return o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((l,c)=>{if(t.encode.update[c])return{...l,[c]:t.encode.update[c]};{const f=Hr(c,e.markDef,e.config);return f!==void 0?{...l,[c]:ze(f)}:l}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(Ne.Main),name:NA+e.requestDataName(Ne.Main),groupby:a,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[t]}]}]}function rce(e){const{encoding:t,stack:n,mark:i,markDef:r,config:o}=e,s=t.order;if(!(!z(s)&&$i(s)&&By(s.value)||!s&&By($e("order",r,o)))){if((z(s)||L(s))&&!n)return NO(s,{expr:"datum"});if(ss(i)){const a=r.orient==="horizontal"?"y":"x",u=t[a];if(L(u)){const l=u.sort;if(z(l))return{field:q(u,{prefix:a,suffix:"sort_index",expr:"datum"})};if(Xi(l))return{field:q({aggregate:Xw(e.encoding)?l.op:void 0,field:l.field},{expr:"datum"})};if(b6(l)){const c=e.fieldDef(l.encoding);return{field:q(c,{expr:"datum"}),order:l.order}}else return l===null?void 0:{field:q(u,{binSuffix:e.stack?.impute?"mid":void 0,expr:"datum"})}}return}}}function C_(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:o}=e,s=Ve(i.clip,oce(e),sce(e)),a=DO(i),u=r.key,l=rce(e),c=ace(e),f=$e("aria",i,o),d=vd[n].postEncodingTransform?vd[n].postEncodingTransform(e):null;return[{name:e.getName("marks"),type:vd[n].vgMark,...s?{clip:!0}:{},...a?{style:a}:{},...u?{key:u.field}:{},...l?{sort:l}:{},...c||{},...f===!1?{aria:f}:{},from:{data:t.fromPrefix+e.requestDataName(Ne.Main)},encode:{update:vd[n].encodeEntry(e)},...d?{transform:d}:{}}]}function oce(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t?.get("selectionExtent")||n?.get("selectionExtent")?!0:void 0}function sce(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function ace(e){if(!e.component.selection)return null;const t=P(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=P(i.component.selection).length,i=i.parent;return n?{interactive:t>0||e.mark==="geoshape"||!!e.encoding.tooltip}:null}class k4 extends v4{constructor(t,n,i,r={},o){super(t,"unit",n,i,o,void 0,H$(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const s=rr(t.mark)?{...t.mark}:{type:t.mark},a=s.type;s.filled===void 0&&(s.filled=Hoe(s,o,{graticule:t.data&&u_(t.data)}));const u=this.encoding=Xre(t.encoding||{},a,s.filled,o);this.markDef=iR(s,u,o),this.size=zle({encoding:u,size:H$(t)?{...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}}:r}),this.stack=nR(this.markDef,u),this.specifiedScales=this.initScales(a,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegends(u),this.specifiedProjection=t.projection,this.selection=(t.params??[]).filter(l=>i_(l))}get hasProjection(){const{encoding:t}=this,n=this.mark===c6,i=t&&Vte.some(r=>se(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Kp.reduce((i,r)=>{const o=it(n[r]);return o&&(i[r]=this.initScale(o.scale??{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=dn(t);return z(n)&&(r.domain=n.map(Cn)),z(i)&&(r.range=i.map(Cn)),r}initAxes(t){return yr.reduce((n,i)=>{const r=t[i];if(se(r)||i===Ie&&se(t.x2)||i===bt&&se(t.y2)){const o=se(r)?r.axis:void 0;n[i]=o&&this.initAxis({...o})}return n},{})}initAxis(t){const n=P(t),i={};for(const r of n){const o=t[r];i[r]=zf(o)?FO(o):Cn(o)}return i}initLegends(t){return rne.reduce((n,i)=>{const r=it(t[i]);if(r&&sne(i)){const o=r.legend;n[i]=o&&dn(o)}return n},{})}parseData(){this.component.data=Dm(this)}parseLayoutSize(){xle(this)}parseSelections(){this.component.selection=cae(this,this.selection)}parseMarkGroup(){this.component.mark=tce(this)}parseAxesAndHeaders(){this.component.axes=Cle(this)}assembleSelectionTopLevelSignals(t){return Tse(this,t)}assembleSignals(){return[...IR(this),...Fse(this,[])]}assembleSelectionData(t){return Nse(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return m_(this)}assembleMarks(){let t=this.component.mark??[];return(!this.parent||!sl(this.parent))&&(t=mR(this,t)),t.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Ls(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return or(n)}typedFieldDef(t){const n=this.fieldDef(t);return sn(n)?n:null}}class M_ extends E_{constructor(t,n,i,r,o){super(t,"layer",n,i,o,t.resolve,t.view);const s={...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}};this.children=t.layer.map((a,u)=>{if(hm(a))return new M_(a,this,this.getName(`layer_${u}`),s,o);if(Zr(a))return new k4(a,this,this.getName(`layer_${u}`),s,o);throw new Error(_w(a))})}parseData(){this.component.data=Dm(this);for(const t of this.children)t.parseData()}parseLayoutSize(){yle(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of P(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){Fle(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),IR(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),m_(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of H(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return Ose(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),n4(this))}}function F_(e,t,n,i,r){if(om(e))return new hc(e,t,n,r);if(hm(e))return new M_(e,t,n,i,r);if(Zr(e))return new k4(e,t,n,i,r);if(xoe(e))return new Ele(e,t,n,r);throw new Error(_w(e))}function uce(e,t={}){t.logger&&Eie(t.logger),t.fieldTitle&&A6(t.fieldTitle);try{const n=tR(Cg(t.config,e.config)),i=cR(e,n),r=F_(i,null,"",void 0,n);return r.parse(),Tue(r.component.data,r),{spec:cce(r,lce(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&kie(),t.fieldTitle&&Bre()}}function lce(e,t,n,i){const r=i.component.layoutSize.get("width"),o=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):Y(t)&&(t={type:t}),r&&o&&$se(t.type)){if(r==="step"&&o==="step")I(M$()),t.type="pad";else if(r==="step"||o==="step"){const s=r==="step"?"width":"height";I(M$(Xp(s)));const a=s==="width"?"height":"width";t.type=Ase(a)}}return{...P(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t},...iA(n,!1),...iA(e,!0)}}function cce(e,t,n={},i){const r=e.config?Noe(e.config):void 0,o=[].concat(e.assembleSelectionData([]),hle(e.component.data,n)),s=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter(h=>(h.name==="width"||h.name==="height")&&h.value!==void 0?(t[h.name]=+h.value,!1):!0);const{params:f,...d}=t;return{$schema:"https://vega.github.io/schema/vega/v5.json",...e.description?{description:e.description}:{},...d,...a?{title:a}:{},...u?{style:u}:{},...l?{encode:{update:l}}:{},data:o,...s.length>0?{projections:s}:{},...e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...J6(f)]),...r?{config:r}:{},...i?{usermeta:i}:{}}}const fce=jte.version,Qfe=Object.freeze(Object.defineProperty({__proto__:null,accessPathDepth:$u,accessPathWithDatum:dw,compile:uce,contains:pe,deepEqual:Dn,deleteNestedProperty:dg,duplicate:oe,entries:Bo,every:lw,fieldIntersection:fw,flatAccessWithDatum:cO,getFirstDefined:Ve,hasIntersection:cw,hash:ge,internalField:hO,isBoolean:jc,isEmpty:Me,isEqual:Wte,isInternalField:gO,isNullOrFalse:By,isNumeric:qp,keys:P,logicalExpr:fc,mergeDeep:uO,never:aO,normalize:cR,normalizeAngle:qc,omit:pn,pick:ku,prefixGenerator:Uy,removePathFromField:hw,replaceAll:Zs,replacePathInField:ti,resetIdCounter:Gte,setEqual:lO,some:Qs,stringify:Fe,titleCase:$f,unique:Hi,uniqueId:dO,vals:Et,varName:Le,version:fce},Symbol.toStringTag,{value:"Module"}));function Zfe(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var dce="vega-themes",hce="2.14.0",gce="Themes for stylized Vega and Vega-Lite visualizations.",pce=["vega","vega-lite","themes","style"],mce="BSD-3-Clause",yce={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},bce=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],xce="build/vega-themes.js",vce="build/vega-themes.module.js",wce="build/vega-themes.min.js",_ce="build/vega-themes.min.js",Sce="build/vega-themes.module.d.ts",Ece={type:"git",url:"https://github.com/vega/vega-themes.git"},kce=["src","build"],$ce={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},Ace={"@babel/core":"^7.22.9","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.9","@babel/preset-env":"^7.22.9","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@typescript-eslint/eslint-plugin":"^6.0.0","@typescript-eslint/parser":"^6.0.0","browser-sync":"^2.29.3",concurrently:"^8.2.0",eslint:"^8.45.0","eslint-config-prettier":"^8.8.0","eslint-plugin-prettier":"^5.0.0","gh-pages":"^5.0.0",prettier:"^3.0.0","release-it":"^16.1.0",rollup:"^3.26.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",typescript:"^5.1.6",vega:"^5.25.0","vega-lite":"^5.9.3"},Cce={vega:"*","vega-lite":"*"},Mce={},Fce={name:dce,version:hce,description:gce,keywords:pce,license:mce,author:yce,contributors:bce,main:xce,module:vce,unpkg:wce,jsdelivr:_ce,types:Sce,repository:Ece,files:kce,scripts:$ce,devDependencies:Ace,peerDependencies:Cce,dependencies:Mce};const La="#fff",OA="#888",Dce={background:"#333",view:{stroke:OA},title:{color:La,subtitleColor:La},style:{"guide-label":{fill:La},"guide-title":{fill:La}},axis:{domainColor:La,gridColor:OA,tickColor:La}},ds="#4572a7",Tce={background:"#fff",arc:{fill:ds},area:{fill:ds},line:{stroke:ds,strokeWidth:2},path:{stroke:ds},rect:{fill:ds},shape:{stroke:ds},symbol:{fill:ds,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},hs="#30a2da",X0="#cbcbcb",Nce="#999",Oce="#333",RA="#f0f0f0",zA="#333",Rce={arc:{fill:hs},area:{fill:hs},axis:{domainColor:X0,grid:!0,gridColor:X0,gridWidth:1,labelColor:Nce,labelFontSize:10,titleColor:Oce,tickColor:X0,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:RA,group:{fill:RA},legend:{labelColor:zA,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:zA,titleFontSize:14,titlePadding:10},line:{stroke:hs,strokeWidth:2},path:{stroke:hs,strokeWidth:.5},rect:{fill:hs},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:hs},bar:{binSpacing:2,fill:hs,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},gs="#000",zce={group:{fill:"#e5e5e5"},arc:{fill:gs},area:{fill:gs},line:{stroke:gs},path:{stroke:gs},rect:{fill:gs},shape:{stroke:gs},symbol:{fill:gs,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Pce=22,Lce="normal",PA="Benton Gothic, sans-serif",LA=11.5,Ice="normal",ps="#82c6df",K0="Benton Gothic Bold, sans-serif",IA="normal",BA=13,Al={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Bce={background:"#ffffff",title:{anchor:"start",color:"#000000",font:K0,fontSize:Pce,fontWeight:Lce},arc:{fill:ps},area:{fill:ps},line:{stroke:ps,strokeWidth:2},path:{stroke:ps},rect:{fill:ps},shape:{stroke:ps},symbol:{fill:ps,size:30},axis:{labelFont:PA,labelFontSize:LA,labelFontWeight:Ice,titleFont:K0,titleFontSize:BA,titleFontWeight:IA},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:PA,labelFontSize:LA,symbolType:"square",titleFont:K0,titleFontSize:BA,titleFontWeight:IA},range:{category:Al["category-6"],diverging:Al["fireandice-6"],heatmap:Al["fire-7"],ordinal:Al["fire-7"],ramp:Al["fire-7"]}},ms="#ab5787",wd="#979797",Uce={background:"#f9f9f9",arc:{fill:ms},area:{fill:ms},line:{stroke:ms},path:{stroke:ms},rect:{fill:ms},shape:{stroke:ms},symbol:{fill:ms,size:30},axis:{domainColor:wd,domainWidth:.5,gridWidth:.2,labelColor:wd,tickColor:wd,tickWidth:.2,titleColor:wd},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},ys="#3e5c69",jce={background:"#fff",arc:{fill:ys},area:{fill:ys},line:{stroke:ys},path:{stroke:ys},rect:{fill:ys},shape:{stroke:ys},symbol:{fill:ys},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Un="#1696d2",UA="#000000",qce="#FFFFFF",_d="Lato",J0="Lato",Wce="Lato",Hce="#DEDDDD",Gce=18,Cl={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Yce={background:qce,title:{anchor:"start",fontSize:Gce,font:_d},axisX:{domain:!0,domainColor:UA,domainWidth:1,grid:!1,labelFontSize:12,labelFont:J0,labelAngle:0,tickColor:UA,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:_d},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:Hce,gridWidth:1,labelFontSize:12,labelFont:J0,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:_d,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:J0,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:_d,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Cl["six-groups-cat-1"],diverging:Cl["diverging-colors"],heatmap:Cl["diverging-colors"],ordinal:Cl["six-groups-seq"],ramp:Cl["shades-blue"]},area:{fill:Un},rect:{fill:Un},line:{color:Un,stroke:Un,strokeWidth:5},trail:{color:Un,stroke:Un,strokeWidth:0,size:1},path:{stroke:Un,strokeWidth:.5},point:{filled:!0},text:{font:Wce,color:Un,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Un,stroke:null}},arc:{fill:Un},shape:{stroke:Un},symbol:{fill:Un,size:30}},bs="#3366CC",jA="#ccc",Sd="Arial, sans-serif",Vce={arc:{fill:bs},area:{fill:bs},path:{stroke:bs},rect:{fill:bs},shape:{stroke:bs},symbol:{stroke:bs},circle:{fill:bs},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:Sd,fontSize:12},"guide-title":{font:Sd,fontSize:12},"group-title":{font:Sd,fontSize:12}},title:{font:Sd,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:jA,tickColor:jA,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},D_=e=>e*(1/3+1),qA=D_(9),WA=D_(10),HA=D_(12),Ml="Segoe UI",GA="wf_standard-font, helvetica, arial, sans-serif",YA="#252423",Fl="#605E5C",VA="transparent",Xce="#C8C6C4",ui="#118DFF",Kce="#12239E",Jce="#E66C37",Qce="#6B007B",Zce="#E044A7",efe="#744EC2",tfe="#D9B300",nfe="#D64550",$4=ui,A4="#DEEFFF",XA=[A4,$4],ife=[A4,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",$4],rfe={view:{stroke:VA},background:VA,font:Ml,header:{titleFont:GA,titleFontSize:HA,titleColor:YA,labelFont:Ml,labelFontSize:WA,labelColor:Fl},axis:{ticks:!1,grid:!1,domain:!1,labelColor:Fl,labelFontSize:qA,titleFont:GA,titleColor:YA,titleFontSize:HA,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:Xce,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:ui},line:{stroke:ui,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:Ml,fontSize:qA,fill:Fl},arc:{fill:ui},area:{fill:ui,line:!0,opacity:.6},path:{stroke:ui},rect:{fill:ui},point:{fill:ui,filled:!0,size:75},shape:{stroke:ui},symbol:{fill:ui,strokeWidth:1.5,size:50},legend:{titleFont:Ml,titleFontWeight:"bold",titleColor:Fl,labelFont:Ml,labelFontSize:WA,labelColor:Fl,symbolType:"circle",symbolSize:75},range:{category:[ui,Kce,Jce,Qce,Zce,efe,tfe,nfe],diverging:XA,heatmap:XA,ordinal:ife}},Q0='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',KA=400,ofe=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],sfe=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function Tm({type:e,background:t}){const n=e==="dark"?"#161616":"#ffffff",i=e==="dark"?"#f4f4f4":"#161616",r=e==="dark"?ofe:sfe,o=e==="dark"?"#d4bbff":"#6929c4";return{background:t,arc:{fill:o},area:{fill:o},path:{stroke:o},rect:{fill:o},shape:{stroke:o},symbol:{stroke:o},circle:{fill:o},view:{fill:n,stroke:n},group:{fill:n},title:{color:i,anchor:"start",dy:-15,fontSize:16,font:Q0,fontWeight:600},axis:{labelColor:i,labelFontSize:12,grid:!0,gridColor:"#525252",titleColor:i,labelAngle:0},style:{"guide-label":{font:Q0,fill:i,fontWeight:KA},"guide-title":{font:Q0,fill:i,fontWeight:KA}},range:{category:r,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const afe=Tm({type:"light",background:"#ffffff"}),ufe=Tm({type:"light",background:"#f4f4f4"}),lfe=Tm({type:"dark",background:"#262626"}),cfe=Tm({type:"dark",background:"#161616"}),ffe=Fce.version,ede=Object.freeze(Object.defineProperty({__proto__:null,carbong10:ufe,carbong100:cfe,carbong90:lfe,carbonwhite:afe,dark:Dce,excel:Tce,fivethirtyeight:Rce,ggplot2:zce,googlecharts:Vce,latimes:Bce,powerbi:rfe,quartz:Uce,urbaninstitute:Yce,version:ffe,vox:jce},Symbol.toStringTag,{value:"Module"}));export{Y as a,G as b,Qfe as c,ua as d,Zfe as e,lb as f,Ix as g,UL as h,z as i,BL as j,g3 as k,Ec as l,Cg as m,qL as n,WL as o,jL as p,hfe as s,ede as t,mfe as v,Kc as w};
