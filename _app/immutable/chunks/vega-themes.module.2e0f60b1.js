import{e as _g}from"./stores.879c5b6b.js";/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var u4=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)r.hasOwnProperty(o)&&(i[o]=r[o])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),l4=Object.prototype.hasOwnProperty;function q0(e,t){return l4.call(e,t)}function W0(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var i=[];for(var r in e)q0(e,r)&&i.push(r);return i}function Fn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function H0(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function ps(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function LA(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function G0(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(G0(e[t]))return!0}else if(typeof e=="object"){for(var i=W0(e),r=i.length,o=0;o<r;o++)if(G0(e[i[o]]))return!0}}return!1}function E_(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r<"u"&&n.push(i+": "+r)}return n.join(`
`)}var IA=function(e){u4(t,e);function t(n,i,r,o,s){var a=this.constructor,u=e.call(this,E_(n,{name:i,index:r,operation:o,tree:s}))||this;return u.name=i,u.index=r,u.operation=o,u.tree=s,Object.setPrototypeOf(u,a.prototype),u.message=E_(n,{name:i,index:r,operation:o,tree:s}),u}return t}(Error),qe=IA,c4=Fn,Ra={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=jd(n,this.path);i&&(i=Fn(i));var r=As(n,{op:"remove",path:this.from}).removed;return As(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=jd(n,this.from);return As(n,{op:"add",path:this.path,value:Fn(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:uc(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},f4={add:function(e,t,n){return H0(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:Ra.move,copy:Ra.copy,test:Ra.test,_get:Ra._get};function jd(e,t){if(t=="")return e;var n={op:"_get",path:t};return As(e,n),n.value}function As(e,t,n,i,r,o){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),o===void 0&&(o=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ud(t,0)),t.path===""){var s={newDocument:e};if(t.op==="add")return s.newDocument=t.value,s;if(t.op==="replace")return s.newDocument=t.value,s.removed=e,s;if(t.op==="move"||t.op==="copy")return s.newDocument=jd(e,t.from),t.op==="move"&&(s.removed=e),s;if(t.op==="test"){if(s.test=uc(e,t.value),s.test===!1)throw new qe("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return s.newDocument=e,s}else{if(t.op==="remove")return s.removed=e,s.newDocument=null,s;if(t.op==="_get")return t.value=e,s;if(n)throw new qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,t,e);return s}}else{i||(e=Fn(e));var a=t.path||"",u=a.split("/"),l=e,c=1,f=u.length,d=void 0,h=void 0,g=void 0;for(typeof n=="function"?g=n:g=Ud;;){if(h=u[c],h&&h.indexOf("~")!=-1&&(h=LA(h)),r&&(h=="__proto__"||h=="prototype"&&c>0&&u[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=u.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&g(t,0,e,d)),c++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!H0(h))throw new qe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,t,e);H0(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>l.length)throw new qe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,t,e);var s=f4[t.op].call(t,l,h,e);if(s.test===!1)throw new qe("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return s}}else if(c>=f){var s=Ra[t.op].call(t,l,h,e);if(s.test===!1)throw new qe("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return s}if(l=l[h],n&&c<f&&(!l||typeof l!="object"))throw new qe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,t,e)}}}function Zy(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=Fn(e));for(var o=new Array(t.length),s=0,a=t.length;s<a;s++)o[s]=As(e,t[s],n,!0,r,s),e=o[s].newDocument;return o.newDocument=e,o}function d4(e,t,n){var i=As(e,t);if(i.test===!1)throw new qe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function Ud(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new qe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Ra[e.op]){if(typeof e.path!="string")throw new qe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new qe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new qe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&G0(e.value))throw new qe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,o=i.split("/").length;if(r!==o+1&&r!==o)throw new qe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new qe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var s={op:"_get",path:e.from,value:void 0},a=BA([s],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new qe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new qe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function BA(e,t,n){try{if(!Array.isArray(e))throw new qe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Zy(Fn(t),Fn(e),n||!0);else{n=n||Ud;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof qe)return r;throw r}}function uc(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,o,s;if(n&&i){if(o=e.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!uc(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var a=Object.keys(e);if(o=a.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!t.hasOwnProperty(a[r]))return!1;for(r=o;r--!==0;)if(s=a[r],!uc(e[s],t[s]))return!1;return!0}return e!==e&&t!==t}const h4=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:qe,_areEquals:uc,applyOperation:As,applyPatch:Zy,applyReducer:d4,deepClone:c4,getValueByPointer:jd,validate:BA,validator:Ud},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var eb=new WeakMap,g4=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),p4=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function m4(e){return eb.get(e)}function y4(e,t){return e.observers.get(t)}function b4(e,t){e.observers.delete(t.callback)}function x4(e,t){t.unobserve()}function v4(e,t){var n=[],i,r=m4(e);if(!r)r=new g4(e),eb.set(e,r);else{var o=y4(r,t);i=o&&o.observer}if(i)return i;if(i={},r.value=Fn(e),t){i.callback=t,i.next=null;var s=function(){Y0(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(s)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=n,i.object=e,i.unobserve=function(){Y0(i),clearTimeout(i.next),b4(r,i),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(t,new p4(t,i)),i}function Y0(e,t){t===void 0&&(t=!1);var n=eb.get(e.object);tb(n.value,e.object,e.patches,"",t),e.patches.length&&Zy(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function tb(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var o=W0(t),s=W0(e),a=!1,u=s.length-1;u>=0;u--){var l=s[u],c=e[l];if(q0(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null&&Array.isArray(c)===Array.isArray(f)?tb(c,f,n,i+"/"+ps(l),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+ps(l),value:Fn(c)}),n.push({op:"replace",path:i+"/"+ps(l),value:Fn(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+ps(l),value:Fn(c)}),n.push({op:"remove",path:i+"/"+ps(l)}),a=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!a&&o.length==s.length))for(var u=0;u<o.length;u++){var l=o[u];!q0(e,l)&&t[l]!==void 0&&n.push({op:"add",path:i+"/"+ps(l),value:Fn(t[l])})}}}function w4(e,t,n){n===void 0&&(n=!1);var i=[];return tb(e,t,i,"",n),i}const _4=Object.freeze(Object.defineProperty({__proto__:null,compare:w4,generate:Y0,observe:v4,unobserve:x4},Symbol.toStringTag,{value:"Module"}));Object.assign({},h4,_4,{JsonPatchError:IA,deepClone:Fn,escapePathComponent:ps,unescapePathComponent:LA});var S4=/("(?:[^\\"]|\\.)*")|[:,]/g,E4=function(t,n){var i,r,o;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,o=n.replacer,function s(a,u,l){var c,f,d,h,g,p,m,y,b,x,v,w;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),v=JSON.stringify(a,o),v===void 0)return v;if(m=r-u.length-l,v.length<=m&&(b=v.replace(S4,function(S,_){return _||S+" "}),b.length<=m))return b;if(o!=null&&(a=JSON.parse(v),o=void 0),typeof a=="object"&&a!==null){if(y=u+i,d=[],f=0,Array.isArray(a))for(x="[",c="]",m=a.length;f<m;f++)d.push(s(a[f],y,f===m-1?0:1)||"null");else for(x="{",c="}",p=Object.keys(a),m=p.length;f<m;f++)h=p[f],g=JSON.stringify(h)+": ",w=s(a[h],y,g.length+(f===m-1?0:1)),w!==void 0&&d.push(g+w);if(d.length>0)return[x,i+d.join(`,
`+y),c].join(`
`+u)}return v}(t,"",0)};const Gce=_g(E4);function En(e,t,n){return e.fields=t||[],e.fname=n,e}function He(e){return e==null?null:e.fname}function Rt(e){return e==null?null:e.fields}function jA(e){return e.length===1?k4(e[0]):$4(e)}const k4=e=>function(t){return t[e]},$4=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function R(e){throw Error(e)}function or(e){const t=[],n=e.length;let i=null,r=0,o="",s,a,u;e=e+"";function l(){t.push(o+e.substring(s,a)),o="",s=a+1}for(s=a=0;a<n;++a)if(u=e[a],u==="\\")o+=e.substring(s,a++),s=a;else if(u===i)l(),i=null,r=-1;else{if(i)continue;s===r&&u==='"'||s===r&&u==="'"?(s=a+1,i=u):u==="."&&!r?a>s?l():s=a+1:u==="["?(a>s&&l(),r=s=a+1):u==="]"&&(r||R("Access path missing open bracket: "+e),r>0&&l(),r=0,s=a+1)}return r&&R("Access path missing closing bracket: "+e),i&&R("Access path missing closing quote: "+e),a>s&&(a++,l()),t}function yn(e,t,n){const i=or(e);return e=i.length===1?i[0]:e,En((n&&n.get||jA)(i),[e],t||e)}const Bc=yn("id"),It=En(e=>e,[],"identity"),lo=En(()=>0,[],"zero"),Ou=En(()=>1,[],"one"),Gn=En(()=>!0,[],"true"),to=En(()=>!1,[],"false");function A4(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}const UA=0,nb=1,ib=2,qA=3,WA=4;function rb(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:A4,i=e||UA;return{level(r){return arguments.length?(i=+r,this):i},error(){return i>=nb&&n(t||"error","ERROR",arguments),this},warn(){return i>=ib&&n(t||"warn","WARN",arguments),this},info(){return i>=qA&&n(t||"log","INFO",arguments),this},debug(){return i>=WA&&n(t||"log","DEBUG",arguments),this}}}var z=Array.isArray;function V(e){return e===Object(e)}const k_=e=>e!=="__proto__";function Sg(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((i,r)=>{for(const o in r)if(o==="signals")i.signals=C4(i.signals,r.signals);else{const s=o==="legend"?{layout:1}:o==="style"?!0:null;jc(i,o,r[o],s)}return i},{})}function jc(e,t,n,i){if(!k_(t))return;let r,o;if(V(n)&&!z(n)){o=V(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?jc(o,r,n[r]):k_(r)&&(o[r]=n[r])}else e[t]=n}function C4(e,t){if(e==null)return t;const n={},i=[];function r(o){n[o.name]||(n[o.name]=1,i.push(o))}return t.forEach(r),e.forEach(r),i}function ye(e){return e[e.length-1]}function Dt(e){return e==null||e===""?null:+e}const HA=e=>t=>e*Math.exp(t),GA=e=>t=>Math.log(e*t),YA=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),VA=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,qd=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Eg(e,t,n,i){const r=n(e[0]),o=n(ye(e)),s=(o-r)*t;return[i(r-s),i(o-s)]}function XA(e,t){return Eg(e,t,Dt,It)}function KA(e,t){var n=Math.sign(e[0]);return Eg(e,t,GA(n),HA(n))}function JA(e,t,n){return Eg(e,t,qd(n),qd(1/n))}function QA(e,t,n){return Eg(e,t,YA(n),VA(n))}function kg(e,t,n,i,r){const o=i(e[0]),s=i(ye(e)),a=t!=null?i(t):(o+s)/2;return[r(a+(o-a)*n),r(a+(s-a)*n)]}function ob(e,t,n){return kg(e,t,n,Dt,It)}function sb(e,t,n){const i=Math.sign(e[0]);return kg(e,t,n,GA(i),HA(i))}function Wd(e,t,n,i){return kg(e,t,n,qd(i),qd(1/i))}function ab(e,t,n,i){return kg(e,t,n,YA(i),VA(i))}function ZA(e){return 1+~~(new Date(e).getMonth()/3)}function eC(e){return 1+~~(new Date(e).getUTCMonth()/3)}function H(e){return e!=null?z(e)?e:[e]:[]}function tC(e,t,n){let i=e[0],r=e[1],o;return r<i&&(o=r,r=i,i=o),o=r-i,o>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-o),i+o]}function ue(e){return typeof e=="function"}const M4="descending";function ub(e,t,n){n=n||{},t=H(t)||[];const i=[],r=[],o={},s=n.comparator||F4;return H(e).forEach((a,u)=>{a!=null&&(i.push(t[u]===M4?-1:1),r.push(a=ue(a)?a:yn(a,null,n)),(Rt(a)||[]).forEach(l=>o[l]=1))}),r.length===0?null:En(s(r,i),Object.keys(o))}const $g=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),F4=(e,t)=>e.length===1?T4(e[0],t[0]):D4(e,t,e.length),T4=(e,t)=>function(n,i){return $g(e(n),e(i))*t},D4=(e,t,n)=>(t.push(0),function(i,r){let o,s=0,a=-1;for(;s===0&&++a<n;)o=e[a],s=$g(o(i),o(r));return s*t[a]});function Bt(e){return ue(e)?e:()=>e}function lb(e,t){let n;return i=>{n&&clearTimeout(n),n=setTimeout(()=>(t(i),n=null),e)}}function ae(e){for(let t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function Ki(e,t){let n=0,i,r,o,s;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(o=s=r;n<i;++n)r=e[n],r!=null&&(r<o&&(o=r),r>s&&(s=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(o=s=r;n<i;++n)r=t(e[n]),r!=null&&(r<o&&(o=r),r>s&&(s=r))}return[o,s]}function nC(e,t){const n=e.length;let i=-1,r,o,s,a,u;if(t==null){for(;++i<n;)if(o=e[i],o!=null&&o>=o){r=s=o;break}if(i===n)return[-1,-1];for(a=u=i;++i<n;)o=e[i],o!=null&&(r>o&&(r=o,a=i),s<o&&(s=o,u=i))}else{for(;++i<n;)if(o=t(e[i],i,e),o!=null&&o>=o){r=s=o;break}if(i===n)return[-1,-1];for(a=u=i;++i<n;)o=t(e[i],i,e),o!=null&&(r>o&&(r=o,a=i),s<o&&(s=o,u=i))}return[a,u]}const N4=Object.prototype.hasOwnProperty;function ne(e,t){return N4.call(e,t)}const Nf={};function Ru(e){let t={},n;function i(o){return ne(t,o)&&t[o]!==Nf}const r={size:0,empty:0,object:t,has:i,get(o){return i(o)?t[o]:void 0},set(o,s){return i(o)||(++r.size,t[o]===Nf&&--r.empty),t[o]=s,this},delete(o){return i(o)&&(--r.size,++r.empty,t[o]=Nf),this},clear(){r.size=r.empty=0,r.object=t={}},test(o){return arguments.length?(n=o,r):n},clean(){const o={};let s=0;for(const a in t){const u=t[a];u!==Nf&&(!n||!n(u))&&(o[a]=u,++s)}r.size=s,r.empty=0,r.object=t=o}};return e&&Object.keys(e).forEach(o=>{r.set(o,e[o])}),r}function iC(e,t,n,i,r,o){if(!n&&n!==0)return o;const s=+n;let a=e[0],u=ye(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=s?i:c<=s?r:o}function U(e,t,n){const i=e.prototype=Object.create(t.prototype);return Object.defineProperty(i,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),ae(i,n)}function za(e,t,n,i){let r=t[0],o=t[t.length-1],s;return r>o&&(s=r,r=o,o=s),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=o:e<o)}function ia(e){return typeof e=="boolean"}function wo(e){return Object.prototype.toString.call(e)==="[object Date]"}function rC(e){return e&&ue(e[Symbol.iterator])}function Ae(e){return typeof e=="number"}function oC(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Y(e){return typeof e=="string"}function cb(e,t,n){e&&(e=t?H(e).map(a=>a.replace(/\\(.)/g,"$1")):H(e));const i=e&&e.length,r=n&&n.get||jA,o=a=>r(t?[a]:or(a));let s;if(!i)s=function(){return""};else if(i===1){const a=o(e[0]);s=function(u){return""+a(u)}}else{const a=e.map(o);s=function(u){let l=""+a[0](u),c=0;for(;++c<i;)l+="|"+a[c](u);return l}}return En(s,e,"key")}function sC(e,t){const n=e[0],i=ye(e),r=+t;return r?r===1?i:n+r*(i-n):n}const O4=1e4;function aC(e){e=+e||O4;let t,n,i;const r=()=>{t={},n={},i=0},o=(s,a)=>(++i>e&&(n=t,t={},i=1),t[s]=a);return r(),{clear:r,has:s=>ne(t,s)||ne(n,s),get:s=>ne(t,s)?t[s]:ne(n,s)?o(s,n[s]):void 0,set:(s,a)=>ne(t,s)?t[s]=a:o(s,a)}}function uC(e,t,n,i){const r=t.length,o=n.length;if(!o)return t;if(!r)return n;const s=i||new t.constructor(r+o);let a=0,u=0,l=0;for(;a<r&&u<o;++l)s[l]=e(t[a],n[u])>0?n[u++]:t[a++];for(;a<r;++a,++l)s[l]=t[a];for(;u<o;++u,++l)s[l]=n[u];return s}function $l(e,t){let n="";for(;--t>=0;)n+=e;return n}function lC(e,t,n,i){const r=n||" ",o=e+"",s=t-o.length;return s<=0?o:i==="left"?$l(r,s)+o:i==="center"?$l(r,~~(s/2))+o+$l(r,Math.ceil(s/2)):o+$l(r,s)}function Uc(e){return e&&ye(e)-e[0]||0}function j(e){return z(e)?"["+e.map(j)+"]":V(e)||Y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function fb(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const R4=e=>Ae(e)||wo(e)?e:Date.parse(e);function db(e,t){return t=t||R4,e==null||e===""?null:t(e)}function hb(e){return e==null||e===""?null:e+""}function vi(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function cC(e,t,n,i){const r=i??"…",o=e+"",s=o.length,a=Math.max(0,t-r.length);return s<=t?o:n==="left"?r+o.slice(s-a):n==="center"?o.slice(0,Math.ceil(a/2))+r+o.slice(s-~~(a/2)):o.slice(0,a)+r}function ro(e,t,n){if(e)if(t){const i=e.length;for(let r=0;r<i;++r){const o=t(e[r]);o&&n(o,r,e)}}else e.forEach(n)}var $_={},Em={},km=34,nl=10,$m=13;function fC(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function z4(e,t){var n=fC(e);return function(i,r){return t(n(i),r,e)}}function A_(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function sn(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function P4(e){return e<0?"-"+sn(-e,6):e>9999?"+"+sn(e,6):sn(e,4)}function L4(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":P4(e.getUTCFullYear())+"-"+sn(e.getUTCMonth()+1,2)+"-"+sn(e.getUTCDate(),2)+(r?"T"+sn(t,2)+":"+sn(n,2)+":"+sn(i,2)+"."+sn(r,3)+"Z":i?"T"+sn(t,2)+":"+sn(n,2)+":"+sn(i,2)+"Z":n||t?"T"+sn(t,2)+":"+sn(n,2)+"Z":"")}function I4(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,d){var h,g,p=r(f,function(m,y){if(h)return h(m,y-1);g=m,h=d?z4(m,d):fC(m)});return p.columns=g||[],p}function r(f,d){var h=[],g=f.length,p=0,m=0,y,b=g<=0,x=!1;f.charCodeAt(g-1)===nl&&--g,f.charCodeAt(g-1)===$m&&--g;function v(){if(b)return Em;if(x)return x=!1,$_;var S,_=p,E;if(f.charCodeAt(_)===km){for(;p++<g&&f.charCodeAt(p)!==km||f.charCodeAt(++p)===km;);return(S=p)>=g?b=!0:(E=f.charCodeAt(p++))===nl?x=!0:E===$m&&(x=!0,f.charCodeAt(p)===nl&&++p),f.slice(_+1,S-1).replace(/""/g,'"')}for(;p<g;){if((E=f.charCodeAt(S=p++))===nl)x=!0;else if(E===$m)x=!0,f.charCodeAt(p)===nl&&++p;else if(E!==n)continue;return f.slice(_,S)}return b=!0,f.slice(_,g)}for(;(y=v())!==Em;){for(var w=[];y!==$_&&y!==Em;)w.push(y),y=v();d&&(w=d(w,m++))==null||h.push(w)}return h}function o(f,d){return f.map(function(h){return d.map(function(g){return c(h[g])}).join(e)})}function s(f,d){return d==null&&(d=A_(f)),[d.map(c).join(e)].concat(o(f,d)).join(`
`)}function a(f,d){return d==null&&(d=A_(f)),o(f,d).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?L4(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:s,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function B4(e){return e}function j4(e){if(e==null)return B4;var t,n,i=e.scale[0],r=e.scale[1],o=e.translate[0],s=e.translate[1];return function(a,u){u||(t=n=0);var l=2,c=a.length,f=new Array(c);for(f[0]=(t+=a[0])*i+o,f[1]=(n+=a[1])*r+s;l<c;)f[l]=a[l],++l;return f}}function U4(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function q4(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return C_(e,n)})}:C_(e,t)}function C_(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,o=dC(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:o}:i==null?{type:"Feature",id:n,properties:r,geometry:o}:{type:"Feature",id:n,bbox:i,properties:r,geometry:o}}function dC(e,t){var n=j4(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var d=i[c<0?~c:c],h=0,g=d.length;h<g;++h)f.push(n(d[h],h));c<0&&U4(f,g)}function o(c){return n(c)}function s(c){for(var f=[],d=0,h=c.length;d<h;++d)r(c[d],f);return f.length<2&&f.push(f[0]),f}function a(c){for(var f=s(c);f.length<4;)f.push(f[0]);return f}function u(c){return c.map(a)}function l(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(l)};case"Point":d=o(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(o);break;case"LineString":d=s(c.arcs);break;case"MultiLineString":d=c.arcs.map(s);break;case"Polygon":d=u(c.arcs);break;case"MultiPolygon":d=c.arcs.map(u);break;default:return null}return{type:f,coordinates:d}}return l(t)}function W4(e,t){var n={},i={},r={},o=[],s=-1;t.forEach(function(l,c){var f=e.arcs[l<0?~l:l],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++s],t[s]=l,t[c]=d)}),t.forEach(function(l){var c=a(l),f=c[0],d=c[1],h,g;if(h=r[f])if(delete r[h.end],h.push(l),h.end=d,g=i[d]){delete i[g.start];var p=g===h?h:h.concat(g);i[p.start=h.start]=r[p.end=g.end]=p}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(l),h.start=f,g=r[f]){delete r[g.end];var m=g===h?h:g.concat(h);i[m.start=g.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[l],i[h.start=f]=r[h.end=d]=h});function a(l){var c=e.arcs[l<0?~l:l],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],l<0?[d,f]:[f,d]}function u(l,c){for(var f in l){var d=l[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),o.push(d)}}return u(r,i),u(i,r),t.forEach(function(l){n[l<0?~l:l]||o.push([l])}),o}function H4(e){return dC(e,G4.apply(this,arguments))}function G4(e,t,n){var i,r,o;if(arguments.length>1)i=Y4(e,t,n);else for(r=0,i=new Array(o=e.arcs.length);r<o;++r)i[r]=r;return{type:"MultiLineString",arcs:W4(e,i)}}function Y4(e,t,n){var i=[],r=[],o;function s(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:o})}function a(f){f.forEach(s)}function u(f){f.forEach(a)}function l(f){f.forEach(u)}function c(f){switch(o=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":a(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":l(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}function Tr(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function V4(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function qc(e){let t,n,i;e.length!==2?(t=Tr,n=(a,u)=>Tr(e(a),u),i=(a,u)=>e(a)-u):(t=e===Tr||e===V4?e:X4,n=e,i=e);function r(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){const f=r(a,u,l,c-1);return f>l&&i(a[f-1],u)>-i(a[f],u)?f-1:f}return{left:r,center:s,right:o}}function X4(){return 0}function hC(e){return e===null?NaN:+e}function*K4(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}const gC=qc(Tr),Hd=gC.right,J4=gC.left;qc(hC).center;const Wc=Hd;function Q4(e,t){let n=0,i,r=0,o=0;if(t===void 0)for(let s of e)s!=null&&(s=+s)>=s&&(i=s-r,r+=i/++n,o+=i*(s-r));else{let s=-1;for(let a of e)(a=t(a,++s,e))!=null&&(a=+a)>=a&&(i=a-r,r+=i/++n,o+=i*(a-r))}if(n>1)return o/(n-1)}function Z4(e,t){const n=Q4(e,t);return n&&Math.sqrt(n)}class Qt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const o=n[r],s=t+o,a=Math.abs(t)<Math.abs(o)?t-(s-o):o-(s-t);a&&(n[i++]=a),t=s}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n=this._n,i,r,o,s=0;if(n>0){for(s=t[--n];n>0&&(i=s,r=t[--n],s=i+r,o=r-(s-i),!o););n>0&&(o<0&&t[n-1]<0||o>0&&t[n-1]>0)&&(r=o*2,i=s+r,r==i-s&&(s=i))}return s}}class M_ extends Map{constructor(t,n=yC){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(V0(this,t))}has(t){return super.has(V0(this,t))}set(t,n){return super.set(pC(this,t),n)}delete(t){return super.delete(mC(this,t))}}class Gd extends Set{constructor(t,n=yC){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const i of t)this.add(i)}has(t){return super.has(V0(this,t))}add(t){return super.add(pC(this,t))}delete(t){return super.delete(mC(this,t))}}function V0({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function pC({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function mC({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function yC(e){return e!==null&&typeof e=="object"?e.valueOf():e}function e8(e,t){return Array.from(t,n=>e[n])}function t8(e=Tr){if(e===Tr)return bC;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const i=e(t,n);return i||i===0?i:(e(n,n)===0)-(e(t,t)===0)}}function bC(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const n8=Math.sqrt(50),i8=Math.sqrt(10),r8=Math.sqrt(2);function Yd(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),s=o>=n8?10:o>=i8?5:o>=r8?2:1;let a,u,l;return r<0?(l=Math.pow(10,-r)/s,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,r)*s,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?Yd(e,t,n*2):[a,u,l]}function X0(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,o,s]=i?Yd(t,e,n):Yd(e,t,n);if(!(o>=r))return[];const a=o-r+1,u=new Array(a);if(i)if(s<0)for(let l=0;l<a;++l)u[l]=(o-l)/-s;else for(let l=0;l<a;++l)u[l]=(o-l)*s;else if(s<0)for(let l=0;l<a;++l)u[l]=(r+l)/-s;else for(let l=0;l<a;++l)u[l]=(r+l)*s;return u}function K0(e,t,n){return t=+t,e=+e,n=+n,Yd(e,t,n)[2]}function Ao(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?K0(t,e,n):K0(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function Cs(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function J0(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function xC(e,t,n=0,i=1/0,r){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(e.length-1,i)),!(n<=t&&t<=i))return e;for(r=r===void 0?bC:t8(r);i>n;){if(i-n>600){const u=i-n+1,l=t-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),h=Math.max(n,Math.floor(t-l*f/u+d)),g=Math.min(i,Math.floor(t+(u-l)*f/u+d));xC(e,t,h,g,r)}const o=e[t];let s=n,a=i;for(il(e,n,t),r(e[i],o)>0&&il(e,n,i);s<a;){for(il(e,s,a),++s,--a;r(e[s],o)<0;)++s;for(;r(e[a],o)>0;)--a}r(e[n],o)===0?il(e,n,a):(++a,il(e,a,i)),a<=t&&(n=a+1),t<=a&&(i=a-1)}return e}function il(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Q0(e,t,n){if(e=Float64Array.from(K4(e,n)),!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return J0(e);if(t>=1)return Cs(e);var i,r=(i-1)*t,o=Math.floor(r),s=Cs(xC(e,o).subarray(0,o+1)),a=J0(e.subarray(o+1));return s+(a-s)*(r-o)}}function vC(e,t,n=hC){if(!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,o=Math.floor(r),s=+n(e[o],o,e),a=+n(e[o+1],o+1,e);return s+(a-s)*(r-o)}}function o8(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(o=+o)>=o&&(++n,i+=o)}if(n)return i/n}function wC(e,t){return Q0(e,.5,t)}function*s8(e){for(const t of e)yield*t}function _C(e){return Array.from(s8(e))}function Tn(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(r);++i<r;)o[i]=e+i*n;return o}function SC(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function a8(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Vd(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Qa(e){return e=Vd(Math.abs(e)),e?e[1]:NaN}function u8(e,t){return function(n,i){for(var r=n.length,o=[],s=0,a=e[0],u=0;r>0&&a>0&&(u+a+1>i&&(a=Math.max(1,i-u)),o.push(n.substring(r-=a,r+a)),!((u+=a+1)>i));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function l8(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var c8=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function lc(e){if(!(t=c8.exec(e)))throw new Error("invalid format: "+e);var t;return new gb({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}lc.prototype=gb.prototype;function gb(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}gb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function f8(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var EC;function d8(e,t){var n=Vd(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(EC=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Vd(e,Math.max(0,t+o-1))[0]}function F_(e,t){var n=Vd(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const T_={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:a8,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>F_(e*100,t),r:F_,s:d8,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function D_(e){return e}var N_=Array.prototype.map,O_=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function kC(e){var t=e.grouping===void 0||e.thousands===void 0?D_:u8(N_.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?D_:l8(N_.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=lc(f);var d=f.fill,h=f.align,g=f.sign,p=f.symbol,m=f.zero,y=f.width,b=f.comma,x=f.precision,v=f.trim,w=f.type;w==="n"?(b=!0,w="g"):T_[w]||(x===void 0&&(x=12),v=!0,w="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var S=p==="$"?n:p==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",_=p==="$"?i:/[%p]/.test(w)?s:"",E=T_[w],A=/[defgprs%]/.test(w);x=x===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function k($){var D=S,M=_,F,C,O;if(w==="c")M=E($)+M,$="";else{$=+$;var q=$<0||1/$<0;if($=isNaN($)?u:E(Math.abs($),x),v&&($=f8($)),q&&+$==0&&g!=="+"&&(q=!1),D=(q?g==="("?g:a:g==="-"||g==="("?"":g)+D,M=(w==="s"?O_[8+EC/3]:"")+M+(q&&g==="("?")":""),A){for(F=-1,C=$.length;++F<C;)if(O=$.charCodeAt(F),48>O||O>57){M=(O===46?r+$.slice(F+1):$.slice(F))+M,$=$.slice(0,F);break}}}b&&!m&&($=t($,1/0));var G=D.length+$.length+M.length,K=G<y?new Array(y-G+1).join(d):"";switch(b&&m&&($=t(K+$,K.length?y-M.length:1/0),K=""),h){case"<":$=D+$+M+K;break;case"=":$=D+K+$+M;break;case"^":$=K.slice(0,G=K.length>>1)+D+$+M+K.slice(G);break;default:$=K+D+$+M;break}return o($)}return k.toString=function(){return f+""},k}function c(f,d){var h=l((f=lc(f),f.type="f",f)),g=Math.max(-8,Math.min(8,Math.floor(Qa(d)/3)))*3,p=Math.pow(10,-g),m=O_[8+g/3];return function(y){return h(p*y)+m}}return{format:l,formatPrefix:c}}var Of,$C,AC;h8({thousands:",",grouping:[3],currency:["$",""]});function h8(e){return Of=kC(e),$C=Of.format,AC=Of.formatPrefix,Of}function g8(e){return Math.max(0,-Qa(Math.abs(e)))}function p8(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qa(t)/3)))*3-Qa(Math.abs(e)))}function m8(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Qa(t)-Qa(e))+1}const Am=new Date,Cm=new Date;function it(e,t,n,i){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=o=>(e(o=new Date(+o)),o),r.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),r.round=o=>{const s=r(o),a=r.ceil(o);return o-s<a-o?s:a},r.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),r.range=(o,s,a)=>{const u=[];if(o=r.ceil(o),a=a==null?1:Math.floor(a),!(o<s)||!(a>0))return u;let l;do u.push(l=new Date(+o)),t(o,a),e(o);while(l<o&&o<s);return u},r.filter=o=>it(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;t(s,-1),!o(s););else for(;--a>=0;)for(;t(s,1),!o(s););}),n&&(r.count=(o,s)=>(Am.setTime(+o),Cm.setTime(+s),e(Am),e(Cm),Math.floor(n(Am,Cm))),r.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(i?s=>i(s)%o===0:s=>r.count(0,s)%o===0):r)),r}const Za=it(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Za.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?it(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):Za);Za.range;const kr=1e3,Bn=kr*60,$r=Bn*60,Lr=$r*24,pb=Lr*7,R_=Lr*30,Mm=Lr*365,Ar=it(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*kr)},(e,t)=>(t-e)/kr,e=>e.getUTCSeconds());Ar.range;const Ag=it(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*kr)},(e,t)=>{e.setTime(+e+t*Bn)},(e,t)=>(t-e)/Bn,e=>e.getMinutes());Ag.range;const Cg=it(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Bn)},(e,t)=>(t-e)/Bn,e=>e.getUTCMinutes());Cg.range;const Mg=it(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*kr-e.getMinutes()*Bn)},(e,t)=>{e.setTime(+e+t*$r)},(e,t)=>(t-e)/$r,e=>e.getHours());Mg.range;const Fg=it(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*$r)},(e,t)=>(t-e)/$r,e=>e.getUTCHours());Fg.range;const Dr=it(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Bn)/Lr,e=>e.getDate()-1);Dr.range;const _o=it(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Lr,e=>e.getUTCDate()-1);_o.range;const CC=it(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Lr,e=>Math.floor(e/Lr));CC.range;function ra(e){return it(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Bn)/pb)}const zu=ra(0),Xd=ra(1),y8=ra(2),b8=ra(3),eu=ra(4),x8=ra(5),v8=ra(6);zu.range;Xd.range;y8.range;b8.range;eu.range;x8.range;v8.range;function oa(e){return it(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/pb)}const Pu=oa(0),Kd=oa(1),w8=oa(2),_8=oa(3),tu=oa(4),S8=oa(5),E8=oa(6);Pu.range;Kd.range;w8.range;_8.range;tu.range;S8.range;E8.range;const cc=it(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());cc.range;const fc=it(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());fc.range;const Ji=it(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Ji.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:it(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Ji.range;const Qi=it(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Qi.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:it(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Qi.range;function MC(e,t,n,i,r,o){const s=[[Ar,1,kr],[Ar,5,5*kr],[Ar,15,15*kr],[Ar,30,30*kr],[o,1,Bn],[o,5,5*Bn],[o,15,15*Bn],[o,30,30*Bn],[r,1,$r],[r,3,3*$r],[r,6,6*$r],[r,12,12*$r],[i,1,Lr],[i,2,2*Lr],[n,1,pb],[t,1,R_],[t,3,3*R_],[e,1,Mm]];function a(l,c,f){const d=c<l;d&&([l,c]=[c,l]);const h=f&&typeof f.range=="function"?f:u(l,c,f),g=h?h.range(l,+c+1):[];return d?g.reverse():g}function u(l,c,f){const d=Math.abs(c-l)/f,h=qc(([,,m])=>m).right(s,d);if(h===s.length)return e.every(Ao(l/Mm,c/Mm,f));if(h===0)return Za.every(Math.max(Ao(l,c,f),1));const[g,p]=s[d/s[h-1][2]<s[h][2]/d?h-1:h];return g.every(p)}return[a,u]}const[k8,$8]=MC(Qi,fc,Pu,CC,Fg,Cg),[A8,C8]=MC(Ji,cc,zu,Dr,Mg,Ag),vt="year",bn="quarter",zt="month",et="week",xn="date",Tt="day",Zi="dayofyear",Nn="hours",On="minutes",Yn="seconds",wi="milliseconds",mb=[vt,bn,zt,et,xn,Tt,Zi,Nn,On,Yn,wi],Fm=mb.reduce((e,t,n)=>(e[t]=1+n,e),{});function yb(e){const t=H(e).slice(),n={};return t.length||R("Missing time unit."),t.forEach(r=>{ne(Fm,r)?n[r]=1:R(`Invalid time unit: ${r}.`)}),(n[et]||n[Tt]?1:0)+(n[bn]||n[zt]||n[xn]?1:0)+(n[Zi]?1:0)>1&&R(`Incompatible time units: ${e}`),t.sort((r,o)=>Fm[r]-Fm[o]),t}const M8={[vt]:"%Y ",[bn]:"Q%q ",[zt]:"%b ",[xn]:"%d ",[et]:"W%U ",[Tt]:"%a ",[Zi]:"%j ",[Nn]:"%H:00",[On]:"00:%M",[Yn]:":%S",[wi]:".%L",[`${vt}-${zt}`]:"%Y-%m ",[`${vt}-${zt}-${xn}`]:"%Y-%m-%d ",[`${Nn}-${On}`]:"%H:%M"};function FC(e,t){const n=ae({},M8,t),i=yb(e),r=i.length;let o="",s=0,a,u;for(s=0;s<r;)for(a=i.length;a>s;--a)if(u=i.slice(s,a).join("-"),n[u]!=null){o+=n[u],s=a;break}return o.trim()}const bs=new Date;function bb(e){return bs.setFullYear(e),bs.setMonth(0),bs.setDate(1),bs.setHours(0,0,0,0),bs}function TC(e){return NC(new Date(e))}function DC(e){return Z0(new Date(e))}function NC(e){return Dr.count(bb(e.getFullYear())-1,e)}function Z0(e){return zu.count(bb(e.getFullYear())-1,e)}function e1(e){return bb(e).getDay()}function F8(e,t,n,i,r,o,s){if(0<=e&&e<100){const a=new Date(-1,t,n,i,r,o,s);return a.setFullYear(e),a}return new Date(e,t,n,i,r,o,s)}function OC(e){return zC(new Date(e))}function RC(e){return t1(new Date(e))}function zC(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return _o.count(t-1,e)}function t1(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Pu.count(t-1,e)}function n1(e){return bs.setTime(Date.UTC(e,0,1)),bs.getUTCDay()}function T8(e,t,n,i,r,o,s){if(0<=e&&e<100){const a=new Date(Date.UTC(-1,t,n,i,r,o,s));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(e,t,n,i,r,o,s))}function PC(e,t,n,i,r){const o=t||1,s=ye(e),a=(y,b,x)=>(x=x||y,D8(n[x],i[x],y===s&&o,b)),u=new Date,l=vi(e),c=l[vt]?a(vt):Bt(2012),f=l[zt]?a(zt):l[bn]?a(bn):lo,d=l[et]&&l[Tt]?a(Tt,1,et+Tt):l[et]?a(et,1):l[Tt]?a(Tt,1):l[xn]?a(xn,1):l[Zi]?a(Zi,1):Ou,h=l[Nn]?a(Nn):lo,g=l[On]?a(On):lo,p=l[Yn]?a(Yn):lo,m=l[wi]?a(wi):lo;return function(y){u.setTime(+y);const b=c(u);return r(b,f(u),d(u,b),h(u),g(u),p(u),m(u))}}function D8(e,t,n,i){const r=n<=1?e:i?(o,s)=>i+n*Math.floor((e(o,s)-i)/n):(o,s)=>n*Math.floor(e(o,s)/n);return t?(o,s)=>t(r(o,s),s):r}function nu(e,t,n){return t+e*7-(n+6)%7}const N8={[vt]:e=>e.getFullYear(),[bn]:e=>Math.floor(e.getMonth()/3),[zt]:e=>e.getMonth(),[xn]:e=>e.getDate(),[Nn]:e=>e.getHours(),[On]:e=>e.getMinutes(),[Yn]:e=>e.getSeconds(),[wi]:e=>e.getMilliseconds(),[Zi]:e=>NC(e),[et]:e=>Z0(e),[et+Tt]:(e,t)=>nu(Z0(e),e.getDay(),e1(t)),[Tt]:(e,t)=>nu(1,e.getDay(),e1(t))},O8={[bn]:e=>3*e,[et]:(e,t)=>nu(e,0,e1(t))};function LC(e,t){return PC(e,t||1,N8,O8,F8)}const R8={[vt]:e=>e.getUTCFullYear(),[bn]:e=>Math.floor(e.getUTCMonth()/3),[zt]:e=>e.getUTCMonth(),[xn]:e=>e.getUTCDate(),[Nn]:e=>e.getUTCHours(),[On]:e=>e.getUTCMinutes(),[Yn]:e=>e.getUTCSeconds(),[wi]:e=>e.getUTCMilliseconds(),[Zi]:e=>zC(e),[et]:e=>t1(e),[Tt]:(e,t)=>nu(1,e.getUTCDay(),n1(t)),[et+Tt]:(e,t)=>nu(t1(e),e.getUTCDay(),n1(t))},z8={[bn]:e=>3*e,[et]:(e,t)=>nu(e,0,n1(t))};function IC(e,t){return PC(e,t||1,R8,z8,T8)}const P8={[vt]:Ji,[bn]:cc.every(3),[zt]:cc,[et]:zu,[xn]:Dr,[Tt]:Dr,[Zi]:Dr,[Nn]:Mg,[On]:Ag,[Yn]:Ar,[wi]:Za},L8={[vt]:Qi,[bn]:fc.every(3),[zt]:fc,[et]:Pu,[xn]:_o,[Tt]:_o,[Zi]:_o,[Nn]:Fg,[On]:Cg,[Yn]:Ar,[wi]:Za};function Lu(e){return P8[e]}function Iu(e){return L8[e]}function BC(e,t,n){return e?e.offset(t,n):void 0}function jC(e,t,n){return BC(Lu(e),t,n)}function UC(e,t,n){return BC(Iu(e),t,n)}function qC(e,t,n,i){return e?e.range(t,n,i):void 0}function WC(e,t,n,i){return qC(Lu(e),t,n,i)}function HC(e,t,n,i){return qC(Iu(e),t,n,i)}const Al=1e3,Cl=Al*60,Ml=Cl*60,Tg=Ml*24,I8=Tg*7,z_=Tg*30,i1=Tg*365,GC=[vt,zt,xn,Nn,On,Yn,wi],Fl=GC.slice(0,-1),Tl=Fl.slice(0,-1),Dl=Tl.slice(0,-1),B8=Dl.slice(0,-1),j8=[vt,et],P_=[vt,zt],YC=[vt],rl=[[Fl,1,Al],[Fl,5,5*Al],[Fl,15,15*Al],[Fl,30,30*Al],[Tl,1,Cl],[Tl,5,5*Cl],[Tl,15,15*Cl],[Tl,30,30*Cl],[Dl,1,Ml],[Dl,3,3*Ml],[Dl,6,6*Ml],[Dl,12,12*Ml],[B8,1,Tg],[j8,1,I8],[P_,1,z_],[P_,3,3*z_],[YC,1,i1]];function VC(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(Uc(t))/n;let r=qc(a=>a[2]).right(rl,i),o,s;return r===rl.length?(o=YC,s=Ao(t[0]/i1,t[1]/i1,n)):r?(r=rl[i/rl[r-1][2]<rl[r][2]/i?r-1:r],o=r[0],s=r[1]):(o=GC,s=Math.max(Ao(t[0],t[1],n),1)),{units:o,step:s}}function Tm(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Dm(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ol(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function XC(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,o=e.days,s=e.shortDays,a=e.months,u=e.shortMonths,l=sl(r),c=al(r),f=sl(o),d=al(o),h=sl(s),g=al(s),p=sl(a),m=al(a),y=sl(u),b=al(u),x={a:q,A:G,b:K,B:ce,c:null,d:q_,e:q_,f:cz,g:vz,G:_z,H:az,I:uz,j:lz,L:KC,m:fz,M:dz,p:Be,q:Qe,Q:G_,s:Y_,S:hz,u:gz,U:pz,V:mz,w:yz,W:bz,x:null,X:null,y:xz,Y:wz,Z:Sz,"%":H_},v={a:ot,A:jt,b:Xe,B:Zr,c:null,d:W_,e:W_,f:Az,g:Pz,G:Iz,H:Ez,I:kz,j:$z,L:QC,m:Cz,M:Mz,p:va,q:is,Q:G_,s:Y_,S:Fz,u:Tz,U:Dz,V:Nz,w:Oz,W:Rz,x:null,X:null,y:zz,Y:Lz,Z:Bz,"%":H_},w={a:k,A:$,b:D,B:M,c:F,d:j_,e:j_,f:iz,g:B_,G:I_,H:U_,I:U_,j:Z8,L:nz,m:Q8,M:ez,p:A,q:J8,Q:oz,s:sz,S:tz,u:G8,U:Y8,V:V8,w:H8,W:X8,x:C,X:O,y:B_,Y:I_,Z:K8,"%":rz};x.x=S(n,x),x.X=S(i,x),x.c=S(t,x),v.x=S(n,v),v.X=S(i,v),v.c=S(t,v);function S(X,le){return function(de){var B=[],mt=-1,_e=0,kt=X.length,Ut,rs,S_;for(de instanceof Date||(de=new Date(+de));++mt<kt;)X.charCodeAt(mt)===37&&(B.push(X.slice(_e,mt)),(rs=L_[Ut=X.charAt(++mt)])!=null?Ut=X.charAt(++mt):rs=Ut==="e"?" ":"0",(S_=le[Ut])&&(Ut=S_(de,rs)),B.push(Ut),_e=mt+1);return B.push(X.slice(_e,mt)),B.join("")}}function _(X,le){return function(de){var B=ol(1900,void 0,1),mt=E(B,X,de+="",0),_e,kt;if(mt!=de.length)return null;if("Q"in B)return new Date(B.Q);if("s"in B)return new Date(B.s*1e3+("L"in B?B.L:0));if(le&&!("Z"in B)&&(B.Z=0),"p"in B&&(B.H=B.H%12+B.p*12),B.m===void 0&&(B.m="q"in B?B.q:0),"V"in B){if(B.V<1||B.V>53)return null;"w"in B||(B.w=1),"Z"in B?(_e=Dm(ol(B.y,0,1)),kt=_e.getUTCDay(),_e=kt>4||kt===0?Kd.ceil(_e):Kd(_e),_e=_o.offset(_e,(B.V-1)*7),B.y=_e.getUTCFullYear(),B.m=_e.getUTCMonth(),B.d=_e.getUTCDate()+(B.w+6)%7):(_e=Tm(ol(B.y,0,1)),kt=_e.getDay(),_e=kt>4||kt===0?Xd.ceil(_e):Xd(_e),_e=Dr.offset(_e,(B.V-1)*7),B.y=_e.getFullYear(),B.m=_e.getMonth(),B.d=_e.getDate()+(B.w+6)%7)}else("W"in B||"U"in B)&&("w"in B||(B.w="u"in B?B.u%7:"W"in B?1:0),kt="Z"in B?Dm(ol(B.y,0,1)).getUTCDay():Tm(ol(B.y,0,1)).getDay(),B.m=0,B.d="W"in B?(B.w+6)%7+B.W*7-(kt+5)%7:B.w+B.U*7-(kt+6)%7);return"Z"in B?(B.H+=B.Z/100|0,B.M+=B.Z%100,Dm(B)):Tm(B)}}function E(X,le,de,B){for(var mt=0,_e=le.length,kt=de.length,Ut,rs;mt<_e;){if(B>=kt)return-1;if(Ut=le.charCodeAt(mt++),Ut===37){if(Ut=le.charAt(mt++),rs=w[Ut in L_?le.charAt(mt++):Ut],!rs||(B=rs(X,de,B))<0)return-1}else if(Ut!=de.charCodeAt(B++))return-1}return B}function A(X,le,de){var B=l.exec(le.slice(de));return B?(X.p=c.get(B[0].toLowerCase()),de+B[0].length):-1}function k(X,le,de){var B=h.exec(le.slice(de));return B?(X.w=g.get(B[0].toLowerCase()),de+B[0].length):-1}function $(X,le,de){var B=f.exec(le.slice(de));return B?(X.w=d.get(B[0].toLowerCase()),de+B[0].length):-1}function D(X,le,de){var B=y.exec(le.slice(de));return B?(X.m=b.get(B[0].toLowerCase()),de+B[0].length):-1}function M(X,le,de){var B=p.exec(le.slice(de));return B?(X.m=m.get(B[0].toLowerCase()),de+B[0].length):-1}function F(X,le,de){return E(X,t,le,de)}function C(X,le,de){return E(X,n,le,de)}function O(X,le,de){return E(X,i,le,de)}function q(X){return s[X.getDay()]}function G(X){return o[X.getDay()]}function K(X){return u[X.getMonth()]}function ce(X){return a[X.getMonth()]}function Be(X){return r[+(X.getHours()>=12)]}function Qe(X){return 1+~~(X.getMonth()/3)}function ot(X){return s[X.getUTCDay()]}function jt(X){return o[X.getUTCDay()]}function Xe(X){return u[X.getUTCMonth()]}function Zr(X){return a[X.getUTCMonth()]}function va(X){return r[+(X.getUTCHours()>=12)]}function is(X){return 1+~~(X.getUTCMonth()/3)}return{format:function(X){var le=S(X+="",x);return le.toString=function(){return X},le},parse:function(X){var le=_(X+="",!1);return le.toString=function(){return X},le},utcFormat:function(X){var le=S(X+="",v);return le.toString=function(){return X},le},utcParse:function(X){var le=_(X+="",!0);return le.toString=function(){return X},le}}}var L_={"-":"",_:" ",0:"0"},pt=/^\s*\d+/,U8=/^%/,q8=/[\\^$*+?|[\]().{}]/g;function ve(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",o=r.length;return i+(o<n?new Array(n-o+1).join(t)+r:r)}function W8(e){return e.replace(q8,"\\$&")}function sl(e){return new RegExp("^(?:"+e.map(W8).join("|")+")","i")}function al(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function H8(e,t,n){var i=pt.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function G8(e,t,n){var i=pt.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function Y8(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function V8(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function X8(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function I_(e,t,n){var i=pt.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function B_(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function K8(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function J8(e,t,n){var i=pt.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function Q8(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function j_(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function Z8(e,t,n){var i=pt.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function U_(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function ez(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function tz(e,t,n){var i=pt.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function nz(e,t,n){var i=pt.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function iz(e,t,n){var i=pt.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function rz(e,t,n){var i=U8.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function oz(e,t,n){var i=pt.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function sz(e,t,n){var i=pt.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function q_(e,t){return ve(e.getDate(),t,2)}function az(e,t){return ve(e.getHours(),t,2)}function uz(e,t){return ve(e.getHours()%12||12,t,2)}function lz(e,t){return ve(1+Dr.count(Ji(e),e),t,3)}function KC(e,t){return ve(e.getMilliseconds(),t,3)}function cz(e,t){return KC(e,t)+"000"}function fz(e,t){return ve(e.getMonth()+1,t,2)}function dz(e,t){return ve(e.getMinutes(),t,2)}function hz(e,t){return ve(e.getSeconds(),t,2)}function gz(e){var t=e.getDay();return t===0?7:t}function pz(e,t){return ve(zu.count(Ji(e)-1,e),t,2)}function JC(e){var t=e.getDay();return t>=4||t===0?eu(e):eu.ceil(e)}function mz(e,t){return e=JC(e),ve(eu.count(Ji(e),e)+(Ji(e).getDay()===4),t,2)}function yz(e){return e.getDay()}function bz(e,t){return ve(Xd.count(Ji(e)-1,e),t,2)}function xz(e,t){return ve(e.getFullYear()%100,t,2)}function vz(e,t){return e=JC(e),ve(e.getFullYear()%100,t,2)}function wz(e,t){return ve(e.getFullYear()%1e4,t,4)}function _z(e,t){var n=e.getDay();return e=n>=4||n===0?eu(e):eu.ceil(e),ve(e.getFullYear()%1e4,t,4)}function Sz(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ve(t/60|0,"0",2)+ve(t%60,"0",2)}function W_(e,t){return ve(e.getUTCDate(),t,2)}function Ez(e,t){return ve(e.getUTCHours(),t,2)}function kz(e,t){return ve(e.getUTCHours()%12||12,t,2)}function $z(e,t){return ve(1+_o.count(Qi(e),e),t,3)}function QC(e,t){return ve(e.getUTCMilliseconds(),t,3)}function Az(e,t){return QC(e,t)+"000"}function Cz(e,t){return ve(e.getUTCMonth()+1,t,2)}function Mz(e,t){return ve(e.getUTCMinutes(),t,2)}function Fz(e,t){return ve(e.getUTCSeconds(),t,2)}function Tz(e){var t=e.getUTCDay();return t===0?7:t}function Dz(e,t){return ve(Pu.count(Qi(e)-1,e),t,2)}function ZC(e){var t=e.getUTCDay();return t>=4||t===0?tu(e):tu.ceil(e)}function Nz(e,t){return e=ZC(e),ve(tu.count(Qi(e),e)+(Qi(e).getUTCDay()===4),t,2)}function Oz(e){return e.getUTCDay()}function Rz(e,t){return ve(Kd.count(Qi(e)-1,e),t,2)}function zz(e,t){return ve(e.getUTCFullYear()%100,t,2)}function Pz(e,t){return e=ZC(e),ve(e.getUTCFullYear()%100,t,2)}function Lz(e,t){return ve(e.getUTCFullYear()%1e4,t,4)}function Iz(e,t){var n=e.getUTCDay();return e=n>=4||n===0?tu(e):tu.ceil(e),ve(e.getUTCFullYear()%1e4,t,4)}function Bz(){return"+0000"}function H_(){return"%"}function G_(e){return+e}function Y_(e){return Math.floor(+e/1e3)}var wa,xb,eM,vb,tM;jz({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function jz(e){return wa=XC(e),xb=wa.format,eM=wa.parse,vb=wa.utcFormat,tM=wa.utcParse,wa}function Nl(e){const t={};return n=>t[n]||(t[n]=e(n))}function Uz(e,t){return n=>{const i=e(n),r=i.indexOf(t);if(r<0)return i;let o=qz(i,r);const s=o<i.length?i.slice(o):"";for(;--o>r;)if(i[o]!=="0"){++o;break}return i.slice(0,o)+s}}function qz(e,t){let n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function nM(e){const t=Nl(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){const r=lc(i||",");if(r.precision==null){switch(r.precision=12,r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return Uz(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,o,s){s=lc(s??",f");const a=Ao(i,r,o),u=Math.max(Math.abs(i),Math.abs(r));let l;if(s.precision==null)switch(s.type){case"s":return isNaN(l=p8(a,u))||(s.precision=l),n(s,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=m8(a,u))||(s.precision=l-(s.type==="e"));break}case"f":case"%":{isNaN(l=g8(a))||(s.precision=l-(s.type==="%")*2);break}}return t(s)}}}let r1;iM();function iM(){return r1=nM({format:$C,formatPrefix:AC})}function rM(e){return nM(kC(e))}function Jd(e){return arguments.length?r1=rM(e):r1}function V_(e,t,n){n=n||{},V(n)||R(`Invalid time multi-format specifier: ${n}`);const i=t(Yn),r=t(On),o=t(Nn),s=t(xn),a=t(et),u=t(zt),l=t(bn),c=t(vt),f=e(n[wi]||".%L"),d=e(n[Yn]||":%S"),h=e(n[On]||"%I:%M"),g=e(n[Nn]||"%I %p"),p=e(n[xn]||n[Tt]||"%a %d"),m=e(n[et]||"%b %d"),y=e(n[zt]||"%B"),b=e(n[bn]||"%B"),x=e(n[vt]||"%Y");return v=>(i(v)<v?f:r(v)<v?d:o(v)<v?h:s(v)<v?g:u(v)<v?a(v)<v?p:m:c(v)<v?l(v)<v?y:b:x)(v)}function oM(e){const t=Nl(e.format),n=Nl(e.utcFormat);return{timeFormat:i=>Y(i)?t(i):V_(t,Lu,i),utcFormat:i=>Y(i)?n(i):V_(n,Iu,i),timeParse:Nl(e.parse),utcParse:Nl(e.utcParse)}}let o1;sM();function sM(){return o1=oM({format:xb,parse:eM,utcFormat:vb,utcParse:tM})}function aM(e){return oM(XC(e))}function dc(e){return arguments.length?o1=aM(e):o1}const s1=(e,t)=>ae({},e,t);function uM(e,t){const n=e?rM(e):Jd(),i=t?aM(t):dc();return s1(n,i)}function wb(e,t){const n=arguments.length;return n&&n!==2&&R("defaultLocale expects either zero or two arguments."),n?s1(Jd(e),dc(t)):s1(Jd(),dc())}function Wz(){return iM(),sM(),wb()}const Hz=/^(data:|([A-Za-z]+:)?\/\/)/,Gz=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Yz=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,X_="file://";function Vz(e,t){return n=>({options:n||{},sanitize:Kz,load:Xz,fileAccess:!!t,file:Jz(t),http:Zz(e)})}async function Xz(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function Kz(e,t){t=ae({},this.options,t);const n=this.fileAccess,i={href:null};let r,o,s;const a=Gz.test(e.replace(Yz,""));(e==null||typeof e!="string"||!a)&&R("Sanitize failure, invalid URI: "+j(e));const u=Hz.test(e);return(s=t.baseURL)&&!u&&(!e.startsWith("/")&&!s.endsWith("/")&&(e="/"+e),e=s+e),o=(r=e.startsWith(X_))||t.mode==="file"||t.mode!=="http"&&!u&&n,r?e=e.slice(X_.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),o=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!o}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function Jz(e){return e?t=>new Promise((n,i)=>{e.readFile(t,(r,o)=>{r?i(r):n(o)})}):Qz}async function Qz(){R("No file system access.")}function Zz(e){return e?async function(t,n){const i=ae({},this.options.http,n),r=n&&n.response,o=await e(t,i);return o.ok?ue(o[r])?o[r]():o.text():R(o.status+""+o.statusText)}:eP}async function eP(){R("No HTTP fetch method available.")}const tP=e=>e!=null&&e===e,nP=e=>e==="true"||e==="false"||e===!0||e===!1,iP=e=>!Number.isNaN(Date.parse(e)),lM=e=>!Number.isNaN(+e)&&!(e instanceof Date),rP=e=>lM(e)&&Number.isInteger(+e),a1={boolean:fb,integer:Dt,number:Dt,date:db,string:hb,unknown:It},Rf=[nP,rP,lM,iP],oP=["boolean","integer","number","date"];function cM(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=Rf.length,r=Rf.map((o,s)=>s+1);for(let o=0,s=0,a,u;o<n;++o)for(u=t?e[o][t]:e[o],a=0;a<i;++a)if(r[a]&&tP(u)&&!Rf[a](u)&&(r[a]=0,++s,s===Rf.length))return"string";return oP[r.reduce((o,s)=>o===0?s:o,0)-1]}function fM(e,t){return t.reduce((n,i)=>(n[i]=cM(e,i),n),{})}function K_(e){const t=function(n,i){const r={delimiter:e};return _b(n,i?ae(i,r):r)};return t.responseType="text",t}function _b(e,t){return t.header&&(e=t.header.map(j).join(t.delimiter)+`
`+e),I4(t.delimiter).parse(e+"")}_b.responseType="text";function sP(e){return typeof Buffer=="function"&&ue(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function Sb(e,t){const n=t&&t.property?yn(t.property):It;return V(e)&&!sP(e)?aP(n(e),t):n(JSON.parse(e))}Sb.responseType="json";function aP(e,t){return!z(e)&&rC(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const uP={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function dM(e,t){let n,i,r,o;return e=Sb(e,t),t&&t.feature?(n=q4,r=t.feature):t&&t.mesh?(n=H4,r=t.mesh,o=uP[t.filter]):R("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,o):R("Invalid TopoJSON object: "+r),i&&i.features||[i]}dM.responseType="json";const yd={dsv:_b,csv:K_(","),tsv:K_("	"),json:Sb,topojson:dM};function Eb(e,t){return arguments.length>1?(yd[e]=t,this):ne(yd,e)?yd[e]:null}function hM(e){const t=Eb(e);return t&&t.responseType||"text"}function gM(e,t,n,i){t=t||{};const r=Eb(t.type||"json");return r||R("Unknown data format type: "+t.type),e=r(e,t),t.parse&&lP(e,t.parse,n,i),ne(e,"columns")&&delete e.columns,e}function lP(e,t,n,i){if(!e.length)return;const r=dc();n=n||r.timeParse,i=i||r.utcParse;let o=e.columns||Object.keys(e[0]),s,a,u,l,c,f;t==="auto"&&(t=fM(e,o)),o=Object.keys(t);const d=o.map(h=>{const g=t[h];let p,m;if(g&&(g.startsWith("date:")||g.startsWith("utc:")))return p=g.split(/:(.+)?/,2),m=p[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(p[0]==="utc"?i:n)(m);if(!a1[g])throw Error("Illegal format pattern: "+h+":"+g);return a1[g]});for(u=0,c=e.length,f=o.length;u<c;++u)for(s=e[u],l=0;l<f;++l)a=o[l],s[a]=d[l](s[a])}const Dg=Vz(typeof fetch<"u"&&fetch,null);function Ng(e){const t=e||It,n=[],i={};return n.add=r=>{const o=t(r);return i[o]||(i[o]=1,n.push(r)),n},n.remove=r=>{const o=t(r);if(i[o]){i[o]=0;const s=n.indexOf(r);s>=0&&n.splice(s,1)}return n},n}async function bd(e,t){try{await t(e)}catch(n){e.error(n)}}const pM=Symbol("vega_id");let cP=1;function Og(e){return!!(e&&ee(e))}function ee(e){return e[pM]}function mM(e,t){return e[pM]=t,e}function Se(e){const t=e===Object(e)?e:{data:e};return ee(t)?t:mM(t,cP++)}function kb(e){return Rg(e,Se({}))}function Rg(e,t){for(const n in e)t[n]=e[n];return t}function yM(e,t){return mM(t,ee(e))}function sa(e,t){return e?t?(n,i)=>e(n,i)||ee(t(n))-ee(t(i)):(n,i)=>e(n,i)||ee(n)-ee(i):null}function bM(e){return e&&e.constructor===aa}function aa(){const e=[],t=[],n=[],i=[],r=[];let o=null,s=!1;return{constructor:aa,insert(a){const u=H(a),l=u.length;for(let c=0;c<l;++c)e.push(u[c]);return this},remove(a){const u=ue(a)?i:t,l=H(a),c=l.length;for(let f=0;f<c;++f)u.push(l[f]);return this},modify(a,u,l){const c={field:u,value:Bt(l)};return ue(a)?(c.filter=a,r.push(c)):(c.tuple=a,n.push(c)),this},encode(a,u){return ue(a)?r.push({filter:a,field:u}):n.push({tuple:a,field:u}),this},clean(a){return o=a,this},reflow(){return s=!0,this},pulse(a,u){const l={},c={};let f,d,h,g,p,m;for(f=0,d=u.length;f<d;++f)l[ee(u[f])]=1;for(f=0,d=t.length;f<d;++f)p=t[f],l[ee(p)]=-1;for(f=0,d=i.length;f<d;++f)g=i[f],u.forEach(b=>{g(b)&&(l[ee(b)]=-1)});for(f=0,d=e.length;f<d;++f)p=e[f],m=ee(p),l[m]?l[m]=1:a.add.push(Se(e[f]));for(f=0,d=u.length;f<d;++f)p=u[f],l[ee(p)]<0&&a.rem.push(p);function y(b,x,v){v?b[x]=v(b):a.encode=x,s||(c[ee(b)]=b)}for(f=0,d=n.length;f<d;++f)h=n[f],p=h.tuple,g=h.field,m=l[ee(p)],m>0&&(y(p,g,h.value),a.modifies(g));for(f=0,d=r.length;f<d;++f)h=r[f],g=h.filter,u.forEach(b=>{g(b)&&l[ee(b)]>0&&y(b,h.field,h.value)}),a.modifies(h.field);if(s)a.mod=t.length||i.length?u.filter(b=>l[ee(b)]>0):u.slice();else for(m in c)a.mod.push(c[m]);return(o||o==null&&(t.length||i.length))&&a.clean(!0),a}}}const xd="_:mod:_";function zg(){Object.defineProperty(this,xd,{writable:!0,value:{}})}zg.prototype={set(e,t,n,i){const r=this,o=r[e],s=r[xd];return t!=null&&t>=0?(o[t]!==n||i)&&(o[t]=n,s[t+":"+e]=-1,s[e]=-1):(o!==n||i)&&(r[e]=n,s[e]=z(n)?1+n.length:-1),r},modified(e,t){const n=this[xd];if(arguments.length){if(z(e)){for(let i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(const i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[xd]={},this}};let fP=0;const dP="pulse",hP=new zg,gP=1,pP=2;function Te(e,t,n,i){this.id=++fP,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}function J_(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Te.prototype={targets(){return this._targets||(this._targets=Ng(Bc))},set(e){return this.value!==e?(this.value=e,1):0},skip:J_(gP),modified:J_(pP),parameters(e,t,n){t=t!==!1;const i=this._argval=this._argval||new zg,r=this._argops=this._argops||[],o=[];let s,a,u,l;const c=(f,d,h)=>{h instanceof Te?(h!==this&&(t&&h.targets().add(this),o.push(h)),r.push({op:h,name:f,index:d})):i.set(f,d,h)};for(s in e)if(a=e[s],s===dP)H(a).forEach(f=>{f instanceof Te?f!==this&&(f.targets().add(this),o.push(f)):R("Pulse parameters must be operator instances.")}),this.source=a;else if(z(a))for(i.set(s,-1,Array(u=a.length)),l=0;l<u;++l)c(s,l,a[l]);else c(s,-1,a);return this.marshall().clear(),n&&(r.initonly=!0),o},marshall(e){const t=this._argval||hP,n=this._argops;let i,r,o,s;if(n){const a=n.length;for(r=0;r<a;++r)i=n[r],o=i.op,s=o.modified()&&o.stamp===e,t.set(i.name,i.index,o.value,s);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function mP(e,t,n,i){let r=1,o;return e instanceof Te?o=e:e&&e.prototype instanceof Te?o=new e:ue(e)?o=new Te(null,e):(r=0,o=new Te(e,t)),this.rank(o),r&&(i=n,n=t),n&&this.connect(o,o.parameters(n,i)),this.touch(o),o}function yP(e,t){const n=e.rank,i=t.length;for(let r=0;r<i;++r)if(n<t[r].rank){this.rerank(e);return}}let bP=0;function Pg(e,t,n){this.id=++bP,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function no(e,t,n){return new Pg(e,t,n)}Pg.prototype={_filter:Gn,_apply:It,targets(){return this._targets||(this._targets=Ng(Bc))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,i=n?n.length:0;for(let r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=no(e);return this.targets().add(t),t},apply(e){const t=no(null,e);return this.targets().add(t),t},merge(){const e=no();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=no();return this.targets().add(no(null,null,lb(e,n=>{const i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},between(e,t){let n=!1;return e.targets().add(no(null,null,()=>n=!0)),t.targets().add(no(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=Gn,this._targets=null}};function xP(e,t,n,i){const r=this,o=no(n,i),s=function(l){l.dataflow=r;try{o.receive(l)}catch(c){r.error(c)}finally{r.run()}};let a;typeof e=="string"&&typeof document<"u"?a=document.querySelectorAll(e):a=H(e);const u=a.length;for(let l=0;l<u;++l)a[l].addEventListener(t,s);return o}function vP(e,t){const n=this.locale();return gM(e,t,n.timeParse,n.utcParse)}function wP(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function _P(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:hM(t&&t.type)});try{r=n.parse(r,t)}catch(o){i=-2,n.warn("Data ingestion failed",e,o)}}catch(o){i=-1,n.warn("Loading failed",e,o)}return{data:r,status:i}}async function SP(e,t,n){const i=this,r=i._pending||EP(i);r.requests+=1;const o=await i.request(t,n);return i.pulse(e,i.changeset().remove(Gn).insert(o.data||[])),r.done(),o}function EP(e){let t;const n=new Promise(i=>t=i);return n.requests=0,n.done=()=>{--n.requests===0&&(e._pending=null,t(e))},e._pending=n}const kP={skip:!0};function $P(e,t,n,i,r){return(e instanceof Te?CP:AP)(this,e,t,n,i,r),this}function AP(e,t,n,i,r,o){const s=ae({},o,kP);let a,u;ue(n)||(n=Bt(n)),i===void 0?a=l=>e.touch(n(l)):ue(i)?(u=new Te(null,i,r,!1),a=l=>{u.evaluate(l);const c=n(l),f=u.value;bM(f)?e.pulse(c,f,o):e.update(c,f,s)}):a=l=>e.update(n(l),i,s),t.apply(a)}function CP(e,t,n,i,r,o){if(i===void 0)t.targets().add(n);else{const s=o||{},a=new Te(null,MP(n,i),r,!1);a.modified(s.force),a.rank=t.rank,t.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),e.connect(n,[a]))}}function MP(e,t){return t=ue(t)?t:Bt(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function FP(e){e.rank=++this._rank}function TP(e){const t=[e];let n,i,r;for(;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&R("Cycle detected in dataflow graph.")}const Qd={},zi=1,oo=2,wr=4,DP=zi|oo,Q_=zi|wr,_a=zi|oo|wr,Z_=8,ul=16,eS=32,tS=64;function So(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function Nm(e,t){const n=[];return ro(e,t,i=>n.push(i)),n}function nS(e,t){const n={};return e.visit(t,i=>{n[ee(i)]=1}),i=>n[ee(i)]?null:i}function zf(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}So.prototype={StopPropagation:Qd,ADD:zi,REM:oo,MOD:wr,ADD_REM:DP,ADD_MOD:Q_,ALL:_a,REFLOW:Z_,SOURCE:ul,NO_SOURCE:eS,NO_FIELDS:tS,fork(e){return new So(this.dataflow).init(this,e)},clone(){const e=this.fork(_a);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(_a|ul)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new So(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&tS)&&(n.fields=e.fields),t&zi?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&oo?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&wr?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&eS?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||_a;return t&zi&&this.add.length||t&oo&&this.rem.length||t&wr&&this.mod.length},reflow(e){if(e)return this.fork(_a).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(wr,nS(this,zi))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return z(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?z(e)?e.some(i=>n[i]):n[e]:!!n:!1},filter(e,t){const n=this;return e&zi&&(n.addF=zf(n.addF,t)),e&oo&&(n.remF=zf(n.remF,t)),e&wr&&(n.modF=zf(n.modF,t)),e&ul&&(n.srcF=zf(n.srcF,t)),n},materialize(e){e=e||_a;const t=this;return e&zi&&t.addF&&(t.add=Nm(t.add,t.addF),t.addF=null),e&oo&&t.remF&&(t.rem=Nm(t.rem,t.remF),t.remF=null),e&wr&&t.modF&&(t.mod=Nm(t.mod,t.modF),t.modF=null),e&ul&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,i=t;if(e&ul)return ro(n.source,n.srcF,i),n;e&zi&&ro(n.add,n.addF,i),e&oo&&ro(n.rem,n.remF,i),e&wr&&ro(n.mod,n.modF,i);const r=n.source;if(e&Z_&&r){const o=n.add.length+n.mod.length;o===r.length||(o?ro(r,nS(n,Q_),i):ro(r,n.srcF,i))}return n}};function $b(e,t,n,i){const r=this;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n;for(const s of n)if(s.stamp===t){if(s.fields){const a=r.fields||(r.fields={});for(const u in s.fields)a[u]=1}s.changed(r.ADD)&&(o|=r.ADD),s.changed(r.REM)&&(o|=r.REM),s.changed(r.MOD)&&(o|=r.MOD)}this.changes=o}U($b,So,{fork(e){const t=new So(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?z(e)?e.some(i=>n[i]):n[e]:0},filter(){R("MultiPulse does not support filtering.")},materialize(){R("MultiPulse does not support materialization.")},visit(e,t){const n=this,i=n.pulses,r=i.length;let o=0;if(e&n.SOURCE)for(;o<r;++o)i[o].visit(e,t);else for(;o<r;++o)i[o].stamp===n.stamp&&i[o].visit(e,t);return n}});async function NP(e,t,n){const i=this,r=[];if(i._pulse)return xM(i);if(i._pending&&await i._pending,t&&await bd(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const o=++i._clock;i._pulse=new So(i,o,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=Ng(Bc);let s=0,a,u,l;try{for(;i._heap.size()>0;){if(a=i._heap.pop(),a.rank!==a.qrank){i._enqueue(a,!0);continue}u=a.run(i._getPulse(a,e)),u.then?u=await u:u.async&&(r.push(u.async),u=Qd),u!==Qd&&a._targets&&a._targets.forEach(c=>i._enqueue(c)),++s}}catch(c){i._heap.clear(),l=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${o}: ${s} operators`),l&&(i._postrun=[],i.error(l)),i._postrun.length){const c=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await bd(i,c[f].callback)}return n&&await bd(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function OP(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function RP(e,t,n){return this._pulse?xM(this):(this.evaluate(e,t,n),this)}function zP(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function xM(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function PP(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function LP(e,t){const n=e.source,i=this._clock;return n&&z(n)?new $b(this,i,n.map(r=>r.pulse),t):this._input[e.id]||IP(this._pulse,n&&n.pulse)}function IP(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Qd&&(e.source=t.source),e)}const Ab={skip:!1,force:!1};function BP(e,t){const n=t||Ab;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function jP(e,t,n){const i=n||Ab;return(e.set(t)||i.force)&&this.touch(e,i),this}function UP(e,t,n){this.touch(e,n||Ab);const i=new So(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function qP(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),vM(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let i;return t.length?(i=t[0],t[0]=n,WP(t,0,e)):i=n,i}}}function vM(e,t,n,i){let r,o;const s=e[n];for(;n>t;){if(o=n-1>>1,r=e[o],i(s,r)<0){e[n]=r,n=o;continue}break}return e[n]=s}function WP(e,t,n){const i=t,r=e.length,o=e[t];let s=(t<<1)+1,a;for(;s<r;)a=s+1,a<r&&n(e[s],e[a])>=0&&(s=a),e[t]=e[s],t=s,s=(t<<1)+1;return e[t]=o,vM(e,i,t,n)}function Ua(){this.logger(rb()),this.logLevel(nb),this._clock=0,this._rank=0,this._locale=wb();try{this._loader=Dg()}catch{}this._touched=Ng(Bc),this._input={},this._pulse=null,this._heap=qP((e,t)=>e.qrank-t.qrank),this._postrun=[]}function ll(e){return function(){return this._log[e].apply(this,arguments)}}Ua.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:ll("error"),warn:ll("warn"),info:ll("info"),debug:ll("debug"),logLevel:ll("level"),cleanThreshold:1e4,add:mP,connect:yP,rank:FP,rerank:TP,pulse:UP,touch:BP,update:jP,changeset:aa,ingest:wP,parse:vP,preload:SP,request:_P,events:xP,on:$P,evaluate:NP,run:RP,runAsync:OP,runAfter:zP,_enqueue:PP,_getPulse:LP};function T(e,t){Te.call(this,e,null,t)}U(T,Te,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const iu={};function wM(e){const t=_M(e);return t&&t.Definition||null}function _M(e){return e=e&&e.toLowerCase(),ne(iu,e)?iu[e]:null}function*SM(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function Cb(e,t,n){const i=Float64Array.from(SM(e,n));return i.sort(Tr),t.map(r=>vC(i,r))}function Mb(e,t){return Cb(e,[.25,.5,.75],t)}function Fb(e,t){const n=e.length,i=Z4(e,t),r=Mb(e,t),o=(r[2]-r[0])/1.34;return 1.06*(Math.min(i,o)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}function EM(e){const t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2];let o=e.extent[0],s=e.extent[1],a,u,l,c,f,d;const h=e.span||s-o||Math.abs(o)||1;if(e.step)a=e.step;else if(e.steps){for(c=h/t,f=0,d=e.steps.length;f<d&&e.steps[f]<c;++f);a=e.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(t)/i),l=e.minstep||0,a=Math.max(l,Math.pow(n,Math.round(Math.log(h)/i)-u));Math.ceil(h/a)>t;)a*=n;for(f=0,d=r.length;f<d;++f)c=a/r[f],c>=l&&h/c<=t&&(a=c)}c=Math.log(a);const g=c>=0?0:~~(-c/i)+1,p=Math.pow(n,-g-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(o/a+p)*a,o=o<c?c-a:c,s=Math.ceil(s/a)*a),{start:o,stop:s===o?o+a:s,step:a}}var Vn=Math.random;function HP(e){Vn=e}function kM(e,t,n,i){if(!e.length)return[void 0,void 0];const r=Float64Array.from(SM(e,i)),o=r.length,s=t;let a,u,l,c;for(l=0,c=Array(s);l<s;++l){for(a=0,u=0;u<o;++u)a+=r[~~(Vn()*o)];c[l]=a/o}return c.sort(Tr),[Q0(c,n/2),Q0(c,1-n/2)]}function $M(e,t,n,i){i=i||(d=>d);const r=e.length,o=new Float64Array(r);let s=0,a=1,u=i(e[0]),l=u,c=u+t,f;for(;a<r;++a){if(f=i(e[a]),f>=c){for(l=(u+l)/2;s<a;++s)o[s]=l;c=f+t,u=f}l=f}for(l=(u+l)/2;s<a;++s)o[s]=l;return n?GP(o,t+t/4):o}function GP(e,t){const n=e.length;let i=0,r=1,o,s;for(;e[i]===e[r];)++r;for(;r<n;){for(o=r+1;e[r]===e[o];)++o;if(e[r]-e[r-1]<t){for(s=r+(i+o-r-r>>1);s<r;)e[s++]=e[r];for(;s>r;)e[s--]=e[i]}i=r,r=o}return e}function YP(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function VP(e,t){t==null&&(t=e,e=0);let n,i,r;const o={min(s){return arguments.length?(n=s||0,r=i-n,o):n},max(s){return arguments.length?(i=s||0,r=i-n,o):i},sample(){return n+Math.floor(r*Vn())},pdf(s){return s===Math.floor(s)&&s>=n&&s<i?1/r:0},cdf(s){const a=Math.floor(s);return a<n?0:a>=i?1:(a-n+1)/r},icdf(s){return s>=0&&s<=1?n-1+Math.floor(s*r):NaN}};return o.min(e).max(t)}const AM=Math.sqrt(2*Math.PI),XP=Math.SQRT2;let cl=NaN;function Lg(e,t){e=e||0,t=t??1;let n=0,i=0,r,o;if(cl===cl)n=cl,cl=NaN;else{do n=Vn()*2-1,i=Vn()*2-1,r=n*n+i*i;while(r===0||r>1);o=Math.sqrt(-2*Math.log(r)/r),n*=o,cl=i*o}return e+n*t}function Tb(e,t,n){n=n??1;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*AM)}function Ig(e,t,n){t=t||0,n=n??1;const i=(e-t)/n,r=Math.abs(i);let o;if(r>37)o=0;else{const s=Math.exp(-r*r/2);let a;r<7.07106781186547?(a=.0352624965998911*r+.700383064443688,a=a*r+6.37396220353165,a=a*r+33.912866078383,a=a*r+112.079291497871,a=a*r+221.213596169931,a=a*r+220.206867912376,o=s*a,a=.0883883476483184*r+1.75566716318264,a=a*r+16.064177579207,a=a*r+86.7807322029461,a=a*r+296.564248779674,a=a*r+637.333633378831,a=a*r+793.826512519948,a=a*r+440.413735824752,o=o/a):(a=r+.65,a=r+4/a,a=r+3/a,a=r+2/a,a=r+1/a,o=s/a/2.506628274631)}return i>0?1-o:o}function Bg(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*XP*KP(2*e-1)}function KP(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}function Db(e,t){let n,i;const r={mean(o){return arguments.length?(n=o||0,r):n},stdev(o){return arguments.length?(i=o??1,r):i},sample:()=>Lg(n,i),pdf:o=>Tb(o,n,i),cdf:o=>Ig(o,n,i),icdf:o=>Bg(o,n,i)};return r.mean(e).stdev(t)}function Nb(e,t){const n=Db();let i=0;const r={data(o){return arguments.length?(e=o,i=o?o.length:0,r.bandwidth(t)):e},bandwidth(o){return arguments.length?(t=o,!t&&e&&(t=Fb(e)),r):t},sample(){return e[~~(Vn()*i)]+t*n.sample()},pdf(o){let s=0,a=0;for(;a<i;++a)s+=n.pdf((o-e[a])/t);return s/t/i},cdf(o){let s=0,a=0;for(;a<i;++a)s+=n.cdf((o-e[a])/t);return s/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(e)}function Ob(e,t){return e=e||0,t=t??1,Math.exp(e+Lg()*t)}function Rb(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*AM*e)}function zb(e,t,n){return Ig(Math.log(e),t,n)}function Pb(e,t,n){return Math.exp(Bg(e,t,n))}function CM(e,t){let n,i;const r={mean(o){return arguments.length?(n=o||0,r):n},stdev(o){return arguments.length?(i=o??1,r):i},sample:()=>Ob(n,i),pdf:o=>Rb(o,n,i),cdf:o=>zb(o,n,i),icdf:o=>Pb(o,n,i)};return r.mean(e).stdev(t)}function MM(e,t){let n=0,i;function r(s){const a=[];let u=0,l;for(l=0;l<n;++l)u+=a[l]=s[l]==null?1:+s[l];for(l=0;l<n;++l)a[l]/=u;return a}const o={weights(s){return arguments.length?(i=r(t=s||[]),o):t},distributions(s){return arguments.length?(s?(n=s.length,e=s):(n=0,e=[]),o.weights(t)):e},sample(){const s=Vn();let a=e[n-1],u=i[0],l=0;for(;l<n-1;u+=i[++l])if(s<u){a=e[l];break}return a.sample()},pdf(s){let a=0,u=0;for(;u<n;++u)a+=i[u]*e[u].pdf(s);return a},cdf(s){let a=0,u=0;for(;u<n;++u)a+=i[u]*e[u].cdf(s);return a},icdf(){throw Error("Mixture icdf not supported.")}};return o.distributions(e).weights(t)}function Lb(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Vn()}function Ib(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function Bb(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function jb(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function FM(e,t){let n,i;const r={min(o){return arguments.length?(n=o||0,r):n},max(o){return arguments.length?(i=o??1,r):i},sample:()=>Lb(n,i),pdf:o=>Ib(o,n,i),cdf:o=>Bb(o,n,i),icdf:o=>jb(o,n,i)};return t==null&&(t=e??1,e=0),r.min(e).max(t)}function Ub(e,t,n){let i=0,r=0;for(const o of e){const s=n(o);t(o)==null||s==null||isNaN(s)||(i+=(s-i)/++r)}return{coef:[i],predict:()=>i,rSquared:0}}function Hc(e,t,n,i){const r=i-e*e,o=Math.abs(r)<1e-24?0:(n-e*t)/r;return[t-o*e,o]}function jg(e,t,n,i){e=e.filter(h=>{let g=t(h),p=n(h);return g!=null&&(g=+g)>=g&&p!=null&&(p=+p)>=p}),i&&e.sort((h,g)=>t(h)-t(g));const r=e.length,o=new Float64Array(r),s=new Float64Array(r);let a=0,u=0,l=0,c,f,d;for(d of e)o[a]=c=+t(d),s[a]=f=+n(d),++a,u+=(c-u)/a,l+=(f-l)/a;for(a=0;a<r;++a)o[a]-=u,s[a]-=l;return[o,s,u,l]}function Gc(e,t,n,i){let r=-1,o,s;for(const a of e)o=t(a),s=n(a),o!=null&&(o=+o)>=o&&s!=null&&(s=+s)>=s&&i(o,s,++r)}function Bu(e,t,n,i,r){let o=0,s=0;return Gc(e,t,n,(a,u)=>{const l=u-r(a),c=u-i;o+=l*l,s+=c*c}),1-o/s}function qb(e,t,n){let i=0,r=0,o=0,s=0,a=0;Gc(e,t,n,(c,f)=>{++a,i+=(c-i)/a,r+=(f-r)/a,o+=(c*f-o)/a,s+=(c*c-s)/a});const u=Hc(i,r,o,s),l=c=>u[0]+u[1]*c;return{coef:u,predict:l,rSquared:Bu(e,t,n,r,l)}}function TM(e,t,n){let i=0,r=0,o=0,s=0,a=0;Gc(e,t,n,(c,f)=>{++a,c=Math.log(c),i+=(c-i)/a,r+=(f-r)/a,o+=(c*f-o)/a,s+=(c*c-s)/a});const u=Hc(i,r,o,s),l=c=>u[0]+u[1]*Math.log(c);return{coef:u,predict:l,rSquared:Bu(e,t,n,r,l)}}function DM(e,t,n){const[i,r,o,s]=jg(e,t,n);let a=0,u=0,l=0,c=0,f=0,d,h,g;Gc(e,t,n,(b,x)=>{d=i[f++],h=Math.log(x),g=d*x,a+=(x*h-a)/f,u+=(g-u)/f,l+=(g*h-l)/f,c+=(d*g-c)/f});const[p,m]=Hc(u/s,a/s,l/s,c/s),y=b=>Math.exp(p+m*(b-o));return{coef:[Math.exp(p-m*o),m],predict:y,rSquared:Bu(e,t,n,s,y)}}function NM(e,t,n){let i=0,r=0,o=0,s=0,a=0,u=0;Gc(e,t,n,(f,d)=>{const h=Math.log(f),g=Math.log(d);++u,i+=(h-i)/u,r+=(g-r)/u,o+=(h*g-o)/u,s+=(h*h-s)/u,a+=(d-a)/u});const l=Hc(i,r,o,s),c=f=>l[0]*Math.pow(f,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:Bu(e,t,n,a,c)}}function Wb(e,t,n){const[i,r,o,s]=jg(e,t,n),a=i.length;let u=0,l=0,c=0,f=0,d=0,h,g,p,m;for(h=0;h<a;)g=i[h],p=r[h++],m=g*g,u+=(m-u)/h,l+=(m*g-l)/h,c+=(m*m-c)/h,f+=(g*p-f)/h,d+=(m*p-d)/h;const y=c-u*u,b=u*y-l*l,x=(d*u-f*l)/b,v=(f*y-d*l)/b,w=-x*u,S=_=>(_=_-o,x*_*_+v*_+w+s);return{coef:[w-v*o+x*o*o+s,v-2*x*o,x],predict:S,rSquared:Bu(e,t,n,s,S)}}function OM(e,t,n,i){if(i===0)return Ub(e,t,n);if(i===1)return qb(e,t,n);if(i===2)return Wb(e,t,n);const[r,o,s,a]=jg(e,t,n),u=r.length,l=[],c=[],f=i+1;let d,h,g,p,m;for(d=0;d<f;++d){for(g=0,p=0;g<u;++g)p+=Math.pow(r[g],d)*o[g];for(l.push(p),m=new Float64Array(f),h=0;h<f;++h){for(g=0,p=0;g<u;++g)p+=Math.pow(r[g],d+h);m[h]=p}c.push(m)}c.push(l);const y=QP(c),b=x=>{x-=s;let v=a+y[0]+y[1]*x+y[2]*x*x;for(d=3;d<f;++d)v+=y[d]*Math.pow(x,d);return v};return{coef:JP(f,y,-s,a),predict:b,rSquared:Bu(e,t,n,a,b)}}function JP(e,t,n,i){const r=Array(e);let o,s,a,u;for(o=0;o<e;++o)r[o]=0;for(o=e-1;o>=0;--o)for(a=t[o],u=1,r[o]+=a,s=1;s<=o;++s)u*=(o+1-s)/s,r[o-s]+=a*Math.pow(n,s)*u;return r[0]+=i,r}function QP(e){const t=e.length-1,n=[];let i,r,o,s,a;for(i=0;i<t;++i){for(s=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][s])&&(s=r);for(o=i;o<t+1;++o)a=e[o][i],e[o][i]=e[o][s],e[o][s]=a;for(r=i+1;r<t;++r)for(o=t;o>=i;o--)e[o][r]-=e[o][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(a=0,o=r+1;o<t;++o)a+=e[o][r]*n[o];n[r]=(e[t][r]-a)/e[r][r]}return n}const iS=2,rS=1e-12;function RM(e,t,n,i){const[r,o,s,a]=jg(e,t,n,!0),u=r.length,l=Math.max(2,~~(i*u)),c=new Float64Array(u),f=new Float64Array(u),d=new Float64Array(u).fill(1);for(let h=-1;++h<=iS;){const g=[0,l-1];for(let m=0;m<u;++m){const y=r[m],b=g[0],x=g[1],v=y-r[b]>r[x]-y?b:x;let w=0,S=0,_=0,E=0,A=0;const k=1/Math.abs(r[v]-y||1);for(let M=b;M<=x;++M){const F=r[M],C=o[M],O=ZP(Math.abs(y-F)*k)*d[M],q=F*O;w+=O,S+=q,_+=C*O,E+=C*q,A+=F*q}const[$,D]=Hc(S/w,_/w,E/w,A/w);c[m]=$+D*y,f[m]=Math.abs(o[m]-c[m]),e9(r,m+1,g)}if(h===iS)break;const p=wC(f);if(Math.abs(p)<rS)break;for(let m=0,y,b;m<u;++m)y=f[m]/(6*p),d[m]=y>=1?rS:(b=1-y*y)*b}return t9(r,c,s,a)}function ZP(e){return(e=1-e*e*e)*e*e}function e9(e,t,n){const i=e[t];let r=n[0],o=n[1]+1;if(!(o>=e.length))for(;t>r&&e[o]-i<=i-e[r];)n[0]=++r,n[1]=o,++o}function t9(e,t,n,i){const r=e.length,o=[];let s=0,a=0,u=[],l;for(;s<r;++s)l=e[s]+n,u[0]===l?u[1]+=(t[s]-u[1])/++a:(a=0,u[1]+=i,u=[l,t[s]],o.push(u));return u[1]+=i,o}const n9=.5*Math.PI/180;function Ug(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=p=>[p,e(p)],o=t[0],s=t[1],a=s-o,u=a/i,l=[r(o)],c=[];if(n===i){for(let p=1;p<i;++p)l.push(r(o+p/n*a));return l.push(r(s)),l}else{c.push(r(s));for(let p=n;--p>0;)c.push(r(o+p/n*a))}let f=l[0],d=c[c.length-1];const h=1/a,g=i9(f[1],c);for(;d;){const p=r((f[0]+d[0])/2);p[0]-f[0]>=u&&r9(f,p,d,h,g)>n9?c.push(p):(f=d,l.push(d),c.pop()),d=c[c.length-1]}return l}function i9(e,t){let n=e,i=e;const r=t.length;for(let o=0;o<r;++o){const s=t[o][1];s<n&&(n=s),s>i&&(i=s)}return 1/(i-n)}function r9(e,t,n,i,r){const o=Math.atan2(r*(n[1]-e[1]),i*(n[0]-e[0])),s=Math.atan2(r*(t[1]-e[1]),i*(t[0]-e[0]));return Math.abs(o-s)}function o9(e){return t=>{const n=e.length;let i=1,r=String(e[0](t));for(;i<n;++i)r+="|"+e[i](t);return r}}function u1(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:o9(e)}function zM(e,t,n){return n||e+(t?"_"+t:"")}const Om=()=>{},s9={init:Om,add:Om,rem:Om,idx:0},hc={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Yc=Object.keys(hc).filter(e=>e!=="__count__");function a9(e,t){return n=>ae({name:e,out:n||e},s9,t)}[...Yc,"__count__"].forEach(e=>{hc[e]=a9(e,hc[e])});function PM(e,t){return hc[e](t)}function LM(e,t){return e.idx-t.idx}function u9(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{i.req&&i.req.forEach(r=>{t[r]||n(t[r]=hc[r]())})};return e.forEach(n),Object.values(t).sort(LM)}function l9(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function c9(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t)))}function f9(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t)))}function d9(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function IM(e,t){const n=t||It,i=u9(e),r=e.slice().sort(LM);function o(s){this._ops=i,this._out=r,this.cell=s,this.init()}return o.prototype.init=l9,o.prototype.add=c9,o.prototype.rem=f9,o.prototype.set=d9,o.prototype.get=n,o.fields=e.map(s=>s.out),o}function Hb(e){this._key=e?yn(e):ee,this.reset()}const Et=Hb.prototype;Et.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};Et.add=function(e){this._add.push(e)};Et.rem=function(e){this._rem.push(e)};Et.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,o=Array(i-r),s={};let a,u,l;for(a=0;a<r;++a)s[n(t[a])]=1;for(a=0,u=0;a<i;++a)s[n(l=e[a])]?s[n(l)]=0:o[u++]=l;return this._rem=[],this._add=o};Et.distinct=function(e){const t=this.values(),n={};let i=t.length,r=0,o;for(;--i>=0;)o=e(t[i])+"",ne(n,o)||(n[o]=1,++r);return r};Et.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=nC(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext};Et.argmin=function(e){return this.extent(e)[0]||{}};Et.argmax=function(e){return this.extent(e)[1]||{}};Et.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0};Et.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0};Et.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=Mb(this.values(),e),this._get=e),this._q};Et.q1=function(e){return this.quartile(e)[0]};Et.q2=function(e){return this.quartile(e)[1]};Et.q3=function(e){return this.quartile(e)[2]};Et.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=kM(this.values(),1e3,.05,e),this._get=e),this._ci};Et.ci0=function(e){return this.ci(e)[0]};Et.ci1=function(e){return this.ci(e)[1]};function Co(e){T.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Co.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Yc},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};U(Co,T,{transform(e,t){const n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):Object.create(null),t.visit(t.SOURCE,o=>n.add(o))):(n.value=n.value||n.init(e),t.visit(t.REM,o=>n.rem(o)),t.visit(t.ADD,o=>n.add(o))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){const e=this,t=e.value,n=e._dnames,i=n.map(()=>({})),r=n.length;function o(a){let u,l,c,f;for(u in a)for(c=a[u].tuple,l=0;l<r;++l)i[l][f=c[n[l]]]=f}o(e._prev),o(t);function s(a,u,l){const c=n[l],f=i[l++];for(const d in f){const h=a?a+"|"+d:d;u[c]=f[d],l<r?s(h,u,l):t[h]||e.cell(h,u)}}s("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],i={};function r(m){const y=H(Rt(m)),b=y.length;let x=0,v;for(;x<b;++x)i[v=y[x]]||(i[v]=1,t.push(v))}this._dims=H(e.groupby),this._dnames=this._dims.map(m=>{const y=He(m);return r(m),n.push(y),y}),this.cellkey=e.key?e.key:u1(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const o=e.fields||[null],s=e.ops||["count"],a=e.as||[],u=o.length,l={};let c,f,d,h,g,p;for(u!==s.length&&R("Unmatched number of fields and aggregate ops."),p=0;p<u;++p){if(c=o[p],f=s[p],c==null&&f!=="count"&&R("Null aggregate field specified."),h=He(c),g=zM(f,h,a[p]),n.push(g),f==="count"){this._counts.push(g);continue}d=l[h],d||(r(c),d=l[h]=[],d.field=c,this._measures.push(d)),f!=="count"&&(this._countOnly=!1),d.push(PM(f,g))}return this._measures=this._measures.map(m=>IM(m,m.field)),Object.create(null)},cellkey:u1(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,r=i.length;n.agg=Array(r);for(let o=0;o<r;++o)n.agg[o]=new i[o](n)}return n.store&&(n.data=new Hb),n},newtuple(e,t){const n=this._dnames,i=this._dims,r=i.length,o={};for(let s=0;s<r;++s)o[n[s]]=i[s](e);return t?yM(t.tuple,o):Se(o)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const i=n.agg;for(let r=0,o=i.length;r<o;++r)i[r].add(i[r].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const i=n.agg;for(let r=0,o=i.length;r<o;++r)i[r].rem(i[r].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let i=0,r=n.length;i<r;++i)t[n[i]]=e.num;if(!this._countOnly){const i=e.agg;for(let r=0,o=i.length;r<o;++r)i[r].set(t)}return t},changes(e){const t=this._adds,n=this._mods,i=this._prev,r=this._drop,o=e.add,s=e.rem,a=e.mod;let u,l,c,f;if(i)for(l in i)u=i[l],(!r||u.num)&&s.push(u.tuple);for(c=0,f=this._alen;c<f;++c)o.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(u.num===0&&r?s:a).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const h9=1e-14;function Gb(e){T.call(this,null,e)}Gb.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};U(Gb,T,{transform(e,t){const n=e.interval!==!1,i=this._bins(e),r=i.start,o=i.step,s=e.as||["bin0","bin1"],a=s[0],u=s[1];let l;return e.modified()?(t=t.reflow(!0),l=t.SOURCE):l=t.modified(Rt(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?c=>{const f=i(c);c[a]=f,c[u]=f==null?null:r+o*(1+(f-r)/o)}:c=>c[a]=i(c)),t.modifies(n?s:a)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=EM(e),i=n.step;let r=n.start,o=r+Math.ceil((n.stop-r)/i)*i,s,a;(s=e.anchor)!=null&&(a=s-(r+i*Math.floor((s-r)/i)),r+=a,o+=a);const u=function(l){let c=Dt(t(l));return c==null?null:c<r?-1/0:c>o?1/0:(c=Math.max(r,Math.min(c,o-i)),r+i*Math.floor(h9+(c-r)/i))};return u.start=r,u.stop=n.stop,u.step=i,this.value=En(u,Rt(t),e.name||"bin_"+He(t))}});function BM(e,t,n){const i=e;let r=t||[],o=n||[],s={},a=0;return{add:u=>o.push(u),remove:u=>s[i(u)]=++a,size:()=>r.length,data:(u,l)=>(a&&(r=r.filter(c=>!s[i(c)]),s={},a=0),l&&u&&r.sort(u),o.length&&(r=u?uC(u,r,o.sort(u)):r.concat(o),o=[]),r)}}function Yb(e){T.call(this,[],e)}Yb.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};U(Yb,T,{transform(e,t){const n=t.fork(t.ALL),i=BM(ee,this.value,n.materialize(n.ADD).add),r=e.sort,o=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(o),this.value=n.source=i.data(sa(r),o),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function jM(e){Te.call(this,null,g9,e)}U(jM,Te);function g9(e){return this.value&&!e.modified()?this.value:ub(e.fields,e.orders)}function Vb(e){T.call(this,null,e)}Vb.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function p9(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}U(Vb,T,{transform(e,t){const n=f=>d=>{for(var h=p9(a(d),e.case,o)||[],g,p=0,m=h.length;p<m;++p)s.test(g=h[p])||f(g)},i=this._parameterCheck(e,t),r=this._counts,o=this._match,s=this._stop,a=e.field,u=e.as||["text","count"],l=n(f=>r[f]=1+(r[f]||0)),c=n(f=>r[f]-=1);return i?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],o=t[1],s=e.fork(e.NO_SOURCE|e.NO_FIELDS);let a,u,l;for(a in n)u=i[a],l=n[a]||0,!u&&l?(i[a]=u=Se({}),u[r]=a,u[o]=l,s.add.push(u)):l===0?(u&&s.rem.push(u),n[a]=null,i[a]=null):u[o]!==l&&(u[o]=l,s.mod.push(u));return s.modifies(t)}});function Xb(e){T.call(this,null,e)}Xb.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};U(Xb,T,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.as||["a","b"],r=i[0],o=i[1],s=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let a=this.value;return s?(a&&(n.rem=a),a=t.materialize(t.SOURCE).source,n.add=this.value=m9(a,r,o,e.filter||Gn)):n.mod=a,n.source=this.value,n.modifies(i)}});function m9(e,t,n,i){for(var r=[],o={},s=e.length,a=0,u,l;a<s;++a)for(o[t]=l=e[a],u=0;u<s;++u)o[n]=e[u],i(o)&&(r.push(Se(o)),o={},o[t]=l);return r}const oS={kde:Nb,mixture:MM,normal:Db,lognormal:CM,uniform:FM},y9="distributions",sS="function",b9="field";function UM(e,t){const n=e[sS];ne(oS,n)||R("Unknown distribution function: "+n);const i=oS[n]();for(const r in e)r===b9?i.data((e.from||t()).map(e[r])):r===y9?i[r](e[r].map(o=>UM(o,t))):typeof i[r]===sS&&i[r](e[r]);return i}function Kb(e){T.call(this,null,e)}const qM=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],x9={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:qM},{name:"weights",type:"number",array:!0}]};Kb.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:qM.concat(x9)},{name:"as",type:"string",array:!0,default:["value","density"]}]};U(Kb,T,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=UM(e.distribution,v9(t)),r=e.steps||e.minsteps||25,o=e.steps||e.maxsteps||200;let s=e.method||"pdf";s!=="pdf"&&s!=="cdf"&&R("Invalid density method: "+s),!e.extent&&!i.data&&R("Missing density extent parameter."),s=i[s];const a=e.as||["value","density"],u=e.extent||Ki(i.data()),l=Ug(s,u,r,o).map(c=>{const f={};return f[a[0]]=c[0],f[a[1]]=c[1],Se(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function v9(e){return()=>e.materialize(e.SOURCE).source}function WM(e,t){return e?e.map((n,i)=>t[i]||He(n)):null}function Jb(e,t,n){const i=[],r=f=>f(u);let o,s,a,u,l,c;if(t==null)i.push(e.map(n));else for(o={},s=0,a=e.length;s<a;++s)u=e[s],l=t.map(r),c=o[l],c||(o[l]=c=[],c.dims=l,i.push(c)),c.push(n(u));return i}const HM="bin";function Qb(e){T.call(this,null,e)}Qb.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:HM}]};const w9=(e,t)=>Uc(Ki(e,t))/30;U(Qb,T,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=Jb(t.source,e.groupby,It),r=e.smooth||!1,o=e.field,s=e.step||w9(n,o),a=sa((g,p)=>o(g)-o(p)),u=e.as||HM,l=i.length;let c=1/0,f=-1/0,d=0,h;for(;d<l;++d){const g=i[d].sort(a);h=-1;for(const p of $M(g,s,r,o))p<c&&(c=p),p>f&&(f=p),g[++h][u]=p}return this.value={start:c,stop:f,step:s},t.reflow(!0).modifies(u)}});function GM(e){Te.call(this,null,_9,e),this.modified(!0)}U(GM,Te);function _9(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:En(n=>t(n,e),Rt(t),He(t))}function Zb(e){T.call(this,[void 0,void 0],e)}Zb.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};U(Zb,T,{transform(e,t){const n=this.value,i=e.field,r=t.changed()||t.modified(i.fields)||e.modified("field");let o=n[0],s=n[1];if((r||o==null)&&(o=1/0,s=-1/0),t.visit(r?t.SOURCE:t.ADD,a=>{const u=Dt(i(a));u!=null&&(u<o&&(o=u),u>s&&(s=u))}),!Number.isFinite(o)||!Number.isFinite(s)){let a=He(i);a&&(a=` for field "${a}"`),t.dataflow.warn(`Infinite extent${a}: [${o}, ${s}]`),o=s=void 0}this.value=[o,s]}});function ex(e,t){Te.call(this,e),this.parent=t,this.count=0}U(ex,Te,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function qg(e){T.call(this,{},e),this._keys=Ru();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}U(qg,T,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,i){const r=this.value;let o=ne(r,e)&&r[e],s,a;return o?o.value.stamp<n.stamp&&(o.init(n),this.activate(o)):(a=i||(a=this._group[e])&&a.tuple,s=n.dataflow,o=new ex(n.fork(n.NO_SOURCE),this),s.add(o).connect(t(s,e,a)),r[e]=o,this.activate(o)),o},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const i=e[n].detachSubflow;i&&i(),delete e[n],++t}if(t){const n=this._targets.filter(i=>i&&i.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,i=e?e.length:0;let r=0;for(;r<i;++r)t[r]=e[r];for(;r<n&&t[r]!=null;++r)t[r]=null;t.active=i},transform(e,t){const n=t.dataflow,i=e.key,r=e.subflow,o=this._keys,s=e.modified("key"),a=u=>this.subflow(u,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,u=>{const l=ee(u),c=o.get(l);c!==void 0&&(o.delete(l),a(c).rem(u))}),t.visit(t.ADD,u=>{const l=i(u);o.set(ee(u),l),a(l).add(u)}),s||t.modified(i.fields)?t.visit(t.MOD,u=>{const l=ee(u),c=o.get(l),f=i(u);c===f?a(f).mod(u):(o.set(l,f),a(c).rem(u),a(f).add(u))}):t.changed(t.MOD)&&t.visit(t.MOD,u=>{a(o.get(ee(u))).mod(u)}),s&&t.visit(t.REFLOW,u=>{const l=ee(u),c=o.get(l),f=i(u);c!==f&&(o.set(l,f),a(c).rem(u),a(f).add(u))}),t.clean()?n.runAfter(()=>{this.clean(),o.clean()}):o.empty>n.cleanThreshold&&n.runAfter(o.clean),t}});function YM(e){Te.call(this,null,S9,e)}U(YM,Te);function S9(e){return this.value&&!e.modified()?this.value:z(e.name)?H(e.name).map(t=>yn(t)):yn(e.name,e.as)}function tx(e){T.call(this,Ru(),e)}tx.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};U(tx,T,{transform(e,t){const n=t.dataflow,i=this.value,r=t.fork(),o=r.add,s=r.rem,a=r.mod,u=e.expr;let l=!0;t.visit(t.REM,f=>{const d=ee(f);i.has(d)?i.delete(d):s.push(f)}),t.visit(t.ADD,f=>{u(f,e)?o.push(f):i.set(ee(f),1)});function c(f){const d=ee(f),h=u(f,e),g=i.get(d);h&&g?(i.delete(d),o.push(f)):!h&&!g?(i.set(d,1),s.push(f)):l&&h&&!g&&a.push(f)}return t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}});function nx(e){T.call(this,[],e)}nx.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};U(nx,T,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=WM(i,e.as||[]),o=e.index||null,s=r.length;return n.rem=this.value,t.visit(t.SOURCE,a=>{const u=i.map(g=>g(a)),l=u.reduce((g,p)=>Math.max(g,p.length),0);let c=0,f,d,h;for(;c<l;++c){for(d=kb(a),f=0;f<s;++f)d[r[f]]=(h=u[f][c])==null?null:h;o&&(d[o]=c),n.add.push(d)}}),this.value=n.source=n.add,o&&n.modifies(o),n.modifies(r)}});function ix(e){T.call(this,[],e)}ix.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};U(ix,T,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(He),o=e.as||["key","value"],s=o[0],a=o[1],u=i.length;return n.rem=this.value,t.visit(t.SOURCE,l=>{for(let c=0,f;c<u;++c)f=kb(l),f[s]=r[c],f[a]=i[c](l),n.add.push(f)}),this.value=n.source=n.add,n.modifies(o)}});function rx(e){T.call(this,null,e)}rx.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};U(rx,T,{transform(e,t){const n=e.expr,i=e.as,r=e.modified(),o=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(o,s=>s[i]=n(s,e))}});function VM(e){T.call(this,[],e)}U(VM,T,{transform(e,t){const n=t.fork(t.ALL),i=e.generator;let r=this.value,o=e.size-r.length,s,a,u;if(o>0){for(s=[];--o>=0;)s.push(u=Se(i(e))),r.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(s):s}else a=r.slice(0,-o),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,r=r.slice(-o);return n.source=this.value=r,n}});const Pf={value:"value",median:wC,mean:o8,min:J0,max:Cs},E9=[];function ox(e){T.call(this,[],e)}ox.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function k9(e){var t=e.method||Pf.value,n;if(Pf[t]==null)R("Unrecognized imputation method: "+t);else return t===Pf.value?(n=e.value!==void 0?e.value:0,()=>n):Pf[t]}function $9(e){const t=e.field;return n=>n?t(n):NaN}U(ox,T,{transform(e,t){var n=t.fork(t.ALL),i=k9(e),r=$9(e),o=He(e.field),s=He(e.key),a=(e.groupby||[]).map(He),u=A9(t.source,e.groupby,e.key,e.keyvals),l=[],c=this.value,f=u.domain.length,d,h,g,p,m,y,b,x,v,w;for(m=0,x=u.length;m<x;++m)for(d=u[m],g=d.values,h=NaN,b=0;b<f;++b)if(d[b]==null){for(p=u.domain[b],w={_impute:!0},y=0,v=g.length;y<v;++y)w[a[y]]=g[y];w[s]=p,w[o]=Number.isNaN(h)?h=i(d,r):h,l.push(Se(w))}return l.length&&(n.add=n.materialize(n.ADD).add.concat(l)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=l,n}});function A9(e,t,n,i){var r=y=>y(m),o=[],s=i?i.slice():[],a={},u={},l,c,f,d,h,g,p,m;for(s.forEach((y,b)=>a[y]=b+1),d=0,p=e.length;d<p;++d)m=e[d],g=n(m),h=a[g]||(a[g]=s.push(g)),c=(l=t?t.map(r):E9)+"",(f=u[c])||(f=u[c]=[],o.push(f),f.values=l),f[h-1]=m;return o.domain=s,o}function sx(e){Co.call(this,e)}sx.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Yc},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};U(sx,Co,{transform(e,t){const n=this,i=e.modified();let r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,o=>n.add(o))):(r=n.value=n.value||this.init(e),t.visit(t.REM,o=>n.rem(o)),t.visit(t.ADD,o=>n.add(o))),n.changes(),t.visit(t.SOURCE,o=>{ae(o,r[n.cellkey(o)].tuple)}),t.reflow(i).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function ax(e){T.call(this,null,e)}ax.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};U(ax,T,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=Jb(i,e.groupby,e.field),o=(e.groupby||[]).map(He),s=e.bandwidth,a=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;a!=="pdf"&&a!=="cdf"&&R("Invalid density method: "+a),e.resolve==="shared"&&(c||(c=Ki(i,e.field)),f=d=e.steps||d),r.forEach(h=>{const g=Nb(h,s)[a],p=e.counts?h.length:1,m=c||Ki(h);Ug(g,m,f,d).forEach(y=>{const b={};for(let x=0;x<o.length;++x)b[o[x]]=h.dims[x];b[u[0]]=y[0],b[u[1]]=y[1]*p,l.push(Se(b))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function XM(e){Te.call(this,null,C9,e)}U(XM,Te);function C9(e){return this.value&&!e.modified()?this.value:cb(e.fields,e.flat)}function KM(e){T.call(this,[],e),this._pending=null}U(KM,T,{transform(e,t){const n=t.dataflow;return this._pending?Rm(this,t,this._pending):M9(e)?t.StopPropagation:e.values?Rm(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=H(r.data),o=>o.touch(this)))}:n.request(e.url,e.format).then(i=>Rm(this,t,H(i.data)))}});function M9(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function Rm(e,t,n){n.forEach(Se);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function ux(e){T.call(this,{},e)}ux.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};U(ux,T,{transform(e,t){const n=e.fields,i=e.index,r=e.values,o=e.default==null?null:e.default,s=e.modified(),a=n.length;let u=s?t.SOURCE:t.ADD,l=t,c=e.as,f,d,h;return r?(d=r.length,a>1&&!c&&R('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==a*d&&R('The "as" parameter has too few output field names.'),c=c||r.map(He),f=function(g){for(var p=0,m=0,y,b;p<a;++p)if(b=i.get(n[p](g)),b==null)for(y=0;y<d;++y,++m)g[c[m]]=o;else for(y=0;y<d;++y,++m)g[c[m]]=r[y](b)}):(c||R("Missing output field names."),f=function(g){for(var p=0,m;p<a;++p)m=i.get(n[p](g)),g[c[p]]=m??o}),s?l=t.reflow(!0):(h=n.some(g=>t.modified(g.fields)),u|=h?t.MOD:0),t.visit(u,f),l.modifies(c)}});function JM(e){Te.call(this,null,F9,e)}U(JM,Te);function F9(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let i=1/0,r=-1/0,o,s;for(o=0;o<n;++o)s=t[o],s[0]<i&&(i=s[0]),s[1]>r&&(r=s[1]);return[i,r]}function QM(e){Te.call(this,null,T9,e)}U(QM,Te);function T9(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function ZM(e){T.call(this,null,e)}U(ZM,T,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function lx(e){Co.call(this,e)}lx.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Yc,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};U(lx,Co,{_transform:Co.prototype.transform,transform(e,t){return this._transform(D9(e,t),t)}});function D9(e,t){const n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",o=Rt(n).concat(Rt(i)),s=O9(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:s.map(()=>r),fields:s.map(a=>N9(a,n,i,o)),as:s.map(a=>a+""),modified:e.modified.bind(e)}}function N9(e,t,n,i){return En(r=>t(r)===e?n(r):NaN,i,e+"")}function O9(e,t,n){const i={},r=[];return n.visit(n.SOURCE,o=>{const s=e(o);i[s]||(i[s]=1,r.push(s))}),r.sort($g),t?r.slice(0,t):r}function eF(e){qg.call(this,e)}U(eF,qg,{transform(e,t){const n=e.subflow,i=e.field,r=o=>this.subflow(ee(o),n,t,o);return(e.modified("field")||i&&t.modified(Rt(i)))&&R("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,o=>{const s=r(o);i(o).forEach(a=>s.mod(a))}),t.visit(t.ADD,o=>{const s=r(o);i(o).forEach(a=>s.add(Se(a)))}),t.visit(t.REM,o=>{const s=r(o);i(o).forEach(a=>s.rem(a))})):(t.visit(t.MOD,o=>r(o).mod(o)),t.visit(t.ADD,o=>r(o).add(o)),t.visit(t.REM,o=>r(o).rem(o))),t.clean()&&t.runAfter(()=>this.clean()),t}});function cx(e){T.call(this,null,e)}cx.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};U(cx,T,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=WM(e.fields,e.as||[]),o=i?(a,u)=>R9(a,u,i,r):Rg;let s;return this.value?s=this.value:(t=t.addAll(),s=this.value={}),t.visit(t.REM,a=>{const u=ee(a);n.rem.push(s[u]),s[u]=null}),t.visit(t.ADD,a=>{const u=o(a,Se({}));s[ee(a)]=u,n.add.push(u)}),t.visit(t.MOD,a=>{n.mod.push(o(a,s[ee(a)]))}),n}});function R9(e,t,n,i){for(let r=0,o=n.length;r<o;++r)t[i[r]]=n[r](e);return t}function tF(e){T.call(this,null,e)}U(tF,T,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function fx(e){T.call(this,null,e)}fx.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const z9=1e-14;U(fx,T,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,o=Jb(r,e.groupby,e.field),s=(e.groupby||[]).map(He),a=[],u=e.step||.01,l=e.probs||Tn(u/2,1-z9,u),c=l.length;return o.forEach(f=>{const d=Cb(f,l);for(let h=0;h<c;++h){const g={};for(let p=0;p<s.length;++p)g[s[p]]=f.dims[p];g[i[0]]=l[h],g[i[1]]=d[h],a.push(Se(g))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}});function nF(e){T.call(this,null,e)}U(nF,T,{transform(e,t){let n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{const o=ee(r);n.rem.push(i[o]),i[o]=null}),t.visit(t.ADD,r=>{const o=kb(r);i[ee(r)]=o,n.add.push(o)}),t.visit(t.MOD,r=>{const o=i[ee(r)];for(const s in r)o[s]=r[s],n.modifies(s);n.mod.push(o)})),n}});function dx(e){T.call(this,[],e),this.count=0}dx.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};U(dx,T,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,o=this.value.reduce((c,f)=>(c[ee(f)]=1,c),{});let s=this.value,a=this.count,u=0;function l(c){let f,d;s.length<r?s.push(c):(d=~~((a+1)*Vn()),d<s.length&&d>=u&&(f=s[d],o[ee(f)]&&n.rem.push(f),s[d]=c)),++a}if(t.rem.length&&(t.visit(t.REM,c=>{const f=ee(c);o[f]&&(o[f]=-1,n.rem.push(c)),--a}),s=s.filter(c=>o[ee(c)]!==-1)),(t.rem.length||i)&&s.length<r&&t.source&&(u=a=s.length,t.visit(t.SOURCE,c=>{o[ee(c)]||l(c)}),u=-1),i&&s.length>r){const c=s.length-r;for(let f=0;f<c;++f)o[ee(s[f])]=-1,n.rem.push(s[f]);s=s.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{o[ee(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=s.filter(c=>!o[ee(c)])),this.count=a,this.value=n.source=s,n}});function hx(e){T.call(this,null,e)}hx.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};U(hx,T,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Tn(e.start,e.stop,e.step||1).map(r=>{const o={};return o[i]=r,Se(o)}),n.add=t.add.concat(this.value),n}});function iF(e){T.call(this,null,e),this.modified(!0)}U(iF,T,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function gx(e){T.call(this,null,e)}const rF=["unit0","unit1"];gx.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:mb,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:rF}]};U(gx,T,{transform(e,t){const n=e.field,i=e.interval!==!1,r=e.timezone==="utc",o=this._floor(e,t),s=(r?Iu:Lu)(o.unit).offset,a=e.as||rF,u=a[0],l=a[1],c=o.step;let f=o.start||1/0,d=o.stop||-1/0,h=t.ADD;return(e.modified()||t.changed(t.REM)||t.modified(Rt(n)))&&(t=t.reflow(!0),h=t.SOURCE,f=1/0,d=-1/0),t.visit(h,g=>{const p=n(g);let m,y;p==null?(g[u]=null,i&&(g[l]=null)):(g[u]=m=y=o(p),i&&(g[l]=y=s(m,c)),m<f&&(f=m),y>d&&(d=y))}),o.start=f,o.stop=d,t.modifies(i?a:u)},_floor(e,t){const n=e.timezone==="utc",{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:VC({extent:e.extent||Ki(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),o=yb(i),s=this.value||{},a=(n?IC:LC)(o,r);return a.unit=ye(o),a.units=o,a.step=r,a.start=s.start,a.stop=s.stop,this.value=a}});function oF(e){T.call(this,Ru(),e)}U(oF,T,{transform(e,t){const n=t.dataflow,i=e.field,r=this.value,o=a=>r.set(i(a),a);let s=!0;return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,a=>r.delete(i(a))),t.visit(t.ADD,o)):s=!1,this.modified(s),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()}});function sF(e){T.call(this,null,e)}U(sF,T,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(sa(e.sort)):t.source).map(e.field))}});function P9(e,t,n,i){const r=gc[e](t,n);return{init:r.init||lo,update:function(o,s){s[i]=r.next(o)}}}const gc={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){const e=gc.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,i=t.compare;let r=t.index;if(e<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;e=r}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||R("ntile num must be greater than zero.");const n=gc.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{const i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||R("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{const r=i.data;return i.index<=n?t:(n=L9(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function L9(e,t,n){for(let i=t.length;n<i;++n)if(e(t[n])!=null)return n;return-1}const I9=Object.keys(gc);function aF(e){const t=H(e.ops),n=H(e.fields),i=H(e.params),r=H(e.as),o=this.outputs=[],s=this.windows=[],a={},u={},l=[],c=[];let f=!0;function d(h){H(Rt(h)).forEach(g=>a[g]=1)}d(e.sort),t.forEach((h,g)=>{const p=n[g],m=He(p),y=zM(h,m,r[g]);if(d(p),o.push(y),ne(gc,h))s.push(P9(h,n[g],i[g],y));else{if(p==null&&h!=="count"&&R("Null aggregate field specified."),h==="count"){l.push(y);return}f=!1;let b=u[m];b||(b=u[m]=[],b.field=p,c.push(b)),b.push(PM(h,y))}}),(l.length||c.length)&&(this.cell=B9(c,l,f)),this.inputs=Object.keys(a)}const uF=aF.prototype;uF.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()};uF.update=function(e,t){const n=this.cell,i=this.windows,r=e.data,o=i&&i.length;let s;if(n){for(s=e.p0;s<e.i0;++s)n.rem(r[s]);for(s=e.p1;s<e.i1;++s)n.add(r[s]);n.set(t)}for(s=0;s<o;++s)i[s].update(e,t)};function B9(e,t,n){e=e.map(u=>IM(u,u.field));const i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,o=i.agg=Array(r),s=0;s<r;++s)o[s]=new e[s](i);if(i.store)var a=i.data=new Hb;return i.add=function(u){if(i.num+=1,!n){a&&a.add(u);for(let l=0;l<r;++l)o[l].add(o[l].get(u),u)}},i.rem=function(u){if(i.num-=1,!n){a&&a.rem(u);for(let l=0;l<r;++l)o[l].rem(o[l].get(u),u)}},i.set=function(u){let l,c;for(a&&a.values(),l=0,c=t.length;l<c;++l)u[t[l]]=i.num;if(!n)for(l=0,c=o.length;l<c;++l)o[l].set(u)},i.init=function(){i.num=0,a&&a.reset();for(let u=0;u<r;++u)o[u].init()},i}function px(e){T.call(this,{},e),this._mlen=0,this._mods=[]}px.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:I9.concat(Yc)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};U(px,T,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),i=sa(e.sort),r=u1(e.groupby),o=a=>this.group(r(a));let s=this.state;(!s||n)&&(s=this.state=new aF(e)),n||t.modified(s.inputs)?(this.value={},t.visit(t.SOURCE,a=>o(a).add(a))):(t.visit(t.REM,a=>o(a).remove(a)),t.visit(t.ADD,a=>o(a).add(a)));for(let a=0,u=this._mlen;a<u;++a)j9(this._mods[a],s,i,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(s.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=BM(ee),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function j9(e,t,n,i){const r=i.sort,o=r&&!i.ignorePeers,s=i.frame||[null,0],a=e.data(n),u=a.length,l=o?qc(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:r||Bt(-1)};t.init();for(let f=0;f<u;++f)U9(c,s,f,u),o&&q9(c,l),t.update(c,a[f])}function U9(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function q9(e,t){const n=e.i0,i=e.i1-1,r=e.compare,o=e.data,s=o.length-1;n>0&&!r(o[n],o[n-1])&&(e.i0=t.left(o,o[n])),i<s&&!r(o[i],o[i+1])&&(e.i1=t.right(o,o[i]))}const W9=Object.freeze(Object.defineProperty({__proto__:null,aggregate:Co,bin:Gb,collect:Yb,compare:jM,countpattern:Vb,cross:Xb,density:Kb,dotbin:Qb,expression:GM,extent:Zb,facet:qg,field:YM,filter:tx,flatten:nx,fold:ix,formula:rx,generate:VM,impute:ox,joinaggregate:sx,kde:ax,key:XM,load:KM,lookup:ux,multiextent:JM,multivalues:QM,params:ZM,pivot:lx,prefacet:eF,project:cx,proxy:tF,quantile:fx,relay:nF,sample:dx,sequence:hx,sieve:iF,subflow:ex,timeunit:gx,tupleindex:oF,values:sF,window:px},Symbol.toStringTag,{value:"Module"}));function Ee(e){return function(){return e}}const aS=Math.abs,$t=Math.atan2,os=Math.cos,H9=Math.max,zm=Math.min,Ni=Math.sin,Ss=Math.sqrt,Ct=1e-12,ru=Math.PI,Zd=ru/2,lF=2*ru;function G9(e){return e>1?0:e<-1?ru:Math.acos(e)}function uS(e){return e>=1?Zd:e<=-1?-Zd:Math.asin(e)}const l1=Math.PI,c1=2*l1,ms=1e-6,Y9=c1-ms;function cF(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function V9(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return cF;const n=10**t;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}let mx=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?cF:V9(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,o,s){this._append`C${+t},${+n},${+i},${+r},${this._x1=+o},${this._y1=+s}`}arcTo(t,n,i,r,o){if(t=+t,n=+n,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,u=i-t,l=r-n,c=s-t,f=a-n,d=c*c+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(d>ms)if(!(Math.abs(f*u-l*c)>ms)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let h=i-s,g=r-a,p=u*u+l*l,m=h*h+g*g,y=Math.sqrt(p),b=Math.sqrt(d),x=o*Math.tan((l1-Math.acos((p+d-m)/(2*y*b)))/2),v=x/b,w=x/y;Math.abs(v-1)>ms&&this._append`L${t+v*c},${n+v*f}`,this._append`A${o},${o},0,0,${+(f*h>c*g)},${this._x1=t+w*u},${this._y1=n+w*l}`}}arc(t,n,i,r,o,s){if(t=+t,n=+n,i=+i,s=!!s,i<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(r),u=i*Math.sin(r),l=t+a,c=n+u,f=1^s,d=s?r-o:o-r;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>ms||Math.abs(this._y1-c)>ms)&&this._append`L${l},${c}`,i&&(d<0&&(d=d%c1+c1),d>Y9?this._append`A${i},${i},0,1,${f},${t-a},${n-u}A${i},${i},0,1,${f},${this._x1=l},${this._y1=c}`:d>ms&&this._append`A${i},${i},0,${+(d>=l1)},${f},${this._x1=t+i*Math.cos(o)},${this._y1=n+i*Math.sin(o)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}};function Wg(){return new mx}Wg.prototype=mx.prototype;function Hg(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new mx(t)}function X9(e){return e.innerRadius}function K9(e){return e.outerRadius}function J9(e){return e.startAngle}function Q9(e){return e.endAngle}function Z9(e){return e&&e.padAngle}function e7(e,t,n,i,r,o,s,a){var u=n-e,l=i-t,c=s-r,f=a-o,d=f*u-c*l;if(!(d*d<Ct))return d=(c*(t-o)-f*(e-r))/d,[e+d*u,t+d*l]}function Lf(e,t,n,i,r,o,s){var a=e-n,u=t-i,l=(s?o:-o)/Ss(a*a+u*u),c=l*u,f=-l*a,d=e+c,h=t+f,g=n+c,p=i+f,m=(d+g)/2,y=(h+p)/2,b=g-d,x=p-h,v=b*b+x*x,w=r-o,S=d*p-g*h,_=(x<0?-1:1)*Ss(H9(0,w*w*v-S*S)),E=(S*x-b*_)/v,A=(-S*b-x*_)/v,k=(S*x+b*_)/v,$=(-S*b+x*_)/v,D=E-m,M=A-y,F=k-m,C=$-y;return D*D+M*M>F*F+C*C&&(E=k,A=$),{cx:E,cy:A,x01:-c,y01:-f,x11:E*(r/w-1),y11:A*(r/w-1)}}function t7(){var e=X9,t=K9,n=Ee(0),i=null,r=J9,o=Q9,s=Z9,a=null,u=Hg(l);function l(){var c,f,d=+e.apply(this,arguments),h=+t.apply(this,arguments),g=r.apply(this,arguments)-Zd,p=o.apply(this,arguments)-Zd,m=aS(p-g),y=p>g;if(a||(a=c=u()),h<d&&(f=h,h=d,d=f),!(h>Ct))a.moveTo(0,0);else if(m>lF-Ct)a.moveTo(h*os(g),h*Ni(g)),a.arc(0,0,h,g,p,!y),d>Ct&&(a.moveTo(d*os(p),d*Ni(p)),a.arc(0,0,d,p,g,y));else{var b=g,x=p,v=g,w=p,S=m,_=m,E=s.apply(this,arguments)/2,A=E>Ct&&(i?+i.apply(this,arguments):Ss(d*d+h*h)),k=zm(aS(h-d)/2,+n.apply(this,arguments)),$=k,D=k,M,F;if(A>Ct){var C=uS(A/d*Ni(E)),O=uS(A/h*Ni(E));(S-=C*2)>Ct?(C*=y?1:-1,v+=C,w-=C):(S=0,v=w=(g+p)/2),(_-=O*2)>Ct?(O*=y?1:-1,b+=O,x-=O):(_=0,b=x=(g+p)/2)}var q=h*os(b),G=h*Ni(b),K=d*os(w),ce=d*Ni(w);if(k>Ct){var Be=h*os(x),Qe=h*Ni(x),ot=d*os(v),jt=d*Ni(v),Xe;if(m<ru)if(Xe=e7(q,G,ot,jt,Be,Qe,K,ce)){var Zr=q-Xe[0],va=G-Xe[1],is=Be-Xe[0],X=Qe-Xe[1],le=1/Ni(G9((Zr*is+va*X)/(Ss(Zr*Zr+va*va)*Ss(is*is+X*X)))/2),de=Ss(Xe[0]*Xe[0]+Xe[1]*Xe[1]);$=zm(k,(d-de)/(le-1)),D=zm(k,(h-de)/(le+1))}else $=D=0}_>Ct?D>Ct?(M=Lf(ot,jt,q,G,h,D,y),F=Lf(Be,Qe,K,ce,h,D,y),a.moveTo(M.cx+M.x01,M.cy+M.y01),D<k?a.arc(M.cx,M.cy,D,$t(M.y01,M.x01),$t(F.y01,F.x01),!y):(a.arc(M.cx,M.cy,D,$t(M.y01,M.x01),$t(M.y11,M.x11),!y),a.arc(0,0,h,$t(M.cy+M.y11,M.cx+M.x11),$t(F.cy+F.y11,F.cx+F.x11),!y),a.arc(F.cx,F.cy,D,$t(F.y11,F.x11),$t(F.y01,F.x01),!y))):(a.moveTo(q,G),a.arc(0,0,h,b,x,!y)):a.moveTo(q,G),!(d>Ct)||!(S>Ct)?a.lineTo(K,ce):$>Ct?(M=Lf(K,ce,Be,Qe,d,-$,y),F=Lf(q,G,ot,jt,d,-$,y),a.lineTo(M.cx+M.x01,M.cy+M.y01),$<k?a.arc(M.cx,M.cy,$,$t(M.y01,M.x01),$t(F.y01,F.x01),!y):(a.arc(M.cx,M.cy,$,$t(M.y01,M.x01),$t(M.y11,M.x11),!y),a.arc(0,0,d,$t(M.cy+M.y11,M.cx+M.x11),$t(F.cy+F.y11,F.cx+F.x11),y),a.arc(F.cx,F.cy,$,$t(F.y11,F.x11),$t(F.y01,F.x01),!y))):a.arc(0,0,d,w,v,y)}if(a.closePath(),c)return a=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-ru/2;return[os(f)*c,Ni(f)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:Ee(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:Ee(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:Ee(+c),l):n},l.padRadius=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:Ee(+c),l):i},l.startAngle=function(c){return arguments.length?(r=typeof c=="function"?c:Ee(+c),l):r},l.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:Ee(+c),l):o},l.padAngle=function(c){return arguments.length?(s=typeof c=="function"?c:Ee(+c),l):s},l.context=function(c){return arguments.length?(a=c??null,l):a},l}function fF(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function dF(e){this._context=e}dF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function yx(e){return new dF(e)}function hF(e){return e[0]}function gF(e){return e[1]}function pF(e,t){var n=Ee(!0),i=null,r=yx,o=null,s=Hg(a);e=typeof e=="function"?e:e===void 0?hF:Ee(e),t=typeof t=="function"?t:t===void 0?gF:Ee(t);function a(u){var l,c=(u=fF(u)).length,f,d=!1,h;for(i==null&&(o=r(h=s())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+e(f,l,u),+t(f,l,u));if(h)return o=null,h+""||null}return a.x=function(u){return arguments.length?(e=typeof u=="function"?u:Ee(+u),a):e},a.y=function(u){return arguments.length?(t=typeof u=="function"?u:Ee(+u),a):t},a.defined=function(u){return arguments.length?(n=typeof u=="function"?u:Ee(!!u),a):n},a.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),a):r},a.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),a):i},a}function mF(e,t,n){var i=null,r=Ee(!0),o=null,s=yx,a=null,u=Hg(l);e=typeof e=="function"?e:e===void 0?hF:Ee(+e),t=typeof t=="function"?t:Ee(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?gF:Ee(+n);function l(f){var d,h,g,p=(f=fF(f)).length,m,y=!1,b,x=new Array(p),v=new Array(p);for(o==null&&(a=s(b=u())),d=0;d<=p;++d){if(!(d<p&&r(m=f[d],d,f))===y)if(y=!y)h=d,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),g=d-1;g>=h;--g)a.point(x[g],v[g]);a.lineEnd(),a.areaEnd()}y&&(x[d]=+e(m,d,f),v[d]=+t(m,d,f),a.point(i?+i(m,d,f):x[d],n?+n(m,d,f):v[d]))}if(b)return a=null,b+""||null}function c(){return pF().defined(r).curve(s).context(o)}return l.x=function(f){return arguments.length?(e=typeof f=="function"?f:Ee(+f),i=null,l):e},l.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Ee(+f),l):e},l.x1=function(f){return arguments.length?(i=f==null?null:typeof f=="function"?f:Ee(+f),l):i},l.y=function(f){return arguments.length?(t=typeof f=="function"?f:Ee(+f),n=null,l):t},l.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Ee(+f),l):t},l.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Ee(+f),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(i).y(t)},l.defined=function(f){return arguments.length?(r=typeof f=="function"?f:Ee(!!f),l):r},l.curve=function(f){return arguments.length?(s=f,o!=null&&(a=s(o)),l):s},l.context=function(f){return arguments.length?(f==null?o=a=null:a=s(o=f),l):o},l}const n7={draw(e,t){const n=Ss(t/ru);e.moveTo(n,0),e.arc(0,0,n,0,lF)}};function i7(e,t){let n=null,i=Hg(r);e=typeof e=="function"?e:Ee(e||n7),t=typeof t=="function"?t:Ee(t===void 0?64:+t);function r(){let o;if(n||(n=o=i()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),o)return n=null,o+""||null}return r.type=function(o){return arguments.length?(e=typeof o=="function"?o:Ee(o),r):e},r.size=function(o){return arguments.length?(t=typeof o=="function"?o:Ee(+o),r):t},r.context=function(o){return arguments.length?(n=o??null,r):n},r}function Mo(){}function eh(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Gg(e){this._context=e}Gg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:eh(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:eh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function r7(e){return new Gg(e)}function yF(e){this._context=e}yF.prototype={areaStart:Mo,areaEnd:Mo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:eh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function o7(e){return new yF(e)}function bF(e){this._context=e}bF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:eh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function s7(e){return new bF(e)}function xF(e,t){this._basis=new Gg(e),this._beta=t}xF.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],o=e[n]-i,s=t[n]-r,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(i+u*o),this._beta*t[a]+(1-this._beta)*(r+u*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const a7=function e(t){function n(i){return t===1?new Gg(i):new xF(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function th(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function bx(e,t){this._context=e,this._k=(1-t)/6}bx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:th(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:th(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const u7=function e(t){function n(i){return new bx(i,t)}return n.tension=function(i){return e(+i)},n}(0);function xx(e,t){this._context=e,this._k=(1-t)/6}xx.prototype={areaStart:Mo,areaEnd:Mo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:th(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const l7=function e(t){function n(i){return new xx(i,t)}return n.tension=function(i){return e(+i)},n}(0);function vx(e,t){this._context=e,this._k=(1-t)/6}vx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:th(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const c7=function e(t){function n(i){return new vx(i,t)}return n.tension=function(i){return e(+i)},n}(0);function wx(e,t,n){var i=e._x1,r=e._y1,o=e._x2,s=e._y2;if(e._l01_a>Ct){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,r=(r*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>Ct){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);o=(o*l+e._x1*e._l23_2a-t*e._l12_2a)/c,s=(s*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,o,s,e._x2,e._y2)}function vF(e,t){this._context=e,this._alpha=t}vF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:wx(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const f7=function e(t){function n(i){return t?new vF(i,t):new bx(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function wF(e,t){this._context=e,this._alpha=t}wF.prototype={areaStart:Mo,areaEnd:Mo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:wx(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const d7=function e(t){function n(i){return t?new wF(i,t):new xx(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function _F(e,t){this._context=e,this._alpha=t}_F.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:wx(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const h7=function e(t){function n(i){return t?new _F(i,t):new vx(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function SF(e){this._context=e}SF.prototype={areaStart:Mo,areaEnd:Mo,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function g7(e){return new SF(e)}function lS(e){return e<0?-1:1}function cS(e,t,n){var i=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(i||r<0&&-0),s=(n-e._y1)/(r||i<0&&-0),a=(o*r+s*i)/(i+r);return(lS(o)+lS(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(a))||0}function fS(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Pm(e,t,n){var i=e._x0,r=e._y0,o=e._x1,s=e._y1,a=(o-i)/3;e._context.bezierCurveTo(i+a,r+a*t,o-a,s-a*n,o,s)}function nh(e){this._context=e}nh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Pm(this,this._t0,fS(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Pm(this,fS(this,n=cS(this,e,t)),n);break;default:Pm(this,this._t0,n=cS(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function EF(e){this._context=new kF(e)}(EF.prototype=Object.create(nh.prototype)).point=function(e,t){nh.prototype.point.call(this,t,e)};function kF(e){this._context=e}kF.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,o){this._context.bezierCurveTo(t,e,i,n,o,r)}};function p7(e){return new nh(e)}function m7(e){return new EF(e)}function $F(e){this._context=e}$F.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=dS(e),r=dS(t),o=0,s=1;s<n;++o,++s)this._context.bezierCurveTo(i[0][o],r[0][o],i[1][o],r[1][o],e[s],t[s]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function dS(e){var t,n=e.length-1,i,r=new Array(n),o=new Array(n),s=new Array(n);for(r[0]=0,o[0]=2,s[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,o[t]=4,s[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,o[n-1]=7,s[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/o[t-1],o[t]-=i,s[t]-=i*s[t-1];for(r[n-1]=s[n-1]/o[n-1],t=n-2;t>=0;--t)r[t]=(s[t]-r[t+1])/o[t];for(o[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)o[t]=2*e[t+1]-r[t+1];return[r,o]}function y7(e){return new $F(e)}function Yg(e,t){this._context=e,this._t=t}Yg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function b7(e){return new Yg(e,.5)}function x7(e){return new Yg(e,0)}function v7(e){return new Yg(e,1)}function Eo(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const w7=()=>typeof Image<"u"?Image:null;function sr(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function qo(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const f1=Symbol("implicit");function _x(){var e=new M_,t=[],n=[],i=f1;function r(o){let s=e.get(o);if(s===void 0){if(i!==f1)return i;e.set(o,s=t.push(o)-1)}return n[s%n.length]}return r.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new M_;for(const s of o)e.has(s)||e.set(s,t.push(s)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return _x(t,n).unknown(i)},sr.apply(r,arguments),r}function ju(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Vc(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Wo(){}var Ps=.7,ou=1/Ps,qa="\\s*([+-]?\\d+)\\s*",pc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Wi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_7=/^#([0-9a-f]{3,8})$/,S7=new RegExp(`^rgb\\(${qa},${qa},${qa}\\)$`),E7=new RegExp(`^rgb\\(${Wi},${Wi},${Wi}\\)$`),k7=new RegExp(`^rgba\\(${qa},${qa},${qa},${pc}\\)$`),$7=new RegExp(`^rgba\\(${Wi},${Wi},${Wi},${pc}\\)$`),A7=new RegExp(`^hsl\\(${pc},${Wi},${Wi}\\)$`),C7=new RegExp(`^hsla\\(${pc},${Wi},${Wi},${pc}\\)$`),hS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ju(Wo,mc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:gS,formatHex:gS,formatHex8:M7,formatHsl:F7,formatRgb:pS,toString:pS});function gS(){return this.rgb().formatHex()}function M7(){return this.rgb().formatHex8()}function F7(){return AF(this).formatHsl()}function pS(){return this.rgb().formatRgb()}function mc(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=_7.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?mS(t):n===3?new at(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?If(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?If(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=S7.exec(e))?new at(t[1],t[2],t[3],1):(t=E7.exec(e))?new at(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=k7.exec(e))?If(t[1],t[2],t[3],t[4]):(t=$7.exec(e))?If(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=A7.exec(e))?xS(t[1],t[2]/100,t[3]/100,1):(t=C7.exec(e))?xS(t[1],t[2]/100,t[3]/100,t[4]):hS.hasOwnProperty(e)?mS(hS[e]):e==="transparent"?new at(NaN,NaN,NaN,0):null}function mS(e){return new at(e>>16&255,e>>8&255,e&255,1)}function If(e,t,n,i){return i<=0&&(e=t=n=NaN),new at(e,t,n,i)}function Sx(e){return e instanceof Wo||(e=mc(e)),e?(e=e.rgb(),new at(e.r,e.g,e.b,e.opacity)):new at}function Fo(e,t,n,i){return arguments.length===1?Sx(e):new at(e,t,n,i??1)}function at(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}ju(at,Fo,Vc(Wo,{brighter(e){return e=e==null?ou:Math.pow(ou,e),new at(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ps:Math.pow(Ps,e),new at(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new at(Ms(this.r),Ms(this.g),Ms(this.b),ih(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yS,formatHex:yS,formatHex8:T7,formatRgb:bS,toString:bS}));function yS(){return`#${Es(this.r)}${Es(this.g)}${Es(this.b)}`}function T7(){return`#${Es(this.r)}${Es(this.g)}${Es(this.b)}${Es((isNaN(this.opacity)?1:this.opacity)*255)}`}function bS(){const e=ih(this.opacity);return`${e===1?"rgb(":"rgba("}${Ms(this.r)}, ${Ms(this.g)}, ${Ms(this.b)}${e===1?")":`, ${e})`}`}function ih(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ms(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Es(e){return e=Ms(e),(e<16?"0":"")+e.toString(16)}function xS(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ai(e,t,n,i)}function AF(e){if(e instanceof ai)return new ai(e.h,e.s,e.l,e.opacity);if(e instanceof Wo||(e=mc(e)),!e)return new ai;if(e instanceof ai)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),s=NaN,a=o-r,u=(o+r)/2;return a?(t===o?s=(n-i)/a+(n<i)*6:n===o?s=(i-t)/a+2:s=(t-n)/a+4,a/=u<.5?o+r:2-o-r,s*=60):a=u>0&&u<1?0:s,new ai(s,a,u,e.opacity)}function rh(e,t,n,i){return arguments.length===1?AF(e):new ai(e,t,n,i??1)}function ai(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}ju(ai,rh,Vc(Wo,{brighter(e){return e=e==null?ou:Math.pow(ou,e),new ai(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ps:Math.pow(Ps,e),new ai(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new at(Lm(e>=240?e-240:e+120,r,i),Lm(e,r,i),Lm(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new ai(vS(this.h),Bf(this.s),Bf(this.l),ih(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ih(this.opacity);return`${e===1?"hsl(":"hsla("}${vS(this.h)}, ${Bf(this.s)*100}%, ${Bf(this.l)*100}%${e===1?")":`, ${e})`}`}}));function vS(e){return e=(e||0)%360,e<0?e+360:e}function Bf(e){return Math.max(0,Math.min(1,e||0))}function Lm(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const CF=Math.PI/180,MF=180/Math.PI,oh=18,FF=.96422,TF=1,DF=.82521,NF=4/29,Wa=6/29,OF=3*Wa*Wa,D7=Wa*Wa*Wa;function RF(e){if(e instanceof Hi)return new Hi(e.l,e.a,e.b,e.opacity);if(e instanceof Cr)return zF(e);e instanceof at||(e=Sx(e));var t=Um(e.r),n=Um(e.g),i=Um(e.b),r=Im((.2225045*t+.7168786*n+.0606169*i)/TF),o,s;return t===n&&n===i?o=s=r:(o=Im((.4360747*t+.3850649*n+.1430804*i)/FF),s=Im((.0139322*t+.0971045*n+.7141733*i)/DF)),new Hi(116*r-16,500*(o-r),200*(r-s),e.opacity)}function sh(e,t,n,i){return arguments.length===1?RF(e):new Hi(e,t,n,i??1)}function Hi(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}ju(Hi,sh,Vc(Wo,{brighter(e){return new Hi(this.l+oh*(e??1),this.a,this.b,this.opacity)},darker(e){return new Hi(this.l-oh*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=FF*Bm(t),e=TF*Bm(e),n=DF*Bm(n),new at(jm(3.1338561*t-1.6168667*e-.4906146*n),jm(-.9787684*t+1.9161415*e+.033454*n),jm(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Im(e){return e>D7?Math.pow(e,1/3):e/OF+NF}function Bm(e){return e>Wa?e*e*e:OF*(e-NF)}function jm(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Um(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function N7(e){if(e instanceof Cr)return new Cr(e.h,e.c,e.l,e.opacity);if(e instanceof Hi||(e=RF(e)),e.a===0&&e.b===0)return new Cr(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*MF;return new Cr(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function ah(e,t,n,i){return arguments.length===1?N7(e):new Cr(e,t,n,i??1)}function Cr(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function zF(e){if(isNaN(e.h))return new Hi(e.l,0,0,e.opacity);var t=e.h*CF;return new Hi(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}ju(Cr,ah,Vc(Wo,{brighter(e){return new Cr(this.h,this.c,this.l+oh*(e??1),this.opacity)},darker(e){return new Cr(this.h,this.c,this.l-oh*(e??1),this.opacity)},rgb(){return zF(this).rgb()}}));var PF=-.14861,Ex=1.78277,kx=-.29227,Vg=-.90649,yc=1.97294,wS=yc*Vg,_S=yc*Ex,SS=Ex*kx-Vg*PF;function O7(e){if(e instanceof Fs)return new Fs(e.h,e.s,e.l,e.opacity);e instanceof at||(e=Sx(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(SS*i+wS*t-_S*n)/(SS+wS-_S),o=i-r,s=(yc*(n-r)-kx*o)/Vg,a=Math.sqrt(s*s+o*o)/(yc*r*(1-r)),u=a?Math.atan2(s,o)*MF-120:NaN;return new Fs(u<0?u+360:u,a,r,e.opacity)}function d1(e,t,n,i){return arguments.length===1?O7(e):new Fs(e,t,n,i??1)}function Fs(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}ju(Fs,d1,Vc(Wo,{brighter(e){return e=e==null?ou:Math.pow(ou,e),new Fs(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ps:Math.pow(Ps,e),new Fs(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*CF,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new at(255*(t+n*(PF*i+Ex*r)),255*(t+n*(kx*i+Vg*r)),255*(t+n*(yc*i)),this.opacity)}}));function LF(e,t,n,i,r){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*i+s*r)/6}function IF(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],o=e[i+1],s=i>0?e[i-1]:2*r-o,a=i<t-1?e[i+2]:2*o-r;return LF((n-i/t)*t,s,r,o,a)}}function BF(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],o=e[i%t],s=e[(i+1)%t],a=e[(i+2)%t];return LF((n-i/t)*t,r,o,s,a)}}const Xg=e=>()=>e;function jF(e,t){return function(n){return e+n*t}}function R7(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Kg(e,t){var n=t-e;return n?jF(e,n>180||n<-180?n-360*Math.round(n/360):n):Xg(isNaN(e)?t:e)}function z7(e){return(e=+e)==1?ut:function(t,n){return n-t?R7(t,n,e):Xg(isNaN(t)?n:t)}}function ut(e,t){var n=t-e;return n?jF(e,n):Xg(isNaN(e)?t:e)}const h1=function e(t){var n=z7(t);function i(r,o){var s=n((r=Fo(r)).r,(o=Fo(o)).r),a=n(r.g,o.g),u=n(r.b,o.b),l=ut(r.opacity,o.opacity);return function(c){return r.r=s(c),r.g=a(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function UF(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),o=new Array(n),s,a;for(s=0;s<n;++s)a=Fo(t[s]),i[s]=a.r||0,r[s]=a.g||0,o[s]=a.b||0;return i=e(i),r=e(r),o=e(o),a.opacity=1,function(u){return a.r=i(u),a.g=r(u),a.b=o(u),a+""}}}var P7=UF(IF),L7=UF(BF);function $x(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function qF(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function I7(e,t){return(qF(t)?$x:WF)(e,t)}function WF(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),o=new Array(n),s;for(s=0;s<i;++s)r[s]=Ho(e[s],t[s]);for(;s<n;++s)o[s]=t[s];return function(a){for(s=0;s<i;++s)o[s]=r[s](a);return o}}function HF(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function oi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function GF(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Ho(e[r],t[r]):i[r]=t[r];return function(o){for(r in n)i[r]=n[r](o);return i}}var g1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,qm=new RegExp(g1.source,"g");function B7(e){return function(){return e}}function j7(e){return function(t){return e(t)+""}}function YF(e,t){var n=g1.lastIndex=qm.lastIndex=0,i,r,o,s=-1,a=[],u=[];for(e=e+"",t=t+"";(i=g1.exec(e))&&(r=qm.exec(t));)(o=r.index)>n&&(o=t.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(i=i[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,u.push({i:s,x:oi(i,r)})),n=qm.lastIndex;return n<t.length&&(o=t.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?u[0]?j7(u[0].x):B7(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Ho(e,t){var n=typeof t,i;return t==null||n==="boolean"?Xg(t):(n==="number"?oi:n==="string"?(i=mc(t))?(t=i,h1):YF:t instanceof mc?h1:t instanceof Date?HF:qF(t)?$x:Array.isArray(t)?WF:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?GF:oi)(e,t)}function U7(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function q7(e,t){var n=Kg(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function Xc(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var ES=180/Math.PI,p1={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function VF(e,t,n,i,r,o){var s,a,u;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,u/=a),e*i<t*n&&(e=-e,t=-t,u=-u,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*ES,skewX:Math.atan(u)*ES,scaleX:s,scaleY:a}}var jf;function W7(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?p1:VF(t.a,t.b,t.c,t.d,t.e,t.f)}function H7(e){return e==null||(jf||(jf=document.createElementNS("http://www.w3.org/2000/svg","g")),jf.setAttribute("transform",e),!(e=jf.transform.baseVal.consolidate()))?p1:(e=e.matrix,VF(e.a,e.b,e.c,e.d,e.e,e.f))}function XF(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function o(l,c,f,d,h,g){if(l!==f||c!==d){var p=h.push("translate(",null,t,null,n);g.push({i:p-4,x:oi(l,f)},{i:p-2,x:oi(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function s(l,c,f,d){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:oi(l,c)})):c&&f.push(r(f)+"rotate("+c+i)}function a(l,c,f,d){l!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:oi(l,c)}):c&&f.push(r(f)+"skewX("+c+i)}function u(l,c,f,d,h,g){if(l!==f||c!==d){var p=h.push(r(h)+"scale(",null,",",null,")");g.push({i:p-4,x:oi(l,f)},{i:p-2,x:oi(c,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(l,c){var f=[],d=[];return l=e(l),c=e(c),o(l.translateX,l.translateY,c.translateX,c.translateY,f,d),s(l.rotate,c.rotate,f,d),a(l.skewX,c.skewX,f,d),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,d),l=c=null,function(h){for(var g=-1,p=d.length,m;++g<p;)f[(m=d[g]).i]=m.x(h);return f.join("")}}}var G7=XF(W7,"px, ","px)","deg)"),Y7=XF(H7,", ",")",")"),V7=1e-12;function kS(e){return((e=Math.exp(e))+1/e)/2}function X7(e){return((e=Math.exp(e))-1/e)/2}function K7(e){return((e=Math.exp(2*e))-1)/(e+1)}const J7=function e(t,n,i){function r(o,s){var a=o[0],u=o[1],l=o[2],c=s[0],f=s[1],d=s[2],h=c-a,g=f-u,p=h*h+g*g,m,y;if(p<V7)y=Math.log(d/l)/t,m=function(_){return[a+_*h,u+_*g,l*Math.exp(t*_*y)]};else{var b=Math.sqrt(p),x=(d*d-l*l+i*p)/(2*l*n*b),v=(d*d-l*l-i*p)/(2*d*n*b),w=Math.log(Math.sqrt(x*x+1)-x),S=Math.log(Math.sqrt(v*v+1)-v);y=(S-w)/t,m=function(_){var E=_*y,A=kS(w),k=l/(n*b)*(A*K7(t*E+w)-X7(w));return[a+k*h,u+k*g,l*A/kS(t*E+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return r.rho=function(o){var s=Math.max(.001,+o),a=s*s,u=a*a;return e(s,a,u)},r}(Math.SQRT2,2,4);function KF(e){return function(t,n){var i=e((t=rh(t)).h,(n=rh(n)).h),r=ut(t.s,n.s),o=ut(t.l,n.l),s=ut(t.opacity,n.opacity);return function(a){return t.h=i(a),t.s=r(a),t.l=o(a),t.opacity=s(a),t+""}}}const Q7=KF(Kg);var Z7=KF(ut);function eL(e,t){var n=ut((e=sh(e)).l,(t=sh(t)).l),i=ut(e.a,t.a),r=ut(e.b,t.b),o=ut(e.opacity,t.opacity);return function(s){return e.l=n(s),e.a=i(s),e.b=r(s),e.opacity=o(s),e+""}}function JF(e){return function(t,n){var i=e((t=ah(t)).h,(n=ah(n)).h),r=ut(t.c,n.c),o=ut(t.l,n.l),s=ut(t.opacity,n.opacity);return function(a){return t.h=i(a),t.c=r(a),t.l=o(a),t.opacity=s(a),t+""}}}const tL=JF(Kg);var nL=JF(ut);function QF(e){return function t(n){n=+n;function i(r,o){var s=e((r=d1(r)).h,(o=d1(o)).h),a=ut(r.s,o.s),u=ut(r.l,o.l),l=ut(r.opacity,o.opacity);return function(c){return r.h=s(c),r.s=a(c),r.l=u(Math.pow(c,n)),r.opacity=l(c),r+""}}return i.gamma=t,i}(1)}const iL=QF(Kg);var rL=QF(ut);function Ax(e,t){t===void 0&&(t=e,e=Ho);for(var n=0,i=t.length-1,r=t[0],o=new Array(i<0?0:i);n<i;)o[n]=e(r,r=t[++n]);return function(s){var a=Math.max(0,Math.min(i-1,Math.floor(s*=i)));return o[a](s-a)}}function oL(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}const sL=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Ho,interpolateArray:I7,interpolateBasis:IF,interpolateBasisClosed:BF,interpolateCubehelix:iL,interpolateCubehelixLong:rL,interpolateDate:HF,interpolateDiscrete:U7,interpolateHcl:tL,interpolateHclLong:nL,interpolateHsl:Q7,interpolateHslLong:Z7,interpolateHue:q7,interpolateLab:eL,interpolateNumber:oi,interpolateNumberArray:$x,interpolateObject:GF,interpolateRgb:h1,interpolateRgbBasis:P7,interpolateRgbBasisClosed:L7,interpolateRound:Xc,interpolateString:YF,interpolateTransformCss:G7,interpolateTransformSvg:Y7,interpolateZoom:J7,piecewise:Ax,quantize:oL},Symbol.toStringTag,{value:"Module"}));function aL(e){return function(){return e}}function m1(e){return+e}var $S=[0,1];function dn(e){return e}function y1(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:aL(isNaN(t)?NaN:.5)}function uL(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function lL(e,t,n){var i=e[0],r=e[1],o=t[0],s=t[1];return r<i?(i=y1(r,i),o=n(s,o)):(i=y1(i,r),o=n(o,s)),function(a){return o(i(a))}}function cL(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),o=new Array(i),s=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<i;)r[s]=y1(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(a){var u=Wc(e,a,1,i)-1;return o[u](r[u](a))}}function Kc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Jg(){var e=$S,t=$S,n=Ho,i,r,o,s=dn,a,u,l;function c(){var d=Math.min(e.length,t.length);return s!==dn&&(s=uL(e[0],e[d-1])),a=d>2?cL:lL,u=l=null,f}function f(d){return d==null||isNaN(d=+d)?o:(u||(u=a(e.map(i),t,n)))(i(s(d)))}return f.invert=function(d){return s(r((l||(l=a(t,e.map(i),oi)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,m1),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=Xc,c()},f.clamp=function(d){return arguments.length?(s=d?!0:dn,c()):s!==dn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(o=d,f):o},function(d,h){return i=d,r=h,c()}}function ZF(){return Jg()(dn,dn)}function uh(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function su(e){return e=uh(Math.abs(e)),e?e[1]:NaN}function fL(e,t){return function(n,i){for(var r=n.length,o=[],s=0,a=e[0],u=0;r>0&&a>0&&(u+a+1>i&&(a=Math.max(1,i-u)),o.push(n.substring(r-=a,r+a)),!((u+=a+1)>i));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function dL(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var hL=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function bc(e){return new Cx(e)}bc.prototype=Cx.prototype;function Cx(e){if(!(t=hL.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}Cx.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function gL(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(i>0){if(!+e[n])break e;i=0}break}return i>0?e.slice(0,i)+e.slice(r+1):e}var e3;function pL(e,t){var n=uh(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(e3=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+uh(e,Math.max(0,t+o-1))[0]}function AS(e,t){var n=uh(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const CS={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return AS(e*100,t)},r:AS,s:pL,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function MS(e){return e}var FS=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function mL(e){var t=e.grouping&&e.thousands?fL(e.grouping,e.thousands):MS,n=e.currency,i=e.decimal,r=e.numerals?dL(e.numerals):MS,o=e.percent||"%";function s(u){u=bc(u);var l=u.fill,c=u.align,f=u.sign,d=u.symbol,h=u.zero,g=u.width,p=u.comma,m=u.precision,y=u.trim,b=u.type;b==="n"?(p=!0,b="g"):CS[b]||(m==null&&(m=12),y=!0,b="g"),(h||l==="0"&&c==="=")&&(h=!0,l="0",c="=");var x=d==="$"?n[0]:d==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",v=d==="$"?n[1]:/[%p]/.test(b)?o:"",w=CS[b],S=/[defgprs%]/.test(b);m=m==null?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m));function _(E){var A=x,k=v,$,D,M;if(b==="c")k=w(E)+k,E="";else{E=+E;var F=E<0;if(E=w(Math.abs(E),m),y&&(E=gL(E)),F&&+E==0&&(F=!1),A=(F?f==="("?f:"-":f==="-"||f==="("?"":f)+A,k=(b==="s"?FS[8+e3/3]:"")+k+(F&&f==="("?")":""),S){for($=-1,D=E.length;++$<D;)if(M=E.charCodeAt($),48>M||M>57){k=(M===46?i+E.slice($+1):E.slice($))+k,E=E.slice(0,$);break}}}p&&!h&&(E=t(E,1/0));var C=A.length+E.length+k.length,O=C<g?new Array(g-C+1).join(l):"";switch(p&&h&&(E=t(O+E,O.length?g-k.length:1/0),O=""),c){case"<":E=A+E+k+O;break;case"=":E=A+O+E+k;break;case"^":E=O.slice(0,C=O.length>>1)+A+E+k+O.slice(C);break;default:E=O+A+E+k;break}return r(E)}return _.toString=function(){return u+""},_}function a(u,l){var c=s((u=bc(u),u.type="f",u)),f=Math.max(-8,Math.min(8,Math.floor(su(l)/3)))*3,d=Math.pow(10,-f),h=FS[8+f/3];return function(g){return c(d*g)+h}}return{format:s,formatPrefix:a}}var Uf,Mx,t3;yL({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function yL(e){return Uf=mL(e),Mx=Uf.format,t3=Uf.formatPrefix,Uf}function bL(e){return Math.max(0,-su(Math.abs(e)))}function xL(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(su(t)/3)))*3-su(Math.abs(e)))}function vL(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,su(t)-su(e))+1}function n3(e,t,n,i){var r=Ao(e,t,n),o;switch(i=bc(i??",f"),i.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(o=xL(r,s))&&(i.precision=o),t3(i,s)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=vL(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=bL(r))&&(i.precision=o-(i.type==="%")*2);break}}return Mx(i)}function ua(e){var t=e.domain;return e.ticks=function(n){var i=t();return X0(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return n3(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,o=i.length-1,s=i[r],a=i[o],u,l,c=10;for(a<s&&(l=s,s=a,a=l,l=r,r=o,o=l);c-- >0;){if(l=K0(s,a,n),l===u)return i[r]=s,i[o]=a,t(i);if(l>0)s=Math.floor(s/l)*l,a=Math.ceil(a/l)*l;else if(l<0)s=Math.ceil(s*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function i3(){var e=ZF();return e.copy=function(){return Kc(e,i3())},sr.apply(e,arguments),ua(e)}function r3(e){var t;function n(i){return i==null||isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,m1),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return r3(e).unknown(t)},e=arguments.length?Array.from(e,m1):[0,1],ua(n)}function o3(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],o=e[i],s;return o<r&&(s=n,n=i,i=s,s=r,r=o,o=s),e[n]=t.floor(r),e[i]=t.ceil(o),e}function TS(e){return Math.log(e)}function DS(e){return Math.exp(e)}function wL(e){return-Math.log(-e)}function _L(e){return-Math.exp(-e)}function SL(e){return isFinite(e)?+("1e"+e):e<0?0:e}function EL(e){return e===10?SL:e===Math.E?Math.exp:t=>Math.pow(e,t)}function kL(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function NS(e){return(t,n)=>-e(-t,n)}function Fx(e){const t=e(TS,DS),n=t.domain;let i=10,r,o;function s(){return r=kL(i),o=EL(i),n()[0]<0?(r=NS(r),o=NS(o),e(wL,_L)):e(TS,DS),t}return t.base=function(a){return arguments.length?(i=+a,s()):i},t.domain=function(a){return arguments.length?(n(a),s()):n()},t.ticks=a=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let d=r(l),h=r(c),g,p;const m=a==null?10:+a;let y=[];if(!(i%1)&&h-d<m){if(d=Math.floor(d),h=Math.ceil(h),l>0){for(;d<=h;++d)for(g=1;g<i;++g)if(p=d<0?g/o(-d):g*o(d),!(p<l)){if(p>c)break;y.push(p)}}else for(;d<=h;++d)for(g=i-1;g>=1;--g)if(p=d>0?g/o(-d):g*o(d),!(p<l)){if(p>c)break;y.push(p)}y.length*2<m&&(y=X0(l,c,m))}else y=X0(d,h,Math.min(h-d,m)).map(o);return f?y.reverse():y},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=i===10?"s":","),typeof u!="function"&&(!(i%1)&&(u=bc(u)).precision==null&&(u.trim=!0),u=Mx(u)),a===1/0)return u;const l=Math.max(1,i*a/t.ticks().length);return c=>{let f=c/o(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=l?u(c):""}},t.nice=()=>n(o3(n(),{floor:a=>o(Math.floor(r(a))),ceil:a=>o(Math.ceil(r(a)))})),t}function s3(){const e=Fx(Jg()).domain([1,10]);return e.copy=()=>Kc(e,s3()).base(e.base()),sr.apply(e,arguments),e}function OS(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function RS(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Tx(e){var t=1,n=e(OS(t),RS(t));return n.constant=function(i){return arguments.length?e(OS(t=+i),RS(t)):t},ua(n)}function a3(){var e=Tx(Jg());return e.copy=function(){return Kc(e,a3()).constant(e.constant())},sr.apply(e,arguments)}function zS(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function $L(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function AL(e){return e<0?-e*e:e*e}function Dx(e){var t=e(dn,dn),n=1;function i(){return n===1?e(dn,dn):n===.5?e($L,AL):e(zS(n),zS(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},ua(t)}function Nx(){var e=Dx(Jg());return e.copy=function(){return Kc(e,Nx()).exponent(e.exponent())},sr.apply(e,arguments),e}function CL(){return Nx.apply(null,arguments).exponent(.5)}function u3(){var e=[],t=[],n=[],i;function r(){var s=0,a=Math.max(1,t.length);for(n=new Array(a-1);++s<a;)n[s-1]=vC(e,s/a);return o}function o(s){return s==null||isNaN(s=+s)?i:t[Wc(n,s)]}return o.invertExtent=function(s){var a=t.indexOf(s);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let a of s)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Tr),r()},o.range=function(s){return arguments.length?(t=Array.from(s),r()):t.slice()},o.unknown=function(s){return arguments.length?(i=s,o):i},o.quantiles=function(){return n.slice()},o.copy=function(){return u3().domain(e).range(t).unknown(i)},sr.apply(o,arguments)}function l3(){var e=0,t=1,n=1,i=[.5],r=[0,1],o;function s(u){return u!=null&&u<=u?r[Wc(i,u,0,n)]:o}function a(){var u=-1;for(i=new Array(n);++u<n;)i[u]=((u+1)*t-(u-n)*e)/(n+1);return s}return s.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},s.range=function(u){return arguments.length?(n=(r=Array.from(u)).length-1,a()):r.slice()},s.invertExtent=function(u){var l=r.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,i[0]]:l>=n?[i[n-1],t]:[i[l-1],i[l]]},s.unknown=function(u){return arguments.length&&(o=u),s},s.thresholds=function(){return i.slice()},s.copy=function(){return l3().domain([e,t]).range(r).unknown(o)},sr.apply(ua(s),arguments)}function c3(){var e=[.5],t=[0,1],n,i=1;function r(o){return o!=null&&o<=o?t[Wc(e,o,0,i)]:n}return r.domain=function(o){return arguments.length?(e=Array.from(o),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(o){return arguments.length?(t=Array.from(o),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return c3().domain(e).range(t).unknown(n)},sr.apply(r,arguments)}function ML(e){return new Date(e)}function FL(e){return e instanceof Date?+e:+new Date(+e)}function Ox(e,t,n,i,r,o,s,a,u,l){var c=ZF(),f=c.invert,d=c.domain,h=l(".%L"),g=l(":%S"),p=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),b=l("%b %d"),x=l("%B"),v=l("%Y");function w(S){return(u(S)<S?h:a(S)<S?g:s(S)<S?p:o(S)<S?m:i(S)<S?r(S)<S?y:b:n(S)<S?x:v)(S)}return c.invert=function(S){return new Date(f(S))},c.domain=function(S){return arguments.length?d(Array.from(S,FL)):d().map(ML)},c.ticks=function(S){var _=d();return e(_[0],_[_.length-1],S??10)},c.tickFormat=function(S,_){return _==null?w:l(_)},c.nice=function(S){var _=d();return(!S||typeof S.range!="function")&&(S=t(_[0],_[_.length-1],S??10)),S?d(o3(_,S)):c},c.copy=function(){return Kc(c,Ox(e,t,n,i,r,o,s,a,u,l))},c}function TL(){return sr.apply(Ox(A8,C8,Ji,cc,zu,Dr,Mg,Ag,Ar,xb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function DL(){return sr.apply(Ox(k8,$8,Qi,fc,Pu,_o,Fg,Cg,Ar,vb).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Qg(){var e=0,t=1,n,i,r,o,s=dn,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:s(r===0?.5:(f=(o(f)-n)*r,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=o(e=+e),i=o(t=+t),r=n===i?0:1/(i-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(s=f,l):s};function c(f){return function(d){var h,g;return arguments.length?([h,g]=d,s=f(h,g),l):[s(0),s(1)]}}return l.range=c(Ho),l.rangeRound=c(Xc),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return o=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),l}}function Go(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Rx(){var e=ua(Qg()(dn));return e.copy=function(){return Go(e,Rx())},qo.apply(e,arguments)}function f3(){var e=Fx(Qg()).domain([1,10]);return e.copy=function(){return Go(e,f3()).base(e.base())},qo.apply(e,arguments)}function d3(){var e=Tx(Qg());return e.copy=function(){return Go(e,d3()).constant(e.constant())},qo.apply(e,arguments)}function zx(){var e=Dx(Qg());return e.copy=function(){return Go(e,zx()).exponent(e.exponent())},qo.apply(e,arguments)}function NL(){return zx.apply(null,arguments).exponent(.5)}function Zg(){var e=0,t=.5,n=1,i=1,r,o,s,a,u,l=dn,c,f=!1,d;function h(p){return isNaN(p=+p)?d:(p=.5+((p=+c(p))-o)*(i*p<i*o?a:u),l(f?Math.max(0,Math.min(1,p)):p))}h.domain=function(p){return arguments.length?([e,t,n]=p,r=c(e=+e),o=c(t=+t),s=c(n=+n),a=r===o?0:.5/(o-r),u=o===s?0:.5/(s-o),i=o<r?-1:1,h):[e,t,n]},h.clamp=function(p){return arguments.length?(f=!!p,h):f},h.interpolator=function(p){return arguments.length?(l=p,h):l};function g(p){return function(m){var y,b,x;return arguments.length?([y,b,x]=m,l=Ax(p,[y,b,x]),h):[l(0),l(.5),l(1)]}}return h.range=g(Ho),h.rangeRound=g(Xc),h.unknown=function(p){return arguments.length?(d=p,h):d},function(p){return c=p,r=p(e),o=p(t),s=p(n),a=r===o?0:.5/(o-r),u=o===s?0:.5/(s-o),i=o<r?-1:1,h}}function h3(){var e=ua(Zg()(dn));return e.copy=function(){return Go(e,h3())},qo.apply(e,arguments)}function g3(){var e=Fx(Zg()).domain([.1,1,10]);return e.copy=function(){return Go(e,g3()).base(e.base())},qo.apply(e,arguments)}function p3(){var e=Tx(Zg());return e.copy=function(){return Go(e,p3()).constant(e.constant())},qo.apply(e,arguments)}function Px(){var e=Dx(Zg());return e.copy=function(){return Go(e,Px()).exponent(e.exponent())},qo.apply(e,arguments)}function OL(){return Px.apply(null,arguments).exponent(.5)}function Lx(e,t,n){const i=e-t+n*2;return e?i>0?i:1:0}const RL="identity",au="linear",Ir="log",Jc="pow",Qc="sqrt",ep="symlog",Ls="time",Is="utc",Gi="sequential",Uu="diverging",uu="quantile",tp="quantize",np="threshold",Ix="ordinal",b1="point",m3="band",Bx="bin-ordinal",rt="continuous",Zc="discrete",ef="discretizing",Qn="interpolating",jx="temporal";function zL(e){return function(t){let n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function PL(e){return function(t){const n=e.range();let i=t[0],r=t[1],o=-1,s,a,u,l;for(r<i&&(a=i,i=r,r=a),u=0,l=n.length;u<l;++u)n[u]>=i&&n[u]<=r&&(o<0&&(o=u),s=u);if(!(o<0))return i=e.invertExtent(n[o]),r=e.invertExtent(n[s]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]]}}function Ux(){const e=_x().unknown(void 0),t=e.domain,n=e.range;let i=[0,1],r,o,s=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,d=i[1]<i[0],h=i[1-d],g=Lx(f,a,u);let p=i[d-0];r=(h-p)/(g||1),s&&(r=Math.floor(r)),p+=(h-p-r*(f-a))*l,o=r*(1-a),s&&(p=Math.round(p),o=Math.round(o));const m=Tn(f).map(y=>p+r*y);return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],s=!0,c()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(f){return arguments.length?(s=!!f,c()):s},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const d=i[1]<i[0],h=d?n().reverse():n(),g=h.length-1;let p=+f[0],m=+f[1],y,b,x;if(!(p!==p||m!==m)&&(m<p&&(x=p,p=m,m=x),!(m<h[0]||p>i[1-d])))return y=Math.max(0,Hd(h,p)-1),b=p===m?y:Hd(h,m)-1,p-h[y]>o+1e-10&&++y,d&&(x=y,y=g-b,b=g-x),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return Ux().domain(t()).range(i).round(s).paddingInner(a).paddingOuter(u).align(l)},c()}function y3(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return y3(t())},e}function LL(){return y3(Ux().paddingInner(1))}var IL=Array.prototype.map;function BL(e){return IL.call(e,Dt)}const jL=Array.prototype.slice;function b3(){let e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(Wc(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=BL(i),n):e.slice()},n.range=function(i){return arguments.length?(t=jL.call(i),n):t.slice()},n.tickFormat=function(i,r){return n3(e[0],ye(e),i??10,r)},n.copy=function(){return b3().domain(n.domain()).range(n.range())},n}const lh=new Map,x3=Symbol("vega_scale");function v3(e){return e[x3]=!0,e}function UL(e){return e&&e[x3]===!0}function qL(e,t,n){const i=function(){const o=t();return o.invertRange||(o.invertRange=o.invert?zL(o):o.invertExtent?PL(o):void 0),o.type=e,v3(o)};return i.metadata=vi(H(n)),i}function we(e,t,n){return arguments.length>1?(lh.set(e,qL(e,t,n)),this):w3(e)?lh.get(e):void 0}we(RL,r3);we(au,i3,rt);we(Ir,s3,[rt,Ir]);we(Jc,Nx,rt);we(Qc,CL,rt);we(ep,a3,rt);we(Ls,TL,[rt,jx]);we(Is,DL,[rt,jx]);we(Gi,Rx,[rt,Qn]);we(`${Gi}-${au}`,Rx,[rt,Qn]);we(`${Gi}-${Ir}`,f3,[rt,Qn,Ir]);we(`${Gi}-${Jc}`,zx,[rt,Qn]);we(`${Gi}-${Qc}`,NL,[rt,Qn]);we(`${Gi}-${ep}`,d3,[rt,Qn]);we(`${Uu}-${au}`,h3,[rt,Qn]);we(`${Uu}-${Ir}`,g3,[rt,Qn,Ir]);we(`${Uu}-${Jc}`,Px,[rt,Qn]);we(`${Uu}-${Qc}`,OL,[rt,Qn]);we(`${Uu}-${ep}`,p3,[rt,Qn]);we(uu,u3,[ef,uu]);we(tp,l3,ef);we(np,c3,ef);we(Bx,b3,[Zc,ef]);we(Ix,_x,Zc);we(m3,Ux,Zc);we(b1,LL,Zc);function w3(e){return lh.has(e)}function la(e,t){const n=lh.get(e);return n&&n.metadata[t]}function qx(e){return la(e,rt)}function lu(e){return la(e,Zc)}function x1(e){return la(e,ef)}function _3(e){return la(e,Ir)}function WL(e){return la(e,jx)}function S3(e){return la(e,Qn)}function E3(e){return la(e,uu)}const HL=["clamp","base","constant","exponent"];function k3(e,t){const n=t[0],i=ye(t)-n;return function(r){return e(n+r*i)}}function ip(e,t,n){return Ax(Wx(t||"rgb",n),e)}function $3(e,t){const n=new Array(t),i=t+1;for(let r=0;r<t;)n[r]=e(++r/i);return n}function A3(e,t,n){const i=n-t;let r,o,s;return!i||!Number.isFinite(i)?Bt(.5):(r=(o=e.type).indexOf("-"),o=r<0?o:o.slice(r+1),s=we(o)().domain([t,n]).range([0,1]),HL.forEach(a=>e[a]?s[a](e[a]()):0),s)}function Wx(e,t){const n=sL[GL(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function GL(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const YL={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},VL={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function C3(e){const t=e.length/6|0,n=new Array(t);for(let i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function M3(e,t){for(const n in e)Hx(n,t(e[n]))}const PS={};M3(VL,C3);M3(YL,e=>ip(C3(e)));function Hx(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(PS[e]=t,this):PS[e]}const vd="symbol",XL="discrete",KL="gradient",JL=e=>z(e)?e.map(t=>String(t)):String(e),QL=(e,t)=>e[1]-t[1],ZL=(e,t)=>t[1]-e[1];function Gx(e,t,n){let i;return Ae(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Uc(e.domain())/n||1)))),V(t)&&(i=t.step,t=t.interval),Y(t)&&(t=e.type===Ls?Lu(t):e.type==Is?Iu(t):R("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function F3(e,t,n){let i=e.range(),r=i[0],o=ye(i),s=QL;if(r>o&&(i=o,o=r,r=i,s=ZL),r=Math.floor(r),o=Math.ceil(o),t=t.map(a=>[a,e(a)]).filter(a=>r<=a[1]&&a[1]<=o).sort(s).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],ye(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function Yx(e,t){return e.bins?F3(e,e.bins):e.ticks?e.ticks(t):e.domain()}function T3(e,t,n,i,r,o){const s=t.type;let a=JL;if(s===Ls||r===Ls)a=e.timeFormat(i);else if(s===Is||r===Is)a=e.utcFormat(i);else if(_3(s)){const u=e.formatFloat(i);if(o||t.bins)a=u;else{const l=D3(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,i)}else i&&(a=e.format(i));return a}function D3(e,t,n){const i=Yx(e,t),r=e.base(),o=Math.log(r),s=Math.max(1,r*t/i.length),a=u=>{let l=u/Math.pow(r,Math.round(Math.log(u)/o));return l*r<r-.5&&(l*=r),l<=s};return n?i.filter(a):a}const v1={[uu]:"quantiles",[tp]:"thresholds",[np]:"domain"},N3={[uu]:"quantiles",[tp]:"domain"};function O3(e,t){return e.bins?nI(e.bins):e.type===Ir?D3(e,t,!0):v1[e.type]?tI(e[v1[e.type]]()):Yx(e,t)}function eI(e,t,n){const i=t[N3[t.type]](),r=i.length;let o=r>1?i[1]-i[0]:i[0],s;for(s=1;s<r;++s)o=Math.min(o,i[s]-i[s-1]);return e.formatSpan(0,o,3*10,n)}function tI(e){const t=[-1/0].concat(e);return t.max=1/0,t}function nI(e){const t=e.slice(0,-1);return t.max=ye(e),t}const iI=e=>v1[e.type]||e.bins;function R3(e,t,n,i,r,o,s){const a=N3[t.type]&&o!==Ls&&o!==Is?eI(e,t,r):T3(e,t,n,r,o,s);return i===vd&&iI(t)?rI(a):i===XL?oI(a):sI(a)}const rI=e=>(t,n,i)=>{const r=LS(i[n+1],LS(i.max,1/0)),o=IS(t,e),s=IS(r,e);return o&&s?o+" – "+s:s?"< "+s:"≥ "+o},LS=(e,t)=>e??t,oI=e=>(t,n)=>n?e(t):null,sI=e=>t=>e(t),IS=(e,t)=>Number.isFinite(e)?t(e):null;function aI(e){const t=e.domain(),n=t.length-1;let i=+t[0],r=+ye(t),o=r-i;if(e.type===np){const s=n?o/n:.1;i-=s,r+=s,o=r-i}return s=>(s-i)/o}function uI(e,t,n,i){const r=i||t.type;return Y(n)&&WL(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===Ls?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===Is?e.utcFormat("%A, %d %B %Y, %X UTC"):R3(e,t,5,null,n,i,!0)}function z3(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=uI(e,t,n.format,n.formatType);if(x1(t.type)){const o=O3(t).slice(1).map(r),s=o.length;return`${s} boundar${s===1?"y":"ies"}: ${o.join(", ")}`}else if(lu(t.type)){const o=t.domain(),s=o.length,a=s>i?o.slice(0,i-2).map(r).join(", ")+", ending with "+o.slice(-1).map(r):o.map(r).join(", ");return`${s} value${s===1?"":"s"}: ${a}`}else{const o=t.domain();return`values from ${r(o[0])} to ${r(ye(o))}`}}let P3=0;function lI(){P3=0}const ch="p_";function Vx(e){return e&&e.gradient}function L3(e,t,n){const i=e.gradient;let r=e.id,o=i==="radial"?ch:"";return r||(r=e.id="gradient_"+P3++,i==="radial"?(e.x1=Oi(e.x1,.5),e.y1=Oi(e.y1,.5),e.r1=Oi(e.r1,0),e.x2=Oi(e.x2,.5),e.y2=Oi(e.y2,.5),e.r2=Oi(e.r2,.5),o=ch):(e.x1=Oi(e.x1,0),e.y1=Oi(e.y1,0),e.x2=Oi(e.x2,1),e.y2=Oi(e.y2,0))),t[r]=e,"url("+(n||"")+"#"+o+r+")"}function Oi(e,t){return e??t}function I3(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,o){return n.push({offset:r,color:o}),i}}}const BS={basis:{curve:r7},"basis-closed":{curve:o7},"basis-open":{curve:s7},bundle:{curve:a7,tension:"beta",value:.85},cardinal:{curve:u7,tension:"tension",value:0},"cardinal-open":{curve:c7,tension:"tension",value:0},"cardinal-closed":{curve:l7,tension:"tension",value:0},"catmull-rom":{curve:f7,tension:"alpha",value:.5},"catmull-rom-closed":{curve:d7,tension:"alpha",value:.5},"catmull-rom-open":{curve:h7,tension:"alpha",value:.5},linear:{curve:yx},"linear-closed":{curve:g7},monotone:{horizontal:m7,vertical:p7},natural:{curve:y7},step:{curve:b7},"step-after":{curve:v7},"step-before":{curve:x7}};function Xx(e,t,n){var i=ne(BS,e)&&BS[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}const cI={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},fI=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,dI=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,hI=/^((\s+,?\s*)|(,\s*))/,gI=/^[01]/;function cu(e){const t=[];return(e.match(fI)||[]).forEach(i=>{let r=i[0];const o=r.toLowerCase(),s=cI[o],a=pI(o,s,i.slice(1).trim()),u=a.length;if(u<s||u&&u%s!==0)throw Error("Invalid SVG path, incorrect parameter count");if(t.push([r,...a.slice(0,s)]),u!==s){o==="m"&&(r=r==="M"?"L":"l");for(let l=s;l<u;l+=s)t.push([r,...a.slice(l,l+s)])}}),t}function pI(e,t,n){const i=[];for(let r=0;t&&r<n.length;)for(let o=0;o<t;++o){const s=e==="a"&&(o===3||o===4)?gI:dI,a=n.slice(r).match(s);if(a===null)throw Error("Invalid SVG path, incorrect parameter type");r+=a[0].length,i.push(+a[0]);const u=n.slice(r).match(hI);u!==null&&(r+=u[0].length)}return i}const To=Math.PI/180,mI=1e-14,xs=Math.PI/2,Ii=Math.PI*2,Sa=Math.sqrt(3)/2;var Wm={},Hm={},B3=[].join;function yI(e,t,n,i,r,o,s,a,u){const l=B3.call(arguments);if(Wm[l])return Wm[l];const c=s*To,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),i=Math.abs(i);const h=d*(a-e)*.5+f*(u-t)*.5,g=d*(u-t)*.5-f*(a-e)*.5;let p=h*h/(n*n)+g*g/(i*i);p>1&&(p=Math.sqrt(p),n*=p,i*=p);const m=d/n,y=f/n,b=-f/i,x=d/i,v=m*a+y*u,w=b*a+x*u,S=m*e+y*t,_=b*e+x*t;let A=1/((S-v)*(S-v)+(_-w)*(_-w))-.25;A<0&&(A=0);let k=Math.sqrt(A);o==r&&(k=-k);const $=.5*(v+S)-k*(_-w),D=.5*(w+_)+k*(S-v),M=Math.atan2(w-D,v-$);let C=Math.atan2(_-D,S-$)-M;C<0&&o===1?C+=Ii:C>0&&o===0&&(C-=Ii);const O=Math.ceil(Math.abs(C/(xs+.001))),q=[];for(let G=0;G<O;++G){const K=M+G*C/O,ce=M+(G+1)*C/O;q[G]=[$,D,K,ce,n,i,f,d]}return Wm[l]=q}function bI(e){const t=B3.call(e);if(Hm[t])return Hm[t];var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7];const c=l*s,f=-u*a,d=u*s,h=l*a,g=Math.cos(r),p=Math.sin(r),m=Math.cos(o),y=Math.sin(o),b=.5*(o-r),x=Math.sin(b*.5),v=8/3*x*x/Math.sin(b),w=n+g-v*p,S=i+p+v*g,_=n+m,E=i+y,A=_+v*y,k=E-v*m;return Hm[t]=[c*w+f*S,d*w+h*S,c*A+f*k,d*A+h*k,c*_+f*E,d*_+h*E]}const Ln=["l",0,0,0,0,0,0,0];function xI(e,t,n){const i=Ln[0]=e[0];if(i==="a"||i==="A")Ln[1]=t*e[1],Ln[2]=n*e[2],Ln[3]=e[3],Ln[4]=e[4],Ln[5]=e[5],Ln[6]=t*e[6],Ln[7]=n*e[7];else if(i==="h"||i==="H")Ln[1]=t*e[1];else if(i==="v"||i==="V")Ln[1]=n*e[1];else for(var r=1,o=e.length;r<o;++r)Ln[r]=(r%2==1?t:n)*e[r];return Ln}function xc(e,t,n,i,r,o){var s,a=null,u=0,l=0,c=0,f=0,d,h,g,p,m=0,y=0;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),o==null&&(o=r),e.beginPath&&e.beginPath();for(var b=0,x=t.length;b<x;++b){switch(s=t[b],(r!==1||o!==1)&&(s=xI(s,r,o)),s[0]){case"l":u+=s[1],l+=s[2],e.lineTo(u+n,l+i);break;case"L":u=s[1],l=s[2],e.lineTo(u+n,l+i);break;case"h":u+=s[1],e.lineTo(u+n,l+i);break;case"H":u=s[1],e.lineTo(u+n,l+i);break;case"v":l+=s[1],e.lineTo(u+n,l+i);break;case"V":l=s[1],e.lineTo(u+n,l+i);break;case"m":u+=s[1],l+=s[2],m=u,y=l,e.moveTo(u+n,l+i);break;case"M":u=s[1],l=s[2],m=u,y=l,e.moveTo(u+n,l+i);break;case"c":d=u+s[5],h=l+s[6],c=u+s[3],f=l+s[4],e.bezierCurveTo(u+s[1]+n,l+s[2]+i,c+n,f+i,d+n,h+i),u=d,l=h;break;case"C":u=s[5],l=s[6],c=s[3],f=s[4],e.bezierCurveTo(s[1]+n,s[2]+i,c+n,f+i,u+n,l+i);break;case"s":d=u+s[3],h=l+s[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,u+s[1]+n,l+s[2]+i,d+n,h+i),c=u+s[1],f=l+s[2],u=d,l=h;break;case"S":d=s[3],h=s[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,s[1]+n,s[2]+i,d+n,h+i),u=d,l=h,c=s[1],f=s[2];break;case"q":d=u+s[3],h=l+s[4],c=u+s[1],f=l+s[2],e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h;break;case"Q":d=s[3],h=s[4],e.quadraticCurveTo(s[1]+n,s[2]+i,d+n,h+i),u=d,l=h,c=s[1],f=s[2];break;case"t":d=u+s[1],h=l+s[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-g,f=2*l-p):a[0]==="q"&&(c=2*u-c,f=2*l-f),g=c,p=f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h,c=u+s[1],f=l+s[2];break;case"T":d=s[1],h=s[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h;break;case"a":jS(e,u+n,l+i,[s[1],s[2],s[3],s[4],s[5],s[6]+u+n,s[7]+l+i]),u+=s[6],l+=s[7];break;case"A":jS(e,u+n,l+i,[s[1],s[2],s[3],s[4],s[5],s[6]+n,s[7]+i]),u=s[6],l=s[7];break;case"z":case"Z":u=m,l=y,e.closePath();break}a=s}}function jS(e,t,n,i){const r=yI(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n);for(let o=0;o<r.length;++o){const s=bI(r[o]);e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5])}}const US=.5773502691896257,qS={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Ii)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,o=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-o),e.lineTo(r,-o),e.lineTo(0,-n),e.lineTo(-r,-o),e.lineTo(-i,-o),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Sa*n,r=i-n*US,o=n/4;e.moveTo(0,-i-r),e.lineTo(-o,i-r),e.lineTo(o,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Sa*n,r=i-n*US;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Sa*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Sa*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Sa*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Sa*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function j3(e){return ne(qS,e)?qS[e]:vI(e)}var Gm={};function vI(e){if(!ne(Gm,e)){const t=cu(e);Gm[e]={draw:function(n,i){xc(n,t,0,0,Math.sqrt(i)/2)}}}return Gm[e]}const eo=.448084975506;function wI(e){return e.x}function _I(e){return e.y}function SI(e){return e.width}function EI(e){return e.height}function yr(e){return typeof e=="function"?e:()=>+e}function qf(e,t,n){return Math.max(t,Math.min(e,n))}function U3(){var e=wI,t=_I,n=SI,i=EI,r=yr(0),o=r,s=r,a=r,u=null;function l(c,f,d){var h,g=f??+e.call(this,c),p=d??+t.call(this,c),m=+n.call(this,c),y=+i.call(this,c),b=Math.min(m,y)/2,x=qf(+r.call(this,c),0,b),v=qf(+o.call(this,c),0,b),w=qf(+s.call(this,c),0,b),S=qf(+a.call(this,c),0,b);if(u||(u=h=Wg()),x<=0&&v<=0&&w<=0&&S<=0)u.rect(g,p,m,y);else{var _=g+m,E=p+y;u.moveTo(g+x,p),u.lineTo(_-v,p),u.bezierCurveTo(_-eo*v,p,_,p+eo*v,_,p+v),u.lineTo(_,E-S),u.bezierCurveTo(_,E-eo*S,_-eo*S,E,_-S,E),u.lineTo(g+w,E),u.bezierCurveTo(g+eo*w,E,g,E-eo*w,g,E-w),u.lineTo(g,p+x),u.bezierCurveTo(g,p+eo*x,g+eo*x,p,g+x,p),u.closePath()}if(h)return u=null,h+""||null}return l.x=function(c){return arguments.length?(e=yr(c),l):e},l.y=function(c){return arguments.length?(t=yr(c),l):t},l.width=function(c){return arguments.length?(n=yr(c),l):n},l.height=function(c){return arguments.length?(i=yr(c),l):i},l.cornerRadius=function(c,f,d,h){return arguments.length?(r=yr(c),o=f!=null?yr(f):r,a=d!=null?yr(d):r,s=h!=null?yr(h):o,l):r},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function q3(){var e,t,n,i,r=null,o,s,a,u;function l(f,d,h){const g=h/2;if(o){var p=a-d,m=f-s;if(p||m){var y=Math.sqrt(p*p+m*m),b=(p/=y)*u,x=(m/=y)*u,v=Math.atan2(m,p);r.moveTo(s-b,a-x),r.lineTo(f-p*g,d-m*g),r.arc(f,d,g,v-Math.PI,v),r.lineTo(s+b,a+x),r.arc(s,a,u,v,v+Math.PI)}else r.arc(f,d,g,0,Ii);r.closePath()}else o=1;s=f,a=d,u=g}function c(f){var d,h=f.length,g,p=!1,m;for(r==null&&(r=m=Wg()),d=0;d<=h;++d)!(d<h&&i(g=f[d],d,f))===p&&(p=!p)&&(o=0),p&&l(+e(g,d,f),+t(g,d,f),+n(g,d,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function tf(e,t){return e??t}const nf=e=>e.x||0,rf=e=>e.y||0,kI=e=>e.width||0,$I=e=>e.height||0,AI=e=>(e.x||0)+(e.width||0),CI=e=>(e.y||0)+(e.height||0),MI=e=>e.startAngle||0,FI=e=>e.endAngle||0,TI=e=>e.padAngle||0,DI=e=>e.innerRadius||0,NI=e=>e.outerRadius||0,OI=e=>e.cornerRadius||0,RI=e=>tf(e.cornerRadiusTopLeft,e.cornerRadius)||0,zI=e=>tf(e.cornerRadiusTopRight,e.cornerRadius)||0,PI=e=>tf(e.cornerRadiusBottomRight,e.cornerRadius)||0,LI=e=>tf(e.cornerRadiusBottomLeft,e.cornerRadius)||0,II=e=>tf(e.size,64),BI=e=>e.size||1,rp=e=>e.defined!==!1,jI=e=>j3(e.shape||"circle"),UI=t7().startAngle(MI).endAngle(FI).padAngle(TI).innerRadius(DI).outerRadius(NI).cornerRadius(OI),qI=mF().x(nf).y1(rf).y0(CI).defined(rp),WI=mF().y(rf).x1(nf).x0(AI).defined(rp),HI=pF().x(nf).y(rf).defined(rp),GI=U3().x(nf).y(rf).width(kI).height($I).cornerRadius(RI,zI,PI,LI),YI=i7().type(jI).size(II),VI=q3().x(nf).y(rf).defined(rp).size(BI);function Kx(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function XI(e,t){return UI.context(e)(t)}function KI(e,t){const n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?WI:qI).curve(Xx(i,n.orient,n.tension)).context(e)(t)}function JI(e,t){const n=t[0],i=n.interpolate||"linear";return HI.curve(Xx(i,n.orient,n.tension)).context(e)(t)}function qu(e,t,n,i){return GI.context(e)(t,n,i)}function QI(e,t){return(t.mark.shape||t.shape).context(e)(t)}function ZI(e,t){return YI.context(e)(t)}function eB(e,t){return VI.context(e)(t)}var W3=1;function H3(){W3=1}function Jx(e,t,n){var i=t.clip,r=e._defs,o=t.clip_id||(t.clip_id="clip"+W3++),s=r.clipping[o]||(r.clipping[o]={id:o});return ue(i)?s.path=i(null):Kx(n)?s.path=qu(null,n,0,0):(s.width=n.width||0,s.height=n.height||0),"url(#"+o+")"}function Ke(e){this.clear(),e&&this.union(e)}Ke.prototype={clone(){return new Ke(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(e,t,n){var{x1:i,y1:r,x2:o,y2:s}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*i-u*r+l,u*i+a*r+c,a*i-u*s+l,u*i+a*s+c,a*o-u*r+l,u*o+a*r+c,a*o-u*s+l,u*o+a*s+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function op(e){this.mark=e,this.bounds=this.bounds||new Ke}function sp(e){op.call(this,e),this.items=this.items||[]}U(sp,op);function Qx(e){this._pending=0,this._loader=e||Dg()}function WS(e){e._pending+=1}function fl(e){e._pending-=1}Qx.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return WS(t),t._loader.sanitize(e,{context:"href"}).then(n=>(fl(t),n)).catch(()=>(fl(t),null))},loadImage(e){const t=this,n=w7();return WS(t),t._loader.sanitize(e,{context:"image"}).then(i=>{const r=i.href;if(!r||!n)throw{url:r};const o=new n,s=ne(i,"crossOrigin")?i.crossOrigin:"anonymous";return s!=null&&(o.crossOrigin=s),o.onload=()=>fl(t),o.onerror=()=>fl(t),o.src=r,o}).catch(i=>(fl(t),{complete:!1,width:0,height:0,src:i&&i.url||""}))},ready(){const e=this;return new Promise(t=>{function n(i){e.pending()?setTimeout(()=>{n(!0)},10):t(i)}n(!1)})}};function qr(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?tB(t,i):0))}return e}function tB(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const nB=Ii-1e-8;let ap,wd,_d,ks,w1,Sd,_1,S1;const fo=(e,t)=>ap.add(e,t),Ed=(e,t)=>fo(wd=e,_d=t),HS=e=>fo(e,ap.y1),GS=e=>fo(ap.x1,e),vs=(e,t)=>w1*e+_1*t,ws=(e,t)=>Sd*e+S1*t,Ym=(e,t)=>fo(vs(e,t),ws(e,t)),Vm=(e,t)=>Ed(vs(e,t),ws(e,t));function of(e,t){return ap=e,t?(ks=t*To,w1=S1=Math.cos(ks),Sd=Math.sin(ks),_1=-Sd):(w1=S1=1,ks=Sd=_1=0),iB}const iB={beginPath(){},closePath(){},moveTo:Vm,lineTo:Vm,rect(e,t,n,i){ks?(Ym(e+n,t),Ym(e+n,t+i),Ym(e,t+i),Vm(e,t)):(fo(e+n,t+i),Ed(e,t))},quadraticCurveTo(e,t,n,i){const r=vs(e,t),o=ws(e,t),s=vs(n,i),a=ws(n,i);YS(wd,r,s,HS),YS(_d,o,a,GS),Ed(s,a)},bezierCurveTo(e,t,n,i,r,o){const s=vs(e,t),a=ws(e,t),u=vs(n,i),l=ws(n,i),c=vs(r,o),f=ws(r,o);VS(wd,s,u,c,HS),VS(_d,a,l,f,GS),Ed(c,f)},arc(e,t,n,i,r,o){if(i+=ks,r+=ks,wd=n*Math.cos(r)+e,_d=n*Math.sin(r)+t,Math.abs(r-i)>nB)fo(e-n,t-n),fo(e+n,t+n);else{const s=l=>fo(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(s(i),s(r),r!==i)if(i=i%Ii,i<0&&(i+=Ii),r=r%Ii,r<0&&(r+=Ii),r<i&&(o=!o,a=i,i=r,r=a),o)for(r-=Ii,a=i-i%xs,u=0;u<4&&a>r;++u,a-=xs)s(a);else for(a=i-i%xs+xs,u=0;u<4&&a<r;++u,a=a+xs)s(a)}}};function YS(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}function VS(e,t,n,i,r){const o=i-e+3*t-3*n,s=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(o)>mI?(c=s*s+a*o,c>=0&&(c=Math.sqrt(c),u=(-s+c)/o,l=(-s-c)/o)):u=.5*a/s,0<u&&u<1&&r(XS(u,e,t,n,i)),0<l&&l<1&&r(XS(l,e,t,n,i))}function XS(e,t,n,i,r){const o=1-e,s=o*o,a=e*e;return s*o*t+3*s*e*n+3*o*a*i+a*e*r}var ko=(ko=Eo(1,1))?ko.getContext("2d"):null;const E1=new Ke;function Zx(e){return function(t,n){if(!ko)return!0;e(ko,t),E1.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:o,y2:s}=E1;for(let a=r;a<=s;++a)for(let u=i;u<=o;++u)if(ko.isPointInPath(u,a))return!0;return!1}}function ev(e,t){return t.contains(e.x||0,e.y||0)}function G3(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,o=e.height||0;return t.intersects(E1.set(n,i,n+r,i+o))}function Y3(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,o=e.y2!=null?e.y2:i;return Pa(t,n,i,r,o)}function Pa(e,t,n,i,r){const{x1:o,y1:s,x2:a,y2:u}=e,l=i-t,c=r-n;let f=0,d=1,h,g,p,m;for(m=0;m<4;++m){if(m===0&&(h=-l,g=-(o-t)),m===1&&(h=l,g=a-t),m===2&&(h=-c,g=-(s-n)),m===3&&(h=c,g=u-n),Math.abs(h)<1e-10&&g<0)return!1;if(p=g/h,h<0){if(p>d)return!1;p>f&&(f=p)}else if(h>0){if(p<f)return!1;p<d&&(d=p)}}return!0}function fu(e,t){e.globalCompositeOperation=t.blend||"source-over"}function ni(e,t){return e??t}function KS(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function rB(e,t,n){const i=n.width(),r=n.height();let o;if(t.gradient==="radial")o=e.createRadialGradient(n.x1+ni(t.x1,.5)*i,n.y1+ni(t.y1,.5)*r,Math.max(i,r)*ni(t.r1,0),n.x1+ni(t.x2,.5)*i,n.y1+ni(t.y2,.5)*r,Math.max(i,r)*ni(t.r2,.5));else{const s=ni(t.x1,0),a=ni(t.y1,0),u=ni(t.x2,1),l=ni(t.y2,0);if(s===u||a===l||i===r)o=e.createLinearGradient(n.x1+s*i,n.y1+a*r,n.x1+u*i,n.y1+l*r);else{const c=Eo(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=KS(f.createLinearGradient(s,a,u,l),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return KS(o,t.stops)}function V3(e,t,n){return Vx(n)?rB(e,n,t.bounds):n}function fh(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=V3(e,t,t.fill),!0):!1}var oB=[];function du(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=V3(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||oB),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function sB(e,t){return e.zindex-t.zindex||e.index-t.index}function tv(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,o;for(r=0,o=t.length;r<o;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(sB)}function _i(e,t){var n=e.items,i,r;if(!n||!n.length)return;const o=tv(e);if(o&&o.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=o}for(i=0,r=n.length;i<r;++i)t(n[i])}function dh(e,t){var n=e.items,i,r;if(!n||!n.length)return null;const o=tv(e);for(o&&o.length&&(n=o),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===o){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function nv(e){return function(t,n,i){_i(n,r=>{(!i||i.intersects(r.bounds))&&X3(e,t,r,r)})}}function aB(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&X3(e,t,n.items[0],n.items)}}function X3(e,t,n,i){var r=n.opacity==null?1:n.opacity;r!==0&&(e(t,i)||(fu(t,n),n.fill&&fh(t,n,r)&&t.fill(),n.stroke&&du(t,n,r)&&t.stroke()))}function up(e){return e=e||Gn,function(t,n,i,r,o,s){return i*=t.pixelRatio,r*=t.pixelRatio,dh(n,a=>{const u=a.bounds;if(!(u&&!u.contains(o,s)||!u)&&e(t,a,i,r,o,s))return a})}}function sf(e,t){return function(n,i,r,o){var s=Array.isArray(i)?i[0]:i,a=t??s.fill,u=s.stroke&&n.isPointInStroke,l,c;return u&&(l=s.strokeWidth,c=s.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,i)?!1:a&&n.isPointInPath(r,o)||u&&n.isPointInStroke(r,o)}}function iv(e){return up(sf(e))}function Ts(e,t){return"translate("+e+","+t+")"}function rv(e){return"rotate("+e+")"}function uB(e,t){return"scale("+e+","+t+")"}function K3(e){return Ts(e.x||0,e.y||0)}function lB(e){return Ts(e.x||0,e.y||0)+(e.angle?" "+rv(e.angle):"")}function cB(e){return Ts(e.x||0,e.y||0)+(e.angle?" "+rv(e.angle):"")+(e.scaleX||e.scaleY?" "+uB(e.scaleX||1,e.scaleY||1):"")}function ov(e,t,n){function i(s,a){s("transform",lB(a)),s("d",t(null,a))}function r(s,a){return t(of(s,a.angle),a),qr(s,a).translate(a.x||0,a.y||0)}function o(s,a){var u=a.x||0,l=a.y||0,c=a.angle||0;s.translate(u,l),c&&s.rotate(c*=To),s.beginPath(),t(s,a),c&&s.rotate(-c),s.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:nv(o),pick:iv(o),isect:n||Zx(o)}}var fB=ov("arc",XI);function dB(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,o=1/0,s,a;--r>=0;)e[r].defined!==!1&&(a=Math.abs(e[r][i]-n),a<o&&(o=a,s=e[r]));return s}function hB(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,o,s;--i>=0;)if(e[i].defined!==!1&&(r=e[i].x-t[0],o=e[i].y-t[1],s=r*r+o*o,s<n))return e[i];return null}function gB(e,t){for(var n=e.length,i,r,o;--n>=0;)if(e[n].defined!==!1&&(i=e[n].x-t[0],r=e[n].y-t[1],o=i*i+r*r,i=e[n].size||1,o<i*i))return e[n];return null}function sv(e,t,n){function i(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function r(u,l){var c=l.items;return c.length===0?u:(t(of(u),c),qr(u,c[0]))}function o(u,l){u.beginPath(),t(u,l)}const s=sf(o);function a(u,l,c,f,d,h){var g=l.items,p=l.bounds;return!g||!g.length||p&&!p.contains(d,h)?null:(c*=u.pixelRatio,f*=u.pixelRatio,s(u,g,c,f)?g[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:aB(o),pick:a,isect:ev,tip:n}}var pB=sv("area",KI,dB);function mB(e,t){var n=t.clip;e.save(),ue(n)?(e.beginPath(),n(e),e.clip()):J3(e,t.group)}function J3(e,t){e.beginPath(),Kx(t)?qu(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Q3(e){const t=ni(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function yB(e,t){e("transform",K3(t))}function Z3(e,t){const n=Q3(t);e("d",qu(null,t,n,n))}function bB(e,t){e("class","background"),e("aria-hidden",!0),Z3(e,t)}function xB(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Z3(e,t):e("d","")}function vB(e,t,n){const i=t.clip?Jx(n,t,t):null;e("clip-path",i)}function wB(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),qr(e,t),e.translate(t.x||0,t.y||0)}function vc(e,t,n,i){const r=Q3(t);e.beginPath(),qu(e,t,(n||0)+r,(i||0)+r)}const _B=sf(vc),SB=sf(vc,!1),EB=sf(vc,!0);function kB(e,t,n){_i(t,i=>{const r=i.x||0,o=i.y||0,s=i.strokeForeground,a=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&a&&(vc(e,i,r,o),fu(e,i),i.fill&&fh(e,i,a)&&e.fill(),i.stroke&&!s&&du(e,i,a)&&e.stroke()),e.save(),e.translate(r,o),i.clip&&J3(e,i),n&&n.translate(-r,-o),_i(i,u=>{this.draw(e,u,n)}),n&&n.translate(r,o),e.restore(),s&&i.stroke&&a&&(vc(e,i,r,o),fu(e,i),du(e,i,a)&&e.stroke())})}function $B(e,t,n,i,r,o){if(t.bounds&&!t.bounds.contains(r,o)||!t.items)return null;const s=n*e.pixelRatio,a=i*e.pixelRatio;return dh(t,u=>{let l,c,f;const d=u.bounds;if(d&&!d.contains(r,o))return;c=u.x||0,f=u.y||0;const h=c+(u.width||0),g=f+(u.height||0),p=u.clip;if(p&&(r<c||r>h||o<f||o>g))return;if(e.save(),e.translate(c,f),c=r-c,f=o-f,p&&Kx(u)&&!EB(e,u,s,a))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&SB(e,u,s,a)?(e.restore(),u):(l=dh(u,b=>AB(b,c,f)?this.pick(b,n,i,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&_B(e,u,s,a)&&(l=u),e.restore(),l||null)})}function AB(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var CB={type:"group",tag:"g",nested:!1,attr:yB,bound:wB,draw:kB,pick:$B,isect:G3,content:vB,background:bB,foreground:xB},wc={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function av(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function uv(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function lv(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function lp(e,t){return e==="center"?t/2:e==="right"?t:0}function cp(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function MB(e,t,n){const i=av(t,n),r=uv(t,i),o=lv(t,i),s=(t.x||0)-lp(t.align,r),a=(t.y||0)-cp(t.baseline,o),u=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",u,wc["xmlns:xlink"],"xlink:href"),e("transform",Ts(s,a)),e("width",r),e("height",o),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function FB(e,t){const n=t.image,i=uv(t,n),r=lv(t,n),o=(t.x||0)-lp(t.align,i),s=(t.y||0)-cp(t.baseline,r);return e.set(o,s,o+i,s+r)}function TB(e,t,n){_i(t,i=>{if(n&&!n.intersects(i.bounds))return;const r=av(i,this);let o=uv(i,r),s=lv(i,r);if(o===0||s===0)return;let a=(i.x||0)-lp(i.align,o),u=(i.y||0)-cp(i.baseline,s),l,c,f,d;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(d=o/c,u+=(s-d)/2,s=d):(d=s*c,a+=(o-d)/2,o=d))),(r.complete||r.toDataURL)&&(fu(e,i),e.globalAlpha=(l=i.opacity)!=null?l:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,a,u,o,s))})}var DB={type:"image",tag:"image",nested:!1,attr:MB,bound:FB,draw:TB,pick:up(),isect:Gn,get:av,xOffset:lp,yOffset:cp},NB=sv("line",JI,hB);function OB(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",cB(t)),e("d",t.path)}function kd(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,o=t.scaleX||1,s=t.scaleY||1,a=(t.angle||0)*To,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=cu(n)).path=n),a&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(a),xc(e,u,0,0,o,s),e.rotate(-a),e.translate(-i,-r)):xc(e,u,i,r,o,s)}function RB(e,t){return kd(of(e,t.angle),t)?e.set(0,0,0,0):qr(e,t,!0)}var zB={type:"path",tag:"path",nested:!1,attr:OB,bound:RB,draw:nv(kd),pick:iv(kd),isect:Zx(kd)};function PB(e,t){e("d",qu(null,t))}function LB(e,t){var n,i;return qr(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function JS(e,t){e.beginPath(),qu(e,t)}var IB={type:"rect",tag:"path",nested:!1,attr:PB,bound:LB,draw:nv(JS),pick:iv(JS),isect:G3};function BB(e,t){e("transform",K3(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function jB(e,t){var n,i;return qr(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function e5(e,t,n){var i,r,o,s;return t.stroke&&du(e,t,n)?(i=t.x||0,r=t.y||0,o=t.x2!=null?t.x2:i,s=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(o,s),!0):!1}function UB(e,t,n){_i(t,i=>{if(!(n&&!n.intersects(i.bounds))){var r=i.opacity==null?1:i.opacity;r&&e5(e,i,r)&&(fu(e,i),e.stroke())}})}function qB(e,t,n,i){return e.isPointInStroke?e5(e,t,1)&&e.isPointInStroke(n,i):!1}var WB={type:"rule",tag:"line",nested:!1,attr:BB,bound:jB,draw:UB,pick:up(qB),isect:Y3},HB=ov("shape",QI),GB=ov("symbol",ZI,ev);const QS=aC();var mi={height:ar,measureWidth:cv,estimateWidth:k1,width:k1,canvas:t5};t5(!0);function t5(e){mi.width=e&&ko?cv:k1}function k1(e,t){return n5(No(e,t),ar(e))}function n5(e,t){return~~(.8*e.length*t)}function cv(e,t){return ar(e)<=0||!(t=No(e,t))?0:i5(t,fp(e))}function i5(e,t){const n=`(${t}) ${e}`;let i=QS.get(n);return i===void 0&&(ko.font=t,i=ko.measureText(e).width,QS.set(n,i)),i}function ar(e){return e.fontSize!=null?+e.fontSize||0:11}function Do(e){return e.lineHeight!=null?e.lineHeight:ar(e)+2}function YB(e){return z(e)?e.length>1?e:e[0]:e}function af(e){return YB(e.lineBreak&&e.text&&!z(e.text)?e.text.split(e.lineBreak):e.text)}function fv(e){const t=af(e);return(z(t)?t.length-1:0)*Do(e)}function No(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?XB(e,n):n}function VB(e){if(mi.width===cv){const t=fp(e);return n=>i5(n,t)}else{const t=ar(e);return n=>n5(n,t)}}function XB(e,t){var n=+e.limit,i=VB(e);if(i(t)<n)return t;var r=e.ellipsis||"…",o=e.dir==="rtl",s=0,a=t.length,u;if(n-=i(r),o){for(;s<a;)u=s+a>>>1,i(t.slice(u))>n?s=u+1:a=u;return r+t.slice(s)}else{for(;s<a;)u=1+(s+a>>>1),i(t.slice(0,u))<n?s=u:a=u-1;return t.slice(0,s)+r}}function uf(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function fp(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+ar(e)+"px "+uf(e,t)}function dv(e){var t=e.baseline,n=ar(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Do(e):t==="line-bottom"?.29*n-.5*Do(e):0)}const KB={left:"start",center:"middle",right:"end"},Vl=new Ke;function dp(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-xs,t+=i*Math.cos(r),n+=i*Math.sin(r)),Vl.x1=t,Vl.y1=n,Vl}function JB(e,t){var n=t.dx||0,i=(t.dy||0)+dv(t),r=dp(t),o=r.x1,s=r.y1,a=t.angle||0,u;e("text-anchor",KB[t.align]||"start"),a?(u=Ts(o,s)+" "+rv(a),(n||i)&&(u+=" "+Ts(n,i))):u=Ts(o+n,s+i),e("transform",u)}function hv(e,t,n){var i=mi.height(t),r=t.align,o=dp(t),s=o.x1,a=o.y1,u=t.dx||0,l=(t.dy||0)+dv(t)-Math.round(.8*i),c=af(t),f;if(z(c)?(i+=Do(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,mi.width(t,h)),0)):f=mi.width(t,c),r==="center"?u-=f/2:r==="right"&&(u-=f),e.set(u+=s,l+=a,u+f,l+i),t.angle&&!n)e.rotate(t.angle*To,s,a);else if(n===2)return e.rotatedPoints(t.angle*To,s,a);return e}function QB(e,t,n){_i(t,i=>{var r=i.opacity==null?1:i.opacity,o,s,a,u,l,c,f;if(!(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)){if(e.font=fp(i),e.textAlign=i.align||"left",o=dp(i),s=o.x1,a=o.y1,i.angle&&(e.save(),e.translate(s,a),e.rotate(i.angle*To),s=a=0),s+=i.dx||0,a+=(i.dy||0)+dv(i),c=af(i),fu(e,i),z(c))for(l=Do(i),u=0;u<c.length;++u)f=No(i,c[u]),i.fill&&fh(e,i,r)&&e.fillText(f,s,a),i.stroke&&du(e,i,r)&&e.strokeText(f,s,a),a+=l;else f=No(i,c),i.fill&&fh(e,i,r)&&e.fillText(f,s,a),i.stroke&&du(e,i,r)&&e.strokeText(f,s,a);i.angle&&e.restore()}})}function ZB(e,t,n,i,r,o){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var s=dp(t),a=s.x1,u=s.y1,l=hv(Vl,t,1),c=-t.angle*To,f=Math.cos(c),d=Math.sin(c),h=f*r-d*o+(a-f*a+d*u),g=d*r+f*o+(u-d*a-f*u);return l.contains(h,g)}function ej(e,t){const n=hv(Vl,e,2);return Pa(t,n[0],n[1],n[2],n[3])||Pa(t,n[0],n[1],n[4],n[5])||Pa(t,n[4],n[5],n[6],n[7])||Pa(t,n[2],n[3],n[6],n[7])}var tj={type:"text",tag:"text",nested:!1,attr:JB,bound:hv,draw:QB,pick:up(ZB),isect:ej},nj=sv("trail",eB,gB),Rn={arc:fB,area:pB,group:CB,image:DB,line:NB,path:zB,rect:IB,rule:WB,shape:HB,symbol:GB,text:tj,trail:nj};function $1(e,t,n){var i=Rn[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new Ke),e,n)}var ZS={mark:null};function r5(e,t,n){var i=Rn[e.marktype],r=i.bound,o=e.items,s=o&&o.length,a,u,l,c;if(i.nested)return s?l=o[0]:(ZS.mark=e,l=ZS),c=$1(l,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new Ke,s)for(a=0,u=o.length;a<u;++a)t.union($1(o[a],r,n));return e.bounds=t}const ij=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function o5(e,t){return JSON.stringify(e,ij,t)}function s5(e){const t=typeof e=="string"?JSON.parse(e):e;return a5(t)}function a5(e){var t=e.marktype,n=e.items,i,r,o;if(n)for(r=0,o=n.length;r<o;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&a5(n[r]);return t&&r5(e),e}function gv(e){arguments.length?this.root=s5(e):(this.root=u5({marktype:"group",name:"root",role:"frame"}),this.root.items=[new sp(this.root)])}gv.prototype={toJSON(e){return o5(this.root,e||0)},mark(e,t,n){t=t||this.root.items[0];const i=u5(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}};function u5(e,t){const n={bounds:new Ke,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function ho(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function pv(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function cn(e,t,n,i){var r=e.childNodes[t],o;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(o=r||null,r=ho(e.ownerDocument,n,i),e.insertBefore(r,o)),r}function ui(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function l5(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function hp(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function rj(e,t,n,i){var r=e&&e.mark,o,s;if(r&&(o=Rn[r.marktype]).tip){for(s=hp(t,n),s[0]-=i[0],s[1]-=i[1];e=e.mark.group;)s[0]-=e.x||0,s[1]-=e.y||0;e=o.tip(r.items,s)}return e}function Oo(e,t){this._active=null,this._handlers={},this._loader=e||Dg(),this._tooltip=t||oj}function oj(e,t,n,i){e.element().setAttribute("title",i||"")}Oo.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const i in t)n.push(...t[i]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),o=ho(null,"a");for(const s in i)o.setAttribute(s,i[s]);o.dispatchEvent(r)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=rj(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,o=r.width(),s=r.height();let a=r.x1+i[0]+n.left,u=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:o,height:s,left:a,top:u,right:a+o,bottom:u+s}}};function ur(e){this._el=null,this._bgcolor=null,this._loader=new Qx(e)}ur.prototype={initialize(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,i=n._loader[e](t);if(!n._ready){const r=n._call;n._ready=n._loader.ready().then(o=>{o&&r(),n._ready=null})}return i},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const sj="keydown",aj="keypress",uj="keyup",c5="dragenter",$d="dragleave",f5="dragover",A1="mousedown",lj="mouseup",hh="mousemove",Xl="mouseout",d5="mouseover",gh="click",cj="dblclick",fj="wheel",h5="mousewheel",ph="touchstart",mh="touchmove",yh="touchend",dj=[sj,aj,uj,c5,$d,f5,A1,lj,hh,Xl,d5,gh,cj,fj,h5,ph,mh,yh],C1=hh,_c=Xl,M1=gh;function lf(e,t){Oo.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const hj=e=>e===ph||e===mh||e===yh?[ph,mh,yh]:[e];function eE(e,t){hj(t).forEach(n=>gj(e,n))}function gj(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}function tE(e,t,n){return function(i){const r=this._active,o=this.pickEvent(i);o===r?this.fire(e,i):((!r||!r.exit)&&this.fire(n,i),this._active=o,this.fire(t,i),this.fire(e,i))}}function nE(e){return function(t){this.fire(e,t),this._active=null}}U(lf,Oo,{initialize(e,t,n){return this._canvas=e&&pv(e,"canvas"),[gh,A1,hh,Xl,$d].forEach(i=>eE(this,i)),Oo.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:dj,DOMMouseScroll(e){this.fire(h5,e)},mousemove:tE(hh,d5,Xl),dragover:tE(f5,c5,$d),mouseout:nE(Xl),dragleave:nE($d),mousedown(e){this._down=this._active,this.fire(A1,e)},click(e){this._down===this._active&&(this.fire(gh,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(ph,e,!0)},touchmove(e){this.fire(mh,e,!0)},touchend(e){this.fire(yh,e,!0),this._touch=null},fire(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===M1&&i&&i.href?this.handleHref(t,i,i.href):(e===C1||e===_c)&&this.handleTooltip(t,i,e!==_c),r)for(let o=0,s=r.length;o<s;++o)r[o].handler.call(this._obj,t,i)},on(e,t){const n=this.eventName(e),i=this._handlers;return this._handlerIndex(i[n],e,t)<0&&(eE(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},pickEvent(e){const t=hp(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,i,r){const o=this.context();return Rn[e.marktype].pick.call(this,o,e,t,n,i,r)}});function pj(){return typeof window<"u"&&window.devicePixelRatio||1}var mj=pj();function yj(e,t,n,i,r,o){const s=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=s?mj:r;e.width=t*u,e.height=n*u;for(const l in o)a[l]=o[l];return s&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*i[0],u*i[1]),e}function bh(e){ur.call(this,e),this._options={},this._redraw=!1,this._dirty=new Ke,this._tempb=new Ke}const iE=ur.prototype,bj=(e,t,n)=>new Ke().set(0,0,t,n).translate(-e[0],-e[1]);function xj(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}U(bh,ur,{initialize(e,t,n,i,r,o){return this._options=o||{},this._canvas=this._options.externalContext?null:Eo(1,1,this._options.type),e&&this._canvas&&(ui(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),iE.initialize.call(this,e,t,n,i,r)},resize(e,t,n,i){if(iE.resize.call(this,e,t,n,i),this._canvas)yj(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||R("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,o=this._dirty,s=bj(n,i,r);t.save();const a=this._redraw||o.empty()?(this._redraw=!1,s.expand(1)):xj(t,s.intersect(o),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,a),t.restore(),o.clear(),this},draw(e,t,n){const i=Rn[t.marktype];t.clip&&mB(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,i){const r=this._options,o=this.context();r.type!=="pdf"&&!r.externalContext&&o.clearRect(e,t,n,i),this._bgcolor!=null&&(o.fillStyle=this._bgcolor,o.fillRect(e,t,n,i))}});function mv(e,t){Oo.call(this,e,t);const n=this;n._hrefHandler=F1(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=F1(n,(i,r)=>{n.handleTooltip(i,r,i.type!==_c)})}const F1=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};U(mv,Oo,{initialize(e,t,n){let i=this._svg;return i&&(i.removeEventListener(M1,this._hrefHandler),i.removeEventListener(C1,this._tooltipHandler),i.removeEventListener(_c,this._tooltipHandler)),this._svg=i=e&&pv(e,"svg"),i&&(i.addEventListener(M1,this._hrefHandler),i.addEventListener(C1,this._tooltipHandler),i.addEventListener(_c,this._tooltipHandler)),Oo.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),i=this._handlers;if(this._handlerIndex(i[n],e,t)<0){const o={type:e,handler:t,listener:F1(this,t)};(i[n]||(i[n]=[])).push(o),this._svg&&this._svg.addEventListener(n,o.listener)}return this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const g5="aria-hidden",yv="aria-label",bv="role",xv="aria-roledescription",p5="graphics-object",vv="graphics-symbol",m5=(e,t,n)=>({[bv]:e,[xv]:t,[yv]:n||void 0}),vj=vi(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),rE={axis:{desc:"axis",caption:Sj},legend:{desc:"legend",caption:Ej},"title-text":{desc:"title",caption:e=>`Title text '${sE(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${sE(e)}'`}},oE={ariaRole:bv,ariaRoleDescription:xv,description:yv};function y5(e,t){const n=t.aria===!1;if(e(g5,n||void 0),n||t.description==null)for(const i in oE)e(oE[i],void 0);else{const i=t.mark.marktype;e(yv,t.description),e(bv,t.ariaRole||(i==="group"?p5:vv)),e(xv,t.ariaRoleDescription||`${i} mark`)}}function b5(e){return e.aria===!1?{[g5]:!0}:vj[e.role]?null:rE[e.role]?_j(e,rE[e.role]):wj(e)}function wj(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return m5(n?p5:vv,`${t} mark container`,e.description)}function _j(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return m5(t.role||vv,t.desc,n.description||i(n))}catch{return null}}function sE(e){return H(e.text).join(" ")}function Sj(e){const t=e.datum,n=e.orient,i=t.title?x5(e):null,r=e.context,o=r.scales[t.scale].value,s=r.dataflow.locale(),a=o.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(i?` titled '${i}'`:"")+` for a ${lu(a)?"discrete":a} scale with ${z3(s,o,e)}`}function Ej(e){const t=e.datum,n=t.title?x5(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,o=Object.keys(r),s=e.context,a=s.scales[r[o[0]]].value,u=s.dataflow.locale();return $j(i)+(n?` titled '${n}'`:"")+` for ${kj(o)} with ${z3(u,a,e)}`}function x5(e){try{return H(ye(e.items).items[0].text).join(" ")}catch{return null}}function kj(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ye(e)}function $j(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const v5=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Aj=e=>v5(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function wv(){let e="",t="",n="";const i=[],r=()=>t=n="",o=u=>{t&&(e+=`${t}>${n}`,r()),i.push(u)},s=(u,l)=>(l!=null&&(t+=` ${u}="${Aj(l)}"`),a),a={open(u){o(u),t="<"+u;for(var l=arguments.length,c=new Array(l>1?l-1:0),f=1;f<l;f++)c[f-1]=arguments[f];for(const d of c)for(const h in d)s(h,d[h]);return a},close(){const u=i.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,r(),a},attr:s,text:u=>(n+=v5(u),a),toString:()=>e};return a}const w5=e=>_5(wv(),e)+"";function _5(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,i=n.length;for(let r=0;r<i;++r)e.attr(n[r].name,n[r].value)}if(t.hasChildNodes()){const n=t.childNodes;for(const i of n)i.nodeType===3?e.text(i.nodeValue):_5(e,i)}return e.close()}const xh={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},vh={blend:"mix-blend-mode"},S5={fill:"none","stroke-miterlimit":10},dl=0,aE="http://www.w3.org/2000/xmlns/",Ze=wc.xmlns;function _v(e){ur.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Xm=ur.prototype;U(_v,ur,{initialize(e,t,n,i,r){return this._defs={},this._clearDefs(),e&&(this._svg=cn(e,0,"svg",Ze),this._svg.setAttributeNS(aE,"xmlns",Ze),this._svg.setAttributeNS(aE,"xmlns:xlink",wc["xmlns:xlink"]),this._svg.setAttribute("version",wc.version),this._svg.setAttribute("class","marks"),ui(e,1),this._root=cn(this._svg,dl,"g",Ze),go(this._root,S5),ui(this._svg,dl+1)),this.background(this._bgcolor),Xm.initialize.call(this,e,t,n,i,r)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Xm.background.apply(this,arguments)},resize(e,t,n,i){return Xm.resize.call(this,e,t,n,i),this._svg&&(go(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=cn(e,dl,"rect",Ze),go(n,{width:this._width,height:this._height,fill:t}));const i=w5(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),i},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),ui(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||!e._svg.ownerSVGElement||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,i,r,o,s,a,u;for(s=0,a=e.length;s<a;++s)if(n=e[s],i=n.mark,i.marktype!==r&&(r=i.marktype,o=Rn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,uE(n,t),i.items.forEach(l=>{l.dirty=t})),!i.zdirty){if(n.exit){o.nested&&i.items.length?(u=i.items[0],u._svg&&this._update(o,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=o.nested?i.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,uE(n,t)):this._update(o,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const i=this._svg,r=Rn[t.marktype],o=t.interactive===!1?"none":null,s=r.tag==="g",a=lE(t,e,n,"g",i);a.setAttribute("class",l5(t));const u=b5(t);for(const d in u)Ht(a,d,u[d]);s||Ht(a,"pointer-events",o),Ht(a,"clip-path",t.clip?Jx(this,t,t.group):null);let l=null,c=0;const f=d=>{const h=this.isDirty(d),g=lE(d,a,l,r.tag,i);h&&(this._update(r,g,d),s&&Fj(this,g,d)),l=g,++c};return r.nested?t.items.length&&f(t.items[0]):_i(t,f),ui(a,c),a},_update(e,t,n){Mr=t,Ft=t.__values__,y5(Kl,n),e.attr(Kl,n,this);const i=Dj[e.type];i&&i.call(this,e,t,n),Mr&&this.style(Mr,n)},style(e,t){if(t!=null){for(const n in xh){let i=n==="font"?uf(t):t[n];if(i===Ft[n])continue;const r=xh[n];i==null?e.removeAttribute(r):(Vx(i)&&(i=L3(i,this._defs.gradient,E5())),e.setAttribute(r,i+"")),Ft[n]=i}for(const n in vh)Ad(e,vh[n],t[n])}},defs(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=cn(e,dl+1,"defs",Ze)),i=Cj(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=cn(e,dl+1,"defs",Ze)),i=Mj(n,t.clipping[r],i);n&&(i===0?(e.removeChild(n),t.el=null):ui(n,i))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function uE(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function Cj(e,t,n){let i,r,o;if(t.gradient==="radial"){let s=cn(e,n++,"pattern",Ze);go(s,{id:ch+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),s=cn(s,0,"rect",Ze),go(s,{width:1,height:1,fill:`url(${E5()}#${t.id})`}),e=cn(e,n++,"radialGradient",Ze),go(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=cn(e,n++,"linearGradient",Ze),go(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(i=0,r=t.stops.length;i<r;++i)o=cn(e,i,"stop",Ze),o.setAttribute("offset",t.stops[i].offset),o.setAttribute("stop-color",t.stops[i].color);return ui(e,i),n}function Mj(e,t,n){let i;return e=cn(e,n,"clipPath",Ze),e.setAttribute("id",t.id),t.path?(i=cn(e,0,"path",Ze),i.setAttribute("d",t.path)):(i=cn(e,0,"rect",Ze),go(i,{x:0,y:0,width:t.width,height:t.height})),ui(e,1),n+1}function Fj(e,t,n){t=t.lastChild.previousSibling;let i,r=0;_i(n,o=>{i=e.mark(t,o,i),++r}),ui(t,1+r)}function lE(e,t,n,i,r){let o=e._svg,s;if(!o&&(s=t.ownerDocument,o=ho(s,i,Ze),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},i==="g"))){const a=ho(s,"path",Ze);o.appendChild(a),a.__data__=e;const u=ho(s,"g",Ze);o.appendChild(u),u.__data__=e;const l=ho(s,"path",Ze);o.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(o.ownerSVGElement!==r||Tj(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}function Tj(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Mr=null,Ft=null;const Dj={group(e,t,n){const i=Mr=t.childNodes[2];Ft=i.__values__,e.foreground(Kl,n,this),Ft=t.__values__,Mr=t.childNodes[1],e.content(Kl,n,this);const r=Mr=t.childNodes[0];e.background(Kl,n,this);const o=n.mark.interactive===!1?"none":null;if(o!==Ft.events&&(Ht(i,"pointer-events",o),Ht(r,"pointer-events",o),Ft.events=o),n.strokeForeground&&n.stroke){const s=n.fill;Ht(i,"display",null),this.style(r,n),Ht(r,"stroke",null),s&&(n.fill=null),Ft=i.__values__,this.style(i,n),s&&(n.fill=s),Mr=null}else Ht(i,"display","none")},image(e,t,n){n.smooth===!1?(Ad(t,"image-rendering","optimizeSpeed"),Ad(t,"image-rendering","pixelated")):Ad(t,"image-rendering",null)},text(e,t,n){const i=af(n);let r,o,s,a;z(i)?(o=i.map(u=>No(n,u)),r=o.join(`
`),r!==Ft.text&&(ui(t,0),s=t.ownerDocument,a=Do(n),o.forEach((u,l)=>{const c=ho(s,"tspan",Ze);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),Ft.text=r)):(o=No(n,i),o!==Ft.text&&(t.textContent=o,Ft.text=o)),Ht(t,"font-family",uf(n)),Ht(t,"font-size",ar(n)+"px"),Ht(t,"font-style",n.fontStyle),Ht(t,"font-variant",n.fontVariant),Ht(t,"font-weight",n.fontWeight)}};function Kl(e,t,n){t!==Ft[e]&&(n?Nj(Mr,e,t,n):Ht(Mr,e,t),Ft[e]=t)}function Ad(e,t,n){n!==Ft[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Ft[t]=n)}function go(e,t){for(const n in t)Ht(e,n,t[n])}function Ht(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function Nj(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}function E5(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Sv(e){ur.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}U(Sv,ur,{svg(){return this._text},_render(e){const t=wv();t.open("svg",ae({},wc,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",S5,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Rn[t.marktype],i=n.tag,r=[y5,n.attr];e.open("g",{class:l5(t),"clip-path":t.clip?Jx(this,t,t.group):null},b5(t),{"pointer-events":i!=="g"&&t.interactive===!1?"none":null});const o=s=>{const a=this.href(s);if(a&&e.open("a",a),e.open(i,this.attr(t,s,r,i!=="g"?i:null)),i==="text"){const u=af(s);if(z(u)){const l={x:0,dy:Do(s)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(No(s,u[c])).close()}else e.text(No(s,u))}else if(i==="g"){const u=s.strokeForeground,l=s.fill,c=s.stroke;u&&c&&(s.stroke=null),e.open("path",this.attr(t,s,n.background,"bgrect")).close(),e.open("g",this.attr(t,s,n.content)),_i(s,f=>this.mark(e,f)),e.close(),u&&c?(l&&(s.fill=null),s.stroke=c,e.open("path",this.attr(t,s,n.foreground,"bgrect")).close(),l&&(s.fill=l)):e.open("path",this.attr(t,s,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&o(t.items[0]):_i(t,o),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(i=>{i["xlink:href"]=i.href,i.href=null,(this._hrefs||(this._hrefs={}))[t]=i})}return null},attr(e,t,n,i){const r={},o=(s,a,u,l)=>{r[l||s]=a};return Array.isArray(n)?n.forEach(s=>s(o,t,this)):n(o,t,this),i&&Oj(r,t,e,i,this._defs),r},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const r in t){const o=t[r],s=o.stops;o.gradient==="radial"?(e.open("pattern",{id:ch+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:o.x1,fy:o.y1,fr:o.r1,cx:o.x2,cy:o.y2,r:o.r2})):e.open("linearGradient",{id:r,x1:o.x1,x2:o.x2,y1:o.y1,y2:o.y2});for(let a=0;a<s.length;++a)e.open("stop",{offset:s[a].offset,"stop-color":s[a].color}).close();e.close()}for(const r in n){const o=n[r];e.open("clipPath",{id:r}),o.path?e.open("path",{d:o.path}).close():e.open("rect",{x:0,y:0,width:o.width,height:o.height}).close(),e.close()}e.close()}}});function Oj(e,t,n,i,r){let o;if(t==null||(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;i==="image"&&t.smooth===!1&&(o=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),i==="text"&&(e["font-family"]=uf(t),e["font-size"]=ar(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const s in xh){let a=t[s];const u=xh[s];a==="transparent"&&(u==="fill"||u==="stroke")||a!=null&&(Vx(a)&&(a=L3(a,r.gradient,"")),e[u]=a)}for(const s in vh){const a=t[s];a!=null&&(o=o||[],o.push(`${vh[s]}: ${a};`))}return o&&(e.style=o.join(" ")),e}const k5="canvas",$5="png",A5="svg",C5="none",po={Canvas:k5,PNG:$5,SVG:A5,None:C5},hu={};hu[k5]=hu[$5]={renderer:bh,headless:bh,handler:lf};hu[A5]={renderer:_v,headless:Sv,handler:mv};hu[C5]={};function gp(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(hu[e]=t,this):hu[e]}function M5(e,t,n){const i=[],r=new Ke().union(t),o=e.marktype;return o?F5(e,r,n,i):o==="group"?T5(e,r,n,i):R("Intersect scene must be mark node or group item.")}function F5(e,t,n,i){if(Rj(e,t,n)){const r=e.items,o=e.marktype,s=r.length;let a=0;if(o==="group")for(;a<s;++a)T5(r[a],t,n,i);else for(const u=Rn[o].isect;a<s;++a){const l=r[a];D5(l,t,u)&&i.push(l)}}return i}function Rj(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function T5(e,t,n,i){n&&n(e.mark)&&D5(e,t,Rn.group.isect)&&i.push(e);const r=e.items,o=r&&r.length;if(o){const s=e.x||0,a=e.y||0;t.translate(-s,-a);for(let u=0;u<o;++u)F5(r[u],t,n,i);t.translate(s,a)}return i}function D5(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}const Km=new Ke;function N5(e){const t=e.clip;if(ue(t))t(of(Km.clear()));else if(t)Km.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(Km)}const zj=1e-9;function Ev(e,t,n){return e===t?!0:n==="path"?O5(e,t):e instanceof Date&&t instanceof Date?+e==+t:Ae(e)&&Ae(t)?Math.abs(e-t)<=zj:!e||!t||!V(e)&&!V(t)?e==t:Pj(e,t)}function O5(e,t){return Ev(cu(e),cu(t))}function Pj(e,t){var n=Object.keys(e),i=Object.keys(t),r,o;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),o=n.length-1;o>=0;o--)if(n[o]!=i[o])return!1;for(o=n.length-1;o>=0;o--)if(r=n[o],!Ev(e[r],t[r],r))return!1;return typeof e==typeof t}function Lj(){H3(),lI()}const gu="top",li="left",fi="right",Ro="bottom",Ij="top-left",Bj="top-right",jj="bottom-left",Uj="bottom-right",kv="start",T1="middle",Gt="end",qj="x",Wj="y",pp="group",$v="axis",Av="title",Hj="frame",Gj="scope",Cv="legend",R5="row-header",z5="row-footer",P5="row-title",L5="column-header",I5="column-footer",B5="column-title",Yj="padding",Vj="symbol",j5="fit",U5="fit-x",q5="fit-y",Xj="pad",Mv="none",Wf="all",D1="each",Fv="flush",mo="column",yo="row";function W5(e){T.call(this,null,e)}U(W5,T,{transform(e,t){const n=t.dataflow,i=e.mark,r=i.marktype,o=Rn[r],s=o.bound;let a=i.bounds,u;if(o.nested)i.items.length&&n.dirty(i.items[0]),a=Hf(i,s),i.items.forEach(l=>{l.bounds.clear().union(a)});else if(r===pp||e.modified())switch(t.visit(t.MOD,l=>n.dirty(l)),a.clear(),i.items.forEach(l=>a.union(Hf(l,s))),i.role){case $v:case Cv:case Av:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,l=>{a.union(Hf(l,s))}),t.visit(t.MOD,l=>{u=u||a.alignsWith(l.bounds),n.dirty(l),a.union(Hf(l,s))}),u&&(a.clear(),i.items.forEach(l=>a.union(l.bounds)));return N5(i),t.modifies("bounds")}});function Hf(e,t,n){return t(e.bounds.clear(),e,n)}const cE=":vega_identifier:";function Tv(e){T.call(this,0,e)}Tv.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};U(Tv,T,{transform(e,t){const n=Kj(t.dataflow),i=e.as;let r=n.value;return t.visit(t.ADD,o=>o[i]=o[i]||++r),n.set(this.value=r),t}});function Kj(e){return e._signals[cE]||(e._signals[cE]=e.add(0))}function H5(e){T.call(this,null,e)}U(H5,T,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,Jj(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const i=n.marktype===pp?sp:op;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function Jj(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function G5(e){T.call(this,null,e)}const fE={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((i,r)=>!r||!Y5(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}},Y5=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),dE=(e,t)=>{for(var n=1,i=e.length,r=e[0].bounds,o;n<i;r=o,++n)if(Y5(r,o=e[n].bounds,t))return!0},Qj=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},Zj=(e,t,n)=>{var i=e.range(),r=new Ke;return t===gu||t===Ro?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),o=>r.encloses(o.bounds)},hE=e=>(e.forEach(t=>t.opacity=1),e),gE=(e,t)=>e.reflow(t.modified()).modifies("opacity");U(G5,T,{transform(e,t){const n=fE[e.method]||fE.parity,i=e.separation||0;let r=t.materialize(t.SOURCE).source,o,s;if(!r||!r.length)return;if(!e.method)return e.modified("method")&&(hE(r),t=gE(t,e)),t;if(r=r.filter(Qj),!r.length)return;if(e.sort&&(r=r.slice().sort(e.sort)),o=hE(r),t=gE(t,e),o.length>=3&&dE(o,i)){do o=n(o,i);while(o.length>=3&&dE(o,i));o.length<3&&!ye(r).opacity&&(o.length>1&&(ye(o).opacity=0),ye(r).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(s=Zj(e.boundScale,e.boundOrient,+e.boundTolerance),r.forEach(u=>{s(u)||(u.opacity=0)}));const a=o[0].mark.bounds.clear();return r.forEach(u=>{u.opacity&&a.union(u.bounds)}),t}});function V5(e){T.call(this,null,e)}U(V5,T,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,i=>n.dirty(i)),t.fields&&t.fields.zindex){const i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}}});const Mt=new Ke;function La(e,t,n){return e[t]===n?0:(e[t]=n,1)}function eU(e){var t=e.items[0].orient;return t===li||t===fi}function tU(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function nU(e,t,n,i){var r=t.items[0],o=r.datum,s=r.translate!=null?r.translate:.5,a=r.orient,u=tU(o),l=r.range,c=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,g=o.title&&r.items[u[2]].items[0],p=r.titlePadding,m=r.bounds,y=g&&fv(g),b=0,x=0,v,w;switch(Mt.clear().union(m),m.clear(),(v=u[0])>-1&&m.union(r.items[v].bounds),(v=u[1])>-1&&m.union(r.items[v].bounds),a){case gu:b=f||0,x=-c,w=Math.max(d,Math.min(h,-m.y1)),m.add(0,-w).add(l,0),g&&Gf(e,g,w,p,y,0,-1,m);break;case li:b=-c,x=f||0,w=Math.max(d,Math.min(h,-m.x1)),m.add(-w,0).add(0,l),g&&Gf(e,g,w,p,y,1,-1,m);break;case fi:b=n+c,x=f||0,w=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(w,l),g&&Gf(e,g,w,p,y,1,1,m);break;case Ro:b=f||0,x=i+c,w=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(l,w),g&&Gf(e,g,w,p,0,0,1,m);break;default:b=r.x,x=r.y}return qr(m.translate(b,x),r),La(r,"x",b+s)|La(r,"y",x+s)&&(r.bounds=Mt,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function Gf(e,t,n,i,r,o,s,a){const u=t.bounds;if(t.auto){const l=s*(n+r+i);let c=0,f=0;e.dirty(t),o?c=(t.x||0)-(t.x=l):f=(t.y||0)-(t.y=l),t.mark.bounds.clear().union(u.translate(-c,-f)),e.dirty(t)}a.union(u)}const pE=(e,t)=>Math.floor(Math.min(e,t)),mE=(e,t)=>Math.ceil(Math.max(e,t));function iU(e){var t=e.items,n=t.length,i=0,r,o;const s={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i)if(r=t[i],o=r.items,r.marktype===pp)switch(r.role){case $v:case Cv:case Av:break;case R5:s.rowheaders.push(...o);break;case z5:s.rowfooters.push(...o);break;case L5:s.colheaders.push(...o);break;case I5:s.colfooters.push(...o);break;case P5:s.rowtitle=o[0];break;case B5:s.coltitle=o[0];break;default:s.marks.push(...o)}return s}function rU(e){return new Ke().set(0,0,e.width||0,e.height||0)}function oU(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Pe(e,t,n){const i=V(e)?e[t]:e;return i??(n!==void 0?n:0)}function yE(e){return e<0?Math.ceil(-e):0}function X5(e,t,n){var i=!n.nodirty,r=n.bounds===Fv?rU:oU,o=Mt.set(0,0,0,0),s=Pe(n.align,mo),a=Pe(n.align,yo),u=Pe(n.padding,mo),l=Pe(n.padding,yo),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),g=Array(c),p=0,m=Array(d),y=Array(f),b=0,x=Array(d),v=Array(d),w=Array(d),S,_,E,A,k,$,D,M,F,C,O;for(_=0;_<c;++_)g[_]=0;for(_=0;_<f;++_)y[_]=0;for(_=0;_<d;++_)$=t[_],k=w[_]=r($),$.x=$.x||0,x[_]=0,$.y=$.y||0,v[_]=0,E=_%c,A=~~(_/c),p=Math.max(p,D=Math.ceil(k.x2)),b=Math.max(b,M=Math.ceil(k.y2)),g[E]=Math.max(g[E],D),y[A]=Math.max(y[A],M),h[_]=u+yE(k.x1),m[_]=l+yE(k.y1),i&&e.dirty(t[_]);for(_=0;_<d;++_)_%c===0&&(h[_]=0),_<c&&(m[_]=0);if(s===D1)for(E=1;E<c;++E){for(O=0,_=E;_<d;_+=c)O<h[_]&&(O=h[_]);for(_=E;_<d;_+=c)h[_]=O+g[E-1]}else if(s===Wf){for(O=0,_=0;_<d;++_)_%c&&O<h[_]&&(O=h[_]);for(_=0;_<d;++_)_%c&&(h[_]=O+p)}else for(s=!1,E=1;E<c;++E)for(_=E;_<d;_+=c)h[_]+=g[E-1];if(a===D1)for(A=1;A<f;++A){for(O=0,_=A*c,S=_+c;_<S;++_)O<m[_]&&(O=m[_]);for(_=A*c;_<S;++_)m[_]=O+y[A-1]}else if(a===Wf){for(O=0,_=c;_<d;++_)O<m[_]&&(O=m[_]);for(_=c;_<d;++_)m[_]=O+b}else for(a=!1,A=1;A<f;++A)for(_=A*c,S=_+c;_<S;++_)m[_]+=y[A-1];for(F=0,_=0;_<d;++_)F=h[_]+(_%c?F:0),x[_]+=F-t[_].x;for(E=0;E<c;++E)for(C=0,_=E;_<d;_+=c)C+=m[_],v[_]+=C-t[_].y;if(s&&Pe(n.center,mo)&&f>1)for(_=0;_<d;++_)k=s===Wf?p:g[_%c],F=k-w[_].x2-t[_].x-x[_],F>0&&(x[_]+=F/2);if(a&&Pe(n.center,yo)&&c!==1)for(_=0;_<d;++_)k=a===Wf?b:y[~~(_/c)],C=k-w[_].y2-t[_].y-v[_],C>0&&(v[_]+=C/2);for(_=0;_<d;++_)o.union(w[_].translate(x[_],v[_]));switch(F=Pe(n.anchor,qj),C=Pe(n.anchor,Wj),Pe(n.anchor,mo)){case Gt:F-=o.width();break;case T1:F-=o.width()/2}switch(Pe(n.anchor,yo)){case Gt:C-=o.height();break;case T1:C-=o.height()/2}for(F=Math.round(F),C=Math.round(C),o.clear(),_=0;_<d;++_)t[_].mark.bounds.clear();for(_=0;_<d;++_)$=t[_],$.x+=x[_]+=F,$.y+=v[_]+=C,o.union($.mark.bounds.union($.bounds.translate(x[_],v[_]))),i&&e.dirty($);return o}function sU(e,t,n){var i=iU(t),r=i.marks,o=n.bounds===Fv?aU:uU,s=n.offset,a=n.columns||r.length,u=a<=0?1:Math.ceil(r.length/a),l=u*a,c,f,d,h,g,p,m;const y=X5(e,r,n);y.empty()&&y.set(0,0,0,0),i.rowheaders&&(p=Pe(n.headerBand,yo,null),c=Yf(e,i.rowheaders,r,a,u,-Pe(s,"rowHeader"),pE,0,o,"x1",0,a,1,p)),i.colheaders&&(p=Pe(n.headerBand,mo,null),f=Yf(e,i.colheaders,r,a,a,-Pe(s,"columnHeader"),pE,1,o,"y1",0,1,a,p)),i.rowfooters&&(p=Pe(n.footerBand,yo,null),d=Yf(e,i.rowfooters,r,a,u,Pe(s,"rowFooter"),mE,0,o,"x2",a-1,a,1,p)),i.colfooters&&(p=Pe(n.footerBand,mo,null),h=Yf(e,i.colfooters,r,a,a,Pe(s,"columnFooter"),mE,1,o,"y2",l-a,1,a,p)),i.rowtitle&&(g=Pe(n.titleAnchor,yo),m=Pe(s,"rowTitle"),m=g===Gt?d+m:c-m,p=Pe(n.titleBand,yo,.5),bE(e,i.rowtitle,m,0,y,p)),i.coltitle&&(g=Pe(n.titleAnchor,mo),m=Pe(s,"columnTitle"),m=g===Gt?h+m:f-m,p=Pe(n.titleBand,mo,.5),bE(e,i.coltitle,m,1,y,p))}function aU(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function uU(e,t){return e.bounds[t]}function Yf(e,t,n,i,r,o,s,a,u,l,c,f,d,h){var g=n.length,p=0,m=0,y,b,x,v,w,S,_,E,A;if(!g)return p;for(y=c;y<g;y+=f)n[y]&&(p=s(p,u(n[y],l)));if(!t.length)return p;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),p+=o,b=0,v=t.length;b<v;++b)e.dirty(t[b]),t[b].mark.bounds.clear();for(y=c,b=0,v=t.length;b<v;++b,y+=f){for(S=t[b],w=S.mark.bounds,x=y;x>=0&&(_=n[x])==null;x-=d);a?(E=h==null?_.x:Math.round(_.bounds.x1+h*_.bounds.width()),A=p):(E=p,A=h==null?_.y:Math.round(_.bounds.y1+h*_.bounds.height())),w.union(S.bounds.translate(E-(S.x||0),A-(S.y||0))),S.x=E,S.y=A,e.dirty(S),m=s(m,w[l])}return m}function bE(e,t,n,i,r,o){if(t){e.dirty(t);var s=n,a=n;i?s=Math.round(r.x1+o*r.width()):a=Math.round(r.y1+o*r.height()),t.bounds.translate(s-(t.x||0),a-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=s,t.y=a,e.dirty(t)}}function lU(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function cU(e,t){let n=-1/0;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-1/0?n:t}function fU(e,t,n,i,r,o,s){const a=lU(n,t),u=cU(e,a("offset",0)),l=a("anchor",kv),c=l===Gt?1:l===T1?.5:0,f={align:D1,bounds:a("bounds",Fv),columns:a("direction")==="vertical"?1:e.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(t){case li:f.anchor={x:Math.floor(i.x1)-u,column:Gt,y:c*(s||i.height()+2*i.y1),row:l};break;case fi:f.anchor={x:Math.ceil(i.x2)+u,y:c*(s||i.height()+2*i.y1),row:l};break;case gu:f.anchor={y:Math.floor(r.y1)-u,row:Gt,x:c*(o||r.width()+2*r.x1),column:l};break;case Ro:f.anchor={y:Math.ceil(r.y2)+u,x:c*(o||r.width()+2*r.x1),column:l};break;case Ij:f.anchor={x:u,y:u};break;case Bj:f.anchor={x:o-u,y:u,column:Gt};break;case jj:f.anchor={x:u,y:s-u,row:Gt};break;case Uj:f.anchor={x:o-u,y:s-u,column:Gt,row:Gt};break}return f}function dU(e,t){var n=t.items[0],i=n.datum,r=n.orient,o=n.bounds,s=n.x,a=n.y,u,l;return n._bounds?n._bounds.clear().union(o):n._bounds=o.clone(),o.clear(),gU(e,n,n.items[0].items[0]),o=hU(n,o),u=2*n.padding,l=2*n.padding,o.empty()||(u=Math.ceil(o.width()+u),l=Math.ceil(o.height()+l)),i.type===Vj&&pU(n.items[0].items[0].items[0].items),r!==Mv&&(n.x=s=0,n.y=a=0),n.width=u,n.height=l,qr(o.set(s,a,s+u,a+l),n),n.mark.bounds.clear().union(o),n}function hU(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function gU(e,t,n){var i=t.padding,r=i-n.x,o=i-n.y;if(!t.datum.title)(r||o)&&hl(e,n,r,o);else{var s=t.items[1].items[0],a=s.anchor,u=t.titlePadding||0,l=i-s.x,c=i-s.y;switch(s.orient){case li:r+=Math.ceil(s.bounds.width())+u;break;case fi:case Ro:break;default:o+=s.bounds.height()+u}switch((r||o)&&hl(e,n,r,o),s.orient){case li:c+=Ea(t,n,s,a,1,1);break;case fi:l+=Ea(t,n,s,Gt,0,0)+u,c+=Ea(t,n,s,a,1,1);break;case Ro:l+=Ea(t,n,s,a,0,0),c+=Ea(t,n,s,Gt,-1,0,1)+u;break;default:l+=Ea(t,n,s,a,0,0)}(l||c)&&hl(e,s,l,c),(l=Math.round(s.bounds.x1-i))<0&&(hl(e,n,-l,0),hl(e,s,-l,0))}}function Ea(e,t,n,i,r,o,s){const a=e.datum.type!=="symbol",u=n.datum.vgrad,l=a&&(o||!u)&&!s?t.items[0]:t,c=l.bounds[r?"y2":"x2"]-e.padding,f=u&&o?c:0,d=u&&o?0:c,h=r<=0?0:fv(n);return Math.round(i===kv?f:i===Gt?d-h:.5*(c-h))}function hl(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function pU(e){const t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function mU(e,t,n,i,r){var o=t.items[0],s=o.frame,a=o.orient,u=o.anchor,l=o.offset,c=o.padding,f=o.items[0].items[0],d=o.items[1]&&o.items[1].items[0],h=a===li||a===fi?i:n,g=0,p=0,m=0,y=0,b=0,x;if(s!==pp?a===li?(g=r.y2,h=r.y1):a===fi?(g=r.y1,h=r.y2):(g=r.x1,h=r.x2):a===li&&(g=i,h=0),x=u===kv?g:u===Gt?h:(g+h)/2,d&&d.text){switch(a){case gu:case Ro:b=f.bounds.height()+c;break;case li:y=f.bounds.width()+c;break;case fi:y=-f.bounds.width()-c;break}Mt.clear().union(d.bounds),Mt.translate(y-(d.x||0),b-(d.y||0)),La(d,"x",y)|La(d,"y",b)&&(e.dirty(d),d.bounds.clear().union(Mt),d.mark.bounds.clear().union(Mt),e.dirty(d)),Mt.clear().union(d.bounds)}else Mt.clear();switch(Mt.union(f.bounds),a){case gu:p=x,m=r.y1-Mt.height()-l;break;case li:p=r.x1-Mt.width()-l,m=x;break;case fi:p=r.x2+Mt.width()+l,m=x;break;case Ro:p=x,m=r.y2+l;break;default:p=o.x,m=o.y}return La(o,"x",p)|La(o,"y",m)&&(Mt.translate(p,m),e.dirty(o),o.bounds.clear().union(Mt),t.bounds.clear().union(Mt),e.dirty(o)),o.bounds}function K5(e){T.call(this,null,e)}U(K5,T,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&sU(n,i,e.layout),bU(n,i,e)}),yU(e.mark.group)?t.reflow():t}});function yU(e){return e&&e.mark.role!=="legend-entry"}function bU(e,t,n){var i=t.items,r=Math.max(0,t.width||0),o=Math.max(0,t.height||0),s=new Ke().set(0,0,r,o),a=s.clone(),u=s.clone(),l=[],c,f,d,h,g,p;for(g=0,p=i.length;g<p;++g)switch(f=i[g],f.role){case $v:h=eU(f)?a:u,h.union(nU(e,f,r,o));break;case Av:c=f;break;case Cv:l.push(dU(e,f));break;case Hj:case Gj:case R5:case z5:case P5:case L5:case I5:case B5:a.union(f.bounds),u.union(f.bounds);break;default:s.union(f.bounds)}if(l.length){const m={};l.forEach(y=>{d=y.orient||fi,d!==Mv&&(m[d]||(m[d]=[])).push(y)});for(const y in m){const b=m[y];X5(e,b,fU(b,y,n.legends,a,u,r,o))}l.forEach(y=>{const b=y.bounds;if(b.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=b,e.dirty(y)),n.autosize&&(n.autosize.type===j5||n.autosize.type===U5||n.autosize.type===q5))switch(y.orient){case li:case fi:s.add(b.x1,0).add(b.x2,0);break;case gu:case Ro:s.add(0,b.y1).add(0,b.y2)}else s.union(b)})}s.union(a).union(u),c&&s.union(mU(e,c,r,o,s)),t.clip&&s.set(0,0,t.width||0,t.height||0),xU(e,t,s,n)}function xU(e,t,n,i){const r=i.autosize||{},o=r.type;if(e._autosize<1||!o)return;let s=e._width,a=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-u)),h=Math.max(0,Math.ceil(n.y2-c));if(r.contains===Yj){const g=e.padding();s-=g.left+g.right,a-=g.top+g.bottom}o===Mv?(l=0,f=0,u=s,c=a):o===j5?(u=Math.max(0,s-l-d),c=Math.max(0,a-f-h)):o===U5?(u=Math.max(0,s-l-d),a=c+f+h):o===q5?(s=u+l+d,c=Math.max(0,a-f-h)):o===Xj&&(s=u+l+d,a=c+f+h),e._resizeView(s,a,u,c,[l,f],r.resize)}const vU=Object.freeze(Object.defineProperty({__proto__:null,bound:W5,identifier:Tv,mark:H5,overlap:G5,render:V5,viewlayout:K5},Symbol.toStringTag,{value:"Module"}));function J5(e){T.call(this,null,e)}U(J5,T,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,o=e.scale,s=e.count==null?e.values?e.values.length:10:e.count,a=Gx(o,s,e.minstep),u=e.format||T3(n,o,a,e.formatSpecifier,e.formatType,!!e.values),l=e.values?F3(o,e.values,a):Yx(o,a);return r&&(i.rem=r),r=l.map((c,f)=>Se({index:f/(l.length-1||1),value:c,label:u(c)})),e.extra&&r.length&&r.push(Se({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}});function Q5(e){T.call(this,null,e)}function wU(){return Se({})}function _U(e){const t=Ru().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}U(Q5,T,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||wU,o=e.key||ee,s=this.value;return z(i.encode)&&(i.encode=null),s&&(e.modified("key")||t.modified(o))&&R("DataJoin does not support modified key function or fields."),s||(t=t.addAll(),this.value=s=_U(o)),t.visit(t.ADD,a=>{const u=o(a);let l=s.get(u);l?l.exit?(s.empty--,i.add.push(l)):i.mod.push(l):(l=r(a),s.set(u,l),i.add.push(l)),l.datum=a,l.exit=!1}),t.visit(t.MOD,a=>{const u=o(a),l=s.get(u);l&&(l.datum=a,i.mod.push(l))}),t.visit(t.REM,a=>{const u=o(a),l=s.get(u);a===l.datum&&!l.exit&&(i.rem.push(l),l.exit=!0,++s.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&s.empty>n.cleanThreshold)&&n.runAfter(s.clean),i}});function Z5(e){T.call(this,null,e)}U(Z5,T,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,o=t.encode;if(z(o))if(n.changed()||o.every(f=>r[f]))o=o[0],n.encode=null;else return t.StopPropagation;var s=o==="enter",a=r.update||to,u=r.enter||to,l=r.exit||to,c=(o&&!s?r[o]:a)||to;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{u(f,e),a(f,e)}),n.modifies(u.output),n.modifies(a.output),c!==to&&c!==a&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&l!==to&&(t.visit(t.REM,f=>{l(f,e)}),n.modifies(l.output)),s||c!==to){const f=t.MOD|(e.modified()?t.REFLOW:0);s?(t.visit(f,d=>{const h=u(d,e)||i;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(u.output)):t.visit(f,d=>{(c(d,e)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function eT(e){T.call(this,[],e)}U(eT,T,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,o=e.type||vd,s=e.scale,a=+e.limit,u=Gx(s,e.count==null?5:e.count,e.minstep),l=!!e.values||o===vd,c=e.format||R3(n,s,u,o,e.formatSpecifier,e.formatType,l),f=e.values||O3(s,u),d,h,g,p,m;return r&&(i.rem=r),o===vd?(a&&f.length>a?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,a-1),m=!0):r=f,ue(g=e.size)?(!e.values&&s(r[0])===0&&(r=r.slice(1)),p=r.reduce((y,b)=>Math.max(y,g(b,e)),0)):g=Bt(p=g||8),r=r.map((y,b)=>Se({index:b,label:c(y,b,r),value:y,offset:p,size:g(y,e)})),m&&(m=f[r.length],r.push(Se({index:r.length,label:`…${f.length-r.length} entries`,value:m,offset:p,size:g(m,e)})))):o===KL?(d=s.domain(),h=A3(s,d[0],ye(d)),f.length<3&&!e.values&&d[0]!==ye(d)&&(f=[d[0],ye(d)]),r=f.map((y,b)=>Se({index:b,label:c(y,b,f),value:y,perc:h(y)}))):(g=f.length-1,h=aI(s),r=f.map((y,b)=>Se({index:b,label:c(y,b,f),value:y,perc:b?h(y):0,perc2:b===g?1:h(f[b+1])}))),i.source=r,i.add=r,this.value=r,i}});const SU=e=>e.source.x,EU=e=>e.source.y,kU=e=>e.target.x,$U=e=>e.target.y;function Dv(e){T.call(this,{},e)}Dv.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};U(Dv,T,{transform(e,t){var n=e.sourceX||SU,i=e.sourceY||EU,r=e.targetX||kU,o=e.targetY||$U,s=e.as||"path",a=e.orient||"vertical",u=e.shape||"line",l=xE.get(u+"-"+a)||xE.get(u);return l||R("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[s]=l(n(c),i(c),r(c),o(c))}),t.reflow(e.modified()).modifies(s)}});const tT=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,AU=(e,t,n,i)=>tT(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),nT=(e,t,n,i)=>{var r=n-e,o=i-t,s=Math.hypot(r,o)/2,a=180*Math.atan2(o,r)/Math.PI;return"M"+e+","+t+"A"+s+","+s+" "+a+" 0 1 "+n+","+i},CU=(e,t,n,i)=>nT(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),iT=(e,t,n,i)=>{const r=n-e,o=i-t,s=.2*(r+o),a=.2*(o-r);return"M"+e+","+t+"C"+(e+s)+","+(t+a)+" "+(n+a)+","+(i-s)+" "+n+","+i},MU=(e,t,n,i)=>iT(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),FU=(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,TU=(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,DU=(e,t,n,i)=>{const r=Math.cos(e),o=Math.sin(e),s=Math.cos(n),a=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*o+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*s+","+t*a+"L"+i*s+","+i*a},NU=(e,t,n,i)=>{const r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i},OU=(e,t,n,i)=>{const r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i},RU=(e,t,n,i)=>{const r=Math.cos(e),o=Math.sin(e),s=Math.cos(n),a=Math.sin(n),u=(t+i)/2;return"M"+t*r+","+t*o+"C"+u*r+","+u*o+" "+u*s+","+u*a+" "+i*s+","+i*a},xE=Ru({line:tT,"line-radial":AU,arc:nT,"arc-radial":CU,curve:iT,"curve-radial":MU,"orthogonal-horizontal":FU,"orthogonal-vertical":TU,"orthogonal-radial":DU,"diagonal-horizontal":NU,"diagonal-vertical":OU,"diagonal-radial":RU});function Nv(e){T.call(this,null,e)}Nv.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};U(Nv,T,{transform(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],o=e.field||Ou,s=e.startAngle||0,a=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(o),c=l.length,f=s,d=(a-s)/SC(l),h=Tn(c),g,p,m;for(e.sort&&h.sort((y,b)=>l[y]-l[b]),g=0;g<c;++g)m=l[h[g]],p=u[h[g]],p[i]=f,p[r]=f+=m*d;return this.value=l,t.reflow(e.modified()).modifies(n)}});const zU=5;function PU(e){const t=e.type;return!e.bins&&(t===au||t===Jc||t===Qc)}function rT(e){return qx(e)&&e!==Gi}const LU=vi(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function oT(e){T.call(this,null,e),this.modified(!0)}U(oT,T,{transform(e,t){var n=t.dataflow,i=this.value,r=IU(e);(!i||r!==i.type)&&(this.value=i=we(r)());for(r in e)if(!LU[r]){if(r==="padding"&&rT(i.type))continue;ue(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return HU(i,e,WU(i,e,jU(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function IU(e){var t=e.type,n="",i;return t===Gi?Gi+"-"+au:(BU(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?Gi+"-":i===3?Uu+"-":""),(n+t||au).toLowerCase())}function BU(e){const t=e.type;return qx(t)&&t!==Ls&&t!==Is&&(e.scheme||e.range&&e.range.length&&e.range.every(Y))}function jU(e,t,n){const i=UU(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,o=e.type,s=t.zero||t.zero===void 0&&PU(e),a,u;if(!r)return 0;if(rT(o)&&t.padding&&r[0]!==ye(r)&&(r=qU(o,r,t.range,t.padding,t.exponent,t.constant)),(s||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(a=(r=r.slice()).length-1||1,s&&(r[0]>0&&(r[0]=0),r[a]<0&&(r[a]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[a]=t.domainMax),t.domainMid!=null)){u=t.domainMid;const l=u>r[a]?a+1:u<r[0]?0:a;l!==a&&n.warn("Scale domainMid exceeds domain min or max.",u),r.splice(l,0,u)}return e.domain(sT(o,r,n)),o===Ix&&e.unknown(t.domainImplicit?f1:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&Gx(e,t.nice)||null),r.length}function UU(e,t,n){return t?(e.domain(sT(e.type,t,n)),t.length):-1}function qU(e,t,n,i,r,o){var s=Math.abs(ye(n)-n[0]),a=s/(s-2*i),u=e===Ir?sb(t,null,a):e===Qc?Wd(t,null,a,.5):e===Jc?Wd(t,null,a,r||1):e===ep?ab(t,null,a,o||1):ob(t,null,a);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function sT(e,t,n){if(_3(e)){var i=Math.abs(t.reduce((r,o)=>r+(o<0?-1:o>0?1:0),0));i!==t.length&&n.warn("Log scale domain includes zero: "+j(t))}return t}function WU(e,t,n){let i=t.bins;if(i&&!z(i)){const r=e.domain(),o=r[0],s=ye(r),a=i.step;let u=i.start==null?o:i.start,l=i.stop==null?s:i.stop;a||R("Scale bins parameter missing step property."),u<o&&(u=a*Math.ceil(o/a)),l>s&&(l=a*Math.floor(s/a)),i=Tn(u,l+a/2,a)}return i?e.bins=i:e.bins&&delete e.bins,e.type===Bx&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function HU(e,t,n){var i=e.type,r=t.round||!1,o=t.range;if(t.rangeStep!=null)o=GU(i,t,n);else if(t.scheme&&(o=YU(i,t,n),ue(o))){if(e.interpolator)return e.interpolator(o);R(`Scale type ${i} does not support interpolating color schemes.`)}if(o&&S3(i))return e.interpolator(ip(N1(o,t.reverse),t.interpolate,t.interpolateGamma));o&&t.interpolate&&e.interpolate?e.interpolate(Wx(t.interpolate,t.interpolateGamma)):ue(e.round)?e.round(r):ue(e.rangeRound)&&e.interpolate(r?Xc:Ho),o&&e.range(N1(o,t.reverse))}function GU(e,t,n){e!==m3&&e!==b1&&R("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===b1?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Lx(n,r,i)]}function YU(e,t,n){var i=t.schemeExtent,r,o;return z(t.scheme)?o=ip(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),o=Hx(r),o||R(`Unrecognized scheme name: ${t.scheme}`)),n=e===np?n+1:e===Bx?n-1:e===uu||e===tp?+t.schemeCount||zU:n,S3(e)?vE(o,i,t.reverse):ue(o)?$3(vE(o,i),n):e===Ix?o:o.slice(0,n)}function vE(e,t,n){return ue(e)&&(t||n)?k3(e,N1(t||[0,1],n)):e}function N1(e,t){return t?e.slice().reverse():e}function aT(e){T.call(this,null,e)}U(aT,T,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(sa(e.sort)),this.modified(n),t}});const wE="zero",uT="center",lT="normalize",cT=["y0","y1"];function Ov(e){T.call(this,null,e)}Ov.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:wE,values:[wE,uT,lT]},{name:"as",type:"string",array:!0,length:2,default:cT}]};U(Ov,T,{transform(e,t){var n=e.as||cT,i=n[0],r=n[1],o=sa(e.sort),s=e.field||Ou,a=e.offset===uT?VU:e.offset===lT?XU:KU,u,l,c,f;for(u=JU(t.source,e.groupby,o,s),l=0,c=u.length,f=u.max;l<c;++l)a(u[l],f,s,i,r);return t.reflow(e.modified()).modifies(n)}});function VU(e,t,n,i,r){for(var o=(t-e.sum)/2,s=e.length,a=0,u;a<s;++a)u=e[a],u[i]=o,u[r]=o+=Math.abs(n(u))}function XU(e,t,n,i,r){for(var o=1/e.sum,s=0,a=e.length,u=0,l=0,c;u<a;++u)c=e[u],c[i]=s,c[r]=s=o*(l+=Math.abs(n(c)))}function KU(e,t,n,i,r){for(var o=0,s=0,a=e.length,u=0,l,c;u<a;++u)c=e[u],l=+n(c),l<0?(c[i]=s,c[r]=s+=l):(c[i]=o,c[r]=o+=l)}function JU(e,t,n,i){var r=[],o=p=>p(c),s,a,u,l,c,f,d,h,g;if(t==null)r.push(e.slice());else for(s={},a=0,u=e.length;a<u;++a)c=e[a],f=t.map(o),d=s[f],d||(s[f]=d=[],r.push(d)),d.push(c);for(f=0,g=0,l=r.length;f<l;++f){for(d=r[f],a=0,h=0,u=d.length;a<u;++a)h+=Math.abs(i(d[a]));d.sum=h,h>g&&(g=h),n&&d.sort(n)}return r.max=g,r}const QU=Object.freeze(Object.defineProperty({__proto__:null,axisticks:J5,datajoin:Q5,encode:Z5,legendentries:eT,linkpath:Dv,pie:Nv,scale:oT,sortitems:aT,stack:Ov},Symbol.toStringTag,{value:"Module"}));var ie=1e-6,wh=1e-12,he=Math.PI,We=he/2,_h=he/4,en=he*2,Ge=180/he,fe=he/180,me=Math.abs,Wu=Math.atan,Xn=Math.atan2,re=Math.cos,Vf=Math.ceil,fT=Math.exp,O1=Math.hypot,Sh=Math.log,Jm=Math.pow,te=Math.sin,jn=Math.sign||function(e){return e>0?1:e<0?-1:0},tn=Math.sqrt,Rv=Math.tan;function dT(e){return e>1?0:e<-1?he:Math.acos(e)}function vn(e){return e>1?We:e<-1?-We:Math.asin(e)}function bt(){}function Eh(e,t){e&&SE.hasOwnProperty(e.type)&&SE[e.type](e,t)}var _E={Feature:function(e,t){Eh(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)Eh(n[i].geometry,t)}},SE={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){R1(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)R1(n[i],t,0)},Polygon:function(e,t){EE(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)EE(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)Eh(n[i],t)}};function R1(e,t,n){var i=-1,r=e.length-n,o;for(t.lineStart();++i<r;)o=e[i],t.point(o[0],o[1],o[2]);t.lineEnd()}function EE(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)R1(e[n],t,1);t.polygonEnd()}function Er(e,t){e&&_E.hasOwnProperty(e.type)?_E[e.type](e,t):Eh(e,t)}var kh=new Qt,$h=new Qt,hT,gT,z1,P1,L1,er={point:bt,lineStart:bt,lineEnd:bt,polygonStart:function(){kh=new Qt,er.lineStart=ZU,er.lineEnd=eq},polygonEnd:function(){var e=+kh;$h.add(e<0?en+e:e),this.lineStart=this.lineEnd=this.point=bt},sphere:function(){$h.add(en)}};function ZU(){er.point=tq}function eq(){pT(hT,gT)}function tq(e,t){er.point=pT,hT=e,gT=t,e*=fe,t*=fe,z1=e,P1=re(t=t/2+_h),L1=te(t)}function pT(e,t){e*=fe,t*=fe,t=t/2+_h;var n=e-z1,i=n>=0?1:-1,r=i*n,o=re(t),s=te(t),a=L1*s,u=P1*o+a*re(r),l=a*i*te(r);kh.add(Xn(l,u)),z1=e,P1=o,L1=s}function nq(e){return $h=new Qt,Er(e,er),$h*2}function Ah(e){return[Xn(e[1],e[0]),vn(e[2])]}function Bs(e){var t=e[0],n=e[1],i=re(n);return[i*re(t),i*te(t),te(n)]}function Xf(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function pu(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Qm(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Kf(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Ch(e){var t=tn(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var je,un,Ue,Cn,ys,mT,yT,Ha,Jl,so,Br,_r={point:I1,lineStart:kE,lineEnd:$E,polygonStart:function(){_r.point=xT,_r.lineStart=iq,_r.lineEnd=rq,Jl=new Qt,er.polygonStart()},polygonEnd:function(){er.polygonEnd(),_r.point=I1,_r.lineStart=kE,_r.lineEnd=$E,kh<0?(je=-(Ue=180),un=-(Cn=90)):Jl>ie?Cn=90:Jl<-ie&&(un=-90),Br[0]=je,Br[1]=Ue},sphere:function(){je=-(Ue=180),un=-(Cn=90)}};function I1(e,t){so.push(Br=[je=e,Ue=e]),t<un&&(un=t),t>Cn&&(Cn=t)}function bT(e,t){var n=Bs([e*fe,t*fe]);if(Ha){var i=pu(Ha,n),r=[i[1],-i[0],0],o=pu(r,i);Ch(o),o=Ah(o);var s=e-ys,a=s>0?1:-1,u=o[0]*Ge*a,l,c=me(s)>180;c^(a*ys<u&&u<a*e)?(l=o[1]*Ge,l>Cn&&(Cn=l)):(u=(u+360)%360-180,c^(a*ys<u&&u<a*e)?(l=-o[1]*Ge,l<un&&(un=l)):(t<un&&(un=t),t>Cn&&(Cn=t))),c?e<ys?An(je,e)>An(je,Ue)&&(Ue=e):An(e,Ue)>An(je,Ue)&&(je=e):Ue>=je?(e<je&&(je=e),e>Ue&&(Ue=e)):e>ys?An(je,e)>An(je,Ue)&&(Ue=e):An(e,Ue)>An(je,Ue)&&(je=e)}else so.push(Br=[je=e,Ue=e]);t<un&&(un=t),t>Cn&&(Cn=t),Ha=n,ys=e}function kE(){_r.point=bT}function $E(){Br[0]=je,Br[1]=Ue,_r.point=I1,Ha=null}function xT(e,t){if(Ha){var n=e-ys;Jl.add(me(n)>180?n+(n>0?360:-360):n)}else mT=e,yT=t;er.point(e,t),bT(e,t)}function iq(){er.lineStart()}function rq(){xT(mT,yT),er.lineEnd(),me(Jl)>ie&&(je=-(Ue=180)),Br[0]=je,Br[1]=Ue,Ha=null}function An(e,t){return(t-=e)<0?t+360:t}function oq(e,t){return e[0]-t[0]}function AE(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function sq(e){var t,n,i,r,o,s,a;if(Cn=Ue=-(je=un=1/0),so=[],Er(e,_r),n=so.length){for(so.sort(oq),t=1,i=so[0],o=[i];t<n;++t)r=so[t],AE(i,r[0])||AE(i,r[1])?(An(i[0],r[1])>An(i[0],i[1])&&(i[1]=r[1]),An(r[0],i[1])>An(i[0],i[1])&&(i[0]=r[0])):o.push(i=r);for(s=-1/0,n=o.length-1,t=0,i=o[n];t<=n;i=r,++t)r=o[t],(a=An(i[1],r[0]))>s&&(s=a,je=r[0],Ue=i[1])}return so=Br=null,je===1/0||un===1/0?[[NaN,NaN],[NaN,NaN]]:[[je,un],[Ue,Cn]]}var Ol,Mh,Fh,Th,Dh,Nh,Oh,Rh,B1,j1,U1,vT,wT,Yt,Vt,Xt,di={sphere:bt,point:zv,lineStart:CE,lineEnd:ME,polygonStart:function(){di.lineStart=lq,di.lineEnd=cq},polygonEnd:function(){di.lineStart=CE,di.lineEnd=ME}};function zv(e,t){e*=fe,t*=fe;var n=re(t);cf(n*re(e),n*te(e),te(t))}function cf(e,t,n){++Ol,Fh+=(e-Fh)/Ol,Th+=(t-Th)/Ol,Dh+=(n-Dh)/Ol}function CE(){di.point=aq}function aq(e,t){e*=fe,t*=fe;var n=re(t);Yt=n*re(e),Vt=n*te(e),Xt=te(t),di.point=uq,cf(Yt,Vt,Xt)}function uq(e,t){e*=fe,t*=fe;var n=re(t),i=n*re(e),r=n*te(e),o=te(t),s=Xn(tn((s=Vt*o-Xt*r)*s+(s=Xt*i-Yt*o)*s+(s=Yt*r-Vt*i)*s),Yt*i+Vt*r+Xt*o);Mh+=s,Nh+=s*(Yt+(Yt=i)),Oh+=s*(Vt+(Vt=r)),Rh+=s*(Xt+(Xt=o)),cf(Yt,Vt,Xt)}function ME(){di.point=zv}function lq(){di.point=fq}function cq(){_T(vT,wT),di.point=zv}function fq(e,t){vT=e,wT=t,e*=fe,t*=fe,di.point=_T;var n=re(t);Yt=n*re(e),Vt=n*te(e),Xt=te(t),cf(Yt,Vt,Xt)}function _T(e,t){e*=fe,t*=fe;var n=re(t),i=n*re(e),r=n*te(e),o=te(t),s=Vt*o-Xt*r,a=Xt*i-Yt*o,u=Yt*r-Vt*i,l=O1(s,a,u),c=vn(l),f=l&&-c/l;B1.add(f*s),j1.add(f*a),U1.add(f*u),Mh+=c,Nh+=c*(Yt+(Yt=i)),Oh+=c*(Vt+(Vt=r)),Rh+=c*(Xt+(Xt=o)),cf(Yt,Vt,Xt)}function dq(e){Ol=Mh=Fh=Th=Dh=Nh=Oh=Rh=0,B1=new Qt,j1=new Qt,U1=new Qt,Er(e,di);var t=+B1,n=+j1,i=+U1,r=O1(t,n,i);return r<wh&&(t=Nh,n=Oh,i=Rh,Mh<ie&&(t=Fh,n=Th,i=Dh),r=O1(t,n,i),r<wh)?[NaN,NaN]:[Xn(n,t)*Ge,vn(i/r)*Ge]}function q1(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function W1(e,t){return me(e)>he&&(e-=Math.round(e/en)*en),[e,t]}W1.invert=W1;function ST(e,t,n){return(e%=en)?t||n?q1(TE(e),DE(t,n)):TE(e):t||n?DE(t,n):W1}function FE(e){return function(t,n){return t+=e,me(t)>he&&(t-=Math.round(t/en)*en),[t,n]}}function TE(e){var t=FE(e);return t.invert=FE(-e),t}function DE(e,t){var n=re(e),i=te(e),r=re(t),o=te(t);function s(a,u){var l=re(u),c=re(a)*l,f=te(a)*l,d=te(u),h=d*n+c*i;return[Xn(f*r-h*o,c*n-d*i),vn(h*r+f*o)]}return s.invert=function(a,u){var l=re(u),c=re(a)*l,f=te(a)*l,d=te(u),h=d*r-f*o;return[Xn(f*r+d*o,c*n+h*i),vn(h*n-c*i)]},s}function hq(e){e=ST(e[0]*fe,e[1]*fe,e.length>2?e[2]*fe:0);function t(n){return n=e(n[0]*fe,n[1]*fe),n[0]*=Ge,n[1]*=Ge,n}return t.invert=function(n){return n=e.invert(n[0]*fe,n[1]*fe),n[0]*=Ge,n[1]*=Ge,n},t}function gq(e,t,n,i,r,o){if(n){var s=re(t),a=te(t),u=i*n;r==null?(r=t+i*en,o=t-u/2):(r=NE(s,r),o=NE(s,o),(i>0?r<o:r>o)&&(r+=i*en));for(var l,c=r;i>0?c>o:c<o;c-=u)l=Ah([s,-a*re(c),-a*te(c)]),e.point(l[0],l[1])}}function NE(e,t){t=Bs(t),t[0]-=e,Ch(t);var n=dT(-t[1]);return((-t[2]<0?-n:n)+en-ie)%en}function ET(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:bt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Cd(e,t){return me(e[0]-t[0])<ie&&me(e[1]-t[1])<ie}function Jf(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function kT(e,t,n,i,r){var o=[],s=[],a,u;if(e.forEach(function(g){if(!((p=g.length-1)<=0)){var p,m=g[0],y=g[p],b;if(Cd(m,y)){if(!m[2]&&!y[2]){for(r.lineStart(),a=0;a<p;++a)r.point((m=g[a])[0],m[1]);r.lineEnd();return}y[0]+=2*ie}o.push(b=new Jf(m,g,null,!0)),s.push(b.o=new Jf(m,null,b,!1)),o.push(b=new Jf(y,g,null,!1)),s.push(b.o=new Jf(y,null,b,!0))}}),!!o.length){for(s.sort(t),OE(o),OE(s),a=0,u=s.length;a<u;++a)s[a].e=n=!n;for(var l=o[0],c,f;;){for(var d=l,h=!0;d.v;)if((d=d.n)===l)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,u=c.length;a<u;++a)r.point((f=c[a])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(c=d.p.z,a=c.length-1;a>=0;--a)r.point((f=c[a])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);r.lineEnd()}}}function OE(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function Zm(e){return me(e[0])<=he?e[0]:jn(e[0])*((me(e[0])+he)%en-he)}function pq(e,t){var n=Zm(t),i=t[1],r=te(i),o=[te(n),-re(n),0],s=0,a=0,u=new Qt;r===1?i=We+ie:r===-1&&(i=-We-ie);for(var l=0,c=e.length;l<c;++l)if(d=(f=e[l]).length)for(var f,d,h=f[d-1],g=Zm(h),p=h[1]/2+_h,m=te(p),y=re(p),b=0;b<d;++b,g=v,m=S,y=_,h=x){var x=f[b],v=Zm(x),w=x[1]/2+_h,S=te(w),_=re(w),E=v-g,A=E>=0?1:-1,k=A*E,$=k>he,D=m*S;if(u.add(Xn(D*A*te(k),y*_+D*re(k))),s+=$?E+A*en:E,$^g>=n^v>=n){var M=pu(Bs(h),Bs(x));Ch(M);var F=pu(o,M);Ch(F);var C=($^E>=0?-1:1)*vn(F[2]);(i>C||i===C&&(M[0]||M[1]))&&(a+=$^E>=0?1:-1)}}return(s<-ie||s<ie&&u<-wh)^a&1}function $T(e,t,n,i){return function(r){var o=t(r),s=ET(),a=t(s),u=!1,l,c,f,d={point:h,lineStart:p,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=b,d.lineEnd=x,c=[],l=[]},polygonEnd:function(){d.point=h,d.lineStart=p,d.lineEnd=m,c=_C(c);var v=pq(l,i);c.length?(u||(r.polygonStart(),u=!0),kT(c,yq,v,n,r)):v&&(u||(r.polygonStart(),u=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),u&&(r.polygonEnd(),u=!1),c=l=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(v,w){e(v,w)&&r.point(v,w)}function g(v,w){o.point(v,w)}function p(){d.point=g,o.lineStart()}function m(){d.point=h,o.lineEnd()}function y(v,w){f.push([v,w]),a.point(v,w)}function b(){a.lineStart(),f=[]}function x(){y(f[0][0],f[0][1]),a.lineEnd();var v=a.clean(),w=s.result(),S,_=w.length,E,A,k;if(f.pop(),l.push(f),f=null,!!_){if(v&1){if(A=w[0],(E=A.length-1)>0){for(u||(r.polygonStart(),u=!0),r.lineStart(),S=0;S<E;++S)r.point((k=A[S])[0],k[1]);r.lineEnd()}return}_>1&&v&2&&w.push(w.pop().concat(w.shift())),c.push(w.filter(mq))}}return d}}function mq(e){return e.length>1}function yq(e,t){return((e=e.x)[0]<0?e[1]-We-ie:We-e[1])-((t=t.x)[0]<0?t[1]-We-ie:We-t[1])}const RE=$T(function(){return!0},bq,vq,[-he,-We]);function bq(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(o,s){var a=o>0?he:-he,u=me(o-t);me(u-he)<ie?(e.point(t,n=(n+s)/2>0?We:-We),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(o,n),r=0):i!==a&&u>=he&&(me(t-i)<ie&&(t-=i*ie),me(o-a)<ie&&(o-=a*ie),n=xq(t,n,o,s),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=o,n=s),i=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function xq(e,t,n,i){var r,o,s=te(e-n);return me(s)>ie?Wu((te(t)*(o=re(i))*te(n)-te(i)*(r=re(t))*te(e))/(r*o*s)):(t+i)/2}function vq(e,t,n,i){var r;if(e==null)r=n*We,i.point(-he,r),i.point(0,r),i.point(he,r),i.point(he,0),i.point(he,-r),i.point(0,-r),i.point(-he,-r),i.point(-he,0),i.point(-he,r);else if(me(e[0]-t[0])>ie){var o=e[0]<t[0]?he:-he;r=n*o/2,i.point(-o,r),i.point(0,r),i.point(o,r)}else i.point(t[0],t[1])}function wq(e){var t=re(e),n=6*fe,i=t>0,r=me(t)>ie;function o(c,f,d,h){gq(h,e,n,d,c,f)}function s(c,f){return re(c)*re(f)>t}function a(c){var f,d,h,g,p;return{lineStart:function(){g=h=!1,p=1},point:function(m,y){var b=[m,y],x,v=s(m,y),w=i?v?0:l(m,y):v?l(m+(m<0?he:-he),y):0;if(!f&&(g=h=v)&&c.lineStart(),v!==h&&(x=u(f,b),(!x||Cd(f,x)||Cd(b,x))&&(b[2]=1)),v!==h)p=0,v?(c.lineStart(),x=u(b,f),c.point(x[0],x[1])):(x=u(f,b),c.point(x[0],x[1],2),c.lineEnd()),f=x;else if(r&&f&&i^v){var S;!(w&d)&&(S=u(b,f,!0))&&(p=0,i?(c.lineStart(),c.point(S[0][0],S[0][1]),c.point(S[1][0],S[1][1]),c.lineEnd()):(c.point(S[1][0],S[1][1]),c.lineEnd(),c.lineStart(),c.point(S[0][0],S[0][1],3)))}v&&(!f||!Cd(f,b))&&c.point(b[0],b[1]),f=b,h=v,d=w},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return p|(g&&h)<<1}}}function u(c,f,d){var h=Bs(c),g=Bs(f),p=[1,0,0],m=pu(h,g),y=Xf(m,m),b=m[0],x=y-b*b;if(!x)return!d&&c;var v=t*y/x,w=-t*b/x,S=pu(p,m),_=Kf(p,v),E=Kf(m,w);Qm(_,E);var A=S,k=Xf(_,A),$=Xf(A,A),D=k*k-$*(Xf(_,_)-1);if(!(D<0)){var M=tn(D),F=Kf(A,(-k-M)/$);if(Qm(F,_),F=Ah(F),!d)return F;var C=c[0],O=f[0],q=c[1],G=f[1],K;O<C&&(K=C,C=O,O=K);var ce=O-C,Be=me(ce-he)<ie,Qe=Be||ce<ie;if(!Be&&G<q&&(K=q,q=G,G=K),Qe?Be?q+G>0^F[1]<(me(F[0]-C)<ie?q:G):q<=F[1]&&F[1]<=G:ce>he^(C<=F[0]&&F[0]<=O)){var ot=Kf(A,(-k+M)/$);return Qm(ot,_),[F,Ah(ot)]}}}function l(c,f){var d=i?e:he-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return $T(s,a,o,i?[0,-e]:[-he,e-he])}function _q(e,t,n,i,r,o){var s=e[0],a=e[1],u=t[0],l=t[1],c=0,f=1,d=u-s,h=l-a,g;if(g=n-s,!(!d&&g>0)){if(g/=d,d<0){if(g<c)return;g<f&&(f=g)}else if(d>0){if(g>f)return;g>c&&(c=g)}if(g=r-s,!(!d&&g<0)){if(g/=d,d<0){if(g>f)return;g>c&&(c=g)}else if(d>0){if(g<c)return;g<f&&(f=g)}if(g=i-a,!(!h&&g>0)){if(g/=h,h<0){if(g<c)return;g<f&&(f=g)}else if(h>0){if(g>f)return;g>c&&(c=g)}if(g=o-a,!(!h&&g<0)){if(g/=h,h<0){if(g>f)return;g>c&&(c=g)}else if(h>0){if(g<c)return;g<f&&(f=g)}return c>0&&(e[0]=s+c*d,e[1]=a+c*h),f<1&&(t[0]=s+f*d,t[1]=a+f*h),!0}}}}}var Rl=1e9,Qf=-Rl;function AT(e,t,n,i){function r(l,c){return e<=l&&l<=n&&t<=c&&c<=i}function o(l,c,f,d){var h=0,g=0;if(l==null||(h=s(l,f))!==(g=s(c,f))||u(l,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?i:t);while((h=(h+f+4)%4)!==g);else d.point(c[0],c[1])}function s(l,c){return me(l[0]-e)<ie?c>0?0:3:me(l[0]-n)<ie?c>0?2:1:me(l[1]-t)<ie?c>0?1:0:c>0?3:2}function a(l,c){return u(l.x,c.x)}function u(l,c){var f=s(l,1),d=s(c,1);return f!==d?f-d:f===0?c[1]-l[1]:f===1?l[0]-c[0]:f===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,f=ET(),d,h,g,p,m,y,b,x,v,w,S,_={point:E,lineStart:D,lineEnd:M,polygonStart:k,polygonEnd:$};function E(C,O){r(C,O)&&c.point(C,O)}function A(){for(var C=0,O=0,q=h.length;O<q;++O)for(var G=h[O],K=1,ce=G.length,Be=G[0],Qe,ot,jt=Be[0],Xe=Be[1];K<ce;++K)Qe=jt,ot=Xe,Be=G[K],jt=Be[0],Xe=Be[1],ot<=i?Xe>i&&(jt-Qe)*(i-ot)>(Xe-ot)*(e-Qe)&&++C:Xe<=i&&(jt-Qe)*(i-ot)<(Xe-ot)*(e-Qe)&&--C;return C}function k(){c=f,d=[],h=[],S=!0}function $(){var C=A(),O=S&&C,q=(d=_C(d)).length;(O||q)&&(l.polygonStart(),O&&(l.lineStart(),o(null,null,1,l),l.lineEnd()),q&&kT(d,a,C,o,l),l.polygonEnd()),c=l,d=h=g=null}function D(){_.point=F,h&&h.push(g=[]),w=!0,v=!1,b=x=NaN}function M(){d&&(F(p,m),y&&v&&f.rejoin(),d.push(f.result())),_.point=E,v&&c.lineEnd()}function F(C,O){var q=r(C,O);if(h&&g.push([C,O]),w)p=C,m=O,y=q,w=!1,q&&(c.lineStart(),c.point(C,O));else if(q&&v)c.point(C,O);else{var G=[b=Math.max(Qf,Math.min(Rl,b)),x=Math.max(Qf,Math.min(Rl,x))],K=[C=Math.max(Qf,Math.min(Rl,C)),O=Math.max(Qf,Math.min(Rl,O))];_q(G,K,e,t,n,i)?(v||(c.lineStart(),c.point(G[0],G[1])),c.point(K[0],K[1]),q||c.lineEnd(),S=!1):q&&(c.lineStart(),c.point(C,O),S=!1)}b=C,x=O,v=q}return _}}function zE(e,t,n){var i=Tn(e,t-ie,n).concat(t);return function(r){return i.map(function(o){return[r,o]})}}function PE(e,t,n){var i=Tn(e,t-ie,n).concat(t);return function(r){return i.map(function(o){return[o,r]})}}function Sq(){var e,t,n,i,r,o,s,a,u=10,l=u,c=90,f=360,d,h,g,p,m=2.5;function y(){return{type:"MultiLineString",coordinates:b()}}function b(){return Tn(Vf(i/c)*c,n,c).map(g).concat(Tn(Vf(a/f)*f,s,f).map(p)).concat(Tn(Vf(t/u)*u,e,u).filter(function(x){return me(x%c)>ie}).map(d)).concat(Tn(Vf(o/l)*l,r,l).filter(function(x){return me(x%f)>ie}).map(h))}return y.lines=function(){return b().map(function(x){return{type:"LineString",coordinates:x}})},y.outline=function(){return{type:"Polygon",coordinates:[g(i).concat(p(s).slice(1),g(n).reverse().slice(1),p(a).reverse().slice(1))]}},y.extent=function(x){return arguments.length?y.extentMajor(x).extentMinor(x):y.extentMinor()},y.extentMajor=function(x){return arguments.length?(i=+x[0][0],n=+x[1][0],a=+x[0][1],s=+x[1][1],i>n&&(x=i,i=n,n=x),a>s&&(x=a,a=s,s=x),y.precision(m)):[[i,a],[n,s]]},y.extentMinor=function(x){return arguments.length?(t=+x[0][0],e=+x[1][0],o=+x[0][1],r=+x[1][1],t>e&&(x=t,t=e,e=x),o>r&&(x=o,o=r,r=x),y.precision(m)):[[t,o],[e,r]]},y.step=function(x){return arguments.length?y.stepMajor(x).stepMinor(x):y.stepMinor()},y.stepMajor=function(x){return arguments.length?(c=+x[0],f=+x[1],y):[c,f]},y.stepMinor=function(x){return arguments.length?(u=+x[0],l=+x[1],y):[u,l]},y.precision=function(x){return arguments.length?(m=+x,d=zE(o,r,90),h=PE(t,e,m),g=zE(a,s,90),p=PE(i,n,m),y):m},y.extentMajor([[-180,-90+ie],[180,90-ie]]).extentMinor([[-180,-80-ie],[180,80+ie]])}const Sc=e=>e;var e0=new Qt,H1=new Qt,CT,MT,G1,Y1,co={point:bt,lineStart:bt,lineEnd:bt,polygonStart:function(){co.lineStart=Eq,co.lineEnd=$q},polygonEnd:function(){co.lineStart=co.lineEnd=co.point=bt,e0.add(me(H1)),H1=new Qt},result:function(){var e=e0/2;return e0=new Qt,e}};function Eq(){co.point=kq}function kq(e,t){co.point=FT,CT=G1=e,MT=Y1=t}function FT(e,t){H1.add(Y1*e-G1*t),G1=e,Y1=t}function $q(){FT(CT,MT)}const LE=co;var mu=1/0,zh=mu,Ec=-mu,Ph=Ec,Aq={point:Cq,lineStart:bt,lineEnd:bt,polygonStart:bt,polygonEnd:bt,result:function(){var e=[[mu,zh],[Ec,Ph]];return Ec=Ph=-(zh=mu=1/0),e}};function Cq(e,t){e<mu&&(mu=e),e>Ec&&(Ec=e),t<zh&&(zh=t),t>Ph&&(Ph=t)}const Lh=Aq;var V1=0,X1=0,zl=0,Ih=0,Bh=0,Ia=0,K1=0,J1=0,Pl=0,TT,DT,Bi,ji,ci={point:js,lineStart:IE,lineEnd:BE,polygonStart:function(){ci.lineStart=Tq,ci.lineEnd=Dq},polygonEnd:function(){ci.point=js,ci.lineStart=IE,ci.lineEnd=BE},result:function(){var e=Pl?[K1/Pl,J1/Pl]:Ia?[Ih/Ia,Bh/Ia]:zl?[V1/zl,X1/zl]:[NaN,NaN];return V1=X1=zl=Ih=Bh=Ia=K1=J1=Pl=0,e}};function js(e,t){V1+=e,X1+=t,++zl}function IE(){ci.point=Mq}function Mq(e,t){ci.point=Fq,js(Bi=e,ji=t)}function Fq(e,t){var n=e-Bi,i=t-ji,r=tn(n*n+i*i);Ih+=r*(Bi+e)/2,Bh+=r*(ji+t)/2,Ia+=r,js(Bi=e,ji=t)}function BE(){ci.point=js}function Tq(){ci.point=Nq}function Dq(){NT(TT,DT)}function Nq(e,t){ci.point=NT,js(TT=Bi=e,DT=ji=t)}function NT(e,t){var n=e-Bi,i=t-ji,r=tn(n*n+i*i);Ih+=r*(Bi+e)/2,Bh+=r*(ji+t)/2,Ia+=r,r=ji*e-Bi*t,K1+=r*(Bi+e),J1+=r*(ji+t),Pl+=r*3,js(Bi=e,ji=t)}const jE=ci;function OT(e){this._context=e}OT.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,en);break}}},result:bt};var Q1=new Qt,t0,RT,zT,Ll,Il,jh={point:bt,lineStart:function(){jh.point=Oq},lineEnd:function(){t0&&PT(RT,zT),jh.point=bt},polygonStart:function(){t0=!0},polygonEnd:function(){t0=null},result:function(){var e=+Q1;return Q1=new Qt,e}};function Oq(e,t){jh.point=PT,RT=Ll=e,zT=Il=t}function PT(e,t){Ll-=e,Il-=t,Q1.add(tn(Ll*Ll+Il*Il)),Ll=e,Il=t}const UE=jh;let qE,Uh,WE,HE;class GE{constructor(t){this._append=t==null?LT:Rq(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==WE||this._append!==Uh){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,WE=i,Uh=this._append,HE=this._,this._=r}this._+=HE;break}}}result(){const t=this._;return this._="",t.length?t:null}}function LT(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function Rq(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return LT;if(t!==qE){const n=10**t;qE=t,Uh=function(r){let o=1;this._+=r[0];for(const s=r.length;o<s;++o)this._+=Math.round(arguments[o]*n)/n+r[o]}}return Uh}function IT(e,t){let n=3,i=4.5,r,o;function s(a){return a&&(typeof i=="function"&&o.pointRadius(+i.apply(this,arguments)),Er(a,r(o))),o.result()}return s.area=function(a){return Er(a,r(LE)),LE.result()},s.measure=function(a){return Er(a,r(UE)),UE.result()},s.bounds=function(a){return Er(a,r(Lh)),Lh.result()},s.centroid=function(a){return Er(a,r(jE)),jE.result()},s.projection=function(a){return arguments.length?(r=a==null?(e=null,Sc):(e=a).stream,s):e},s.context=function(a){return arguments.length?(o=a==null?(t=null,new GE(n)):new OT(t=a),typeof i!="function"&&o.pointRadius(i),s):t},s.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(o.pointRadius(+a),+a),s):i},s.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const u=Math.floor(a);if(!(u>=0))throw new RangeError(`invalid digits: ${a}`);n=u}return t===null&&(o=new GE(n)),s},s.projection(e).digits(n).context(t)}function mp(e){return function(t){var n=new Z1;for(var i in e)n[i]=e[i];return n.stream=t,n}}function Z1(){}Z1.prototype={constructor:Z1,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Pv(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Er(n,e.stream(Lh)),t(Lh.result()),i!=null&&e.clipExtent(i),e}function yp(e,t,n){return Pv(e,function(i){var r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],s=Math.min(r/(i[1][0]-i[0][0]),o/(i[1][1]-i[0][1])),a=+t[0][0]+(r-s*(i[1][0]+i[0][0]))/2,u=+t[0][1]+(o-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([a,u])},n)}function Lv(e,t,n){return yp(e,[[0,0],t],n)}function Iv(e,t,n){return Pv(e,function(i){var r=+t,o=r/(i[1][0]-i[0][0]),s=(r-o*(i[1][0]+i[0][0]))/2,a=-o*i[0][1];e.scale(150*o).translate([s,a])},n)}function Bv(e,t,n){return Pv(e,function(i){var r=+t,o=r/(i[1][1]-i[0][1]),s=-o*i[0][0],a=(r-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([s,a])},n)}var YE=16,zq=re(30*fe);function VE(e,t){return+t?Lq(e,t):Pq(e)}function Pq(e){return mp({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Lq(e,t){function n(i,r,o,s,a,u,l,c,f,d,h,g,p,m){var y=l-i,b=c-r,x=y*y+b*b;if(x>4*t&&p--){var v=s+d,w=a+h,S=u+g,_=tn(v*v+w*w+S*S),E=vn(S/=_),A=me(me(S)-1)<ie||me(o-f)<ie?(o+f)/2:Xn(w,v),k=e(A,E),$=k[0],D=k[1],M=$-i,F=D-r,C=b*M-y*F;(C*C/x>t||me((y*M+b*F)/x-.5)>.3||s*d+a*h+u*g<zq)&&(n(i,r,o,s,a,u,$,D,A,v/=_,w/=_,S,p,m),m.point($,D),n($,D,A,v,w,S,l,c,f,d,h,g,p,m))}}return function(i){var r,o,s,a,u,l,c,f,d,h,g,p,m={point:y,lineStart:b,lineEnd:v,polygonStart:function(){i.polygonStart(),m.lineStart=w},polygonEnd:function(){i.polygonEnd(),m.lineStart=b}};function y(E,A){E=e(E,A),i.point(E[0],E[1])}function b(){f=NaN,m.point=x,i.lineStart()}function x(E,A){var k=Bs([E,A]),$=e(E,A);n(f,d,c,h,g,p,f=$[0],d=$[1],c=E,h=k[0],g=k[1],p=k[2],YE,i),i.point(f,d)}function v(){m.point=y,i.lineEnd()}function w(){b(),m.point=S,m.lineEnd=_}function S(E,A){x(r=E,A),o=f,s=d,a=h,u=g,l=p,m.point=x}function _(){n(f,d,c,h,g,p,o,s,r,a,u,l,YE,i),m.lineEnd=v,v()}return m}}var Iq=mp({point:function(e,t){this.stream.point(e*fe,t*fe)}});function Bq(e){return mp({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function jq(e,t,n,i,r){function o(s,a){return s*=i,a*=r,[t+e*s,n-e*a]}return o.invert=function(s,a){return[(s-t)/e*i,(n-a)/e*r]},o}function XE(e,t,n,i,r,o){if(!o)return jq(e,t,n,i,r);var s=re(o),a=te(o),u=s*e,l=a*e,c=s/e,f=a/e,d=(a*n-s*t)/e,h=(a*t+s*n)/e;function g(p,m){return p*=i,m*=r,[u*p-l*m+t,n-l*p-u*m]}return g.invert=function(p,m){return[i*(c*p-f*m+d),r*(h-f*p-c*m)]},g}function lr(e){return BT(function(){return e})()}function BT(e){var t,n=150,i=480,r=250,o=0,s=0,a=0,u=0,l=0,c,f=0,d=1,h=1,g=null,p=RE,m=null,y,b,x,v=Sc,w=.5,S,_,E,A,k;function $(C){return E(C[0]*fe,C[1]*fe)}function D(C){return C=E.invert(C[0],C[1]),C&&[C[0]*Ge,C[1]*Ge]}$.stream=function(C){return A&&k===C?A:A=Iq(Bq(c)(p(S(v(k=C)))))},$.preclip=function(C){return arguments.length?(p=C,g=void 0,F()):p},$.postclip=function(C){return arguments.length?(v=C,m=y=b=x=null,F()):v},$.clipAngle=function(C){return arguments.length?(p=+C?wq(g=C*fe):(g=null,RE),F()):g*Ge},$.clipExtent=function(C){return arguments.length?(v=C==null?(m=y=b=x=null,Sc):AT(m=+C[0][0],y=+C[0][1],b=+C[1][0],x=+C[1][1]),F()):m==null?null:[[m,y],[b,x]]},$.scale=function(C){return arguments.length?(n=+C,M()):n},$.translate=function(C){return arguments.length?(i=+C[0],r=+C[1],M()):[i,r]},$.center=function(C){return arguments.length?(o=C[0]%360*fe,s=C[1]%360*fe,M()):[o*Ge,s*Ge]},$.rotate=function(C){return arguments.length?(a=C[0]%360*fe,u=C[1]%360*fe,l=C.length>2?C[2]%360*fe:0,M()):[a*Ge,u*Ge,l*Ge]},$.angle=function(C){return arguments.length?(f=C%360*fe,M()):f*Ge},$.reflectX=function(C){return arguments.length?(d=C?-1:1,M()):d<0},$.reflectY=function(C){return arguments.length?(h=C?-1:1,M()):h<0},$.precision=function(C){return arguments.length?(S=VE(_,w=C*C),F()):tn(w)},$.fitExtent=function(C,O){return yp($,C,O)},$.fitSize=function(C,O){return Lv($,C,O)},$.fitWidth=function(C,O){return Iv($,C,O)},$.fitHeight=function(C,O){return Bv($,C,O)};function M(){var C=XE(n,0,0,d,h,f).apply(null,t(o,s)),O=XE(n,i-C[0],r-C[1],d,h,f);return c=ST(a,u,l),_=q1(t,O),E=q1(c,_),S=VE(_,w),F()}function F(){return A=k=null,$}return function(){return t=e.apply(this,arguments),$.invert=t.invert&&D,M()}}function jv(e){var t=0,n=he/3,i=BT(e),r=i(t,n);return r.parallels=function(o){return arguments.length?i(t=o[0]*fe,n=o[1]*fe):[t*Ge,n*Ge]},r}function Uq(e){var t=re(e);function n(i,r){return[i*t,te(r)/t]}return n.invert=function(i,r){return[i/t,vn(r*t)]},n}function qq(e,t){var n=te(e),i=(n+te(t))/2;if(me(i)<ie)return Uq(e);var r=1+n*(2*i-n),o=tn(r)/i;function s(a,u){var l=tn(r-2*i*te(u))/i;return[l*te(a*=i),o-l*re(a)]}return s.invert=function(a,u){var l=o-u,c=Xn(a,me(l))*jn(l);return l*i<0&&(c-=he*jn(a)*jn(l)),[c/i,vn((r-(a*a+l*l)*i*i)/(2*i))]},s}function qh(){return jv(qq).scale(155.424).center([0,33.6442])}function jT(){return qh().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Wq(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function Hq(){var e,t,n=jT(),i,r=qh().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,s=qh().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,l={point:function(d,h){u=[d,h]}};function c(d){var h=d[0],g=d[1];return u=null,i.point(h,g),u||(o.point(h,g),u)||(a.point(h,g),u)}c.invert=function(d){var h=n.scale(),g=n.translate(),p=(d[0]-g[0])/h,m=(d[1]-g[1])/h;return(m>=.12&&m<.234&&p>=-.425&&p<-.214?r:m>=.166&&m<.234&&p>=-.214&&p<-.115?s:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=Wq([n.stream(t=d),r.stream(d),s.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),s.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),s.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),g=+d[0],p=+d[1];return i=n.translate(d).clipExtent([[g-.455*h,p-.238*h],[g+.455*h,p+.238*h]]).stream(l),o=r.translate([g-.307*h,p+.201*h]).clipExtent([[g-.425*h+ie,p+.12*h+ie],[g-.214*h-ie,p+.234*h-ie]]).stream(l),a=s.translate([g-.205*h,p+.212*h]).clipExtent([[g-.214*h+ie,p+.166*h+ie],[g-.115*h-ie,p+.234*h-ie]]).stream(l),f()},c.fitExtent=function(d,h){return yp(c,d,h)},c.fitSize=function(d,h){return Lv(c,d,h)},c.fitWidth=function(d,h){return Iv(c,d,h)},c.fitHeight=function(d,h){return Bv(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function UT(e){return function(t,n){var i=re(t),r=re(n),o=e(i*r);return o===1/0?[2,0]:[o*r*te(t),o*te(n)]}}function ff(e){return function(t,n){var i=tn(t*t+n*n),r=e(i),o=te(r),s=re(r);return[Xn(t*o,i*s),vn(i&&n*o/i)]}}var qT=UT(function(e){return tn(2/(1+e))});qT.invert=ff(function(e){return 2*vn(e/2)});function Gq(){return lr(qT).scale(124.75).clipAngle(180-.001)}var WT=UT(function(e){return(e=dT(e))&&e/te(e)});WT.invert=ff(function(e){return e});function Yq(){return lr(WT).scale(79.4188).clipAngle(180-.001)}function bp(e,t){return[e,Sh(Rv((We+t)/2))]}bp.invert=function(e,t){return[e,2*Wu(fT(t))-We]};function Vq(){return HT(bp).scale(961/en)}function HT(e){var t=lr(e),n=t.center,i=t.scale,r=t.translate,o=t.clipExtent,s=null,a,u,l;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?s=a=u=l=null:(s=+f[0][0],a=+f[0][1],u=+f[1][0],l=+f[1][1]),c()):s==null?null:[[s,a],[u,l]]};function c(){var f=he*i(),d=t(hq(t.rotate()).invert([0,0]));return o(s==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===bp?[[Math.max(d[0]-f,s),a],[Math.min(d[0]+f,u),l]]:[[s,Math.max(d[1]-f,a)],[u,Math.min(d[1]+f,l)]])}return c()}function Zf(e){return Rv((We+e)/2)}function Xq(e,t){var n=re(e),i=e===t?te(e):Sh(n/re(t))/Sh(Zf(t)/Zf(e)),r=n*Jm(Zf(e),i)/i;if(!i)return bp;function o(s,a){r>0?a<-We+ie&&(a=-We+ie):a>We-ie&&(a=We-ie);var u=r/Jm(Zf(a),i);return[u*te(i*s),r-u*re(i*s)]}return o.invert=function(s,a){var u=r-a,l=jn(i)*tn(s*s+u*u),c=Xn(s,me(u))*jn(u);return u*i<0&&(c-=he*jn(s)*jn(u)),[c/i,2*Wu(Jm(r/l,1/i))-We]},o}function Kq(){return jv(Xq).scale(109.5).parallels([30,30])}function Wh(e,t){return[e,t]}Wh.invert=Wh;function Jq(){return lr(Wh).scale(152.63)}function Qq(e,t){var n=re(e),i=e===t?te(e):(n-re(t))/(t-e),r=n/i+e;if(me(i)<ie)return Wh;function o(s,a){var u=r-a,l=i*s;return[u*te(l),r-u*re(l)]}return o.invert=function(s,a){var u=r-a,l=Xn(s,me(u))*jn(u);return u*i<0&&(l-=he*jn(s)*jn(u)),[l/i,r-jn(i)*tn(s*s+u*u)]},o}function Zq(){return jv(Qq).scale(131.154).center([0,13.9389])}var Ql=1.340264,Zl=-.081106,ec=893e-6,tc=.003796,Hh=tn(3)/2,eW=12;function GT(e,t){var n=vn(Hh*te(t)),i=n*n,r=i*i*i;return[e*re(n)/(Hh*(Ql+3*Zl*i+r*(7*ec+9*tc*i))),n*(Ql+Zl*i+r*(ec+tc*i))]}GT.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,o=0,s,a,u;o<eW&&(a=n*(Ql+Zl*i+r*(ec+tc*i))-t,u=Ql+3*Zl*i+r*(7*ec+9*tc*i),n-=s=a/u,i=n*n,r=i*i*i,!(me(s)<wh));++o);return[Hh*e*(Ql+3*Zl*i+r*(7*ec+9*tc*i))/re(n),vn(te(n)/Hh)]};function tW(){return lr(GT).scale(177.158)}function YT(e,t){var n=re(t),i=re(e)*n;return[n*te(e)/i,te(t)/i]}YT.invert=ff(Wu);function nW(){return lr(YT).scale(144.049).clipAngle(60)}function iW(){var e=1,t=0,n=0,i=1,r=1,o=0,s,a,u=null,l,c,f,d=1,h=1,g=mp({point:function(v,w){var S=x([v,w]);this.stream.point(S[0],S[1])}}),p=Sc,m,y;function b(){return d=e*i,h=e*r,m=y=null,x}function x(v){var w=v[0]*d,S=v[1]*h;if(o){var _=S*s-w*a;w=w*s+S*a,S=_}return[w+t,S+n]}return x.invert=function(v){var w=v[0]-t,S=v[1]-n;if(o){var _=S*s+w*a;w=w*s-S*a,S=_}return[w/d,S/h]},x.stream=function(v){return m&&y===v?m:m=g(p(y=v))},x.postclip=function(v){return arguments.length?(p=v,u=l=c=f=null,b()):p},x.clipExtent=function(v){return arguments.length?(p=v==null?(u=l=c=f=null,Sc):AT(u=+v[0][0],l=+v[0][1],c=+v[1][0],f=+v[1][1]),b()):u==null?null:[[u,l],[c,f]]},x.scale=function(v){return arguments.length?(e=+v,b()):e},x.translate=function(v){return arguments.length?(t=+v[0],n=+v[1],b()):[t,n]},x.angle=function(v){return arguments.length?(o=v%360*fe,a=te(o),s=re(o),b()):o*Ge},x.reflectX=function(v){return arguments.length?(i=v?-1:1,b()):i<0},x.reflectY=function(v){return arguments.length?(r=v?-1:1,b()):r<0},x.fitExtent=function(v,w){return yp(x,v,w)},x.fitSize=function(v,w){return Lv(x,v,w)},x.fitWidth=function(v,w){return Iv(x,v,w)},x.fitHeight=function(v,w){return Bv(x,v,w)},x}function VT(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}VT.invert=function(e,t){var n=t,i=25,r;do{var o=n*n,s=o*o;n-=r=(n*(1.007226+o*(.015085+s*(-.044475+.028874*o-.005916*s)))-t)/(1.007226+o*(.015085*3+s*(-.044475*7+.028874*9*o-.005916*11*s)))}while(me(r)>ie&&--i>0);return[e/(.8707+(o=n*n)*(-.131979+o*(-.013791+o*o*o*(.003971-.001529*o)))),n]};function rW(){return lr(VT).scale(175.295)}function XT(e,t){return[re(t)*te(e),te(t)]}XT.invert=ff(vn);function oW(){return lr(XT).scale(249.5).clipAngle(90+ie)}function KT(e,t){var n=re(t),i=1+re(e)*n;return[n*te(e)/i,te(t)/i]}KT.invert=ff(function(e){return 2*Wu(e)});function sW(){return lr(KT).scale(250).clipAngle(142)}function JT(e,t){return[Sh(Rv((We+t)/2)),-e]}JT.invert=function(e,t){return[-t,2*Wu(fT(e))-We]};function aW(){var e=HT(JT),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var uW=Math.abs,ey=Math.cos,Gh=Math.sin,lW=1e-6,QT=Math.PI,ty=QT/2,KE=cW(2);function JE(e){return e>1?ty:e<-1?-ty:Math.asin(e)}function cW(e){return e>0?Math.sqrt(e):0}function fW(e,t){var n=e*Gh(t),i=30,r;do t-=r=(t+Gh(t)-n)/(1+ey(t));while(uW(r)>lW&&--i>0);return t/2}function dW(e,t,n){function i(r,o){return[e*r*ey(o=fW(n,o)),t*Gh(o)]}return i.invert=function(r,o){return o=JE(o/t),[r/(e*ey(o)),JE((2*o+Gh(2*o))/n)]},i}var hW=dW(KE/ty,KE,QT);function gW(){return lr(hW).scale(169.529)}const pW=IT(),ny=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function mW(e,t){return function n(){const i=t();return i.type=e,i.path=IT().projection(i),i.copy=i.copy||function(){const r=n();return ny.forEach(o=>{i[o]&&r[o](i[o]())}),r.path.pointRadius(i.path.pointRadius()),r},v3(i)}}function Uv(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Yh[e]=mW(e,t),this):Yh[e]||null}function ZT(e){return e&&e.path||pW}const Yh={albers:jT,albersusa:Hq,azimuthalequalarea:Gq,azimuthalequidistant:Yq,conicconformal:Kq,conicequalarea:qh,conicequidistant:Zq,equalEarth:tW,equirectangular:Jq,gnomonic:nW,identity:iW,mercator:Vq,mollweide:gW,naturalEarth1:rW,orthographic:oW,stereographic:sW,transversemercator:aW};for(const e in Yh)Uv(e,Yh[e]);function yW(){}const br=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function eD(){var e=1,t=1,n=a;function i(u,l){return l.map(c=>r(u,c))}function r(u,l){var c=[],f=[];return o(u,l,d=>{n(d,u,l),bW(d)>0?c.push([d]):f.push(d)}),f.forEach(d=>{for(var h=0,g=c.length,p;h<g;++h)if(xW((p=c[h])[0],d)!==-1){p.push(d);return}}),{type:"MultiPolygon",value:l,coordinates:c}}function o(u,l,c){var f=new Array,d=new Array,h,g,p,m,y,b;for(h=g=-1,m=u[0]>=l,br[m<<1].forEach(x);++h<e-1;)p=m,m=u[h+1]>=l,br[p|m<<1].forEach(x);for(br[m<<0].forEach(x);++g<t-1;){for(h=-1,m=u[g*e+e]>=l,y=u[g*e]>=l,br[m<<1|y<<2].forEach(x);++h<e-1;)p=m,m=u[g*e+e+h+1]>=l,b=y,y=u[g*e+h+1]>=l,br[p|m<<1|y<<2|b<<3].forEach(x);br[m|y<<3].forEach(x)}for(h=-1,y=u[g*e]>=l,br[y<<2].forEach(x);++h<e-1;)b=y,y=u[g*e+h+1]>=l,br[y<<2|b<<3].forEach(x);br[y<<3].forEach(x);function x(v){var w=[v[0][0]+h,v[0][1]+g],S=[v[1][0]+h,v[1][1]+g],_=s(w),E=s(S),A,k;(A=d[_])?(k=f[E])?(delete d[A.end],delete f[k.start],A===k?(A.ring.push(S),c(A.ring)):f[A.start]=d[k.end]={start:A.start,end:k.end,ring:A.ring.concat(k.ring)}):(delete d[A.end],A.ring.push(S),d[A.end=E]=A):(A=f[E])?(k=d[_])?(delete f[A.start],delete d[k.end],A===k?(A.ring.push(S),c(A.ring)):f[k.start]=d[A.end]={start:k.start,end:A.end,ring:k.ring.concat(A.ring)}):(delete f[A.start],A.ring.unshift(w),f[A.start=_]=A):f[_]=d[E]={start:_,end:E,ring:[w,S]}}}function s(u){return u[0]*2+u[1]*(e+1)*4}function a(u,l,c){u.forEach(f=>{var d=f[0],h=f[1],g=d|0,p=h|0,m,y=l[p*e+g];d>0&&d<e&&g===d&&(m=l[p*e+g-1],f[0]=d+(c-m)/(y-m)-.5),h>0&&h<t&&p===h&&(m=l[(p-1)*e+g],f[1]=h+(c-m)/(y-m)-.5)})}return i.contour=r,i.size=function(u){if(!arguments.length)return[e,t];var l=Math.floor(u[0]),c=Math.floor(u[1]);return l>=0&&c>=0||R("invalid size"),e=l,t=c,i},i.smooth=function(u){return arguments.length?(n=u?a:yW,i):n===a},i}function bW(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function xW(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=vW(e,t[n]))return r;return 0}function vW(e,t){for(var n=t[0],i=t[1],r=-1,o=0,s=e.length,a=s-1;o<s;a=o++){var u=e[o],l=u[0],c=u[1],f=e[a],d=f[0],h=f[1];if(wW(u,f,t))return 0;c>i!=h>i&&n<(d-l)*(i-c)/(h-c)+l&&(r=-r)}return r}function wW(e,t,n){var i;return _W(e,t,n)&&SW(e[i=+(e[0]===t[0])],n[i],t[i])}function _W(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function SW(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function tD(e,t,n){return function(i){var r=Ki(i),o=n?Math.min(r[0],0):r[0],s=r[1],a=s-o,u=t?Ao(o,s,e):a/(e+1);return Tn(o+u,s,u)}}function qv(e){T.call(this,null,e)}qv.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};U(qv,T,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||It,o=eD().smooth(e.smooth!==!1),s=e.thresholds||EW(i,r,e),a=e.as===null?null:e.as||"contour",u=[];return i.forEach(l=>{const c=r(l),f=o.size([c.width,c.height])(c.values,z(s)?s:s(c.values));kW(f,c,l,e),f.forEach(d=>{u.push(Rg(l,Se(a!=null?{[a]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function EW(e,t,n){const i=tD(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>Cs(t(r).values)))}function kW(e,t,n,i){let r=i.scale||t.scale,o=i.translate||t.translate;if(ue(r)&&(r=r(n,i)),ue(o)&&(o=o(n,i)),(r===1||r==null)&&!o)return;const s=(Ae(r)?r:r[0])||1,a=(Ae(r)?r:r[1])||1,u=o&&o[0]||0,l=o&&o[1]||0;e.forEach(nD(t,s,a,u,l))}function nD(e,t,n,i,r){const o=e.x1||0,s=e.y1||0,a=t*n<0;function u(f){f.forEach(l)}function l(f){a&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-o)*t+i,f[1]=(f[1]-s)*n+r}return function(f){return f.coordinates.forEach(u),f}}function QE(e,t,n){const i=e>=0?e:Fb(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function n0(e){return ue(e)?e:Bt(+e)}function iD(){var e=u=>u[0],t=u=>u[1],n=Ou,i=[-1,-1],r=960,o=500,s=2;function a(u,l){const c=QE(i[0],u,e)>>s,f=QE(i[1],u,t)>>s,d=c?c+2:0,h=f?f+2:0,g=2*d+(r>>s),p=2*h+(o>>s),m=new Float32Array(g*p),y=new Float32Array(g*p);let b=m;u.forEach(v=>{const w=d+(+e(v)>>s),S=h+(+t(v)>>s);w>=0&&w<g&&S>=0&&S<p&&(m[w+S*g]+=+n(v))}),c>0&&f>0?(ka(g,p,m,y,c),$a(g,p,y,m,f),ka(g,p,m,y,c),$a(g,p,y,m,f),ka(g,p,m,y,c),$a(g,p,y,m,f)):c>0?(ka(g,p,m,y,c),ka(g,p,y,m,c),ka(g,p,m,y,c),b=y):f>0&&($a(g,p,m,y,f),$a(g,p,y,m,f),$a(g,p,m,y,f),b=y);const x=l?Math.pow(2,-2*s):1/SC(b);for(let v=0,w=g*p;v<w;++v)b[v]*=x;return{values:b,scale:1<<s,width:g,height:p,x1:d,y1:h,x2:d+(r>>s),y2:h+(o>>s)}}return a.x=function(u){return arguments.length?(e=n0(u),a):e},a.y=function(u){return arguments.length?(t=n0(u),a):t},a.weight=function(u){return arguments.length?(n=n0(u),a):n},a.size=function(u){if(!arguments.length)return[r,o];var l=+u[0],c=+u[1];return l>=0&&c>=0||R("invalid size"),r=l,o=c,a},a.cellSize=function(u){return arguments.length?((u=+u)>=1||R("invalid cell size"),s=Math.floor(Math.log(u)/Math.LN2),a):1<<s},a.bandwidth=function(u){return arguments.length?(u=H(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&R("invalid bandwidth"),i=u,a):i},a}function ka(e,t,n,i,r){const o=(r<<1)+1;for(let s=0;s<t;++s)for(let a=0,u=0;a<e+r;++a)a<e&&(u+=n[a+s*e]),a>=r&&(a>=o&&(u-=n[a-o+s*e]),i[a-r+s*e]=u/Math.min(a+1,e-1+o-a,o))}function $a(e,t,n,i,r){const o=(r<<1)+1;for(let s=0;s<e;++s)for(let a=0,u=0;a<t+r;++a)a<t&&(u+=n[s+a*e]),a>=r&&(a>=o&&(u-=n[s+(a-o)*e]),i[s+(a-r)*e]=u/Math.min(a+1,t-1+o-a,o))}function Wv(e){T.call(this,null,e)}Wv.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const $W=["x","y","weight","size","cellSize","bandwidth"];function rD(e,t){return $W.forEach(n=>t[n]!=null?e[n](t[n]):0),e}U(Wv,T,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=AW(i,e.groupby),o=(e.groupby||[]).map(He),s=rD(iD(),e),a=e.as||"grid",u=[];function l(c,f){for(let d=0;d<o.length;++d)c[o[d]]=f[d];return c}return u=r.map(c=>Se(l({[a]:s(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function AW(e,t){var n=[],i=c=>c(a),r,o,s,a,u,l;if(t==null)n.push(e);else for(r={},o=0,s=e.length;o<s;++o)a=e[o],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function Hv(e){T.call(this,null,e)}Hv.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};U(Hv,T,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=eD().smooth(e.smooth!==!1),r=e.values,o=e.thresholds||tD(e.count||10,e.nice,!!r),s=e.size,a,u;return r||(r=t.materialize(t.SOURCE).source,a=rD(iD(),e)(r,!0),u=nD(a,a.scale||1,a.scale||1,0,0),s=[a.width,a.height],r=a.values),o=z(o)?o:o(r),r=i.size(s)(r,o),u&&r.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(Se),n}});const iy="Feature",Gv="FeatureCollection",CW="MultiPoint";function Yv(e){T.call(this,null,e)}Yv.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};U(Yv,T,{transform(e,t){var n=this._features,i=this._points,r=e.fields,o=r&&r[0],s=r&&r[1],a=e.geojson||!r&&It,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(Rt(a))||o&&t.modified(Rt(o))||s&&t.modified(Rt(s)),(!this.value||l)&&(u=t.SOURCE,this._features=n=[],this._points=i=[]),a&&t.visit(u,c=>n.push(a(c))),o&&s&&(t.visit(u,c=>{var f=o(c),d=s(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:iy,geometry:{type:CW,coordinates:i}})),this.value={type:Gv,features:n}}});function Vv(e){T.call(this,null,e)}Vv.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};U(Vv,T,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||It,o=e.as||"path",s=n.SOURCE;!i||e.modified()?(this.value=i=ZT(e.projection),n.materialize().reflow()):s=r===It||t.modified(r.fields)?n.ADD_MOD:n.ADD;const a=MW(i,e.pointRadius);return n.visit(s,u=>u[o]=i(r(u))),i.pointRadius(a),n.modifies(o)}});function MW(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function Xv(e){T.call(this,null,e)}Xv.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};U(Xv,T,{transform(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],o=e.as||["x","y"],s=o[0],a=o[1],u;function l(c){const f=n([i(c),r(c)]);f?(c[s]=f[0],c[a]=f[1]):(c[s]=void 0,c[a]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(u=t.modified(i.fields)||t.modified(r.fields),t.visit(u?t.ADD_MOD:t.ADD,l)),t.modifies(o)}});function Kv(e){T.call(this,null,e)}Kv.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};U(Kv,T,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",o=n.ADD;return(!i||e.modified())&&(this.value=i=FW(ZT(e.projection),e.field||yn("datum"),e.pointRadius),n.materialize().reflow(),o=n.SOURCE),n.visit(o,s=>s[r]=i),n.modifies(r)}});function FW(e,t,n){const i=n==null?r=>e(t(r)):r=>{var o=e.pointRadius(),s=e.pointRadius(n)(t(r));return e.pointRadius(o),s};return i.context=r=>(e.context(r),i),i}function Jv(e){T.call(this,[],e),this.generator=Sq()}Jv.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};U(Jv,T,{transform(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(const o in e)ue(i[o])&&i[o](e[o]);return r=i(),n.length?t.mod.push(yM(n[0],r)):t.add.push(Se(r)),n[0]=r,t}});function Qv(e){T.call(this,null,e)}Qv.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};U(Qv,T,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||It,o=DW(e.opacity,e),s=TW(e.color,e),a=e.as||"image",u={$x:0,$y:0,$value:0,$max:i?Cs(n.map(l=>Cs(r(l).values))):0};return n.forEach(l=>{const c=r(l),f=ae({},l,u);i||(f.$max=Cs(c.values||[])),l[a]=NW(c,f,s.dep?s:Bt(s(f)),o.dep?o:Bt(o(f)))}),t.reflow(!0).modifies(a)}});function TW(e,t){let n;return ue(e)?(n=i=>Fo(e(i,t)),n.dep=oD(e)):n=Bt(Fo(e||"#888")),n}function DW(e,t){let n;return ue(e)?(n=i=>e(i,t),n.dep=oD(e)):e?n=Bt(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function oD(e){if(!ue(e))return!1;const t=vi(Rt(e));return t.$x||t.$y||t.$value||t.$max}function NW(e,t,n,i){const r=e.width,o=e.height,s=e.x1||0,a=e.y1||0,u=e.x2||r,l=e.y2||o,c=e.values,f=c?m=>c[m]:lo,d=Eo(u-s,l-a),h=d.getContext("2d"),g=h.getImageData(0,0,u-s,l-a),p=g.data;for(let m=a,y=0;m<l;++m){t.$y=m-a;for(let b=s,x=m*r;b<u;++b,y+=4){t.$x=b-s,t.$value=f(b+x);const v=n(t);p[y+0]=v.r,p[y+1]=v.g,p[y+2]=v.b,p[y+3]=~~(255*i(t))}}return h.putImageData(g,0,0),d}function sD(e){T.call(this,null,e),this.modified(!0)}U(sD,T,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=RW(e.type),ny.forEach(i=>{e[i]!=null&&ZE(n,i,e[i])})):ny.forEach(i=>{e.modified(i)&&ZE(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&OW(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function OW(e,t){const n=zW(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function RW(e){const t=Uv((e||"mercator").toLowerCase());return t||R("Unrecognized projection type: "+e),t()}function ZE(e,t,n){ue(e[t])&&e[t](n)}function zW(e){return e=H(e),e.length===1?e[0]:{type:Gv,features:e.reduce((t,n)=>t.concat(PW(n)),[])}}function PW(e){return e.type===Gv?e.features:H(e).filter(t=>t!=null).map(t=>t.type===iy?t:{type:iy,geometry:t})}const LW=Object.freeze(Object.defineProperty({__proto__:null,contour:Hv,geojson:Yv,geopath:Vv,geopoint:Xv,geoshape:Kv,graticule:Jv,heatmap:Qv,isocontour:qv,kde2d:Wv,projection:sD},Symbol.toStringTag,{value:"Module"}));function IW(e,t){var n,i=1;e==null&&(e=0),t==null&&(t=0);function r(){var o,s=n.length,a,u=0,l=0;for(o=0;o<s;++o)a=n[o],u+=a.x,l+=a.y;for(u=(u/s-e)*i,l=(l/s-t)*i,o=0;o<s;++o)a=n[o],a.x-=u,a.y-=l}return r.initialize=function(o){n=o},r.x=function(o){return arguments.length?(e=+o,r):e},r.y=function(o){return arguments.length?(t=+o,r):t},r.strength=function(o){return arguments.length?(i=+o,r):i},r}function BW(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return aD(this.cover(t,n),t,n,e)}function aD(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,o=e._root,s={data:i},a=e._x0,u=e._y0,l=e._x1,c=e._y1,f,d,h,g,p,m,y,b;if(!o)return e._root=s,e;for(;o.length;)if((p=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(d=(u+c)/2))?u=d:c=d,r=o,!(o=o[y=m<<1|p]))return r[y]=s,e;if(h=+e._x.call(null,o.data),g=+e._y.call(null,o.data),t===h&&n===g)return s.next=o,r?r[y]=s:e._root=s,e;do r=r?r[y]=new Array(4):e._root=new Array(4),(p=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(d=(u+c)/2))?u=d:c=d;while((y=m<<1|p)===(b=(g>=d)<<1|h>=f));return r[b]=o,r[y]=s,e}function jW(e){var t,n,i=e.length,r,o,s=new Array(i),a=new Array(i),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(o=+this._y.call(null,t))||(s[n]=r,a[n]=o,r<u&&(u=r),r>c&&(c=r),o<l&&(l=o),o>f&&(f=o));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<i;++n)aD(this,s[n],a[n],e[n]);return this}function UW(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,o=(i=Math.floor(t))+1;else{for(var s=r-n||1,a=this._root,u,l;n>e||e>=r||i>t||t>=o;)switch(l=(t<i)<<1|e<n,u=new Array(4),u[l]=a,a=u,s*=2,l){case 0:r=n+s,o=i+s;break;case 1:n=r-s,o=i+s;break;case 2:r=n+s,i=o-s;break;case 3:n=r-s,i=o-s;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this}function qW(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function WW(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Kt(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function HW(e,t,n){var i,r=this._x0,o=this._y0,s,a,u,l,c=this._x1,f=this._y1,d=[],h=this._root,g,p;for(h&&d.push(new Kt(h,r,o,c,f)),n==null?n=1/0:(r=e-n,o=t-n,c=e+n,f=t+n,n*=n);g=d.pop();)if(!(!(h=g.node)||(s=g.x0)>c||(a=g.y0)>f||(u=g.x1)<r||(l=g.y1)<o))if(h.length){var m=(s+u)/2,y=(a+l)/2;d.push(new Kt(h[3],m,y,u,l),new Kt(h[2],s,y,m,l),new Kt(h[1],m,a,u,y),new Kt(h[0],s,a,m,y)),(p=(t>=y)<<1|e>=m)&&(g=d[d.length-1],d[d.length-1]=d[d.length-1-p],d[d.length-1-p]=g)}else{var b=e-+this._x.call(null,h.data),x=t-+this._y.call(null,h.data),v=b*b+x*x;if(v<n){var w=Math.sqrt(n=v);r=e-w,o=t-w,c=e+w,f=t+w,i=h.data}}return i}function GW(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,o,s=this._x0,a=this._y0,u=this._x1,l=this._y1,c,f,d,h,g,p,m,y;if(!n)return this;if(n.length)for(;;){if((g=c>=(d=(s+u)/2))?s=d:u=d,(p=f>=(h=(a+l)/2))?a=h:l=h,t=n,!(n=n[m=p<<1|g]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,y=m)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(o=n.next)&&delete n.next,r?(o?r.next=o:delete r.next,this):t?(o?t[m]=o:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[y]=n:this._root=n),this):(this._root=o,this)}function YW(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function VW(){return this._root}function XW(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function KW(e){var t=[],n,i=this._root,r,o,s,a,u;for(i&&t.push(new Kt(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,o=n.x0,s=n.y0,a=n.x1,u=n.y1)&&i.length){var l=(o+a)/2,c=(s+u)/2;(r=i[3])&&t.push(new Kt(r,l,c,a,u)),(r=i[2])&&t.push(new Kt(r,o,c,l,u)),(r=i[1])&&t.push(new Kt(r,l,s,a,c)),(r=i[0])&&t.push(new Kt(r,o,s,l,c))}return this}function JW(e){var t=[],n=[],i;for(this._root&&t.push(new Kt(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var o,s=i.x0,a=i.y0,u=i.x1,l=i.y1,c=(s+u)/2,f=(a+l)/2;(o=r[0])&&t.push(new Kt(o,s,a,c,f)),(o=r[1])&&t.push(new Kt(o,c,a,u,f)),(o=r[2])&&t.push(new Kt(o,s,f,c,l)),(o=r[3])&&t.push(new Kt(o,c,f,u,l))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function QW(e){return e[0]}function ZW(e){return arguments.length?(this._x=e,this):this._x}function eH(e){return e[1]}function tH(e){return arguments.length?(this._y=e,this):this._y}function Zv(e,t,n){var i=new e2(t??QW,n??eH,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function e2(e,t,n,i,r,o){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function ek(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var rn=Zv.prototype=e2.prototype;rn.copy=function(){var e=new e2(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=ek(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=ek(i));return e};rn.add=BW;rn.addAll=jW;rn.cover=UW;rn.data=qW;rn.extent=WW;rn.find=HW;rn.remove=GW;rn.removeAll=YW;rn.root=VW;rn.size=XW;rn.visit=KW;rn.visitAfter=JW;rn.x=ZW;rn.y=tH;function Jt(e){return function(){return e}}function bo(e){return(e()-.5)*1e-6}function nH(e){return e.x+e.vx}function iH(e){return e.y+e.vy}function rH(e){var t,n,i,r=1,o=1;typeof e!="function"&&(e=Jt(e==null?1:+e));function s(){for(var l,c=t.length,f,d,h,g,p,m,y=0;y<o;++y)for(f=Zv(t,nH,iH).visitAfter(a),l=0;l<c;++l)d=t[l],p=n[d.index],m=p*p,h=d.x+d.vx,g=d.y+d.vy,f.visit(b);function b(x,v,w,S,_){var E=x.data,A=x.r,k=p+A;if(E){if(E.index>d.index){var $=h-E.x-E.vx,D=g-E.y-E.vy,M=$*$+D*D;M<k*k&&($===0&&($=bo(i),M+=$*$),D===0&&(D=bo(i),M+=D*D),M=(k-(M=Math.sqrt(M)))/M*r,d.vx+=($*=M)*(k=(A*=A)/(m+A)),d.vy+=(D*=M)*k,E.vx-=$*(k=1-k),E.vy-=D*k)}return}return v>h+k||S<h-k||w>g+k||_<g-k}}function a(l){if(l.data)return l.r=n[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function u(){if(t){var l,c=t.length,f;for(n=new Array(c),l=0;l<c;++l)f=t[l],n[f.index]=+e(f,l,t)}}return s.initialize=function(l,c){t=l,i=c,u()},s.iterations=function(l){return arguments.length?(o=+l,s):o},s.strength=function(l){return arguments.length?(r=+l,s):r},s.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Jt(+l),u(),s):e},s}function oH(e){return e.index}function tk(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function sH(e){var t=oH,n=f,i,r=Jt(30),o,s,a,u,l,c=1;e==null&&(e=[]);function f(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var y=0,b=e.length;y<c;++y)for(var x=0,v,w,S,_,E,A,k;x<b;++x)v=e[x],w=v.source,S=v.target,_=S.x+S.vx-w.x-w.vx||bo(l),E=S.y+S.vy-w.y-w.vy||bo(l),A=Math.sqrt(_*_+E*E),A=(A-o[x])/A*m*i[x],_*=A,E*=A,S.vx-=_*(k=u[x]),S.vy-=E*k,w.vx+=_*(k=1-k),w.vy+=E*k}function h(){if(s){var m,y=s.length,b=e.length,x=new Map(s.map((w,S)=>[t(w,S,s),w])),v;for(m=0,a=new Array(y);m<b;++m)v=e[m],v.index=m,typeof v.source!="object"&&(v.source=tk(x,v.source)),typeof v.target!="object"&&(v.target=tk(x,v.target)),a[v.source.index]=(a[v.source.index]||0)+1,a[v.target.index]=(a[v.target.index]||0)+1;for(m=0,u=new Array(b);m<b;++m)v=e[m],u[m]=a[v.source.index]/(a[v.source.index]+a[v.target.index]);i=new Array(b),g(),o=new Array(b),p()}}function g(){if(s)for(var m=0,y=e.length;m<y;++m)i[m]=+n(e[m],m,e)}function p(){if(s)for(var m=0,y=e.length;m<y;++m)o[m]=+r(e[m],m,e)}return d.initialize=function(m,y){s=m,l=y,h()},d.links=function(m){return arguments.length?(e=m,h(),d):e},d.id=function(m){return arguments.length?(t=m,d):t},d.iterations=function(m){return arguments.length?(c=+m,d):c},d.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Jt(+m),g(),d):n},d.distance=function(m){return arguments.length?(r=typeof m=="function"?m:Jt(+m),p(),d):r},d}var aH={value:()=>{}};function uD(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Md(n)}function Md(e){this._=e}function uH(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Md.prototype=uD.prototype={constructor:Md,on:function(e,t){var n=this._,i=uH(e+"",n),r,o=-1,s=i.length;if(arguments.length<2){for(;++o<s;)if((r=(e=i[o]).type)&&(r=lH(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(r=(e=i[o]).type)n[r]=nk(n[r],e.name,t);else if(t==null)for(r in n)n[r]=nk(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Md(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,o;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};function lH(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function nk(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=aH,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var yu=0,Bl=0,gl=0,lD=1e3,Vh,jl,Xh=0,Us=0,xp=0,kc=typeof performance=="object"&&performance.now?performance:Date,cD=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function t2(){return Us||(cD(cH),Us=kc.now()+xp)}function cH(){Us=0}function Kh(){this._call=this._time=this._next=null}Kh.prototype=fD.prototype={constructor:Kh,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?t2():+n)+(t==null?0:+t),!this._next&&jl!==this&&(jl?jl._next=this:Vh=this,jl=this),this._call=e,this._time=n,ry()},stop:function(){this._call&&(this._call=null,this._time=1/0,ry())}};function fD(e,t,n){var i=new Kh;return i.restart(e,t,n),i}function fH(){t2(),++yu;for(var e=Vh,t;e;)(t=Us-e._time)>=0&&e._call.call(void 0,t),e=e._next;--yu}function ik(){Us=(Xh=kc.now())+xp,yu=Bl=0;try{fH()}finally{yu=0,hH(),Us=0}}function dH(){var e=kc.now(),t=e-Xh;t>lD&&(xp-=t,Xh=e)}function hH(){for(var e,t=Vh,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Vh=n);jl=e,ry(i)}function ry(e){if(!yu){Bl&&(Bl=clearTimeout(Bl));var t=e-Us;t>24?(e<1/0&&(Bl=setTimeout(ik,e-kc.now()-xp)),gl&&(gl=clearInterval(gl))):(gl||(Xh=kc.now(),gl=setInterval(dH,lD)),yu=1,cD(ik))}}function gH(e,t,n){var i=new Kh,r=t;return t==null?(i.restart(e,t,n),i):(i._restart=i.restart,i.restart=function(o,s,a){s=+s,a=a==null?t2():+a,i._restart(function u(l){l+=r,i._restart(u,r+=s,a),o(l)},s,a)},i.restart(e,t,n),i)}const pH=1664525,mH=1013904223,rk=4294967296;function yH(){let e=1;return()=>(e=(pH*e+mH)%rk)/rk}function bH(e){return e.x}function xH(e){return e.y}var vH=10,wH=Math.PI*(3-Math.sqrt(5));function _H(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),o=0,s=.6,a=new Map,u=fD(f),l=uD("tick","end"),c=yH();e==null&&(e=[]);function f(){d(),l.call("tick",t),n<i&&(u.stop(),l.call("end",t))}function d(p){var m,y=e.length,b;p===void 0&&(p=1);for(var x=0;x<p;++x)for(n+=(o-n)*r,a.forEach(function(v){v(n)}),m=0;m<y;++m)b=e[m],b.fx==null?b.x+=b.vx*=s:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=s:(b.y=b.fy,b.vy=0);return t}function h(){for(var p=0,m=e.length,y;p<m;++p){if(y=e[p],y.index=p,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var b=vH*Math.sqrt(.5+p),x=p*wH;y.x=b*Math.cos(x),y.y=b*Math.sin(x)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function g(p){return p.initialize&&p.initialize(e,c),p}return h(),t={tick:d,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(p){return arguments.length?(e=p,h(),a.forEach(g),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(o=+p,t):o},velocityDecay:function(p){return arguments.length?(s=1-p,t):1-s},randomSource:function(p){return arguments.length?(c=p,a.forEach(g),t):c},force:function(p,m){return arguments.length>1?(m==null?a.delete(p):a.set(p,g(m)),t):a.get(p)},find:function(p,m,y){var b=0,x=e.length,v,w,S,_,E;for(y==null?y=1/0:y*=y,b=0;b<x;++b)_=e[b],v=p-_.x,w=m-_.y,S=v*v+w*w,S<y&&(E=_,y=S);return E},on:function(p,m){return arguments.length>1?(l.on(p,m),t):l.on(p)}}}function SH(){var e,t,n,i,r=Jt(-30),o,s=1,a=1/0,u=.81;function l(h){var g,p=e.length,m=Zv(e,bH,xH).visitAfter(f);for(i=h,g=0;g<p;++g)t=e[g],m.visit(d)}function c(){if(e){var h,g=e.length,p;for(o=new Array(g),h=0;h<g;++h)p=e[h],o[p.index]=+r(p,h,e)}}function f(h){var g=0,p,m,y=0,b,x,v;if(h.length){for(b=x=v=0;v<4;++v)(p=h[v])&&(m=Math.abs(p.value))&&(g+=p.value,y+=m,b+=m*p.x,x+=m*p.y);h.x=b/y,h.y=x/y}else{p=h,p.x=p.data.x,p.y=p.data.y;do g+=o[p.data.index];while(p=p.next)}h.value=g}function d(h,g,p,m){if(!h.value)return!0;var y=h.x-t.x,b=h.y-t.y,x=m-g,v=y*y+b*b;if(x*x/u<v)return v<a&&(y===0&&(y=bo(n),v+=y*y),b===0&&(b=bo(n),v+=b*b),v<s&&(v=Math.sqrt(s*v)),t.vx+=y*h.value*i/v,t.vy+=b*h.value*i/v),!0;if(h.length||v>=a)return;(h.data!==t||h.next)&&(y===0&&(y=bo(n),v+=y*y),b===0&&(b=bo(n),v+=b*b),v<s&&(v=Math.sqrt(s*v)));do h.data!==t&&(x=o[h.data.index]*i/v,t.vx+=y*x,t.vy+=b*x);while(h=h.next)}return l.initialize=function(h,g){e=h,n=g,c()},l.strength=function(h){return arguments.length?(r=typeof h=="function"?h:Jt(+h),c(),l):r},l.distanceMin=function(h){return arguments.length?(s=h*h,l):Math.sqrt(s)},l.distanceMax=function(h){return arguments.length?(a=h*h,l):Math.sqrt(a)},l.theta=function(h){return arguments.length?(u=h*h,l):Math.sqrt(u)},l}function EH(e){var t=Jt(.1),n,i,r;typeof e!="function"&&(e=Jt(e==null?0:+e));function o(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vx+=(r[u]-c.x)*i[u]*a}function s(){if(n){var a,u=n.length;for(i=new Array(u),r=new Array(u),a=0;a<u;++a)i[a]=isNaN(r[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return o.initialize=function(a){n=a,s()},o.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Jt(+a),s(),o):t},o.x=function(a){return arguments.length?(e=typeof a=="function"?a:Jt(+a),s(),o):e},o}function kH(e){var t=Jt(.1),n,i,r;typeof e!="function"&&(e=Jt(e==null?0:+e));function o(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vy+=(r[u]-c.y)*i[u]*a}function s(){if(n){var a,u=n.length;for(i=new Array(u),r=new Array(u),a=0;a<u;++a)i[a]=isNaN(r[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return o.initialize=function(a){n=a,s()},o.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Jt(+a),s(),o):t},o.y=function(a){return arguments.length?(e=typeof a=="function"?a:Jt(+a),s(),o):e},o}const ok={center:IW,collide:rH,nbody:SH,link:sH,x:EH,y:kH},Ul="forces",oy=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],$H=["static","iterations"],dD=["x","y","vx","vy"];function n2(e){T.call(this,null,e)}n2.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:dD}]};U(n2,T,{transform(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(oy),o=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&hD(n,e,0,t)):(this.value=n=CH(t.source,e),n.on("tick",AH(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified($H)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/o)),e.static)for(n.stop();--o>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let a=this._argops,u=0,l=a.length,c;u<l;++u)if(c=a[u],!(c.name!==Ul||c.op._argval.force!=="link")){for(var i=c.op._argops,r=0,o=i.length,s;r<o;++r)if(i[r].name==="links"&&(s=i[r].op.source)){n.pulse(s,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(dD)}});function AH(e,t){return()=>e.touch(t).run()}function CH(e,t){const n=_H(e),i=n.stop,r=n.restart;let o=!1;return n.stopped=()=>o,n.restart=()=>(o=!1,r()),n.stop=()=>(o=!0,i()),hD(n,t,!0).on("end",()=>o=!0)}function hD(e,t,n,i){var r=H(t.forces),o,s,a,u;for(o=0,s=oy.length;o<s;++o)a=oy[o],a!==Ul&&t.modified(a)&&e[a](t[a]);for(o=0,s=r.length;o<s;++o)u=Ul+o,a=n||t.modified(Ul,o)?FH(r[o]):i&&MH(r[o],i)?e.force(u):null,a&&e.force(u,a);for(s=e.numForces||0;o<s;++o)e.force(Ul+o,null);return e.numForces=r.length,e}function MH(e,t){var n,i;for(n in e)if(ue(i=e[n])&&t.modified(Rt(i)))return 1;return 0}function FH(e){var t,n;ne(ok,e.force)||R("Unrecognized force: "+e.force),t=ok[e.force]();for(n in e)ue(t[n])&&TH(t[n],e[n],e);return t}function TH(e,t,n){e(ue(t)?i=>t(i,n):t)}const DH=Object.freeze(Object.defineProperty({__proto__:null,force:n2},Symbol.toStringTag,{value:"Module"}));function NH(e,t){return e.parent===t.parent?1:2}function OH(e){return e.reduce(RH,0)/e.length}function RH(e,t){return e+t.x}function zH(e){return 1+e.reduce(PH,0)}function PH(e,t){return Math.max(e,t.y)}function LH(e){for(var t;t=e.children;)e=t[0];return e}function IH(e){for(var t;t=e.children;)e=t[t.length-1];return e}function BH(){var e=NH,t=1,n=1,i=!1;function r(o){var s,a=0;o.eachAfter(function(d){var h=d.children;h?(d.x=OH(h),d.y=zH(h)):(d.x=s?a+=e(d,s):0,d.y=0,s=d)});var u=LH(o),l=IH(o),c=u.x-e(u,l)/2,f=l.x+e(l,u)/2;return o.eachAfter(i?function(d){d.x=(d.x-o.x)*t,d.y=(o.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(o.y?d.y/o.y:1))*n})}return r.separation=function(o){return arguments.length?(e=o,r):e},r.size=function(o){return arguments.length?(i=!1,t=+o[0],n=+o[1],r):i?null:[t,n]},r.nodeSize=function(o){return arguments.length?(i=!0,t=+o[0],n=+o[1],r):i?[t,n]:null},r}function jH(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function UH(){return this.eachAfter(jH)}function qH(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this}function WH(e,t){for(var n=this,i=[n],r,o,s=-1;n=i.pop();)if(e.call(t,n,++s,this),r=n.children)for(o=r.length-1;o>=0;--o)i.push(r[o]);return this}function HH(e,t){for(var n=this,i=[n],r=[],o,s,a,u=-1;n=i.pop();)if(r.push(n),o=n.children)for(s=0,a=o.length;s<a;++s)i.push(o[s]);for(;n=r.pop();)e.call(t,n,++u,this);return this}function GH(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i}function YH(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function VH(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function XH(e){for(var t=this,n=KH(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function KH(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function JH(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function QH(){return Array.from(this)}function ZH(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function eG(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*tG(){var e=this,t,n=[e],i,r,o;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,i=e.children)for(r=0,o=i.length;r<o;++r)n.push(i[r]);while(n.length)}function i2(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=rG)):t===void 0&&(t=iG);for(var n=new bu(e),i,r=[n],o,s,a,u;i=r.pop();)if((s=t(i.data))&&(u=(s=Array.from(s)).length))for(i.children=s,a=u-1;a>=0;--a)r.push(o=s[a]=new bu(s[a])),o.parent=i,o.depth=i.depth+1;return n.eachBefore(gD)}function nG(){return i2(this).eachBefore(oG)}function iG(e){return e.children}function rG(e){return Array.isArray(e)?e[1]:null}function oG(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function gD(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function bu(e){this.data=e,this.depth=this.height=0,this.parent=null}bu.prototype=i2.prototype={constructor:bu,count:UH,each:qH,eachAfter:HH,eachBefore:WH,find:GH,sum:YH,sort:VH,path:XH,ancestors:JH,descendants:QH,leaves:ZH,links:eG,copy:nG,[Symbol.iterator]:tG};function Fd(e){return e==null?null:pD(e)}function pD(e){if(typeof e!="function")throw new Error;return e}function _s(){return 0}function Na(e){return function(){return e}}const sG=1664525,aG=1013904223,sk=4294967296;function uG(){let e=1;return()=>(e=(sG*e+aG)%sk)/sk}function lG(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function cG(e,t){let n=e.length,i,r;for(;n;)r=t()*n--|0,i=e[n],e[n]=e[r],e[r]=i;return e}function fG(e,t){for(var n=0,i=(e=cG(Array.from(e),t)).length,r=[],o,s;n<i;)o=e[n],s&&mD(s,o)?++n:(s=hG(r=dG(r,o)),n=0);return s}function dG(e,t){var n,i;if(i0(t,e))return[t];for(n=0;n<e.length;++n)if(ed(t,e[n])&&i0(ql(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(ed(ql(e[n],e[i]),t)&&ed(ql(e[n],t),e[i])&&ed(ql(e[i],t),e[n])&&i0(yD(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error}function ed(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function mD(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function i0(e,t){for(var n=0;n<t.length;++n)if(!mD(e,t[n]))return!1;return!0}function hG(e){switch(e.length){case 1:return gG(e[0]);case 2:return ql(e[0],e[1]);case 3:return yD(e[0],e[1],e[2])}}function gG(e){return{x:e.x,y:e.y,r:e.r}}function ql(e,t){var n=e.x,i=e.y,r=e.r,o=t.x,s=t.y,a=t.r,u=o-n,l=s-i,c=a-r,f=Math.sqrt(u*u+l*l);return{x:(n+o+u/f*c)/2,y:(i+s+l/f*c)/2,r:(f+r+a)/2}}function yD(e,t,n){var i=e.x,r=e.y,o=e.r,s=t.x,a=t.y,u=t.r,l=n.x,c=n.y,f=n.r,d=i-s,h=i-l,g=r-a,p=r-c,m=u-o,y=f-o,b=i*i+r*r-o*o,x=b-s*s-a*a+u*u,v=b-l*l-c*c+f*f,w=h*g-d*p,S=(g*v-p*x)/(w*2)-i,_=(p*m-g*y)/w,E=(h*x-d*v)/(w*2)-r,A=(d*y-h*m)/w,k=_*_+A*A-1,$=2*(o+S*_+E*A),D=S*S+E*E-o*o,M=-(Math.abs(k)>1e-6?($+Math.sqrt($*$-4*k*D))/(2*k):D/$);return{x:i+S+_*M,y:r+E+A*M,r:M}}function ak(e,t,n){var i=e.x-t.x,r,o,s=e.y-t.y,a,u,l=i*i+s*s;l?(o=t.r+n.r,o*=o,u=e.r+n.r,u*=u,o>u?(r=(l+u-o)/(2*l),a=Math.sqrt(Math.max(0,u/l-r*r)),n.x=e.x-r*i-a*s,n.y=e.y-r*s+a*i):(r=(l+o-u)/(2*l),a=Math.sqrt(Math.max(0,o/l-r*r)),n.x=t.x+r*i-a*s,n.y=t.y+r*s+a*i)):(n.x=t.x+n.r,n.y=t.y)}function uk(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function lk(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,o=(t.y*n.r+n.y*t.r)/i;return r*r+o*o}function td(e){this._=e,this.next=null,this.previous=null}function pG(e,t){if(!(o=(e=lG(e)).length))return 0;var n,i,r,o,s,a,u,l,c,f,d;if(n=e[0],n.x=0,n.y=0,!(o>1))return n.r;if(i=e[1],n.x=-i.r,i.x=n.r,i.y=0,!(o>2))return n.r+i.r;ak(i,n,r=e[2]),n=new td(n),i=new td(i),r=new td(r),n.next=r.previous=i,i.next=n.previous=r,r.next=i.previous=n;e:for(u=3;u<o;++u){ak(n._,i._,r=e[u]),r=new td(r),l=i.next,c=n.previous,f=i._.r,d=n._.r;do if(f<=d){if(uk(l._,r._)){i=l,n.next=i,i.previous=n,--u;continue e}f+=l._.r,l=l.next}else{if(uk(c._,r._)){n=c,n.next=i,i.previous=n,--u;continue e}d+=c._.r,c=c.previous}while(l!==c.next);for(r.previous=n,r.next=i,n.next=i.previous=i=r,s=lk(n);(r=r.next)!==i;)(a=lk(r))<s&&(n=r,s=a);i=n.next}for(n=[i._],r=i;(r=r.next)!==i;)n.push(r._);for(r=fG(n,t),u=0;u<o;++u)n=e[u],n.x-=r.x,n.y-=r.y;return r.r}function mG(e){return Math.sqrt(e.value)}function yG(){var e=null,t=1,n=1,i=_s;function r(o){const s=uG();return o.x=t/2,o.y=n/2,e?o.eachBefore(ck(e)).eachAfter(r0(i,.5,s)).eachBefore(fk(1)):o.eachBefore(ck(mG)).eachAfter(r0(_s,1,s)).eachAfter(r0(i,o.r/Math.min(t,n),s)).eachBefore(fk(Math.min(t,n)/(2*o.r))),o}return r.radius=function(o){return arguments.length?(e=Fd(o),r):e},r.size=function(o){return arguments.length?(t=+o[0],n=+o[1],r):[t,n]},r.padding=function(o){return arguments.length?(i=typeof o=="function"?o:Na(+o),r):i},r}function ck(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function r0(e,t,n){return function(i){if(r=i.children){var r,o,s=r.length,a=e(i)*t||0,u;if(a)for(o=0;o<s;++o)r[o].r+=a;if(u=pG(r,n),a)for(o=0;o<s;++o)r[o].r-=a;i.r=u+a}}}function fk(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function bD(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function df(e,t,n,i,r){for(var o=e.children,s,a=-1,u=o.length,l=e.value&&(i-t)/e.value;++a<u;)s=o[a],s.y0=n,s.y1=r,s.x0=t,s.x1=t+=s.value*l}function bG(){var e=1,t=1,n=0,i=!1;function r(s){var a=s.height+1;return s.x0=s.y0=n,s.x1=e,s.y1=t/a,s.eachBefore(o(t,a)),i&&s.eachBefore(bD),s}function o(s,a){return function(u){u.children&&df(u,u.x0,s*(u.depth+1)/a,u.x1,s*(u.depth+2)/a);var l=u.x0,c=u.y0,f=u.x1-n,d=u.y1-n;f<l&&(l=f=(l+f)/2),d<c&&(c=d=(c+d)/2),u.x0=l,u.y0=c,u.x1=f,u.y1=d}}return r.round=function(s){return arguments.length?(i=!!s,r):i},r.size=function(s){return arguments.length?(e=+s[0],t=+s[1],r):[e,t]},r.padding=function(s){return arguments.length?(n=+s,r):n},r}var xG={depth:-1},dk={},o0={};function vG(e){return e.id}function wG(e){return e.parentId}function hk(){var e=vG,t=wG,n;function i(r){var o=Array.from(r),s=e,a=t,u,l,c,f,d,h,g,p,m=new Map;if(n!=null){const y=o.map((v,w)=>_G(n(v,w,r))),b=y.map(gk),x=new Set(y).add("");for(const v of b)x.has(v)||(x.add(v),y.push(v),b.push(gk(v)),o.push(o0));s=(v,w)=>y[w],a=(v,w)=>b[w]}for(c=0,u=o.length;c<u;++c)l=o[c],h=o[c]=new bu(l),(g=s(l,c,r))!=null&&(g+="")&&(p=h.id=g,m.set(p,m.has(p)?dk:h)),(g=a(l,c,r))!=null&&(g+="")&&(h.parent=g);for(c=0;c<u;++c)if(h=o[c],g=h.parent){if(d=m.get(g),!d)throw new Error("missing: "+g);if(d===dk)throw new Error("ambiguous: "+g);d.children?d.children.push(h):d.children=[h],h.parent=d}else{if(f)throw new Error("multiple roots");f=h}if(!f)throw new Error("no root");if(n!=null){for(;f.data===o0&&f.children.length===1;)f=f.children[0],--u;for(let y=o.length-1;y>=0&&(h=o[y],h.data===o0);--y)h.data=null}if(f.parent=xG,f.eachBefore(function(y){y.depth=y.parent.depth+1,--u}).eachBefore(gD),f.parent=null,u>0)throw new Error("cycle");return f}return i.id=function(r){return arguments.length?(e=Fd(r),i):e},i.parentId=function(r){return arguments.length?(t=Fd(r),i):t},i.path=function(r){return arguments.length?(n=Fd(r),i):n},i}function _G(e){e=`${e}`;let t=e.length;return sy(e,t-1)&&!sy(e,t-2)&&(e=e.slice(0,-1)),e[0]==="/"?e:`/${e}`}function gk(e){let t=e.length;if(t<2)return"";for(;--t>1&&!sy(e,t););return e.slice(0,t)}function sy(e,t){if(e[t]==="/"){let n=0;for(;t>0&&e[--t]==="\\";)++n;if(!(n&1))return!0}return!1}function SG(e,t){return e.parent===t.parent?1:2}function s0(e){var t=e.children;return t?t[0]:e.t}function a0(e){var t=e.children;return t?t[t.length-1]:e.t}function EG(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function kG(e){for(var t=0,n=0,i=e.children,r=i.length,o;--r>=0;)o=i[r],o.z+=t,o.m+=t,t+=o.s+(n+=o.c)}function $G(e,t,n){return e.a.parent===t.parent?e.a:n}function Td(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}Td.prototype=Object.create(bu.prototype);function AG(e){for(var t=new Td(e,0),n,i=[t],r,o,s,a;n=i.pop();)if(o=n._.children)for(n.children=new Array(a=o.length),s=a-1;s>=0;--s)i.push(r=n.children[s]=new Td(o[s],s)),r.parent=n;return(t.parent=new Td(null,0)).children=[t],t}function CG(){var e=SG,t=1,n=1,i=null;function r(l){var c=AG(l);if(c.eachAfter(o),c.parent.m=-c.z,c.eachBefore(s),i)l.eachBefore(u);else{var f=l,d=l,h=l;l.eachBefore(function(b){b.x<f.x&&(f=b),b.x>d.x&&(d=b),b.depth>h.depth&&(h=b)});var g=f===d?1:e(f,d)/2,p=g-f.x,m=t/(d.x+g+p),y=n/(h.depth||1);l.eachBefore(function(b){b.x=(b.x+p)*m,b.y=b.depth*y})}return l}function o(l){var c=l.children,f=l.parent.children,d=l.i?f[l.i-1]:null;if(c){kG(l);var h=(c[0].z+c[c.length-1].z)/2;d?(l.z=d.z+e(l._,d._),l.m=l.z-h):l.z=h}else d&&(l.z=d.z+e(l._,d._));l.parent.A=a(l,d,l.parent.A||f[0])}function s(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function a(l,c,f){if(c){for(var d=l,h=l,g=c,p=d.parent.children[0],m=d.m,y=h.m,b=g.m,x=p.m,v;g=a0(g),d=s0(d),g&&d;)p=s0(p),h=a0(h),h.a=l,v=g.z+b-d.z-m+e(g._,d._),v>0&&(EG($G(g,l,f),l,v),m+=v,y+=v),b+=g.m,m+=d.m,x+=p.m,y+=h.m;g&&!a0(h)&&(h.t=g,h.m+=b-y),d&&!s0(p)&&(p.t=d,p.m+=m-x,f=l)}return f}function u(l){l.x*=t,l.y=l.depth*n}return r.separation=function(l){return arguments.length?(e=l,r):e},r.size=function(l){return arguments.length?(i=!1,t=+l[0],n=+l[1],r):i?null:[t,n]},r.nodeSize=function(l){return arguments.length?(i=!0,t=+l[0],n=+l[1],r):i?[t,n]:null},r}function vp(e,t,n,i,r){for(var o=e.children,s,a=-1,u=o.length,l=e.value&&(r-n)/e.value;++a<u;)s=o[a],s.x0=t,s.x1=i,s.y0=n,s.y1=n+=s.value*l}var xD=(1+Math.sqrt(5))/2;function vD(e,t,n,i,r,o){for(var s=[],a=t.children,u,l,c=0,f=0,d=a.length,h,g,p=t.value,m,y,b,x,v,w,S;c<d;){h=r-n,g=o-i;do m=a[f++].value;while(!m&&f<d);for(y=b=m,w=Math.max(g/h,h/g)/(p*e),S=m*m*w,v=Math.max(b/S,S/y);f<d;++f){if(m+=l=a[f].value,l<y&&(y=l),l>b&&(b=l),S=m*m*w,x=Math.max(b/S,S/y),x>v){m-=l;break}v=x}s.push(u={value:m,dice:h<g,children:a.slice(c,f)}),u.dice?df(u,n,i,r,p?i+=g*m/p:o):vp(u,n,i,p?n+=h*m/p:r,o),p-=m,c=f}return s}const wD=function e(t){function n(i,r,o,s,a){vD(t,i,r,o,s,a)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(xD);function MG(){var e=wD,t=!1,n=1,i=1,r=[0],o=_s,s=_s,a=_s,u=_s,l=_s;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],t&&d.eachBefore(bD),d}function f(d){var h=r[d.depth],g=d.x0+h,p=d.y0+h,m=d.x1-h,y=d.y1-h;m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),d.x0=g,d.y0=p,d.x1=m,d.y1=y,d.children&&(h=r[d.depth+1]=o(d)/2,g+=l(d)-h,p+=s(d)-h,m-=a(d)-h,y-=u(d)-h,m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),e(d,g,p,m,y))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],i=+d[1],c):[n,i]},c.tile=function(d){return arguments.length?(e=pD(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(o=typeof d=="function"?d:Na(+d),c):o},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(s=typeof d=="function"?d:Na(+d),c):s},c.paddingRight=function(d){return arguments.length?(a=typeof d=="function"?d:Na(+d),c):a},c.paddingBottom=function(d){return arguments.length?(u=typeof d=="function"?d:Na(+d),c):u},c.paddingLeft=function(d){return arguments.length?(l=typeof d=="function"?d:Na(+d),c):l},c}function FG(e,t,n,i,r){var o=e.children,s,a=o.length,u,l=new Array(a+1);for(l[0]=u=s=0;s<a;++s)l[s+1]=u+=o[s].value;c(0,a,e.value,t,n,i,r);function c(f,d,h,g,p,m,y){if(f>=d-1){var b=o[f];b.x0=g,b.y0=p,b.x1=m,b.y1=y;return}for(var x=l[f],v=h/2+x,w=f+1,S=d-1;w<S;){var _=w+S>>>1;l[_]<v?w=_+1:S=_}v-l[w-1]<l[w]-v&&f+1<w&&--w;var E=l[w]-x,A=h-E;if(m-g>y-p){var k=h?(g*A+m*E)/h:m;c(f,w,E,g,p,k,y),c(w,d,A,k,p,m,y)}else{var $=h?(p*A+y*E)/h:y;c(f,w,E,g,p,m,$),c(w,d,A,g,$,m,y)}}}function TG(e,t,n,i,r){(e.depth&1?vp:df)(e,t,n,i,r)}const DG=function e(t){function n(i,r,o,s,a){if((u=i._squarify)&&u.ratio===t)for(var u,l,c,f,d=-1,h,g=u.length,p=i.value;++d<g;){for(l=u[d],c=l.children,f=l.value=0,h=c.length;f<h;++f)l.value+=c[f].value;l.dice?df(l,r,o,s,p?o+=(a-o)*l.value/p:a):vp(l,r,o,p?r+=(s-r)*l.value/p:s,a),p-=l.value}else i._squarify=u=vD(t,i,r,o,s,a),u.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(xD);function ay(e,t,n){const i={};return e.each(r=>{const o=r.data;n(o)&&(i[t(o)]=r)}),e.lookup=i,e}function r2(e){T.call(this,null,e)}r2.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const NG=e=>e.values;U(r2,T,{transform(e,t){t.source||R("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),o=this.value;return(!o||i||t.changed())&&(o&&o.each(s=>{s.children&&Og(s.data)&&r.rem.push(s.data)}),this.value=o=i2({values:H(e.keys).reduce((s,a)=>(s.key(a),s),OG()).entries(r.source)},NG),n&&o.each(s=>{s.children&&(s=Se(s.data),r.add.push(s),r.source.push(s))}),ay(o,ee,ee)),r.source.root=o,r}});function OG(){const e=[],t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)};function n(r,o){if(o>=e.length)return r;const s=r.length,a=e[o++],u={},l={};let c=-1,f,d,h;for(;++c<s;)f=a(d=r[c])+"",(h=u[f])?h.push(d):u[f]=[d];for(f in u)l[f]=n(u[f],o);return l}function i(r,o){if(++o>e.length)return r;const s=[];for(const a in r)s.push({key:a,values:i(r[a],o)});return s}return t}function Wr(e){T.call(this,null,e)}const RG=(e,t)=>e.parent===t.parent?1:2;U(Wr,T,{transform(e,t){(!t.source||!t.source.root)&&R(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),i=this.fields,r=t.source.root,o=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(sa(e.sort,s=>s.data)),zG(n,this.params,e),n.separation&&n.separation(e.separation!==!1?RG:Ou);try{this.value=n(r)}catch(s){R(s)}return r.each(s=>PG(s,i,o)),t.reflow(e.modified()).modifies(o).modifies("leaf")}});function zG(e,t,n){for(let i,r=0,o=t.length;r<o;++r)i=t[r],i in n&&e[i](n[i])}function PG(e,t,n){const i=e.data,r=t.length-1;for(let o=0;o<r;++o)i[n[o]]=e[t[o]];i[n[r]]=e.children?e.children.length:0}const uy=["x","y","r","depth","children"];function o2(e){Wr.call(this,e)}o2.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:uy.length,default:uy}]};U(o2,Wr,{layout:yG,params:["radius","size","padding"],fields:uy});const ly=["x0","y0","x1","y1","depth","children"];function s2(e){Wr.call(this,e)}s2.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:ly.length,default:ly}]};U(s2,Wr,{layout:bG,params:["size","round","padding"],fields:ly});function a2(e){T.call(this,null,e)}a2.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};U(a2,T,{transform(e,t){t.source||R("Stratify transform requires an upstream data source.");let n=this.value;const i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),o=!n||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),o&&(n=r.source.length?ay(hk().id(e.key).parentId(e.parentKey)(r.source),e.key,Gn):ay(hk()([{}]),e.key,e.key)),r.source.root=this.value=n,r}});const pk={tidy:CG,cluster:BH},cy=["x","y","depth","children"];function u2(e){Wr.call(this,e)}u2.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:cy.length,default:cy}]};U(u2,Wr,{layout(e){const t=e||"tidy";if(ne(pk,t))return pk[t]();R("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:cy});function l2(e){T.call(this,[],e)}l2.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};U(l2,T,{transform(e,t){const n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),o={};return i||R("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,s=>o[ee(s)]=1),i.each(s=>{const a=s.data,u=s.parent&&s.parent.data;u&&o[ee(a)]&&o[ee(u)]&&r.add.push(Se({source:u,target:a}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,s=>o[ee(s)]=1),n.forEach(s=>{(o[ee(s.source)]||o[ee(s.target)])&&r.mod.push(s)})),r}});const mk={binary:FG,dice:df,slice:vp,slicedice:TG,squarify:wD,resquarify:DG},fy=["x0","y0","x1","y1","depth","children"];function c2(e){Wr.call(this,e)}c2.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:fy.length,default:fy}]};U(c2,Wr,{layout(){const e=MG();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{ne(mk,t)?e.tile(mk[t]):R("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:fy});const LG=Object.freeze(Object.defineProperty({__proto__:null,nest:r2,pack:o2,partition:s2,stratify:a2,tree:u2,treelinks:l2,treemap:c2},Symbol.toStringTag,{value:"Module"})),u0=4278190080;function IG(e,t){const n=e.bitmap();return(t||[]).forEach(i=>n.set(e(i.boundary[0]),e(i.boundary[3]))),[n,void 0]}function BG(e,t,n,i,r){const o=e.width,s=e.height,a=i||r,u=Eo(o,s).getContext("2d"),l=Eo(o,s).getContext("2d"),c=a&&Eo(o,s).getContext("2d");n.forEach(E=>Dd(u,E,!1)),Dd(l,t,!1),a&&Dd(c,t,!0);const f=l0(u,o,s),d=l0(l,o,s),h=a&&l0(c,o,s),g=e.bitmap(),p=a&&e.bitmap();let m,y,b,x,v,w,S,_;for(y=0;y<s;++y)for(m=0;m<o;++m)v=y*o+m,w=f[v]&u0,_=d[v]&u0,S=a&&h[v]&u0,(w||S||_)&&(b=e(m),x=e(y),!r&&(w||_)&&g.set(b,x),a&&(w||S)&&p.set(b,x));return[g,p]}function l0(e,t,n){return new Uint32Array(e.getImageData(0,0,t,n).data.buffer)}function Dd(e,t,n){if(!t.length)return;const i=t[0].mark.marktype;i==="group"?t.forEach(r=>{r.items.forEach(o=>Dd(e,o.items,n))}):Rn[i].draw(e,{items:n?t.map(jG):t})}function jG(e){const t=Rg(e,{});return t.stroke&&t.strokeOpacity!==0||t.fill&&t.fillOpacity!==0?{...t,strokeOpacity:1,stroke:"#000",fillOpacity:0}:t}const xr=5,qt=31,$c=32,ao=new Uint32Array($c+1),si=new Uint32Array($c+1);si[0]=0;ao[0]=~si[0];for(let e=1;e<=$c;++e)si[e]=si[e-1]<<1|1,ao[e]=~si[e];function UG(e,t){const n=new Uint32Array(~~((e*t+$c)/$c));function i(o,s){n[o]|=s}function r(o,s){n[o]&=s}return{array:n,get:(o,s)=>{const a=s*e+o;return n[a>>>xr]&1<<(a&qt)},set:(o,s)=>{const a=s*e+o;i(a>>>xr,1<<(a&qt))},clear:(o,s)=>{const a=s*e+o;r(a>>>xr,~(1<<(a&qt)))},getRange:(o,s,a,u)=>{let l=u,c,f,d,h;for(;l>=s;--l)if(c=l*e+o,f=l*e+a,d=c>>>xr,h=f>>>xr,d===h){if(n[d]&ao[c&qt]&si[(f&qt)+1])return!0}else{if(n[d]&ao[c&qt]||n[h]&si[(f&qt)+1])return!0;for(let g=d+1;g<h;++g)if(n[g])return!0}return!1},setRange:(o,s,a,u)=>{let l,c,f,d,h;for(;s<=u;++s)if(l=s*e+o,c=s*e+a,f=l>>>xr,d=c>>>xr,f===d)i(f,ao[l&qt]&si[(c&qt)+1]);else for(i(f,ao[l&qt]),i(d,si[(c&qt)+1]),h=f+1;h<d;++h)i(h,4294967295)},clearRange:(o,s,a,u)=>{let l,c,f,d,h;for(;s<=u;++s)if(l=s*e+o,c=s*e+a,f=l>>>xr,d=c>>>xr,f===d)r(f,si[l&qt]|ao[(c&qt)+1]);else for(r(f,si[l&qt]),r(d,ao[(c&qt)+1]),h=f+1;h<d;++h)r(h,0)},outOfBounds:(o,s,a,u)=>o<0||s<0||u>=t||a>=e}}function qG(e,t,n){const i=Math.max(1,Math.sqrt(e*t/1e6)),r=~~((e+2*n+i)/i),o=~~((t+2*n+i)/i),s=a=>~~((a+n)/i);return s.invert=a=>a*i-n,s.bitmap=()=>UG(r,o),s.ratio=i,s.padding=n,s.width=e,s.height=t,s}function WG(e,t,n,i){const r=e.width,o=e.height;return function(s){const a=s.datum.datum.items[i].items,u=a.length,l=s.datum.fontSize,c=mi.width(s.datum,s.datum.text);let f=0,d,h,g,p,m,y,b;for(let x=0;x<u;++x)d=a[x].x,g=a[x].y,h=a[x].x2===void 0?d:a[x].x2,p=a[x].y2===void 0?g:a[x].y2,m=(d+h)/2,y=(g+p)/2,b=Math.abs(h-d+p-g),b>=f&&(f=b,s.x=m,s.y=y);return m=c/2,y=l/2,d=s.x-m,h=s.x+m,g=s.y-y,p=s.y+y,s.align="center",d<0&&h<=r?s.align="left":0<=d&&r<h&&(s.align="right"),s.baseline="middle",g<0&&p<=o?s.baseline="top":0<=g&&o<p&&(s.baseline="bottom"),!0}}function Jh(e,t,n,i,r,o){let s=n/2;return e-s<0||e+s>r||t-(s=i/2)<0||t+s>o}function xo(e,t,n,i,r,o,s,a){const u=r*o/(i*2),l=e(t-u),c=e(t+u),f=e(n-(o=o/2)),d=e(n+o);return s.outOfBounds(l,f,c,d)||s.getRange(l,f,c,d)||a&&a.getRange(l,f,c,d)}function HG(e,t,n,i){const r=e.width,o=e.height,s=t[0],a=t[1];function u(l,c,f,d,h){const g=e.invert(l),p=e.invert(c);let m=f,y=o,b;if(!Jh(g,p,d,h,r,o)&&!xo(e,g,p,h,d,m,s,a)&&!xo(e,g,p,h,d,h,s,null)){for(;y-m>=1;)b=(m+y)/2,xo(e,g,p,h,d,b,s,a)?y=b:m=b;if(m>f)return[g,p,m,!0]}}return function(l){const c=l.datum.datum.items[i].items,f=c.length,d=l.datum.fontSize,h=mi.width(l.datum,l.datum.text);let g=n?d:0,p=!1,m=!1,y=0,b,x,v,w,S,_,E,A,k,$,D,M,F,C,O,q,G;for(let K=0;K<f;++K){for(b=c[K].x,v=c[K].y,x=c[K].x2===void 0?b:c[K].x2,w=c[K].y2===void 0?v:c[K].y2,b>x&&(G=b,b=x,x=G),v>w&&(G=v,v=w,w=G),k=e(b),D=e(x),$=~~((k+D)/2),M=e(v),C=e(w),F=~~((M+C)/2),E=$;E>=k;--E)for(A=F;A>=M;--A)q=u(E,A,g,h,d),q&&([l.x,l.y,g,p]=q);for(E=$;E<=D;++E)for(A=F;A<=C;++A)q=u(E,A,g,h,d),q&&([l.x,l.y,g,p]=q);!p&&!n&&(O=Math.abs(x-b+w-v),S=(b+x)/2,_=(v+w)/2,O>=y&&!Jh(S,_,h,d,r,o)&&!xo(e,S,_,d,h,d,s,null)&&(y=O,l.x=S,l.y=_,m=!0))}return p||m?(S=h/2,_=d/2,s.setRange(e(l.x-S),e(l.y-_),e(l.x+S),e(l.y+_)),l.align="center",l.baseline="middle",!0):!1}}const GG=[-1,-1,1,1],YG=[-1,1,-1,1];function VG(e,t,n,i){const r=e.width,o=e.height,s=t[0],a=t[1],u=e.bitmap();return function(l){const c=l.datum.datum.items[i].items,f=c.length,d=l.datum.fontSize,h=mi.width(l.datum,l.datum.text),g=[];let p=n?d:0,m=!1,y=!1,b=0,x,v,w,S,_,E,A,k,$,D,M,F;for(let C=0;C<f;++C){for(x=c[C].x,w=c[C].y,v=c[C].x2===void 0?x:c[C].x2,S=c[C].y2===void 0?w:c[C].y2,g.push([e((x+v)/2),e((w+S)/2)]);g.length;)if([A,k]=g.pop(),!(s.get(A,k)||a.get(A,k)||u.get(A,k))){u.set(A,k);for(let O=0;O<4;++O)_=A+GG[O],E=k+YG[O],u.outOfBounds(_,E,_,E)||g.push([_,E]);if(_=e.invert(A),E=e.invert(k),$=p,D=o,!Jh(_,E,h,d,r,o)&&!xo(e,_,E,d,h,$,s,a)&&!xo(e,_,E,d,h,d,s,null)){for(;D-$>=1;)M=($+D)/2,xo(e,_,E,d,h,M,s,a)?D=M:$=M;$>p&&(l.x=_,l.y=E,p=$,m=!0)}}!m&&!n&&(F=Math.abs(v-x+S-w),_=(x+v)/2,E=(w+S)/2,F>=b&&!Jh(_,E,h,d,r,o)&&!xo(e,_,E,d,h,d,s,null)&&(b=F,l.x=_,l.y=E,y=!0))}return m||y?(_=h/2,E=d/2,s.setRange(e(l.x-_),e(l.y-E),e(l.x+_),e(l.y+E)),l.align="center",l.baseline="middle",!0):!1}}const XG=["right","center","left"],KG=["bottom","middle","top"];function JG(e,t,n,i){const r=e.width,o=e.height,s=t[0],a=t[1],u=i.length;return function(l){const c=l.boundary,f=l.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>r||c[3]>o)return!1;let d=l.textWidth??0,h,g,p,m,y,b,x,v,w,S,_,E,A,k,$;for(let D=0;D<u;++D){if(h=(n[D]&3)-1,g=(n[D]>>>2&3)-1,p=h===0&&g===0||i[D]<0,m=h&&g?Math.SQRT1_2:1,y=i[D]<0?-1:1,b=c[1+h]+i[D]*h*m,_=c[4+g]+y*f*g/2+i[D]*g*m,v=_-f/2,w=_+f/2,E=e(b),k=e(v),$=e(w),!d)if(yk(E,E,k,$,s,a,b,b,v,w,c,p))d=mi.width(l.datum,l.datum.text);else continue;if(S=b+y*d*h/2,b=S-d/2,x=S+d/2,E=e(b),A=e(x),yk(E,A,k,$,s,a,b,x,v,w,c,p))return l.x=h?h*y<0?x:b:S,l.y=g?g*y<0?w:v:_,l.align=XG[h*y+1],l.baseline=KG[g*y+1],s.setRange(E,k,A,$),!0}return!1}}function yk(e,t,n,i,r,o,s,a,u,l,c,f){return!(r.outOfBounds(e,n,t,i)||(f&&o||r).getRange(e,n,t,i))}const c0=0,f0=4,d0=8,h0=0,g0=1,p0=2,QG={"top-left":c0+h0,top:c0+g0,"top-right":c0+p0,left:f0+h0,middle:f0+g0,right:f0+p0,"bottom-left":d0+h0,bottom:d0+g0,"bottom-right":d0+p0},ZG={naive:WG,"reduced-search":HG,floodfill:VG};function eY(e,t,n,i,r,o,s,a,u,l,c){if(!e.length)return e;const f=Math.max(i.length,r.length),d=tY(i,f),h=nY(r,f),g=iY(e[0].datum),p=g==="group"&&e[0].datum.items[u].marktype,m=p==="area",y=rY(g,p,a,u),b=l===null||l===1/0,x=m&&c==="naive";let v=-1,w=-1;const S=e.map(k=>{const $=b?mi.width(k,k.text):void 0;return v=Math.max(v,$),w=Math.max(w,k.fontSize),{datum:k,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(k),textWidth:$}});l=l===null||l===1/0?Math.max(v,w)+Math.max(...i):l;const _=qG(t[0],t[1],l);let E;if(!x){n&&S.sort((D,M)=>n(D.datum,M.datum));let k=!1;for(let D=0;D<h.length&&!k;++D)k=h[D]===5||d[D]<0;const $=(g&&s||m)&&e.map(D=>D.datum);E=o.length||$?BG(_,$||[],o,k,m):IG(_,s&&S)}const A=m?ZG[c](_,E,s,u):JG(_,E,h,d);return S.forEach(k=>k.opacity=+A(k)),S}function tY(e,t){const n=new Float64Array(t),i=e.length;for(let r=0;r<i;++r)n[r]=e[r]||0;for(let r=i;r<t;++r)n[r]=n[i-1];return n}function nY(e,t){const n=new Int8Array(t),i=e.length;for(let r=0;r<i;++r)n[r]|=QG[e[r]];for(let r=i;r<t;++r)n[r]=n[i-1];return n}function iY(e){return e&&e.mark&&e.mark.marktype}function rY(e,t,n,i){const r=o=>[o.x,o.x,o.x,o.y,o.y,o.y];return e?e==="line"||e==="area"?o=>r(o.datum):t==="line"?o=>{const s=o.datum.items[i].items;return r(s.length?s[n==="start"?0:s.length-1]:{x:NaN,y:NaN})}:o=>{const s=o.datum.bounds;return[s.x1,(s.x1+s.x2)/2,s.x2,s.y1,(s.y1+s.y2)/2,s.y2]}:r}const dy=["x","y","opacity","align","baseline"],_D=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function f2(e){T.call(this,null,e)}f2.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:_D},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:dy.length,default:dy}]};U(f2,T,{transform(e,t){function n(o){const s=e[o];return ue(s)&&t.modified(s.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&R("Size parameter should be specified as a [width, height] array.");const r=e.as||dy;return eY(t.materialize(t.SOURCE).source||[],e.size,e.sort,H(e.offset==null?1:e.offset),H(e.anchor||_D),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding===void 0?0:e.padding,e.method||"naive").forEach(o=>{const s=o.datum;s[r[0]]=o.x,s[r[1]]=o.y,s[r[2]]=o.opacity,s[r[3]]=o.align,s[r[4]]=o.baseline}),t.reflow(i).modifies(r)}});const oY=Object.freeze(Object.defineProperty({__proto__:null,label:f2},Symbol.toStringTag,{value:"Module"}));function SD(e,t){var n=[],i=function(c){return c(a)},r,o,s,a,u,l;if(t==null)n.push(e);else for(r={},o=0,s=e.length;o<s;++o)a=e[o],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function d2(e){T.call(this,null,e)}d2.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};U(d2,T,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=SD(i,e.groupby),o=(e.groupby||[]).map(He),s=o.length,a=e.as||[He(e.x),He(e.y)],u=[];r.forEach(l=>{RM(l,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<s;++d)f[o[d]]=l.dims[d];f[a[0]]=c[0],f[a[1]]=c[1],u.push(Se(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const hy={constant:Ub,linear:qb,log:TM,exp:DM,pow:NM,quad:Wb,poly:OM},sY=(e,t)=>e==="poly"?t:e==="quad"?2:1;function h2(e){T.call(this,null,e)}h2.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(hy)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};U(h2,T,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=SD(i,e.groupby),o=(e.groupby||[]).map(He),s=e.method||"linear",a=e.order==null?3:e.order,u=sY(s,a),l=e.as||[He(e.x),He(e.y)],c=hy[s],f=[];let d=e.extent;ne(hy,s)||R("Invalid regression method: "+s),d!=null&&s==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach(h=>{if(h.length<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const p=c(h,e.x,e.y,a);if(e.params){f.push(Se({keys:h.dims,coef:p.coef,rSquared:p.rSquared}));return}const m=d||Ki(h,e.x),y=b=>{const x={};for(let v=0;v<o.length;++v)x[o[v]]=h.dims[v];x[l[0]]=b[0],x[l[1]]=b[1],f.push(Se(x))};s==="linear"||s==="constant"?m.forEach(b=>y([b,p.predict(b)])):Ug(p.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const aY=Object.freeze(Object.defineProperty({__proto__:null,loess:d2,regression:h2},Symbol.toStringTag,{value:"Module"})),Nr=11102230246251565e-32,At=134217729,uY=(3+8*Nr)*Nr;function m0(e,t,n,i,r){let o,s,a,u,l=t[0],c=i[0],f=0,d=0;c>l==c>-l?(o=l,l=t[++f]):(o=c,c=i[++d]);let h=0;if(f<e&&d<n)for(c>l==c>-l?(s=l+o,a=o-(s-l),l=t[++f]):(s=c+o,a=o-(s-c),c=i[++d]),o=s,a!==0&&(r[h++]=a);f<e&&d<n;)c>l==c>-l?(s=o+l,u=s-o,a=o-(s-u)+(l-u),l=t[++f]):(s=o+c,u=s-o,a=o-(s-u)+(c-u),c=i[++d]),o=s,a!==0&&(r[h++]=a);for(;f<e;)s=o+l,u=s-o,a=o-(s-u)+(l-u),l=t[++f],o=s,a!==0&&(r[h++]=a);for(;d<n;)s=o+c,u=s-o,a=o-(s-u)+(c-u),c=i[++d],o=s,a!==0&&(r[h++]=a);return(o!==0||h===0)&&(r[h++]=o),h}function lY(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}function hf(e){return new Float64Array(e)}const cY=(3+16*Nr)*Nr,fY=(2+12*Nr)*Nr,dY=(9+64*Nr)*Nr*Nr,Aa=hf(4),bk=hf(8),xk=hf(12),vk=hf(16),Wt=hf(4);function hY(e,t,n,i,r,o,s){let a,u,l,c,f,d,h,g,p,m,y,b,x,v,w,S,_,E;const A=e-r,k=n-r,$=t-o,D=i-o;v=A*D,d=At*A,h=d-(d-A),g=A-h,d=At*D,p=d-(d-D),m=D-p,w=g*m-(v-h*p-g*p-h*m),S=$*k,d=At*$,h=d-(d-$),g=$-h,d=At*k,p=d-(d-k),m=k-p,_=g*m-(S-h*p-g*p-h*m),y=w-_,f=w-y,Aa[0]=w-(y+f)+(f-_),b=v+y,f=b-v,x=v-(b-f)+(y-f),y=x-S,f=x-y,Aa[1]=x-(y+f)+(f-S),E=b+y,f=E-b,Aa[2]=b-(E-f)+(y-f),Aa[3]=E;let M=lY(4,Aa),F=fY*s;if(M>=F||-M>=F||(f=e-A,a=e-(A+f)+(f-r),f=n-k,l=n-(k+f)+(f-r),f=t-$,u=t-($+f)+(f-o),f=i-D,c=i-(D+f)+(f-o),a===0&&u===0&&l===0&&c===0)||(F=dY*s+uY*Math.abs(M),M+=A*c+D*a-($*l+k*u),M>=F||-M>=F))return M;v=a*D,d=At*a,h=d-(d-a),g=a-h,d=At*D,p=d-(d-D),m=D-p,w=g*m-(v-h*p-g*p-h*m),S=u*k,d=At*u,h=d-(d-u),g=u-h,d=At*k,p=d-(d-k),m=k-p,_=g*m-(S-h*p-g*p-h*m),y=w-_,f=w-y,Wt[0]=w-(y+f)+(f-_),b=v+y,f=b-v,x=v-(b-f)+(y-f),y=x-S,f=x-y,Wt[1]=x-(y+f)+(f-S),E=b+y,f=E-b,Wt[2]=b-(E-f)+(y-f),Wt[3]=E;const C=m0(4,Aa,4,Wt,bk);v=A*c,d=At*A,h=d-(d-A),g=A-h,d=At*c,p=d-(d-c),m=c-p,w=g*m-(v-h*p-g*p-h*m),S=$*l,d=At*$,h=d-(d-$),g=$-h,d=At*l,p=d-(d-l),m=l-p,_=g*m-(S-h*p-g*p-h*m),y=w-_,f=w-y,Wt[0]=w-(y+f)+(f-_),b=v+y,f=b-v,x=v-(b-f)+(y-f),y=x-S,f=x-y,Wt[1]=x-(y+f)+(f-S),E=b+y,f=E-b,Wt[2]=b-(E-f)+(y-f),Wt[3]=E;const O=m0(C,bk,4,Wt,xk);v=a*c,d=At*a,h=d-(d-a),g=a-h,d=At*c,p=d-(d-c),m=c-p,w=g*m-(v-h*p-g*p-h*m),S=u*l,d=At*u,h=d-(d-u),g=u-h,d=At*l,p=d-(d-l),m=l-p,_=g*m-(S-h*p-g*p-h*m),y=w-_,f=w-y,Wt[0]=w-(y+f)+(f-_),b=v+y,f=b-v,x=v-(b-f)+(y-f),y=x-S,f=x-y,Wt[1]=x-(y+f)+(f-S),E=b+y,f=E-b,Wt[2]=b-(E-f)+(y-f),Wt[3]=E;const q=m0(O,xk,4,Wt,vk);return vk[q-1]}function nd(e,t,n,i,r,o){const s=(t-o)*(n-r),a=(e-r)*(i-o),u=s-a,l=Math.abs(s+a);return Math.abs(u)>=cY*l?u:-hY(e,t,n,i,r,o,l)}const wk=Math.pow(2,-52),id=new Uint32Array(512);class Qh{static from(t,n=bY,i=xY){const r=t.length,o=new Float64Array(r*2);for(let s=0;s<r;s++){const a=t[s];o[2*s]=n(a),o[2*s+1]=i(a)}return new Qh(o)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:o}=this,s=t.length>>1;let a=1/0,u=1/0,l=-1/0,c=-1/0;for(let k=0;k<s;k++){const $=t[2*k],D=t[2*k+1];$<a&&(a=$),D<u&&(u=D),$>l&&(l=$),D>c&&(c=D),this._ids[k]=k}const f=(a+l)/2,d=(u+c)/2;let h=1/0,g,p,m;for(let k=0;k<s;k++){const $=y0(f,d,t[2*k],t[2*k+1]);$<h&&(g=k,h=$)}const y=t[2*g],b=t[2*g+1];h=1/0;for(let k=0;k<s;k++){if(k===g)continue;const $=y0(y,b,t[2*k],t[2*k+1]);$<h&&$>0&&(p=k,h=$)}let x=t[2*p],v=t[2*p+1],w=1/0;for(let k=0;k<s;k++){if(k===g||k===p)continue;const $=mY(y,b,x,v,t[2*k],t[2*k+1]);$<w&&(m=k,w=$)}let S=t[2*m],_=t[2*m+1];if(w===1/0){for(let D=0;D<s;D++)this._dists[D]=t[2*D]-t[0]||t[2*D+1]-t[1];Ba(this._ids,this._dists,0,s-1);const k=new Uint32Array(s);let $=0;for(let D=0,M=-1/0;D<s;D++){const F=this._ids[D];this._dists[F]>M&&(k[$++]=F,M=this._dists[F])}this.hull=k.subarray(0,$),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(nd(y,b,x,v,S,_)<0){const k=p,$=x,D=v;p=m,x=S,v=_,m=k,S=$,_=D}const E=yY(y,b,x,v,S,_);this._cx=E.x,this._cy=E.y;for(let k=0;k<s;k++)this._dists[k]=y0(t[2*k],t[2*k+1],E.x,E.y);Ba(this._ids,this._dists,0,s-1),this._hullStart=g;let A=3;i[g]=n[m]=p,i[p]=n[g]=m,i[m]=n[p]=g,r[g]=0,r[p]=1,r[m]=2,o.fill(-1),o[this._hashKey(y,b)]=g,o[this._hashKey(x,v)]=p,o[this._hashKey(S,_)]=m,this.trianglesLen=0,this._addTriangle(g,p,m,-1,-1,-1);for(let k=0,$,D;k<this._ids.length;k++){const M=this._ids[k],F=t[2*M],C=t[2*M+1];if(k>0&&Math.abs(F-$)<=wk&&Math.abs(C-D)<=wk||($=F,D=C,M===g||M===p||M===m))continue;let O=0;for(let Be=0,Qe=this._hashKey(F,C);Be<this._hashSize&&(O=o[(Qe+Be)%this._hashSize],!(O!==-1&&O!==i[O]));Be++);O=n[O];let q=O,G;for(;G=i[q],nd(F,C,t[2*q],t[2*q+1],t[2*G],t[2*G+1])>=0;)if(q=G,q===O){q=-1;break}if(q===-1)continue;let K=this._addTriangle(q,M,i[q],-1,-1,r[q]);r[M]=this._legalize(K+2),r[q]=K,A++;let ce=i[q];for(;G=i[ce],nd(F,C,t[2*ce],t[2*ce+1],t[2*G],t[2*G+1])<0;)K=this._addTriangle(ce,M,G,r[M],-1,r[ce]),r[M]=this._legalize(K+2),i[ce]=ce,A--,ce=G;if(q===O)for(;G=n[q],nd(F,C,t[2*G],t[2*G+1],t[2*q],t[2*q+1])<0;)K=this._addTriangle(G,M,q,-1,r[q],r[G]),this._legalize(K+2),r[G]=K,i[q]=q,A--,q=G;this._hullStart=n[M]=q,i[q]=n[ce]=M,i[M]=ce,o[this._hashKey(F,C)]=M,o[this._hashKey(t[2*q],t[2*q+1])]=q}this.hull=new Uint32Array(A);for(let k=0,$=this._hullStart;k<A;k++)this.hull[k]=$,$=i[$];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(gY(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let o=0,s=0;for(;;){const a=i[t],u=t-t%3;if(s=u+(t+2)%3,a===-1){if(o===0)break;t=id[--o];continue}const l=a-a%3,c=u+(t+1)%3,f=l+(a+2)%3,d=n[s],h=n[t],g=n[c],p=n[f];if(pY(r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*g],r[2*g+1],r[2*p],r[2*p+1])){n[t]=p,n[a]=d;const y=i[f];if(y===-1){let x=this._hullStart;do{if(this._hullTri[x]===f){this._hullTri[x]=t;break}x=this._hullPrev[x]}while(x!==this._hullStart)}this._link(t,y),this._link(a,i[s]),this._link(s,f);const b=l+(a+1)%3;o<id.length&&(id[o++]=b)}else{if(o===0)break;t=id[--o]}}return s}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,o,s){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,o),this._link(a+2,s),this.trianglesLen+=3,a}}function gY(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function y0(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}function pY(e,t,n,i,r,o,s,a){const u=e-s,l=t-a,c=n-s,f=i-a,d=r-s,h=o-a,g=u*u+l*l,p=c*c+f*f,m=d*d+h*h;return u*(f*m-p*h)-l*(c*m-p*d)+g*(c*h-f*d)<0}function mY(e,t,n,i,r,o){const s=n-e,a=i-t,u=r-e,l=o-t,c=s*s+a*a,f=u*u+l*l,d=.5/(s*l-a*u),h=(l*c-a*f)*d,g=(s*f-u*c)*d;return h*h+g*g}function yY(e,t,n,i,r,o){const s=n-e,a=i-t,u=r-e,l=o-t,c=s*s+a*a,f=u*u+l*l,d=.5/(s*l-a*u),h=e+(l*c-a*f)*d,g=t+(s*f-u*c)*d;return{x:h,y:g}}function Ba(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const o=e[r],s=t[o];let a=r-1;for(;a>=n&&t[e[a]]>s;)e[a+1]=e[a--];e[a+1]=o}else{const r=n+i>>1;let o=n+1,s=i;pl(e,r,o),t[e[n]]>t[e[i]]&&pl(e,n,i),t[e[o]]>t[e[i]]&&pl(e,o,i),t[e[n]]>t[e[o]]&&pl(e,n,o);const a=e[o],u=t[a];for(;;){do o++;while(t[e[o]]<u);do s--;while(t[e[s]]>u);if(s<o)break;pl(e,o,s)}e[n+1]=e[s],e[s]=a,i-o+1>=s-n?(Ba(e,t,o,i),Ba(e,t,n,s-1)):(Ba(e,t,n,s-1),Ba(e,t,o,i))}}function pl(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function bY(e){return e[0]}function xY(e){return e[1]}const _k=1e-6;class $s{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const r=t+i,o=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${o}`:(Math.abs(this._x1-r)>_k||Math.abs(this._y1-o)>_k)&&(this._+="L"+r+","+o),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=o}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class gy{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}let vY=class{constructor(t,[n,i,r,o]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=o,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this;let o,s;const a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let p=0,m=0,y=i.length,b,x;p<y;p+=3,m+=2){const v=i[p]*2,w=i[p+1]*2,S=i[p+2]*2,_=t[v],E=t[v+1],A=t[w],k=t[w+1],$=t[S],D=t[S+1],M=A-_,F=k-E,C=$-_,O=D-E,q=(M*O-F*C)*2;if(Math.abs(q)<1e-9){if(o===void 0){o=s=0;for(const K of n)o+=t[K*2],s+=t[K*2+1];o/=n.length,s/=n.length}const G=1e9*Math.sign((o-_)*O-(s-E)*C);b=(_+$)/2-G*O,x=(E+D)/2+G*C}else{const G=1/q,K=M*M+F*F,ce=C*C+O*O;b=_+(O*K-F*ce)*G,x=E+(M*ce-C*K)*G}a[m]=b,a[m+1]=x}let u=n[n.length-1],l,c=u*4,f,d=t[2*u],h,g=t[2*u+1];r.fill(0);for(let p=0;p<n.length;++p)u=n[p],l=c,f=d,h=g,c=u*4,d=t[2*u],g=t[2*u+1],r[l+2]=r[c]=h-g,r[l+3]=r[c+1]=d-f}render(t){const n=t==null?t=new $s:void 0,{delaunay:{halfedges:i,inedges:r,hull:o},circumcenters:s,vectors:a}=this;if(o.length<=1)return null;for(let c=0,f=i.length;c<f;++c){const d=i[c];if(d<c)continue;const h=Math.floor(c/3)*2,g=Math.floor(d/3)*2,p=s[h],m=s[h+1],y=s[g],b=s[g+1];this._renderSegment(p,m,y,b,t)}let u,l=o[o.length-1];for(let c=0;c<o.length;++c){u=l,l=o[c];const f=Math.floor(r[l]/3)*2,d=s[f],h=s[f+1],g=u*4,p=this._project(d,h,a[g+2],a[g+3]);p&&this._renderSegment(d,h,p[0],p[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new $s:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new $s:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let o=r.length;for(;r[0]===r[o-2]&&r[1]===r[o-1]&&o>1;)o-=2;for(let s=2;s<o;s+=2)(r[s]!==r[s-2]||r[s+1]!==r[s-1])&&n.lineTo(r[s],r[s+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new gy;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,o){let s;const a=this._regioncode(t,n),u=this._regioncode(i,r);a===0&&u===0?(o.moveTo(t,n),o.lineTo(i,r)):(s=this._clipSegment(t,n,i,r,a,u))&&(o.moveTo(s[0],s[1]),o.lineTo(s[2],s[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r){e:for(let o=0,s=n.length;o<s;o+=2)for(let a=0,u=r.length;a<u;a+=2)if(n[o]===r[a]&&n[o+1]===r[a+1]&&n[(o+2)%s]===r[(a+u-2)%u]&&n[(o+3)%s]===r[(a+u-1)%u]){yield i;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:o}}=this,s=i[t];if(s===-1)return null;const a=[];let u=s;do{const l=Math.floor(u/3);if(a.push(n[l*2],n[l*2+1]),u=u%3===2?u-2:u+1,o[u]!==t)break;u=r[u]}while(u!==s&&u!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,r=t*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n))}_clipFinite(t,n){const i=n.length;let r=null,o,s,a=n[i-2],u=n[i-1],l,c=this._regioncode(a,u),f,d=0;for(let h=0;h<i;h+=2)if(o=a,s=u,a=n[h],u=n[h+1],l=c,c=this._regioncode(a,u),l===0&&c===0)f=d,d=0,r?r.push(a,u):r=[a,u];else{let g,p,m,y,b;if(l===0){if((g=this._clipSegment(o,s,a,u,l,c))===null)continue;[p,m,y,b]=g}else{if((g=this._clipSegment(a,u,o,s,c,l))===null)continue;[y,b,p,m]=g,f=d,d=this._edgecode(p,m),f&&d&&this._edge(t,f,d,r,r.length),r?r.push(p,m):r=[p,m]}f=d,d=this._edgecode(y,b),f&&d&&this._edge(t,f,d,r,r.length),r?r.push(y,b):r=[y,b]}if(r)f=d,d=this._edgecode(r[0],r[1]),f&&d&&this._edge(t,f,d,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,o,s){const a=o<s;for(a&&([t,n,i,r,o,s]=[i,r,t,n,s,o]);;){if(o===0&&s===0)return a?[i,r,t,n]:[t,n,i,r];if(o&s)return null;let u,l,c=o||s;c&8?(u=t+(i-t)*(this.ymax-n)/(r-n),l=this.ymax):c&4?(u=t+(i-t)*(this.ymin-n)/(r-n),l=this.ymin):c&2?(l=n+(r-n)*(this.xmax-t)/(i-t),u=this.xmax):(l=n+(r-n)*(this.xmin-t)/(i-t),u=this.xmin),o?(t=u,n=l,o=this._regioncode(t,n)):(i=u,r=l,s=this._regioncode(i,r))}}_clipInfinite(t,n,i,r,o,s){let a=Array.from(n),u;if((u=this._project(a[0],a[1],i,r))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],o,s))&&a.push(u[0],u[1]),a=this._clipFinite(t,a))for(let l=0,c=a.length,f,d=this._edgecode(a[c-2],a[c-1]);l<c;l+=2)f=d,d=this._edgecode(a[l],a[l+1]),f&&d&&(l=this._edge(t,f,d,a,l),c=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,i,r,o){for(;n!==i;){let s,a;switch(n){case 5:n=4;continue;case 4:n=6,s=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,s=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,s=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,s=this.xmin,a=this.ymin;break}(r[o]!==s||r[o+1]!==a)&&this.contains(t,s,a)&&(r.splice(o,0,s,a),o+=2)}return o}_project(t,n,i,r){let o=1/0,s,a,u;if(r<0){if(n<=this.ymin)return null;(s=(this.ymin-n)/r)<o&&(u=this.ymin,a=t+(o=s)*i)}else if(r>0){if(n>=this.ymax)return null;(s=(this.ymax-n)/r)<o&&(u=this.ymax,a=t+(o=s)*i)}if(i>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/i)<o&&(a=this.xmax,u=n+(o=s)*r)}else if(i<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/i)<o&&(a=this.xmin,u=n+(o=s)*r)}return[a,u]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const i=(n+2)%t.length,r=(n+4)%t.length;(t[n]===t[i]&&t[i]===t[r]||t[n+1]===t[i+1]&&t[i+1]===t[r+1])&&(t.splice(i,2),n-=2)}t.length||(t=null)}return t}};const wY=2*Math.PI,Ca=Math.pow;function _Y(e){return e[0]}function SY(e){return e[1]}function EY(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],o=2*t[i+1],s=2*t[i+2];if((n[s]-n[r])*(n[o+1]-n[r+1])-(n[o]-n[r])*(n[s+1]-n[r+1])>1e-10)return!1}return!0}function kY(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class g2{static from(t,n=_Y,i=SY,r){return new g2("length"in t?$Y(t,n,i,r):Float64Array.from(AY(t,n,i,r)))}constructor(t){this._delaunator=new Qh(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&EY(t)){this.collinear=Int32Array.from({length:n.length/2},(d,h)=>h).sort((d,h)=>n[2*d]-n[2*h]||n[2*d+1]-n[2*h+1]);const u=this.collinear[0],l=this.collinear[this.collinear.length-1],c=[n[2*u],n[2*u+1],n[2*l],n[2*l+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let d=0,h=n.length/2;d<h;++d){const g=kY(n[2*d],n[2*d+1],f);n[2*d]=g[0],n[2*d+1]=g[1]}this._delaunator=new Qh(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,l=i.length;u<l;++u){const c=o[u%3===2?u-2:u+1];(i[u]===-1||s[c]===-1)&&(s[c]=u)}for(let u=0,l=r.length;u<l;++u)a[r[u]]=u;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],s[r[0]]=1,r.length===2&&(s[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new vY(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:o,triangles:s,collinear:a}=this;if(a){const f=a.indexOf(t);f>0&&(yield a[f-1]),f<a.length-1&&(yield a[f+1]);return}const u=n[t];if(u===-1)return;let l=u,c=-1;do{if(yield c=s[l],l=l%3===2?l-2:l+1,s[l]!==t)return;if(l=o[l],l===-1){const f=i[(r[t]+1)%i.length];f!==c&&(yield f);return}}while(l!==u)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=i;let o;for(;(o=this._step(i,t,n))>=0&&o!==i&&o!==r;)i=o;return o}_step(t,n,i){const{inedges:r,hull:o,_hullIndex:s,halfedges:a,triangles:u,points:l}=this;if(r[t]===-1||!l.length)return(t+1)%(l.length>>1);let c=t,f=Ca(n-l[t*2],2)+Ca(i-l[t*2+1],2);const d=r[t];let h=d;do{let g=u[h];const p=Ca(n-l[g*2],2)+Ca(i-l[g*2+1],2);if(p<f&&(f=p,c=g),h=h%3===2?h-2:h+1,u[h]!==t)break;if(h=a[h],h===-1){if(h=o[(s[t]+1)%o.length],h!==g&&Ca(n-l[h*2],2)+Ca(i-l[h*2+1],2)<f)return h;break}}while(h!==d);return c}render(t){const n=t==null?t=new $s:void 0,{points:i,halfedges:r,triangles:o}=this;for(let s=0,a=r.length;s<a;++s){const u=r[s];if(u<s)continue;const l=o[s]*2,c=o[u]*2;t.moveTo(i[l],i[l+1]),t.lineTo(i[c],i[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const i=t==null?t=new $s:void 0,{points:r}=this;for(let o=0,s=r.length;o<s;o+=2){const a=r[o],u=r[o+1];t.moveTo(a+n,u),t.arc(a,u,n,0,wY)}return i&&i.value()}renderHull(t){const n=t==null?t=new $s:void 0,{hull:i,points:r}=this,o=i[0]*2,s=i.length;t.moveTo(r[o],r[o+1]);for(let a=1;a<s;++a){const u=2*i[a];t.lineTo(r[u],r[u+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new gy;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new $s:void 0,{points:r,triangles:o}=this,s=o[t*=3]*2,a=o[t+1]*2,u=o[t+2]*2;return n.moveTo(r[s],r[s+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[u],r[u+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new gy;return this.renderTriangle(t,n),n.value()}}function $Y(e,t,n,i){const r=e.length,o=new Float64Array(r*2);for(let s=0;s<r;++s){const a=e[s];o[s*2]=t.call(i,a,s,e),o[s*2+1]=n.call(i,a,s,e)}return o}function*AY(e,t,n,i){let r=0;for(const o of e)yield t.call(i,o,r,e),yield n.call(i,o,r,e),++r}function p2(e){T.call(this,null,e)}p2.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const CY=[-1e5,-1e5,1e5,1e5];U(p2,T,{transform(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:CY;const o=this.value=g2.from(i,e.x,e.y).voronoi(r);for(let s=0,a=i.length;s<a;++s){const u=o.cellPolygon(s);i[s][n]=u?MY(u):null}return t.reflow(e.modified()).modifies(n)}});function MY(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}const FY=Object.freeze(Object.defineProperty({__proto__:null,voronoi:p2},Symbol.toStringTag,{value:"Module"}));var b0=Math.PI/180,Wl=64,Nd=2048;function TY(){var e=[256,256],t,n,i,r,o,s,a,u=ED,l=[],c=Math.random,f={};f.layout=function(){for(var g=d(Eo()),p=PY((e[0]>>5)*e[1]),m=null,y=l.length,b=-1,x=[],v=l.map(S=>({text:t(S),font:n(S),style:r(S),weight:o(S),rotate:s(S),size:~~(i(S)+1e-14),padding:a(S),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:S})).sort((S,_)=>_.size-S.size);++b<y;){var w=v[b];w.x=e[0]*(c()+.5)>>1,w.y=e[1]*(c()+.5)>>1,DY(g,w,v,b),w.hasText&&h(p,w,m)&&(x.push(w),m?OY(m,w):m=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=e[0]>>1,w.y-=e[1]>>1)}return x};function d(g){g.width=g.height=1;var p=Math.sqrt(g.getContext("2d").getImageData(0,0,1,1).data.length>>2);g.width=(Wl<<5)/p,g.height=Nd/p;var m=g.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:p}}function h(g,p,m){for(var y=p.x,b=p.y,x=Math.sqrt(e[0]*e[0]+e[1]*e[1]),v=u(e),w=c()<.5?1:-1,S=-w,_,E,A;(_=v(S+=w))&&(E=~~_[0],A=~~_[1],!(Math.min(Math.abs(E),Math.abs(A))>=x));)if(p.x=y+E,p.y=b+A,!(p.x+p.x0<0||p.y+p.y0<0||p.x+p.x1>e[0]||p.y+p.y1>e[1])&&(!m||!NY(p,g,e[0]))&&(!m||RY(p,m))){for(var k=p.sprite,$=p.width>>5,D=e[0]>>5,M=p.x-($<<4),F=M&127,C=32-F,O=p.y1-p.y0,q=(p.y+p.y0)*D+(M>>5),G,K=0;K<O;K++){G=0;for(var ce=0;ce<=$;ce++)g[q+ce]|=G<<C|(ce<$?(G=k[K*$+ce])>>>F:0);q+=D}return p.sprite=null,!0}return!1}return f.words=function(g){return arguments.length?(l=g,f):l},f.size=function(g){return arguments.length?(e=[+g[0],+g[1]],f):e},f.font=function(g){return arguments.length?(n=ss(g),f):n},f.fontStyle=function(g){return arguments.length?(r=ss(g),f):r},f.fontWeight=function(g){return arguments.length?(o=ss(g),f):o},f.rotate=function(g){return arguments.length?(s=ss(g),f):s},f.text=function(g){return arguments.length?(t=ss(g),f):t},f.spiral=function(g){return arguments.length?(u=LY[g]||g,f):u},f.fontSize=function(g){return arguments.length?(i=ss(g),f):i},f.padding=function(g){return arguments.length?(a=ss(g),f):a},f.random=function(g){return arguments.length?(c=g,f):c},f}function DY(e,t,n,i){if(!t.sprite){var r=e.context,o=e.ratio;r.clearRect(0,0,(Wl<<5)/o,Nd/o);var s=0,a=0,u=0,l=n.length,c,f,d,h,g;for(--i;++i<l;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/o)+"px "+t.font,c=r.measureText(t.text+"m").width*o,d=t.size<<1,t.rotate){var p=Math.sin(t.rotate*b0),m=Math.cos(t.rotate*b0),y=c*m,b=c*p,x=d*m,v=d*p;c=Math.max(Math.abs(y+v),Math.abs(y-v))+31>>5<<5,d=~~Math.max(Math.abs(b+x),Math.abs(b-x))}else c=c+31>>5<<5;if(d>u&&(u=d),s+c>=Wl<<5&&(s=0,a+=u,u=0),a+d>=Nd)break;r.translate((s+(c>>1))/o,(a+(d>>1))/o),t.rotate&&r.rotate(t.rotate*b0),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=d,t.xoff=s,t.yoff=a,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,s+=c}for(var w=r.getImageData(0,0,(Wl<<5)/o,Nd/o).data,S=[];--i>=0;)if(t=n[i],!!t.hasText){for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)S[h]=0;if(s=t.xoff,s==null)return;a=t.yoff;var _=0,E=-1;for(g=0;g<d;g++){for(h=0;h<c;h++){var A=f*g+(h>>5),k=w[(a+g)*(Wl<<5)+(s+h)<<2]?1<<31-h%32:0;S[A]|=k,_|=k}_?E=g:(t.y0++,d--,g--,a++)}t.y1=t.y0+E,t.sprite=S.slice(0,(t.y1-t.y0)*f)}}}function NY(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,o=e.x-(r<<4),s=o&127,a=32-s,u=e.y1-e.y0,l=(e.y+e.y0)*n+(o>>5),c,f=0;f<u;f++){c=0;for(var d=0;d<=r;d++)if((c<<a|(d<r?(c=i[f*r+d])>>>s:0))&t[l+d])return!0;l+=n}return!1}function OY(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function RY(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function ED(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function zY(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(o){var s=o<0?-1:1;switch(Math.sqrt(1+4*s*o)-s&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function PY(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function ss(e){return typeof e=="function"?e:function(){return e}}var LY={archimedean:ED,rectangular:zY};const kD=["x","y","font","fontSize","fontStyle","fontWeight","angle"],IY=["text","font","rotate","fontSize","fontStyle","fontWeight"];function m2(e){T.call(this,TY(),e)}m2.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:kD}]};U(m2,T,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&R("Wordcloud size dimensions must be non-zero.");function n(g){const p=e[g];return ue(p)&&t.modified(p.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||IY.some(n)))return;const r=t.materialize(t.SOURCE).source,o=this.value,s=e.as||kD;let a=e.fontSize||14,u;if(ue(a)?u=e.fontSizeRange:a=Bt(a),u){const g=a,p=we("sqrt")().domain(Ki(r,g)).range(u);a=m=>p(g(m))}r.forEach(g=>{g[s[0]]=NaN,g[s[1]]=NaN,g[s[3]]=0});const l=o.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(a).random(Vn).layout(),c=o.size(),f=c[0]>>1,d=c[1]>>1,h=l.length;for(let g=0,p,m;g<h;++g)p=l[g],m=p.datum,m[s[0]]=p.x+f,m[s[1]]=p.y+d,m[s[2]]=p.font,m[s[3]]=p.size,m[s[4]]=p.style,m[s[5]]=p.weight,m[s[6]]=p.rotate;return t.reflow(i).modifies(s)}});const BY=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:m2},Symbol.toStringTag,{value:"Module"})),jY=e=>new Uint8Array(e),UY=e=>new Uint16Array(e),nc=e=>new Uint32Array(e);function qY(){let e=8,t=[],n=nc(0),i=rd(0,e),r=rd(0,e);return{data:()=>t,seen:()=>n=WY(n,t.length),add(o){for(let s=0,a=t.length,u=o.length,l;s<u;++s)l=o[s],l._index=a++,t.push(l)},remove(o,s){const a=t.length,u=Array(a-o),l=t;let c,f,d;for(f=0;!s[f]&&f<a;++f)u[f]=t[f],l[f]=f;for(d=f;f<a;++f)c=t[f],s[f]?l[f]=-1:(l[f]=d,i[d]=i[f],r[d]=r[f],u[d]=c,c._index=d++),i[f]=0;return t=u,l},size:()=>t.length,curr:()=>i,prev:()=>r,reset:o=>r[o]=i[o],all:()=>e<257?255:e<65537?65535:4294967295,set(o,s){i[o]|=s},clear(o,s){i[o]&=~s},resize(o,s){const a=i.length;(o>a||s>e)&&(e=Math.max(s,e),i=rd(o,e,i),r=rd(o,e))}}}function WY(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function rd(e,t,n){const i=(t<257?jY:t<65537?UY:nc)(e);return n&&i.set(n),i}function Sk(e,t,n){const i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(r,o){const s=this,a=s.bisect(s.range,r.value),u=r.index,l=a[0],c=a[1],f=u.length;let d;for(d=0;d<l;++d)o[u[d]]|=i;for(d=c;d<f;++d)o[u[d]]|=i;return s}}}function Ek(){let e=nc(0),t=[],n=0;function i(a,u,l){if(!u.length)return[];const c=n,f=u.length,d=nc(f);let h=Array(f),g,p,m;for(m=0;m<f;++m)h[m]=a(u[m]),d[m]=m;if(h=HY(h,d),c)g=t,p=e,t=Array(c+f),e=nc(c+f),GY(l,g,p,c,h,d,f,t,e);else{if(l>0)for(m=0;m<f;++m)d[m]+=l;t=h,e=d}return n=c+f,{index:d,value:h}}function r(a,u){const l=n;let c,f,d;for(f=0;!u[e[f]]&&f<l;++f);for(d=f;f<l;++f)u[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=l-a}function o(a){for(let u=0,l=n;u<l;++u)e[u]=a[e[u]]}function s(a,u){let l;return u?l=u.length:(u=t,l=n),[J4(u,a[0],0,l),Hd(u,a[1],0,l)]}return{insert:i,remove:r,bisect:s,reindex:o,index:()=>e,size:()=>n}}function HY(e,t){return e.sort.call(t,(n,i)=>{const r=e[n],o=e[i];return r<o?-1:r>o?1:0}),e8(e,t)}function GY(e,t,n,i,r,o,s,a,u){let l=0,c=0,f;for(f=0;l<i&&c<s;++f)t[l]<r[c]?(a[f]=t[l],u[f]=n[l++]):(a[f]=r[c],u[f]=o[c++]+e);for(;l<i;++l,++f)a[f]=t[l],u[f]=n[l];for(;c<s;++c,++f)a[f]=r[c],u[f]=o[c]+e}function y2(e){T.call(this,qY(),e),this._indices=null,this._dims=null}y2.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};U(y2,T,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(i=>t.modified(i.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,i=e.query,r=this._indices={},o=this._dims=[],s=i.length;let a=0,u,l;for(;a<s;++a)u=n[a].fname,l=r[u]||(r[u]=Ek()),o.push(Sk(l,a,i[a]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),i=e.fields,r=e.query,o=this._indices,s=this._dims,a=this.value,u=a.curr(),l=a.prev(),c=a.all(),f=n.rem=n.add,d=n.mod,h=r.length,g={};let p,m,y,b,x,v,w,S,_;if(l.set(u),t.rem.length&&(x=this.remove(e,t,n)),t.add.length&&a.add(t.add),t.mod.length)for(v={},b=t.mod,w=0,S=b.length;w<S;++w)v[b[w]._index]=1;for(w=0;w<h;++w)_=i[w],(!s[w]||e.modified("fields",w)||t.modified(_.fields))&&(y=_.fname,(p=g[y])||(o[y]=m=Ek(),g[y]=p=m.insert(_,t.source,0)),s[w]=Sk(m,w,r[w]).onAdd(p,u));for(w=0,S=a.data().length;w<S;++w)x[w]||(l[w]!==u[w]?f.push(w):v[w]&&u[w]!==c&&d.push(w));return a.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),i=this._dims.length;let r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},insert(e,t,n){const i=t.add,r=this.value,o=this._dims,s=this._indices,a=e.fields,u={},l=n.add,c=r.size()+i.length,f=o.length;let d=r.size(),h,g,p;r.resize(c,f),r.add(i);const m=r.curr(),y=r.prev(),b=r.all();for(h=0;h<f;++h)g=a[h].fname,p=u[g]||(u[g]=s[g].insert(a[h],i,d)),o[h].onAdd(p,m);for(;d<c;++d)y[d]=b,m[d]!==b&&l.push(d)},modify(e,t){const n=t.mod,i=this.value,r=i.curr(),o=i.all(),s=e.mod;let a,u,l;for(a=0,u=s.length;a<u;++a)l=s[a]._index,r[l]!==o&&n.push(l)},remove(e,t,n){const i=this._indices,r=this.value,o=r.curr(),s=r.prev(),a=r.all(),u={},l=n.rem,c=t.rem;let f,d,h,g;for(f=0,d=c.length;f<d;++f)h=c[f]._index,u[h]=1,s[h]=g=o[h],o[h]=a,g!==a&&l.push(h);for(h in i)i[h].remove(d,u);return this.reindex(t,d,u),u},reindex(e,t,n){const i=this._indices,r=this.value;e.runAfter(()=>{const o=r.remove(t,n);for(const s in i)i[s].reindex(o)})},update(e,t,n){const i=this._dims,r=e.query,o=t.stamp,s=i.length;let a=0,u,l;for(n.filters=0,l=0;l<s;++l)e.modified("query",l)&&(u=l,++a);if(a===1)a=i[u].one,this.incrementOne(i[u],r[u],n.add,n.rem);else for(l=0,a=0;l<s;++l)e.modified("query",l)&&(a|=i[l].one,this.incrementAll(i[l],r[l],o,n.add),n.rem=n.add);return a},incrementAll(e,t,n,i){const r=this.value,o=r.seen(),s=r.curr(),a=r.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=l[0],g=l[1],p=e.one;let m,y,b;if(f<h)for(m=f,y=Math.min(h,d);m<y;++m)b=u[m],o[b]!==n&&(a[b]=s[b],o[b]=n,i.push(b)),s[b]^=p;else if(f>h)for(m=h,y=Math.min(f,g);m<y;++m)b=u[m],o[b]!==n&&(a[b]=s[b],o[b]=n,i.push(b)),s[b]^=p;if(d>g)for(m=Math.max(f,g),y=d;m<y;++m)b=u[m],o[b]!==n&&(a[b]=s[b],o[b]=n,i.push(b)),s[b]^=p;else if(d<g)for(m=Math.max(h,d),y=g;m<y;++m)b=u[m],o[b]!==n&&(a[b]=s[b],o[b]=n,i.push(b)),s[b]^=p;e.range=t.slice()},incrementOne(e,t,n,i){const r=this.value,o=r.curr(),s=e.index(),a=e.bisect(e.range),u=e.bisect(t),l=u[0],c=u[1],f=a[0],d=a[1],h=e.one;let g,p,m;if(l<f)for(g=l,p=Math.min(f,c);g<p;++g)m=s[g],o[m]^=h,n.push(m);else if(l>f)for(g=f,p=Math.min(l,d);g<p;++g)m=s[g],o[m]^=h,i.push(m);if(c>d)for(g=Math.max(l,d),p=c;g<p;++g)m=s[g],o[m]^=h,n.push(m);else if(c<d)for(g=Math.max(f,c),p=d;g<p;++g)m=s[g],o[m]^=h,i.push(m);e.range=t.slice()}});function b2(e){T.call(this,null,e)}b2.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};U(b2,T,{transform(e,t){const n=~(e.ignore||0),i=e.filter,r=i.mask;if(!(r&n))return t.StopPropagation;const o=t.fork(t.ALL),s=i.data(),a=i.curr(),u=i.prev(),l=c=>a[c]&n?null:s[c];return o.filter(o.MOD,l),r&r-1?(o.filter(o.ADD,c=>{const f=a[c]&n;return!f&&f^u[c]&n?s[c]:null}),o.filter(o.REM,c=>{const f=a[c]&n;return f&&!(f^(f^u[c]&n))?s[c]:null})):(o.filter(o.ADD,l),o.filter(o.REM,c=>(a[c]&n)===r?s[c]:null)),o.filter(o.SOURCE,c=>l(c._index))}});const YY=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:y2,resolvefilter:b2},Symbol.toStringTag,{value:"Module"})),VY="RawCode",qs="Literal",XY="Property",KY="Identifier",JY="ArrayExpression",QY="BinaryExpression",$D="CallExpression",ZY="ConditionalExpression",eV="LogicalExpression",tV="MemberExpression",nV="ObjectExpression",iV="UnaryExpression";function ki(e){this.type=e}ki.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=rV(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};function rV(e){switch(e.type){case JY:return e.elements;case QY:case eV:return[e.left,e.right];case $D:return[e.callee].concat(e.arguments);case ZY:return[e.test,e.consequent,e.alternate];case tV:return[e.object,e.property];case nV:return e.properties;case XY:return[e.key,e.value];case iV:return[e.argument];case KY:case qs:case VY:default:return[]}}var cr,J,N,Pt,$e,wp=1,gf=2,Ws=3,Yo=4,_p=5,ca=6,an=7,pf=8,oV=9;cr={};cr[wp]="Boolean";cr[gf]="<end>";cr[Ws]="Identifier";cr[Yo]="Keyword";cr[_p]="Null";cr[ca]="Numeric";cr[an]="Punctuator";cr[pf]="String";cr[oV]="RegularExpression";var sV="ArrayExpression",aV="BinaryExpression",uV="CallExpression",lV="ConditionalExpression",AD="Identifier",cV="Literal",fV="LogicalExpression",dV="MemberExpression",hV="ObjectExpression",gV="Property",pV="UnaryExpression",lt="Unexpected token %0",mV="Unexpected number",yV="Unexpected string",bV="Unexpected identifier",xV="Unexpected reserved word",vV="Unexpected end of input",py="Invalid regular expression",x0="Invalid regular expression: missing /",CD="Octal literals are not allowed in strict mode.",wV="Duplicate data property in object literal not allowed in strict mode",xt="ILLEGAL",Ac="Disabled.",_V=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),SV=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Sp(e,t){if(!e)throw new Error("ASSERT: "+t)}function Sr(e){return e>=48&&e<=57}function x2(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function ic(e){return"01234567".indexOf(e)>=0}function EV(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Cc(e){return e===10||e===13||e===8232||e===8233}function mf(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&_V.test(String.fromCharCode(e))}function Zh(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&SV.test(String.fromCharCode(e))}const kV={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function MD(){for(;N<Pt;){const e=J.charCodeAt(N);if(EV(e)||Cc(e))++N;else break}}function my(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)N<Pt&&x2(J[N])?(i=J[N++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):xe({},lt,xt);return String.fromCharCode(r)}function $V(){var e,t,n,i;for(e=J[N],t=0,e==="}"&&xe({},lt,xt);N<Pt&&(e=J[N++],!!x2(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&xe({},lt,xt),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function FD(){var e,t;for(e=J.charCodeAt(N++),t=String.fromCharCode(e),e===92&&(J.charCodeAt(N)!==117&&xe({},lt,xt),++N,e=my("u"),(!e||e==="\\"||!mf(e.charCodeAt(0)))&&xe({},lt,xt),t=e);N<Pt&&(e=J.charCodeAt(N),!!Zh(e));)++N,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),J.charCodeAt(N)!==117&&xe({},lt,xt),++N,e=my("u"),(!e||e==="\\"||!Zh(e.charCodeAt(0)))&&xe({},lt,xt),t+=e);return t}function AV(){var e,t;for(e=N++;N<Pt;){if(t=J.charCodeAt(N),t===92)return N=e,FD();if(Zh(t))++N;else break}return J.slice(e,N)}function CV(){var e,t,n;return e=N,t=J.charCodeAt(N)===92?FD():AV(),t.length===1?n=Ws:kV.hasOwnProperty(t)?n=Yo:t==="null"?n=_p:t==="true"||t==="false"?n=wp:n=Ws,{type:n,value:t,start:e,end:N}}function v0(){var e=N,t=J.charCodeAt(N),n,i=J[N],r,o,s;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++N,{type:an,value:String.fromCharCode(t),start:e,end:N};default:if(n=J.charCodeAt(N+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return N+=2,{type:an,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:N};case 33:case 61:return N+=2,J.charCodeAt(N)===61&&++N,{type:an,value:J.slice(e,N),start:e,end:N}}}if(s=J.substr(N,4),s===">>>=")return N+=4,{type:an,value:s,start:e,end:N};if(o=s.substr(0,3),o===">>>"||o==="<<="||o===">>=")return N+=3,{type:an,value:o,start:e,end:N};if(r=o.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return N+=2,{type:an,value:r,start:e,end:N};if(r==="//"&&xe({},lt,xt),"<>=!+-*%&|^/".indexOf(i)>=0)return++N,{type:an,value:i,start:e,end:N};xe({},lt,xt)}function MV(e){let t="";for(;N<Pt&&x2(J[N]);)t+=J[N++];return t.length===0&&xe({},lt,xt),mf(J.charCodeAt(N))&&xe({},lt,xt),{type:ca,value:parseInt("0x"+t,16),start:e,end:N}}function FV(e){let t="0"+J[N++];for(;N<Pt&&ic(J[N]);)t+=J[N++];return(mf(J.charCodeAt(N))||Sr(J.charCodeAt(N)))&&xe({},lt,xt),{type:ca,value:parseInt(t,8),octal:!0,start:e,end:N}}function kk(){var e,t,n;if(n=J[N],Sp(Sr(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=N,e="",n!=="."){if(e=J[N++],n=J[N],e==="0"){if(n==="x"||n==="X")return++N,MV(t);if(ic(n))return FV(t);n&&Sr(n.charCodeAt(0))&&xe({},lt,xt)}for(;Sr(J.charCodeAt(N));)e+=J[N++];n=J[N]}if(n==="."){for(e+=J[N++];Sr(J.charCodeAt(N));)e+=J[N++];n=J[N]}if(n==="e"||n==="E")if(e+=J[N++],n=J[N],(n==="+"||n==="-")&&(e+=J[N++]),Sr(J.charCodeAt(N)))for(;Sr(J.charCodeAt(N));)e+=J[N++];else xe({},lt,xt);return mf(J.charCodeAt(N))&&xe({},lt,xt),{type:ca,value:parseFloat(e),start:t,end:N}}function TV(){var e="",t,n,i,r,o=!1;for(t=J[N],Sp(t==="'"||t==='"',"String literal must starts with a quote"),n=N,++N;N<Pt;)if(i=J[N++],i===t){t="";break}else if(i==="\\")if(i=J[N++],!i||!Cc(i.charCodeAt(0)))switch(i){case"u":case"x":J[N]==="{"?(++N,e+=$V()):e+=my(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:ic(i)?(r="01234567".indexOf(i),r!==0&&(o=!0),N<Pt&&ic(J[N])&&(o=!0,r=r*8+"01234567".indexOf(J[N++]),"0123".indexOf(i)>=0&&N<Pt&&ic(J[N])&&(r=r*8+"01234567".indexOf(J[N++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&J[N]===`
`&&++N;else{if(Cc(i.charCodeAt(0)))break;e+=i}return t!==""&&xe({},lt,xt),{type:pf,value:e,octal:o,start:n,end:N}}function DV(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";xe({},py)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{xe({},py)}try{return new RegExp(e,t)}catch{return null}}function NV(){var e,t,n,i,r;for(e=J[N],Sp(e==="/","Regular expression literal must start with a slash"),t=J[N++],n=!1,i=!1;N<Pt;)if(e=J[N++],t+=e,e==="\\")e=J[N++],Cc(e.charCodeAt(0))&&xe({},x0),t+=e;else if(Cc(e.charCodeAt(0)))xe({},x0);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||xe({},x0),r=t.substr(1,t.length-2),{value:r,literal:t}}function OV(){var e,t,n;for(t="",n="";N<Pt&&(e=J[N],!!Zh(e.charCodeAt(0)));)++N,e==="\\"&&N<Pt?xe({},lt,xt):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&xe({},py,n),{value:n,literal:t}}function RV(){var e,t,n,i;return $e=null,MD(),e=N,t=NV(),n=OV(),i=DV(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:N}}function zV(e){return e.type===Ws||e.type===Yo||e.type===wp||e.type===_p}function TD(){if(MD(),N>=Pt)return{type:gf,start:N,end:N};const e=J.charCodeAt(N);return mf(e)?CV():e===40||e===41||e===59?v0():e===39||e===34?TV():e===46?Sr(J.charCodeAt(N+1))?kk():v0():Sr(e)?kk():v0()}function fn(){const e=$e;return N=e.end,$e=TD(),N=e.end,e}function DD(){const e=N;$e=TD(),N=e}function PV(e){const t=new ki(sV);return t.elements=e,t}function $k(e,t,n){const i=new ki(e==="||"||e==="&&"?fV:aV);return i.operator=e,i.left=t,i.right=n,i}function LV(e,t){const n=new ki(uV);return n.callee=e,n.arguments=t,n}function IV(e,t,n){const i=new ki(lV);return i.test=e,i.consequent=t,i.alternate=n,i}function v2(e){const t=new ki(AD);return t.name=e,t}function Hl(e){const t=new ki(cV);return t.value=e.value,t.raw=J.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function Ak(e,t,n){const i=new ki(dV);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function BV(e){const t=new ki(hV);return t.properties=e,t}function Ck(e,t,n){const i=new ki(gV);return i.key=t,i.value=n,i.kind=e,i}function jV(e,t){const n=new ki(pV);return n.operator=e,n.argument=t,n.prefix=!0,n}function xe(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(o,s)=>(Sp(s<i.length,"Message reference must be in range"),i[s]));throw n=new Error(r),n.index=N,n.description=r,n}function Ep(e){e.type===gf&&xe(e,vV),e.type===ca&&xe(e,mV),e.type===pf&&xe(e,yV),e.type===Ws&&xe(e,bV),e.type===Yo&&xe(e,xV),xe(e,lt,e.value)}function Lt(e){const t=fn();(t.type!==an||t.value!==e)&&Ep(t)}function Re(e){return $e.type===an&&$e.value===e}function w0(e){return $e.type===Yo&&$e.value===e}function UV(){const e=[];for(N=$e.start,Lt("[");!Re("]");)Re(",")?(fn(),e.push(null)):(e.push(Hs()),Re("]")||Lt(","));return fn(),PV(e)}function Mk(){N=$e.start;const e=fn();return e.type===pf||e.type===ca?(e.octal&&xe(e,CD),Hl(e)):v2(e.value)}function qV(){var e,t,n,i;if(N=$e.start,e=$e,e.type===Ws)return n=Mk(),Lt(":"),i=Hs(),Ck("init",n,i);if(e.type===gf||e.type===an)Ep(e);else return t=Mk(),Lt(":"),i=Hs(),Ck("init",t,i)}function WV(){var e=[],t,n,i,r={},o=String;for(N=$e.start,Lt("{");!Re("}");)t=qV(),t.key.type===AD?n=t.key.name:n=o(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?xe({},wV):r[i]=!0,e.push(t),Re("}")||Lt(",");return Lt("}"),BV(e)}function HV(){Lt("(");const e=w2();return Lt(")"),e}const GV={if:1};function YV(){var e,t,n;if(Re("("))return HV();if(Re("["))return UV();if(Re("{"))return WV();if(e=$e.type,N=$e.start,e===Ws||GV[$e.value])n=v2(fn().value);else if(e===pf||e===ca)$e.octal&&xe($e,CD),n=Hl(fn());else{if(e===Yo)throw new Error(Ac);e===wp?(t=fn(),t.value=t.value==="true",n=Hl(t)):e===_p?(t=fn(),t.value=null,n=Hl(t)):Re("/")||Re("/=")?(n=Hl(RV()),DD()):Ep(fn())}return n}function VV(){const e=[];if(Lt("("),!Re(")"))for(;N<Pt&&(e.push(Hs()),!Re(")"));)Lt(",");return Lt(")"),e}function XV(){N=$e.start;const e=fn();return zV(e)||Ep(e),v2(e.value)}function KV(){return Lt("."),XV()}function JV(){Lt("[");const e=w2();return Lt("]"),e}function QV(){var e,t,n;for(e=YV();;)if(Re("."))n=KV(),e=Ak(".",e,n);else if(Re("("))t=VV(),e=LV(e,t);else if(Re("["))n=JV(),e=Ak("[",e,n);else break;return e}function Fk(){const e=QV();if($e.type===an&&(Re("++")||Re("--")))throw new Error(Ac);return e}function Od(){var e,t;if($e.type!==an&&$e.type!==Yo)t=Fk();else{if(Re("++")||Re("--"))throw new Error(Ac);if(Re("+")||Re("-")||Re("~")||Re("!"))e=fn(),t=Od(),t=jV(e.value,t);else{if(w0("delete")||w0("void")||w0("typeof"))throw new Error(Ac);t=Fk()}}return t}function Tk(e){let t=0;if(e.type!==an&&e.type!==Yo)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function ZV(){var e,t,n,i,r,o,s,a,u,l;if(e=$e,u=Od(),i=$e,r=Tk(i),r===0)return u;for(i.prec=r,fn(),t=[e,$e],s=Od(),o=[u,i,s];(r=Tk($e))>0;){for(;o.length>2&&r<=o[o.length-2].prec;)s=o.pop(),a=o.pop().value,u=o.pop(),t.pop(),n=$k(a,u,s),o.push(n);i=fn(),i.prec=r,o.push(i),t.push($e),n=Od(),o.push(n)}for(l=o.length-1,n=o[l],t.pop();l>1;)t.pop(),n=$k(o[l-1].value,o[l-2],n),l-=2;return n}function Hs(){var e,t,n;return e=ZV(),Re("?")&&(fn(),t=Hs(),Lt(":"),n=Hs(),e=IV(e,t,n)),e}function w2(){const e=Hs();if(Re(","))throw new Error(Ac);return e}function _2(e){J=e,N=0,Pt=J.length,$e=null,DD();const t=w2();if($e.type!==gf)throw new Error("Unexpect token after expression.");return t}var ND={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function OD(e){function t(s,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+s+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(s,a,u){return l=>t(s,l,a,u)}const i="new Date",r="String",o="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(s){s.length<3&&R("Missing arguments to clamp function."),s.length>3&&R("Too many arguments to clamp function.");const a=s.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:o,test:n("test",o),if:function(s){s.length<3&&R("Missing arguments to if function."),s.length>3&&R("Too many arguments to if function.");const a=s.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function eX(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function RD(e){e=e||{};const t=e.allowed?vi(e.allowed):{},n=e.forbidden?vi(e.forbidden):{},i=e.constants||ND,r=(e.functions||OD)(f),o=e.globalvar,s=e.fieldvar,a=ue(o)?o:g=>`${o}["${g}"]`;let u={},l={},c=0;function f(g){if(Y(g))return g;const p=d[g.type];return p==null&&R("Unsupported type: "+g.type),p(g)}const d={Literal:g=>g.raw,Identifier:g=>{const p=g.name;return c>0?p:ne(n,p)?R("Illegal identifier: "+p):ne(i,p)?i[p]:ne(t,p)?p:(u[p]=1,a(p))},MemberExpression:g=>{const p=!g.computed,m=f(g.object);p&&(c+=1);const y=f(g.property);return m===s&&(l[eX(y)]=1),p&&(c-=1),m+(p?"."+y:"["+y+"]")},CallExpression:g=>{g.callee.type!=="Identifier"&&R("Illegal callee type: "+g.callee.type);const p=g.callee.name,m=g.arguments,y=ne(r,p)&&r[p];return y||R("Unrecognized function: "+p),ue(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:g=>"["+g.elements.map(f).join(",")+"]",BinaryExpression:g=>"("+f(g.left)+" "+g.operator+" "+f(g.right)+")",UnaryExpression:g=>"("+g.operator+f(g.argument)+")",ConditionalExpression:g=>"("+f(g.test)+"?"+f(g.consequent)+":"+f(g.alternate)+")",LogicalExpression:g=>"("+f(g.left)+g.operator+f(g.right)+")",ObjectExpression:g=>"{"+g.properties.map(f).join(",")+"}",Property:g=>{c+=1;const p=f(g.key);return c-=1,p+":"+f(g.value)}};function h(g){const p={code:f(g),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},p}return h.functions=r,h.constants=i,h}function _0(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function tX(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function nX(e){let t,n,i;e.length!==2?(t=_0,n=(a,u)=>_0(e(a),u),i=(a,u)=>e(a)-u):(t=e===_0||e===tX?e:iX,n=e,i=e);function r(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){const f=r(a,u,l,c-1);return f>l&&i(a[f-1],u)>-i(a[f],u)?f-1:f}return{left:r,center:s,right:o}}function iX(){return 0}function rX(e,...t){e=new Gd(e),t=t.map(oX);e:for(const n of e)for(const i of t)if(!i.has(n)){e.delete(n);continue e}return e}function oX(e){return e instanceof Gd?e:new Gd(e)}function sX(...e){const t=new Gd;for(const n of e)for(const i of n)t.add(i);return t}const S2="intersect",Dk="union",aX="vlMulti",uX="vlPoint",Nk="or",lX="and",Li="_vgsid_",Mc=yn(Li),cX="E",fX="R",dX="R-E",hX="R-LE",gX="R-RE",eg="index:unit";function Ok(e,t){for(var n=t.fields,i=t.values,r=n.length,o=0,s,a;o<r;++o)if(a=n[o],a.getter=yn.getter||yn(a.field),s=a.getter(e),wo(s)&&(s=Dt(s)),wo(i[o])&&(i[o]=Dt(i[o])),wo(i[o][0])&&(i[o]=i[o].map(Dt)),a.type===cX){if(z(i[o])?i[o].indexOf(s)<0:s!==i[o])return!1}else if(a.type===fX){if(!za(s,i[o]))return!1}else if(a.type===gX){if(!za(s,i[o],!0,!1))return!1}else if(a.type===dX){if(!za(s,i[o],!1,!1))return!1}else if(a.type===hX&&!za(s,i[o],!1,!0))return!1;return!0}function pX(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],o=i?i[eg]&&i[eg].value:void 0,s=n===S2,a=r.length,u=0,l,c,f,d,h;u<a;++u)if(l=r[u],o&&s){if(c=c||{},f=c[d=l.unit]||0,f===-1)continue;if(h=Ok(t,l),c[d]=h?-1:++f,h&&o.size===1)return!0;if(!h&&f===o.get(d).count)return!1}else if(h=Ok(t,l),s^h)return h;return a&&s}const zD=nX(Mc),mX=zD.left,yX=zD.right;function bX(e,t,n){const i=this.context.data[e],r=i?i.values.value:[],o=i?i[eg]&&i[eg].value:void 0,s=n===S2,a=Mc(t),u=mX(r,a);if(u===r.length||Mc(r[u])!==a)return!1;if(o&&s){if(o.size===1)return!0;if(yX(r,a)-u<o.size)return!1}return!0}function xX(e,t){return e.map(n=>ae(t.fields?{values:t.fields.map(i=>(i.getter||(i.getter=yn(i.field)))(n.datum))}:{[Li]:Mc(n.datum)},t))}function vX(e,t,n,i){for(var r=this.context.data[e],o=r?r.values.value:[],s={},a={},u={},l,c,f,d,h,g,p,m,y,b,x=o.length,v=0,w,S;v<x;++v)if(l=o[v],d=l.unit,c=l.fields,f=l.values,c&&f){for(w=0,S=c.length;w<S;++w)h=c[w],p=s[h.field]||(s[h.field]={}),m=p[d]||(p[d]=[]),u[h.field]=y=h.type.charAt(0),b=S0[`${y}_union`],p[d]=b(m,H(f[w]));n&&(m=a[d]||(a[d]=[]),m.push(H(f).reduce((_,E,A)=>(_[c[A].field]=E,_),{})))}else h=Li,g=Mc(l),p=s[h]||(s[h]={}),m=p[d]||(p[d]=[]),m.push(g),n&&(m=a[d]||(a[d]=[]),m.push({[Li]:g}));if(t=t||Dk,s[Li]?s[Li]=S0[`${Li}_${t}`](...Object.values(s[Li])):Object.keys(s).forEach(_=>{s[_]=Object.keys(s[_]).map(E=>s[_][E]).reduce((E,A)=>E===void 0?A:S0[`${u[_]}_${t}`](E,A))}),o=Object.keys(a),n&&o.length){const _=i?uX:aX;s[_]=t===Dk?{[Nk]:o.reduce((E,A)=>(E.push(...a[A]),E),[])}:{[lX]:o.map(E=>({[Nk]:a[E]}))}}return s}var S0={[`${Li}_union`]:sX,[`${Li}_intersect`]:rX,E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Dt(t[0]),i=Dt(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=Dt(t[0]),i=Dt(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const wX=":",_X="@";function E2(e,t,n,i){t[0].type!==qs&&R("First argument to selection functions must be a string literal.");const r=t[0].value,o=t.length>=2&&ye(t).value,s="unit",a=_X+s,u=wX+r;o===S2&&!ne(i,a)&&(i[a]=n.getData(r).indataRef(n,s)),ne(i,u)||(i[u]=n.getData(r).tuplesRef())}function PD(e){const t=this.context.data[e];return t?t.values.value:[]}function SX(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function EX(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(Gn).insert(t)),1}function kX(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const yf=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},$X=yf("format"),LD=yf("timeFormat"),AX=yf("utcFormat"),CX=yf("timeParse"),MX=yf("utcParse"),od=new Date(2e3,0,1);function kp(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(od.setYear(2e3),od.setMonth(e),od.setDate(t),LD.call(this,od,n))}function FX(e){return kp.call(this,e,1,"%B")}function TX(e){return kp.call(this,e,1,"%b")}function DX(e){return kp.call(this,0,2+e,"%A")}function NX(e){return kp.call(this,0,2+e,"%a")}const OX=":",RX="@",yy="%",ID="$";function k2(e,t,n,i){t[0].type!==qs&&R("First argument to data functions must be a string literal.");const r=t[0].value,o=OX+r;if(!ne(o,i))try{i[o]=n.getData(r).tuplesRef()}catch{}}function zX(e,t,n,i){t[0].type!==qs&&R("First argument to indata must be a string literal."),t[1].type!==qs&&R("Second argument to indata must be a string literal.");const r=t[0].value,o=t[1].value,s=RX+o;ne(s,i)||(i[s]=n.getData(r).indataRef(n,o))}function hn(e,t,n,i){if(t[0].type===qs)Rk(n,i,t[0].value);else for(e in n.scales)Rk(n,i,e)}function Rk(e,t,n){const i=yy+n;if(!ne(t,i))try{t[i]=e.scaleRef(n)}catch{}}function Hr(e,t){if(ue(e))return e;if(Y(e)){const n=t.scales[e];return n&&UL(n.value)?n.value:void 0}}function PX(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=hn,n._range=hn,n._scale=hn;const i=r=>"_["+(r.type===qs?j(yy+r.value):j(yy)+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}function $2(e,t){return function(n,i,r){if(n){const o=Hr(n,(r||this).context);return o&&o.path[e](i)}else return t(i)}}const LX=$2("area",nq),IX=$2("bounds",sq),BX=$2("centroid",dq);function jX(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function A2(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function UX(){return A2(this.context.dataflow,"warn",arguments)}function qX(){return A2(this.context.dataflow,"info",arguments)}function WX(){return A2(this.context.dataflow,"debug",arguments)}function E0(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function by(e){const t=Fo(e),n=E0(t.r),i=E0(t.g),r=E0(t.b);return .2126*n+.7152*i+.0722*r}function HX(e,t){const n=by(e),i=by(t),r=Math.max(n,i),o=Math.min(n,i);return(r+.05)/(o+.05)}function GX(){const e=[].slice.call(arguments);return e.unshift({}),ae(...e)}function BD(e,t){return e===t||e!==e&&t!==t?!0:z(e)?z(t)&&e.length===t.length?YX(e,t):!1:V(e)&&V(t)?jD(e,t):!1}function YX(e,t){for(let n=0,i=e.length;n<i;++n)if(!BD(e[n],t[n]))return!1;return!0}function jD(e,t){for(const n in e)if(!BD(e[n],t[n]))return!1;return!0}function zk(e){return t=>jD(e,t)}function VX(e,t,n,i,r,o){const s=this.context.dataflow,a=this.context.data[e],u=a.input,l=s.stamp();let c=a.changes,f,d;if(s._trigger===!1||!(u.value.length||t||i))return 0;if((!c||c.stamp<l)&&(a.changes=c=s.changeset(),c.stamp=l,s.runAfter(()=>{a.modified=!0,s.pulse(u,c).run()},!0,1)),n&&(f=n===!0?Gn:z(n)||Og(n)?n:zk(n),c.remove(f)),t&&c.insert(t),i&&(f=zk(i),u.value.some(f)?c.remove(f):c.insert(i)),r)for(d in o)c.modify(r,d,o[d]);return 1}function XX(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.hypot(n,i)}function KX(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const Pk={};function JX(e,t){const n=Pk[t]||(Pk[t]=yn(t));return z(e)?e.map(n):n(e)}function C2(e){return z(e)||ArrayBuffer.isView(e)?e:null}function M2(e){return C2(e)||(Y(e)?e:null)}function QX(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return C2(e).join(...n)}function ZX(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return M2(e).indexOf(...n)}function eK(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return M2(e).lastIndexOf(...n)}function tK(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return M2(e).slice(...n)}function nK(e,t,n){return ue(n)&&R("Function argument passed to replace."),String(e).replace(t,n)}function iK(e){return C2(e).slice().reverse()}function rK(e,t,n){return Lx(e||0,t||0,n||0)}function oK(e,t){const n=Hr(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function sK(e,t){const n=Hr(e,(t||this).context);return n?n.copy():void 0}function aK(e,t){const n=Hr(e,(t||this).context);return n?n.domain():[]}function uK(e,t,n){const i=Hr(e,(n||this).context);return i?z(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function lK(e,t){const n=Hr(e,(t||this).context);return n&&n.range?n.range():[]}function cK(e,t,n){const i=Hr(e,(n||this).context);return i?i(t):void 0}function fK(e,t,n,i,r){e=Hr(e,(r||this).context);const o=I3(t,n);let s=e.domain(),a=s[0],u=ye(s),l=It;return u-a?l=A3(e,a,u):e=(e.interpolator?we("sequential")().interpolator(e.interpolator()):we("linear")().interpolate(e.interpolate()).range(e.range())).domain([a=0,u=1]),e.ticks&&(s=e.ticks(+i||15),a!==s[0]&&s.unshift(a),u!==ye(s)&&s.push(u)),s.forEach(c=>o.stop(l(c),e(c))),o}function dK(e,t,n){const i=Hr(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function hK(e){let t=null;return function(n){return n?xc(n,t=t||cu(e)):e}}const UD=e=>e.data;function qD(e,t){const n=PD.call(t,e);return n.root&&n.root.lookup||{}}function gK(e,t,n){const i=qD(e,this),r=i[t],o=i[n];return r&&o?r.path(o).map(UD):void 0}function pK(e,t){const n=qD(e,this)[t];return n?n.ancestors().map(UD):void 0}const WD=()=>typeof window<"u"&&window||null;function mK(){const e=WD();return e?e.screen:{}}function yK(){const e=WD();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function bK(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function HD(e,t,n){if(!e)return[];const[i,r]=e,o=new Ke().set(i[0],i[1],r[0],r[1]),s=n||this.context.dataflow.scenegraph().root;return M5(s,o,xK(t))}function xK(e){let t=null;if(e){const n=H(e.marktype),i=H(e.markname);t=r=>(!n.length||n.some(o=>r.marktype===o))&&(!i.length||i.some(o=>r.name===o))}return t}function vK(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;e=H(e);const r=e[e.length-1];return r===void 0||Math.hypot(r[0]-t,r[1]-n)>i?[...e,[t,n]]:e}function wK(e){return H(e).reduce((t,n,i)=>{let[r,o]=n;return t+=i==0?`M ${r},${o} `:i===e.length-1?" Z":`L ${r},${o} `},"")}function _K(e,t,n){const{x:i,y:r,mark:o}=n,s=new Ke().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[u,l]of t)u<s.x1&&(s.x1=u),u>s.x2&&(s.x2=u),l<s.y1&&(s.y1=l),l>s.y2&&(s.y2=l);return s.translate(i,r),HD([[s.x1,s.y1],[s.x2,s.y2]],e,o).filter(u=>SK(u.x,u.y,t))}function SK(e,t,n){let i=0;for(let r=0,o=n.length-1;r<n.length;o=r++){const[s,a]=n[o],[u,l]=n[r];l>t!=a>t&&e<(s-u)*(t-l)/(a-l)+u&&i++}return i&1}const Fc={random(){return Vn()},cumulativeNormal:Ig,cumulativeLogNormal:zb,cumulativeUniform:Bb,densityNormal:Tb,densityLogNormal:Rb,densityUniform:Ib,quantileNormal:Bg,quantileLogNormal:Pb,quantileUniform:jb,sampleNormal:Lg,sampleLogNormal:Ob,sampleUniform:Lb,isArray:z,isBoolean:ia,isDate:wo,isDefined(e){return e!==void 0},isNumber:Ae,isObject:V,isRegExp:oC,isString:Y,isTuple:Og,isValid(e){return e!=null&&e===e},toBoolean:fb,toDate(e){return db(e)},toNumber:Dt,toString:hb,indexof:ZX,join:QX,lastindexof:eK,replace:nK,reverse:iK,slice:tK,flush:iC,lerp:sC,merge:GX,pad:lC,peek:ye,pluck:JX,span:Uc,inrange:za,truncate:cC,rgb:Fo,lab:sh,hcl:ah,hsl:rh,luminance:by,contrast:HX,sequence:Tn,format:$X,utcFormat:AX,utcParse:MX,utcOffset:UC,utcSequence:HC,timeFormat:LD,timeParse:CX,timeOffset:jC,timeSequence:WC,timeUnitSpecifier:FC,monthFormat:FX,monthAbbrevFormat:TX,dayFormat:DX,dayAbbrevFormat:NX,quarter:ZA,utcquarter:eC,week:DC,utcweek:RC,dayofyear:TC,utcdayofyear:OC,warn:UX,info:qX,debug:WX,extent(e){return Ki(e)},inScope:jX,intersect:HD,clampRange:tC,pinchDistance:XX,pinchAngle:KX,screen:mK,containerSize:bK,windowSize:yK,bandspace:rK,setdata:EX,pathShape:hK,panLinear:XA,panLog:KA,panPow:JA,panSymlog:QA,zoomLinear:ob,zoomLog:sb,zoomPow:Wd,zoomSymlog:ab,encode:kX,modify:VX,lassoAppend:vK,lassoPath:wK,intersectLasso:_K},EK=["view","item","group","xy","x","y"],kK="event.vega.",GD="this.",F2={},YD={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${j(ID+e)}]`,functions:$K,constants:ND,visitors:F2},xy=RD(YD);function $K(e){const t=OD(e);EK.forEach(n=>t[n]=kK+n);for(const n in Fc)t[n]=GD+n;return ae(t,PX(e,Fc,F2)),t}function Je(e,t,n){return arguments.length===1?Fc[e]:(Fc[e]=t,n&&(F2[e]=n),xy&&(xy.functions[e]=GD+e),this)}Je("bandwidth",oK,hn);Je("copy",sK,hn);Je("domain",aK,hn);Je("range",lK,hn);Je("invert",uK,hn);Je("scale",cK,hn);Je("gradient",fK,hn);Je("geoArea",LX,hn);Je("geoBounds",IX,hn);Je("geoCentroid",BX,hn);Je("geoShape",dK,hn);Je("indata",SX,zX);Je("data",PD,k2);Je("treePath",gK,k2);Je("treeAncestors",pK,k2);Je("vlSelectionTest",pX,E2);Je("vlSelectionIdTest",bX,E2);Je("vlSelectionResolve",vX,E2);Je("vlSelectionTuples",xX);function tr(e,t){const n={};let i;try{e=Y(e)?e:j(e)+"",i=_2(e)}catch{R("Expression parse error: "+e)}i.visit(o=>{if(o.type!==$D)return;const s=o.callee.name,a=YD.visitors[s];a&&a(s,o.arguments,t,n)});const r=xy(i);return r.globals.forEach(o=>{const s=ID+o;!ne(n,s)&&t.getSignal(o)&&(n[s]=t.signalRef(o))}),{$expr:ae({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function AK(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const CK=vi(["rule"]),Lk=vi(["group","image","rect"]);function MK(e,t){let n="";return CK[t]||(e.x2&&(e.x?(Lk[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(Lk[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function T2(e){return(e+"").toLowerCase()}function FK(e){return T2(e)==="operator"}function TK(e){return T2(e)==="collect"}function ml(e,t,n){n.endsWith(";")||(n="return("+n+");");const i=Function(...t.concat(n));return e&&e.functions?i.bind(e.functions):i}function DK(e,t,n,i){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${i} : `}var NK={operator:(e,t)=>ml(e,["_"],t.code),parameter:(e,t)=>ml(e,["datum","_"],t.code),event:(e,t)=>ml(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return ml(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const o in i){const s="o["+j(o)+"]";r+=`$=${i[o].code};if(${s}!==$)${s}=$,m=1;`}return r+=MK(i,n),r+="return m;",ml(e,["item","_"],r)},codegen:{get(e){const t=`[${e.map(j).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const i=(o,s)=>{const a=t[s];let u,l;return o.path?(u=`a${o.path}`,l=`b${o.path}`):((n=n||{})["f"+s]=o,u=`this.f${s}(a)`,l=`this.f${s}(b)`),DK(u,l,-a,a)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function OK(e){const t=this;FK(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function RK(e){const t=this;if(e.params){const n=t.get(e.id);n||R("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function zK(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=z(r)?r.map(o=>Ik(o,n,t)):Ik(r,n,t)}return t}function Ik(e,t,n){if(!e||!V(e))return e;for(let i=0,r=Bk.length,o;i<r;++i)if(o=Bk[i],ne(e,o.key))return o.parse(e,t,n);return e}var Bk=[{key:"$ref",parse:PK},{key:"$key",parse:IK},{key:"$expr",parse:LK},{key:"$field",parse:BK},{key:"$encode",parse:UK},{key:"$compare",parse:jK},{key:"$context",parse:qK},{key:"$subflow",parse:WK},{key:"$tupleid",parse:HK}];function PK(e,t){return t.get(e.$ref)||R("Operator not defined: "+e.$ref)}function LK(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code;return t.fn[i]||(t.fn[i]=En(t.parameterExpression(e.$expr),e.$fields))}function IK(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=cb(e.$key,e.$flat,t.expr.codegen))}function BK(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=yn(e.$field,e.$name,t.expr.codegen))}function jK(e,t){const n="c:"+e.$compare+"_"+e.$order,i=H(e.$compare).map(r=>r&&r.$tupleid?ee:r);return t.fn[n]||(t.fn[n]=ub(i,e.$order,t.expr.codegen))}function UK(e,t){const n=e.$encode,i={};for(const r in n){const o=n[r];i[r]=En(t.encodeExpression(o.$expr),o.$fields),i[r].output=o.$output}return i}function qK(e,t){return t}function WK(e,t){const n=e.$subflow;return function(i,r,o){const s=t.fork().parse(n),a=s.get(n.operators[0].id),u=s.signals.parent;return u&&u.set(o),a.detachSubflow=()=>t.detach(s),a}}function HK(){return ee}function GK(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(o=>t.get(o)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(o=>t.get(o)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&R("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function YK(e){var t=this,n=V(n=e.source)?n.$ref:n,i=t.get(n),r=null,o=e.update,s=void 0;i||R("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),o&&o.$expr&&(o.$params&&(s=t.parseParameters(o.$params)),o=t.handlerExpression(o.$expr)),t.update(e,i,r,o,s)}const VK={skip:!0};function XK(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(o=>{const s=t.signals[o];e.signals(o,s)&&(i[o]=s.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(o=>{const s=t.data[o];e.data(o,s)&&(r[o]=s.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(o=>o.getState(e))),n}function KK(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(o=>{n.update(t.signals[o],r[o],VK)}),Object.keys(i||{}).forEach(o=>{n.pulse(t.data[o].input,n.changeset().remove(Gn).insert(i[o]))}),(e.subcontext||[]).forEach((o,s)=>{const a=t.subcontext[s];a&&a.setState(o)})}function VD(e,t,n,i){return new XD(e,t,n,i)}function XD(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||NK,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function jk(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}XD.prototype=jk.prototype={fork(){const e=new jk(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),TK(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){let o=n.get(e.parent.$ref);o?(i.connect(o,[t]),t.targets().add(o)):(n.unresolved=n.unresolved||[]).push(()=>{o=n.get(e.parent.$ref),i.connect(o,[t]),t.targets().add(o)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const o in e.data){const s=n.data[o]||(n.data[o]={});e.data[o].forEach(a=>s[a]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[T2(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:AK,parseOperator:OK,parseOperatorParameters:RK,parseParameters:zK,parseStream:GK,parseUpdate:YK,getState:XK,setState:KK};function JK(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),KD(t,e.description()))}function KD(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function QK(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const k0="default";function ZK(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:k0,item:null}));e.on(e.events("view","mousemove"),t,(n,i)=>{const r=t.value,o=r?Y(r)?r:r.user:k0,s=i.item&&i.item.cursor||null;return r&&o===r.user&&s==r.item?r:{user:o,item:s}}),e.add(null,function(n){let i=n.cursor,r=this.value;return Y(i)||(r=i.item,i=i.user),vy(e,i&&i!==k0?i:r||i),r},{cursor:t})}function vy(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function tg(e,t){var n=e._runtime.data;return ne(n,t)||R("Unrecognized data set: "+t),n[t]}function eJ(e,t){return arguments.length<2?tg(this,e).values.value:$p.call(this,e,aa().remove(Gn).insert(t))}function $p(e,t){bM(t)||R("Second argument to changes must be a changeset.");const n=tg(this,e);return n.modified=!0,this.pulse(n.input,t)}function tJ(e,t){return $p.call(this,e,aa().insert(t))}function nJ(e,t){return $p.call(this,e,aa().remove(t))}function JD(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function QD(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Ap(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function iJ(e){var t=Ap(e),n=JD(e),i=QD(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(r=>{try{r(n,i)}catch(o){e.error(o)}})}function rJ(e,t,n){var i=e._renderer,r=i&&i.canvas(),o,s,a;return r&&(a=Ap(e),s=t.changedTouches?t.changedTouches[0]:t,o=hp(s,r),o[0]-=a[0],o[1]-=a[1]),t.dataflow=e,t.item=n,t.vega=oJ(e,n,o),t}function oJ(e,t,n){const i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(s){var a=i,u;if(s){for(u=t;u;u=u.mark.group)if(u.mark.name===s){a=u;break}}return a&&a.mark&&a.mark.interactive?a:{}}function o(s){if(!s)return n;Y(s)&&(s=r(s));const a=n.slice();for(;s;)a[0]-=s.x||0,a[1]-=s.y||0,s=s.mark&&s.mark.group;return a}return{view:Bt(e),item:Bt(t||{}),group:r,xy:o,x:s=>o(s)[0],y:s=>o(s)[1]}}const Uk="view",sJ="timer",aJ="window",uJ={trap:!1};function lJ(e){const t=ae({defaults:{}},e),n=(i,r)=>{r.forEach(o=>{z(i[o])&&(i[o]=vi(i[o]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function ZD(e,t,n,i){e._eventListeners.push({type:n,sources:H(t),handler:i})}function cJ(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function sd(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||V(i)&&!i[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function fJ(e,t,n){var i=this,r=new Pg(n),o=function(l,c){i.runAsync(null,()=>{e===Uk&&cJ(i,t)&&l.preventDefault(),r.receive(rJ(i,l,c))})},s;if(e===sJ)sd(i,"timer",t)&&i.timer(o,t);else if(e===Uk)sd(i,"view",t)&&i.addEventListener(t,o,uJ);else if(e===aJ?sd(i,"window",t)&&typeof window<"u"&&(s=[window]):typeof document<"u"&&sd(i,"selector",t)&&(s=Array.from(document.querySelectorAll(e))),!s)i.warn("Can not resolve event source: "+e);else{for(var a=0,u=s.length;a<u;++a)s[a].addEventListener(t,o);ZD(i,s,t,o)}return r}function qk(e){return e.item}function Wk(e){return e.item.mark.source}function Hk(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function dJ(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",qk),Wk,Hk(e)),this.on(this.events("view","mouseout",qk),Wk,Hk(t)),this}function hJ(){var e=this._tooltip,t=this._timers,n=this._eventListeners,i,r,o;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(o=n[i],r=o.sources.length;--r>=0;)o.sources[r].removeEventListener(o.type,o.handler);return e&&e.call(this,this._handler,null,null,null),this}function Dn(e,t,n){const i=document.createElement(e);for(const r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const gJ="vega-bind",pJ="vega-bind-name",mJ="vega-bind-radio";function yJ(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:s=>{s!=e.signal(i.signal)&&e.runAsync(null,()=>{r.source=!0,e.signal(i.signal,s)})}},i.debounce&&(r.update=lb(i.debounce,r.update))),(i.input==null&&i.element?bJ:vJ)(r,t,i,e),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function bJ(e,t,n,i){const r=n.event||"input",o=()=>e.update(t.value);i.signal(n.signal,t.value),t.addEventListener(r,o),ZD(i,t,r,o),e.set=s=>{t.value=s,t.dispatchEvent(xJ(r))}}function xJ(e){return typeof Event<"u"?new Event(e):{type:e}}function vJ(e,t,n,i){const r=i.signal(n.signal),o=Dn("div",{class:gJ}),s=n.input==="radio"?o:o.appendChild(Dn("label"));s.appendChild(Dn("span",{class:pJ},n.name||n.signal)),t.appendChild(o);let a=wJ;switch(n.input){case"checkbox":a=_J;break;case"select":a=SJ;break;case"radio":a=EJ;break;case"range":a=kJ;break}a(e,s,n,r)}function wJ(e,t,n,i){const r=Dn("input");for(const o in n)o!=="signal"&&o!=="element"&&r.setAttribute(o==="input"?"type":o,n[o]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=o=>r.value=o}function _J(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const o=Dn("input",r);t.appendChild(o),o.addEventListener("change",()=>e.update(o.checked)),e.elements=[o],e.set=s=>o.checked=!!s||null}function SJ(e,t,n,i){const r=Dn("select",{name:n.signal}),o=n.labels||[];n.options.forEach((s,a)=>{const u={value:s};ng(s,i)&&(u.selected=!0),r.appendChild(Dn("option",u,(o[a]||s)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=s=>{for(let a=0,u=n.options.length;a<u;++a)if(ng(n.options[a],s)){r.selectedIndex=a;return}}}function EJ(e,t,n,i){const r=Dn("span",{class:mJ}),o=n.labels||[];t.appendChild(r),e.elements=n.options.map((s,a)=>{const u={type:"radio",name:n.signal,value:s};ng(s,i)&&(u.checked=!0);const l=Dn("input",u);l.addEventListener("change",()=>e.update(s));const c=Dn("label",{},(o[a]||s)+"");return c.prepend(l),r.appendChild(c),l}),e.set=s=>{const a=e.elements,u=a.length;for(let l=0;l<u;++l)ng(a[l].value,s)&&(a[l].checked=!0)}}function kJ(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,o=n.min||Math.min(0,r,+i)||0,s=n.step||Ao(o,r,100),a=Dn("input",{type:"range",name:n.signal,min:o,max:r,step:s});a.value=i;const u=Dn("span",{},+i);t.appendChild(a),t.appendChild(u);const l=()=>{u.textContent=a.value,e.update(+a.value)};a.addEventListener("input",l),a.addEventListener("change",l),e.elements=[a],e.set=c=>{a.value=c,u.textContent=c}}function ng(e,t){return e===t||e+""==t+""}function eN(e,t,n,i,r,o){return t=t||new i(e.loader()),t.initialize(n,JD(e),QD(e),Ap(e),r,o).background(e.background())}function D2(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function $J(e,t,n,i){const r=new i(e.loader(),D2(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Ap(e),e);return t&&t.handlers().forEach(o=>{r.on(o.type,o.handler)}),r}function AJ(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,o=gp(i);e=n._el=e?$0(n,e,!0):null,JK(n),o||n.error("Unrecognized renderer type: "+i);const s=o.handler||lf,a=e?o.renderer:o.headless;return n._renderer=a?eN(n,n._renderer,e,a):null,n._handler=$J(n,n._handler,e,s),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=$0(n,t,!0):e.appendChild(Dn("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&r!=="container"&&(u.element=$0(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{yJ(n,u.element||t,u)})),n}function $0(e,t,n){if(typeof t=="string")if(typeof document<"u"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.textContent=""}catch(i){t=null,e.error(i)}return t}const yl=e=>+e||0,CJ=e=>({top:e,bottom:e,left:e,right:e});function Gk(e){return V(e)?{top:yl(e.top),bottom:yl(e.bottom),left:yl(e.left),right:yl(e.right)}:CJ(yl(e))}async function N2(e,t,n,i){const r=gp(t),o=r&&r.headless;return o||R("Unrecognized renderer type: "+t),await e.runAsync(),eN(e,null,null,o,n,i).renderAsync(e._scenegraph.root)}async function MJ(e,t){e!==po.Canvas&&e!==po.SVG&&e!==po.PNG&&R("Unrecognized image type: "+e);const n=await N2(this,e,t);return e===po.SVG?FJ(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function FJ(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function TJ(e,t){return(await N2(this,po.Canvas,e,t)).canvas()}async function DJ(e){return(await N2(this,po.SVG,e)).svg()}function NJ(e,t,n){return VD(e,iu,Fc,n).parse(t)}function OJ(e){var t=this._runtime.scales;return ne(t,e)||R("Unrecognized scale or projection: "+e),t[e].value}var tN="width",nN="height",O2="padding",Yk={skip:!0};function iN(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===O2?i.left+i.right:0)}function rN(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===O2?i.top+i.bottom:0)}function RJ(e){var t=e._signals,n=t[tN],i=t[nN],r=t[O2];function o(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,a=>{e._width=a.size,e._viewWidth=iN(e,a.size),o()},{size:n}),e._resizeHeight=e.add(null,a=>{e._height=a.size,e._viewHeight=rN(e,a.size),o()},{size:i});const s=e.add(null,o,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,s.rank=r.rank+1}function zJ(e,t,n,i,r,o){this.runAfter(s=>{let a=0;s._autosize=0,s.width()!==n&&(a=1,s.signal(tN,n,Yk),s._resizeWidth.skip(!0)),s.height()!==i&&(a=1,s.signal(nN,i,Yk),s._resizeHeight.skip(!0)),s._viewWidth!==e&&(s._resize=1,s._viewWidth=e),s._viewHeight!==t&&(s._resize=1,s._viewHeight=t),(s._origin[0]!==r[0]||s._origin[1]!==r[1])&&(s._resize=1,s._origin=r),a&&s.run("enter"),o&&s.runAfter(u=>u.resize())},!1,1)}function PJ(e){return this._runtime.getState(e||{data:LJ,signals:IJ,recurse:!0})}function LJ(e,t){return t.modified&&z(t.input.value)&&e.indexOf("_:vega:_")}function IJ(e,t){return!(e==="parent"||t instanceof iu.proxy)}function BJ(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function jJ(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(gH(n,t))}function UJ(e,t,n,i){const r=e.element();r&&r.setAttribute("title",qJ(i))}function qJ(e){return e==null?"":z(e)?oN(e):V(e)&&!wo(e)?WJ(e):e+""}function WJ(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(z(n)?oN(n):sN(n))}).join(`
`)}function oN(e){return"["+e.map(sN).join(", ")+"]"}function sN(e){return z(e)?"[…]":V(e)&&!wo(e)?"{…}":e}function aN(e,t){const n=this;if(t=t||{},Ua.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const o=ae({},e.locale,t.locale);n.locale(uM(o.number,o.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||po.Canvas,n._scenegraph=new gv;const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||UJ,n._redraw=!0,n._handler=new lf().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=lJ(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=NJ(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(o=>({state:null,param:ae({},o)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=iN(n,n._width),n._viewHeight=rN(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,RJ(n),QK(n),ZK(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function ad(e,t){return ne(e._signals,t)?e._signals[t]:R("Unrecognized signal name: "+j(t))}function uN(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function Vk(e,t,n,i){let r=uN(n,i);return r||(r=D2(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function Xk(e,t,n){const i=uN(t,n);return i&&t._targets.remove(i),e}U(aN,Ua,{async evaluate(e,t,n){if(await Ua.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,iJ(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&bd(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&KD(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const i=ad(this,e);return arguments.length===1?i.value:this.update(i,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",Gk(e)):Gk(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(gp(e)||R("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Ua.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(ad(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:zJ,addEventListener(e,t,n){let i=t;return n&&n.trap===!1||(i=D2(this,t),i.raw=t),this._handler.on(e,i),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),i=n.length,r,o;--i>=0;)if(o=n[i].type,r=n[i].handler,e===o&&(t===r||t===r.raw)){this._handler.off(o,r);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return Vk(this,e,ad(this,e),t)},removeSignalListener(e,t){return Xk(this,ad(this,e),t)},addDataListener(e,t){return Vk(this,e,tg(this,e).values,t)},removeDataListener(e,t){return Xk(this,tg(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=vy(this,null);this._globalCursor=!!e,t&&vy(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:jJ,events:fJ,finalize:hJ,hover:dJ,data:eJ,change:$p,insert:tJ,remove:nJ,scale:OJ,initialize:AJ,toImageURL:MJ,toCanvas:TJ,toSVG:DJ,getState:PJ,setState:BJ});const HJ="view",ig="[",rg="]",lN="{",cN="}",GJ=":",fN=",",YJ="@",VJ=">",XJ=/[[\]{}]/,KJ={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let dN,hN;function Vo(e,t,n){return dN=t||HJ,hN=n||KJ,gN(e.trim()).map(wy)}function JJ(e){return hN[e]}function rc(e,t,n,i,r){const o=e.length;let s=0,a;for(;t<o;++t){if(a=e[t],!s&&a===n)return t;r&&r.indexOf(a)>=0?--s:i&&i.indexOf(a)>=0&&++s}return t}function gN(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=rc(e,r,fN,ig+lN,rg+cN),t.push(e.substring(i,r).trim()),i=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function wy(e){return e[0]==="["?QJ(e):ZJ(e)}function QJ(e){const t=e.length;let n=1,i;if(n=rc(e,n,rg,ig,rg),n===t)throw"Empty between selector: "+e;if(i=gN(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==VJ)throw"Expected '>' after between selector: "+e;i=i.map(wy);const r=wy(e.slice(1).trim());return r.between?{between:i,stream:r}:(r.between=i,r)}function ZJ(e){const t={source:dN},n=[];let i=[0,0],r=0,o=0,s=e.length,a=0,u,l;if(e[s-1]===cN){if(a=e.lastIndexOf(lN),a>=0){try{i=eQ(e.substring(a+1,s-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),s=e.length}else throw"Unmatched right brace: "+e;a=0}if(!s)throw e;if(e[0]===YJ&&(r=++a),u=rc(e,a,GJ),u<s&&(n.push(e.substring(o,u).trim()),o=a=++u),a=rc(e,a,ig),a===s)n.push(e.substring(o,s).trim());else if(n.push(e.substring(o,a).trim()),l=[],o=++a,o===s)throw"Unmatched left bracket: "+e;for(;a<s;){if(a=rc(e,a,rg),a===s)throw"Unmatched left bracket: "+e;if(l.push(e.substring(o,a).trim()),a<s-1&&e[++a]!==ig)throw"Expected left bracket: "+e;o=++a}if(!(s=n.length)||XJ.test(n[s-1]))throw"Invalid event selector: "+e;return s>1?(t.type=n[1],r?t.markname=n[0].slice(1):JJ(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function eQ(e){const t=e.split(fN);if(!e.length||t.length>2)throw e;return t.map(n=>{const i=+n;if(i!==i)throw e;return i})}function tQ(e){return V(e)?e:{type:e||"pad"}}const bl=e=>+e||0,nQ=e=>({top:e,bottom:e,left:e,right:e});function iQ(e){return V(e)?e.signal?e:{top:bl(e.top),bottom:bl(e.bottom),left:bl(e.left),right:bl(e.right)}:nQ(bl(e))}const ct=e=>V(e)&&!z(e)?ae({},e):{value:e};function Kk(e,t,n,i){return n!=null?(V(n)&&!z(n)||z(n)&&n.length&&V(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function _t(e,t,n){for(const i in t)Kk(e,i,t[i]);for(const i in n)Kk(e,i,n[i],"update")}function Hu(e,t,n){for(const i in t)n&&ne(n,i)||(e[i]=ae(e[i]||{},t[i]));return e}function Oa(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const R2="mark",z2="frame",P2="scope",rQ="axis",oQ="axis-domain",sQ="axis-grid",aQ="axis-label",uQ="axis-tick",lQ="axis-title",cQ="legend",fQ="legend-band",dQ="legend-entry",hQ="legend-gradient",pN="legend-label",gQ="legend-symbol",pQ="legend-title",mQ="title",yQ="title-text",bQ="title-subtitle";function xQ(e,t,n,i,r){const o={},s={};let a,u,l,c;u="lineBreak",t==="text"&&r[u]!=null&&!Oa(u,e)&&A0(o,u,r[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===z2?r.group:n===R2?ae({},r.mark,r[t]):null;for(u in c)l=Oa(u,e)||(u==="fill"||u==="stroke")&&(Oa("fill",e)||Oa("stroke",e)),l||A0(o,u,c[u]);H(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)Oa(h,e)||A0(o,h,d[h])}),e=ae({},e);for(u in o)c=o[u],c.signal?(a=a||{})[u]=c:s[u]=c;return e.enter=ae(s,e.enter),a&&(e.update=ae(a,e.update)),e}function A0(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const mN=e=>Y(e)?j(e):e.signal?`(${e.signal})`:yN(e);function Cp(e){if(e.gradient!=null)return wQ(e);let t=e.signal?`(${e.signal})`:e.color?vQ(e.color):e.field!=null?yN(e.field):e.value!==void 0?j(e.value):void 0;return e.scale!=null&&(t=_Q(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${Rd(e.exponent)})`),e.mult!=null&&(t+=`*${Rd(e.mult)}`),e.offset!=null&&(t+=`+${Rd(e.offset)}`),e.round&&(t=`round(${t})`),t}const ud=(e,t,n,i)=>`(${e}(${[t,n,i].map(Cp).join(",")})+'')`;function vQ(e){return e.c?ud("hcl",e.h,e.c,e.l):e.h||e.s?ud("hsl",e.h,e.s,e.l):e.l||e.a?ud("lab",e.l,e.a,e.b):e.r||e.g||e.b?ud("rgb",e.r,e.g,e.b):null}function wQ(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:j(n));for(;t.length&&ye(t)==null;)t.pop();return t.unshift(mN(e.gradient)),`gradient(${t.join(",")})`}function Rd(e){return V(e)?"("+Cp(e)+")":e}function yN(e){return bN(V(e)?e:{datum:e})}function bN(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):R("Invalid field reference: "+j(e));return e.signal||(i=Y(i)?or(i).map(j).join("]["):bN(i)),t+"["+i+"]"}function _Q(e,t){const n=mN(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band==1?"":"*"+Rd(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function SQ(e){let t="";return e.forEach(n=>{const i=Cp(n);t+=n.test?`(${n.test})?${i}:`:i}),ye(t)===":"&&(t+="null"),t}function xN(e,t,n,i,r,o){const s={};o=o||{},o.encoders={$encode:s},e=xQ(e,t,n,i,r.config);for(const a in e)s[a]=EQ(e[a],t,o,r);return o}function EQ(e,t,n,i){const r={},o={};for(const s in e)e[s]!=null&&(r[s]=$Q(kQ(e[s]),i,n,o));return{$expr:{marktype:t,channels:r},$fields:Object.keys(o),$output:Object.keys(e)}}function kQ(e){return z(e)?SQ(e):Cp(e)}function $Q(e,t,n,i){const r=tr(e,t);return r.$fields.forEach(o=>i[o]=1),ae(n,r.$params),r.$expr}const AQ="outer",CQ=["value","update","init","react","bind"];function Jk(e,t){R(e+' for "outer" push: '+j(t))}function vN(e,t){const n=e.name;if(e.push===AQ)t.signals[n]||Jk("No prior signal definition",n),CQ.forEach(i=>{e[i]!==void 0&&Jk("Invalid property ",i)});else{const i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function _y(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function Mp(e,t,n,i){return new _y(e,t,n,i)}function og(e,t){return Mp("operator",e,t)}function Z(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Tc(e,t){return t?{$field:e,$name:t}:{$field:e}}const Sy=Tc("key");function Qk(e,t){return{$compare:e,$order:t}}function MQ(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const FQ="ascending",TQ="descending";function DQ(e){return V(e)?(e.order===TQ?"-":"+")+Fp(e.op,e.field):""}function Fp(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const L2="scope",Ey="view";function nt(e){return e&&e.signal}function NQ(e){return e&&e.expr}function zd(e){if(nt(e))return!0;if(V(e)){for(const t in e)if(zd(e[t]))return!0}return!1}function ri(e,t){return e??t}function Ds(e){return e&&e.signal||e}const Zk="timer";function Dc(e,t){return(e.merge?RQ:e.stream?zQ:e.type?PQ:R("Invalid stream specification: "+j(e)))(e,t)}function OQ(e){return e===L2?Ey:e||Ey}function RQ(e,t){const n=e.merge.map(r=>Dc(r,t)),i=I2({merge:n},e,t);return t.addStream(i).id}function zQ(e,t){const n=Dc(e.stream,t),i=I2({stream:n},e,t);return t.addStream(i).id}function PQ(e,t){let n;e.type===Zk?(n=t.event(Zk,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(OQ(e.source),e.type);const i=I2({stream:n},e,t);return Object.keys(i).length===1?n:t.addStream(i).id}function I2(e,t,n){let i=t.between;return i&&(i.length!==2&&R('Stream "between" parameter must have 2 entries: '+j(t)),e.between=[Dc(i[0],n),Dc(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(LQ(t.marktype,t.markname,t.markrole)),t.source===L2&&i.push("inScope(event.item)"),i.length&&(e.filter=tr("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function LQ(e,t,n){const i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}const IQ={code:"_.$value",ast:{type:"Identifier",value:"value"}};function BQ(e,t,n){const i=e.encode,r={target:n};let o=e.events,s=e.update,a=[];o||R("Signal update missing events specification."),Y(o)&&(o=Vo(o,t.isSubscope()?L2:Ey)),o=H(o).filter(u=>u.signal||u.scale?(a.push(u),0):1),a.length>1&&(a=[UQ(a)]),o.length&&a.push(o.length>1?{merge:o}:o[0]),i!=null&&(s&&R("Signal encode and update are mutually exclusive."),s="encode(item(),"+j(i)+")"),r.update=Y(s)?tr(s,t):s.expr!=null?tr(s.expr,t):s.value!=null?s.value:s.signal!=null?{$expr:IQ,$params:{$value:t.signalRef(s.signal)}}:R("Invalid signal update specification."),e.force&&(r.options={force:!0}),a.forEach(u=>t.addUpdate(ae(jQ(u,t),r)))}function jQ(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Dc(e,t)}}function UQ(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function qQ(e,t){const n=t.getSignal(e.name);let i=e.update;e.init&&(i?R("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=tr(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(r=>BQ(r,t,n.id))}const Fe=e=>(t,n,i)=>Mp(e,n,t||void 0,i),wN=Fe("aggregate"),WQ=Fe("axisticks"),_N=Fe("bound"),$i=Fe("collect"),e$=Fe("compare"),HQ=Fe("datajoin"),SN=Fe("encode"),GQ=Fe("expression"),YQ=Fe("facet"),VQ=Fe("field"),XQ=Fe("key"),KQ=Fe("legendentries"),JQ=Fe("load"),QQ=Fe("mark"),ZQ=Fe("multiextent"),eZ=Fe("multivalues"),tZ=Fe("overlap"),nZ=Fe("params"),EN=Fe("prefacet"),iZ=Fe("projection"),rZ=Fe("proxy"),oZ=Fe("relay"),kN=Fe("render"),sZ=Fe("scale"),fa=Fe("sieve"),aZ=Fe("sortitems"),$N=Fe("viewlayout"),uZ=Fe("values");let lZ=0;const AN={min:"min",max:"max",count:"sum"};function cZ(e,t){const n=e.type||"linear";w3(n)||R("Unrecognized scale type: "+j(n)),t.addScale(e.name,{type:n,domain:void 0})}function fZ(e,t){const n=t.getScale(e.name).params;let i;n.domain=CN(e.domain,e,t),e.range!=null&&(n.range=FN(e,t,n)),e.interpolate!=null&&wZ(e.interpolate,n),e.nice!=null&&(n.nice=vZ(e.nice)),e.bins!=null&&(n.bins=xZ(e.bins,t));for(i in e)ne(n,i)||i==="name"||(n[i]=Un(e[i],t))}function Un(e,t){return V(e)?e.signal?t.signalRef(e.signal):R("Unsupported object: "+j(e)):e}function Pd(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Un(n,t))}function Tp(e){R("Can not find data set: "+j(e))}function CN(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&R("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(z(e)?dZ:e.fields?gZ:hZ)(e,t,n)}function dZ(e,t,n){return e.map(i=>Un(i,n))}function hZ(e,t,n){const i=n.getData(e.data);return i||Tp(e.data),lu(t.type)?i.valuesRef(n,e.field,MN(e.sort,!1)):E3(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function gZ(e,t,n){const i=e.data,r=e.fields.reduce((o,s)=>(s=Y(s)?{data:i,field:s}:z(s)||s.signal?pZ(s,n):s,o.push(s),o),[]);return(lu(t.type)?mZ:E3(t.type)?yZ:bZ)(e,n,r)}function pZ(e,t){const n="_:vega:_"+lZ++,i=$i({});if(z(e))i.value={$ingest:e};else if(e.signal){const r="setdata("+j(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,fa({})]),{data:n,field:"data"}}function mZ(e,t,n){const i=MN(e.sort,!0);let r,o;const s=n.map(l=>{const c=t.getData(l.data);return c||Tp(l.data),c.countsRef(t,l.field,i)}),a={groupby:Sy,pulse:s};i&&(r=i.op||"count",o=i.field?Fp(r,i.field):"count",a.ops=[AN[r]],a.fields=[t.fieldRef(o)],a.as=[o]),r=t.add(wN(a));const u=t.add($i({pulse:Z(r)}));return o=t.add(uZ({field:Sy,sort:t.sortRef(i),pulse:Z(u)})),Z(o)}function MN(e,t){return e&&(!e.field&&!e.op?V(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?R("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!AN[e.op]&&R("Multiple domain scales can not be sorted using "+e.op)),e}function yZ(e,t,n){const i=n.map(r=>{const o=t.getData(r.data);return o||Tp(r.data),o.domainRef(t,r.field)});return Z(t.add(eZ({values:i})))}function bZ(e,t,n){const i=n.map(r=>{const o=t.getData(r.data);return o||Tp(r.data),o.extentRef(t,r.field)});return Z(t.add(ZQ({extents:i})))}function xZ(e,t){return e.signal||z(e)?Pd(e,t):t.objectProperty(e)}function vZ(e){return V(e)?{interval:Un(e.interval),step:Un(e.step)}:Un(e)}function wZ(e,t){t.interpolate=Un(e.type||e),e.gamma!=null&&(t.interpolateGamma=Un(e.gamma))}function FN(e,t,n){const i=t.config.range;let r=e.range;if(r.signal)return t.signalRef(r.signal);if(Y(r)){if(i&&ne(i,r))return e=ae({},e,{range:i[r]}),FN(e,t,n);r==="width"?r=[0,{signal:"width"}]:r==="height"?r=lu(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:R("Unrecognized scale range value: "+j(r))}else if(r.scheme){n.scheme=z(r.scheme)?Pd(r.scheme,t):Un(r.scheme,t),r.extent&&(n.schemeExtent=Pd(r.extent,t)),r.count&&(n.schemeCount=Un(r.count,t));return}else if(r.step){n.rangeStep=Un(r.step,t);return}else{if(lu(e.type)&&!z(r))return CN(r,e,t);z(r)||R("Unsupported range type: "+j(r))}return r.map(o=>(z(o)?Pd:Un)(o,t))}function _Z(e,t){const n=t.config.projection||{},i={};for(const r in e)r!=="name"&&(i[r]=ky(e[r],r,t));for(const r in n)i[r]==null&&(i[r]=ky(n[r],r,t));t.addProjection(e.name,i)}function ky(e,t,n){return z(e)?e.map(i=>ky(i,t,n)):V(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:R("Unsupported parameter object: "+j(e)):e}const Ai="top",Gu="left",Yu="right",zo="bottom",TN="center",SZ="vertical",EZ="start",kZ="middle",$Z="end",$y="index",B2="label",AZ="offset",xu="perc",CZ="perc2",Wn="value",bf="guide-label",j2="guide-title",MZ="group-title",FZ="group-subtitle",t$="symbol",Ld="gradient",Ay="discrete",Cy="size",TZ="shape",DZ="fill",NZ="stroke",OZ="strokeWidth",RZ="strokeDash",zZ="opacity",U2=[Cy,TZ,DZ,NZ,OZ,RZ,zZ],xf={name:1,style:1,interactive:1},be={value:0},Hn={value:1},Dp="group",DN="rect",q2="rule",PZ="symbol",da="text";function Nc(e){return e.type=Dp,e.interactive=e.interactive||!1,e}function kn(e,t){const n=(i,r)=>ri(e[i],ri(t[i],r));return n.isVertical=i=>SZ===ri(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>ri(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>ri(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>ri(e.columns,ri(t.columns,+n.isVertical(!0))),n}function NN(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function LZ(e,t,n){const i=t.config.style[n];return i&&i[e]}function Np(e,t,n){return`item.anchor === '${EZ}' ? ${e} : item.anchor === '${$Z}' ? ${t} : ${n}`}const W2=Np(j(Gu),j(Yu),j(TN));function IZ(e){const t=e("tickBand");let n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},V(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function ON(e,t){return t?e?V(e)?Object.assign({},e,{offset:ON(e.offset,t)}):{value:e,offset:t}:t:e}function zn(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Hu(e.encode,t,xf)):e.interactive=!1,e}function BZ(e,t,n,i){const r=kn(e,n),o=r.isVertical(),s=r.gradientThickness(),a=r.gradientLength();let u,l,c,f,d;o?(l=[0,1],c=[0,0],f=s,d=a):(l=[0,0],c=[1,0],f=a,d=s);const h={enter:u={opacity:be,x:be,y:be,width:ct(f),height:ct(d)},update:ae({},u,{opacity:Hn,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:be}};return _t(h,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),zn({type:DN,role:hQ,encode:h},i)}function jZ(e,t,n,i,r){const o=kn(e,n),s=o.isVertical(),a=o.gradientThickness(),u=o.gradientLength();let l,c,f,d,h="";s?(l="y",f="y2",c="x",d="width",h="1-"):(l="x",f="x2",c="y",d="height");const g={opacity:be,fill:{scale:t,field:Wn}};g[l]={signal:h+"datum."+xu,mult:u},g[c]=be,g[f]={signal:h+"datum."+CZ,mult:u},g[d]=ct(a);const p={enter:g,update:ae({},g,{opacity:Hn}),exit:{opacity:be}};return _t(p,{stroke:o("gradientStrokeColor"),strokeWidth:o("gradientStrokeWidth")},{opacity:o("gradientOpacity")}),zn({type:DN,role:fQ,key:Wn,from:r,encode:p},i)}const UZ=`datum.${xu}<=0?"${Gu}":datum.${xu}>=1?"${Yu}":"${TN}"`,qZ=`datum.${xu}<=0?"${zo}":datum.${xu}>=1?"${Ai}":"${kZ}"`;function n$(e,t,n,i){const r=kn(e,t),o=r.isVertical(),s=ct(r.gradientThickness()),a=r.gradientLength();let u=r("labelOverlap"),l,c,f,d,h="";const g={enter:l={opacity:be},update:c={opacity:Hn,text:{field:B2}},exit:{opacity:be}};return _t(g,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:ri(e.labelLimit,t.gradientLabelLimit)}),o?(l.align={value:"left"},l.baseline=c.baseline={signal:qZ},f="y",d="x",h="1-"):(l.align=c.align={signal:UZ},l.baseline={value:"top"},f="x",d="y"),l[f]=c[f]={signal:h+"datum."+xu,mult:a},l[d]=c[d]=s,s.offset=ri(e.labelOffset,t.gradientLabelOffset)||0,u=u?{separation:r("labelSeparation"),method:u,order:"datum."+$y}:void 0,zn({type:da,role:pN,style:bf,key:Wn,from:i,encode:g,overlap:u},n)}function WZ(e,t,n,i,r){const o=kn(e,t),s=n.entries,a=!!(s&&s.interactive),u=s?s.name:void 0,l=o("clipHeight"),c=o("symbolOffset"),f={data:"value"},d=`(${r}) ? datum.${AZ} : datum.${Cy}`,h=l?ct(l):{field:Cy},g=`datum.${$y}`,p=`max(1, ${r})`;let m,y,b,x,v;h.mult=.5,m={enter:y={opacity:be,x:{signal:d,mult:.5,offset:c},y:h},update:b={opacity:Hn,x:y.x,y:y.y},exit:{opacity:be}};let w=null,S=null;e.fill||(w=t.symbolBaseFillColor,S=t.symbolBaseStrokeColor),_t(m,{fill:o("symbolFillColor",w),shape:o("symbolType"),size:o("symbolSize"),stroke:o("symbolStrokeColor",S),strokeDash:o("symbolDash"),strokeDashOffset:o("symbolDashOffset"),strokeWidth:o("symbolStrokeWidth")},{opacity:o("symbolOpacity")}),U2.forEach(k=>{e[k]&&(b[k]=y[k]={scale:e[k],field:Wn})});const _=zn({type:PZ,role:gQ,key:Wn,from:f,clip:l?!0:void 0,encode:m},n.symbols),E=ct(c);E.offset=o("labelOffset"),m={enter:y={opacity:be,x:{signal:d,offset:E},y:h},update:b={opacity:Hn,text:{field:B2},x:y.x,y:y.y},exit:{opacity:be}},_t(m,{align:o("labelAlign"),baseline:o("labelBaseline"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontStyle:o("labelFontStyle"),fontWeight:o("labelFontWeight"),limit:o("labelLimit")});const A=zn({type:da,role:pN,style:bf,key:Wn,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:be,height:l?ct(l):be,opacity:be},exit:{opacity:be},update:b={opacity:Hn,row:{signal:null},column:{signal:null}}},o.isVertical(!0)?(x=`ceil(item.mark.items.length / ${p})`,b.row.signal=`${g}%${x}`,b.column.signal=`floor(${g} / ${x})`,v={field:["row",g]}):(b.row.signal=`floor(${g} / ${p})`,b.column.signal=`${g} % ${p}`,v={field:g}),b.column.signal=`(${r})?${b.column.signal}:${g}`,i={facet:{data:i,name:"value",groupby:$y}},Nc({role:P2,from:i,encode:Hu(m,s,xf),marks:[_,A],name:u,interactive:a,sort:v})}function HZ(e,t){const n=kn(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const H2='item.orient === "left"',G2='item.orient === "right"',Op=`(${H2} || ${G2})`,GZ=`datum.vgrad && ${Op}`,YZ=Np('"top"','"bottom"','"middle"'),VZ=Np('"right"','"left"','"center"'),XZ=`datum.vgrad && ${G2} ? (${VZ}) : (${Op} && !(datum.vgrad && ${H2})) ? "left" : ${W2}`,KZ=`item._anchor || (${Op} ? "middle" : "start")`,JZ=`${GZ} ? (${H2} ? -90 : 90) : 0`,QZ=`${Op} ? (datum.vgrad ? (${G2} ? "bottom" : "top") : ${YZ}) : "top"`;function ZZ(e,t,n,i){const r=kn(e,t),o={enter:{opacity:be},update:{opacity:Hn,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:be}};return _t(o,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:KZ},angle:{signal:JZ},align:{signal:XZ},baseline:{signal:QZ},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),zn({type:da,role:pQ,style:j2,from:i,encode:o},n)}function eee(e,t){let n;return V(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+i$(e.path)+")":e.sphere&&(n="geoShape("+i$(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function i$(e){return V(e)&&e.signal?e.signal:j(e)}function RN(e){const t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===Dp?P2:t||R2}function tee(e){return{marktype:e.type,name:e.name||void 0,role:e.role||RN(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function nee(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function Y2(e,t){const n=wM(e.type);n||R("Unrecognized transform type: "+j(e.type));const i=Mp(n.type.toLowerCase(),null,zN(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function zN(e,t,n){const i={},r=e.params.length;for(let o=0;o<r;++o){const s=e.params[o];i[s.name]=iee(s,t,n)}return i}function iee(e,t,n){const i=e.type,r=t[e.name];if(i==="index")return ree(e,t,n);if(r===void 0){e.required&&R("Missing required "+j(t.type)+" parameter: "+j(e.name));return}else{if(i==="param")return oee(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!nt(r)?r.map(o=>r$(e,o,n)):r$(e,r,n)}function r$(e,t,n){const i=e.type;if(nt(t))return s$(i)?R("Expression references can not be signals."):C0(i)?n.fieldRef(t):a$(i)?n.compareRef(t):n.signalRef(t.signal);{const r=e.expr||C0(i);return r&&see(t)?n.exprRef(t.expr,t.as):r&&aee(t)?Tc(t.field,t.as):s$(i)?tr(t,n):uee(i)?Z(n.getData(t).values):C0(i)?Tc(t):a$(i)?n.compareRef(t):t}}function ree(e,t,n){return Y(t.from)||R('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function oee(e,t,n){const i=t[e.name];return e.array?(z(i)||R("Expected an array of sub-parameters. Instead: "+j(i)),i.map(r=>o$(e,r,n))):o$(e,i,n)}function o$(e,t,n){const i=e.params.length;let r;for(let s=0;s<i;++s){r=e.params[s];for(const a in r.key)if(r.key[a]!==t[a]){r=null;break}if(r)break}r||R("Unsupported parameter: "+j(t));const o=ae(zN(r,t,n),r.key);return Z(n.add(nZ(o)))}const see=e=>e&&e.expr,aee=e=>e&&e.field,uee=e=>e==="data",s$=e=>e==="expr",C0=e=>e==="field",a$=e=>e==="compare";function lee(e,t,n){let i,r,o,s,a;return e?(i=e.facet)&&(t||R("Only group marks can be faceted."),i.field!=null?s=a=Id(i,n):(e.data?a=Z(n.getData(e.data).aggregate):(o=Y2(ae({type:"aggregate",groupby:H(i.groupby)},i.aggregate),n),o.params.key=n.keyRef(i.groupby),o.params.pulse=Id(i,n),s=a=Z(n.add(o))),r=n.keyRef(i.groupby,!0))):s=Z(n.add($i(null,[{}]))),s||(s=Id(e,n)),{key:r,pulse:s,parent:a}}function Id(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Z(t.getData(e.data).output)}function Gs(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}Gs.fromEntries=function(e,t){const n=t.length,i=t[n-1],r=t[n-2];let o=t[0],s=null,a=1;for(o&&o.type==="load"&&(o=t[1]),e.add(t[0]);a<n;++a)t[a].params.pulse=Z(t[a-1]),e.add(t[a]),t[a].type==="aggregate"&&(s=t[a]);return new Gs(e,o,r,i,s)};function PN(e){return Y(e)?e:null}function u$(e,t,n){const i=Fp(n.op,n.field);let r;if(t.ops){for(let o=0,s=t.as.length;o<s;++o)if(t.as[o]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function xl(e,t,n,i,r,o,s){const a=t[n]||(t[n]={}),u=DQ(o);let l=PN(r),c,f;if(l!=null&&(e=t.scope,l=l+(u?"|"+u:""),c=a[l]),!c){const d=o?{field:Sy,pulse:t.countsRef(e,r,o)}:{field:e.fieldRef(r),pulse:Z(t.output)};u&&(d.sort=e.sortRef(o)),f=e.add(Mp(i,void 0,d)),s&&(t.index[r]=f),c=Z(f),l!=null&&(a[l]=c)}return c}Gs.prototype={countsRef(e,t,n){const i=this,r=i.counts||(i.counts={}),o=PN(t);let s,a,u;return o!=null&&(e=i.scope,s=r[o]),s?n&&n.field&&u$(e,s.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:Z(i.output)},n&&n.field&&u$(e,u,n),a=e.add(wN(u)),s=e.add($i({pulse:Z(a)})),s={agg:a,ref:Z(s)},o!=null&&(r[o]=s)),s.ref},tuplesRef(){return Z(this.values)},extentRef(e,t){return xl(e,this,"extent","extent",t,!1)},domainRef(e,t){return xl(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return xl(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return xl(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return xl(e,this,"indata","tupleindex",t,!0,!0)}};function cee(e,t,n){const i=e.from.facet,r=i.name,o=Id(i,t);let s;i.name||R("Facet must have a name: "+j(i)),i.data||R("Facet must reference a data set: "+j(i)),i.field?s=t.add(EN({field:t.fieldRef(i.field),pulse:o})):i.groupby?s=t.add(YQ({key:t.keyRef(i.groupby),group:Z(t.proxy(n.parent)),pulse:o})):R("Facet must specify groupby or field: "+j(i));const a=t.fork(),u=a.add($i()),l=a.add(fa({pulse:Z(u)}));a.addData(r,new Gs(a,u,u,l)),a.addSignal("parent",null),s.params.subflow={$subflow:a.parse(e).toRuntime()}}function fee(e,t,n){const i=t.add(EN({pulse:n.pulse})),r=t.fork();r.add(fa()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function LN(e,t,n){const i=e.remove,r=e.insert,o=e.toggle,s=e.modify,a=e.values,u=t.add(og()),l="if("+e.trigger+',modify("'+n+'",'+[r,i,o,s,a].map(f=>f??"null").join(",")+"),0)",c=tr(l,t);u.update=c.$expr,u.params=c.$params}function Rp(e,t){const n=RN(e),i=e.type===Dp,r=e.from&&e.from.facet,o=e.overlap;let s=e.layout||n===P2||n===z2,a,u,l,c,f,d,h;const g=n===R2||s||r,p=lee(e.from,i,t);u=t.add(HQ({key:p.key||(e.key?Tc(e.key):void 0),pulse:p.pulse,clean:!i}));const m=Z(u);u=l=t.add($i({pulse:m})),u=t.add(QQ({markdef:tee(e),interactive:nee(e.interactive,t),clip:eee(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Z(u)}));const y=Z(u);u=c=t.add(SN(xN(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(S=>{const _=Y2(S,t),E=_.metadata;(E.generates||E.changes)&&R("Mark transforms should not generate new data."),E.nomod||(c.params.mod=!0),_.params.pulse=Z(u),t.add(u=_)}),e.sort&&(u=t.add(aZ({sort:t.compareRef(e.sort),pulse:Z(u)})));const b=Z(u);(r||s)&&(s=t.add($N({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),d=Z(s));const x=t.add(_N({mark:y,pulse:d||b}));h=Z(x),i&&(g&&(a=t.operators,a.pop(),s&&a.pop()),t.pushState(b,d||h,m),r?cee(e,t,p):g?fee(e,t,p):t.parse(e),t.popState(),g&&(s&&a.push(s),a.push(x))),o&&(h=dee(o,h,t));const v=t.add(kN({pulse:h})),w=t.add(fa({pulse:Z(v)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new Gs(t,l,v,w)),e.on&&e.on.forEach(S=>{(S.insert||S.remove||S.toggle)&&R("Marks only support modify triggers."),LN(S,t,f)}))}function dee(e,t,n){const i=e.method,r=e.bound,o=e.separation,s={separation:nt(o)?n.signalRef(o.signal):o,method:nt(i)?n.signalRef(i.signal):i,pulse:t};if(e.order&&(s.sort=n.compareRef({field:e.order})),r){const a=r.tolerance;s.boundTolerance=nt(a)?n.signalRef(a.signal):+a,s.boundScale=n.scaleRef(r.scale),s.boundOrient=r.orient}return Z(n.add(tZ(s)))}function hee(e,t){const n=t.config.legend,i=e.encode||{},r=kn(e,n),o=i.legend||{},s=o.name||void 0,a=o.interactive,u=o.style,l={};let c=0,f,d,h;U2.forEach(x=>e[x]?(l[x]=e[x],c=c||e[x]):0),c||R("Missing valid scale for legend.");const g=gee(e,t.scaleType(c)),p={title:e.title!=null,scales:l,type:g,vgrad:g!=="symbol"&&r.isVertical()},m=Z(t.add($i(null,[p]))),y={enter:{x:{value:0},y:{value:0}}},b=Z(t.add(KQ(d={type:g,scale:t.scaleRef(c),count:t.objectProperty(r("tickCount")),limit:t.property(r("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return g===Ld?(h=[BZ(e,c,n,i.gradient),n$(e,n,i.labels,b)],d.count=d.count||t.signalRef(`max(2,2*floor((${Ds(r.gradientLength())})/100))`)):g===Ay?h=[jZ(e,c,n,i.gradient,b),n$(e,n,i.labels,b)]:(f=HZ(e,n),h=[WZ(e,n,i,b,Ds(f.columns))],d.size=yee(e,t,h[0].marks)),h=[Nc({role:dQ,from:m,encode:y,marks:h,layout:f,interactive:a})],p.title&&h.push(ZZ(e,n,i.title,m)),Rp(Nc({role:cQ,from:m,encode:Hu(mee(r,e,n),o,xf),marks:h,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:s,interactive:a,style:u}),t)}function gee(e,t){let n=e.type||t$;return!e.type&&pee(e)===1&&(e.fill||e.stroke)&&(n=qx(t)?Ld:x1(t)?Ay:t$),n!==Ld?n:x1(t)?Ay:Ld}function pee(e){return U2.reduce((t,n)=>t+(e[n]?1:0),0)}function mee(e,t,n){const i={enter:{},update:{}};return _t(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function yee(e,t,n){const i=Ds(l$("size",e,n)),r=Ds(l$("strokeWidth",e,n)),o=Ds(bee(n[1].encode,t,bf));return tr(`max(ceil(sqrt(${i})+${r}),${o})`,t)}function l$(e,t,n){return t[e]?`scale("${t[e]}",datum)`:NN(e,n[0].encode)}function bee(e,t,n){return NN("fontSize",e)||LZ("fontSize",t,n)}const xee=`item.orient==="${Gu}"?-90:item.orient==="${Yu}"?90:0`;function vee(e,t){e=Y(e)?{text:e}:e;const n=kn(e,t.config.title),i=e.encode||{},r=i.group||{},o=r.name||void 0,s=r.interactive,a=r.style,u=[],l={},c=Z(t.add($i(null,[l])));return u.push(See(e,n,wee(e),c)),e.subtitle&&u.push(Eee(e,n,i.subtitle,c)),Rp(Nc({role:mQ,from:c,encode:_ee(n,r),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:o,interactive:s,style:a}),t)}function wee(e){const t=e.encode;return t&&t.title||ae({name:e.name,interactive:e.interactive,style:e.style},t)}function _ee(e,t){const n={enter:{},update:{}};return _t(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:W2},angle:{signal:xee},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Hu(n,t,xf)}function See(e,t,n,i){const r={value:0},o=e.text,s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return _t(s,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),zn({type:da,role:yQ,style:MZ,from:i,encode:s},n)}function Eee(e,t,n,i){const r={value:0},o=e.subtitle,s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return _t(s,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),zn({type:da,role:bQ,style:FZ,from:i,encode:s},n)}function kee(e,t){const n=[];e.transform&&e.transform.forEach(i=>{n.push(Y2(i,t))}),e.on&&e.on.forEach(i=>{LN(i,t,e.name)}),t.addDataPipeline(e.name,$ee(e,t,n))}function $ee(e,t,n){const i=[];let r=null,o=!1,s=!1,a,u,l,c,f;for(e.values?nt(e.values)||zd(e.format)?(i.push(c$(t,e)),i.push(r=as())):i.push(r=as({$ingest:e.values,$format:e.format})):e.url?zd(e.url)||zd(e.format)?(i.push(c$(t,e)),i.push(r=as())):i.push(r=as({$request:e.url,$format:e.format})):e.source&&(r=a=H(e.source).map(d=>Z(t.getData(d).output)),i.push(null)),u=0,l=n.length;u<l;++u)c=n[u],f=c.metadata,!r&&!f.source&&i.push(r=as()),i.push(c),f.generates&&(s=!0),f.modifies&&!s&&(o=!0),f.source?r=c:f.changes&&(r=null);return a&&(l=a.length-1,i[0]=oZ({derive:o,pulse:l?a:a[0]}),(o||l)&&i.splice(1,0,as())),r||i.push(as()),i.push(fa({})),i}function as(e){const t=$i({},e);return t.metadata={source:!0},t}function c$(e,t){return JQ({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const IN=e=>e===zo||e===Ai,zp=(e,t,n)=>nt(e)?Fee(e.signal,t,n):e===Gu||e===Ai?t:n,ft=(e,t,n)=>nt(e)?Cee(e.signal,t,n):IN(e)?t:n,yi=(e,t,n)=>nt(e)?Mee(e.signal,t,n):IN(e)?n:t,BN=(e,t,n)=>nt(e)?Tee(e.signal,t,n):e===Ai?{value:t}:{value:n},Aee=(e,t,n)=>nt(e)?Dee(e.signal,t,n):e===Yu?{value:t}:{value:n},Cee=(e,t,n)=>jN(`${e} === '${Ai}' || ${e} === '${zo}'`,t,n),Mee=(e,t,n)=>jN(`${e} !== '${Ai}' && ${e} !== '${zo}'`,t,n),Fee=(e,t,n)=>V2(`${e} === '${Gu}' || ${e} === '${Ai}'`,t,n),Tee=(e,t,n)=>V2(`${e} === '${Ai}'`,t,n),Dee=(e,t,n)=>V2(`${e} === '${Yu}'`,t,n),jN=(e,t,n)=>(t=t!=null?ct(t):t,n=n!=null?ct(n):n,f$(t)&&f$(n)?(t=t?t.signal||j(t.value):null,n=n?n.signal||j(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[ae({test:e},t)].concat(n||[])),f$=e=>e==null||Object.keys(e).length===1,V2=(e,t,n)=>({signal:`${e} ? (${ja(t)}) : (${ja(n)})`}),Nee=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${Gu}' ? (${ja(i)}) : `:"")+(n!=null?`${e} === '${zo}' ? (${ja(n)}) : `:"")+(r!=null?`${e} === '${Yu}' ? (${ja(r)}) : `:"")+(t!=null?`${e} === '${Ai}' ? (${ja(t)}) : `:"")+"(null)"}),ja=e=>nt(e)?e.signal:e==null?null:j(e),Oee=(e,t)=>t===0?0:nt(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Ga=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Ma(e,t,n,i){let r;if(t&&ne(t,e))return t[e];if(ne(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[j2][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[bf][r]}return null}function d$(e){const t={};for(const n of e)if(n)for(const i in n)t[i]=1;return Object.keys(t)}function Ree(e,t){var n=t.config,i=n.style,r=n.axis,o=t.scaleType(e.scale)==="band"&&n.axisBand,s=e.orient,a,u,l;if(nt(s)){const f=d$([n.axisX,n.axisY]),d=d$([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);a={};for(l of f)a[l]=ft(s,Ma(l,n.axisX,r,i),Ma(l,n.axisY,r,i));u={};for(l of d)u[l]=Nee(s.signal,Ma(l,n.axisTop,r,i),Ma(l,n.axisBottom,r,i),Ma(l,n.axisLeft,r,i),Ma(l,n.axisRight,r,i))}else a=s===Ai||s===zo?n.axisX:n.axisY,u=n["axis"+s[0].toUpperCase()+s.slice(1)];return a||u||o?ae({},r,a,u,o):r}function zee(e,t,n,i){const r=kn(e,t),o=e.orient;let s,a;const u={enter:s={opacity:be},update:a={opacity:Hn},exit:{opacity:be}};_t(u,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const l=h$(e,0),c=h$(e,1);return s.x=a.x=ft(o,l,be),s.x2=a.x2=ft(o,c),s.y=a.y=yi(o,l,be),s.y2=a.y2=yi(o,c),zn({type:q2,role:oQ,from:i,encode:u},n)}function h$(e,t){return{scale:e.scale,range:t}}function Pee(e,t,n,i,r){const o=kn(e,t),s=e.orient,a=e.gridScale,u=zp(s,1,-1),l=Lee(e.offset,u);let c,f,d;const h={enter:c={opacity:be},update:d={opacity:Hn},exit:f={opacity:be}};_t(h,{stroke:o("gridColor"),strokeCap:o("gridCap"),strokeDash:o("gridDash"),strokeDashOffset:o("gridDashOffset"),strokeOpacity:o("gridOpacity"),strokeWidth:o("gridWidth")});const g={scale:e.scale,field:Wn,band:r.band,extra:r.extra,offset:r.offset,round:o("tickRound")},p=ft(s,{signal:"height"},{signal:"width"}),m=a?{scale:a,range:0,mult:u,offset:l}:{value:0,offset:l},y=a?{scale:a,range:1,mult:u,offset:l}:ae(p,{mult:u,offset:l});return c.x=d.x=ft(s,g,m),c.y=d.y=yi(s,g,m),c.x2=d.x2=yi(s,y),c.y2=d.y2=ft(s,y),f.x=ft(s,g),f.y=yi(s,g),zn({type:q2,role:sQ,key:Wn,from:i,encode:h},n)}function Lee(e,t){if(t!==1)if(!V(e))e=nt(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=ae({},e);for(;n.mult!=null;)if(V(n.mult))n=n.mult=ae({},n.mult);else return n.mult=nt(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function Iee(e,t,n,i,r,o){const s=kn(e,t),a=e.orient,u=zp(a,-1,1);let l,c,f;const d={enter:l={opacity:be},update:f={opacity:Hn},exit:c={opacity:be}};_t(d,{stroke:s("tickColor"),strokeCap:s("tickCap"),strokeDash:s("tickDash"),strokeDashOffset:s("tickDashOffset"),strokeOpacity:s("tickOpacity"),strokeWidth:s("tickWidth")});const h=ct(r);h.mult=u;const g={scale:e.scale,field:Wn,band:o.band,extra:o.extra,offset:o.offset,round:s("tickRound")};return f.y=l.y=ft(a,be,g),f.y2=l.y2=ft(a,h),c.x=ft(a,g),f.x=l.x=yi(a,be,g),f.x2=l.x2=yi(a,h),c.y=yi(a,g),zn({type:q2,role:uQ,key:Wn,from:i,encode:d},n)}function M0(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function Bee(e,t,n,i,r,o){const s=kn(e,t),a=e.orient,u=e.scale,l=zp(a,-1,1),c=Ds(s("labelFlush")),f=Ds(s("labelFlushOffset")),d=s("labelAlign"),h=s("labelBaseline");let g=c===0||!!c,p;const m=ct(r);m.mult=l,m.offset=ct(s("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:Wn,band:.5,offset:ON(o.offset,s("labelOffset"))},b=ft(a,g?M0(u,c,'"left"','"right"','"center"'):{value:"center"},Aee(a,"left","right")),x=ft(a,BN(a,"bottom","top"),g?M0(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),v=M0(u,c,`-(${f})`,f,0);g=g&&f;const w={opacity:be,x:ft(a,y,m),y:yi(a,y,m)},S={enter:w,update:p={opacity:Hn,text:{field:B2},x:w.x,y:w.y,align:b,baseline:x},exit:{opacity:be,x:w.x,y:w.y}};_t(S,{dx:!d&&g?ft(a,v):null,dy:!h&&g?yi(a,v):null}),_t(S,{angle:s("labelAngle"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontWeight:s("labelFontWeight"),fontStyle:s("labelFontStyle"),limit:s("labelLimit"),lineHeight:s("labelLineHeight")},{align:d,baseline:h});const _=s("labelBound");let E=s("labelOverlap");return E=E||_?{separation:s("labelSeparation"),method:E,order:"datum.index",bound:_?{scale:u,orient:a,tolerance:_}:null}:void 0,p.align!==b&&(p.align=Ga(p.align,b)),p.baseline!==x&&(p.baseline=Ga(p.baseline,x)),zn({type:da,role:aQ,style:bf,key:Wn,from:i,encode:S,overlap:E},n)}function jee(e,t,n,i){const r=kn(e,t),o=e.orient,s=zp(o,-1,1);let a,u;const l={enter:a={opacity:be,anchor:ct(r("titleAnchor",null)),align:{signal:W2}},update:u=ae({},a,{opacity:Hn,text:ct(e.title)}),exit:{opacity:be}},c={signal:`lerp(range("${e.scale}"), ${Np(0,1,.5)})`};return u.x=ft(o,c),u.y=yi(o,c),a.angle=ft(o,be,Oee(s,90)),a.baseline=ft(o,BN(o,zo,Ai),{value:zo}),u.angle=a.angle,u.baseline=a.baseline,_t(l,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),Uee(r,o,l,n),l.update.align=Ga(l.update.align,a.align),l.update.angle=Ga(l.update.angle,a.angle),l.update.baseline=Ga(l.update.baseline,a.baseline),zn({type:da,role:lQ,style:j2,from:i,encode:l},n)}function Uee(e,t,n,i){const r=(a,u)=>a!=null?(n.update[u]=Ga(ct(a),n.update[u]),!1):!Oa(u,i),o=r(e("titleX"),"x"),s=r(e("titleY"),"y");n.enter.auto=s===o?ct(s):ft(t,ct(s),ct(o))}function qee(e,t){const n=Ree(e,t),i=e.encode||{},r=i.axis||{},o=r.name||void 0,s=r.interactive,a=r.style,u=kn(e,n),l=IZ(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null},f=Z(t.add($i({},[c]))),d=Z(t.add(WQ({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let g;return c.grid&&h.push(Pee(e,n,i.grid,d,l)),c.ticks&&(g=u("tickSize"),h.push(Iee(e,n,i.ticks,d,g,l))),c.labels&&(g=c.ticks?g:0,h.push(Bee(e,n,i.labels,d,g,l))),c.domain&&h.push(zee(e,n,i.domain,f)),c.title&&h.push(jee(e,n,i.title,f)),Rp(Nc({role:rQ,from:f,encode:Hu(Wee(u,e),r,xf),marks:h,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:o,interactive:s,style:a}),t)}function Wee(e,t){const n={enter:{},update:{}};return _t(n,{orient:e("orient"),offset:e("offset")||0,position:ri(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function UN(e,t,n){const i=H(e.signals),r=H(e.scales);return n||i.forEach(o=>vN(o,t)),H(e.projections).forEach(o=>_Z(o,t)),r.forEach(o=>cZ(o,t)),H(e.data).forEach(o=>kee(o,t)),r.forEach(o=>fZ(o,t)),(n||i).forEach(o=>qQ(o,t)),H(e.axes).forEach(o=>qee(o,t)),H(e.marks).forEach(o=>Rp(o,t)),H(e.legends).forEach(o=>hee(o,t)),e.title&&vee(e.title,t),t.parseLambdas(),t}const Hee=e=>Hu({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function Gee(e,t){const n=t.config,i=Z(t.root=t.add(og())),r=Yee(e,n);r.forEach(l=>vN(l,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const o=t.add($i()),s=t.add(SN(xN(Hee(e.encode),Dp,z2,e.style,t,{pulse:Z(o)}))),a=t.add($N({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:Z(s)}));t.operators.pop(),t.pushState(Z(s),Z(a),null),UN(e,t,r),t.operators.push(a);let u=t.add(_N({mark:i,pulse:Z(a)}));return u=t.add(kN({pulse:Z(u)})),u=t.add(fa({pulse:Z(u)})),t.addData("root",new Gs(t,o,o,u)),t}function vl(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Yee(e,t){const n=s=>ri(e[s],t[s]),i=[vl("background",n("background")),vl("autosize",tQ(n("autosize"))),vl("padding",iQ(n("padding"))),vl("width",n("width")||0),vl("height",n("height")||0)],r=i.reduce((s,a)=>(s[a.name]=a,s),{}),o={};return H(e.signals).forEach(s=>{ne(r,s.name)?s=ae(r[s.name],s):i.push(s),o[s.name]=s}),H(t.signals).forEach(s=>{!ne(o,s.name)&&!ne(r,s.name)&&i.push(s)}),i}function qN(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function g$(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}qN.prototype=g$.prototype={parse(e){return UN(e,this)},fork(){return new g$(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof _y?Z(e):e;return this.add(rZ({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(i,r,o){let s,a;i&&(s=i.data||(i.data={}),a=s[r]||(s[r]=[]),a.push(o))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(Z(this.add(fa({pulse:e})))),this._parent.push(t),this._lookup.push(n?Z(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return ye(this._parent)},encode(){return ye(this._encode)},lookup(){return ye(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Y(e))return Tc(e,t);e.signal||R("Unsupported field reference: "+j(e));const n=e.signal;let i=this.field[n];if(!i){const r={name:this.signalRef(n)};t&&(r.as=t),this.field[n]=i=Z(this.add(VQ(r)))}return i},compareRef(e){let t=!1;const n=o=>nt(o)?(t=!0,this.signalRef(o.signal)):NQ(o)?(t=!0,this.exprRef(o.expr)):o,i=H(e.field).map(n),r=H(e.order).map(n);return t?Z(this.add(e$({fields:i,orders:r}))):Qk(i,r)},keyRef(e,t){let n=!1;const i=o=>nt(o)?(n=!0,Z(r[o.signal])):o,r=this.signals;return e=H(e).map(i),n?Z(this.add(XQ({fields:e,flat:t}))):MQ(e,t)},sortRef(e){if(!e)return e;const t=Fp(e.op,e.field),n=e.order||FQ;return n.signal?Z(this.add(e$({fields:t,orders:this.signalRef(n.signal)}))):Qk(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return ne(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&R("Duplicate signal name: "+j(e));const n=t instanceof _y?t:this.add(og(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||R("Unrecognized signal name: "+j(e)),this.signals[e]},signalRef(e){return this.signals[e]?Z(this.signals[e]):(ne(this.lambdas,e)||(this.lambdas[e]=this.add(og(null))),Z(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const i=e[t],r=tr(i,this),o=this.lambdas[i];o.params=r.$params,o.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!V(e)?e:this.signalRef(e.signal||X2(e))},exprRef(e,t){const n={expr:tr(e,this)};return t&&(n.expr.$name=t),Z(this.add(GQ(n)))},addBinding(e,t){this.bindings||R("Nested signals do not support binding: "+j(e)),this.bindings.push(ae({signal:e},t))},addScaleProj(e,t){ne(this.scales,e)&&R("Duplicate scale or projection name: "+j(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,sZ(t))},addProjection(e,t){this.addScaleProj(e,iZ(t))},getScale(e){return this.scales[e]||R("Unrecognized scale name: "+j(e)),this.scales[e]},scaleRef(e){return Z(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return ne(this.data,e)&&R("Duplicate data set name: "+j(e)),this.data[e]=t},getData(e){return this.data[e]||R("Undefined data set name: "+j(e)),this.data[e]},addDataPipeline(e,t){return ne(this.data,e)&&R("Duplicate data set name: "+j(e)),this.addData(e,Gs.fromEntries(this,t))}};function X2(e){return(z(e)?Vee:Xee)(e)}function Vee(e){const t=e.length;let n="[";for(let i=0;i<t;++i){const r=e[i];n+=(i>0?",":"")+(V(r)?r.signal||X2(r):j(r))}return n+"]"}function Xee(e){let t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+j(i)+":"+(V(r)?r.signal||X2(r):j(r));return t+"}"}function Kee(){const e="sans-serif",i="#4c78a8",r="#000",o="#888",s="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:2},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:2},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:s},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:o,grid:!1,gridWidth:1,gridColor:s,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:o,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:s,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:o,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Jee(e,t,n){return V(e)||R("Input Vega specification must be an object."),t=Sg(Kee(),t,e.config),Gee(e,new qN(t,n)).toRuntime()}var Qee="5.25.0";ae(iu,W9,vU,QU,LW,DH,oY,LG,aY,FY,BY,YY);const Xce=Object.freeze(Object.defineProperty({__proto__:null,Bounds:Ke,CanvasHandler:lf,CanvasRenderer:bh,DATE:xn,DAY:Tt,DAYOFYEAR:Zi,Dataflow:Ua,Debug:WA,Error:nb,EventStream:Pg,Gradient:I3,GroupItem:sp,HOURS:Nn,Handler:Oo,Info:qA,Item:op,MILLISECONDS:wi,MINUTES:On,MONTH:zt,Marks:Rn,MultiPulse:$b,None:UA,Operator:Te,Parameters:zg,Pulse:So,QUARTER:bn,RenderType:po,Renderer:ur,ResourceLoader:Qx,SECONDS:Yn,SVGHandler:mv,SVGRenderer:_v,SVGStringRenderer:Sv,Scenegraph:gv,TIME_UNITS:mb,Transform:T,View:aN,WEEK:et,Warn:ib,YEAR:vt,accessor:En,accessorFields:Rt,accessorName:He,array:H,ascending:$g,bandwidthNRD:Fb,bin:EM,bootstrapCI:kM,boundClip:N5,boundContext:of,boundItem:$1,boundMark:r5,boundStroke:qr,changeset:aa,clampRange:tC,codegenExpression:RD,compare:ub,constant:Bt,cumulativeLogNormal:zb,cumulativeNormal:Ig,cumulativeUniform:Bb,dayofyear:TC,debounce:lb,defaultLocale:wb,definition:wM,densityLogNormal:Rb,densityNormal:Tb,densityUniform:Ib,domChild:cn,domClear:ui,domCreate:ho,domFind:pv,dotbin:$M,error:R,expressionFunction:Je,extend:ae,extent:Ki,extentIndex:nC,falsy:to,fastmap:Ru,field:yn,flush:iC,font:fp,fontFamily:uf,fontSize:ar,format:yd,formatLocale:Jd,formats:Eb,hasOwnProperty:ne,id:Bc,identity:It,inferType:cM,inferTypes:fM,ingest:Se,inherits:U,inrange:za,interpolate:Wx,interpolateColors:ip,interpolateRange:k3,intersect:M5,intersectBoxLine:Pa,intersectPath:Zx,intersectPoint:ev,intersectRule:Y3,isArray:z,isBoolean:ia,isDate:wo,isFunction:ue,isIterable:rC,isNumber:Ae,isObject:V,isRegExp:oC,isString:Y,isTuple:Og,key:cb,lerp:sC,lineHeight:Do,loader:Dg,locale:uM,logger:rb,lruCache:aC,markup:wv,merge:uC,mergeConfig:Sg,multiLineOffset:fv,one:Ou,pad:lC,panLinear:XA,panLog:KA,panPow:JA,panSymlog:QA,parse:Jee,parseExpression:_2,parseSelector:Vo,path:Wg,pathCurves:Xx,pathEqual:O5,pathParse:cu,pathRectangle:U3,pathRender:xc,pathSymbols:j3,pathTrail:q3,peek:ye,point:hp,projection:Uv,quantileLogNormal:Pb,quantileNormal:Bg,quantileUniform:jb,quantiles:Cb,quantizeInterpolator:$3,quarter:ZA,quartiles:Mb,get random(){return Vn},randomInteger:VP,randomKDE:Nb,randomLCG:YP,randomLogNormal:CM,randomMixture:MM,randomNormal:Db,randomUniform:FM,read:gM,regressionConstant:Ub,regressionExp:DM,regressionLinear:qb,regressionLoess:RM,regressionLog:TM,regressionPoly:OM,regressionPow:NM,regressionQuad:Wb,renderModule:gp,repeat:$l,resetDefaultLocale:Wz,resetSVGClipId:H3,resetSVGDefIds:Lj,responseType:hM,runtimeContext:VD,sampleCurve:Ug,sampleLogNormal:Ob,sampleNormal:Lg,sampleUniform:Lb,scale:we,sceneEqual:Ev,sceneFromJSON:s5,scenePickVisit:dh,sceneToJSON:o5,sceneVisit:_i,sceneZOrder:tv,scheme:Hx,serializeXML:w5,setRandom:HP,span:Uc,splitAccessPath:or,stringValue:j,textMetrics:mi,timeBin:VC,timeFloor:LC,timeFormatLocale:dc,timeInterval:Lu,timeOffset:jC,timeSequence:WC,timeUnitSpecifier:FC,timeUnits:yb,toBoolean:fb,toDate:db,toNumber:Dt,toSet:vi,toString:hb,transform:_M,transforms:iu,truncate:cC,truthy:Gn,tupleid:ee,typeParsers:a1,utcFloor:IC,utcInterval:Iu,utcOffset:UC,utcSequence:HC,utcdayofyear:OC,utcquarter:eC,utcweek:RC,version:Qee,visitArray:ro,week:DC,writeConfig:jc,zero:lo,zoomLinear:ob,zoomLog:sb,zoomPow:Wd,zoomSymlog:ab},Symbol.toStringTag,{value:"Module"})),Zee="vega-lite",ete='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',tte="5.11.1",nte=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],ite="https://vega.github.io/vega-lite/",rte="Vega-Lite is a concise high-level language for interactive visualization.",ote=["vega","chart","visualization"],ste="build/vega-lite.js",ate="build/vega-lite.min.js",ute="build/vega-lite.min.js",lte="build/src/index",cte="build/src/index.d.ts",fte={vl2pdf:"./bin/vl2pdf",vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},dte=["bin","build","src","vega-lite*","tsconfig.json"],hte={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.mjs","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/","watch:test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest --watch test-runtime/ --config test-runtime/jest-config.json",release:"release-it"},gte={type:"git",url:"https://github.com/vega/vega-lite.git"},pte="BSD-3-Clause",mte={url:"https://github.com/vega/vega-lite/issues"},yte={"@babel/core":"^7.21.8","@babel/plugin-proposal-class-properties":"^7.18.6","@babel/preset-env":"^7.21.5","@babel/preset-typescript":"^7.21.5","@release-it/conventional-changelog":"^5.1.1","@rollup/plugin-alias":"^5.0.0","@rollup/plugin-babel":"^6.0.3","@rollup/plugin-commonjs":"^25.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-terser":"^0.4.1","@types/chai":"^4.3.5","@types/d3":"^7.4.0","@types/jest":"^27.4.1","@types/pako":"^2.0.0","@typescript-eslint/eslint-plugin":"^5.59.5","@typescript-eslint/parser":"^5.59.5",ajv:"^8.12.0","ajv-formats":"^2.1.1",chai:"^4.3.7",cheerio:"^1.0.0-rc.12","conventional-changelog-cli":"^3.0.0",d3:"^7.8.4","del-cli":"^5.0.0",eslint:"^8.40.0","eslint-config-prettier":"^8.8.0","eslint-plugin-jest":"^27.2.1","eslint-plugin-prettier":"^4.2.1","highlight.js":"^11.8.0",jest:"^27.5.1","jest-dev-server":"^6.1.1",mkdirp:"^3.0.1",pako:"^2.1.0",prettier:"^2.8.8",puppeteer:"^15.0.0","release-it":"^15.10.3",rollup:"^3.21.6","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3",serve:"^14.2.0",terser:"^5.17.3","ts-jest":"^29.1.0","ts-json-schema-generator":"^1.2.0",typescript:"~4.9.5","vega-cli":"^5.25.0","vega-datasets":"^2.7.0","vega-embed":"^6.22.1","vega-tooltip":"^0.32.0","yaml-front-matter":"^4.1.1"},bte={"@types/clone":"~2.1.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.5.0","vega-event-selector":"~3.0.1","vega-expression":"~5.1.0","vega-util":"~1.17.2",yargs:"~17.7.2"},xte={vega:"^5.24.0"},vte={node:">=16"},wte={name:Zee,author:ete,version:tte,collaborators:nte,homepage:ite,description:rte,keywords:ote,main:ste,unpkg:ate,jsdelivr:ute,module:lte,types:cte,bin:fte,files:dte,scripts:hte,repository:gte,license:pte,bugs:mte,devDependencies:yte,dependencies:bte,peerDependencies:xte,engines:vte};var WN={exports:{}};(function(e){var t=function(){function n(d,h){return h!=null&&d instanceof h}var i;try{i=Map}catch{i=function(){}}var r;try{r=Set}catch{r=function(){}}var o;try{o=Promise}catch{o=function(){}}function s(d,h,g,p,m){typeof h=="object"&&(g=h.depth,p=h.prototype,m=h.includeNonEnumerable,h=h.circular);var y=[],b=[],x=typeof Buffer<"u";typeof h>"u"&&(h=!0),typeof g>"u"&&(g=1/0);function v(w,S){if(w===null)return null;if(S===0)return w;var _,E;if(typeof w!="object")return w;if(n(w,i))_=new i;else if(n(w,r))_=new r;else if(n(w,o))_=new o(function(q,G){w.then(function(K){q(v(K,S-1))},function(K){G(v(K,S-1))})});else if(s.__isArray(w))_=[];else if(s.__isRegExp(w))_=new RegExp(w.source,f(w)),w.lastIndex&&(_.lastIndex=w.lastIndex);else if(s.__isDate(w))_=new Date(w.getTime());else{if(x&&Buffer.isBuffer(w))return Buffer.allocUnsafe?_=Buffer.allocUnsafe(w.length):_=new Buffer(w.length),w.copy(_),_;n(w,Error)?_=Object.create(w):typeof p>"u"?(E=Object.getPrototypeOf(w),_=Object.create(E)):(_=Object.create(p),E=p)}if(h){var A=y.indexOf(w);if(A!=-1)return b[A];y.push(w),b.push(_)}n(w,i)&&w.forEach(function(q,G){var K=v(G,S-1),ce=v(q,S-1);_.set(K,ce)}),n(w,r)&&w.forEach(function(q){var G=v(q,S-1);_.add(G)});for(var k in w){var $;E&&($=Object.getOwnPropertyDescriptor(E,k)),!($&&$.set==null)&&(_[k]=v(w[k],S-1))}if(Object.getOwnPropertySymbols)for(var D=Object.getOwnPropertySymbols(w),k=0;k<D.length;k++){var M=D[k],F=Object.getOwnPropertyDescriptor(w,M);F&&!F.enumerable&&!m||(_[M]=v(w[M],S-1),F.enumerable||Object.defineProperty(_,M,{enumerable:!1}))}if(m)for(var C=Object.getOwnPropertyNames(w),k=0;k<C.length;k++){var O=C[k],F=Object.getOwnPropertyDescriptor(w,O);F&&F.enumerable||(_[O]=v(w[O],S-1),Object.defineProperty(_,O,{enumerable:!1}))}return _}return v(d,g)}s.clonePrototype=function(h){if(h===null)return null;var g=function(){};return g.prototype=h,new g};function a(d){return Object.prototype.toString.call(d)}s.__objToStr=a;function u(d){return typeof d=="object"&&a(d)==="[object Date]"}s.__isDate=u;function l(d){return typeof d=="object"&&a(d)==="[object Array]"}s.__isArray=l;function c(d){return typeof d=="object"&&a(d)==="[object RegExp]"}s.__isRegExp=c;function f(d){var h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),h}return s.__getRegExpFlags=f,s}();e.exports&&(e.exports=t)})(WN);var _te=WN.exports;const Ste=_g(_te);var Ete=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,o;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(o=Object.keys(t),i=o.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,o[r]))return!1;for(r=i;r--!==0;){var s=o[r];if(!e(t[s],n[s]))return!1}return!0}return t!==t&&n!==n};const kte=_g(Ete);var $te=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(o){return function(s){return function(a,u){var l={key:a,value:s[a]},c={key:u,value:s[u]};return o(l,c)}}}(t.cmp),r=[];return function o(s){if(s&&s.toJSON&&typeof s.toJSON=="function"&&(s=s.toJSON()),s!==void 0){if(typeof s=="number")return isFinite(s)?""+s:"null";if(typeof s!="object")return JSON.stringify(s);var a,u;if(Array.isArray(s)){for(u="[",a=0;a<s.length;a++)a&&(u+=","),u+=o(s[a])||"null";return u+"]"}if(s===null)return"null";if(r.indexOf(s)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(s)-1,c=Object.keys(s).sort(i&&i(s));for(u="",a=0;a<c.length;a++){var f=c[a],d=o(s[f]);d&&(u&&(u+=","),u+=JSON.stringify(f)+":"+d)}return r.splice(l,1),"{"+u+"}"}}(e)};const K2=_g($te);function J2(e){return!!e.or}function Q2(e){return!!e.and}function Z2(e){return!!e.not}function Bd(e,t){if(Z2(e))Bd(e.not,t);else if(Q2(e))for(const n of e.and)Bd(n,t);else if(J2(e))for(const n of e.or)Bd(n,t);else t(e)}function Ya(e,t){return Z2(e)?{not:Ya(e.not,t)}:Q2(e)?{and:e.and.map(n=>Ya(n,t))}:J2(e)?{or:e.or.map(n=>Ya(n,t))}:t(e)}const Ui=kte,oe=Ste;function HN(e){throw new Error(e)}function vu(e,t){const n={};for(const i of t)ne(e,i)&&(n[i]=e[i]);return n}function gn(e,t){const n={...e};for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>K2(e)).join(",")})`};const Ne=K2;function ge(e){if(Ae(e))return e;const t=Y(e)?e:K2(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function My(e){return e===!1||e===null}function pe(e,t){return e.includes(t)}function Ys(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function ew(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function GN(e,...t){for(const n of t)Ate(e,n??{});return e}function Ate(e,t){for(const n of P(t))jc(e,n,t[n],!0)}function qi(e,t){const n=[],i={};let r;for(const o of e)r=t(o),!(r in i)&&(i[r]=1,n.push(o));return n}function Cte(e,t){const n=P(e),i=P(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function YN(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function tw(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Fy(e){const t=new Set;for(const n of e){const r=or(n).map((s,a)=>a===0?s:`[${s}]`),o=r.map((s,a)=>r.slice(0,a+1).join(""));for(const s of o)t.add(s)}return t}function nw(e,t){return e===void 0||t===void 0?!0:tw(Fy(e),Fy(t))}function Me(e){return P(e).length===0}const P=Object.keys,wt=Object.values,Po=Object.entries;function Oc(e){return e===!0||e===!1}function Le(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function oc(e,t){return Z2(e)?`!(${oc(e.not,t)})`:Q2(e)?`(${e.and.map(n=>oc(n,t)).join(") && (")})`:J2(e)?`(${e.or.map(n=>oc(n,t)).join(") || (")})`:t(e)}function sg(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&sg(e[n],t)&&delete e[n],Me(e)}function vf(e){return e.charAt(0).toUpperCase()+e.substr(1)}function iw(e,t="datum"){const n=or(e),i=[];for(let r=1;r<=n.length;r++){const o=`[${n.slice(0,r).map(j).join("][")}]`;i.push(`${t}${o}`)}return i.join(" && ")}function VN(e,t="datum"){return`${t}[${j(or(e).join("."))}]`}function Mte(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Kn(e){return`${or(e).map(Mte).join("\\.")}`}function Vs(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function rw(e){return`${or(e).join(".")}`}function wu(e){return e?or(e).length:0}function Ve(...e){for(const t of e)if(t!==void 0)return t}let XN=42;function KN(e){const t=++XN;return e?String(e)+t:t}function Fte(){XN=42}function JN(e){return QN(e)?e:`__${e}`}function QN(e){return e.startsWith("__")}function Rc(e){if(e!==void 0)return(e%360+360)%360}function Pp(e){return Ae(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const Or="row",Rr="column",Lp="facet",Ie="x",dt="y",Ci="x2",fr="y2",Xo="xOffset",Vu="yOffset",Mi="radius",Gr="radius2",Zn="theta",Yr="theta2",Fi="latitude",Ti="longitude",Di="latitude2",Jn="longitude2",wn="color",dr="fill",hr="stroke",_n="shape",Vr="size",ha="angle",Xr="opacity",Ko="fillOpacity",Jo="strokeOpacity",Qo="strokeWidth",Zo="strokeDash",wf="text",_u="order",_f="detail",Ip="key",Xs="tooltip",Bp="href",jp="url",Up="description",Tte={x:1,y:1,x2:1,y2:1},ZN={theta:1,theta2:1,radius:1,radius2:1};function eO(e){return e in ZN}const ow={longitude:1,longitude2:1,latitude:1,latitude2:1};function tO(e){switch(e){case Fi:return"y";case Di:return"y2";case Ti:return"x";case Jn:return"x2"}}function nO(e){return e in ow}const Dte=P(ow),sw={...Tte,...ZN,...ow,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function Va(e){return e===wn||e===dr||e===hr}const iO={row:1,column:1,facet:1},qn=P(iO),aw={...sw,...iO},Nte=P(aw),{order:Kce,detail:Jce,tooltip:Qce,...Ote}=aw,{row:Zce,column:efe,facet:tfe,...Rte}=Ote;function zte(e){return!!Rte[e]}function rO(e){return!!aw[e]}const Pte=[Ci,fr,Di,Jn,Yr,Gr];function oO(e){return ga(e)!==e}function ga(e){switch(e){case Ci:return Ie;case fr:return dt;case Di:return Fi;case Jn:return Ti;case Yr:return Zn;case Gr:return Mi}return e}function Lo(e){if(eO(e))switch(e){case Zn:return"startAngle";case Yr:return"endAngle";case Mi:return"outerRadius";case Gr:return"innerRadius"}return e}function gr(e){switch(e){case Ie:return Ci;case dt:return fr;case Fi:return Di;case Ti:return Jn;case Zn:return Yr;case Mi:return Gr}}function Sn(e){switch(e){case Ie:case Ci:return"width";case dt:case fr:return"height"}}function sO(e){switch(e){case Ie:return"xOffset";case dt:return"yOffset";case Ci:return"x2Offset";case fr:return"y2Offset";case Zn:return"thetaOffset";case Mi:return"radiusOffset";case Yr:return"theta2Offset";case Gr:return"radius2Offset"}}function uw(e){switch(e){case Ie:return"xOffset";case dt:return"yOffset"}}function aO(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const Lte=P(sw),{x:nfe,y:ife,x2:rfe,y2:ofe,xOffset:sfe,yOffset:afe,latitude:ufe,longitude:lfe,latitude2:cfe,longitude2:ffe,theta:dfe,theta2:hfe,radius:gfe,radius2:pfe,...lw}=sw,Ite=P(lw),cw={x:1,y:1},pr=P(cw);function ht(e){return e in cw}const fw={theta:1,radius:1},Bte=P(fw);function qp(e){return e==="width"?Ie:dt}const uO={xOffset:1,yOffset:1};function Xu(e){return e in uO}const{text:mfe,tooltip:yfe,href:bfe,url:xfe,description:vfe,detail:wfe,key:_fe,order:Sfe,...lO}=lw,jte=P(lO);function Ute(e){return!!lw[e]}function qte(e){switch(e){case wn:case dr:case hr:case Vr:case _n:case Xr:case Qo:case Zo:return!0;case Ko:case Jo:case ha:return!1}}const cO={...cw,...fw,...uO,...lO},Wp=P(cO);function Kr(e){return!!cO[e]}function Wte(e,t){return Gte(e)[t]}const fO={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:Efe,...Hte}=fO;function Gte(e){switch(e){case wn:case dr:case hr:case Up:case _f:case Ip:case Xs:case Bp:case _u:case Xr:case Ko:case Jo:case Qo:case Lp:case Or:case Rr:return fO;case Ie:case dt:case Xo:case Vu:case Fi:case Ti:return Hte;case Ci:case fr:case Di:case Jn:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Vr:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Zo:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case _n:return{point:"always",geoshape:"always"};case wf:return{text:"always"};case ha:return{point:"always",square:"always",text:"always"};case jp:return{image:"always"};case Zn:return{text:"always",arc:"always"};case Mi:return{text:"always",arc:"always"};case Yr:case Gr:return{arc:"always"}}}function F0(e){switch(e){case Ie:case dt:case Zn:case Mi:case Xo:case Vu:case Vr:case ha:case Qo:case Xr:case Ko:case Jo:case Ci:case fr:case Yr:case Gr:return;case Lp:case Or:case Rr:case _n:case Zo:case wf:case Xs:case Bp:case jp:case Up:return"discrete";case wn:case dr:case hr:return"flexible";case Fi:case Ti:case Di:case Jn:case _f:case Ip:case _u:return}}const Yte={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Vte={count:1,min:1,max:1};function jr(e){return!!e&&!!e.argmin}function es(e){return!!e&&!!e.argmax}function dw(e){return Y(e)&&!!Yte[e]}const Xte=new Set(["count","valid","missing","distinct"]);function dO(e){return Y(e)&&Xte.has(e)}function Kte(e){return Y(e)&&pe(["min","max"],e)}const Jte=new Set(["count","sum","distinct","valid","missing"]),Qte=new Set(["mean","average","median","q1","q3","min","max"]);function hO(e){return ia(e)&&(e=nm(e,void 0)),"bin"+P(e).map(t=>Hp(e[t])?Le(`_${t}_${Po(e[t])}`):Le(`_${t}_${e[t]}`)).join("")}function Oe(e){return e===!0||pa(e)&&!e.binned}function yt(e){return e==="binned"||pa(e)&&e.binned===!0}function pa(e){return V(e)}function Hp(e){return e==null?void 0:e.param}function p$(e){switch(e){case Or:case Rr:case Vr:case wn:case dr:case hr:case Qo:case Xr:case Ko:case Jo:case _n:return 6;case Zo:return 4;default:return 10}}function Sf(e){return!!(e!=null&&e.expr)}function ln(e){const t=P(e||{}),n={};for(const i of t)n[i]=Mn(e[i]);return n}function gO(e){const{anchor:t,frame:n,offset:i,orient:r,angle:o,limit:s,color:a,subtitleColor:u,subtitleFont:l,subtitleFontSize:c,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:h,subtitlePadding:g,...p}=e,m={...p,...a?{fill:a}:{}},y={...t?{anchor:t}:{},...n?{frame:n}:{},...i?{offset:i}:{},...r?{orient:r}:{},...o!==void 0?{angle:o}:{},...s!==void 0?{limit:s}:{}},b={...u?{subtitleColor:u}:{},...l?{subtitleFont:l}:{},...c?{subtitleFontSize:c}:{},...f?{subtitleFontStyle:f}:{},...d?{subtitleFontWeight:d}:{},...h?{subtitleLineHeight:h}:{},...g?{subtitlePadding:g}:{}},x=vu(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:x,nonMarkTitleProperties:y,subtitle:b}}function uo(e){return Y(e)||z(e)&&Y(e[0])}function Q(e){return!!(e!=null&&e.signal)}function ts(e){return!!e.step}function Zte(e){return z(e)?!1:"fields"in e&&!("data"in e)}function ene(e){return z(e)?!1:"fields"in e&&"data"in e}function Fr(e){return z(e)?!1:"field"in e&&"data"in e}const tne={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},nne=P(tne),ine={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Ty=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function pO(e){const t=z(e.condition)?e.condition.map(m$):m$(e.condition);return{...Mn(e),condition:t}}function Mn(e){if(Sf(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function m$(e){if(Sf(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function ze(e){if(Sf(e)){const{expr:t,...n}=e;return{signal:t,...n}}return Q(e)?e:e!==void 0?{value:e}:void 0}function rne(e){return Q(e)?e.signal:j(e)}function y$(e){return Q(e)?e.signal:j(e.value)}function hi(e){return Q(e)?e.signal:e==null?null:j(e)}function one(e,t,n){for(const i of n){const r=Ur(i,t.markDef,t.config);r!==void 0&&(e[i]=ze(r))}return e}function mO(e){return[].concat(e.type,e.style??[])}function ke(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:o}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:o&&(!r||r===e)?void 0:Ur(e,t,n,i)}function Ur(e,t,n,{vgChannel:i}={}){return Ve(i?ag(e,t,n.style):void 0,ag(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function ag(e,t,n){return yO(e,mO(t),n)}function yO(e,t,n){t=H(t);let i;for(const r of t){const o=n[r];o&&o[e]!==void 0&&(i=o[e])}return i}function bO(e,t){return H(e).reduce((n,i)=>(n.field.push(W(i,t)),n.order.push(i.sort??"ascending"),n),{field:[],order:[]})}function xO(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Ui(r,i))return;n.push(i)}),n}function vO(e,t){return Ui(e,t)||!t?e:e?[...H(e),...H(t)].join(", "):t}function wO(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((uo(n)||Q(n))&&(uo(i)||Q(i)))return{explicit:e.explicit,value:vO(n,i)};if(uo(n)||Q(n))return{explicit:e.explicit,value:n};if(uo(i)||Q(i))return{explicit:e.explicit,value:i};if(!uo(n)&&!Q(n)&&!uo(i)&&!Q(i))return{explicit:e.explicit,value:xO(n,i)};throw new Error("It should never reach here")}function hw(e){return`Invalid specification ${Ne(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const sne='Autosize "fit" only works for single views and layered views.';function b$(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function x$(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function v$(e){return e?`Dropping "fit-${e}" because spec has discrete ${Sn(e)}.`:'Dropping "fit" because spec has discrete size.'}function gw(e){return`Unknown field for ${e}. Cannot calculate view size.`}function w$(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function ane(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function une(e){return`The "nearest" transform is not supported for ${e} marks.`}function _O(e){return`Selection not supported for ${e} yet.`}function lne(e){return`Cannot find a selection named "${e}".`}const cne="Scale bindings are currently only supported for scales with unbinned, continuous domains.",fne="Legend bindings are only supported for selections over an individual field or encoding channel.";function dne(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function hne(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const gne="The same selection must be used to override scale domains in a layered view.",pne='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function mne(e){return`Unknown repeated value "${e}".`}function _$(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const yne="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function bne(e){return`Unrecognized parse "${e}".`}function S$(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const xne="Attempt to add the same child twice.";function vne(e){return`Ignoring an invalid transform: ${Ne(e)}.`}const wne='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function E$(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function _ne(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Ne(t)} is overridden by a child projection ${Ne(n)}.`}const Sne="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Ene(e){return`${e}Offset dropped because ${e} is continuous`}function kne(e){return`There is no ${e} encoding. Replacing ${e}Offset encoding as ${e}.`}function $ne(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Ne(n)}}.`}function SO(e){return`Invalid field type "${e}".`}function Ane(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Cne(e){return`Invalid aggregation operator "${e}".`}function EO(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Mne(e){return`Position range does not support relative band size for ${e}.`}function Dy(e,t){return`Dropping ${Ne(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const Fne="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Gp(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function Tne(e){return`${e} encoding has no scale, so specified scale is ignored.`}function Dne(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function Nne(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function One(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function Rne(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function T0(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function zne(e){return`The ${e} for range marks cannot be an expression`}function Pne(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function Lne(e,t){return`Specified orient "${e}" overridden with "${t}".`}function Ine(e){return`Cannot use the scale property "${e}" with non-color channel.`}function Bne(e){return`Cannot use the relative band size with ${e} scale.`}function jne(e){return`Using unaggregated domain with raw field has no effect (${Ne(e)}).`}function Une(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function qne(e){return`Unaggregated domain is currently unsupported for log scale (${Ne(e)}).`}function Wne(e){return`Cannot apply size to non-oriented mark "${e}".`}function Hne(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Gne(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function kO(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function $O(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Yne(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ne(n)} and ${Ne(i)}). Using ${Ne(n)}.`}function Vne(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ne(n)} and ${Ne(i)}). Using the union of the two domains.`}function Xne(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Kne(e){return`Dropping sort property ${Ne(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const k$="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Jne="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Qne="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Zne="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function eie(e){return`Cannot stack "${e}" if there is already "${e}2".`}function tie(e){return`Cannot stack non-linear scale (${e}).`}function nie(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function ug(e,t){return`Invalid ${e}: ${Ne(t)}.`}function iie(e){return`Dropping day from datetime ${Ne(e)} as day cannot be combined with other units.`}function rie(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function oie(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function sie(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function $$(e){return`1D error band does not support ${e}.`}function AO(e){return`Channel ${e} is required for "binned" bin.`}function aie(e){return`Channel ${e} should not be used with "binned" bin.`}function uie(e){return`Domain for ${e} is required for threshold scale.`}globalThis&&globalThis.__classPrivateFieldSet;globalThis&&globalThis.__classPrivateFieldGet;const CO=rb(ib);let Su=CO;function lie(e){return Su=e,Su}function cie(){return Su=CO,Su}function L(...e){Su.warn(...e)}function fie(...e){Su.debug(...e)}function ma(e){if(e&&V(e)){for(const t of mw)if(t in e)return!0}return!1}const MO=["january","february","march","april","may","june","july","august","september","october","november","december"],die=MO.map(e=>e.substr(0,3)),FO=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],hie=FO.map(e=>e.substr(0,3));function gie(e){if(Pp(e)&&(e=+e),Ae(e))return e>4&&L(ug("quarter",e)),e-1;throw new Error(ug("quarter",e))}function pie(e){if(Pp(e)&&(e=+e),Ae(e))return e-1;{const t=e.toLowerCase(),n=MO.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=die.indexOf(i);if(r!==-1)return r;throw new Error(ug("month",e))}}function mie(e){if(Pp(e)&&(e=+e),Ae(e))return e%7;{const t=e.toLowerCase(),n=FO.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=hie.indexOf(i);if(r!==-1)return r;throw new Error(ug("day",e))}}function pw(e,t){const n=[];if(t&&e.day!==void 0&&P(e).length>1&&(L(iie(e)),e=oe(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?pie(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?gie(e.quarter):e.quarter;n.push(Ae(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?mie(e.day):e.day;n.push(Ae(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r>"u"?0:r)}return n}function Ks(e){const n=pw(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function yie(e){const n=pw(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function bie(e){const t=pw(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const TO={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},mw=P(TO);function xie(e){return!!TO[e]}function yw(e){return e.startsWith("utc")}function vie(e){return e.substr(3)}const wie={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Yp(e){return mw.filter(t=>DO(e,t))}function _ie(e){const t=Yp(e);return t[t.length-1]}function DO(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function Sie(e,t,{end:n}={end:!1}){const i=iw(t),r=yw(e)?"utc":"";function o(u){return u==="quarter"?`(${r}quarter(${i})-1)`:`${r}${u}(${i})`}let s;const a={};for(const u of mw)DO(e,u)&&(a[u]=o(u),s=u);return n&&(a[s]+="+1"),yie(a)}function NO(e){if(!e)return;const t=Yp(e);return`timeUnitSpecifier(${Ne(t)}, ${Ne(wie)})`}function Eie(e,t,n){if(!e)return;const i=NO(e);return`${n||yw(e)?"utc":"time"}Format(${t}, ${i})`}function St(e){if(!e)return;let t;return Y(e)?t={unit:e}:V(e)&&(t={...e,...e.unit?{unit:e.unit}:{}}),yw(t.unit)&&(t.utc=!0,t.unit=vie(t.unit)),t}function kie(e){const{utc:t,...n}=St(e);return n.unit?(t?"utc":"")+P(n).map(i=>Le(`${i==="unit"?"":`_${i}_`}${n[i]}`)).join(""):(t?"utc":"")+"timeunit"+P(n).map(i=>Le(`_${i}_${n[i]}`)).join("")}function OO(e,t=n=>n){const n=St(e),i=_ie(n.unit);if(i&&i!=="day"){const r={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},o=n.step||1,s={...r,...i==="quarter"?{month:+r.month+o*3}:i==="week"?{date:+r.date+o*7}:{[i]:+r[i]+o}};return`${t(Ks(s))} - ${t(Ks(r))}`}}function $ie(e){return e==null?void 0:e.param}function bw(e){return!!(e!=null&&e.field)&&e.equal!==void 0}function xw(e){return!!(e!=null&&e.field)&&e.lt!==void 0}function vw(e){return!!(e!=null&&e.field)&&e.lte!==void 0}function ww(e){return!!(e!=null&&e.field)&&e.gt!==void 0}function _w(e){return!!(e!=null&&e.field)&&e.gte!==void 0}function Sw(e){if(e!=null&&e.field){if(z(e.range)&&e.range.length===2)return!0;if(Q(e.range))return!0}return!1}function Ew(e){return!!(e!=null&&e.field)&&(z(e.oneOf)||z(e.in))}function Aie(e){return!!(e!=null&&e.field)&&e.valid!==void 0}function RO(e){return Ew(e)||bw(e)||Sw(e)||xw(e)||ww(e)||vw(e)||_w(e)}function Ri(e,t){return im(e,{timeUnit:t,wrapTime:!0})}function Cie(e,t){return e.map(n=>Ri(n,t))}function zO(e,t=!0){var o;const{field:n}=e,i=(o=St(e.timeUnit))==null?void 0:o.unit,r=i?`time(${Sie(i,n)})`:W(e,{expr:"datum"});if(bw(e))return`${r}===${Ri(e.equal,i)}`;if(xw(e)){const s=e.lt;return`${r}<${Ri(s,i)}`}else if(ww(e)){const s=e.gt;return`${r}>${Ri(s,i)}`}else if(vw(e)){const s=e.lte;return`${r}<=${Ri(s,i)}`}else if(_w(e)){const s=e.gte;return`${r}>=${Ri(s,i)}`}else{if(Ew(e))return`indexof([${Cie(e.oneOf,i).join(",")}], ${r}) !== -1`;if(Aie(e))return kw(r,e.valid);if(Sw(e)){const{range:s}=e,a=Q(s)?{signal:`${s.signal}[0]`}:s[0],u=Q(s)?{signal:`${s.signal}[1]`}:s[1];if(a!==null&&u!==null&&t)return"inrange("+r+", ["+Ri(a,i)+", "+Ri(u,i)+"])";const l=[];return a!==null&&l.push(`${r} >= ${Ri(a,i)}`),u!==null&&l.push(`${r} <= ${Ri(u,i)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${Ne(e)}`)}function kw(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function Mie(e){var t;return RO(e)&&e.timeUnit?{...e,timeUnit:(t=St(e.timeUnit))==null?void 0:t.unit}:e}const Ef={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function Fie(e){return e==="quantitative"||e==="temporal"}function PO(e){return e==="ordinal"||e==="nominal"}const Js=Ef.quantitative,$w=Ef.ordinal,Eu=Ef.temporal,Aw=Ef.nominal,Ku=Ef.geojson;function Tie(e){if(e)switch(e=e.toLowerCase(),e){case"q":case Js:return"quantitative";case"t":case Eu:return"temporal";case"o":case $w:return"ordinal";case"n":case Aw:return"nominal";case Ku:return"geojson"}}const pn={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Ny={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Die(e,t){const n=Ny[e],i=Ny[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const Nie={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function A$(e){return Nie[e]}const LO=new Set(["linear","log","pow","sqrt","symlog"]),IO=new Set([...LO,"time","utc"]);function BO(e){return LO.has(e)}const jO=new Set(["quantile","quantize","threshold"]),Oie=new Set([...IO,...jO,"sequential","identity"]),Rie=new Set(["ordinal","bin-ordinal","point","band"]);function gt(e){return Rie.has(e)}function Pn(e){return Oie.has(e)}function gi(e){return IO.has(e)}function ku(e){return jO.has(e)}const zie={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0};function Pie(e){return!Y(e)&&!!e.name}function UO(e){return e==null?void 0:e.param}function Lie(e){return e==null?void 0:e.unionWith}function Iie(e){return V(e)&&"field"in e}const Bie={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:kfe,domain:$fe,range:Afe,rangeMax:Cfe,rangeMin:Mfe,scheme:Ffe,...jie}=Bie,Uie=P(jie);function Oy(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return gi(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return gi(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return gi(e);case"nice":return gi(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return Pn(e)&&!pe(["log","time","utc","threshold","quantile"],e)}}function qO(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Va(e)?void 0:Ine(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function qie(e,t){return pe([$w,Aw],t)?e===void 0||gt(e):t===Eu?pe([pn.TIME,pn.UTC,void 0],e):t===Js?BO(e)||ku(e)||e===void 0:!0}function Wie(e,t,n=!1){if(!Kr(e))return!1;switch(e){case Ie:case dt:case Xo:case Vu:case Zn:case Mi:return gi(t)||t==="band"?!0:t==="point"?!n:!1;case Vr:case Qo:case Xr:case Ko:case Jo:case ha:return gi(t)||ku(t)||pe(["band","point","ordinal"],t);case wn:case dr:case hr:return t!=="band";case Zo:case _n:return t==="ordinal"||ku(t)}}const on={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},WO=on.arc,Vp=on.area,Xp=on.bar,Hie=on.image,Kp=on.line,Jp=on.point,Gie=on.rect,lg=on.rule,HO=on.text,Cw=on.tick,Yie=on.trail,Mw=on.circle,Fw=on.square,GO=on.geoshape;function ns(e){return["line","area","trail"].includes(e)}function YO(e){return["rect","bar","image","arc"].includes(e)}const Vie=new Set(P(on));function nr(e){return e.type}const Xie=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Kie=["fill","fillOpacity"],Jie=[...Xie,...Kie],Qie={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},C$=P(Qie),Zie={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],line:["point"],tick:["bandSize","thickness"]},ere={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},tre={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},VO=P(tre);function Qs(e){return e&&e.band!=null}const nre={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},XO=5,ire={binSpacing:1,continuousBandSize:XO,minBandSize:.25,timeUnitBandPosition:.5},rre={binSpacing:0,continuousBandSize:XO,minBandSize:.25,timeUnitBandPosition:.5},ore={thickness:1};function sre(e){return nr(e)?e.type:e}function Tw(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:o}=e,s=Nw(e);return I(n)&&!dO(n.aggregate)&&r&&gi(r.get("type"))?are({fieldDef:n,channel:t,markDef:i,ref:s,config:o}):s}function are({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return ns(n.type)?i:ke("invalid",n,r)===null?[ure(e,t),i]:i}function ure(e,t){const n=Dw(e,!0),r=ga(t)==="y"?{field:{group:"height"}}:{value:0};return{test:n,...r}}function Dw(e,t=!0){return kw(Y(e)?e:W(e,{expr:"datum"}),!t)}function lre(e){const{datum:t}=e;return ma(t)?Ks(t):`${Ne(t)}`}function Ns(e,t,n,i){const r={};if(t&&(r.scale=t),mr(e)){const{datum:o}=e;ma(o)?r.signal=Ks(o):Q(o)?r.signal=o.signal:Sf(o)?r.signal=o.expr:r.value=o}else r.field=W(e,n);if(i){const{offset:o,band:s}=i;o&&(r.offset=o),s&&(r.band=s)}return r}function cg({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:o=.5}){const s=0<o&&o<1?"datum":void 0,a=W(t,{expr:s,suffix:r}),u=n!==void 0?W(n,{expr:s}):W(t,{suffix:"end",expr:s}),l={};if(o===0||o===1){l.scale=e;const c=o===0?a:u;l.field=c}else{const c=Q(o)?`${o.signal} * ${a} + (1-${o.signal}) * ${u}`:`${o} * ${a} + ${1-o} * ${u}`;l.signal=`scale("${e}", ${c})`}return i&&(l.offset=i),l}function cre({scaleName:e,fieldDef:t}){const n=W(t,{expr:"datum"}),i=W(t,{expr:"datum",suffix:"end"});return`abs(scale("${e}", ${i}) - scale("${e}", ${n}))`}function Nw({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:s,stack:a,offset:u,defaultRef:l,bandPosition:c}){if(t){if(se(t)){const f=s==null?void 0:s.get("type");if(nn(t)){c??(c=i6({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:d,timeUnit:h,type:g}=t;if(Oe(d)||c&&h&&g===Eu)return a!=null&&a.impute?Ns(t,o,{binSuffix:"mid"},{offset:u}):c&&!gt(f)?cg({scaleName:o,fieldOrDatumDef:t,bandPosition:c,offset:u}):Ns(t,o,Cf(t,e)?{binSuffix:"range"}:{},{offset:u});if(yt(d)){if(I(n))return cg({scaleName:o,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:c,offset:u});L(AO(e===Ie?Ci:fr))}}return Ns(t,o,gt(f)?{binSuffix:"range"}:{},{offset:u,band:f==="band"?c??t.bandPosition??.5:void 0})}else if(Si(t)){const f=t.value,d=u?{offset:u}:{};return{...sc(e,f),...d}}}return ue(l)&&(l=l()),l&&{...l,...u?{offset:u}:{}}}function sc(e,t){return pe(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:pe(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:ze(t)}function Zs(e){return e&&e!=="number"&&e!=="time"}function KO(e,t,n){return`${e}(${t}${n?`, ${Ne(n)}`:""})`}const fre=" – ";function Ow({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o}){var u,l;if(Zs(n))return pi({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:o});const s=JO(e,i,r),a=$u(e);if(t===void 0&&n===void 0&&o.customFormatTypes){if(a==="quantitative"){if(r&&o.normalizedNumberFormatType)return pi({fieldOrDatumDef:e,format:o.normalizedNumberFormat,formatType:o.normalizedNumberFormatType,expr:i,config:o});if(o.numberFormatType)return pi({fieldOrDatumDef:e,format:o.numberFormat,formatType:o.numberFormatType,expr:i,config:o})}if(a==="temporal"&&o.timeFormatType&&I(e)&&e.timeUnit===void 0)return pi({fieldOrDatumDef:e,format:o.timeFormat,formatType:o.timeFormatType,expr:i,config:o})}if(Cu(e)){const c=hre({field:s,timeUnit:I(e)?(u=St(e.timeUnit))==null?void 0:u.unit:void 0,format:t,formatType:o.timeFormatType,rawTimeFormat:o.timeFormat,isUTCScale:ya(e)&&((l=e.scale)==null?void 0:l.type)===pn.UTC});return c?{signal:c}:void 0}if(t=Ry({type:a,specifiedFormat:t,config:o,normalizeStack:r}),I(e)&&Oe(e.bin)){const c=W(e,{expr:i,binSuffix:"end"});return{signal:kf(s,c,t,n,o)}}else return t||$u(e)==="quantitative"?{signal:`${e6(s,t)}`}:{signal:`isValid(${s}) ? ${s} : ""+${s}`}}function JO(e,t,n){return I(e)?n?`${W(e,{expr:t,suffix:"end"})}-${W(e,{expr:t,suffix:"start"})}`:W(e,{expr:t}):lre(e)}function pi({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o,field:s}){if(s??(s=JO(e,i,r)),s!=="datum.value"&&I(e)&&Oe(e.bin)){const a=W(e,{expr:i,binSuffix:"end"});return{signal:kf(s,a,t,n,o)}}return{signal:KO(n,s,t)}}function QO(e,t,n,i,r,o){var s;if(!(Y(i)&&Zs(i))&&!(n===void 0&&i===void 0&&r.customFormatTypes&&$u(e)==="quantitative"&&(r.normalizedNumberFormatType&&Au(e)&&e.stack==="normalize"||r.numberFormatType))){if(Au(e)&&e.stack==="normalize"&&r.normalizedNumberFormat)return Ry({type:"quantitative",config:r,normalizeStack:!0});if(Cu(e)){const a=I(e)?(s=St(e.timeUnit))==null?void 0:s.unit:void 0;return a===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:dre({specifiedFormat:n,timeUnit:a,config:r,omitTimeFormatConfig:o})}return Ry({type:t,specifiedFormat:n,config:r})}}function ZO(e,t,n){var i;if(e&&(Q(e)||e==="number"||e==="time"))return e;if(Cu(t)&&n!=="time"&&n!=="utc")return I(t)&&((i=St(t==null?void 0:t.timeUnit))!=null&&i.utc)?"utc":"time"}function Ry({type:e,specifiedFormat:t,config:n,normalizeStack:i}){if(Y(t))return t;if(e===Js)return i?n.normalizedNumberFormat:n.numberFormat}function dre({specifiedFormat:e,timeUnit:t,config:n,omitTimeFormatConfig:i}){return e||(t?{signal:NO(t)}:i?void 0:n.timeFormat)}function e6(e,t){return`format(${e}, "${t||""}")`}function M$(e,t,n,i){return Zs(n)?KO(n,e,t):e6(e,(Y(t)?t:void 0)??i.numberFormat)}function kf(e,t,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return kf(e,t,r.numberFormat,r.numberFormatType,r);const o=M$(e,n,i,r),s=M$(t,n,i,r);return`${kw(e,!1)} ? "null" : ${o} + "${fre}" + ${s}`}function hre({field:e,timeUnit:t,format:n,formatType:i,rawTimeFormat:r,isUTCScale:o}){return!t||n?!t&&i?`${i}(${e}, '${n}')`:(n=Y(n)?n:r,`${o?"utc":"time"}Format(${e}, '${n}')`):Eie(t,e,o)}const Qp="min",gre={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function F$(e){return e in gre}function t6(e){return!!(e!=null&&e.encoding)}function Yi(e){return e&&(e.op==="count"||!!e.field)}function n6(e){return e&&z(e)}function $f(e){return"row"in e||"column"in e}function Rw(e){return!!e&&"header"in e}function Zp(e){return"facet"in e}function pre(e){return e.param}function mre(e){return e&&!Y(e)&&"repeat"in e}function T$(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return{...n?{timeUnit:n}:{},...i?{bin:i}:{},...r?{aggregate:r}:{},field:t}}function zw(e){return"sort"in e}function i6({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(se(e)&&e.bandPosition!==void 0)return e.bandPosition;if(I(e)){const{timeUnit:r,bin:o}=e;if(r&&!t)return YO(n.type)?0:Ur("timeUnitBandPosition",n,i);if(Oe(o))return .5}}function r6({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:o,useVlSizeChannel:s}){var l,c,f;const a=Sn(e),u=ke(s?"size":a,i,r,{vgChannel:a});if(u!==void 0)return u;if(I(t)){const{timeUnit:d,bin:h}=t;if(d&&!n)return{band:Ur("timeUnitBandSize",i,r)};if(Oe(h)&&!gt(o))return{band:1}}if(YO(i.type))return o?gt(o)?((l=r[i.type])==null?void 0:l.discreteBandSize)||{band:1}:(c=r[i.type])==null?void 0:c.continuousBandSize:(f=r[i.type])==null?void 0:f.discreteBandSize}function o6(e,t,n,i){return Oe(e.bin)||e.timeUnit&&nn(e)&&e.type==="temporal"?i6({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function s6(e){return e&&!!e.sort&&!e.field}function em(e){return e&&"condition"in e}function tm(e){const t=e==null?void 0:e.condition;return!!t&&!z(t)&&I(t)}function Af(e){const t=e==null?void 0:e.condition;return!!t&&!z(t)&&se(t)}function yre(e){const t=e==null?void 0:e.condition;return!!t&&(z(t)||Si(t))}function I(e){return e&&(!!e.field||e.aggregate==="count")}function $u(e){return e==null?void 0:e.type}function mr(e){return e&&"datum"in e}function vo(e){return nn(e)&&!dg(e)||fg(e)}function D$(e){return nn(e)&&e.type==="quantitative"&&!e.bin||fg(e)}function fg(e){return mr(e)&&Ae(e.datum)}function se(e){return I(e)||mr(e)}function nn(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function Si(e){return e&&"value"in e&&"value"in e}function ya(e){return e&&("scale"in e||"sort"in e)}function Au(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function a6(e){return e&&"legend"in e}function u6(e){return e&&("format"in e||"formatType"in e)}function bre(e){return gn(e,["legend","axis","header","scale"])}function xre(e){return"op"in e}function W(e,t={}){let n=e.field;const i=t.prefix;let r=t.suffix,o="";if(wre(e))n=JN("count");else{let s;if(!t.nofn)if(xre(e))s=e.op;else{const{bin:a,aggregate:u,timeUnit:l}=e;Oe(a)?(s=hO(a),r=(t.binSuffix??"")+(t.suffix??"")):u?es(u)?(o=`["${n}"]`,n=`argmax_${u.argmax}`):jr(u)?(o=`["${n}"]`,n=`argmin_${u.argmin}`):s=String(u):l&&(s=kie(l),r=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+(t.suffix??""))}s&&(n=n?`${s}_${n}`:s)}return r&&(n=`${n}_${r}`),i&&(n=`${i}_${n}`),t.forAs?rw(n):t.expr?VN(n,t.expr)+o:Kn(n)+o}function dg(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return I(e)&&!!e.bin;case"temporal":return!1}throw new Error(SO(e.type))}function vre(e){var t;return ya(e)&&ku((t=e.scale)==null?void 0:t.type)}function wre(e){return e.aggregate==="count"}function _re(e,t){var s;const{field:n,bin:i,timeUnit:r,aggregate:o}=e;if(o==="count")return t.countTitle;if(Oe(i))return`${n} (binned)`;if(r){const a=(s=St(r))==null?void 0:s.unit;if(a)return`${n} (${Yp(a).join("-")})`}else if(o)return es(o)?`${n} for max ${o.argmax}`:jr(o)?`${n} for min ${o.argmin}`:`${vf(o)} of ${n}`;return n}function Sre(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(es(t))return`${r} for argmax(${t.argmax})`;if(jr(t))return`${r} for argmin(${t.argmin})`;const o=St(i),s=t||(o==null?void 0:o.unit)||(o==null?void 0:o.maxbins)&&"timeunit"||Oe(n)&&"bin";return s?`${s.toUpperCase()}(${r})`:r}const l6=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Sre(e);default:return _re(e,t)}};let c6=l6;function f6(e){c6=e}function Ere(){f6(l6)}function Xa(e,t,{allowDisabling:n,includeDefault:i=!0}){var a;const r=(a=Pw(e))==null?void 0:a.title;if(!I(e))return r??e.title;const o=e,s=i?Lw(o,t):void 0;return n?Ve(r,o.title,s):r??o.title??s}function Pw(e){if(Au(e)&&e.axis)return e.axis;if(a6(e)&&e.legend)return e.legend;if(Rw(e)&&e.header)return e.header}function Lw(e,t){return c6(e,t)}function hg(e){if(u6(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}else{const t=Pw(e)??{},{format:n,formatType:i}=t;return{format:n,formatType:i}}}function kre(e,t){var o;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(zw(e)&&z(e.sort))return"ordinal";const{aggregate:n,bin:i,timeUnit:r}=e;if(r)return"temporal";if(i||n&&!es(n)&&!jr(n))return"quantitative";if(ya(e)&&((o=e.scale)!=null&&o.type))switch(Ny[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function ir(e){if(I(e))return e;if(tm(e))return e.condition}function tt(e){if(se(e))return e;if(Af(e))return e.condition}function d6(e,t,n,i={}){if(Y(e)||Ae(e)||ia(e)){const r=Y(e)?"string":Ae(e)?"number":"boolean";return L($ne(t,r,e)),{value:e}}return se(e)?gg(e,t,n,i):Af(e)?{...e,condition:gg(e.condition,t,n,i)}:e}function gg(e,t,n,i){if(u6(e)){const{format:r,formatType:o,...s}=e;if(Zs(o)&&!n.customFormatTypes)return L(E$(t)),gg(s,t,n,i)}else{const r=Au(e)?"axis":a6(e)?"legend":Rw(e)?"header":null;if(r&&e[r]){const{format:o,formatType:s,...a}=e[r];if(Zs(s)&&!n.customFormatTypes)return L(E$(t)),gg({...e,[r]:a},t,n,i)}}return I(e)?Iw(e,t,i):$re(e)}function $re(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Ae(n)?"quantitative":Y(n)?"nominal":ma(n)?"temporal":void 0,{...e,type:t}}function Iw(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:o,field:s}=e,a={...e};if(!n&&i&&!dw(i)&&!es(i)&&!jr(i)&&(L(Cne(i)),delete a.aggregate),r&&(a.timeUnit=St(r)),s&&(a.field=`${s}`),Oe(o)&&(a.bin=nm(o,t)),yt(o)&&!ht(t)&&L(aie(t)),nn(a)){const{type:u}=a,l=Tie(u);u!==l&&(a.type=l),u!=="quantitative"&&dO(i)&&(L(Ane(u,i)),a.type="quantitative")}else if(!oO(t)){const u=kre(a,t);a.type=u}if(nn(a)){const{compatible:u,warning:l}=Are(a,t)||{};u===!1&&L(l)}if(zw(a)&&Y(a.sort)){const{sort:u}=a;if(F$(u))return{...a,sort:{encoding:u}};const l=u.substr(1);if(u.charAt(0)==="-"&&F$(l))return{...a,sort:{encoding:l,order:"descending"}}}if(Rw(a)){const{header:u}=a;if(u){const{orient:l,...c}=u;if(l)return{...a,header:{...c,labelOrient:u.labelOrient||l,titleOrient:u.titleOrient||l}}}}return a}function nm(e,t){return ia(e)?{maxbins:p$(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?{...e,maxbins:p$(t)}:e}const Fa={compatible:!0};function Are(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Or:case Rr:case Lp:return dg(e)?Fa:{compatible:!1,warning:Nne(t)};case Ie:case dt:case Xo:case Vu:case wn:case dr:case hr:case wf:case _f:case Ip:case Xs:case Bp:case jp:case ha:case Zn:case Mi:case Up:return Fa;case Ti:case Jn:case Fi:case Di:return n!==Js?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Fa;case Xr:case Ko:case Jo:case Qo:case Vr:case Yr:case Gr:case Ci:case fr:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:Fa;case _n:case Zo:return!dg(e)&&!vre(e)?{compatible:!1,warning:One(t)}:Fa;case _u:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Fa}}function Cu(e){const{formatType:t}=hg(e);return t==="time"||!t&&Cre(e)}function Cre(e){return e&&(e.type==="temporal"||I(e)&&!!e.timeUnit)}function im(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var u;const o=t&&((u=St(t))==null?void 0:u.unit);let s=o||n==="temporal",a;return Sf(e)?a=e.expr:Q(e)?a=e.signal:ma(e)?(s=!0,a=Ks(e)):(Y(e)||Ae(e))&&s&&(a=`datetime(${Ne(e)})`,xie(o)&&(Ae(e)&&e<1e4||Y(e)&&isNaN(Date.parse(e)))&&(a=Ks({[o]:e}))),a?i&&s?`time(${a})`:a:r?void 0:Ne(e)}function h6(e,t){const{type:n}=e;return t.map(i=>{const r=im(i,{timeUnit:I(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function Cf(e,t){return Oe(e.bin)?Kr(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const N$={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Mf(e){return e==null?void 0:e.condition}const g6=["domain","grid","labels","ticks","title"],Mre={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},p6={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Fre={...p6,style:1,labelExpr:1,encoding:1};function O$(e){return!!Fre[e]}const Tre={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},m6=P(Tre);function Jr(e){return"mark"in e}class rm{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return Jr(t)?sre(t.mark)===this.name:!1}}function Os(e,t){const n=e&&e[t];return n?z(n)?Ys(n,i=>!!i.field):I(n)||tm(n):!1}function y6(e,t){const n=e&&e[t];return n?z(n)?Ys(n,i=>!!i.field):I(n)||mr(n)||Af(n):!1}function zy(e,t){if(ht(t)){const n=e[t];if((I(n)||mr(n))&&(PO(n.type)||I(n)&&n.timeUnit)){const i=uw(t);return y6(e,i)}}return!1}function Bw(e){return Ys(Nte,t=>{if(Os(e,t)){const n=e[t];if(z(n))return Ys(n,i=>!!i.aggregate);{const i=ir(n);return i&&!!i.aggregate}}return!1})}function b6(e,t){const n=[],i=[],r=[],o=[],s={};return jw(e,(a,u)=>{if(I(a)){const{field:l,aggregate:c,bin:f,timeUnit:d,...h}=a;if(c||d||f){const g=Pw(a),p=g==null?void 0:g.title;let m=W(a,{forAs:!0});const y={...p?[]:{title:Xa(a,t,{allowDisabling:!0})},...h,field:m};if(c){let b;if(es(c)?(b="argmax",m=W({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${m}.${l}`):jr(c)?(b="argmin",m=W({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${m}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(b=c),b){const x={op:b,as:m};l&&(x.field=l),o.push(x)}}else if(n.push(m),nn(a)&&Oe(f)){if(i.push({bin:f,field:l,as:m}),n.push(W(a,{binSuffix:"end"})),Cf(a,u)&&n.push(W(a,{binSuffix:"range"})),ht(u)){const b={field:`${m}_end`};s[`${u}2`]=b}y.bin="binned",oO(u)||(y.type=Js)}else if(d){r.push({timeUnit:d,field:l,as:m});const b=nn(a)&&a.type!==Eu&&"time";b&&(u===wf||u===Xs?y.formatType=b:Ute(u)?y.legend={formatType:b,...y.legend}:ht(u)&&(y.axis={formatType:b,...y.axis}))}s[u]=y}else n.push(l),s[u]=e[u]}else s[u]=e[u]}),{bins:i,timeUnits:r,aggregate:o,groupby:n,encoding:s}}function Dre(e,t,n){const i=Wte(t,n);if(i){if(i==="binned"){const r=e[t===Ci?Ie:dt];return!!(I(r)&&I(e[t])&&yt(r.bin))}}else return!1;return!0}function Nre(e,t,n,i){const r={};for(const o of P(e))rO(o)||L(Dne(o));for(let o of Lte){if(!e[o])continue;const s=e[o];if(Xu(o)){const a=aO(o),u=r[a];if(I(u)){if(Fie(u.type)&&I(s)&&!u.timeUnit){L(Ene(a));continue}}else o=a,L(kne(a))}if(o==="angle"&&t==="arc"&&!e.theta&&(L(Sne),o=Zn),!Dre(e,o,t)){L(Gp(o,t));continue}if(o===Vr&&t==="line"){const a=ir(e[o]);if(a!=null&&a.aggregate){L(Fne);continue}}if(o===wn&&(n?"fill"in e:"stroke"in e)){L(EO("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(o===_f||o===_u&&!z(s)&&!Si(s)||o===Xs&&z(s)){if(s){if(o===_u){const a=e[o];if(s6(a)){r[o]=a;continue}}r[o]=H(s).reduce((a,u)=>(I(u)?a.push(Iw(u,o)):L(Dy(u,o)),a),[])}}else{if(o===Xs&&s===null)r[o]=null;else if(!I(s)&&!mr(s)&&!Si(s)&&!em(s)&&!Q(s)){L(Dy(s,o));continue}r[o]=d6(s,o,i)}}return r}function om(e,t){const n={};for(const i of P(e)){const r=d6(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function Ore(e){const t=[];for(const n of P(e))if(Os(e,n)){const i=e[n],r=H(i);for(const o of r)I(o)?t.push(o):tm(o)&&t.push(o.condition)}return t}function jw(e,t,n){if(e)for(const i of P(e)){const r=e[i];if(z(r))for(const o of r)t.call(n,o,i);else t.call(n,r,i)}}function Rre(e,t,n,i){return e?P(e).reduce((r,o)=>{const s=e[o];return z(s)?s.reduce((a,u)=>t.call(i,a,u,o),r):t.call(i,r,s,o)},n):n}function x6(e,t){return P(t).reduce((n,i)=>{switch(i){case Ie:case dt:case Bp:case Up:case jp:case Ci:case fr:case Xo:case Vu:case Zn:case Yr:case Mi:case Gr:case Fi:case Ti:case Di:case Jn:case wf:case _n:case ha:case Xs:return n;case _u:if(e==="line"||e==="trail")return n;case _f:case Ip:{const r=t[i];if(z(r)||I(r))for(const o of H(r))o.aggregate||n.push(W(o,{}));return n}case Vr:if(e==="trail")return n;case wn:case dr:case hr:case Xr:case Ko:case Jo:case Zo:case Qo:{const r=ir(t[i]);return r&&!r.aggregate&&n.push(W(r,{})),n}}},[])}function zre(e){const{tooltip:t,...n}=e;if(!t)return{filteredEncoding:n};let i,r;if(z(t)){for(const o of t)o.aggregate?(i||(i=[]),i.push(o)):(r||(r=[]),r.push(o));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return z(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Py(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:s,titlePrefix:a})=>{const u=i?` of ${Uw(t)}`:"";return{field:s+t.field,type:t.type,title:Q(a)?{signal:`${a}"${escape(u)}"`}:a+u}}),o=Ore(n).map(bre);return{tooltip:[...r,...qi(o,ge)]}}function Uw(e){const{title:t,field:n}=e;return Ve(t,n)}function qw(e,t,n,i,r){const{scale:o,axis:s}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,extraEncoding:f={}})=>{const d=Uw(n);return v6(e,a,r,{mark:u,encoding:{[t]:{field:`${l}_${n.field}`,type:n.type,...d!==void 0?{title:d}:{},...o!==void 0?{scale:o}:{},...s!==void 0?{axis:s}:{}},...Y(c)?{[`${t}2`]:{field:`${c}_${n.field}`}}:{},...i,...f}})}}function v6(e,t,n,i){const{clip:r,color:o,opacity:s}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[{...i,mark:{...n[t],...r?{clip:r}:{},...o?{color:o}:{},...s?{opacity:s}:{},...nr(i.mark)?i.mark:{type:i.mark},style:`${a}-${String(t)}`,...ia(e[t])?{}:e[t]}}]:[]}function w6(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",o=i[r],s=i[`${r}2`],a=i[`${r}Error`],u=i[`${r}Error2`];return{continuousAxisChannelDef:ld(o,n),continuousAxisChannelDef2:ld(s,n),continuousAxisChannelDefError:ld(a,n),continuousAxisChannelDefError2:ld(u,n),continuousAxis:r}}function ld(e,t){if(e!=null&&e.aggregate){const{aggregate:n,...i}=e;return n!==t&&L(sie(n,t)),i}else return e}function _6(e,t){const{mark:n,encoding:i}=e,{x:r,y:o}=i;if(nr(n)&&n.orient)return n.orient;if(vo(r)){if(vo(o)){const s=I(r)&&r.aggregate,a=I(o)&&o.aggregate;if(!s&&a===t)return"vertical";if(!a&&s===t)return"horizontal";if(s===t&&a===t)throw new Error("Both x and y cannot have aggregate");return Cu(o)&&!Cu(r)?"horizontal":"vertical"}return"horizontal"}else{if(vo(o))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}const pg="boxplot",Pre=["box","median","outliers","rule","ticks"],Lre=new rm(pg,E6);function S6(e){return Ae(e)?"tukey":e}function E6(e,{config:t}){e={...e,encoding:om(e.encoding,t)};const{mark:n,encoding:i,params:r,projection:o,...s}=e,a=nr(n)?n:{type:n};r&&L(_O("boxplot"));const u=a.extent??t.boxplot.extent,l=ke("size",a,t),c=a.invalid,f=S6(u),{bins:d,timeUnits:h,transform:g,continuousAxisChannelDef:p,continuousAxis:m,groupby:y,aggregate:b,encodingWithoutContinuousAxis:x,ticksOrient:v,boxOrient:w,customTooltipWithoutAggregatedField:S}=Ire(e,u,t),{color:_,size:E,...A}=x,k=Ut=>qw(a,m,p,Ut,t.boxplot),$=k(A),D=k(x),M=k({...A,...E?{size:E}:{}}),F=Py([{fieldPrefix:f==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:f==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,x),C={type:"tick",color:"black",opacity:1,orient:v,invalid:c,aria:!1},O=f==="min-max"?F:Py([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,x),q=[...$({partName:"rule",mark:{type:"rule",invalid:c,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:O}),...$({partName:"rule",mark:{type:"rule",invalid:c,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:O}),...$({partName:"ticks",mark:C,positionPrefix:"lower_whisker",extraEncoding:O}),...$({partName:"ticks",mark:C,positionPrefix:"upper_whisker",extraEncoding:O})],G=[...f!=="tukey"?q:[],...D({partName:"box",mark:{type:"bar",...l?{size:l}:{},orient:w,invalid:c,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:F}),...M({partName:"median",mark:{type:"tick",invalid:c,...V(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{},...l?{size:l}:{},orient:v,aria:!1},positionPrefix:"mid_box",extraEncoding:F})];if(f==="min-max")return{...s,transform:(s.transform??[]).concat(g),layer:G};const K=`datum["lower_box_${p.field}"]`,ce=`datum["upper_box_${p.field}"]`,Be=`(${ce} - ${K})`,Qe=`${K} - ${u} * ${Be}`,ot=`${ce} + ${u} * ${Be}`,jt=`datum["${p.field}"]`,Xe={joinaggregate:k6(p.field),groupby:y},Zr={transform:[{filter:`(${Qe} <= ${jt}) && (${jt} <= ${ot})`},{aggregate:[{op:"min",field:p.field,as:`lower_whisker_${p.field}`},{op:"max",field:p.field,as:`upper_whisker_${p.field}`},{op:"min",field:`lower_box_${p.field}`,as:`lower_box_${p.field}`},{op:"max",field:`upper_box_${p.field}`,as:`upper_box_${p.field}`},...b],groupby:y}],layer:q},{tooltip:va,...is}=A,{scale:X,axis:le}=p,de=Uw(p),B=gn(le,["title"]),mt=v6(a,"outliers",t.boxplot,{transform:[{filter:`(${jt} < ${Qe}) || (${jt} > ${ot})`}],mark:"point",encoding:{[m]:{field:p.field,type:p.type,...de!==void 0?{title:de}:{},...X!==void 0?{scale:X}:{},...Me(B)?{}:{axis:B}},...is,..._?{color:_}:{},...S?{tooltip:S}:{}}})[0];let _e;const kt=[...d,...h,Xe];return mt?_e={transform:kt,layer:[mt,Zr]}:(_e=Zr,_e.transform.unshift(...kt)),{...s,layer:[_e,{transform:g,layer:G}]}}function k6(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function Ire(e,t,n){const i=_6(e,pg),{continuousAxisChannelDef:r,continuousAxis:o}=w6(e,i,pg),s=r.field,a=S6(t),u=[...k6(s),{op:"median",field:s,as:`mid_box_${s}`},{op:"min",field:s,as:(a==="min-max"?"lower_whisker_":"min_")+s},{op:"max",field:s,as:(a==="min-max"?"upper_whisker_":"max_")+s}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${s}"] - datum["lower_box_${s}"]`,as:`iqr_${s}`},{calculate:`min(datum["upper_box_${s}"] + datum["iqr_${s}"] * ${t}, datum["max_${s}"])`,as:`upper_whisker_${s}`},{calculate:`max(datum["lower_box_${s}"] - datum["iqr_${s}"] * ${t}, datum["min_${s}"])`,as:`lower_whisker_${s}`}],{[o]:c,...f}=e.encoding,{customTooltipWithoutAggregatedField:d,filteredEncoding:h}=zre(f),{bins:g,timeUnits:p,aggregate:m,groupby:y,encoding:b}=b6(h,n),x=i==="vertical"?"horizontal":"vertical",v=i,w=[...g,...p,{aggregate:[...m,...u],groupby:y},...l];return{bins:g,timeUnits:p,transform:w,groupby:y,aggregate:m,continuousAxisChannelDef:r,continuousAxis:o,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:v,customTooltipWithoutAggregatedField:d}}const Ww="errorbar",Bre=["ticks","rule"],jre=new rm(Ww,$6);function $6(e,{config:t}){e={...e,encoding:om(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,ticksOrient:s,markDef:a,outerSpec:u,tooltipEncoding:l}=A6(e,Ww,t);delete o.size;const c=qw(a,r,i,o,t.errorbar),f=a.thickness,d=a.size,h={type:"tick",orient:s,aria:!1,...f!==void 0?{thickness:f}:{},...d!==void 0?{size:d}:{}},g=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...f!==void 0?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return{...u,transform:n,...g.length>1?{layer:g}:{...g[0]}}}function Ure(e,t){const{encoding:n}=e;if(qre(n))return{orient:_6(e,t),inputType:"raw"};const i=Wre(n),r=Hre(n),o=n.x,s=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(se(a)&&se(u))throw new Error(`${t} cannot have both x2 and y2`);if(se(a)){if(vo(o))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(se(u)){if(vo(s))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(se(u)&&!se(a))throw new Error(`${t} cannot have xError2 without xError`);if(se(c)&&!se(l))throw new Error(`${t} cannot have yError2 without yError`);if(se(a)&&se(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(se(a)){if(vo(o))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(se(l)){if(vo(s))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function qre(e){return(se(e.x)||se(e.y))&&!se(e.x2)&&!se(e.y2)&&!se(e.xError)&&!se(e.xError2)&&!se(e.yError)&&!se(e.yError2)}function Wre(e){return se(e.x2)||se(e.y2)}function Hre(e){return se(e.xError)||se(e.xError2)||se(e.yError)||se(e.yError2)}function A6(e,t,n){const{mark:i,encoding:r,params:o,projection:s,...a}=e,u=nr(i)?i:{type:i};o&&L(_O(t));const{orient:l,inputType:c}=Ure(e,t),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:h,continuousAxisChannelDefError2:g,continuousAxis:p}=w6(e,l,t),{errorBarSpecificAggregate:m,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:x}=Gre(u,f,d,h,g,c,t,n),{[p]:v,[p==="x"?"x2":"y2"]:w,[p==="x"?"xError":"yError"]:S,[p==="x"?"xError2":"yError2"]:_,...E}=r,{bins:A,timeUnits:k,aggregate:$,groupby:D,encoding:M}=b6(E,n),F=[...$,...m],C=c!=="raw"?[]:D,O=Py(b,f,M,x);return{transform:[...a.transform??[],...A,...k,...F.length===0?[]:[{aggregate:F,groupby:C}],...y],groupby:C,continuousAxisChannelDef:f,continuousAxis:p,encodingWithoutContinuousAxis:M,ticksOrient:l==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:a,tooltipEncoding:O}}function Gre(e,t,n,i,r,o,s,a){let u=[],l=[];const c=t.field;let f,d=!1;if(o==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,g=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!=(g==="iqr")&&L(oie(h,g,s)),g==="stderr"||g==="stdev")u=[{op:g,field:c,as:`extent_${c}`},{op:h,field:c,as:`center_${c}`}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:`upper_${c}`},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:`lower_${c}`}],f=[{fieldPrefix:"center_",titlePrefix:vf(h)},{fieldPrefix:"upper_",titlePrefix:R$(h,g,"+")},{fieldPrefix:"lower_",titlePrefix:R$(h,g,"-")}],d=!0;else{let p,m,y;g==="ci"?(p="mean",m="ci0",y="ci1"):(p="median",m="q1",y="q3"),u=[{op:m,field:c,as:`lower_${c}`},{op:y,field:c,as:`upper_${c}`},{op:p,field:c,as:`center_${c}`}],f=[{fieldPrefix:"upper_",titlePrefix:Xa({field:c,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Xa({field:c,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Xa({field:c,aggregate:p,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&L(rie(e.center,e.extent)),o==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${c}`},{calculate:`datum["${c}"]`,as:`lower_${c}`}]):o==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:`upper_${c}`}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:`lower_${c}`}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:`lower_${c}`}));for(const h of l)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Vs(Vs(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function R$(e,t,n){return`${vf(e)} ${n} ${t}`}const Hw="errorband",Yre=["band","borders"],Vre=new rm(Hw,C6);function C6(e,{config:t}){e={...e,encoding:om(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,markDef:s,outerSpec:a,tooltipEncoding:u}=A6(e,Hw,t),l=s,c=qw(l,r,i,o,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const g={...l.interpolate?{interpolate:l.interpolate}:{},...l.tension&&l.interpolate?{tension:l.tension}:{}};return f?(d={...d,...g,ariaRoleDescription:"errorband"},h={...h,...g,aria:!1}):l.interpolate?L($$("interpolate")):l.tension&&L($$("tension")),{...a,transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:u})]}}const M6={};function Gw(e,t,n){const i=new rm(e,t);M6[e]={normalizer:i,parts:n}}function Xre(){return P(M6)}Gw(pg,E6,Pre);Gw(Ww,$6,Bre);Gw(Hw,C6,Yre);const Kre=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],F6={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},T6={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Jre=P(F6),Qre=P(T6),Zre={header:1,headerRow:1,headerColumn:1,headerFacet:1},D6=P(Zre),N6=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],eoe={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},toe={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Ei="_vgsid_",noe={point:{on:"click",fields:[Ei],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Yw(e){return e==="legend"||!!(e!=null&&e.legend)}function D0(e){return Yw(e)&&V(e)}function Vw(e){return!!(e!=null&&e.select)}function O6(e){const t=[];for(const n of e||[]){if(Vw(n))continue;const{expr:i,bind:r,...o}=n;if(r&&i){const s={...o,bind:r,init:i};t.push(s)}else{const s={...o,...i?{update:i}:{},...r?{bind:r}:{}};t.push(s)}}return t}function ioe(e){return sm(e)||Kw(e)||Xw(e)}function Xw(e){return"concat"in e}function sm(e){return"vconcat"in e}function Kw(e){return"hconcat"in e}function R6({step:e,offsetIsDiscrete:t}){return t?e.for??"offset":"position"}function rr(e){return V(e)&&e.step!==void 0}function z$(e){return e.view||e.width||e.height}const P$=20,roe={align:1,bounds:1,center:1,columns:1,spacing:1},ooe=P(roe);function soe(e,t,n){const i=n[t],r={},{spacing:o,columns:s}=i;o!==void 0&&(r.spacing=o),s!==void 0&&(Zp(e)&&!$f(e.facet)||Xw(e))&&(r.columns=s),sm(e)&&(r.columns=1);for(const a of ooe)if(e[a]!==void 0)if(a==="spacing"){const u=e[a];r[a]=Ae(u)?u:{row:u.row??o,column:u.column??o}}else r[a]=e[a];return r}function Ly(e,t){return e[t]??e[t==="width"?"continuousWidth":"continuousHeight"]}function mg(e,t){const n=yg(e,t);return rr(n)?n.step:z6}function yg(e,t){const n=e[t]??e[t==="width"?"discreteWidth":"discreteHeight"];return Ve(n,{step:e.step})}const z6=20,aoe={continuousWidth:200,continuousHeight:200,step:z6},uoe={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:aoe,mark:ere,arc:{},area:{},bar:ire,circle:{},geoshape:{},image:{},line:{},point:{},rect:rre,rule:{color:"black"},square:{},text:{color:"black"},tick:ore,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:zie,projection:{},legend:eoe,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:noe,style:{},title:{},facet:{spacing:P$},concat:{spacing:P$},normalizedNumberFormat:".0%"},vr=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],L$={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},I$={blue:vr[0],orange:vr[1],red:vr[2],teal:vr[3],green:vr[4],yellow:vr[5],purple:vr[6],pink:vr[7],brown:vr[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function loe(e={}){return{signals:[{name:"color",value:V(e)?{...I$,...e}:I$}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function coe(e){return{signals:[{name:"fontSize",value:V(e)?{...L$,...e}:L$}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function foe(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function P6(e){const t=P(e||{}),n={};for(const i of t){const r=e[i];n[i]=Mf(r)?pO(r):Mn(r)}return n}function doe(e){const t=P(e),n={};for(const i of t)n[i]=P6(e[i]);return n}const hoe=[...VO,...m6,...D6,"background","padding","legend","lineBreak","scale","style","title","view"];function L6(e={}){const{color:t,font:n,fontSize:i,selection:r,...o}=e,s=Sg({},oe(uoe),n?foe(n):{},t?loe(t):{},i?coe(i):{},o||{});r&&jc(s,"selection",r,!0);const a=gn(s,hoe);for(const u of["background","lineBreak","padding"])s[u]&&(a[u]=Mn(s[u]));for(const u of VO)s[u]&&(a[u]=ln(s[u]));for(const u of m6)s[u]&&(a[u]=P6(s[u]));for(const u of D6)s[u]&&(a[u]=ln(s[u]));return s.legend&&(a.legend=ln(s.legend)),s.scale&&(a.scale=ln(s.scale)),s.style&&(a.style=doe(s.style)),s.title&&(a.title=ln(s.title)),s.view&&(a.view=ln(s.view)),a}const goe=new Set(["view",...Vie]),poe=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],moe={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...Zie};function yoe(e){e=oe(e);for(const t of poe)delete e[t];if(e.axis)for(const t in e.axis)Mf(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Kre)delete e.legend[t];if(e.mark){for(const t of C$)delete e.mark[t];e.mark.tooltip&&V(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(O6(e.params)),delete e.params);for(const t of goe){for(const i of C$)delete e[t][i];const n=moe[t];if(n)for(const i of n)delete e[t][i];xoe(e,t)}for(const t of Xre())delete e[t];boe(e);for(const t in e)V(e[t])&&Me(e[t])&&delete e[t];return Me(e)?void 0:e}function boe(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=gO(e.title);Me(t)||(e.style["group-title"]={...e.style["group-title"],...t}),Me(n)||(e.style["group-subtitle"]={...e.style["group-subtitle"],...n}),Me(i)?delete e.title:e.title=i}function xoe(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const o={...r,...e.style[n??t]};Me(o)||(e.style[n??t]=o),i||delete e[t]}function am(e){return"layer"in e}function voe(e){return"repeat"in e}function woe(e){return!z(e.repeat)&&e.repeat.layer}class Jw{map(t,n){return Zp(t)?this.mapFacet(t,n):voe(t)?this.mapRepeat(t,n):Kw(t)?this.mapHConcat(t,n):sm(t)?this.mapVConcat(t,n):Xw(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(am(t))return this.mapLayer(t,n);if(Jr(t))return this.mapUnit(t,n);throw new Error(hw(t))}mapLayer(t,n){return{...t,layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))}}mapHConcat(t,n){return{...t,hconcat:t.hconcat.map(i=>this.map(i,n))}}mapVConcat(t,n){return{...t,vconcat:t.vconcat.map(i=>this.map(i,n))}}mapConcat(t,n){const{concat:i,...r}=t;return{...r,concat:i.map(o=>this.map(o,n))}}mapFacet(t,n){return{...t,spec:this.map(t.spec,n)}}mapRepeat(t,n){return{...t,spec:this.map(t.spec,n)}}}const _oe={zero:1,center:1,normalize:1};function Soe(e){return e in _oe}const Eoe=new Set([WO,Xp,Vp,lg,Jp,Mw,Fw,Kp,HO,Cw]),koe=new Set([Xp,Vp,WO]);function Ta(e){return I(e)&&$u(e)==="quantitative"&&!e.bin}function B$(e,t,{orient:n,type:i}){const r=t==="x"?"y":"radius",o=t==="x",s=e[t],a=e[r];if(I(s)&&I(a))if(Ta(s)&&Ta(a)){if(s.stack)return t;if(a.stack)return r;const u=I(s)&&!!s.aggregate,l=I(a)&&!!a.aggregate;if(u!==l)return u?t:r;if(o&&i==="bar"){if(n==="vertical")return r;if(n==="horizontal")return t}}else{if(Ta(s))return t;if(Ta(a))return r}else{if(Ta(s))return t;if(Ta(a))return r}}function $oe(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function I6(e,t){var d,h;const n=nr(e)?e:{type:e},i=n.type;if(!Eoe.has(i))return null;const r=B$(t,"x",n)||B$(t,"theta",n);if(!r)return null;const o=t[r],s=I(o)?W(o,{}):void 0,a=$oe(r),u=[],l=new Set;if(t[a]){const g=t[a],p=I(g)?W(g,{}):void 0;p&&p!==s&&(u.push(a),l.add(p));const m=a==="x"?"xOffset":"yOffset",y=t[m],b=I(y)?W(y,{}):void 0;b&&b!==s&&(u.push(m),l.add(b))}const c=Ite.reduce((g,p)=>{if(p!=="tooltip"&&Os(t,p)){const m=t[p];for(const y of H(m)){const b=ir(y);if(b.aggregate)continue;const x=W(b,{});(!x||!l.has(x))&&g.push({channel:p,fieldDef:b})}}return g},[]);let f;return o.stack!==void 0?ia(o.stack)?f=o.stack?"zero":null:f=o.stack:koe.has(i)&&(f="zero"),!f||!Soe(f)||Bw(t)&&c.length===0?null:(d=o==null?void 0:o.scale)!=null&&d.type&&((h=o==null?void 0:o.scale)==null?void 0:h.type)!==pn.LINEAR?(o!=null&&o.stack&&L(tie(o.scale.type)),null):se(t[gr(r)])?(o.stack!==void 0&&L(eie(r)),null):(I(o)&&o.aggregate&&!Jte.has(o.aggregate)&&L(nie(o.aggregate)),{groupbyChannels:u,groupbyFields:l,fieldChannel:r,impute:o.impute===null?!1:ns(i),stackBy:c,offset:f})}function Aoe(e){const{point:t,line:n,...i}=e;return P(i).length>1?i:i.type}function Coe(e){for(const t of["line","area","rule","trail"])e[t]&&(e={...e,[t]:gn(e[t],["point","line"])});return e}function N0(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?V(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?V(t.point)?t.point:{}:void 0}function j$(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Moe{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(Jr(t)){const{mark:i,encoding:r}=t,o=nr(i)?i:{type:i};switch(o.type){case"line":case"rule":case"trail":return!!N0(o,n[o.type],r);case"area":return!!N0(o,n[o.type],r)||!!j$(o,n[o.type])}}return!1}run(t,n,i){const{config:r}=n,{params:o,projection:s,mark:a,name:u,encoding:l,...c}=t,f=om(l,r),d=nr(a)?a:{type:a},h=N0(d,r[d.type],f),g=d.type==="area"&&j$(d,r[d.type]),p=[{name:u,...o?{params:o}:{},mark:Aoe({...d.type==="area"&&d.opacity===void 0&&d.fillOpacity===void 0?{opacity:.7}:{},...d}),encoding:gn(f,["shape"])}],m=I6(d,f);let y=f;if(m){const{fieldChannel:b,offset:x}=m;y={...f,[b]:{...f[b],...x?{stack:x}:{}}}}return y=gn(y,["y2","x2"]),g&&p.push({...s?{projection:s}:{},mark:{type:"line",...vu(d,["clip","interpolate","tension","tooltip"]),...g},encoding:y}),h&&p.push({...s?{projection:s}:{},mark:{type:"point",opacity:1,filled:!0,...vu(d,["clip","tooltip"]),...h},encoding:y}),i({...c,layer:p},{...n,config:Coe(r)})}}function Foe(e,t){return t?$f(e)?j6(e,t):B6(e,t):e}function O0(e,t){return t?j6(e,t):e}function Iy(e,t,n){const i=t[e];if(mre(i)){if(i.repeat in n)return{...t,[e]:n[i.repeat]};L(mne(i.repeat));return}return t}function B6(e,t){if(e=Iy("field",e,t),e!==void 0){if(e===null)return null;if(zw(e)&&Yi(e.sort)){const n=Iy("field",e.sort,t);e={...e,...n?{sort:n}:{}}}return e}}function U$(e,t){if(I(e))return B6(e,t);{const n=Iy("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function q$(e,t){if(se(e)){const n=U$(e,t);if(n)return n;if(em(e))return{condition:e.condition}}else{if(Af(e)){const n=U$(e.condition,t);if(n)return{...e,condition:n};{const{condition:i,...r}=e;return r}}return e}}function j6(e,t){const n={};for(const i in e)if(ne(e,i)){const r=e[i];if(z(r))n[i]=r.map(o=>q$(o,t)).filter(o=>o);else{const o=q$(r,t);o!==void 0&&(n[i]=o)}}return n}class Toe{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Jr(t)){const{encoding:n,mark:i}=t;if(i==="line"||nr(i)&&i.type==="line")for(const r of Pte){const o=ga(r),s=n[o];if(n[r]&&(I(s)&&!yt(s.bin)||mr(s)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:o}=t;return L(Pne(!!r.x2,!!r.y2)),i({...t,mark:V(o)?{...o,type:"rule"}:"rule"},n)}}class Doe extends Jw{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[Lre,jre,Vre,new Moe,new Toe]}map(t,n){if(Jr(t)){const i=Os(t.encoding,Or),r=Os(t.encoding,Rr),o=Os(t.encoding,Lp);if(i||r||o)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,o=O0(t.encoding,n.repeater),s={...t,...t.name?{name:[n.repeaterPrefix,t.name].filter(u=>u).join("_")}:{},...o?{encoding:o}:{}};if(i||r)return this.mapUnitWithParentEncodingOrProjection(s,n);const a=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(s,n.config))return u.run(s,n,a);return s}mapRepeat(t,n){return woe(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r,...o}=t,{row:s,column:a,layer:u}=i,{repeater:l={},repeaterPrefix:c=""}=n;return s||a?this.mapRepeat({...t,repeat:{...s?{row:s}:{},...a?{column:a}:{}},spec:{repeat:{layer:u},spec:r}},n):{...o,layer:u.map(f=>{const d={...l,layer:f},h=`${(r.name?`${r.name}_`:"")+c}child__layer_${Le(f)}`,g=this.mapLayerOrUnit(r,{...n,repeater:d,repeaterPrefix:h});return g.name=h,g})}}mapNonLayerRepeat(t,n){const{repeat:i,spec:r,data:o,...s}=t;!z(i)&&t.columns&&(t=gn(t,["columns"]),L(_$("repeat")));const a=[],{repeater:u={},repeaterPrefix:l=""}=n,c=!z(i)&&i.row||[u?u.row:null],f=!z(i)&&i.column||[u?u.column:null],d=z(i)&&i||[u?u.repeat:null];for(const g of d)for(const p of c)for(const m of f){const y={repeat:g,row:p,column:m,layer:u.layer},b=(r.name?`${r.name}_`:"")+l+"child__"+(z(i)?`${Le(g)}`:(i.row?`row_${Le(p)}`:"")+(i.column?`column_${Le(m)}`:"")),x=this.map(r,{...n,repeater:y,repeaterPrefix:b});x.name=b,a.push(gn(x,["data"]))}const h=z(i)?t.columns:i.column?i.column.length:1;return{data:r.data??o,align:"all",...s,columns:h,concat:a}}mapFacet(t,n){const{facet:i}=t;return $f(i)&&t.columns&&(t=gn(t,["columns"]),L(_$("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:o,parentProjection:s,config:a}=n,u=H$({parentProjection:s,projection:r}),l=W$({parentEncoding:o,encoding:O0(i,n.repeater)});return this.mapUnit({...t,...u?{projection:u}:{},...l?{encoding:l}:{}},{config:a})}mapFacetedUnit(t,n){const{row:i,column:r,facet:o,...s}=t.encoding,{mark:a,width:u,projection:l,height:c,view:f,params:d,encoding:h,...g}=t,{facetMapping:p,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:o},n),y=O0(s,n.repeater);return this.mapFacet({...g,...m,facet:p,spec:{...u?{width:u}:{},...c?{height:c}:{},...f?{view:f}:{},...l?{projection:l}:{},mark:a,encoding:y,...d?{params:d}:{}}},n)}getFacetMappingAndLayout(t,n){const{row:i,column:r,facet:o}=t;if(i||r){o&&L(Rne([...i?[Or]:[],...r?[Rr]:[]]));const s={},a={};for(const u of[Or,Rr]){const l=t[u];if(l){const{align:c,center:f,spacing:d,columns:h,...g}=l;s[u]=g;for(const p of["align","center","spacing"])l[p]!==void 0&&(a[p]??(a[p]={}),a[p][u]=l[p])}}return{facetMapping:s,layout:a}}else{const{align:s,center:a,spacing:u,columns:l,...c}=o;return{facetMapping:Foe(c,n.repeater),layout:{...s?{align:s}:{},...a?{center:a}:{},...u?{spacing:u}:{},...l?{columns:l}:{}}}}}mapLayer(t,{parentEncoding:n,parentProjection:i,...r}){const{encoding:o,projection:s,...a}=t,u={...r,parentEncoding:W$({parentEncoding:n,encoding:o,layer:!0}),parentProjection:H$({parentProjection:i,projection:s})};return super.mapLayer({...a,...t.name?{name:[u.repeaterPrefix,t.name].filter(l=>l).join("_")}:{}},u)}}function W$({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...P(e),...P(t)]);for(const o of r){const s=t[o],a=e[o];if(se(s)){const u={...a,...s};i[o]=u}else Af(s)?i[o]={...s,condition:{...a,...s.condition}}:s||s===null?i[o]=s:(n||Si(a)||Q(a)||se(a)||z(a))&&(i[o]=a)}}else i=t;return!i||Me(i)?void 0:i}function H$(e){const{parentProjection:t,projection:n}=e;return t&&n&&L(_ne({parentProjection:t,projection:n})),n??t}function Qw(e){return"filter"in e}function Noe(e){return(e==null?void 0:e.stop)!==void 0}function U6(e){return"lookup"in e}function Ooe(e){return"data"in e}function Roe(e){return"param"in e}function zoe(e){return"pivot"in e}function Poe(e){return"density"in e}function Loe(e){return"quantile"in e}function Ioe(e){return"regression"in e}function Boe(e){return"loess"in e}function joe(e){return"sample"in e}function Uoe(e){return"window"in e}function qoe(e){return"joinaggregate"in e}function Woe(e){return"flatten"in e}function Hoe(e){return"calculate"in e}function q6(e){return"bin"in e}function Goe(e){return"impute"in e}function Yoe(e){return"timeUnit"in e}function Voe(e){return"aggregate"in e}function Xoe(e){return"stack"in e}function Koe(e){return"fold"in e}function Joe(e){return"extent"in e&&!("density"in e)}function Qoe(e){return e.map(t=>Qw(t)?{filter:Ya(t.filter,Mie)}:t)}class Zoe extends Jw{map(t,n){return n.emptySelections??(n.emptySelections={}),n.selectionPredicates??(n.selectionPredicates={}),t=G$(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=G$(t,n),t.encoding){const i={};for(const[r,o]of Po(t.encoding))i[r]=W6(o,n);t={...t,encoding:i}}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const{selection:i,...r}=t;return i?{...r,params:Po(i).map(([o,s])=>{const{init:a,bind:u,empty:l,...c}=s;c.type==="single"?(c.type="point",c.toggle=!1):c.type==="multi"&&(c.type="point"),n.emptySelections[o]=l!=="none";for(const f of wt(n.selectionPredicates[o]??{}))f.empty=l!=="none";return{name:o,value:a,select:c,bind:u}})}:t}}function G$(e,t){const{transform:n,...i}=e;if(n){const r=n.map(o=>{if(Qw(o))return{filter:By(o,t)};if(q6(o)&&pa(o.bin))return{...o,bin:H6(o.bin)};if(U6(o)){const{selection:s,...a}=o.from;return s?{...o,from:{param:s,...a}}:o}return o});return{...i,transform:r}}return e}function W6(e,t){var i,r;const n=oe(e);if(I(n)&&pa(n.bin)&&(n.bin=H6(n.bin)),ya(n)&&((r=(i=n.scale)==null?void 0:i.domain)!=null&&r.selection)){const{selection:o,...s}=n.scale.domain;n.scale.domain={...s,...o?{param:o}:{}}}if(em(n))if(z(n.condition))n.condition=n.condition.map(o=>{const{selection:s,param:a,test:u,...l}=o;return a?o:{...l,test:By(o,t)}});else{const{selection:o,param:s,test:a,...u}=W6(n.condition,t);n.condition=s?n.condition:{...u,test:By(n.condition,t)}}return n}function H6(e){const t=e.extent;if(t!=null&&t.selection){const{selection:n,...i}=t;return{...e,extent:{...i,param:n}}}return e}function By(e,t){const n=i=>Ya(i,r=>{var o;const s=t.emptySelections[r]??!0,a={param:r,empty:s};return(o=t.selectionPredicates)[r]??(o[r]=[]),t.selectionPredicates[r].push(a),a});return e.selection?n(e.selection):Ya(e.test||e.filter,i=>i.selection?n(i.selection):i)}class jy extends Jw{map(t,n){const i=n.selections??[];if(t.params&&!Jr(t)){const r=[];for(const o of t.params)Vw(o)?i.push(o):r.push(o);t.params=r}return n.selections=i,super.map(t,n)}mapUnit(t,n){const i=n.selections;if(!i||!i.length)return t;const r=(n.path??[]).concat(t.name),o=[];for(const s of i)if(!s.views||!s.views.length)o.push(s);else for(const a of s.views)(Y(a)&&(a===t.name||r.includes(a))||z(a)&&a.map(u=>r.indexOf(u)).every((u,l,c)=>u!==-1&&(l===0||u>c[l-1])))&&o.push(s);return o.length&&(t.params=o),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=jy.prototype[e];jy.prototype[e]=function(n,i){return t.call(this,n,ese(n,i))}}function ese(e,t){return e.name?{...t,path:(t.path??[]).concat(e.name)}:t}function G6(e,t){t===void 0&&(t=L6(e.config));const n=rse(e,t),{width:i,height:r}=e,o=ose(n,{width:i,height:r,autosize:e.autosize},t);return{...n,...o?{autosize:o}:{}}}const tse=new Doe,nse=new Zoe,ise=new jy;function rse(e,t={}){const n={config:t};return ise.map(tse.map(nse.map(e,n),n),n)}function Y$(e){return Y(e)?{type:e}:e??{}}function ose(e,t,n){let{width:i,height:r}=t;const o=Jr(e)||am(e),s={};o?i=="container"&&r=="container"?(s.type="fit",s.contains="padding"):i=="container"?(s.type="fit-x",s.contains="padding"):r=="container"&&(s.type="fit-y",s.contains="padding"):(i=="container"&&(L(b$("width")),i=void 0),r=="container"&&(L(b$("height")),r=void 0));const a={type:"pad",...s,...n?Y$(n.autosize):{},...Y$(e.autosize)};if(a.type==="fit"&&!o&&(L(sne),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&L(x$("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&L(x$("height")),!Ui(a,{type:"pad"}))return a}function sse(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function ase(e){return e?`fit-${qp(e)}`:"fit"}const use=["background","padding"];function V$(e,t){const n={};for(const i of use)e&&e[i]!==void 0&&(n[i]=Mn(e[i]));return t&&(n.params=e.params),n}class Qr{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new Qr(oe(this.explicit),oe(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(t){return Ve(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of P(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Pi(e){return{explicit:!0,value:e}}function $n(e){return{explicit:!1,value:e}}function Y6(e){return(t,n,i,r)=>{const o=e(t.value,n.value);return o>0?t:o<0?n:um(t,n,i,r)}}function um(e,t,n,i){return e.explicit&&t.explicit&&L(Yne(n,i,e.value,t.value)),e}function Io(e,t,n,i,r=um){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Ui(e.value,t.value)?e:r(e,t,n,i)}class lse extends Qr{constructor(t={},n={},i=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function Mu(e){return"url"in e}function zc(e){return"values"in e}function V6(e){return"name"in e&&!Mu(e)&&!zc(e)&&!$o(e)}function $o(e){return e&&(X6(e)||K6(e)||Zw(e))}function X6(e){return"sequence"in e}function K6(e){return"sphere"in e}function Zw(e){return"graticule"in e}var De;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(De||(De={}));function J6(e){const{signals:t,hasLegend:n,index:i,...r}=e;return r.field=Kn(r.field),r}function ea(e,t=!0,n=It){if(z(e)){const i=e.map(r=>ea(r,t,n));return t?`[${i.join(", ")}]`:i}else if(ma(e))return n(t?Ks(e):bie(e));return t?n(Ne(e)):e}function cse(e,t){for(const n of wt(e.component.selection??{})){const i=n.name;let r=`${i}${jo}, ${n.resolve==="global"?"true":`{unit: ${Rs(e)}}`}`;for(const o of cm)o.defined(n)&&(o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(r=o.modifyExpr(e,n,r)));t.push({name:i+Use,on:[{events:{signal:n.name+jo},update:`modify(${j(n.name+ta)}, ${r})`}]})}return e_(t)}function fse(e,t){if(e.component.selection&&P(e.component.selection).length){const n=j(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Vo("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return e_(t)}function dse(e,t){let n=!1;for(const i of wt(e.component.selection??{})){const r=i.name,o=j(r+ta);if(t.filter(a=>a.name===r).length===0){const a=i.resolve==="global"?"union":i.resolve,u=i.type==="point"?", true, true)":")";t.push({name:i.name,update:`${gR}(${o}, ${j(a)}${u}`})}n=!0;for(const a of cm)a.defined(i)&&a.topLevelSignals&&(t=a.topLevelSignals(e,i,t))}return n&&t.filter(r=>r.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),e_(t)}function hse(e,t){const n=[...t],i=Rs(e,{escape:!1});for(const r of wt(e.component.selection??{})){const o={name:r.name+ta};if(r.project.hasSelectionId&&(o.transform=[{type:"collect",sort:{field:Ei}}]),r.init){const a=r.project.items.map(J6);o.values=r.project.hasSelectionId?r.init.map(u=>({unit:i,[Ei]:ea(u,!1)[0]})):r.init.map(u=>({unit:i,fields:a,values:ea(u,!1)}))}n.filter(a=>a.name===r.name+ta).length||n.push(o)}return n}function Q6(e,t){for(const n of wt(e.component.selection??{}))for(const i of cm)i.defined(n)&&i.marks&&(t=i.marks(e,n,t));return t}function gse(e,t){for(const n of e.children)Ye(n)&&(t=Q6(n,t));return t}function pse(e,t,n,i){const r=xR(e,t.param,t);return{signal:Pn(n.get("type"))&&z(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function e_(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class Ce{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){L(xne);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this);const i=t.parent.removeChild(t);this._parent=n,n.addChild(this,i),t.parent=this}}class Zt extends Ce{clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}constructor(t,n,i,r){super(t,n),this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${KN()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class Vi extends Ce{clone(){return new Vi(null,oe(this.formula))}constructor(t,n){super(t),this.formula=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,o)=>{const{field:s,timeUnit:a}=o;if(a){const u=W(o,{forAs:!0});r[ge({as:u,field:s,timeUnit:a})]={as:u,field:s,timeUnit:a}}return r},{});return Me(i)?null:new Vi(t,i)}static makeFromTransform(t,n){const{timeUnit:i,...r}={...n},o=St(i),s={...r,timeUnit:o};return new Vi(t,{[ge(s)]:s})}merge(t){this.formula={...this.formula};for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Po(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(wt(this.formula).map(t=>t.as))}dependentFields(){return new Set(wt(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${ge(this.formula)}`}assemble(){const t=[];for(const n of wt(this.formula)){const{field:i,as:r,timeUnit:o}=n,{unit:s,utc:a,...u}=St(o);t.push({field:Kn(i),type:"timeunit",...s?{units:Yp(s)}:{},...a?{timezone:"utc"}:{},...u,as:[r,`${r}_end`]})}return t}}const Ff="_tuple_fields";class mse{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const yse={defined:()=>!0,parse:(e,t,n)=>{const i=t.name,r=t.project??(t.project=new mse),o={},s={},a=new Set,u=(g,p)=>{const m=p==="visual"?g.channel:g.field;let y=Le(`${i}_${m}`);for(let b=1;a.has(y);b++)y=Le(`${i}_${m}_${b}`);return a.add(y),{[p]:y}},l=t.type,c=e.config.selection[l],f=n.value!==void 0?H(n.value):null;let{fields:d,encodings:h}=V(n.select)?n.select:{};if(!d&&!h&&f){for(const g of f)if(V(g))for(const p of P(g))zte(p)?(h||(h=[])).push(p):l==="interval"?(L(pne),h=c.encodings):(d??(d=[])).push(p)}!d&&!h&&(h=c.encodings,"fields"in c&&(d=c.fields));for(const g of h??[]){const p=e.fieldDef(g);if(p){let m=p.field;if(p.aggregate){L(ane(g,p.aggregate));continue}else if(!m){L(w$(g));continue}if(p.timeUnit){m=e.vgField(g);const y={timeUnit:p.timeUnit,as:m,field:p.field};s[ge(y)]=y}if(!o[m]){const y=l==="interval"&&Kr(g)&&Pn(e.getScaleComponent(g).get("type"))?"R":p.bin?"R-RE":"E",b={field:m,channel:g,type:y,index:r.items.length};b.signals={...u(b,"data"),...u(b,"visual")},r.items.push(o[m]=b),r.hasField[m]=o[m],r.hasSelectionId=r.hasSelectionId||m===Ei,nO(g)?(b.geoChannel=g,b.channel=tO(g),r.hasChannel[b.channel]=o[m]):r.hasChannel[g]=o[m]}}else L(w$(g))}for(const g of d??[]){if(r.hasField[g])continue;const p={type:"E",field:g,index:r.items.length};p.signals={...u(p,"data")},r.items.push(p),r.hasField[g]=p,r.hasSelectionId=r.hasSelectionId||g===Ei}f&&(t.init=f.map(g=>r.items.map(p=>V(g)?g[p.geoChannel||p.channel]!==void 0?g[p.geoChannel||p.channel]:g[p.field]:g))),Me(s)||(r.timeUnit=new Vi(null,s))},signals:(e,t,n)=>{const i=t.name+Ff;return n.filter(o=>o.name===i).length>0||t.project.hasSelectionId?n:n.concat({name:i,value:t.project.items.map(J6)})}},zr={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Kr(r))continue;const o=e.getScaleComponent(r),s=o?o.get("type"):void 0;if(!o||!Pn(s)){L(cne);continue}o.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(s=>n.filter(a=>a.name===s.signals.data).length===0);if(!e.parent||X$(e)||i.length===0)return n;const r=n.filter(s=>s.name===t.name)[0];let o=r.update;if(o.indexOf(gR)>=0)r.update=`{${i.map(s=>`${j(Kn(s.field))}: ${s.signals.data}`).join(", ")}}`;else{for(const s of i){const a=`${j(Kn(s.field))}: ${s.signals.data}`;o.includes(a)||(o=`${o.substring(0,o.length-1)}, ${a}}`)}r.update=o}return n.concat(i.map(s=>({name:s.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!X$(e))for(const i of t.scales){const r=n.filter(o=>o.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Uy(e,t){return`domain(${j(e.scaleName(t))})`}function X$(e){return e.parent&&tl(e.parent)&&!e.parent.parent}const Ka="_brush",Z6="_scale_trigger",wl="geo_interval_init_tick",eR="_init",bse="_center",xse={defined:e=>e.type==="interval",parse:(e,t,n)=>{var i;if(e.hasProjection){const r={...V(n.select)?n.select:{}};r.fields=[Ei],r.encodings||(r.encodings=n.value?P(n.value):[Ti,Fi]),n.select={type:"interval",...r}}if(t.translate&&!zr.defined(t)){const r=`!event.item || event.item.mark.name !== ${j(t.name+Ka)}`;for(const o of t.events){if(!o.between){L(`${o} is not an ordered event stream for interval selections.`);continue}const s=H((i=o.between[0]).filter??(i.filter=[]));s.indexOf(r)<0&&s.push(r)}}},signals:(e,t,n)=>{const i=t.name,r=i+jo,o=wt(t.project.hasChannel).filter(a=>a.channel===Ie||a.channel===dt),s=t.init?t.init[0]:null;if(n.push(...o.reduce((a,u)=>a.concat(vse(e,t,u,s&&s[u.index])),[])),e.hasProjection){const a=j(e.projectionName()),u=e.projectionName()+bse,{x:l,y:c}=t.project.hasChannel,f=l&&l.signals.visual,d=c&&c.signals.visual,h=l?s&&s[l.index]:`${u}[0]`,g=c?s&&s[c.index]:`${u}[1]`,p=w=>e.getSizeSignalRef(w).signal,m=`[[${f?f+"[0]":"0"}, ${d?d+"[0]":"0"}],[${f?f+"[1]":p("width")}, ${d?d+"[1]":p("height")}]]`;s&&(n.unshift({name:i+eR,init:`[scale(${a}, [${l?h[0]:h}, ${c?g[0]:g}]), scale(${a}, [${l?h[1]:h}, ${c?g[1]:g}])]`}),(!l||!c)&&(n.find(S=>S.name===u)||n.unshift({name:u,update:`invert(${a}, [${p("width")}/2, ${p("height")}/2])`})));const y=`intersect(${m}, {markname: ${j(e.getName("marks"))}}, unit.mark)`,b=`{unit: ${Rs(e)}}`,x=`vlSelectionTuples(${y}, ${b})`,v=o.map(w=>w.signals.visual);return n.concat({name:r,on:[{events:[...v.length?[{signal:v.join(" || ")}]:[],...s?[{signal:wl}]:[]],update:x}]})}else{if(!zr.defined(t)){const l=i+Z6,c=o.map(f=>{const d=f.channel,{data:h,visual:g}=f.signals,p=j(e.scaleName(d)),m=e.getScaleComponent(d).get("type"),y=Pn(m)?"+":"";return`(!isArray(${h}) || (${y}invert(${p}, ${g})[0] === ${y}${h}[0] && ${y}invert(${p}, ${g})[1] === ${y}${h}[1]))`});c.length&&n.push({name:l,value:{},on:[{events:o.map(f=>({scale:e.scaleName(f.channel)})),update:c.join(" && ")+` ? ${l} : {}`}]})}const a=o.map(l=>l.signals.data),u=`unit: ${Rs(e)}, fields: ${i+Ff}, values`;return n.concat({name:r,...s?{init:`{${u}: ${ea(s)}}`}:{},...a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${u}: [${a}]} : null`}]}:{}})}},topLevelSignals:(e,t,n)=>(Ye(e)&&e.hasProjection&&t.init&&(n.filter(r=>r.name===wl).length||n.unshift({name:wl,value:null,on:[{events:"timer{1}",update:`${wl} === null ? {} : ${wl}`}]})),n),marks:(e,t,n)=>{const i=t.name,{x:r,y:o}=t.project.hasChannel,s=r==null?void 0:r.signals.visual,a=o==null?void 0:o.signals.visual,u=`data(${j(t.name+ta)})`;if(zr.defined(t)||!r&&!o)return n;const l={x:r!==void 0?{signal:`${s}[0]`}:{value:0},y:o!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${s}[1]`}:{field:{group:"width"}},y2:o!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const p of P(l))l[p]=[{test:`${u}.length && ${u}[0].unit === ${Rs(e)}`,...l[p]},{value:0}];const{fill:c,fillOpacity:f,cursor:d,...h}=t.mark,g=P(h).reduce((p,m)=>(p[m]=[{test:[r!==void 0&&`${s}[0] !== ${s}[1]`,o!==void 0&&`${a}[0] !== ${a}[1]`].filter(y=>y).join(" && "),value:h[m]},{value:null}],p),{});return[{name:`${i+Ka}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:c},fillOpacity:{value:f}},update:l}},...n,{name:i+Ka,type:"rect",clip:!0,encode:{enter:{...d?{cursor:{value:d}}:{},fill:{value:"transparent"}},update:{...l,...g}}}]}};function vse(e,t,n,i){const r=!e.hasProjection,o=n.channel,s=n.signals.visual,a=j(r?e.scaleName(o):e.projectionName()),u=d=>`scale(${a}, ${d})`,l=e.getSizeSignalRef(o===Ie?"width":"height").signal,c=`${o}(unit)`,f=t.events.reduce((d,h)=>[...d,{events:h.between[0],update:`[${c}, ${c}]`},{events:h,update:`[${s}[0], clamp(${c}, 0, ${l})]`}],[]);if(r){const d=n.signals.data,h=zr.defined(t),g=e.getScaleComponent(o),p=g?g.get("type"):void 0,m=i?{init:ea(i,!0,u)}:{value:[]};return f.push({events:{signal:t.name+Z6},update:Pn(p)?`[${u(`${d}[0]`)}, ${u(`${d}[1]`)}]`:"[0, 0]"}),h?[{name:d,on:[]}]:[{name:s,...m,on:f},{name:d,...i?{init:ea(i)}:{},on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${a}, ${s})`}]}]}else{const d=o===Ie?0:1,h=t.name+eR,g=i?{init:`[${h}[0][${d}], ${h}[1][${d}]]`}:{value:[]};return[{name:s,...g,on:f}]}}const wse={defined:e=>e.type==="point",signals:(e,t,n)=>{const i=t.name,r=i+Ff,o=t.project,s="(item().isVoronoi ? datum.datum : datum)",a=wt(e.component.selection??{}).reduce((f,d)=>d.type==="interval"?f.concat(d.name+Ka):f,[]).map(f=>`indexof(item().mark.name, '${f}') < 0`).join(" && "),u=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${a?` && ${a}`:""}`;let l=`unit: ${Rs(e)}, `;if(t.project.hasSelectionId)l+=`${Ei}: ${s}[${j(Ei)}]`;else{const f=o.items.map(d=>{const h=e.fieldDef(d.channel);return h!=null&&h.bin?`[${s}[${j(e.vgField(d.channel,{}))}], ${s}[${j(e.vgField(d.channel,{binSuffix:"end"}))}]]`:`${s}[${j(d.field)}]`}).join(", ");l+=`fields: ${r}, values: [${f}]`}const c=t.events;return n.concat([{name:i+jo,on:c?[{events:c,update:`${u} ? {${l}} : null`,force:!0}]:[]}])}};function Ju(e,t,n,i){const r=em(t)&&t.condition,o=i(t);if(r){const a=H(r).map(u=>{const l=i(u);if(pre(u)){const{param:c,empty:f}=u;return{test:bR(e,{param:c,empty:f}),...l}}else return{test:vg(e,u.test),...l}});return{[n]:[...a,...o!==void 0?[o]:[]]}}else return o!==void 0?{[n]:o}:{}}function t_(e,t="text"){const n=e.encoding[t];return Ju(e,n,t,i=>lm(i,e.config))}function lm(e,t,n="datum"){if(e){if(Si(e))return ze(e.value);if(se(e)){const{format:i,formatType:r}=hg(e);return Ow({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function tR(e,t={}){const{encoding:n,markDef:i,config:r,stack:o}=e,s=n.tooltip;if(z(s))return{tooltip:K$({tooltip:s},o,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return Ju(e,s,"tooltip",u=>{const l=lm(u,r,a);if(l)return l;if(u===null)return;let c=ke("tooltip",i,r);if(c===!0&&(c={content:"encoding"}),Y(c))return{value:c};if(V(c))return Q(c)?c:c.content==="encoding"?K$(n,o,r,t):{signal:a}})}}function nR(e,t,n,{reactiveGeom:i}={}){const r={...n,...n.tooltipFormat},o={},s=i?"datum.datum":"datum",a=[];function u(c,f){const d=ga(f),h=nn(c)?c:{...c,type:e[d].type},g=h.title||Lw(h,r),p=H(g).join(", ");let m;if(ht(f)){const y=f==="x"?"x2":"y2",b=ir(e[y]);if(yt(h.bin)&&b){const x=W(h,{expr:s}),v=W(b,{expr:s}),{format:w,formatType:S}=hg(h);m=kf(x,v,w,S,r),o[y]=!0}}if((ht(f)||f===Zn||f===Mi)&&t&&t.fieldChannel===f&&t.offset==="normalize"){const{format:y,formatType:b}=hg(h);m=Ow({fieldOrDatumDef:h,format:y,formatType:b,expr:s,config:r,normalizeStack:!0}).signal}m??(m=lm(h,r,s).signal),a.push({channel:f,key:p,value:m})}jw(e,(c,f)=>{I(c)?u(c,f):tm(c)&&u(c.condition,f)});const l={};for(const{channel:c,key:f,value:d}of a)!o[c]&&!l[f]&&(l[f]=d);return l}function K$(e,t,n,{reactiveGeom:i}={}){const r=nR(e,t,n,{reactiveGeom:i}),o=Po(r).map(([s,a])=>`"${s}": ${a}`);return o.length>0?{signal:`{${o.join(", ")}}`}:void 0}function _se(e){const{markDef:t,config:n}=e,i=ke("aria",t,n);return i===!1?{}:{...i?{aria:i}:{},...Sse(e),...Ese(e)}}function Sse(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=ke("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in ine?{}:{ariaRoleDescription:{value:t}}}function Ese(e){const{encoding:t,markDef:n,config:i,stack:r}=e,o=t.description;if(o)return Ju(e,o,"description",u=>lm(u,e.config));const s=ke("description",n,i);if(s!=null)return{description:ze(s)};if(i.aria===!1)return{};const a=nR(t,r,i);if(!Me(a))return{description:{signal:Po(a).map(([u,l],c)=>`"${c>0?"; ":""}${u}: " + (${l})`).join(" + ")}}}function st(e,t,n={}){const{markDef:i,encoding:r,config:o}=t,{vgChannel:s}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u??(u=ke(e,i,o,{vgChannel:s,ignoreVgConfig:!0})),u!==void 0&&(a=ze(u)));const l=r[e];return Ju(t,l,s??e,c=>Nw({channel:e,channelDef:c,markDef:i,config:o,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function iR(e,t={filled:void 0}){const{markDef:n,encoding:i,config:r}=e,{type:o}=n,s=t.filled??ke("filled",n,r),a=pe(["bar","point","circle","square","geoshape"],o)?"transparent":void 0,u=ke(s===!0?"color":void 0,n,r,{vgChannel:"fill"})??r.mark[s===!0&&"color"]??a,l=ke(s===!1?"color":void 0,n,r,{vgChannel:"stroke"})??r.mark[s===!1&&"color"],c=s?"fill":"stroke",f={...u?{fill:ze(u)}:{},...l?{stroke:ze(l)}:{}};return n.color&&(s?n.fill:n.stroke)&&L(EO("property",{fill:"fill"in n,stroke:"stroke"in n})),{...f,...st("color",e,{vgChannel:c,defaultValue:s?u:l}),...st("fill",e,{defaultValue:i.fill?u:void 0}),...st("stroke",e,{defaultValue:i.stroke?l:void 0})}}function kse(e){const{encoding:t,mark:n}=e,i=t.order;return!ns(n)&&Si(i)?Ju(e,i,"zindex",r=>ze(r.value)):{}}function Fu({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const o=`${e}Offset`,s=t[o],a=n[o];if((o==="xOffset"||o==="yOffset")&&a)return{offsetType:"encoding",offset:Nw({channel:o,channelDef:a,markDef:t,config:i==null?void 0:i.config,scaleName:i.scaleName(o),scale:i.getScaleComponent(o),stack:null,defaultRef:ze(s),bandPosition:r})};const u=t[o];return u?{offsetType:"visual",offset:u}:{}}function Nt(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:o,config:s,stack:a}=t,u=r[e],l=r[gr(e)],c=t.scaleName(e),f=t.getScaleComponent(e),{offset:d,offsetType:h}=Fu({channel:e,markDef:o,encoding:r,model:t,bandPosition:.5}),g=n_({model:t,defaultPos:n,channel:e,scaleName:c,scale:f}),p=!u&&ht(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:$se({channel:e,channelDef:u,channel2Def:l,markDef:o,config:s,scaleName:c,scale:f,stack:a,offset:d,defaultRef:g,bandPosition:h==="encoding"?0:void 0});return p?{[i||e]:p}:void 0}function $se(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:o,markDef:s}=e;if(se(n)&&r&&t===r.fieldChannel){if(I(n)){let a=n.bandPosition;if(a===void 0&&s.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return cg({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:o})}return Ns(n,i,{suffix:"end"},{offset:o})}return Tw(e)}function n_({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:o,config:s}=e;return()=>{const a=ga(n),u=Lo(n),l=ke(n,o,s,{vgChannel:u});if(l!==void 0)return sc(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!pe([pn.LOG,pn.TIME,pn.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return{...e[Sn(n)],mult:.5}}}}const Ase={left:"x",center:"xc",right:"x2"},Cse={top:"y",middle:"yc",bottom:"y2"};function rR(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Lo(e);const r=e==="x"?"align":"baseline",o=ke(r,t,n);let s;return Q(o)?(L(zne(r)),s=void 0):s=o,e==="x"?Ase[s||(i==="top"?"left":"center")]:Cse[s||i]}function bg(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?oR(e,t,{defaultPos:n,defaultPos2:i}):Nt(e,t,{defaultPos:n})}function oR(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:o}=t,s=gr(e),a=Sn(e),u=Mse(t,i,s),l=u[a]?rR(e,r,o):Lo(e);return{...Nt(e,t,{defaultPos:n,vgChannel:l}),...u}}function Mse(e,t,n){const{encoding:i,mark:r,markDef:o,stack:s,config:a}=e,u=ga(n),l=Sn(n),c=Lo(n),f=i[u],d=e.scaleName(u),h=e.getScaleComponent(u),{offset:g}=n in i||n in o?Fu({channel:n,markDef:o,encoding:i,model:e}):Fu({channel:u,markDef:o,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=Sn(n),y=e.markDef[m];return y!=null?{[m]:{value:y}}:{[c]:{field:e.getName(n)}}}const p=Fse({channel:n,channelDef:f,channel2Def:i[n],markDef:o,config:a,scaleName:d,scale:h,stack:s,offset:g,defaultRef:void 0});return p!==void 0?{[c]:p}:cd(n,o)||cd(n,{[n]:ag(n,o,a.style),[l]:ag(l,o,a.style)})||cd(n,a[r])||cd(n,a.mark)||{[c]:n_({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function Fse({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:s,stack:a,offset:u,defaultRef:l}){return se(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Ns(t,o,{suffix:"start"},{offset:u}):Tw({channel:e,channelDef:n,scaleName:o,scale:s,stack:a,markDef:i,config:r,offset:u,defaultRef:l})}function cd(e,t){const n=Sn(e),i=Lo(e);if(t[i]!==void 0)return{[i]:sc(e,t[i])};if(t[e]!==void 0)return{[i]:sc(e,t[e])};if(t[n]){const r=t[n];if(Qs(r))L(Mne(n));else return{[n]:sc(e,r)}}}function Bo(e,t){const{config:n,encoding:i,markDef:r}=e,o=r.type,s=gr(t),a=Sn(t),u=i[t],l=i[s],c=e.getScaleComponent(t),f=c?c.get("type"):void 0,d=r.orient,h=i[a]??i.size??ke("size",r,n,{vgChannel:a}),g=sO(t),p=o==="bar"&&(t==="x"?d==="vertical":d==="horizontal");return I(u)&&(Oe(u.bin)||yt(u.bin)||u.timeUnit&&!l)&&!(h&&!Qs(h))&&!i[g]&&!gt(f)?Nse({fieldDef:u,fieldDef2:l,channel:t,model:e}):(se(u)&&gt(f)||p)&&!l?Dse(u,t,e):oR(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Tse(e,t,n,i,r,o,s){if(Qs(r))if(n){const u=n.get("type");if(u==="band"){let l=`bandwidth('${t}')`;r.band!==1&&(l=`${r.band} * ${l}`);const c=Ur("minBandSize",{type:s},i);return{signal:c?`max(${hi(c)}, ${l})`:l}}else r.band!==1&&(L(Bne(u)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(Q(r))return r;if(r)return{value:r}}if(n){const u=n.get("range");if(ts(u)&&Ae(u.step))return{value:u.step-2}}if(!o){const{bandPaddingInner:u,barBandPaddingInner:l,rectBandPaddingInner:c}=i.scale,f=Ve(u,s==="bar"?l:c);if(Q(f))return{signal:`(1 - (${f.signal})) * ${e}`};if(Ae(f))return{signal:`${1-f} * ${e}`}}return{value:mg(i.view,e)-2}}function Dse(e,t,n){const{markDef:i,encoding:r,config:o,stack:s}=n,a=i.orient,u=n.scaleName(t),l=n.getScaleComponent(t),c=Sn(t),f=gr(t),d=sO(t),h=n.scaleName(d),g=n.getScaleComponent(uw(t)),p=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let m;(r.size||i.size)&&(p?m=st("size",n,{vgChannel:c,defaultRef:ze(i.size)}):L(Wne(i.type)));const y=!!m,b=r6({channel:t,fieldDef:e,markDef:i,config:o,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:p});m=m||{[c]:Tse(c,h||u,g||l,o,b,!!e,i.type)};const x=(l==null?void 0:l.get("type"))==="band"&&Qs(b)&&!y?"top":"middle",v=rR(t,i,o,x),w=v==="xc"||v==="yc",{offset:S,offsetType:_}=Fu({channel:t,markDef:i,encoding:r,model:n,bandPosition:w?.5:0}),E=Tw({channel:t,channelDef:e,markDef:i,config:o,scaleName:u,scale:l,stack:s,offset:S,defaultRef:n_({model:n,defaultPos:"mid",channel:t,scaleName:u,scale:l}),bandPosition:w?_==="encoding"?0:.5:Q(b)?{signal:`(1-${b})/2`}:Qs(b)?(1-b.band)/2:0});if(c)return{[v]:E,...m};{const A=Lo(f),k=m[c],$=S?{...k,offset:S}:k;return{[v]:E,[A]:z(E)?[E[0],{...E[1],offset:$}]:{...E,offset:$}}}}function J$(e,t,n,i,r,o,s){if(eO(e))return 0;const a=e==="x"||e==="y2",u=a?-t/2:t/2;if(Q(n)||Q(r)||Q(i)||o){const l=hi(n),c=hi(r),f=hi(i),d=hi(o),g=o?`(${s} < ${d} ? ${a?"":"-"}0.5 * (${d} - (${s})) : ${u})`:u,p=f?`${f} + `:"",m=l?`(${l} ? -1 : 1) * `:"",y=c?`(${c} + ${g})`:g;return{signal:p+m+y}}else return r=r||0,i+(n?-r-u:+r+u)}function Nse({fieldDef:e,fieldDef2:t,channel:n,model:i}){var A;const{config:r,markDef:o,encoding:s}=i,a=i.getScaleComponent(n),u=i.scaleName(n),l=a?a.get("type"):void 0,c=a.get("reverse"),f=r6({channel:n,fieldDef:e,markDef:o,config:r,scaleType:l}),d=(A=i.component.axes[n])==null?void 0:A[0],h=(d==null?void 0:d.get("translate"))??.5,g=ht(n)?ke("binSpacing",o,r)??0:0,p=gr(n),m=Lo(n),y=Lo(p),b=Ur("minBandSize",o,r),{offset:x}=Fu({channel:n,markDef:o,encoding:s,model:i,bandPosition:0}),{offset:v}=Fu({channel:p,markDef:o,encoding:s,model:i,bandPosition:0}),w=cre({fieldDef:e,scaleName:u}),S=J$(n,g,c,h,x,b,w),_=J$(p,g,c,h,v??x,b,w),E=Q(f)?{signal:`(1-${f.signal})/2`}:Qs(f)?(1-f.band)/2:.5;if(Oe(e.bin)||e.timeUnit)return{[y]:Q$({fieldDef:e,scaleName:u,bandPosition:E,offset:_}),[m]:Q$({fieldDef:e,scaleName:u,bandPosition:Q(E)?{signal:`1-${E.signal}`}:1-E,offset:S})};if(yt(e.bin)){const k=Ns(e,u,{},{offset:_});if(I(t))return{[y]:k,[m]:Ns(t,u,{},{offset:S})};if(pa(e.bin)&&e.bin.step)return{[y]:k,[m]:{signal:`scale("${u}", ${W(e,{expr:"datum"})} + ${e.bin.step})`,offset:S}}}L(AO(p))}function Q$({fieldDef:e,scaleName:t,bandPosition:n,offset:i}){return cg({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i})}const Ose=new Set(["aria","width","height"]);function ei(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?iR(e):{};return{...Rse(e.markDef,t),...Z$(e,"fill",n),...Z$(e,"stroke",i),...st("opacity",e),...st("fillOpacity",e),...st("strokeOpacity",e),...st("strokeWidth",e),...st("strokeDash",e),...kse(e),...tR(e),...t_(e,"href"),..._se(e)}}function Z$(e,t,n){const{config:i,mark:r,markDef:o}=e;if(ke("invalid",o,i)==="hide"&&n&&!ns(r)){const a=zse(e,{invalid:!0,channels:Wp});if(a)return{[t]:[{test:a,value:null},...H(n)]}}return n?{[t]:n}:{}}function Rse(e,t){return nne.reduce((n,i)=>(!Ose.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=ze(e[i])),n),{})}function zse(e,{invalid:t=!1,channels:n}){const i=n.reduce((o,s)=>{const a=e.getScaleComponent(s);if(a){const u=a.get("type"),l=e.vgField(s,{expr:"datum"});l&&Pn(u)&&(o[l]=!0)}return o},{}),r=P(i);if(r.length>0){const o=t?"||":"&&";return r.map(s=>Dw(s,t)).join(` ${o} `)}}function i_(e){const{config:t,markDef:n}=e;if(ke("invalid",n,t)){const r=Pse(e,{channels:pr});if(r)return{defined:{signal:r}}}return{}}function Pse(e,{invalid:t=!1,channels:n}){const i=n.reduce((o,s)=>{var u;const a=e.getScaleComponent(s);if(a){const l=a.get("type"),c=e.vgField(s,{expr:"datum",binSuffix:(u=e.stack)!=null&&u.impute?"mid":void 0});c&&Pn(l)&&(o[c]=!0)}return o},{}),r=P(i);if(r.length>0){const o=t?"||":"&&";return r.map(s=>Dw(s,t)).join(` ${o} `)}}function eA(e,t){if(t!==void 0)return{[e]:ze(t)}}const R0="voronoi",sR={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(R0)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,o=e.mark;if(ns(o))return L(une(o)),n;const s={name:e.getName(R0),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...tR(e,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((l,c)=>{const f=l.name??"";f===e.component.mark[0].name?a=c:f.indexOf(R0)>=0&&(u=!0)}),u||n.splice(a+1,0,s),n}},aR={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Yw(e.bind),parse:(e,t,n)=>pR(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,o=t.bind,s=t.init&&t.init[0],a=sR.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((u,l)=>{const c=Le(`${i}_${u.field}`);n.filter(d=>d.name===c).length||n.unshift({name:c,...s?{init:ea(s[l])}:{value:null},on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${j(u.field)}] : null`}]:[],bind:o[u.field]??o[u.channel]??o})}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.filter(l=>l.name===i+jo)[0],s=i+Ff,a=r.items.map(l=>Le(`${i}_${l.field}`)),u=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(o.update=`${u} ? {fields: ${s}, values: [${a.join(", ")}]} : null`),delete o.value,delete o.on,n}},xg="_toggle",uR={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+xg,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+jo,i=t.name+xg;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Rs(e)}}, `)+`${i} ? ${n} : null`}},Lse={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=Y(t.clear)?Vo(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(aR.defined(t))for(const i of t.project.items){const r=n.findIndex(o=>o.name===Le(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,o){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:o})}if(t.type==="interval")for(const r of t.project.items){const o=n.findIndex(s=>s.name===r.signals.visual);if(i(o,"[0, 0]"),o===-1){const s=n.findIndex(a=>a.name===r.signals.data);i(s,"null")}}else{let r=n.findIndex(o=>o.name===t.name+jo);i(r,"null"),uR.defined(t)&&(r=n.findIndex(o=>o.name===t.name+xg),i(r,"false"))}return n}},lR={defined:e=>{const t=e.resolve==="global"&&e.bind&&Yw(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Ei;return t&&!n&&L(fne),t&&n},parse:(e,t,n)=>{const i=oe(n);if(i.select=Y(i.select)?{type:i.select,toggle:t.toggle}:{...i.select,toggle:t.toggle},pR(t,i),V(n.select)&&(n.select.on||n.select.clear)){const s='event.item && indexof(event.item.mark.role, "legend") < 0';for(const a of t.events)a.filter=H(a.filter??[]),a.filter.includes(s)||a.filter.push(s)}const r=D0(t.bind)?t.bind.legend:"click",o=Y(r)?Vo(r,"view"):H(r);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=D0(t.bind)&&t.bind.legend,o=s=>a=>{const u=oe(a);return u.markname=s,u};for(const s of t.project.items){if(!s.hasLegend)continue;const a=`${Le(s.field)}_legend`,u=`${i}_${a}`;if(n.filter(c=>c.name===u).length===0){const c=r.merge.map(o(`${a}_symbols`)).concat(r.merge.map(o(`${a}_labels`))).concat(r.merge.map(o(`${a}_entries`)));n.unshift({name:u,...t.init?{}:{value:null},on:[{events:c,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]})}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.find(d=>d.name===i+jo),s=i+Ff,a=r.items.filter(d=>d.hasLegend).map(d=>Le(`${i}_${Le(d.field)}_legend`)),l=`${a.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${s}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?o.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(o.update=l,delete o.value,delete o.on);const c=n.find(d=>d.name===i+xg),f=D0(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push({...c.on[0],events:f}):c.on[0].events=f),n}};function Ise(e,t,n){var r;const i=(r=e.fieldDef(t))==null?void 0:r.field;for(const o of wt(e.component.selection??{})){const s=o.project.hasField[i]??o.project.hasChannel[t];if(s&&lR.defined(o)){const a=n.get("selections")??[];a.push(o.name),n.set("selections",a,!1),s.hasLegend=!0}}}const cR="_translate_anchor",fR="_translate_delta",Bse={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=zr.defined(t),o=i+cR,{x:s,y:a}=t.project.hasChannel;let u=Vo(t.translate,"scope");return r||(u=u.map(l=>(l.between[0].markname=i+Ka,l))),n.push({name:o,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(s!==void 0?`, extent_x: ${r?Uy(e,Ie):`slice(${s.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?Uy(e,dt):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+fR,value:{},on:[{events:u,update:`{x: ${o}.x - x(unit), y: ${o}.y - y(unit)}`}]}),s!==void 0&&tA(e,t,s,"width",n),a!==void 0&&tA(e,t,a,"height",n),n}};function tA(e,t,n,i,r){const o=t.name,s=o+cR,a=o+fR,u=n.channel,l=zr.defined(t),c=r.filter(w=>w.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(u),h=d&&d.get("type"),g=d&&d.get("reverse"),p=l?u===Ie?g?"":"-":g?"-":"":"",m=`${s}.extent_${u}`,y=`${p}${a}.${u} / ${l?`${f}`:`span(${m})`}`,b=!l||!d?"panLinear":h==="log"?"panLog":h==="symlog"?"panSymlog":h==="pow"?"panPow":"panLinear",x=l?h==="pow"?`, ${d.get("exponent")??1}`:h==="symlog"?`, ${d.get("constant")??1}`:"":"",v=`${b}(${m}, ${y}${x})`;c.on.push({events:{signal:a},update:l?v:`clampRange(${v}, 0, ${f})`})}const dR="_zoom_anchor",hR="_zoom_delta",jse={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=zr.defined(t),o=i+hR,{x:s,y:a}=t.project.hasChannel,u=j(e.scaleName(Ie)),l=j(e.scaleName(dt));let c=Vo(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+Ka,f))),n.push({name:i+dR,on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),s!==void 0&&nA(e,t,s,"width",n),a!==void 0&&nA(e,t,a,"height",n),n}};function nA(e,t,n,i,r){const o=t.name,s=n.channel,a=zr.defined(t),u=r.filter(b=>b.name===n.signals[a?"data":"visual"])[0],l=e.getSizeSignalRef(i).signal,c=e.getScaleComponent(s),f=c&&c.get("type"),d=a?Uy(e,s):u.name,h=o+hR,g=`${o}${dR}.${s}`,p=!a||!c?"zoomLinear":f==="log"?"zoomLog":f==="symlog"?"zoomSymlog":f==="pow"?"zoomPow":"zoomLinear",m=a?f==="pow"?`, ${c.get("exponent")??1}`:f==="symlog"?`, ${c.get("constant")??1}`:"":"",y=`${p}(${d}, ${g}, ${h}${m})`;u.on.push({events:{signal:h},update:a?y:`clampRange(${y}, 0, ${l})`})}const ta="_store",jo="_tuple",Use="_modify",gR="vlSelectionResolve",cm=[wse,xse,yse,uR,aR,zr,lR,Lse,Bse,jse,sR];function qse(e){let t=e.parent;for(;t&&!xi(t);)t=t.parent;return t}function Rs(e,{escape:t}={escape:!0}){let n=t?j(e.name):e.name;const i=qse(e);if(i){const{facet:r}=i;for(const o of qn)r[o]&&(n+=` + '__facet_${o}_' + (facet[${j(i.vgField(o))}])`)}return n}function r_(e){return wt(e.component.selection??{}).reduce((t,n)=>t||n.project.hasSelectionId,!1)}function pR(e,t){(Y(t.select)||!t.select.on)&&delete e.events,(Y(t.select)||!t.select.clear)&&delete e.clear,(Y(t.select)||!t.select.toggle)&&delete e.toggle}function qy(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...qy(e.object)),t.push(...qy(e.property))),t)}function mR(e){return e.object.type==="MemberExpression"?mR(e.object):e.object.name==="datum"}function yR(e){const t=_2(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&mR(i)&&n.add(qy(i).slice(1).join("."))}),n}class Qu extends Ce{clone(){return new Qu(null,this.model,oe(this.filter))}constructor(t,n,i){super(t),this.model=n,this.filter=i,this.expr=vg(this.model,this.filter,this),this._dependentFields=yR(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Wse(e,t){const n={},i=e.config.selection;if(!t||!t.length)return n;for(const r of t){const o=Le(r.name),s=r.select,a=Y(s)?s:s.type,u=V(s)?oe(s):{type:a},l=i[a];for(const d in l)d==="fields"||d==="encodings"||(d==="mark"&&(u[d]={...l[d],...u[d]}),(u[d]===void 0||u[d]===!0)&&(u[d]=oe(l[d]??u[d])));const c=n[o]={...u,name:o,type:a,init:r.value,bind:r.bind,events:Y(u.on)?Vo(u.on,"scope"):H(oe(u.on))},f=oe(r);for(const d of cm)d.defined(c)&&d.parse&&d.parse(e,c,f)}return n}function bR(e,t,n,i="datum"){const r=Y(t)?t:t.param,o=Le(r),s=j(o+ta);let a;try{a=e.getSelectionComponent(o,r)}catch{return`!!${o}`}if(a.project.timeUnit){const d=n??e.component.data.raw,h=a.project.timeUnit.clone();d.parent?h.insertAsParentOf(d):d.parent=h}const u=a.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",l=a.resolve==="global"?")":`, ${j(a.resolve)})`,c=`${u}${s}, ${i}${l}`,f=`length(data(${s}))`;return t.empty===!1?`${f} && ${c}`:`!${f} || ${c}`}function xR(e,t,n){const i=Le(t),r=n.encoding;let o=n.field,s;try{s=e.getSelectionComponent(i,t)}catch{return i}if(!r&&!o)o=s.project.items[0].field,s.project.items.length>1&&L(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${j(o)}.`);else if(r&&!o){const a=s.project.items.filter(u=>u.channel===r);!a.length||a.length>1?(o=s.project.items[0].field,L((a.length?"Multiple ":"No ")+`matching ${j(r)} encoding found for selection ${j(n.param)}. Using "field": ${j(o)}.`)):o=a[0].field}return`${s.name}[${j(Kn(o))}]`}function Hse(e,t){for(const[n,i]of Po(e.component.selection??{})){const r=e.getName(`lookup_${n}`);e.component.data.outputNodes[r]=i.materialized=new Zt(new Qu(t,e,{param:n}),r,De.Lookup,e.component.data.outputNodeRefCounts)}}function vg(e,t,n){return oc(t,i=>Y(i)?i:$ie(i)?bR(e,i,n):zO(i))}function Gse(e,t){if(e)return z(e)&&!uo(e)?e.map(n=>Lw(n,t)).join(", "):e}function z0(e,t,n,i){var r,o;e.encode??(e.encode={}),(r=e.encode)[t]??(r[t]={}),(o=e.encode[t]).update??(o.update={}),e.encode[t].update[n]=i}function Gl(e,t,n,i={header:!1}){var f,d;const{disable:r,orient:o,scale:s,labelExpr:a,title:u,zindex:l,...c}=e.combine();if(!r){for(const h in c){const g=Mre[h],p=c[h];if(g&&g!==t&&g!=="both")delete c[h];else if(Mf(p)){const{condition:m,...y}=p,b=H(m),x=N$[h];if(x){const{vgProp:v,part:w}=x,S=[...b.map(_=>{const{test:E,...A}=_;return{test:vg(null,E),...A}}),y];z0(c,w,v,S),delete c[h]}else if(x===null){const v={signal:b.map(w=>{const{test:S,..._}=w;return`${vg(null,S)} ? ${y$(_)} : `}).join("")+y$(y)};c[h]=v}}else if(Q(p)){const m=N$[h];if(m){const{vgProp:y,part:b}=m;z0(c,b,y,p),delete c[h]}}pe(["labelAlign","labelBaseline"],h)&&c[h]===null&&delete c[h]}if(t==="grid"){if(!c.grid)return;if(c.encode){const{grid:h}=c.encode;c.encode={...h?{grid:h}:{}},Me(c.encode)&&delete c.encode}return{scale:s,orient:o,...c,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Ve(l,0)}}else{if(!i.header&&e.mainExtracted)return;if(a!==void 0){let g=a;(d=(f=c.encode)==null?void 0:f.labels)!=null&&d.update&&Q(c.encode.labels.update.text)&&(g=Vs(a,"datum.label",c.encode.labels.update.text.signal)),z0(c,"labels","text",{signal:g})}if(c.labelAlign===null&&delete c.labelAlign,c.encode){for(const g of g6)e.hasAxisPart(g)||delete c.encode[g];Me(c.encode)&&delete c.encode}const h=Gse(u,n);return{scale:s,orient:o,grid:!1,...h?{title:h}:{},...c,...n.aria===!1?{aria:!1}:{},zindex:Ve(l,0)}}}}function vR(e){const{axes:t}=e.component,n=[];for(const i of pr)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const o=i==="x"?"height":"width",s=e.getSizeSignalRef(o).signal;o!==s&&n.push({name:o,update:s})}}return n}function Yse(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>Gl(r,"grid",t)),...i.map(r=>Gl(r,"grid",t)),...n.map(r=>Gl(r,"main",t)),...i.map(r=>Gl(r,"main",t))].filter(r=>r)}function iA(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const o=n==="x"?"bottom":"left",s=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...P(s),...P(a)]),l={};for(const c of u.values())l[c]={signal:`${i.signal} === "${o}" ? ${hi(s[c])} : ${hi(a[c])}`};return l}return t[r]})])}function Vse(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:BO(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],o=e==="x"?"axisX":"axisY",s=Q(n)?"axisOrient":`axis${vf(n)}`,a=[...r,...r.map(l=>o+l.substr(4))],u=["axis",s,o];return{vlOnlyAxisConfig:iA(a,i,e,n),vgAxisConfig:iA(u,i,e,n),axisConfigStyle:Xse([...u,...a],i)}}function Xse(e,t){var i;const n=[{}];for(const r of e){let o=(i=t[r])==null?void 0:i.style;if(o){o=H(o);for(const s of o)n.push(t.style[s])}}return Object.assign.apply(null,n)}function Wy(e,t,n,i={}){var o;const r=yO(e,n,t);if(r!==void 0)return{configFrom:"style",configValue:r};for(const s of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((o=i[s])==null?void 0:o[e])!==void 0)return{configFrom:s,configValue:i[s][e]};return{}}const rA={scale:({model:e,channel:t})=>e.scaleName(t),format:({format:e})=>e,formatType:({formatType:e})=>e,grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>t.grid??Kse(n,e),gridScale:({model:e,channel:t})=>Jse(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||_R(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||wR(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>e.labelFlush??Zse(t.type,n),labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>e.labelOverlap??eae(t.type,n,I(t)&&!!t.timeUnit,I(t)?t.sort:void 0),orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{const o=e==="x"?"width":e==="y"?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return n.tickCount??nae({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},tickMinStep:iae,title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=SR(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),o=n==="x"?"x2":"y2",s=t.fieldDef(o);return xO(r?[T$(r)]:[],I(s)?[T$(s)]:[])},values:({axis:e,fieldOrDatumDef:t})=>rae(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>e.zindex??oae(n,t)};function Kse(e,t){return!gt(e)&&I(t)&&!Oe(t==null?void 0:t.bin)&&!yt(t==null?void 0:t.bin)}function Jse(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function Qse(e,t,n,i,r){const o=t==null?void 0:t.labelAngle;if(o!==void 0)return Q(o)?o:Rc(o);{const{configValue:s}=Wy("labelAngle",i,t==null?void 0:t.style,r);return s!==void 0?Rc(s):n===Ie&&pe([Aw,$w],e.type)&&!(I(e)&&e.timeUnit)?270:void 0}}function Hy(e){return`(((${e.signal} % 360) + 360) % 360)`}function wR(e,t,n,i){if(e!==void 0)if(n==="x"){if(Q(e)){const r=Hy(e),o=Q(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${o} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Q(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(Q(e)){const r=Hy(e),o=Q(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${o} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(Q(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function _R(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,o=i?"bottom":"left";if(Q(e)){const s=Hy(e),a=Q(t)?`(${t.signal} === "${o}")`:t===o;return{signal:`(${r?`(${s} + 90)`:s} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${s} && ${s} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(Q(t)){const s=r<e&&e<180+r?"===":"!==";return{signal:`${`${t.signal} ${s} "${o}"`} ? "left" : "right"`}}return(r<e&&e<180+r)==(t===o)?"left":"right"}function Zse(e,t){if(t==="x"&&pe(["quantitative","temporal"],e))return!0}function eae(e,t,n,i){if(n&&!V(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function tae(e){return e==="x"?"bottom":"left"}function nae({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!gt(t)&&t!=="log"){if(I(e)){if(Oe(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&pe(["month","hours","day","quarter"],(r=St(e.timeUnit))==null?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function iae({format:e,fieldOrDatumDef:t}){if(e==="d")return 1;if(I(t)){const{timeUnit:n}=t;if(n){const i=OO(n);if(i)return{signal:i}}}}function SR(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),o=i?i.title:void 0,s=r?r.title:void 0;if(o&&s)return vO(o,s);if(o)return o;if(s)return s;if(o!==void 0)return o;if(s!==void 0)return s}function rae(e,t){const n=e.values;if(z(n))return h6(t,n);if(Q(n))return n}function oae(e,t){return e==="rect"&&dg(t)?1:0}class Tu extends Ce{clone(){return new Tu(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this._dependentFields=yR(this.transform.calculate)}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(ya(i)&&n6(i.sort)){const{field:o,timeUnit:s}=i,a=i.sort,u=a.map((l,c)=>`${zO({field:o,timeUnit:s,equal:l})} ? ${c} : `).join("")+a.length;t=new Tu(t,{calculate:u,as:Du(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${ge(this.transform)}`}}function Du(e,t,n){return W(e,{prefix:t,suffix:"sort_index",...n??{}})}function fm(e,t){return pe(["top","bottom"],t)?"column":pe(["left","right"],t)||e==="row"?"row":"column"}function Nu(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return Ve((t||{})[e],r[e],n.header[e])}function dm(e,t,n,i){const r={};for(const o of e){const s=Nu(o,t||{},n,i);s!==void 0&&(r[o]=s)}return r}const o_=["row","column"],s_=["header","footer"];function sae(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:o,titleAngle:s,titleOrient:a}=dm(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),u=fm(t,a),l=Rc(s);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:{text:n,...t==="row"?{orient:"left"}:{},style:"guide-title",...kR(l,u),...ER(u,l,o),...$R(i,r,t,Jre,F6)}}}function ER(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=_R(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function kR(e,t){const n=wR(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function aae(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of s_)if(n[r])for(const o of n[r]){const s=lae(e,t,r,n,o);s!=null&&i.push(s)}return i}function uae(e,t){const{sort:n}=e;return Yi(n)?{field:W(n,{expr:"datum"}),order:n.order??"ascending"}:z(n)?{field:Du(e,t,{expr:"datum"}),order:"ascending"}:{field:W(e,{expr:"datum"}),order:n??"ascending"}}function Gy(e,t,n){const{format:i,formatType:r,labelAngle:o,labelAnchor:s,labelOrient:a,labelExpr:u}=dm(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=Ow({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=fm(t,a);return{text:{signal:u?Vs(Vs(u,"datum.label",l),"datum.value",W(e,{expr:"parent"})):l},...t==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...kR(o,c),...ER(c,o,s),...$R(n,e,t,Qre,T6)}}function lae(e,t,n,i,r){if(r){let o=null;const{facetFieldDef:s}=i,a=e.config?e.config:void 0;if(s&&r.labels){const{labelOrient:f}=dm(["labelOrient"],s.header,a,t);(t==="row"&&!pe(["top","bottom"],f)||t==="column"&&!pe(["left","right"],f))&&(o=Gy(s,t,a))}const u=xi(e)&&!$f(e.facet),l=r.axes,c=(l==null?void 0:l.length)>0;if(o||c){const f=t==="row"?"height":"width";return{name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`,...i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:uae(s,t)}:{},...c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{},...o?{title:o}:{},...r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{},...c?{axes:l}:{}}}}return null}const cae={column:{start:0,end:1},row:{start:1,end:0}};function fae(e,t){return cae[t][e]}function dae(e,t){const n={};for(const i of qn){const r=e[i];if(r!=null&&r.facetFieldDef){const{titleAnchor:o,titleOrient:s}=dm(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=fm(i,s),u=fae(o,a);u!==void 0&&(n[a]=u)}}return Me(n)?void 0:n}function $R(e,t,n,i,r){const o={};for(const s of i){if(!r[s])continue;const a=Nu(s,t==null?void 0:t.header,e,n);a!==void 0&&(o[r[s]]=a)}return o}function a_(e){return[...fd(e,"width"),...fd(e,"height"),...fd(e,"childWidth"),...fd(e,"childHeight")]}function fd(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const o=e.getScaleComponent(n);if(o){const s=o.get("type"),a=o.get("range");if(gt(s)&&ts(a)){const u=e.scaleName(n);return xi(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[oA(u,a)]:[oA(u,a),{name:r,update:AR(u,o,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const o=r.endsWith("width"),s=o?"containerSize()[0]":"containerSize()[1]",a=Ly(e.config.view,o?"width":"height"),u=`isFinite(${s}) ? ${s} : ${a}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:r,value:i}]}function oA(e,t){const n=`${e}_step`;return Q(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function AR(e,t,n){const i=t.get("type"),r=t.get("padding"),o=Ve(t.get("paddingOuter"),r);let s=t.get("paddingInner");return s=i==="band"?s!==void 0?s:r:1,`bandspace(${n}, ${hi(s)}, ${hi(o)}) * ${e}_step`}function CR(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function MR(e,t){return P(e).reduce((n,i)=>{const r=e[i];return{...n,...Ju(t,r,i,o=>ze(o.value))}},{})}function FR(e,t){if(xi(t))return e==="theta"?"independent":"shared";if(tl(t))return"shared";if(g_(t))return ht(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function u_(e,t){const n=e.scale[t],i=ht(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&L(Xne(t)),"independent"):e[i][t]||"shared"}const hae={...toe,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},TR=P(hae);class gae extends Qr{}const sA={symbols:pae,gradient:mae,labels:yae,entries:bae};function pae(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:o}){if(o!=="symbol")return;const{markDef:s,encoding:a,config:u,mark:l}=n,c=s.filled&&l!=="trail";let f={...one({},n,Jie),...iR(n,{filled:c})};const d=r.get("symbolOpacity")??u.legend.symbolOpacity,h=r.get("symbolFillColor")??u.legend.symbolFillColor,g=r.get("symbolStrokeColor")??u.legend.symbolStrokeColor,p=d===void 0?DR(a.opacity)??s.opacity:void 0;if(f.fill){if(i==="fill"||c&&i===wn)delete f.fill;else if(f.fill.field)h?delete f.fill:(f.fill=ze(u.legend.symbolBaseFillColor??"black"),f.fillOpacity=ze(p??1));else if(z(f.fill)){const m=Yy(a.fill??a.color)??s.fill??(c&&s.color);m&&(f.fill=ze(m))}}if(f.stroke){if(i==="stroke"||!c&&i===wn)delete f.stroke;else if(f.stroke.field||g)delete f.stroke;else if(z(f.stroke)){const m=Ve(Yy(a.stroke||a.color),s.stroke,c?s.color:void 0);m&&(f.stroke={value:m})}}if(i!==Xr){const m=I(t)&&OR(n,r,t);m?f.opacity=[{test:m,...ze(p??1)},ze(u.legend.unselectedOpacity)]:p&&(f.opacity=ze(p))}return f={...f,...e},Me(f)?void 0:f}function mae(e,{model:t,legendType:n,legendCmpt:i}){if(n!=="gradient")return;const{config:r,markDef:o,encoding:s}=t;let a={};const l=(i.get("gradientOpacity")??r.legend.gradientOpacity)===void 0?DR(s.opacity)||o.opacity:void 0;return l&&(a.opacity=ze(l)),a={...a,...e},Me(a)?void 0:a}function yae(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const o=n.legend(i)||{},s=n.config,a=I(t)?OR(n,r,t):void 0,u=a?[{test:a,value:1},{value:s.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=o;let f;Zs(c)?f=pi({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:s}):l===void 0&&c===void 0&&s.customFormatTypes&&(t.type==="quantitative"&&s.numberFormatType?f=pi({fieldOrDatumDef:t,field:"datum.value",format:s.numberFormat,formatType:s.numberFormatType,config:s}):t.type==="temporal"&&s.timeFormatType&&I(t)&&t.timeUnit===void 0&&(f=pi({fieldOrDatumDef:t,field:"datum.value",format:s.timeFormat,formatType:s.timeFormatType,config:s})));const d={...u?{opacity:u}:{},...f?{text:f}:{},...e};return Me(d)?void 0:d}function bae(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?{...e,fill:{value:"transparent"}}:e}function DR(e){return NR(e,(t,n)=>Math.max(t,n.value))}function Yy(e){return NR(e,(t,n)=>Ve(t,n.value))}function NR(e,t){if(yre(e))return H(e.condition).reduce(t,e.value);if(Si(e))return e.value}function OR(e,t,n){const i=t.get("selections");if(!(i!=null&&i.length))return;const r=j(n.field);return i.map(o=>`(!length(data(${j(Le(o)+ta)})) || (${o}[${r}] && indexof(${o}[${r}], datum.value) >= 0))`).join(" || ")}const aA={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return QO(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return ZO(i,t,n)},gradientLength:e=>{const{legend:t,legendConfig:n}=e;return t.gradientLength??n.gradientLength??kae(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>e.labelOverlap??t.labelOverlap??$ae(n),symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>e.symbolType??vae(t.type,n,i.shape,t.shape),title:({fieldOrDatumDef:e,config:t})=>Xa(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Va(n)&&gi(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>xae(t,e)};function xae(e,t){const n=e.values;if(z(n))return h6(t,n);if(Q(n))return n}function vae(e,t,n,i){if(t!=="shape"){const r=Yy(n)??i;if(r)return r}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function wae(e){const{legend:t}=e;return Ve(t.type,_ae(e))}function _ae({channel:e,timeUnit:t,scaleType:n}){if(Va(e)){if(pe(["quarter","month","day"],t))return"symbol";if(gi(n))return"gradient"}return"symbol"}function Sae({legendConfig:e,legendType:t,orient:n,legend:i}){return i.direction??e[t?"gradientDirection":"symbolDirection"]??Eae(n,t)}function Eae(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function kae({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:s,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(gi(r))return n==="horizontal"?i==="top"||i==="bottom"?uA(t,"width",s,o):s:uA(t,"height",u,a)}function uA(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function $ae(e){if(pe(["quantile","threshold","log","symlog"],e))return"greedy"}function RR(e){const t=Ye(e)?Aae(e):Tae(e);return e.component.legends=t,t}function Aae(e){const{encoding:t}=e,n={};for(const i of[wn,...N6]){const r=tt(t[i]);!r||!e.getScaleComponent(i)||i===_n&&I(r)&&r.type===Ku||(n[i]=Fae(e,i))}return n}function Cae(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Mae(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function Fae(e,t){var v;let n=e.legend(t);const{markDef:i,encoding:r,config:o}=e,s=o.legend,a=new gae({},Cae(e,t));Ise(e,t,a);const u=n!==void 0?!n:s.disable;if(a.set("disable",u,n!==void 0),u)return a;n=n||{};const l=e.getScaleComponent(t).get("type"),c=tt(r[t]),f=I(c)?(v=St(c.timeUnit))==null?void 0:v.unit:void 0,d=n.orient||o.legend.orient||"right",h=wae({legend:n,channel:t,timeUnit:f,scaleType:l}),g=Sae({legend:n,legendType:h,orient:d,legendConfig:s}),p={legend:n,channel:t,model:e,markDef:i,encoding:r,fieldOrDatumDef:c,legendConfig:s,config:o,scaleType:l,orient:d,legendType:h,direction:g};for(const w of TR){if(h==="gradient"&&w.startsWith("symbol")||h==="symbol"&&w.startsWith("gradient"))continue;const S=w in aA?aA[w](p):n[w];if(S!==void 0){const _=Mae(S,w,n,e.fieldDef(t));(_||o.legend[w]===void 0)&&a.set(w,S,_)}}const m=(n==null?void 0:n.encoding)??{},y=a.get("selections"),b={},x={fieldOrDatumDef:c,model:e,channel:t,legendCmpt:a,legendType:h};for(const w of["labels","legend","title","symbols","gradient","entries"]){const S=MR(m[w]??{},e),_=w in sA?sA[w](S,x):S;_!==void 0&&!Me(_)&&(b[w]={...y!=null&&y.length&&I(c)?{name:`${Le(c.field)}_legend_${w}`}:{},...y!=null&&y.length?{interactive:!!y}:{},update:_})}return Me(b)||a.set("encode",b,!!(n!=null&&n.encoding)),a}function Tae(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){RR(i);for(const r of P(i.component.legends))n.legend[r]=u_(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=zR(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of P(t))for(const r of e.children)r.component.legends[i]&&n.legend[i]==="shared"&&delete r.component.legends[i];return t}function zR(e,t){var o,s,a,u;if(!e)return t.clone();const n=e.getWithExplicit("orient"),i=t.getWithExplicit("orient");if(n.explicit&&i.explicit&&n.value!==i.value)return;let r=!1;for(const l of TR){const c=Io(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return Dae(f,d);case"title":return wO(f,d);case"type":return r=!0,$n("symbol")}return um(f,d,l,"legend")});e.setWithExplicit(l,c)}return r&&((s=(o=e.implicit)==null?void 0:o.encode)!=null&&s.gradient&&sg(e.implicit,["encode","gradient"]),(u=(a=e.explicit)==null?void 0:a.encode)!=null&&u.gradient&&sg(e.explicit,["encode","gradient"])),e}function Dae(e,t){return t.value==="circle"?t:e}function Nae(e,t,n,i){var r,o;e.encode??(e.encode={}),(r=e.encode)[t]??(r[t]={}),(o=e.encode[t]).update??(o.update={}),e.encode[t].update[n]=i}function PR(e){const t=e.component.legends,n={};for(const r of P(t)){const o=e.getScaleComponent(r),s=Ne(o.get("domains"));if(n[s])for(const a of n[s])zR(a,t[r])||n[s].push(t[r]);else n[s]=[t[r].clone()]}return wt(n).flat().map(r=>Oae(r,e.config)).filter(r=>r!==void 0)}function Oae(e,t){var s,a,u;const{disable:n,labelExpr:i,selections:r,...o}=e.combine();if(!n){if(t.aria===!1&&o.aria==null&&(o.aria=!1),(s=o.encode)!=null&&s.symbols){const l=o.encode.symbols.update;l.fill&&l.fill.value!=="transparent"&&!l.stroke&&!o.stroke&&(l.stroke={value:"transparent"});for(const c of N6)o[c]&&delete l[c]}if(o.title||delete o.title,i!==void 0){let l=i;(u=(a=o.encode)==null?void 0:a.labels)!=null&&u.update&&Q(o.encode.labels.update.text)&&(l=Vs(i,"datum.label",o.encode.labels.update.text.signal)),Nae(o,"labels","text",{signal:l})}return o}}function Rae(e){return tl(e)||g_(e)?zae(e):LR(e)}function zae(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),LR(e))}function LR(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(s=>s.signal).join(", ")}]`},o=t.data.reduce((s,a)=>{const u=Q(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return pe(s,u)||s.push(u),s},[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:i,size:r,fit:{signal:o.length>1?`[${o.join(", ")}]`:o[0]},...n}]}else return[{name:i,translate:{signal:"[width / 2, height / 2]"},...n}]}const Pae=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class IR extends Qr{constructor(t,n,i,r){super({...n},{name:t}),this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function BR(e){e.component.projection=Ye(e)?Lae(e):jae(e)}function Lae(e){if(e.hasProjection){const t=ln(e.specifiedProjection),n=!(t&&(t.scale!=null||t.translate!=null)),i=n?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,r=n?Iae(e):void 0,o=new IR(e.projectionName(!0),{...ln(e.config.projection)??{},...t??{}},i,r);return o.get("type")||o.set("type","equalEarth",!1),o}}function Iae(e){const t=[],{encoding:n}=e;for(const i of[[Ti,Fi],[Jn,Di]])(tt(n[i[0]])||tt(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(_n)&&e.typedFieldDef(_n).type===Ku&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(De.Main)),t}function Bae(e,t){const n=ew(Pae,r=>!!(!ne(e.explicit,r)&&!ne(t.explicit,r)||ne(e.explicit,r)&&ne(t.explicit,r)&&Ui(e.get(r),t.get(r))));if(Ui(e.size,t.size)){if(n)return e;if(Ui(e.explicit,{}))return t;if(Ui(t.explicit,{}))return e}return null}function jae(e){if(e.children.length===0)return;let t;for(const i of e.children)BR(i);const n=ew(e.children,i=>{const r=i.component.projection;if(r)if(t){const o=Bae(t,r);return o&&(t=o),!!o}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new IR(i,t.specifiedProjection,t.size,oe(t.data));for(const o of e.children){const s=o.component.projection;s&&(s.isFit&&r.data.push(...o.component.projection.data),o.renameProjection(s.get("name"),i),s.merged=!0)}return r}}function Uae(e,t,n,i){if(Cf(t,n)){const r=Ye(e)?e.axis(n)??e.legend(n)??{}:{},o=W(t,{expr:"datum"}),s=W(t,{expr:"datum",binSuffix:"end"});return{formulaAs:W(t,{binSuffix:"range",forAs:!0}),formula:kf(o,s,r.format,r.formatType,i)}}return{}}function jR(e,t){return`${hO(e)}_${t}`}function qae(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function l_(e,t,n){const i=nm(n,void 0)??{},r=jR(i,t);return e.getName(`${r}_bins`)}function Wae(e){return"as"in e}function lA(e,t,n){let i,r;Wae(e)?i=Y(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[W(e,{forAs:!0}),W(e,{binSuffix:"end",forAs:!0})];const o={...nm(t,void 0)},s=jR(o,e.field),{signal:a,extentSignal:u}=qae(n,s);if(Hp(o.extent)){const c=o.extent;r=xR(n,c.param,c),delete o.extent}const l={bin:o,field:e.field,as:[i],...a?{signal:a}:{},...u?{extentSignal:u}:{},...r?{span:r}:{}};return{key:s,binComponent:l}}class Xi extends Ce{clone(){return new Xi(null,oe(this.bins))}constructor(t,n){super(t),this.bins=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,o,s)=>{if(nn(o)&&Oe(o.bin)){const{key:a,binComponent:u}=lA(o,o.bin,n);r[a]={...u,...r[a],...Uae(n,o,s,n.config)}}return r},{});return Me(i)?null:new Xi(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:o}=lA(n,n.bin,i);return new Xi(t,{[r]:o})}merge(t,n){for(const i of P(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=qi([...this.bins[i].as,...t.bins[i].as],ge)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(wt(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(wt(this.bins).map(t=>t.field))}hash(){return`Bin ${ge(this.bins)}`}assemble(){return wt(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,{extent:o,...s}=t.bin,a={type:"bin",field:Kn(t.field),as:i,signal:t.signal,...Hp(o)?{extent:null}:{extent:o},...t.span?{span:{signal:`span(${t.span})`}}:{},...s};!o&&t.extentSignal&&(n.push({type:"extent",field:Kn(t.field),signal:t.extentSignal}),a.extent={signal:t.extentSignal}),n.push(a);for(const u of r)for(let l=0;l<2;l++)n.push({type:"formula",expr:W({field:i[l]},{expr:"datum"}),as:u[l]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function Hae(e,t,n,i){var o;const r=Ye(i)?i.encoding[gr(t)]:void 0;if(nn(n)&&Ye(i)&&o6(n,r,i.markDef,i.config))e.add(W(n,{})),e.add(W(n,{suffix:"end"})),n.bin&&Cf(n,t)&&e.add(W(n,{binSuffix:"range"}));else if(nO(t)){const s=tO(t);e.add(i.getName(s))}else e.add(W(n));return ya(n)&&Iie((o=n.scale)==null?void 0:o.range)&&e.add(n.scale.range.field),e}function Gae(e,t){for(const n of P(t)){const i=t[n];for(const r of P(i))n in e?e[n][r]=new Set([...e[n][r]??[],...i[r]]):e[n]={[r]:i[r]}}}class bi extends Ce{clone(){return new bi(null,new Set(this.dimensions),oe(this.measures))}constructor(t,n,i){super(t),this.dimensions=n,this.measures=i}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(s=>{s.aggregate&&(i=!0)});const r={},o=new Set;return!i||(n.forEachFieldDef((s,a)=>{const{aggregate:u,field:l}=s;if(u)if(u==="count")r["*"]??(r["*"]={}),r["*"].count=new Set([W(s,{forAs:!0})]);else{if(jr(u)||es(u)){const c=jr(u)?"argmin":"argmax",f=u[c];r[f]??(r[f]={}),r[f][c]=new Set([W({op:c,field:f},{forAs:!0})])}else r[l]??(r[l]={}),r[l][u]=new Set([W(s,{forAs:!0})]);Kr(a)&&n.scaleDomain(a)==="unaggregated"&&(r[l]??(r[l]={}),r[l].min=new Set([W({field:l,aggregate:"min"},{forAs:!0})]),r[l].max=new Set([W({field:l,aggregate:"max"},{forAs:!0})]))}else Hae(o,a,s,n)}),o.size+P(r).length===0)?null:new bi(t,o,r)}static makeFromTransform(t,n){const i=new Set,r={};for(const o of n.aggregate){const{op:s,field:a,as:u}=o;s&&(s==="count"?(r["*"]??(r["*"]={}),r["*"].count=new Set([u||W(o,{forAs:!0})])):(r[a]??(r[a]={}),r[a][s]=new Set([u||W(o,{forAs:!0})])))}for(const o of n.groupby??[])i.add(o);return i.size+P(r).length===0?null:new bi(t,i,r)}merge(t){return YN(this.dimensions,t.dimensions)?(Gae(this.measures,t.measures),!0):(fie("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...P(this.measures)])}producedFields(){const t=new Set;for(const n of P(this.measures))for(const i of P(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${ge({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const o of P(this.measures))for(const s of P(this.measures[o]))for(const a of this.measures[o][s])i.push(a),t.push(s),n.push(o==="*"?null:Kn(o));return{type:"aggregate",groupby:[...this.dimensions].map(Kn),ops:t,fields:n,as:i}}}class Zu extends Ce{constructor(t,n,i,r){super(t),this.model=n,this.name=i,this.data=r;for(const o of qn){const s=n.facet[o];if(s){const{bin:a,sort:u}=s;this[o]={name:n.getName(`${o}_domain`),fields:[W(s),...Oe(a)?[W(s,{binSuffix:"end"})]:[]],...Yi(u)?{sortField:u}:z(u)?{sortIndexField:Du(s,o)}:{}}}}this.childModel=n.child}hash(){let t="Facet";for(const n of qn)this[n]&&(t+=` ${n.charAt(0)}:${ge(this[n])}`);return t}get fields(){var n;const t=[];for(const i of qn)(n=this[i])!=null&&n.fields&&t.push(...this[i].fields);return t}dependentFields(){const t=new Set(this.fields);for(const n of qn)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of pr){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),o=i.get("range");if(gt(r)&&ts(o)){const s=hm(this.childModel,n),a=h_(s);a?t[n]=a:L(gw(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],o=[],s=[],a=[];r&&i&&i[r]&&(n?(o.push(`distinct_${i[r]}`),s.push("max")):(o.push(i[r]),s.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=Qp,field:f}=u;o.push(f),s.push(c),a.push(W(u,{forAs:!0}))}else l&&(o.push(l),s.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[{type:"aggregate",groupby:this[t].fields,...o.length?{fields:o,ops:s,as:a}:{}}]}}assembleFacetHeaderData(t){var u;const{columns:n}=this.model.layout,{layoutHeaders:i}=this.model.component,r=[],o={};for(const l of o_){for(const c of s_){const f=(i[l]&&i[l][c])??[];for(const d of f)if(((u=d.axes)==null?void 0:u.length)>0){o[l]=!0;break}}if(o[l]){const c=`length(data("${this.facet.name}"))`,f=l==="row"?n?{signal:`ceil(${c} / ${n})`}:1:n?{signal:`min(${c}, ${n})`}:{signal:c};r.push({name:`${this.facet.name}_${l}`,transform:[{type:"sequence",start:0,stop:f}]})}}const{row:s,column:a}=o;return(s||a)&&r.unshift(this.assembleRowColumnHeaderData("facet",null,t)),r}assemble(){const t=[];let n=null;const i=this.getChildIndependentFieldsWithStep(),{column:r,row:o,facet:s}=this;if(r&&o&&(i.x||i.y)){n=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(i.x??[],i.y??[]),u=a.map(()=>"distinct");t.push({name:n,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:u}]})}for(const a of[Rr,Or])this[a]&&t.push(this.assembleRowColumnHeaderData(a,n,i));if(s){const a=this.assembleFacetHeaderData(i);a&&t.push(...a)}return t}}function cA(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Yae(e,t){const n=iw(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=cA(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=cA(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return L(bne(t)),null}function Vae(e){const t={};return Bd(e.filter,n=>{if(RO(n)){let i=null;bw(n)?i=Mn(n.equal):vw(n)?i=Mn(n.lte):xw(n)?i=Mn(n.lt):ww(n)?i=Mn(n.gt):_w(n)?i=Mn(n.gte):Sw(n)?i=n.range[0]:Ew(n)&&(i=(n.oneOf??n.in)[0]),i&&(ma(i)?t[n.field]="date":Ae(i)?t[n.field]="number":Y(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Xae(e){const t={};function n(i){Cu(i)?t[i.field]="date":i.type==="quantitative"&&Kte(i.aggregate)?t[i.field]="number":wu(i.field)>1?i.field in t||(t[i.field]="flatten"):ya(i)&&Yi(i.sort)&&wu(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((Ye(e)||xi(e))&&e.forEachFieldDef((i,r)=>{if(nn(i))n(i);else{const o=ga(r),s=e.fieldDef(o);n({...i,type:s.type})}}),Ye(e)){const{mark:i,markDef:r,encoding:o}=e;if(ns(i)&&!e.encoding.order){const s=r.orient==="horizontal"?"y":"x",a=o[s];I(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function Kae(e){const t={};if(Ye(e)&&e.component.selection)for(const n of P(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&wu(r.field)>1&&(t[r.field]="flatten")}return t}class Ot extends Ce{clone(){return new Ot(null,oe(this._parse))}constructor(t,n){super(t),this._parse=n}hash(){return`Parse ${ge(this._parse)}`}static makeExplicit(t,n,i){var s;let r={};const o=n.data;return!$o(o)&&((s=o==null?void 0:o.format)!=null&&s.parse)&&(r=o.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const a of P(i)){const u=r.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===i[a]||u.value==="derived"||i[a]==="flatten"?delete i[a]:L(S$(a,i[a],u.value)))}for(const a of P(n)){const u=r.get(a);u!==void 0&&(u===n[a]?delete n[a]:L(S$(a,n[a],u)))}const o=new Qr(n,i);r.copyAll(o);const s={};for(const a of P(o.combine())){const u=o.get(a);u!==null&&(s[a]=u)}return P(s).length===0||r.parseNothing?null:new Ot(t,s)}get parse(){return this._parse}merge(t){this._parse={...this._parse,...t.parse},t.remove()}assembleFormatParse(){const t={};for(const n of P(this._parse)){const i=this._parse[n];wu(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(P(this._parse))}dependentFields(){return new Set(P(this._parse))}assembleTransforms(t=!1){return P(this._parse).filter(n=>t?wu(n)>1:!0).map(n=>{const i=Yae(n,this._parse[n]);return i?{type:"formula",expr:i,as:rw(n)}:null}).filter(n=>n!==null)}}class Uo extends Ce{clone(){return new Uo(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Ei])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Ei}}}class Tf extends Ce{clone(){return new Tf(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${ge(this.params)}`}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class Df extends Ce{clone(){return new Df(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){return new Set([this.params.as??"data"])}hash(){return`Hash ${ge(this.params)}`}assemble(){return{type:"sequence",...this.params}}}class na extends Ce{constructor(t){super(null),t??(t={name:"source"});let n;if($o(t)||(n=t.format?{...gn(t.format,["parse"])}:{}),zc(t))this._data={values:t.values};else if(Mu(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];pe(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else K6(t)?this._data={values:[{type:"Sphere"}]}:(V6(t)||$o(t))&&(this._data={});this._generator=$o(t),t.name&&(this._name=t.name),n&&!Me(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var fA=globalThis&&globalThis.__classPrivateFieldSet||function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},Jae=globalThis&&globalThis.__classPrivateFieldGet||function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},Yl;function c_(e){return e instanceof na||e instanceof Tf||e instanceof Df}class f_{constructor(){Yl.set(this,void 0),fA(this,Yl,!1,"f")}setModified(){fA(this,Yl,!0,"f")}get modifiedFlag(){return Jae(this,Yl,"f")}}Yl=new WeakMap;class ba extends f_{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,o)=>o[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class d_ extends f_{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class Qae extends d_{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of P(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class Zae extends d_{constructor(t){super(),this.requiresSelectionId=t&&r_(t)}run(t){t instanceof Uo&&(this.requiresSelectionId&&(c_(t.parent)||t.parent instanceof bi||t.parent instanceof Ot)||(this.setModified(),t.remove()))}}class eue extends f_{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Vi&&(i=t.producedFields(),tw(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class tue extends d_{constructor(){super()}run(t){t instanceof Zt&&!t.isRequired()&&(this.setModified(),t.remove())}}class nue extends ba{run(t){if(!c_(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof Ot)if(t instanceof Ot)this.setModified(),t.merge(n);else{if(nw(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class iue extends ba{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof Ot);if(t.numChildren()>1&&i.length>=1){const r={},o=new Set;for(const s of i){const a=s.parse;for(const u of P(a))u in r?r[u]!==a[u]&&o.add(u):r[u]=a[u]}for(const s of o)delete r[s];if(!Me(r)){this.setModified();const s=new Ot(t,r);for(const a of n){if(a instanceof Ot)for(const u of P(r))delete a.parse[u];t.removeChild(a),a.parent=s,a instanceof Ot&&P(a.parse).length===0&&a.remove()}}}}}class rue extends ba{run(t){t instanceof Zt||t.numChildren()>0||t instanceof Zu||t instanceof na||(this.setModified(),t.remove())}}class oue extends ba{run(t){const n=t.children.filter(r=>r instanceof Vi),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class sue extends ba{run(t){const n=t.children.filter(r=>r instanceof bi),i={};for(const r of n){const o=ge(r.groupBy);o in i||(i[o]=[]),i[o].push(r)}for(const r of P(i)){const o=i[r];if(o.length>1){const s=o.pop();for(const a of o)s.merge(a)&&(t.removeChild(a),a.parent=s,a.remove(),this.setModified())}}}}class aue extends ba{constructor(t){super(),this.model=t}run(t){const n=!(c_(t)||t instanceof Qu||t instanceof Ot||t instanceof Uo),i=[],r=[];for(const o of t.children)o instanceof Xi&&(n&&!nw(t.producedFields(),o.dependentFields())?i.push(o):r.push(o));if(i.length>0){const o=i.pop();for(const s of i)o.merge(s,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Xi?t.merge(o,this.model.renameSignal.bind(this.model)):o.swapWithParent()}if(r.length>1){const o=r.pop();for(const s of r)o.merge(s,this.model.renameSignal.bind(this.model));this.setModified()}}}class uue extends ba{run(t){const n=[...t.children];if(!Ys(n,s=>s instanceof Zt)||t.numChildren()<=1)return;const r=[];let o;for(const s of n)if(s instanceof Zt){let a=s;for(;a.numChildren()===1;){const[u]=a.children;if(u instanceof Zt)a=u;else break}r.push(...a.children),o?(t.removeChild(s),s.parent=o.parent,o.parent.removeChild(o),o.parent=a,this.setModified()):o=a}else r.push(s);if(r.length){this.setModified();for(const s of r)s.parent.removeChild(s),s.parent=o}}}class xa extends Ce{clone(){return new xa(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=qi(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){return t.as??W(t)}hash(){return`JoinAggregateTransform ${ge(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const o of this.transform.joinaggregate)n.push(o.op),i.push(this.getDefaultName(o)),t.push(o.field===void 0?null:o.field);const r=this.transform.groupby;return{type:"joinaggregate",as:i,ops:n,fields:t,...r!==void 0?{groupby:r}:{}}}}function lue(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=W(i);return r&&t.push(r),t},[])}function cue(e){return z(e)&&e.every(t=>Y(t))&&e.length>1}class Pr extends Ce{clone(){return new Pr(null,oe(this._stack))}constructor(t,n){super(t),this._stack=n}static makeFromTransform(t,n){const{stack:i,groupby:r,as:o,offset:s="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(Ve(f.order,"ascending"));const l={field:a,order:u};let c;return cue(o)?c=o:Y(o)?c=[o,`${o}_end`]:c=[`${n.stack}_start`,`${n.stack}_end`],new Pr(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:s,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:o,fieldChannel:s,offset:a,impute:u}=i,l=o.map(h=>{const g=r[h];return ir(g)}).filter(h=>!!h),c=lue(n),f=n.encoding.order;let d;if(z(f)||I(f))d=bO(f);else{const h=s6(f)?f.sort:s==="y"?"descending":"ascending";d=c.reduce((g,p)=>(g.field.push(p),g.order.push(h),g),{field:[],order:[]})}return new Pr(t,{dimensionFieldDefs:l,stackField:n.vgField(s),facetby:[],stackby:c,sort:d,offset:a,impute:u,as:[n.vgField(s,{suffix:"start",forAs:!0}),n.vgField(s,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${ge(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[W(r,{binSuffix:"mid"})]:[W(r,{}),W(r,{binSuffix:"end"})]:[W(r)]).flat():i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:o,sort:s,offset:a,impute:u,as:l}=this._stack;if(u)for(const c of i){const{bandPosition:f=.5,bin:d}=c;if(d){const h=W(c,{expr:"datum"}),g=W(c,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${f}*${h}+${1-f}*${g}`,as:W(c,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...o,...n],key:W(c,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:s,as:l,offset:a}),t}}class el extends Ce{clone(){return new el(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=qi(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return(this.transform.groupby??[]).forEach(t.add,t),(this.transform.sort??[]).forEach(n=>t.add(n.field)),this.transform.window.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){return t.as??W(t)}hash(){return`WindowTransform ${ge(this.transform)}`}assemble(){const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),t.push(f.field===void 0?null:f.field);const o=this.transform.frame,s=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&n.every(f=>dw(f)))return{type:"joinaggregate",as:i,ops:n,fields:t,...s!==void 0?{groupby:s}:{}};const a=[],u=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)a.push(f.field),u.push(f.order??"ascending");const l={field:a,order:u},c=this.transform.ignorePeers;return{type:"window",params:r,as:i,ops:n,fields:t,sort:l,...c!==void 0?{ignorePeers:c}:{},...s!==void 0?{groupby:s}:{},...o!==void 0?{frame:o}:{}}}}function fue(e){function t(n){if(!(n instanceof Zu)){const i=n.clone();if(i instanceof Zt){const r=Xy+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof bi||i instanceof Pr||i instanceof el||i instanceof xa)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function Vy(e){if(e instanceof Zu)if(e.numChildren()===1&&!(e.children[0]instanceof Zt)){const t=e.children[0];(t instanceof bi||t instanceof Pr||t instanceof el||t instanceof xa)&&t.addDimensions(e.fields),t.swapWithParent(),Vy(e)}else{const t=e.model.component.data.main;UR(t);const n=fue(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(Vy)}function UR(e){if(e instanceof Zt&&e.type===De.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Zu||(t.swapWithParent(),UR(e))}}const Xy="scale_",dd=5;function Ky(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!Ky(t.children))return!1}return!0}function ti(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function dA(e,t,n){let i=e.sources,r=!1;return r=ti(new tue,i)||r,r=ti(new Zae(t),i)||r,i=i.filter(o=>o.numChildren()>0),r=ti(new rue,i)||r,i=i.filter(o=>o.numChildren()>0),n||(r=ti(new nue,i)||r,r=ti(new aue(t),i)||r,r=ti(new eue,i)||r,r=ti(new iue,i)||r,r=ti(new sue,i)||r,r=ti(new oue,i)||r,r=ti(new Qae,i)||r,r=ti(new uue,i)||r),e.sources=i,r}function due(e,t){Ky(e.sources);let n=0,i=0;for(let r=0;r<dd&&dA(e,t,!0);r++)n++;e.sources.map(Vy);for(let r=0;r<dd&&dA(e,t,!1);r++)i++;Ky(e.sources),Math.max(n,i)===dd&&L(`Maximum optimization runs(${dd}) reached.`)}class mn{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new mn(()=>t(n))}}function qR(e){Ye(e)?hue(e):gue(e)}function hue(e){const t=e.component.scales;for(const n of P(t)){const i=mue(e,n);if(t[n].setWithExplicit("domains",i),bue(e,n),e.component.data.isFaceted){let o=e;for(;!xi(o)&&o.parent;)o=o.parent;if(o.component.resolve.scale[n]==="shared")for(const a of i.value)Fr(a)&&(a.data=Xy+a.data.replace(Xy,""))}}}function gue(e){for(const n of e.children)qR(n);const t=e.component.scales;for(const n of P(t)){let i,r=null;for(const o of e.children){const s=o.component.scales[n];if(s){i===void 0?i=s.getWithExplicit("domains"):i=Io(i,s.getWithExplicit("domains"),"domains","scale",Jy);const a=s.get("selectionExtent");r&&a&&r.param!==a.param&&L(gne),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function pue(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:o}=hA(t,n);if(!r){L(o);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=hA(t,n);if(r)return"unaggregated"}return e}function mue(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=pue(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]={...e.specifiedScales[t],domain:r}),t==="x"&&tt(i.x2)?tt(i.x)?Io(io(n,r,e,"x"),io(n,r,e,"x2"),"domain","scale",Jy):io(n,r,e,"x2"):t==="y"&&tt(i.y2)?tt(i.y)?Io(io(n,r,e,"y"),io(n,r,e,"y2"),"domain","scale",Jy):io(n,r,e,"y2"):io(n,r,e,t)}function yue(e,t,n){return e.map(i=>({signal:`{data: ${im(i,{timeUnit:n,type:t})}}`}))}function P0(e,t,n){var r;const i=(r=St(n))==null?void 0:r.unit;return t==="temporal"||i?yue(e,t,i):[e]}function io(e,t,n,i){const{encoding:r}=n,o=tt(r[i]),{type:s}=o,a=o.timeUnit;if(Lie(t)){const f=io(e,void 0,n,i),d=P0(t.unionWith,s,a);return Pi([...d,...f.value])}else{if(Q(t))return Pi([t]);if(t&&t!=="unaggregated"&&!UO(t))return Pi(P0(t,s,a))}const u=n.stack;if(u&&i===u.fieldChannel){if(u.offset==="normalize")return $n([[0,1]]);const f=n.requestDataName(De.Main);return $n([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=Kr(i)&&I(o)?xue(n,i,e):void 0;if(mr(o)){const f=P0([o.datum],s,a);return $n(f)}const c=o;if(t==="unaggregated"){const f=n.requestDataName(De.Main),{field:d}=o;return $n([{data:f,field:W({field:d,aggregate:"min"})},{data:f,field:W({field:d,aggregate:"max"})}])}else if(Oe(c.bin)){if(gt(e))return $n(e==="bin-ordinal"?[]:[{data:Oc(l)?n.requestDataName(De.Main):n.requestDataName(De.Raw),field:n.vgField(i,Cf(c,i)?{binSuffix:"range"}:{}),sort:l===!0||!V(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=c;if(Oe(f)){const d=l_(n,c.field,f);return $n([new mn(()=>{const h=n.getSignalName(d);return`[${h}.start, ${h}.stop]`})])}else return $n([{data:n.requestDataName(De.Main),field:n.vgField(i,{})}])}}else if(c.timeUnit&&pe(["time","utc"],e)&&o6(c,Ye(n)?n.encoding[gr(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(De.Main);return $n([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return $n(l?[{data:Oc(l)?n.requestDataName(De.Main):n.requestDataName(De.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(De.Main),field:n.vgField(i)}])}function L0(e,t){const{op:n,field:i,order:r}=e;return{op:n??(t?"sum":Qp),...i?{field:Kn(i)}:{},...r?{order:r}:{}}}function bue(e,t){var a;const n=e.component.scales[t],i=e.specifiedScales[t].domain,r=(a=e.fieldDef(t))==null?void 0:a.bin,o=UO(i)&&i,s=pa(r)&&Hp(r.extent)&&r.extent;(o||s)&&n.set("selectionExtent",o??s,!0)}function xue(e,t,n){if(!gt(n))return;const i=e.fieldDef(t),r=i.sort;if(n6(r))return{op:"min",field:Du(i,t),order:"ascending"};const{stack:o}=e,s=o?new Set([...o.groupbyFields,...o.stackBy.map(a=>a.fieldDef.field)]):void 0;if(Yi(r)){const a=o&&!s.has(r.field);return L0(r,a)}else if(t6(r)){const{encoding:a,order:u}=r,l=e.fieldDef(a),{aggregate:c,field:f}=l,d=o&&!s.has(f);if(jr(c)||es(c))return L0({field:W(l),order:u},d);if(dw(c)||!c)return L0({op:c,field:f,order:u},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(pe(["ascending",void 0],r))return!0}}function hA(e,t){const{aggregate:n,type:i}=e;return n?Y(n)&&!Qte.has(n)?{valid:!1,reason:Une(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:qne(e)}:{valid:!0}:{valid:!1,reason:jne(e)}}function Jy(e,t,n,i){return e.explicit&&t.explicit&&L(Vne(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function vue(e){const t=qi(e.map(s=>{if(Fr(s)){const{sort:a,...u}=s;return u}return s}),ge),n=qi(e.map(s=>{if(Fr(s)){const a=s.sort;return a!==void 0&&!Oc(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(s=>s!==void 0),ge);if(t.length===0)return;if(t.length===1){const s=e[0];if(Fr(s)&&n.length>0){let a=n[0];if(n.length>1){L(k$);const u=n.filter(l=>V(l)&&"op"in l&&l.op!=="min");n.every(l=>V(l)&&"op"in l)&&u.length===1?a=u[0]:a=!0}else if(V(a)&&"field"in a){const u=a.field;s.field===u&&(a=a.order?{order:a.order}:!0)}return{...s,sort:a}}return s}const i=qi(n.map(s=>Oc(s)||!("op"in s)||Y(s.op)&&s.op in Vte?s:(L(Kne(s)),!0)),ge);let r;i.length===1?r=i[0]:i.length>1&&(L(k$),r=!0);const o=qi(e.map(s=>Fr(s)?s.data:null),s=>s);return o.length===1&&o[0]!==null?{data:o[0],fields:t.map(a=>a.field),...r?{sort:r}:{}}:{fields:t,...r?{sort:r}:{}}}function h_(e){if(Fr(e)&&Y(e.field))return e.field;if(Zte(e)){let t;for(const n of e.fields)if(Fr(n)&&Y(n.field)){if(!t)t=n.field;else if(t!==n.field)return L(Jne),t}return L(Qne),t}else if(ene(e)){L(Zne);const t=e.fields[0];return Y(t)?t:void 0}}function hm(e,t){const i=e.component.scales[t].get("domains").map(r=>(Fr(r)&&(r.data=e.lookupDataSource(r.data)),r));return vue(i)}function WR(e){return tl(e)||g_(e)?e.children.reduce((t,n)=>t.concat(WR(n)),gA(e)):gA(e)}function gA(e){return P(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:o,type:s,selectionExtent:a,domains:u,range:l,reverse:c,...f}=r,d=wue(r.range,o,n,e),h=hm(e,n),g=a?pse(e,a,i,h):null;return t.push({name:o,type:s,...h?{domain:h}:{},...g?{domainRaw:g}:{},range:d,...c!==void 0?{reverse:c}:{},...f}),t},[])}function wue(e,t,n,i){if(ht(n)){if(ts(e))return{step:{signal:`${t}_step`}}}else if(V(e)&&Fr(e))return{...e,data:i.lookupDataSource(e.data)};return e}class HR extends Qr{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Ys(this.get("domains"),t=>z(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const _ue=["range","scheme"];function Sue(e){const t=e.component.scales;for(const n of Wp){const i=t[n];if(!i)continue;const r=Eue(n,e);i.setWithExplicit("range",r)}}function pA(e,t){const n=e.fieldDef(t);if(n!=null&&n.bin){const{bin:i,field:r}=n,o=Sn(t),s=e.getName(o);if(V(i)&&i.binned&&i.step!==void 0)return new mn(()=>{const a=e.scaleName(t),u=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(s)} / (${u})`});if(Oe(i)){const a=l_(e,r,i);return new mn(()=>{const u=e.getSignalName(a),l=`(${u}.stop - ${u}.start) / ${u}.step`;return`${e.getSignalName(s)} / (${l})`})}}}function Eue(e,t){const n=t.specifiedScales[e],{size:i}=t,o=t.getScaleComponent(e).get("type");for(const f of _ue)if(n[f]!==void 0){const d=Oy(o,f),h=qO(e,f);if(!d)L(kO(o,f,e));else if(h)L(h);else switch(f){case"range":{const g=n.range;if(z(g)){if(ht(e))return Pi(g.map(p=>{if(p==="width"||p==="height"){const m=t.getName(p),y=t.getSignalName.bind(t);return mn.fromName(y,m)}return p}))}else if(V(g))return Pi({data:t.requestDataName(De.Main),field:g.field,sort:{op:"min",field:t.vgField(e)}});return Pi(g)}case"scheme":return Pi(kue(n[f]))}}const s=e===Ie||e==="xOffset"?"width":"height",a=i[s];if(rr(a)){if(ht(e))if(gt(o)){const f=GR(a,t,e);if(f)return Pi({step:f})}else L($O(s));else if(Xu(e)){const f=e===Xo?"x":"y";if(t.getScaleComponent(f).get("type")==="band"){const g=YR(a,o);if(g)return Pi(g)}}}const{rangeMin:u,rangeMax:l}=n,c=$ue(e,t);return(u!==void 0||l!==void 0)&&Oy(o,"rangeMin")&&z(c)&&c.length===2?Pi([u??c[0],l??c[1]]):$n(c)}function kue(e){return Pie(e)?{scheme:e.name,...gn(e,["name"])}:{scheme:e}}function $ue(e,t){const{size:n,config:i,mark:r,encoding:o}=t,s=t.getSignalName.bind(t),{type:a}=tt(o[e]),l=t.getScaleComponent(e).get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case Ie:case dt:{if(pe(["point","band"],l)){const g=VR(e,n,i.view);if(rr(g))return{step:GR(g,t,e)}}const d=Sn(e),h=t.getName(d);return e===dt&&Pn(l)?[mn.fromName(s,h),0]:[0,mn.fromName(s,h)]}case Xo:case Vu:return Aue(e,t,l);case Vr:{const d=t.component.scales[e].get("zero"),h=XR(r,d,i),g=Fue(r,n,t,i);return ku(l)?Mue(h,g,Cue(l,i,c,e)):[h,g]}case Zn:return[0,Math.PI*2];case ha:return[0,360];case Mi:return[0,new mn(()=>{const d=t.getSignalName("width"),h=t.getSignalName("height");return`min(${d},${h})/2`})];case Qo:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case Zo:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case _n:return"symbol";case wn:case dr:case hr:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case Xr:case Ko:case Jo:return[i.scale.minOpacity,i.scale.maxOpacity]}}function GR(e,t,n){const{encoding:i}=t,r=t.getScaleComponent(n),o=uw(n),s=i[o];if(R6({step:e,offsetIsDiscrete:se(s)&&PO(s.type)})==="offset"&&y6(i,o)){const u=t.getScaleComponent(o);let c=`domain('${t.scaleName(o)}').length`;if(u.get("type")==="band"){const d=u.get("paddingInner")??u.get("padding")??0,h=u.get("paddingOuter")??u.get("padding")??0;c=`bandspace(${c}, ${d}, ${h})`}const f=r.get("paddingInner")??r.get("padding");return{signal:`${e.step} * ${c} / (1-${rne(f)})`}}else return e.step}function YR(e,t){if(R6({step:e,offsetIsDiscrete:gt(t)})==="offset")return{step:e.step}}function Aue(e,t,n){const i=e===Xo?"x":"y",o=t.getScaleComponent(i).get("type"),s=t.scaleName(i);if(o==="band"){const a=VR(i,t.size,t.config.view);if(rr(a)){const u=YR(a,n);if(u)return u}return[0,{signal:`bandwidth('${s}')`}]}else{const a=t.encoding[i];if(I(a)&&a.timeUnit){const u=OO(a.timeUnit,c=>`scale('${s}', ${c})`),l=t.config.scale.bandWithNestedOffsetPaddingInner;if(l){const c=Q(l)?`${l.signal}/2`:`${l/2}`,f=Q(l)?`(1 - ${l.signal}/2)`:`${1-l/2}`;return[{signal:`${c} * (${u})`},{signal:`${f} * (${u})`}]}return[0,{signal:u}]}return HN(`Cannot use ${e} scale if ${i} scale is not discrete.`)}}function VR(e,t,n){const i=e===Ie?"width":"height",r=t[i];return r||yg(n,i)}function Cue(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&z(n)?n.length+1:(L(uie(i)),3)}}function Mue(e,t,n){const i=()=>{const r=hi(t),o=hi(e),s=`(${r} - ${o}) / (${n} - 1)`;return`sequence(${o}, ${r} + ${s}, ${s})`};return Q(t)?new mn(i):{signal:i()}}function XR(e,t,n){if(t)return Q(t)?{signal:`${t.signal} ? 0 : ${XR(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Gp("size",e))}const mA=.95;function Fue(e,t,n,i){const r={x:pA(n,"x"),y:pA(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const o=yA(t,r,i.view);return Ae(o)?o-1:new mn(()=>`${o.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const o=yA(t,r,i.view);return Ae(o)?Math.pow(mA*o,2):new mn(()=>`pow(${mA} * ${o.signal}, 2)`)}}throw new Error(Gp("size",e))}function yA(e,t,n){const i=rr(e.width)?e.width.step:mg(n,"width"),r=rr(e.height)?e.height.step:mg(n,"height");return t.x||t.y?new mn(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function KR(e,t){Ye(e)?Tue(e,t):QR(e,t)}function Tue(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:o,specifiedScales:s}=e;for(const a of P(n)){const u=s[a],l=n[a],c=e.getScaleComponent(a),f=tt(r[a]),d=u[t],h=c.get("type"),g=c.get("padding"),p=c.get("paddingInner"),m=Oy(h,t),y=qO(a,t);if(d!==void 0&&(m?y&&L(y):L(kO(h,t,a))),m&&y===void 0)if(d!==void 0){const b=f.timeUnit,x=f.type;switch(t){case"domainMax":case"domainMin":ma(u[t])||x==="temporal"||b?l.set(t,{signal:im(u[t],{type:x,timeUnit:b})},!0):l.set(t,u[t],!0);break;default:l.copyKeyFromObject(t,u)}}else{const b=t in bA?bA[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:h,scalePadding:g,scalePaddingInner:p,domain:u.domain,domainMin:u.domainMin,domainMax:u.domainMax,markDef:o,config:i,hasNestedOffsetScale:zy(r,a),hasSecondaryRangeChannel:!!r[gr(a)]}):i.scale[t];b!==void 0&&l.set(t,b,!1)}}}const bA={bins:({model:e,fieldOrDatumDef:t})=>I(t)?Due(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>Nue(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:o})=>Oue(e,t,n,i,r,o),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>Rue(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:o})=>zue(e,t,n.type,i,r.scale,o),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:o})=>Pue(e,t,n,i,r.scale,o),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=I(e)?e.sort:void 0;return Lue(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r,config:o,hasSecondaryRangeChannel:s})=>Iue(e,t,n,i,r,o.scale,s)};function JR(e){Ye(e)?Sue(e):QR(e,"range")}function QR(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?JR(i):KR(i,t);for(const i of P(n)){let r;for(const o of e.children){const s=o.component.scales[i];if(s){const a=s.getWithExplicit(t);r=Io(r,a,t,"scale",Y6((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function Due(e,t){const n=t.bin;if(Oe(n)){const i=l_(e,t.field,n);return new mn(()=>e.getSignalName(i))}else if(yt(n)&&pa(n)&&n.step!==void 0)return{step:n.step}}function Nue(e,t){if(pe([wn,dr,hr],e)&&t!=="nominal")return"hcl"}function Oue(e,t,n,i,r,o){var s;if(!((s=ir(o))!=null&&s.bin||z(n)||r!=null||i!=null||pe([pn.TIME,pn.UTC],e)))return ht(t)?!0:void 0}function Rue(e,t,n,i,r,o){if(ht(e)){if(gi(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:s,orient:a}=r;if(s==="bar"&&!(I(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return o.continuousBandSize}if(t===pn.POINT)return n.pointPadding}}function zue(e,t,n,i,r,o=!1){if(e===void 0){if(ht(t)){const{bandPaddingInner:s,barBandPaddingInner:a,rectBandPaddingInner:u,bandWithNestedOffsetPaddingInner:l}=r;return o?l:Ve(s,n==="bar"?a:u)}else if(Xu(t)&&i===pn.BAND)return r.offsetBandPaddingInner}}function Pue(e,t,n,i,r,o=!1){if(e===void 0){if(ht(t)){const{bandPaddingOuter:s,bandWithNestedOffsetPaddingOuter:a}=r;if(o)return a;if(n===pn.BAND)return Ve(s,Q(i)?{signal:`${i.signal}/2`}:i/2)}else if(Xu(t)){if(n===pn.POINT)return .5;if(n===pn.BAND)return r.offsetBandPaddingOuter}}}function Lue(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return Pn(e)&&t==="descending"?Q(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(Pn(e)&&t==="descending")return!0}function Iue(e,t,n,i,r,o,s){if(!!n&&n!=="unaggregated"&&Pn(r)){if(z(n)){const u=n[0],l=n[n.length-1];if(u<=0&&l>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!ku(r))return!0;if(!(I(t)&&t.bin)&&pe([...pr,...Bte],e)){const{orient:u,type:l}=i;return pe(["bar","area","line","trail"],l)&&(u==="horizontal"&&e==="y"||u==="vertical"&&e==="x")?!1:pe(["bar","area"],l)&&!s?!0:o==null?void 0:o.zero}return!1}function Bue(e,t,n,i,r=!1){const o=jue(t,n,i,r),{type:s}=e;return Kr(t)?s!==void 0?Wie(t,s)?I(n)&&!qie(s,n.type)?(L(Gne(s,o)),o):s:(L(Hne(t,s,o)),o):o:null}function jue(e,t,n,i){var r;switch(t.type){case"nominal":case"ordinal":{if(Va(e)||F0(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&L(T0(e,"ordinal")),"ordinal";if(ht(e)||Xu(e)){if(pe(["rect","bar","image","rule"],n.type)||i)return"band"}else if(n.type==="arc"&&e in fw)return"band";const o=n[Sn(e)];return Qs(o)||Au(t)&&((r=t.axis)!=null&&r.tickBand)?"band":"point"}case"temporal":return Va(e)?"time":F0(e)==="discrete"?(L(T0(e,"temporal")),"ordinal"):I(t)&&t.timeUnit&&St(t.timeUnit).utc?"utc":"time";case"quantitative":return Va(e)?I(t)&&Oe(t.bin)?"bin-ordinal":"linear":F0(e)==="discrete"?(L(T0(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(SO(t.type))}function Uue(e,{ignoreRange:t}={}){ZR(e),qR(e);for(const n of Uie)KR(e,n);t||JR(e)}function ZR(e){Ye(e)?e.component.scales=que(e):e.component.scales=Hue(e)}function que(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const o of Wp){const s=tt(t[o]);if(s&&n===GO&&o===_n&&s.type===Ku)continue;let a=s&&s.scale;if(Xu(o)){const u=aO(o);if(!zy(t,u)){a&&L(Tne(o));continue}}if(s&&a!==null&&a!==!1){a??(a={});const u=zy(t,o),l=Bue(a,o,s,i,u);r[o]=new HR(e.scaleName(`${o}`,!0),{value:l,explicit:a.type===l})}}return r}const Wue=Y6((e,t)=>A$(e)-A$(t));function Hue(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const o of e.children){ZR(o);for(const s of P(o.component.scales))if((t=r.scale)[s]??(t[s]=FR(s,e)),r.scale[s]==="shared"){const a=i[s],u=o.component.scales[s].getWithExplicit("type");a?Die(a.value,u.value)?i[s]=Io(a,u,"type","scale",Wue):(r.scale[s]="independent",delete i[s]):i[s]=u}}for(const o of P(i)){const s=e.scaleName(o,!0),a=i[o];n[o]=new HR(s,a);for(const u of e.children){const l=u.component.scales[o];l&&(u.renameScale(l.get("name"),s),l.merged=!0)}}return n}class I0{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function Ye(e){return(e==null?void 0:e.type)==="unit"}function xi(e){return(e==null?void 0:e.type)==="facet"}function g_(e){return(e==null?void 0:e.type)==="concat"}function tl(e){return(e==null?void 0:e.type)==="layer"}class p_{constructor(t,n,i,r,o,s,a){this.type=n,this.parent=i,this.config=o,this.correctDataNames=u=>{var l,c,f;return(l=u.from)!=null&&l.data&&(u.from.data=this.lookupDataSource(u.from.data)),(f=(c=u.from)==null?void 0:c.facet)!=null&&f.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u},this.parent=i,this.config=o,this.view=ln(a),this.name=t.name??r,this.title=uo(t.title)?{text:t.title}:t.title?ln(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new I0,this.projectionNameMap=i?i.projectionNameMap:new I0,this.signalNameMap=i?i.signalNameMap:new I0,this.data=t.data,this.description=t.description,this.transforms=Qoe(t.transform??[]),this.layout=n==="layer"||n==="unit"?{}:soe(t,n,o),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Zp(t)||(i==null?void 0:i.component.data.isFaceted)&&t.data===void 0},layoutSize:new Qr,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...s?oe(s):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Uue(this)}parseProjection(){BR(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){RR(this)}assembleEncodeFromView(t){const{style:n,...i}=t,r={};for(const o of P(i)){const s=i[o];s!==void 0&&(r[o]=ze(s))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=ze(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...n??{}}:Me(n)?void 0:n}assembleLayout(){if(!this.layout)return;const{spacing:t,...n}=this.layout,{component:i,config:r}=this,o=dae(i.layoutHeaders,r);return{padding:t,...this.assembleDefaultLayout(),...n,...o?{titleBand:o}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of qn)t[i].title&&n.push(sae(this,i));for(const i of o_)n=n.concat(aae(this,i));return n}assembleAxes(){return Yse(this.component.axes,this.config)}assembleLegends(){return PR(this)}assembleProjections(){return Rae(this)}assembleTitle(){const{encoding:t,...n}=this.title??{},i={...gO(this.config.title).nonMarkTitleProperties,...n,...t?{encode:{update:t}}:{}};if(i.text)return pe(["unit","layer"],this.type)?pe(["middle",void 0],i.anchor)&&(i.frame??(i.frame="group")):i.anchor??(i.anchor="start"),Me(i)?void 0:i}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||xi(this.parent)?WR(this):[];r.length>0&&(n.scales=r);const o=this.assembleAxes();o.length>0&&(n.axes=o);const s=this.assembleLegends();return s.length>0&&(n.legends=s),n}getName(t){return Le((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(De[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(xi(this.parent)){const n=CR(t),i=qp(n),r=this.component.scales[i];if(r&&!r.merged){const o=r.get("type"),s=r.get("range");if(gt(o)&&ts(s)){const a=r.get("name"),u=hm(this,i),l=h_(u);if(l){const c=W({aggregate:"distinct",field:l},{expr:"datum"});return{signal:AR(a,r,c)}}else return L(gw(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(rO(t)&&Kr(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(lne(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)==null?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)==null?void 0:n.some(i=>i.hasOrientSignalRef()))}}class e4 extends p_{vgField(t,n={}){const i=this.fieldDef(t);if(i)return W(i,n)}reduceFieldDef(t,n){return Rre(this.getMapping(),(i,r,o)=>{const s=ir(r);return s?t(i,s,o):i},n)}forEachFieldDef(t,n){jw(this.getMapping(),(i,r)=>{const o=ir(i);o&&t(o,r)},n)}}class gm extends Ce{clone(){return new gm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"value",i[1]??"density"],n.groupby&&n.minsteps==null&&n.maxsteps==null&&n.steps==null&&(this.transform.steps=200)}dependentFields(){return new Set([this.transform.density,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${ge(this.transform)}`}assemble(){const{density:t,...n}=this.transform;return{type:"kde",field:t,...n}}}class pm extends Ce{clone(){return new pm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n)}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return`ExtentTransform ${ge(this.transform)}`}assemble(){const{extent:t,param:n}=this.transform;return{type:"extent",field:t,signal:n}}}class Pc extends Ce{clone(){return new Pc(null,{...this.filter})}constructor(t,n){super(t),this.filter=n}static make(t,n){const{config:i,mark:r,markDef:o}=n;if(ke("invalid",o,i)!=="filter")return null;const a=n.reduceFieldDef((u,l,c)=>{const f=Kr(c)&&n.getScaleComponent(c);if(f){const d=f.get("type");Pn(d)&&l.aggregate!=="count"&&!ns(r)&&(u[l.field]=l)}return u},{});return P(a).length?new Pc(t,a):null}dependentFields(){return new Set(P(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${ge(this.filter)}`}assemble(){const t=P(this.filter).reduce((n,i)=>{const r=this.filter[i],o=W(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${o}) || (isValid(${o}) && isFinite(+${o})))`):r.type==="quantitative"&&(n.push(`isValid(${o})`),n.push(`isFinite(+${o})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class mm extends Ce{clone(){return new mm(this.parent,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((o,s)=>r[s]??o)}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${ge(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class ym extends Ce{clone(){return new ym(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"key",i[1]??"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${ge(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class Ja extends Ce{clone(){return new Ja(null,oe(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Ti,Fi],[Jn,Di]]){const o=r.map(s=>{const a=tt(n.encoding[s]);return I(a)?a.field:mr(a)?{expr:`${a.datum}`}:Si(a)?{expr:`${a.value}`}:void 0});(o[0]||o[1])&&(t=new Ja(t,o,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(_n)){const r=n.typedFieldDef(_n);r.type===Ku&&(t=new Ja(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}constructor(t,n,i,r){super(t),this.fields=n,this.geojson=i,this.signal=r}dependentFields(){const t=(this.fields??[]).filter(Y);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${ge(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class Lc extends Ce{clone(){return new Lc(null,this.projection,oe(this.fields),oe(this.as))}constructor(t,n,i,r){super(t),this.projection=n,this.fields=i,this.as=r}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Ti,Fi],[Jn,Di]]){const r=i.map(s=>{const a=tt(n.encoding[s]);return I(a)?a.field:mr(a)?{expr:`${a.datum}`}:Si(a)?{expr:`${a.value}`}:void 0}),o=i[0]===Jn?"2":"";(r[0]||r[1])&&(t=new Lc(t,n.projectionName(),r,[n.getName(`x${o}`),n.getName(`y${o}`)]))}return t}dependentFields(){return new Set(this.fields.filter(Y))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${ge(this.fields)} ${ge(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class zs extends Ce{clone(){return new zs(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set([this.transform.impute,this.transform.key,...this.transform.groupby??[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,n){return new zs(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,o=i.y;if(I(r)&&I(o)){const s=r.impute?r:o.impute?o:void 0;if(s===void 0)return;const a=r.impute?o:o.impute?r:void 0,{method:u,value:l,frame:c,keyvals:f}=s.impute,d=x6(n.mark,i);return new zs(t,{impute:s.field,key:a.field,...u?{method:u}:{},...l!==void 0?{value:l}:{},...c?{frame:c}:{},...f!==void 0?{keyvals:f}:{},...d.length?{groupby:d}:{}})}return null}hash(){return`Impute ${ge(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:o,value:s,frame:a=[null,null]}=this.transform,u={type:"impute",field:t,key:n,...i?{keyvals:Noe(i)?this.processSequence(i):i}:{},method:"value",...o?{groupby:o}:{},value:!r||r==="value"?s:null};if(r&&r!=="value"){const l={type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1,...o?{groupby:o}:{}},c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}class bm extends Ce{clone(){return new bm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.loess]}dependentFields(){return new Set([this.transform.loess,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${ge(this.transform)}`}assemble(){const{loess:t,on:n,...i}=this.transform;return{type:"loess",x:n,y:t,...i}}}class Ic extends Ce{clone(){return new Ic(null,oe(this.transform),this.secondary)}constructor(t,n,i){super(t),this.transform=n,this.secondary=i}static make(t,n,i,r){const o=n.component.data.sources,{from:s}=i;let a=null;if(Ooe(s)){let u=i4(s.data,o);u||(u=new na(s.data),o.push(u));const l=n.getName(`lookup_${r}`);a=new Zt(u,l,De.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(Roe(s)){const u=s.param;i={as:u,...i};let l;try{l=n.getSelectionComponent(Le(u),u)}catch{throw new Error(dne(u))}if(a=l.materialized,!a)throw new Error(hne(u))}return new Ic(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?H(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${ge({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t={values:this.transform.from.fields,...this.transform.as?{as:H(this.transform.as)}:{}};else{let n=this.transform.as;Y(n)||(L(wne),n="_lookup"),t={as:[n]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...t,...this.transform.default?{default:this.transform.default}:{}}}}class xm extends Ce{clone(){return new xm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"prob",i[1]??"value"]}dependentFields(){return new Set([this.transform.quantile,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${ge(this.transform)}`}assemble(){const{quantile:t,...n}=this.transform;return{type:"quantile",field:t,...n}}}class vm extends Ce{clone(){return new vm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=oe(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.regression]}dependentFields(){return new Set([this.transform.regression,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${ge(this.transform)}`}assemble(){const{regression:t,on:n,...i}=this.transform;return{type:"regression",x:n,y:t,...i}}}class wm extends Ce{clone(){return new wm(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=qi((this.transform.groupby??[]).concat(t),n=>n)}producedFields(){}dependentFields(){return new Set([this.transform.pivot,this.transform.value,...this.transform.groupby??[]])}hash(){return`PivotTransform ${ge(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:o}=this.transform;return{type:"pivot",field:t,value:n,...r!==void 0?{limit:r}:{},...o!==void 0?{op:o}:{},...i!==void 0?{groupby:i}:{}}}}class _m extends Ce{clone(){return new _m(null,oe(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${ge(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function t4(e){let t=0;function n(i,r){if(i instanceof na&&!i.isGenerator&&!Mu(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof Ot&&(i.parent instanceof na&&!r.source?(r.format={...r.format??{},parse:i.assembleFormatParse()},r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Zu){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}switch((i instanceof Tf||i instanceof Df||i instanceof Pc||i instanceof Qu||i instanceof Tu||i instanceof Lc||i instanceof bi||i instanceof Ic||i instanceof el||i instanceof xa||i instanceof ym||i instanceof mm||i instanceof gm||i instanceof bm||i instanceof xm||i instanceof vm||i instanceof Uo||i instanceof _m||i instanceof wm||i instanceof pm)&&r.transform.push(i.assemble()),(i instanceof Xi||i instanceof Vi||i instanceof zs||i instanceof Pr||i instanceof Ja)&&r.transform.push(...i.assemble()),i instanceof Zt&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof Zt?i.setSource(r.name):(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof Zt&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const s of i.children)n(s,{name:null,source:o,transform:[]});break}}}return n}function Gue(e){const t=[],n=t4(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function Yue(e,t){const n=[],i=t4(n);let r=0;for(const s of e.sources){s.hasName()||(s.dataName=`source_${r++}`);const a=s.assemble();i(s,a)}for(const s of n)s.transform.length===0&&delete s.transform;let o=0;for(const[s,a]of n.entries())(a.transform??[]).length===0&&!a.source&&n.splice(o++,0,n.splice(s,1)[0]);for(const s of n)for(const a of s.transform??[])a.type==="lookup"&&(a.from=e.outputNodes[a.from].getSource());for(const s of n)s.name in t&&(s.values=t[s.name]);return n}function Vue(e){return e==="top"||e==="left"||Q(e)?"header":"footer"}function Xue(e){for(const t of qn)Kue(e,t);xA(e,"x"),xA(e,"y")}function Kue(e,t){var s;const{facet:n,config:i,child:r,component:o}=e;if(e.channelHasField(t)){const a=n[t],u=Nu("title",null,i,t);let l=Xa(a,i,{allowDisabling:!0,includeDefault:u===void 0||!!u});r.component.layoutHeaders[t].title&&(l=z(l)?l.join(", "):l,l+=` / ${r.component.layoutHeaders[t].title}`,r.component.layoutHeaders[t].title=null);const c=Nu("labelOrient",a.header,i,t),f=a.header!==null?Ve((s=a.header)==null?void 0:s.labels,i.header.labels,!0):!1,d=pe(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[n4(e,t,f)]}}}function n4(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function xA(e,t){const{child:n}=e;if(n.component.axes[t]){const{layoutHeaders:i,resolve:r}=e.component;if(r.axis[t]=u_(r,t),r.axis[t]==="shared"){const o=t==="x"?"column":"row",s=i[o];for(const a of n.component.axes[t]){const u=Vue(a.get("orient"));s[u]??(s[u]=[n4(e,o,!1)]);const l=Gl(a,"main",e.config,{header:!0});l&&s[u][0].axes.push(l),a.mainExtracted=!0}}}}function Jue(e){m_(e),wg(e,"width"),wg(e,"height")}function Que(e){m_(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";wg(e,t),wg(e,n)}function m_(e){for(const t of e.children)t.parseLayoutSize()}function wg(e,t){const n=CR(t),i=qp(n),r=e.component.resolve,o=e.component.layoutSize;let s;for(const a of e.children){const u=a.component.layoutSize.getWithExplicit(n),l=r.scale[i]??FR(i,e);if(l==="independent"&&u.value==="step"){s=void 0;break}if(s){if(l==="independent"&&s.value!==u.value){s=void 0;break}s=Io(s,u,n,"")}else s=u}if(s){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);o.setWithExplicit(t,s)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function Zue(e){const{size:t,component:n}=e;for(const i of pr){const r=Sn(i);if(t[r]){const o=t[r];n.layoutSize.set(r,rr(o)?"step":o,!0)}else{const o=ele(e,r);n.layoutSize.set(r,o,!1)}}}function ele(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const o=r.get("type"),s=r.get("range");if(gt(o)){const a=yg(i.view,t);return ts(s)||rr(a)?"step":a}else return Ly(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Ly(i.view,t);{const o=yg(i.view,t);return rr(o)?o.step:o}}}function Qy(e,t,n){return W(t,{suffix:`by_${W(e)}`,...n??{}})}class ac extends e4{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve),this.child=w_(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!$f(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=P(t),i={};for(const r of n){if(![Or,Rr].includes(r)){L(Gp(r,"facet"));break}const o=t[r];if(o.field===void 0){L(Dy(o,r));break}i[r]=this.initFacetFieldDef(o,r)}return i}initFacetFieldDef(t,n){const i=Iw(t,n);return i.header?i.header=ln(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Sm(this),this.child.parseData()}parseLayoutSize(){m_(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Xue(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){const t={};for(const n of qn)for(const i of s_){const r=this.component.layoutHeaders[n],o=r[i],{facetFieldDef:s}=r;if(s){const a=Nu("titleOrient",s.header,this.config,n);if(["right","bottom"].includes(a)){const u=fm(n,a);t.titleAnchor??(t.titleAnchor={}),t.titleAnchor[u]="end"}}if(o!=null&&o[0]){const a=n==="row"?"height":"width",u=i==="header"?"headerBand":"footerBand";n!=="facet"&&!this.child.component.layoutSize.get(a)&&(t[u]??(t[u]={}),t[u][n]=.5),r.title&&(t.offset??(t.offset={}),t.offset[n==="row"?"rowTitle":"columnTitle"]=10)}}return t}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),{...this.getHeaderLayoutMixins(),...i?{columns:i}:{},bounds:"full",align:r}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof ac))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(t){return this.parent&&this.parent instanceof ac?{...this.channelHasField("column")?{encode:{update:{columns:{field:W(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(t)}:super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof ac){if(this.child.channelHasField("column")){const r=W(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of pr){const o=this.child.component.scales[r];if(o&&!o.merged){const s=o.get("type"),a=o.get("range");if(gt(s)&&ts(a)){const u=hm(this.child,r),l=h_(u);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):L(gw(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:o,ops:s,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const c of qn){const f=this.facet[c];if(f){u.push(W(f));const{bin:d,sort:h}=f;if(Oe(d)&&u.push(W(f,{binSuffix:"end"})),Yi(h)){const{field:g,op:p=Qp}=h,m=Qy(f,h);i&&r?(o.push(m),s.push("max"),a.push(m)):(o.push(g),s.push(p),a.push(m))}else if(z(h)){const g=Du(f,c);o.push(g),s.push("max"),a.push(g)}}}const l=!!i&&!!r;return{name:t,data:n,groupby:u,...l||o.length>0?{aggregate:{...l?{cross:l}:{},...o.length?{fields:o,ops:s,as:a}:{}}}:{}}}facetSortFields(t){const{facet:n}=this,i=n[t];return i?Yi(i.sort)?[Qy(i,i.sort,{expr:"datum"})]:z(i.sort)?[Du(i,t,{expr:"datum"})]:[W(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(Yi(r)?r.order:!z(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){var r;const{facet:t,config:n}=this;if(t.facet)return Gy(t.facet,"facet",n);const i={row:["top","bottom"],column:["left","right"]};for(const o of o_)if(t[o]){const s=Nu("labelOrient",(r=t[o])==null?void 0:r.header,n,o);if(i[o].includes(s))return Gy(t[o],o,n)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=Gue(n),r=t.assembleGroupEncodeEntry(!1),o=this.assembleLabelTitle()||t.assembleTitle(),s=t.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...o?{title:o}:{},...s?{style:s}:{},from:{facet:this.assembleFacet()},sort:{field:qn.map(u=>this.facetSortFields(u)).flat(),order:qn.map(u=>this.facetSortOrder(u)).flat()},...i.length>0?{data:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup(fse(this,[]))}]}getMapping(){return this.facet}}function tle(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const o of[n,i])if(Yi(o.sort)){const{field:s,op:a=Qp}=o.sort;e=r=new xa(e,{joinaggregate:[{op:a,field:s,as:Qy(o,o.sort,{forAs:!0})}],groupby:[W(o)]})}return r}return null}function i4(e,t){var n,i,r,o;for(const s of t){const a=s.data;if(e.name&&s.hasName()&&e.name!==s.dataName)continue;const u=(n=e.format)==null?void 0:n.mesh,l=(i=a.format)==null?void 0:i.feature;if(u&&l)continue;const c=(r=e.format)==null?void 0:r.feature;if((c||l)&&c!==l)continue;const f=(o=a.format)==null?void 0:o.mesh;if(!((u||f)&&u!==f)){if(zc(e)&&zc(a)){if(Ui(e.values,a.values))return s}else if(Mu(e)&&Mu(a)){if(e.url===a.url)return s}else if(V6(e)&&e.name===s.dataName)return s}}return null}function nle(e,t){if(e.data||!e.parent){if(e.data===null){const i=new na({values:[]});return t.push(i),i}const n=i4(e.data,t);if(n)return $o(e.data)||(n.data.format=GN({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new na(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function ile(e,t,n){let i=0;for(const r of t.transforms){let o,s;if(Hoe(r))s=e=new Tu(e,r),o="derived";else if(Qw(r)){const a=Vae(r);s=e=Ot.makeWithAncestors(e,{},a,n)??e,e=new Qu(e,t,r.filter)}else if(q6(r))s=e=Xi.makeFromTransform(e,r,t),o="number";else if(Yoe(r))o="date",n.getWithExplicit(r.field).value===void 0&&(e=new Ot(e,{[r.field]:o}),n.set(r.field,o,!1)),s=e=Vi.makeFromTransform(e,r);else if(Voe(r))s=e=bi.makeFromTransform(e,r),o="number",r_(t)&&(e=new Uo(e));else if(U6(r))s=e=Ic.make(e,t,r,i++),o="derived";else if(Uoe(r))s=e=new el(e,r),o="number";else if(qoe(r))s=e=new xa(e,r),o="number";else if(Xoe(r))s=e=Pr.makeFromTransform(e,r),o="derived";else if(Koe(r))s=e=new ym(e,r),o="derived";else if(Joe(r))s=e=new pm(e,r),o="derived";else if(Woe(r))s=e=new mm(e,r),o="derived";else if(zoe(r))s=e=new wm(e,r),o="derived";else if(joe(r))e=new _m(e,r);else if(Goe(r))s=e=zs.makeFromTransform(e,r),o="derived";else if(Poe(r))s=e=new gm(e,r),o="derived";else if(Loe(r))s=e=new xm(e,r),o="derived";else if(Ioe(r))s=e=new vm(e,r),o="derived";else if(Boe(r))s=e=new bm(e,r),o="derived";else{L(vne(r));continue}if(s&&o!==void 0)for(const a of s.producedFields()??[])n.set(a,o,!1)}return e}function Sm(e){var p;let t=nle(e,e.component.data.sources);const{outputNodes:n,outputNodeRefCounts:i}=e.component.data,r=e.data,s=!(r&&($o(r)||Mu(r)||zc(r)))&&e.parent?e.parent.component.data.ancestorParse.clone():new lse;$o(r)?(X6(r)?t=new Df(t,r.sequence):Zw(r)&&(t=new Tf(t,r.graticule)),s.parseNothing=!0):((p=r==null?void 0:r.format)==null?void 0:p.parse)===null&&(s.parseNothing=!0),t=Ot.makeExplicit(t,e,s)??t,t=new Uo(t);const a=e.parent&&tl(e.parent);(Ye(e)||xi(e))&&a&&(t=Xi.makeFromEncoding(t,e)??t),e.transforms.length>0&&(t=ile(t,e,s));const u=Kae(e),l=Xae(e);t=Ot.makeWithAncestors(t,{},{...u,...l},s)??t,Ye(e)&&(t=Ja.parseAll(t,e),t=Lc.parseAll(t,e)),(Ye(e)||xi(e))&&(a||(t=Xi.makeFromEncoding(t,e)??t),t=Vi.makeFromEncoding(t,e)??t,t=Tu.parseAllForSortIndex(t,e));const c=e.getDataName(De.Raw),f=new Zt(t,c,De.Raw,i);if(n[c]=f,t=f,Ye(e)){const m=bi.makeFromEncoding(t,e);m&&(t=m,r_(e)&&(t=new Uo(t))),t=zs.makeFromEncoding(t,e)??t,t=Pr.makeFromEncoding(t,e)??t}Ye(e)&&(t=Pc.make(t,e)??t);const d=e.getDataName(De.Main),h=new Zt(t,d,De.Main,i);n[d]=h,t=h,Ye(e)&&Hse(e,h);let g=null;if(xi(e)){const m=e.getName("facet");t=tle(t,e.facet)??t,g=new Zu(t,e,m,h.getSource()),n[m]=g}return{...e.component.data,outputNodes:n,outputNodeRefCounts:i,raw:f,main:h,facetRoot:g,ancestorParse:s}}class rle extends p_{constructor(t,n,i,r){var o,s,a,u;super(t,"concat",n,i,r,t.resolve),(((s=(o=t.resolve)==null?void 0:o.axis)==null?void 0:s.x)==="shared"||((u=(a=t.resolve)==null?void 0:a.axis)==null?void 0:u.y)==="shared")&&L(yne),this.children=this.getChildren(t).map((l,c)=>w_(l,this,this.getName(`concat_${c}`),void 0,r))}parseData(){this.component.data=Sm(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of P(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return sm(t)?t.vconcat:Kw(t)?t.hconcat:t.concat}parseLayoutSize(){Que(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=a_(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return{type:"group",name:t.getName("group"),...n?{title:n}:{},...i?{style:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){const t=this.layout.columns;return{...t!=null?{columns:t}:{},bounds:"full",align:"each"}}}function ole(e){return e===!1||e===null}const sle={disable:1,gridScale:1,scale:1,...p6,labelExpr:1,encode:1},r4=P(sle);class y_ extends Qr{constructor(t={},n={},i=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new y_(oe(this.explicit),oe(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!ole(this.get(t))}hasOrientSignalRef(){return Q(this.explicit.orient)}}function ale(e,t,n){const{encoding:i,config:r}=e,o=tt(i[t])??tt(i[gr(t)]),s=e.axis(t)||{},{format:a,formatType:u}=s;if(Zs(u))return{text:pi({fieldOrDatumDef:o,field:"datum.value",format:a,formatType:u,config:r}),...n};if(a===void 0&&u===void 0&&r.customFormatTypes){if($u(o)==="quantitative"){if(Au(o)&&o.stack==="normalize"&&r.normalizedNumberFormatType)return{text:pi({fieldOrDatumDef:o,field:"datum.value",format:r.normalizedNumberFormat,formatType:r.normalizedNumberFormatType,config:r}),...n};if(r.numberFormatType)return{text:pi({fieldOrDatumDef:o,field:"datum.value",format:r.numberFormat,formatType:r.numberFormatType,config:r}),...n}}if($u(o)==="temporal"&&r.timeFormatType&&I(o)&&!o.timeUnit)return{text:pi({fieldOrDatumDef:o,field:"datum.value",format:r.timeFormat,formatType:r.timeFormatType,config:r}),...n}}return n}function ule(e){return pr.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[ple(n,e)]),t),{})}const lle={bottom:"top",top:"bottom",left:"right",right:"left"};function cle(e){const{axes:t,resolve:n}=e.component,i={top:0,bottom:0,right:0,left:0};for(const r of e.children){r.parseAxesAndHeaders();for(const o of P(r.component.axes))n.axis[o]=u_(e.component.resolve,o),n.axis[o]==="shared"&&(t[o]=fle(t[o],r.component.axes[o]),t[o]||(n.axis[o]="independent",delete t[o]))}for(const r of pr){for(const o of e.children)if(o.component.axes[r]){if(n.axis[r]==="independent"){t[r]=(t[r]??[]).concat(o.component.axes[r]);for(const s of o.component.axes[r]){const{value:a,explicit:u}=s.getWithExplicit("orient");if(!Q(a)){if(i[a]>0&&!u){const l=lle[a];i[a]>i[l]&&s.set("orient",l,!1)}i[a]++}}}delete o.component.axes[r]}if(n.axis[r]==="independent"&&t[r]&&t[r].length>1)for(const[o,s]of(t[r]||[]).entries())o>0&&s.get("grid")&&!s.explicit.grid&&(s.implicit.grid=!1)}}function fle(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],o=t[i];if(!!r!=!!o)return;if(r&&o){const s=r.getWithExplicit("orient"),a=o.getWithExplicit("orient");if(s.explicit&&a.explicit&&s.value!==a.value)return;e[i]=dle(r,o)}}}else return t.map(n=>n.clone());return e}function dle(e,t){for(const n of r4){const i=Io(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,o)=>{switch(n){case"title":return wO(r,o);case"gridScale":return{explicit:r.explicit,value:Ve(r.value,o.value)}}return um(r,o,n,"axis")});e.setWithExplicit(n,i)}return e}function hle(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(Q(n.labelAngle)?n.labelAngle:Rc(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===SR(i,r))return!0}return e===n[t]}const gle=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function ple(e,t){var y,b;let n=t.axis(e);const i=new y_,r=tt(t.encoding[e]),{mark:o,config:s}=t,a=(n==null?void 0:n.orient)||((y=s[e==="x"?"axisX":"axisY"])==null?void 0:y.orient)||((b=s.axis)==null?void 0:b.orient)||tae(e),u=t.getScaleComponent(e).get("type"),l=Vse(e,u,a,t.config),c=n!==void 0?!n:Wy("disable",s.style,n==null?void 0:n.style,l).configValue;if(i.set("disable",c,n!==void 0),c)return i;n=n||{};const f=Qse(r,n,e,s.style,l),d=ZO(n.formatType,r,u),h=QO(r,r.type,n.format,n.formatType,s,!0),g={fieldOrDatumDef:r,axis:n,channel:e,model:t,scaleType:u,orient:a,labelAngle:f,format:h,formatType:d,mark:o,config:s};for(const x of r4){const v=x in rA?rA[x](g):O$(x)?n[x]:void 0,w=v!==void 0,S=hle(v,x,n,t,e);if(w&&S)i.set(x,v,S);else{const{configValue:_=void 0,configFrom:E=void 0}=O$(x)&&x!=="values"?Wy(x,s.style,n.style,l):{},A=_!==void 0;w&&!A?i.set(x,v,S):(E!=="vgAxisConfig"||gle.has(x)&&A||Mf(_)||Q(_))&&i.set(x,_,!1)}}const p=n.encoding??{},m=g6.reduce((x,v)=>{if(!i.hasAxisPart(v))return x;const w=MR(p[v]??{},t),S=v==="labels"?ale(t,e,w):w;return S!==void 0&&!Me(S)&&(x[v]={update:S}),x},{});return Me(m)||i.set("encode",m,!!n.encoding||n.labelAngle!==void 0),i}function mle({encoding:e,size:t}){for(const n of pr){const i=Sn(n);rr(t[i])&&vo(e[n])&&(delete t[i],L($O(i)))}return t}function yle(e,t,n){const i=ln(e),r=ke("orient",i,n);if(i.orient=wle(i.type,t,r),r!==void 0&&r!==i.orient&&L(Lne(i.orient,r)),i.type==="bar"&&i.orient){const a=ke("cornerRadiusEnd",i,n);if(a!==void 0){const u=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:nre[i.orient];for(const l of u)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return ke("opacity",i,n)===void 0&&(i.opacity=xle(i.type,t)),ke("cursor",i,n)===void 0&&(i.cursor=ble(i,t,n)),i}function ble(e,t,n){return t.href||e.href||ke("href",e,n)?"pointer":e.cursor}function xle(e,t){if(pe([Jp,Cw,Mw,Fw],e)&&!Bw(t))return .7}function vle(e,t,{graticule:n}){if(n)return!1;const i=Ur("filled",e,t),r=e.type;return Ve(i,r!==Jp&&r!==Kp&&r!==lg)}function wle(e,t,n){switch(e){case Jp:case Mw:case Fw:case HO:case Gie:case Hie:return}const{x:i,y:r,x2:o,y2:s}=t;switch(e){case Xp:if(I(i)&&(yt(i.bin)||I(r)&&r.aggregate&&!i.aggregate))return"vertical";if(I(r)&&(yt(r.bin)||I(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(s||o){if(n)return n;if(!o)return(I(i)&&i.type===Js&&!Oe(i.bin)||fg(i))&&I(r)&&yt(r.bin)?"horizontal":"vertical";if(!s)return(I(r)&&r.type===Js&&!Oe(r.bin)||fg(r))&&I(i)&&yt(i.bin)?"vertical":"horizontal"}case lg:if(o&&!(I(i)&&yt(i.bin))&&s&&!(I(r)&&yt(r.bin)))return;case Vp:if(s)return I(r)&&yt(r.bin)?"horizontal":"vertical";if(o)return I(i)&&yt(i.bin)?"vertical":"horizontal";if(e===lg){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Kp:case Cw:{const a=D$(i),u=D$(r);if(n)return n;if(a&&!u)return e!=="tick"?"horizontal":"vertical";if(!a&&u)return e!=="tick"?"vertical":"horizontal";if(a&&u)return"vertical";{const l=nn(i)&&i.type===Eu,c=nn(r)&&r.type===Eu;if(l&&!c)return"vertical";if(!l&&c)return"horizontal"}return}}return"vertical"}const _le={vgMark:"arc",encodeEntry:e=>({...ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...Nt("x",e,{defaultPos:"mid"}),...Nt("y",e,{defaultPos:"mid"}),...Bo(e,"radius"),...Bo(e,"theta")})},Sle={vgMark:"area",encodeEntry:e=>({...ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...bg("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"}),...bg("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"}),...i_(e)})},Ele={vgMark:"rect",encodeEntry:e=>({...ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Bo(e,"x"),...Bo(e,"y")})},kle={vgMark:"shape",encodeEntry:e=>({...ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[{type:"geoshape",projection:e.projectionName(),...n&&I(n)&&n.type===Ku?{field:W(n,{expr:"datum"})}:{}}]}},$le={vgMark:"image",encodeEntry:e=>({...ei(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...Bo(e,"x"),...Bo(e,"y"),...t_(e,"url")})},Ale={vgMark:"line",encodeEntry:e=>({...ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...Nt("x",e,{defaultPos:"mid"}),...Nt("y",e,{defaultPos:"mid"}),...st("size",e,{vgChannel:"strokeWidth"}),...i_(e)})},Cle={vgMark:"trail",encodeEntry:e=>({...ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...Nt("x",e,{defaultPos:"mid"}),...Nt("y",e,{defaultPos:"mid"}),...st("size",e),...i_(e)})};function b_(e,t){const{config:n}=e;return{...ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...Nt("x",e,{defaultPos:"mid"}),...Nt("y",e,{defaultPos:"mid"}),...st("size",e),...st("angle",e),...Mle(e,n,t)}}function Mle(e,t,n){return n?{shape:{value:n}}:st("shape",e)}const Fle={vgMark:"symbol",encodeEntry:e=>b_(e)},Tle={vgMark:"symbol",encodeEntry:e=>b_(e,"circle")},Dle={vgMark:"symbol",encodeEntry:e=>b_(e,"square")},Nle={vgMark:"rect",encodeEntry:e=>({...ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Bo(e,"x"),...Bo(e,"y")})},Ole={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:{...ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...bg("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"}),...bg("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"}),...st("size",e,{vgChannel:"strokeWidth"})}}},Rle={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return{...ei(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...Nt("x",e,{defaultPos:"mid"}),...Nt("y",e,{defaultPos:"mid"}),...t_(e),...st("size",e,{vgChannel:"fontSize"}),...st("angle",e),...eA("align",zle(e.markDef,n,t)),...eA("baseline",Ple(e.markDef,n,t)),...Nt("radius",e,{defaultPos:null}),...Nt("theta",e,{defaultPos:null})}}};function zle(e,t,n){if(ke("align",e,n)===void 0)return"center"}function Ple(e,t,n){if(ke("baseline",e,n)===void 0)return"middle"}const Lle={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",o=i==="horizontal"?"height":"width";return{...ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Nt("x",e,{defaultPos:"mid",vgChannel:"xc"}),...Nt("y",e,{defaultPos:"mid",vgChannel:"yc"}),...st("size",e,{defaultValue:Ile(e),vgChannel:r}),[o]:ze(ke("thickness",n,t))}}};function Ile(e){const{config:t,markDef:n}=e,{orient:i}=n,r=i==="horizontal"?"width":"height",o=e.getScaleComponent(i==="horizontal"?"x":"y"),s=ke("size",n,t,{vgChannel:r})??t.tick.bandSize;if(s!==void 0)return s;{const a=o?o.get("range"):void 0;return a&&ts(a)&&Ae(a.step)?a.step*3/4:mg(t.view,r)*3/4}}const hd={arc:_le,area:Sle,bar:Ele,circle:Tle,geoshape:kle,image:$le,line:Ale,point:Fle,rect:Nle,rule:Ole,square:Dle,text:Rle,tick:Lle,trail:Cle};function Ble(e){if(pe([Kp,Vp,Yie],e.mark)){const t=x6(e.mark,e.encoding);if(t.length>0)return jle(e,t)}else if(e.mark===Xp){const t=Ty.some(n=>ke(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return Ule(e)}return x_(e)}const vA="faceted_path_";function jle(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:vA+e.requestDataName(De.Main),data:e.requestDataName(De.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:x_(e,{fromPrefix:vA})}]}const wA="stack_group_";function Ule(e){var l;const[t]=x_(e,{fromPrefix:wA}),n=e.scaleName(e.stack.fieldChannel),i=(c={})=>e.vgField(e.stack.fieldChannel,c),r=(c,f)=>{const d=[i({prefix:"min",suffix:"start",expr:f}),i({prefix:"max",suffix:"start",expr:f}),i({prefix:"min",suffix:"end",expr:f}),i({prefix:"max",suffix:"end",expr:f})];return`${c}(${d.map(h=>`scale('${n}',${h})`).join(",")})`};let o,s;e.stack.fieldChannel==="x"?(o={...vu(t.encode.update,["y","yc","y2","height",...Ty]),x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}},s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update={...gn(t.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(o={...vu(t.encode.update,["x","xc","x2","width"]),y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}},s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update={...gn(t.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const c of Ty){const f=Ur(c,e.markDef,e.config);t.encode.update[c]?(o[c]=t.encode.update[c],delete t.encode.update[c]):f&&(o[c]=ze(f)),f&&(t.encode.update[c]={value:0})}const a=[];if(((l=e.stack.groupbyChannels)==null?void 0:l.length)>0)for(const c of e.stack.groupbyChannels){const f=e.fieldDef(c),d=W(f);d&&a.push(d),(f!=null&&f.bin||f!=null&&f.timeUnit)&&a.push(W(f,{binSuffix:"end"}))}return o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((c,f)=>{if(t.encode.update[f])return{...c,[f]:t.encode.update[f]};{const d=Ur(f,e.markDef,e.config);return d!==void 0?{...c,[f]:ze(d)}:c}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(De.Main),name:wA+e.requestDataName(De.Main),groupby:a,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[t]}]}]}function qle(e){var a;const{encoding:t,stack:n,mark:i,markDef:r,config:o}=e,s=t.order;if(!(!z(s)&&Si(s)&&My(s.value)||!s&&My(ke("order",r,o)))){if((z(s)||I(s))&&!n)return bO(s,{expr:"datum"});if(ns(i)){const u=r.orient==="horizontal"?"y":"x",l=t[u];if(I(l)){const c=l.sort;if(z(c))return{field:W(l,{prefix:u,suffix:"sort_index",expr:"datum"})};if(Yi(c))return{field:W({aggregate:Bw(e.encoding)?c.op:void 0,field:c.field},{expr:"datum"})};if(t6(c)){const f=e.fieldDef(c.encoding);return{field:W(f,{expr:"datum"}),order:c.order}}else return c===null?void 0:{field:W(l,{binSuffix:(a=e.stack)!=null&&a.impute?"mid":void 0,expr:"datum"})}}return}}}function x_(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:o}=e,s=Ve(i.clip,Wle(e),Hle(e)),a=mO(i),u=r.key,l=qle(e),c=Gle(e),f=ke("aria",i,o),d=hd[n].postEncodingTransform?hd[n].postEncodingTransform(e):null;return[{name:e.getName("marks"),type:hd[n].vgMark,...s?{clip:!0}:{},...a?{style:a}:{},...u?{key:u.field}:{},...l?{sort:l}:{},...c||{},...f===!1?{aria:f}:{},from:{data:t.fromPrefix+e.requestDataName(De.Main)},encode:{update:hd[n].encodeEntry(e)},...d?{transform:d}:{}}]}function Wle(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t!=null&&t.get("selectionExtent")||n!=null&&n.get("selectionExtent")?!0:void 0}function Hle(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function Gle(e){if(!e.component.selection)return null;const t=P(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=P(i.component.selection).length,i=i.parent;return n?{interactive:t>0||e.mark==="geoshape"||!!e.encoding.tooltip}:null}class o4 extends e4{constructor(t,n,i,r={},o){super(t,"unit",n,i,o,void 0,z$(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const s=nr(t.mark)?{...t.mark}:{type:t.mark},a=s.type;s.filled===void 0&&(s.filled=vle(s,o,{graticule:t.data&&Zw(t.data)}));const u=this.encoding=Nre(t.encoding||{},a,s.filled,o);this.markDef=yle(s,u,o),this.size=mle({encoding:u,size:z$(t)?{...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}}:r}),this.stack=I6(this.markDef,u),this.specifiedScales=this.initScales(a,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegends(u),this.specifiedProjection=t.projection,this.selection=(t.params??[]).filter(l=>Vw(l))}get hasProjection(){const{encoding:t}=this,n=this.mark===GO,i=t&&Dte.some(r=>se(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Wp.reduce((i,r)=>{const o=tt(n[r]);return o&&(i[r]=this.initScale(o.scale??{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=ln(t);return z(n)&&(r.domain=n.map(Mn)),z(i)&&(r.range=i.map(Mn)),r}initAxes(t){return pr.reduce((n,i)=>{const r=t[i];if(se(r)||i===Ie&&se(t.x2)||i===dt&&se(t.y2)){const o=se(r)?r.axis:void 0;n[i]=o&&this.initAxis({...o})}return n},{})}initAxis(t){const n=P(t),i={};for(const r of n){const o=t[r];i[r]=Mf(o)?pO(o):Mn(o)}return i}initLegends(t){return jte.reduce((n,i)=>{const r=tt(t[i]);if(r&&qte(i)){const o=r.legend;n[i]=o&&ln(o)}return n},{})}parseData(){this.component.data=Sm(this)}parseLayoutSize(){Zue(this)}parseSelections(){this.component.selection=Wse(this,this.selection)}parseMarkGroup(){this.component.mark=Ble(this)}parseAxesAndHeaders(){this.component.axes=ule(this)}assembleSelectionTopLevelSignals(t){return dse(this,t)}assembleSignals(){return[...vR(this),...cse(this,[])]}assembleSelectionData(t){return hse(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return a_(this)}assembleMarks(){let t=this.component.mark??[];return(!this.parent||!tl(this.parent))&&(t=Q6(this,t)),t.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Os(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return ir(n)}typedFieldDef(t){const n=this.fieldDef(t);return nn(n)?n:null}}class v_ extends p_{constructor(t,n,i,r,o){super(t,"layer",n,i,o,t.resolve,t.view);const s={...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}};this.children=t.layer.map((a,u)=>{if(am(a))return new v_(a,this,this.getName(`layer_${u}`),s,o);if(Jr(a))return new o4(a,this,this.getName(`layer_${u}`),s,o);throw new Error(hw(a))})}parseData(){this.component.data=Sm(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Jue(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of P(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){cle(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),vR(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),a_(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of H(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return gse(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),PR(this))}}function w_(e,t,n,i,r){if(Zp(e))return new ac(e,t,n,r);if(am(e))return new v_(e,t,n,i,r);if(Jr(e))return new o4(e,t,n,i,r);if(ioe(e))return new rle(e,t,n,r);throw new Error(hw(e))}function Yle(e,t={}){t.logger&&lie(t.logger),t.fieldTitle&&f6(t.fieldTitle);try{const n=L6(Sg(t.config,e.config)),i=G6(e,n),r=w_(i,null,"",void 0,n);return r.parse(),due(r.component.data,r),{spec:Xle(r,Vle(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&cie(),t.fieldTitle&&Ere()}}function Vle(e,t,n,i){const r=i.component.layoutSize.get("width"),o=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):Y(t)&&(t={type:t}),r&&o&&sse(t.type)){if(r==="step"&&o==="step")L(v$()),t.type="pad";else if(r==="step"||o==="step"){const s=r==="step"?"width":"height";L(v$(qp(s)));const a=s==="width"?"height":"width";t.type=ase(a)}}return{...P(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t},...V$(n,!1),...V$(e,!0)}}function Xle(e,t,n={},i){const r=e.config?yoe(e.config):void 0,o=[].concat(e.assembleSelectionData([]),Yue(e.component.data,n)),s=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter(h=>(h.name==="width"||h.name==="height")&&h.value!==void 0?(t[h.name]=+h.value,!1):!0);const{params:f,...d}=t;return{$schema:"https://vega.github.io/schema/vega/v5.json",...e.description?{description:e.description}:{},...d,...a?{title:a}:{},...u?{style:u}:{},...l?{encode:{update:l}}:{},data:o,...s.length>0?{projections:s}:{},...e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...O6(f)]),...r?{config:r}:{},...i?{usermeta:i}:{}}}const Kle=wte.version,Tfe=Object.freeze(Object.defineProperty({__proto__:null,accessPathDepth:wu,accessPathWithDatum:iw,compile:Yle,contains:pe,deepEqual:Ui,deleteNestedProperty:sg,duplicate:oe,entries:Po,every:ew,fieldIntersection:nw,flatAccessWithDatum:VN,getFirstDefined:Ve,hasIntersection:tw,hash:ge,internalField:JN,isBoolean:Oc,isEmpty:Me,isEqual:Cte,isInternalField:QN,isNullOrFalse:My,isNumeric:Pp,keys:P,logicalExpr:oc,mergeDeep:GN,never:HN,normalize:G6,normalizeAngle:Rc,omit:gn,pick:vu,prefixGenerator:Fy,removePathFromField:rw,replaceAll:Vs,replacePathInField:Kn,resetIdCounter:Fte,setEqual:YN,some:Ys,stringify:Ne,titleCase:vf,unique:qi,uniqueId:KN,vals:wt,varName:Le,version:Kle},Symbol.toStringTag,{value:"Module"}));function Dfe(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var Jle="vega-themes",Qle="2.13.0",Zle="Themes for stylized Vega and Vega-Lite visualizations.",ece=["vega","vega-lite","themes","style"],tce="BSD-3-Clause",nce={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},ice=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],rce="build/vega-themes.js",oce="build/vega-themes.module.js",sce="build/vega-themes.min.js",ace="build/vega-themes.min.js",uce="build/vega-themes.module.d.ts",lce={type:"git",url:"https://github.com/vega/vega-themes.git"},cce=["src","build"],fce={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},dce={"@babel/core":"^7.21.4","@babel/plugin-transform-runtime":"^7.21.4","@babel/preset-env":"^7.21.4","@babel/preset-typescript":"^7.21.4","@release-it/conventional-changelog":"^5.1.1","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-terser":"^0.4.1","@typescript-eslint/eslint-plugin":"^5.59.0","@typescript-eslint/parser":"^5.59.0","browser-sync":"^2.29.1",concurrently:"^8.0.1",eslint:"^8.38.0","eslint-config-prettier":"^8.8.0","eslint-plugin-prettier":"^4.2.1","gh-pages":"^5.0.0",prettier:"^2.8.7","release-it":"^15.10.1",rollup:"^3.20.6","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",typescript:"^5.0.4",vega:"^5.24.0","vega-lite":"^5.7.1"},hce={vega:"*","vega-lite":"*"},gce={},pce={name:Jle,version:Qle,description:Zle,keywords:ece,license:tce,author:nce,contributors:ice,main:rce,module:oce,unpkg:sce,jsdelivr:ace,types:uce,repository:lce,files:cce,scripts:fce,devDependencies:dce,peerDependencies:hce,dependencies:gce};const Da="#fff",_A="#888",mce={background:"#333",view:{stroke:_A},title:{color:Da,subtitleColor:Da},style:{"guide-label":{fill:Da},"guide-title":{fill:Da}},axis:{domainColor:Da,gridColor:_A,tickColor:Da}},us="#4572a7",yce={background:"#fff",arc:{fill:us},area:{fill:us},line:{stroke:us,strokeWidth:2},path:{stroke:us},rect:{fill:us},shape:{stroke:us},symbol:{fill:us,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},ls="#30a2da",B0="#cbcbcb",bce="#999",xce="#333",SA="#f0f0f0",EA="#333",vce={arc:{fill:ls},area:{fill:ls},axis:{domainColor:B0,grid:!0,gridColor:B0,gridWidth:1,labelColor:bce,labelFontSize:10,titleColor:xce,tickColor:B0,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:SA,group:{fill:SA},legend:{labelColor:EA,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:EA,titleFontSize:14,titlePadding:10},line:{stroke:ls,strokeWidth:2},path:{stroke:ls,strokeWidth:.5},rect:{fill:ls},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:ls},bar:{binSpacing:2,fill:ls,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},cs="#000",wce={group:{fill:"#e5e5e5"},arc:{fill:cs},area:{fill:cs},line:{stroke:cs},path:{stroke:cs},rect:{fill:cs},shape:{stroke:cs},symbol:{fill:cs,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},_ce=22,Sce="normal",kA="Benton Gothic, sans-serif",$A=11.5,Ece="normal",fs="#82c6df",j0="Benton Gothic Bold, sans-serif",AA="normal",CA=13,_l={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},kce={background:"#ffffff",title:{anchor:"start",color:"#000000",font:j0,fontSize:_ce,fontWeight:Sce},arc:{fill:fs},area:{fill:fs},line:{stroke:fs,strokeWidth:2},path:{stroke:fs},rect:{fill:fs},shape:{stroke:fs},symbol:{fill:fs,size:30},axis:{labelFont:kA,labelFontSize:$A,labelFontWeight:Ece,titleFont:j0,titleFontSize:CA,titleFontWeight:AA},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:kA,labelFontSize:$A,symbolType:"square",titleFont:j0,titleFontSize:CA,titleFontWeight:AA},range:{category:_l["category-6"],diverging:_l["fireandice-6"],heatmap:_l["fire-7"],ordinal:_l["fire-7"],ramp:_l["fire-7"]}},ds="#ab5787",gd="#979797",$ce={background:"#f9f9f9",arc:{fill:ds},area:{fill:ds},line:{stroke:ds},path:{stroke:ds},rect:{fill:ds},shape:{stroke:ds},symbol:{fill:ds,size:30},axis:{domainColor:gd,domainWidth:.5,gridWidth:.2,labelColor:gd,tickColor:gd,tickWidth:.2,titleColor:gd},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},hs="#3e5c69",Ace={background:"#fff",arc:{fill:hs},area:{fill:hs},line:{stroke:hs},path:{stroke:hs},rect:{fill:hs},shape:{stroke:hs},symbol:{fill:hs},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},In="#1696d2",MA="#000000",Cce="#FFFFFF",pd="Lato",U0="Lato",Mce="Lato",Fce="#DEDDDD",Tce=18,Sl={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Dce={background:Cce,title:{anchor:"start",fontSize:Tce,font:pd},axisX:{domain:!0,domainColor:MA,domainWidth:1,grid:!1,labelFontSize:12,labelFont:U0,labelAngle:0,tickColor:MA,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:pd},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:Fce,gridWidth:1,labelFontSize:12,labelFont:U0,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:pd,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:U0,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:pd,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Sl["six-groups-cat-1"],diverging:Sl["diverging-colors"],heatmap:Sl["diverging-colors"],ordinal:Sl["six-groups-seq"],ramp:Sl["shades-blue"]},area:{fill:In},rect:{fill:In},line:{color:In,stroke:In,strokeWidth:5},trail:{color:In,stroke:In,strokeWidth:0,size:1},path:{stroke:In,strokeWidth:.5},point:{filled:!0},text:{font:Mce,color:In,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:In,stroke:null}},arc:{fill:In},shape:{stroke:In},symbol:{fill:In,size:30}},gs="#3366CC",FA="#ccc",md="Arial, sans-serif",Nce={arc:{fill:gs},area:{fill:gs},path:{stroke:gs},rect:{fill:gs},shape:{stroke:gs},symbol:{stroke:gs},circle:{fill:gs},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:md,fontSize:12},"guide-title":{font:md,fontSize:12},"group-title":{font:md,fontSize:12}},title:{font:md,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:FA,tickColor:FA,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},__=e=>e*(1/3+1),TA=__(9),DA=__(10),NA=__(12),El="Segoe UI",OA="wf_standard-font, helvetica, arial, sans-serif",RA="#252423",kl="#605E5C",zA="transparent",Oce="#C8C6C4",ii="#118DFF",Rce="#12239E",zce="#E66C37",Pce="#6B007B",Lce="#E044A7",Ice="#744EC2",Bce="#D9B300",jce="#D64550",s4=ii,a4="#DEEFFF",PA=[a4,s4],Uce=[a4,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",s4],qce={view:{stroke:zA},background:zA,font:El,header:{titleFont:OA,titleFontSize:NA,titleColor:RA,labelFont:El,labelFontSize:DA,labelColor:kl},axis:{ticks:!1,grid:!1,domain:!1,labelColor:kl,labelFontSize:TA,titleFont:OA,titleColor:RA,titleFontSize:NA,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:Oce,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:ii},line:{stroke:ii,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:El,fontSize:TA,fill:kl},arc:{fill:ii},area:{fill:ii,line:!0,opacity:.6},path:{stroke:ii},rect:{fill:ii},point:{fill:ii,filled:!0,size:75},shape:{stroke:ii},symbol:{fill:ii,strokeWidth:1.5,size:50},legend:{titleFont:El,titleFontWeight:"bold",titleColor:kl,labelFont:El,labelFontSize:DA,labelColor:kl,symbolType:"circle",symbolSize:75},range:{category:[ii,Rce,zce,Pce,Lce,Ice,Bce,jce],diverging:PA,heatmap:PA,ordinal:Uce}},Wce=pce.version,Nfe=Object.freeze(Object.defineProperty({__proto__:null,dark:mce,excel:yce,fivethirtyeight:vce,ggplot2:wce,googlecharts:Nce,latimes:kce,powerbi:qce,quartz:$ce,urbaninstitute:Dce,version:Wce,vox:Ace},Symbol.toStringTag,{value:"Module"}));export{Y as a,V as b,Tfe as c,ia as d,Dfe as e,Zy as f,kte as g,Mx as h,z as i,yL as j,mL as k,t3 as l,Sg as m,bc as n,xL as o,bL as p,vL as q,Gce as s,Nfe as t,Xce as v,jc as w};
